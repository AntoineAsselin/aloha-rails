
(function(global){'use strict';var Initialization={phases:[],completed:[],start:function(phases,callback){Initialization.phases=Initialization.phases.concat(phases);Initialization.proceed(0,phases,callback);},proceed:function(index,phases,callback){if(index<phases.length){var phase=phases[index];var next=function(){Initialization.proceed(++index,phases,callback);};var event=function(){Initialization.completed.push(phase);if(phase.event){Aloha.trigger(phase.event);}};if(phase.fn){phase.fn(event,next);}else{event();next();}}else if(callback){callback();}},getPhaseByEvent:function(event){var i;for(i=0;i<Initialization.phases.length;i++){if(event===Initialization.phases[i].event){return Initialization.phases[i];}}
return null;},getReadiness:function(event){var i;for(i=0;i<Initialization.completed.length;i++){if(event===Initialization.completed[i].event){return'immediate';}}
return Initialization.getPhaseByEvent(event)?'deferred':'normal';}};function getLoadConfig(){var scripts,script,plugins=Aloha.settings.plugins&&Aloha.settings.plugins.load,baseUrl=Aloha.settings.baseUrl,pluginsAttr,regexAlohaJs=/\/aloha.js(\?\S*)?$/,regexStripFilename=/\/[^\/]*\.js$/,i;if(!plugins||!baseUrl){scripts=document.getElementsByTagName('script');for(i=0;i<scripts.length;i++){script=scripts[i];pluginsAttr=script.getAttribute('data-aloha-plugins');if(null!=pluginsAttr){if(!plugins){plugins=pluginsAttr;}
if(!baseUrl){baseUrl=script.src.replace(regexStripFilename,'');}
break;}
if(!baseUrl&&regexAlohaJs.test(script.src)){baseUrl=script.src.replace(regexAlohaJs,'');}}}
if(typeof plugins==='string'&&plugins!==''){plugins=plugins.replace(/\s+/g,'').split(',');}
return{baseUrl:baseUrl,plugins:plugins||[]};}
function isDeferInit(){var scripts=document.getElementsByTagName('script');for(var i=0;i<scripts.length;i++){var attr=scripts[i].getAttribute('data-aloha-defer-init');if("true"===attr){return true;}}
return false;}
function mergePluginPaths(paths,bundlePath,pluginName){var resourceFolders=['nls','css','vendor','res'],resourceFolder,i;paths[pluginName]=bundlePath+'/'+pluginName+'/lib';for(i=0;i<resourceFolders.length;i++){var resourceFolder=resourceFolders[i];paths[pluginName+'/'+resourceFolder]=bundlePath+'/'+pluginName+'/'+resourceFolder;}}
function getPluginLoadConfig(plugins){var paths={},entryPoints=[],names=[],baseUrlByName={},map={},parts,bundleName,pluginName,basePath=Aloha.settings.basePath||'',bundlePath,bundles=Aloha.settings.bundles||{},i;for(i=0;i<plugins.length;i++){parts=plugins[i].split('/');bundleName=parts[0];pluginName=parts[1];if(bundles[bundleName]){bundlePath=basePath+bundles[bundleName];}else{bundlePath=basePath+'../plugins/'+bundleName;}
mergePluginPaths(paths,bundlePath,pluginName);baseUrlByName[pluginName]=bundlePath+'/'+pluginName;entryPoints.push(pluginName+'/'+pluginName+'-plugin');map[pluginName]={'jquery':'aloha/jquery'};}
return{paths:paths,entryPoints:entryPoints,baseUrlByName:baseUrlByName,names:names,map:map};}
function mergeObjects(){var clone={};var objects=Array.prototype.slice.call(arguments);var name;var i;var obj;for(i=0;i<objects.length;i++){obj=objects[i];for(name in obj){if(obj.hasOwnProperty(name)){clone[name]=objects[i][name];}}}
return clone;}
function createDefine(name,module){define(name,function(){return module;});}
function load(){Aloha.features={};Aloha.defaults={};Aloha.settings=Aloha.settings||{};Aloha.initialize=Initialization.start;var loadConfig=getLoadConfig();var pluginConfig=getPluginLoadConfig(loadConfig.plugins);Aloha.settings.baseUrl=loadConfig.baseUrl;Aloha.settings.loadedPlugins=pluginConfig.names;Aloha.settings._pluginBaseUrlByName=pluginConfig.baseUrlByName;var coreMap={'aloha':{'jquery':'aloha/jquery'},'aloha/jquery':{'jquery':'jquery'},'jqueryui':{'jquery':'aloha/jquery'},'vendor':{'jquery':'aloha/jquery'},'util':{'jquery':'aloha/jquery'},'RepositoryBrowser':{'jquery':'aloha/jquery'},'jstree':{'jquery':'aloha/jquery'},'jqgrid':{'jquery':'aloha/jquery'},'jqgrid-locale-en':{'jquery':'aloha/jquery'},'jqgrid-locale-de':{'jquery':'aloha/jquery'},'jquery-layout':{'jquery':'aloha/jquery'}};var moduleMap=mergeObjects(coreMap,pluginConfig.map)
var defaultConfig={context:'aloha',config:{i18n:{locale:Aloha.settings.locale||'en'}},baseUrl:Aloha.settings.baseUrl,map:moduleMap};var DependencyManagement=global.__DEPS__||(global.__DEPS__={});DependencyManagement.lang=defaultConfig.locale;var defaultPaths={jquery:'vendor/jquery-1.7.2',jqueryui:'vendor/jquery-ui-1.9.0.custom-aloha'};var browserPaths={PubSub:'vendor/pubsub/js/pubsub-unminified','Class':'vendor/class',RepositoryBrowser:'vendor/repository-browser/js/repository-browser-unminified',jstree:'vendor/jquery.jstree',jqgrid:'vendor/jquery.jqgrid','jquery-layout':'vendor/jquery.layout-1.3.0-rc30.7','jqgrid-locale-en':'vendor/grid.locale.en','jqgrid-locale-de':'vendor/grid.locale.de','repository-browser-i18n-de':'vendor/repository-browser/js/repository-browser-unminified','repository-browser-i18n-en':'vendor/repository-browser/js/repository-browser-unminified'};var requireConfig=mergeObjects(defaultConfig,Aloha.settings.requireConfig);requireConfig.paths=mergeObjects(defaultPaths,browserPaths,pluginConfig.paths,requireConfig.paths);var predefinedModules=Aloha.settings.predefinedModules||{};if(Aloha.settings.jQuery){predefinedModules.jquery=Aloha.settings.jQuery;}
var moduleName;for(moduleName in predefinedModules)if(predefinedModules.hasOwnProperty(moduleName)){createDefine(moduleName,predefinedModules[moduleName]);delete requireConfig.paths[moduleName];}
var alohaRequire=require.config(requireConfig);Aloha.require=function(callback){if(1===arguments.length&&typeof callback==='function'){return alohaRequire(['aloha'],callback);}
return alohaRequire.apply(this,arguments);};Aloha.bind=function(event,fn){Aloha.require(['aloha/jquery'],function($){Aloha.bind=function(event,fn){switch(Initialization.getReadiness(event)){case'deferred':var phase=Initialization.getPhaseByEvent(event);if(!phase.deferred){phase.deferred=$.Deferred();}
phase.deferred.done(fn);break;case'immediate':fn();break;case'normal':$(Aloha,'body').bind(event,fn);break;default:throw'Unknown readiness';}
return this;};Aloha.bind(event,fn);});return this;};Aloha.trigger=function(type,data){Aloha.require(['aloha/jquery'],function($){Aloha.trigger=function(type,data){var phase=Initialization.getPhaseByEvent(type);if(phase){if(phase.deferred){$(phase.deferred.resolve);phase.deferred=null;}}
$(Aloha,'body').trigger(type,data);return this;};Aloha.trigger(type,data);});return this;};Aloha.unbind=function(typeOrEvent){Aloha.require(['aloha/jquery'],function($){Aloha.unbind=function(typeOrEvent){$(Aloha,'body').unbind(typeOrEvent);};Aloha.unbind(typeOrEvent);});};Aloha.ready=function(fn){this.bind('aloha-ready',fn);return this;};var jQueryThatWasPassedToUs=Aloha.settings.jQuery;define('aloha/jquery',['jquery'],function($){return jQueryThatWasPassedToUs||$;});Aloha.jQuery=jQueryThatWasPassedToUs;define('aloha',['aloha/jquery','util/json2','aloha/rangy-core','util/class','util/lang','util/range','util/dom','aloha/core','aloha/editable','aloha/console','aloha/markup','aloha/plugin','aloha/selection','aloha/command','aloha/jquery.aloha','aloha/sidebar','util/position','aloha/repositorymanager','aloha/repository','aloha/repositoryobjects','aloha/contenthandlermanager'],function($){Aloha.features.jquery=true;Aloha.jQuery=$;Aloha.settings=$.extendObjects(true,{},Aloha.defaults,Aloha.settings);return Aloha;});require(requireConfig,['aloha','aloha/jquery'],function(Aloha,$){require(requireConfig,pluginConfig.entryPoints,function(){$(function(){window.rangy.init();Aloha.init();});});});}
global.Aloha=global.Aloha||{};if(global.Aloha.deferInit||isDeferInit()){global.Aloha.deferInit=load;}else{Aloha._load=load;load();}}(window));