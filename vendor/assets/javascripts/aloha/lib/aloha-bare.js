;(function(){var JSON;if(!JSON){JSON={};}
(function(){function f(n){return n<10?'0'+n:n;}
if(typeof Date.prototype.toJSON!=='function'){Date.prototype.toJSON=function(key){return isFinite(this.valueOf())?this.getUTCFullYear()+'-'+f(this.getUTCMonth()+1)+'-'+f(this.getUTCDate())+'T'+f(this.getUTCHours())+':'+f(this.getUTCMinutes())+':'+f(this.getUTCSeconds())+'Z':null;};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(key){return this.valueOf();};}
var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={'\b':'\\b','\t':'\\t','\n':'\\n','\f':'\\f','\r':'\\r','"':'\\"','\\':'\\\\'},rep;function quote(string){escapable.lastIndex=0;return escapable.test(string)?'"'+string.replace(escapable,function(a){var c=meta[a];return typeof c==='string'?c:'\\u'+('0000'+a.charCodeAt(0).toString(16)).slice(-4);})+'"':'"'+string+'"';}
function str(key,holder){var i,k,v,length,mind=gap,partial,value=holder[key];if(value&&typeof value==='object'&&typeof value.toJSON==='function'){value=value.toJSON(key);}
if(typeof rep==='function'){value=rep.call(holder,key,value);}
switch(typeof value){case'string':return quote(value);case'number':return isFinite(value)?String(value):'null';case'boolean':case'null':return String(value);case'object':if(!value){return'null';}
gap+=indent;partial=[];if(Object.prototype.toString.apply(value)==='[object Array]'){length=value.length;for(i=0;i<length;i+=1){partial[i]=str(i,value)||'null';}
v=partial.length===0?'[]':gap?'[\n'+gap+partial.join(',\n'+gap)+'\n'+mind+']':'['+partial.join(',')+']';gap=mind;return v;}
if(rep&&typeof rep==='object'){length=rep.length;for(i=0;i<length;i+=1){if(typeof rep[i]==='string'){k=rep[i];v=str(k,value);if(v){partial.push(quote(k)+(gap?': ':':')+v);}}}}else{for(k in value){if(Object.prototype.hasOwnProperty.call(value,k)){v=str(k,value);if(v){partial.push(quote(k)+(gap?': ':':')+v);}}}}
v=partial.length===0?'{}':gap?'{\n'+gap+partial.join(',\n'+gap)+'\n'+mind+'}':'{'+partial.join(',')+'}';gap=mind;return v;}}
if(typeof JSON.stringify!=='function'){JSON.stringify=function(value,replacer,space){var i;gap='';indent='';if(typeof space==='number'){for(i=0;i<space;i+=1){indent+=' ';}}else if(typeof space==='string'){indent=space;}
rep=replacer;if(replacer&&typeof replacer!=='function'&&(typeof replacer!=='object'||typeof replacer.length!=='number')){throw new Error('JSON.stringify');}
return str('',{'':value});};}
if(typeof JSON.parse!=='function'){JSON.parse=function(text,reviver){var j;function walk(holder,key){var k,v,value=holder[key];if(value&&typeof value==='object'){for(k in value){if(Object.prototype.hasOwnProperty.call(value,k)){v=walk(value,k);if(v!==undefined){value[k]=v;}else{delete value[k];}}}}
return reviver.call(holder,key,value);}
text=String(text);cx.lastIndex=0;if(cx.test(text)){text=text.replace(cx,function(a){return'\\u'+('0000'+a.charCodeAt(0).toString(16)).slice(-4);});}
if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,'@').replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,']').replace(/(?:^|:|,)(?:\s*\[)+/g,''))){j=eval('('+text+')');return typeof reviver==='function'?walk({'':j},''):j;}
throw new SyntaxError('JSON.parse');};}}());define('util/json2',[],function(){return JSON;});(function(){var rangy=(function(){var OBJECT="object",FUNCTION="function",UNDEFINED="undefined";var domRangeProperties=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer","START_TO_START","START_TO_END","END_TO_START","END_TO_END"];var domRangeMethods=["setStart","setStartBefore","setStartAfter","setEnd","setEndBefore","setEndAfter","collapse","selectNode","selectNodeContents","compareBoundaryPoints","deleteContents","extractContents","cloneContents","insertNode","surroundContents","cloneRange","toString","detach"];var textRangeProperties=["boundingHeight","boundingLeft","boundingTop","boundingWidth","htmlText","text"];var textRangeMethods=["collapse","compareEndPoints","duplicate","getBookmark","moveToBookmark","moveToElementText","parentElement","pasteHTML","select","setEndPoint","getBoundingClientRect"];function isHostMethod(o,p){var t=typeof o[p];return t==FUNCTION||(!!(t==OBJECT&&o[p]))||t=="unknown";}
function isHostObject(o,p){return!!(typeof o[p]==OBJECT&&o[p]);}
function isHostProperty(o,p){return typeof o[p]!=UNDEFINED;}
function createMultiplePropertyTest(testFunc){return function(o,props){var i=props.length;while(i--){if(!testFunc(o,props[i])){return false;}}
return true;};}
var areHostMethods=createMultiplePropertyTest(isHostMethod);var areHostObjects=createMultiplePropertyTest(isHostObject);var areHostProperties=createMultiplePropertyTest(isHostProperty);function isTextRange(range){return range&&areHostMethods(range,textRangeMethods)&&areHostProperties(range,textRangeProperties);}
var api={version:"1.2.1",initialized:false,supported:true,util:{isHostMethod:isHostMethod,isHostObject:isHostObject,isHostProperty:isHostProperty,areHostMethods:areHostMethods,areHostObjects:areHostObjects,areHostProperties:areHostProperties,isTextRange:isTextRange},features:{},modules:{},config:{alertOnWarn:false,preferTextRange:true}};function fail(reason){window.alert("Rangy not supported in your browser. Reason: "+reason);api.initialized=true;api.supported=false;}
api.fail=fail;function warn(msg){var warningMessage="Rangy warning: "+msg;if(api.config.alertOnWarn){window.alert(warningMessage);}else if(typeof window.console!=UNDEFINED&&typeof window.console.log!=UNDEFINED){window.console.log(warningMessage);}}
api.warn=warn;if({}.hasOwnProperty){api.util.extend=function(o,props){for(var i in props){if(props.hasOwnProperty(i)){o[i]=props[i];}}};}else{fail("hasOwnProperty not supported");}
var initListeners=[];var moduleInitializers=[];function init(){if(api.initialized){return;}
var testRange;var implementsDomRange=false,implementsTextRange=false;if(isHostMethod(document,"createRange")){testRange=document.createRange();if(areHostMethods(testRange,domRangeMethods)&&areHostProperties(testRange,domRangeProperties)){implementsDomRange=true;}
testRange.detach();}
var body=isHostObject(document,"body")?document.body:document.getElementsByTagName("body")[0];if(body&&isHostMethod(body,"createTextRange")){testRange=body.createTextRange();if(isTextRange(testRange)){implementsTextRange=true;}}
if(!implementsDomRange&&!implementsTextRange){fail("Neither Range nor TextRange are implemented");}
api.initialized=true;api.features={implementsDomRange:implementsDomRange,implementsTextRange:implementsTextRange};var allListeners=moduleInitializers.concat(initListeners);for(var i=0,len=allListeners.length;i<len;++i){try{allListeners[i](api);}catch(ex){if(isHostObject(window,"console")&&isHostMethod(window.console,"log")){window.console.log("Init listener threw an exception. Continuing.",ex);}}}}
api.init=init;api.addInitListener=function(listener){if(api.initialized){listener(api);}else{initListeners.push(listener);}};var createMissingNativeApiListeners=[];api.addCreateMissingNativeApiListener=function(listener){createMissingNativeApiListeners.push(listener);};function createMissingNativeApi(win){win=win||window;init();for(var i=0,len=createMissingNativeApiListeners.length;i<len;++i){createMissingNativeApiListeners[i](win);}}
api.createMissingNativeApi=createMissingNativeApi;function Module(name){this.name=name;this.initialized=false;this.supported=false;}
Module.prototype.fail=function(reason){this.initialized=true;this.supported=false;throw new Error("Module '"+this.name+"' failed to load: "+reason);};Module.prototype.warn=function(msg){api.warn("Module "+this.name+": "+msg);};Module.prototype.createError=function(msg){return new Error("Error in Rangy "+this.name+" module: "+msg);};api.createModule=function(name,initFunc){var module=new Module(name);api.modules[name]=module;moduleInitializers.push(function(api){initFunc(api,module);module.initialized=true;module.supported=true;});};api.requireModules=function(modules){for(var i=0,len=modules.length,module,moduleName;i<len;++i){moduleName=modules[i];module=api.modules[moduleName];if(!module||!(module instanceof Module)){throw new Error("Module '"+moduleName+"' not found");}
if(!module.supported){throw new Error("Module '"+moduleName+"' not supported");}}};var docReady=false;var loadHandler=function(e){if(!docReady){docReady=true;if(!api.initialized){init();}}};if(typeof window==UNDEFINED){fail("No window found");return;}
if(typeof document==UNDEFINED){fail("No document found");return;}
if(isHostMethod(document,"addEventListener")){document.addEventListener("DOMContentLoaded",loadHandler,false);}
if(isHostMethod(window,"addEventListener")){window.addEventListener("load",loadHandler,false);}else if(isHostMethod(window,"attachEvent")){window.attachEvent("onload",loadHandler);}else{fail("Window does not have required addEventListener or attachEvent method");}
return api;})();rangy.createModule("DomUtil",function(api,module){var UNDEF="undefined";var util=api.util;if(!util.areHostMethods(document,["createDocumentFragment","createElement","createTextNode"])){module.fail("document missing a Node creation method");}
if(!util.isHostMethod(document,"getElementsByTagName")){module.fail("document missing getElementsByTagName method");}
var el=document.createElement("div");if(!util.areHostMethods(el,["insertBefore","appendChild","cloneNode"]||!util.areHostObjects(el,["previousSibling","nextSibling","childNodes","parentNode"]))){module.fail("Incomplete Element implementation");}
if(!util.isHostProperty(el,"innerHTML")){module.fail("Element is missing innerHTML property");}
var textNode=document.createTextNode("test");if(!util.areHostMethods(textNode,["splitText","deleteData","insertData","appendData","cloneNode"]||!util.areHostObjects(el,["previousSibling","nextSibling","childNodes","parentNode"])||!util.areHostProperties(textNode,["data"]))){module.fail("Incomplete Text Node implementation");}
var arrayContains=function(arr,val){var i=arr.length;while(i--){if(arr[i]===val){return true;}}
return false;};function isHtmlNamespace(node){var ns;return typeof node.namespaceURI==UNDEF||((ns=node.namespaceURI)===null||ns=="http://www.w3.org/1999/xhtml");}
function parentElement(node){var parent=node.parentNode;return(parent.nodeType==1)?parent:null;}
function getNodeIndex(node){var i=0;while((node=node.previousSibling)){i++;}
return i;}
function getNodeLength(node){var childNodes;return isCharacterDataNode(node)?node.length:((childNodes=node.childNodes)?childNodes.length:0);}
function getCommonAncestor(node1,node2){var ancestors=[],n;for(n=node1;n;n=n.parentNode){ancestors.push(n);}
for(n=node2;n;n=n.parentNode){if(arrayContains(ancestors,n)){return n;}}
return null;}
function isAncestorOf(ancestor,descendant,selfIsAncestor){var n=selfIsAncestor?descendant:descendant.parentNode;while(n){if(n===ancestor){return true;}else{n=n.parentNode;}}
return false;}
function getClosestAncestorIn(node,ancestor,selfIsAncestor){var p,n=selfIsAncestor?node:node.parentNode;while(n){p=n.parentNode;if(p===ancestor){return n;}
n=p;}
return null;}
function isCharacterDataNode(node){var t=node.nodeType;return t==3||t==4||t==8;}
function insertAfter(node,precedingNode){var nextNode=precedingNode.nextSibling,parent=precedingNode.parentNode;if(nextNode){parent.insertBefore(node,nextNode);}else{parent.appendChild(node);}
return node;}
function splitDataNode(node,index){var newNode=node.cloneNode(false);newNode.deleteData(0,index);node.deleteData(index,node.length-index);insertAfter(newNode,node);return newNode;}
function getDocument(node){if(node.nodeType==9){return node;}else if(typeof node.ownerDocument!=UNDEF){return node.ownerDocument;}else if(typeof node.document!=UNDEF){return node.document;}else if(node.parentNode){return getDocument(node.parentNode);}else{throw new Error("getDocument: no document found for node");}}
function getWindow(node){var doc=getDocument(node);if(typeof doc.defaultView!=UNDEF){return doc.defaultView;}else if(typeof doc.parentWindow!=UNDEF){return doc.parentWindow;}else{throw new Error("Cannot get a window object for node");}}
function getIframeDocument(iframeEl){if(typeof iframeEl.contentDocument!=UNDEF){return iframeEl.contentDocument;}else if(typeof iframeEl.contentWindow!=UNDEF){return iframeEl.contentWindow.document;}else{throw new Error("getIframeWindow: No Document object found for iframe element");}}
function getIframeWindow(iframeEl){if(typeof iframeEl.contentWindow!=UNDEF){return iframeEl.contentWindow;}else if(typeof iframeEl.contentDocument!=UNDEF){return iframeEl.contentDocument.defaultView;}else{throw new Error("getIframeWindow: No Window object found for iframe element");}}
function getBody(doc){return util.isHostObject(doc,"body")?doc.body:doc.getElementsByTagName("body")[0];}
function getRootContainer(node){var parent;while((parent=node.parentNode)){node=parent;}
return node;}
function fixNode(node){if(!node){return;}
if(node.previousSibling){return node.previousSibling.nextSibling;}else if(node.nextSibling){return node.nextSibling.previousSibling;}else if(node.parentNode){return node.parentNode.firstChild;}else{return node;}}
function comparePoints(nodeA,offsetA,nodeB,offsetB){nodeA=fixNode(nodeA);nodeB=fixNode(nodeB);var nodeC,root,childA,childB,n;if(nodeA==nodeB){return offsetA===offsetB?0:(offsetA<offsetB)?-1:1;}else if((nodeC=getClosestAncestorIn(nodeB,nodeA,true))){return offsetA<=getNodeIndex(nodeC)?-1:1;}else if((nodeC=getClosestAncestorIn(nodeA,nodeB,true))){return getNodeIndex(nodeC)<offsetB?-1:1;}else{root=getCommonAncestor(nodeA,nodeB);childA=(nodeA===root)?root:getClosestAncestorIn(nodeA,root,true);childB=(nodeB===root)?root:getClosestAncestorIn(nodeB,root,true);if(childA===childB){throw new Error("comparePoints got to case 4 and childA and childB are the same!");}else{n=root.firstChild;while(n){if(n===childA){return-1;}else if(n===childB){return 1;}
n=n.nextSibling;}
throw new Error("Should not be here!");}}}
function fragmentFromNodeChildren(node){var fragment=getDocument(node).createDocumentFragment(),child;while((child=node.firstChild)){fragment.appendChild(child);}
return fragment;}
function inspectNode(node){if(!node){return"[No node]";}
if(isCharacterDataNode(node)){return'"'+node.data+'"';}else if(node.nodeType==1){var idAttr=node.id?' id="'+node.id+'"':"";return"<"+node.nodeName+idAttr+">["+node.childNodes.length+"]";}else{return node.nodeName;}}
function NodeIterator(root){this.root=root;this._next=root;}
NodeIterator.prototype={_current:null,hasNext:function(){return!!this._next;},next:function(){var n=this._current=this._next;var child,next;if(this._current){child=n.firstChild;if(child){this._next=child;}else{next=null;while((n!==this.root)&&!(next=n.nextSibling)){n=n.parentNode;}
this._next=next;}}
return this._current;},detach:function(){this._current=this._next=this.root=null;}};function createIterator(root){return new NodeIterator(root);}
function DomPosition(node,offset){this.node=node;this.offset=offset;}
DomPosition.prototype={equals:function(pos){return this.node===pos.node&this.offset==pos.offset;},inspect:function(){return"[DomPosition("+inspectNode(this.node)+":"+this.offset+")]";}};function DOMException(codeName){this.code=this[codeName];this.codeName=codeName;this.message="DOMException: "+this.codeName;}
DOMException.prototype={INDEX_SIZE_ERR:1,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INVALID_STATE_ERR:11};DOMException.prototype.toString=function(){return this.message;};api.dom={arrayContains:arrayContains,isHtmlNamespace:isHtmlNamespace,parentElement:parentElement,getNodeIndex:getNodeIndex,getNodeLength:getNodeLength,getCommonAncestor:getCommonAncestor,isAncestorOf:isAncestorOf,getClosestAncestorIn:getClosestAncestorIn,isCharacterDataNode:isCharacterDataNode,insertAfter:insertAfter,splitDataNode:splitDataNode,getDocument:getDocument,getWindow:getWindow,getIframeWindow:getIframeWindow,getIframeDocument:getIframeDocument,getBody:getBody,getRootContainer:getRootContainer,comparePoints:comparePoints,inspectNode:inspectNode,fragmentFromNodeChildren:fragmentFromNodeChildren,createIterator:createIterator,DomPosition:DomPosition};api.DOMException=DOMException;});rangy.createModule("DomRange",function(api,module){api.requireModules(["DomUtil"]);var dom=api.dom;var DomPosition=dom.DomPosition;var DOMException=api.DOMException;function isNonTextPartiallySelected(node,range){return(node.nodeType!=3)&&(dom.isAncestorOf(node,range.startContainer,true)||dom.isAncestorOf(node,range.endContainer,true));}
function getRangeDocument(range){return dom.getDocument(range.startContainer);}
function dispatchEvent(range,type,args){var listeners=range._listeners[type];if(listeners){for(var i=0,len=listeners.length;i<len;++i){listeners[i].call(range,{target:range,args:args});}}}
function getBoundaryBeforeNode(node){return new DomPosition(node.parentNode,dom.getNodeIndex(node));}
function getBoundaryAfterNode(node){return new DomPosition(node.parentNode,dom.getNodeIndex(node)+1);}
function insertNodeAtPosition(node,n,o){var firstNodeInserted=node.nodeType==11?node.firstChild:node;if(dom.isCharacterDataNode(n)){if(o==n.length){dom.insertAfter(node,n);}else{n.parentNode.insertBefore(node,o==0?n:dom.splitDataNode(n,o));}}else if(o>=n.childNodes.length){n.appendChild(node);}else{n.insertBefore(node,n.childNodes[o]);}
return firstNodeInserted;}
function cloneSubtree(iterator){var partiallySelected;for(var node,frag=getRangeDocument(iterator.range).createDocumentFragment(),subIterator;node=iterator.next();){partiallySelected=iterator.isPartiallySelectedSubtree();node=node.cloneNode(!partiallySelected);if(partiallySelected){subIterator=iterator.getSubtreeIterator();node.appendChild(cloneSubtree(subIterator));subIterator.detach(true);}
if(node.nodeType==10){throw new DOMException("HIERARCHY_REQUEST_ERR");}
frag.appendChild(node);}
return frag;}
function iterateSubtree(rangeIterator,func,iteratorState){var it,n;iteratorState=iteratorState||{stop:false};for(var node,subRangeIterator;node=rangeIterator.next();){if(rangeIterator.isPartiallySelectedSubtree()){if(func(node)===false){iteratorState.stop=true;return;}else{subRangeIterator=rangeIterator.getSubtreeIterator();iterateSubtree(subRangeIterator,func,iteratorState);subRangeIterator.detach(true);if(iteratorState.stop){return;}}}else{it=dom.createIterator(node);while((n=it.next())){if(func(n)===false){iteratorState.stop=true;return;}}}}}
function deleteSubtree(iterator){var subIterator;while(iterator.next()){if(iterator.isPartiallySelectedSubtree()){subIterator=iterator.getSubtreeIterator();deleteSubtree(subIterator);subIterator.detach(true);}else{iterator.remove();}}}
function extractSubtree(iterator){for(var node,frag=getRangeDocument(iterator.range).createDocumentFragment(),subIterator;node=iterator.next();){if(iterator.isPartiallySelectedSubtree()){node=node.cloneNode(false);subIterator=iterator.getSubtreeIterator();node.appendChild(extractSubtree(subIterator));subIterator.detach(true);}else{iterator.remove();}
if(node.nodeType==10){throw new DOMException("HIERARCHY_REQUEST_ERR");}
frag.appendChild(node);}
return frag;}
function getNodesInRange(range,nodeTypes,filter){var filterNodeTypes=!!(nodeTypes&&nodeTypes.length),regex;var filterExists=!!filter;if(filterNodeTypes){regex=new RegExp("^("+nodeTypes.join("|")+")$");}
var nodes=[];iterateSubtree(new RangeIterator(range,false),function(node){if((!filterNodeTypes||regex.test(node.nodeType))&&(!filterExists||filter(node))){nodes.push(node);}});return nodes;}
function inspect(range){var name=(typeof range.getName=="undefined")?"Range":range.getName();return"["+name+"("+dom.inspectNode(range.startContainer)+":"+range.startOffset+", "+dom.inspectNode(range.endContainer)+":"+range.endOffset+")]";}
function RangeIterator(range,clonePartiallySelectedTextNodes){this.range=range;this.clonePartiallySelectedTextNodes=clonePartiallySelectedTextNodes;if(!range.collapsed){this.sc=range.startContainer;this.so=range.startOffset;this.ec=range.endContainer;this.eo=range.endOffset;var root=range.commonAncestorContainer;if(this.sc===this.ec&&dom.isCharacterDataNode(this.sc)){this.isSingleCharacterDataNode=true;this._first=this._last=this._next=this.sc;}else{this._first=this._next=(this.sc===root&&!dom.isCharacterDataNode(this.sc))?this.sc.childNodes[this.so]:dom.getClosestAncestorIn(this.sc,root,true);this._last=(this.ec===root&&!dom.isCharacterDataNode(this.ec))?this.ec.childNodes[this.eo-1]:dom.getClosestAncestorIn(this.ec,root,true);}}}
RangeIterator.prototype={_current:null,_next:null,_first:null,_last:null,isSingleCharacterDataNode:false,reset:function(){this._current=null;this._next=this._first;},hasNext:function(){return!!this._next;},next:function(){var current=this._current=this._next;if(current){this._next=(current!==this._last)?current.nextSibling:null;if(dom.isCharacterDataNode(current)&&this.clonePartiallySelectedTextNodes){if(current===this.ec){(current=current.cloneNode(true)).deleteData(this.eo,current.length-this.eo);}
if(this._current===this.sc){(current=current.cloneNode(true)).deleteData(0,this.so);}}}
return current;},remove:function(){var current=this._current,start,end;if(dom.isCharacterDataNode(current)&&(current===this.sc||current===this.ec)){start=(current===this.sc)?this.so:0;end=(current===this.ec)?this.eo:current.length;if(start!=end){current.deleteData(start,end-start);}}else{if(current.parentNode){current.parentNode.removeChild(current);}else{}}},isPartiallySelectedSubtree:function(){var current=this._current;return isNonTextPartiallySelected(current,this.range);},getSubtreeIterator:function(){var subRange;if(this.isSingleCharacterDataNode){subRange=this.range.cloneRange();subRange.collapse();}else{subRange=new Range(getRangeDocument(this.range));var current=this._current;var startContainer=current,startOffset=0,endContainer=current,endOffset=dom.getNodeLength(current);if(dom.isAncestorOf(current,this.sc,true)){startContainer=this.sc;startOffset=this.so;}
if(dom.isAncestorOf(current,this.ec,true)){endContainer=this.ec;endOffset=this.eo;}
updateBoundaries(subRange,startContainer,startOffset,endContainer,endOffset);}
return new RangeIterator(subRange,this.clonePartiallySelectedTextNodes);},detach:function(detachRange){if(detachRange){this.range.detach();}
this.range=this._current=this._next=this._first=this._last=this.sc=this.so=this.ec=this.eo=null;}};function RangeException(codeName){this.code=this[codeName];this.codeName=codeName;this.message="RangeException: "+this.codeName;}
RangeException.prototype={BAD_BOUNDARYPOINTS_ERR:1,INVALID_NODE_TYPE_ERR:2};RangeException.prototype.toString=function(){return this.message;};function RangeNodeIterator(range,nodeTypes,filter){this.nodes=getNodesInRange(range,nodeTypes,filter);this._next=this.nodes[0];this._position=0;}
RangeNodeIterator.prototype={_current:null,hasNext:function(){return!!this._next;},next:function(){this._current=this._next;this._next=this.nodes[++this._position];return this._current;},detach:function(){this._current=this._next=this.nodes=null;}};var beforeAfterNodeTypes=[1,3,4,5,7,8,10];var rootContainerNodeTypes=[2,9,11];var readonlyNodeTypes=[5,6,10,12];var insertableNodeTypes=[1,3,4,5,7,8,10,11];var surroundNodeTypes=[1,3,4,5,7,8];function createAncestorFinder(nodeTypes){return function(node,selfIsAncestor){var t,n=selfIsAncestor?node:node.parentNode;while(n){t=n.nodeType;if(dom.arrayContains(nodeTypes,t)){return n;}
n=n.parentNode;}
return null;};}
var getRootContainer=dom.getRootContainer;var getDocumentOrFragmentContainer=createAncestorFinder([9,11]);var getReadonlyAncestor=createAncestorFinder(readonlyNodeTypes);var getDocTypeNotationEntityAncestor=createAncestorFinder([6,10,12]);function assertNoDocTypeNotationEntityAncestor(node,allowSelf){if(getDocTypeNotationEntityAncestor(node,allowSelf)){throw new RangeException("INVALID_NODE_TYPE_ERR");}}
function assertNotDetached(range){if(!range.startContainer){throw new DOMException("INVALID_STATE_ERR");}}
function assertValidNodeType(node,invalidTypes){if(!dom.arrayContains(invalidTypes,node.nodeType)){throw new RangeException("INVALID_NODE_TYPE_ERR");}}
function assertValidOffset(node,offset){if(offset<0||offset>(dom.isCharacterDataNode(node)?node.length:node.childNodes.length)){throw new DOMException("INDEX_SIZE_ERR");}}
function assertSameDocumentOrFragment(node1,node2){if(getDocumentOrFragmentContainer(node1,true)!==getDocumentOrFragmentContainer(node2,true)){throw new DOMException("WRONG_DOCUMENT_ERR");}}
function assertNodeNotReadOnly(node){if(getReadonlyAncestor(node,true)){throw new DOMException("NO_MODIFICATION_ALLOWED_ERR");}}
function assertNode(node,codeName){if(!node){throw new DOMException(codeName);}}
function isOrphan(node){return!dom.arrayContains(rootContainerNodeTypes,node.nodeType)&&!getDocumentOrFragmentContainer(node,true);}
function isValidOffset(node,offset){return offset<=(dom.isCharacterDataNode(node)?node.length:node.childNodes.length);}
function assertRangeValid(range){assertNotDetached(range);if(isOrphan(range.startContainer)||isOrphan(range.endContainer)||!isValidOffset(range.startContainer,range.startOffset)||!isValidOffset(range.endContainer,range.endOffset)){throw new Error("Range error: Range is no longer valid after DOM mutation ("+range.inspect()+")");}}
var styleEl=document.createElement("style");var htmlParsingConforms=false;try{styleEl.innerHTML="<b>x</b>";htmlParsingConforms=(styleEl.firstChild.nodeType==3);}catch(e){}
api.features.htmlParsingConforms=htmlParsingConforms;var createContextualFragment=htmlParsingConforms?function(fragmentStr){var node=this.startContainer;var doc=dom.getDocument(node);if(!node){throw new DOMException("INVALID_STATE_ERR");}
var el=null;if(node.nodeType==1){el=node;}else if(dom.isCharacterDataNode(node)){el=dom.parentElement(node);}
if(el===null||(el.nodeName=="HTML"&&dom.isHtmlNamespace(dom.getDocument(el).documentElement)&&dom.isHtmlNamespace(el))){el=doc.createElement("body");}else{el=el.cloneNode(false);}
el.innerHTML=fragmentStr;return dom.fragmentFromNodeChildren(el);}:function(fragmentStr){assertNotDetached(this);var doc=getRangeDocument(this);var el=doc.createElement("body");el.innerHTML=fragmentStr;return dom.fragmentFromNodeChildren(el);};var rangeProperties=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"];var s2s=0,s2e=1,e2e=2,e2s=3;var n_b=0,n_a=1,n_b_a=2,n_i=3;function RangePrototype(){}
RangePrototype.prototype={attachListener:function(type,listener){this._listeners[type].push(listener);},compareBoundaryPoints:function(how,range){assertRangeValid(this);assertSameDocumentOrFragment(this.startContainer,range.startContainer);var nodeA,offsetA,nodeB,offsetB;var prefixA=(how==e2s||how==s2s)?"start":"end";var prefixB=(how==s2e||how==s2s)?"start":"end";nodeA=this[prefixA+"Container"];offsetA=this[prefixA+"Offset"];nodeB=range[prefixB+"Container"];offsetB=range[prefixB+"Offset"];return dom.comparePoints(nodeA,offsetA,nodeB,offsetB);},insertNode:function(node){assertRangeValid(this);assertValidNodeType(node,insertableNodeTypes);assertNodeNotReadOnly(this.startContainer);if(dom.isAncestorOf(node,this.startContainer,true)){throw new DOMException("HIERARCHY_REQUEST_ERR");}
var firstNodeInserted=insertNodeAtPosition(node,this.startContainer,this.startOffset);this.setStartBefore(firstNodeInserted);},cloneContents:function(){assertRangeValid(this);var clone,frag;if(this.collapsed){return getRangeDocument(this).createDocumentFragment();}else{if(this.startContainer===this.endContainer&&dom.isCharacterDataNode(this.startContainer)){clone=this.startContainer.cloneNode(true);clone.data=clone.data.slice(this.startOffset,this.endOffset);frag=getRangeDocument(this).createDocumentFragment();frag.appendChild(clone);return frag;}else{var iterator=new RangeIterator(this,true);clone=cloneSubtree(iterator);iterator.detach();}
return clone;}},canSurroundContents:function(){assertRangeValid(this);assertNodeNotReadOnly(this.startContainer);assertNodeNotReadOnly(this.endContainer);var iterator=new RangeIterator(this,true);var boundariesInvalid=(iterator._first&&(isNonTextPartiallySelected(iterator._first,this))||(iterator._last&&isNonTextPartiallySelected(iterator._last,this)));iterator.detach();return!boundariesInvalid;},surroundContents:function(node){assertValidNodeType(node,surroundNodeTypes);if(!this.canSurroundContents()){throw new RangeException("BAD_BOUNDARYPOINTS_ERR");}
var content=this.extractContents();if(node.hasChildNodes()){while(node.lastChild){node.removeChild(node.lastChild);}}
insertNodeAtPosition(node,this.startContainer,this.startOffset);node.appendChild(content);this.selectNode(node);},cloneRange:function(){assertRangeValid(this);var range=new Range(getRangeDocument(this));var i=rangeProperties.length,prop;while(i--){prop=rangeProperties[i];range[prop]=this[prop];}
return range;},toString:function(){assertRangeValid(this);var sc=this.startContainer;if(sc===this.endContainer&&dom.isCharacterDataNode(sc)){return(sc.nodeType==3||sc.nodeType==4)?sc.data.slice(this.startOffset,this.endOffset):"";}else{var textBits=[],iterator=new RangeIterator(this,true);iterateSubtree(iterator,function(node){if(node.nodeType==3||node.nodeType==4){textBits.push(node.data);}});iterator.detach();return textBits.join("");}},compareNode:function(node){assertRangeValid(this);var parent=node.parentNode;var nodeIndex=dom.getNodeIndex(node);if(!parent){throw new DOMException("NOT_FOUND_ERR");}
var startComparison=this.comparePoint(parent,nodeIndex),endComparison=this.comparePoint(parent,nodeIndex+1);if(startComparison<0){return(endComparison>0)?n_b_a:n_b;}else{return(endComparison>0)?n_a:n_i;}},comparePoint:function(node,offset){assertRangeValid(this);assertNode(node,"HIERARCHY_REQUEST_ERR");assertSameDocumentOrFragment(node,this.startContainer);if(dom.comparePoints(node,offset,this.startContainer,this.startOffset)<0){return-1;}else if(dom.comparePoints(node,offset,this.endContainer,this.endOffset)>0){return 1;}
return 0;},createContextualFragment:createContextualFragment,toHtml:function(){assertRangeValid(this);var container=getRangeDocument(this).createElement("div");container.appendChild(this.cloneContents());return container.innerHTML;},intersectsNode:function(node,touchingIsIntersecting){assertRangeValid(this);assertNode(node,"NOT_FOUND_ERR");if(dom.getDocument(node)!==getRangeDocument(this)){return false;}
var parent=node.parentNode,offset=dom.getNodeIndex(node);assertNode(parent,"NOT_FOUND_ERR");var startComparison=dom.comparePoints(parent,offset,this.endContainer,this.endOffset),endComparison=dom.comparePoints(parent,offset+1,this.startContainer,this.startOffset);return touchingIsIntersecting?startComparison<=0&&endComparison>=0:startComparison<0&&endComparison>0;},isPointInRange:function(node,offset){assertRangeValid(this);assertNode(node,"HIERARCHY_REQUEST_ERR");assertSameDocumentOrFragment(node,this.startContainer);return(dom.comparePoints(node,offset,this.startContainer,this.startOffset)>=0)&&(dom.comparePoints(node,offset,this.endContainer,this.endOffset)<=0);},intersectsRange:function(range,touchingIsIntersecting){assertRangeValid(this);if(getRangeDocument(range)!=getRangeDocument(this)){throw new DOMException("WRONG_DOCUMENT_ERR");}
var startComparison=dom.comparePoints(this.startContainer,this.startOffset,range.endContainer,range.endOffset),endComparison=dom.comparePoints(this.endContainer,this.endOffset,range.startContainer,range.startOffset);return touchingIsIntersecting?startComparison<=0&&endComparison>=0:startComparison<0&&endComparison>0;},intersection:function(range){if(this.intersectsRange(range)){var startComparison=dom.comparePoints(this.startContainer,this.startOffset,range.startContainer,range.startOffset),endComparison=dom.comparePoints(this.endContainer,this.endOffset,range.endContainer,range.endOffset);var intersectionRange=this.cloneRange();if(startComparison==-1){intersectionRange.setStart(range.startContainer,range.startOffset);}
if(endComparison==1){intersectionRange.setEnd(range.endContainer,range.endOffset);}
return intersectionRange;}
return null;},union:function(range){if(this.intersectsRange(range,true)){var unionRange=this.cloneRange();if(dom.comparePoints(range.startContainer,range.startOffset,this.startContainer,this.startOffset)==-1){unionRange.setStart(range.startContainer,range.startOffset);}
if(dom.comparePoints(range.endContainer,range.endOffset,this.endContainer,this.endOffset)==1){unionRange.setEnd(range.endContainer,range.endOffset);}
return unionRange;}else{throw new RangeException("Ranges do not intersect");}},containsNode:function(node,allowPartial){if(allowPartial){return this.intersectsNode(node,false);}else{return this.compareNode(node)==n_i;}},containsNodeContents:function(node){return this.comparePoint(node,0)>=0&&this.comparePoint(node,dom.getNodeLength(node))<=0;},containsRange:function(range){return this.intersection(range).equals(range);},containsNodeText:function(node){var nodeRange=this.cloneRange();nodeRange.selectNode(node);var textNodes=nodeRange.getNodes([3]);if(textNodes.length>0){nodeRange.setStart(textNodes[0],0);var lastTextNode=textNodes.pop();nodeRange.setEnd(lastTextNode,lastTextNode.length);var contains=this.containsRange(nodeRange);nodeRange.detach();return contains;}else{return this.containsNodeContents(node);}},createNodeIterator:function(nodeTypes,filter){assertRangeValid(this);return new RangeNodeIterator(this,nodeTypes,filter);},getNodes:function(nodeTypes,filter){assertRangeValid(this);return getNodesInRange(this,nodeTypes,filter);},getDocument:function(){return getRangeDocument(this);},collapseBefore:function(node){assertNotDetached(this);this.setEndBefore(node);this.collapse(false);},collapseAfter:function(node){assertNotDetached(this);this.setStartAfter(node);this.collapse(true);},getName:function(){return"DomRange";},equals:function(range){return Range.rangesEqual(this,range);},inspect:function(){return inspect(this);}};function copyComparisonConstantsToObject(obj){obj.START_TO_START=s2s;obj.START_TO_END=s2e;obj.END_TO_END=e2e;obj.END_TO_START=e2s;obj.NODE_BEFORE=n_b;obj.NODE_AFTER=n_a;obj.NODE_BEFORE_AND_AFTER=n_b_a;obj.NODE_INSIDE=n_i;}
function copyComparisonConstants(constructor){copyComparisonConstantsToObject(constructor);copyComparisonConstantsToObject(constructor.prototype);}
function createRangeContentRemover(remover,boundaryUpdater){return function(){assertRangeValid(this);var sc=this.startContainer,so=this.startOffset,root=this.commonAncestorContainer;var iterator=new RangeIterator(this,true);var node,boundary;if(sc!==root){node=dom.getClosestAncestorIn(sc,root,true);boundary=getBoundaryAfterNode(node);sc=boundary.node;so=boundary.offset;}
iterateSubtree(iterator,assertNodeNotReadOnly);iterator.reset();var returnValue=remover(iterator);iterator.detach();boundaryUpdater(this,sc,so,sc,so);return returnValue;};}
function createPrototypeRange(constructor,boundaryUpdater,detacher){function createBeforeAfterNodeSetter(isBefore,isStart){return function(node){assertNotDetached(this);assertValidNodeType(node,beforeAfterNodeTypes);assertValidNodeType(getRootContainer(node),rootContainerNodeTypes);var boundary=(isBefore?getBoundaryBeforeNode:getBoundaryAfterNode)(node);(isStart?setRangeStart:setRangeEnd)(this,boundary.node,boundary.offset);};}
function setRangeStart(range,node,offset){var ec=range.endContainer,eo=range.endOffset;if(node!==range.startContainer||offset!==this.startOffset){if(getRootContainer(node)!=getRootContainer(ec)||dom.comparePoints(node,offset,ec,eo)==1){ec=node;eo=offset;}
boundaryUpdater(range,node,offset,ec,eo);}}
function setRangeEnd(range,node,offset){var sc=range.startContainer,so=range.startOffset;if(node!==range.endContainer||offset!==this.endOffset){if(getRootContainer(node)!=getRootContainer(sc)||dom.comparePoints(node,offset,sc,so)==-1){sc=node;so=offset;}
boundaryUpdater(range,sc,so,node,offset);}}
function setRangeStartAndEnd(range,node,offset){if(node!==range.startContainer||offset!==this.startOffset||node!==range.endContainer||offset!==this.endOffset){boundaryUpdater(range,node,offset,node,offset);}}
constructor.prototype=new RangePrototype();api.util.extend(constructor.prototype,{setStart:function(node,offset){assertNotDetached(this);assertNoDocTypeNotationEntityAncestor(node,true);assertValidOffset(node,offset);setRangeStart(this,node,offset);},setEnd:function(node,offset){assertNotDetached(this);assertNoDocTypeNotationEntityAncestor(node,true);assertValidOffset(node,offset);setRangeEnd(this,node,offset);},setStartBefore:createBeforeAfterNodeSetter(true,true),setStartAfter:createBeforeAfterNodeSetter(false,true),setEndBefore:createBeforeAfterNodeSetter(true,false),setEndAfter:createBeforeAfterNodeSetter(false,false),collapse:function(isStart){assertRangeValid(this);if(isStart){boundaryUpdater(this,this.startContainer,this.startOffset,this.startContainer,this.startOffset);}else{boundaryUpdater(this,this.endContainer,this.endOffset,this.endContainer,this.endOffset);}},selectNodeContents:function(node){assertNotDetached(this);assertNoDocTypeNotationEntityAncestor(node,true);boundaryUpdater(this,node,0,node,dom.getNodeLength(node));},selectNode:function(node){assertNotDetached(this);assertNoDocTypeNotationEntityAncestor(node,false);assertValidNodeType(node,beforeAfterNodeTypes);var start=getBoundaryBeforeNode(node),end=getBoundaryAfterNode(node);boundaryUpdater(this,start.node,start.offset,end.node,end.offset);},extractContents:createRangeContentRemover(extractSubtree,boundaryUpdater),deleteContents:createRangeContentRemover(deleteSubtree,boundaryUpdater),canSurroundContents:function(){assertRangeValid(this);assertNodeNotReadOnly(this.startContainer);assertNodeNotReadOnly(this.endContainer);var iterator=new RangeIterator(this,true);var boundariesInvalid=(iterator._first&&(isNonTextPartiallySelected(iterator._first,this))||(iterator._last&&isNonTextPartiallySelected(iterator._last,this)));iterator.detach();return!boundariesInvalid;},detach:function(){detacher(this);},splitBoundaries:function(){assertRangeValid(this);var sc=this.startContainer,so=this.startOffset,ec=this.endContainer,eo=this.endOffset;var startEndSame=(sc===ec);if(dom.isCharacterDataNode(ec)&&eo>0&&eo<ec.length){dom.splitDataNode(ec,eo);}
if(dom.isCharacterDataNode(sc)&&so>0&&so<sc.length){sc=dom.splitDataNode(sc,so);if(startEndSame){eo-=so;ec=sc;}else if(ec==sc.parentNode&&eo>=dom.getNodeIndex(sc)){eo++;}
so=0;}
boundaryUpdater(this,sc,so,ec,eo);},normalizeBoundaries:function(){assertRangeValid(this);var sc=this.startContainer,so=this.startOffset,ec=this.endContainer,eo=this.endOffset;var mergeForward=function(node){var sibling=node.nextSibling;if(sibling&&sibling.nodeType==node.nodeType){ec=node;eo=node.length;node.appendData(sibling.data);sibling.parentNode.removeChild(sibling);}};var mergeBackward=function(node){var sibling=node.previousSibling;if(sibling&&sibling.nodeType==node.nodeType){sc=node;var nodeLength=node.length;so=sibling.length;node.insertData(0,sibling.data);sibling.parentNode.removeChild(sibling);if(sc==ec){eo+=so;ec=sc;}else if(ec==node.parentNode){var nodeIndex=dom.getNodeIndex(node);if(eo==nodeIndex){ec=node;eo=nodeLength;}else if(eo>nodeIndex){eo--;}}}};var normalizeStart=true;if(dom.isCharacterDataNode(ec)){if(ec.length==eo){mergeForward(ec);}}else{if(eo>0){var endNode=ec.childNodes[eo-1];if(endNode&&dom.isCharacterDataNode(endNode)){mergeForward(endNode);}}
normalizeStart=!this.collapsed;}
if(normalizeStart){if(dom.isCharacterDataNode(sc)){if(so==0){mergeBackward(sc);}}else{if(so<sc.childNodes.length){var startNode=sc.childNodes[so];if(startNode&&dom.isCharacterDataNode(startNode)){mergeBackward(startNode);}}}}else{sc=ec;so=eo;}
boundaryUpdater(this,sc,so,ec,eo);},collapseToPoint:function(node,offset){assertNotDetached(this);assertNoDocTypeNotationEntityAncestor(node,true);assertValidOffset(node,offset);setRangeStartAndEnd(this,node,offset);}});copyComparisonConstants(constructor);}
function updateCollapsedAndCommonAncestor(range){range.collapsed=(range.startContainer===range.endContainer&&range.startOffset===range.endOffset);range.commonAncestorContainer=range.collapsed?range.startContainer:dom.getCommonAncestor(range.startContainer,range.endContainer);}
function updateBoundaries(range,startContainer,startOffset,endContainer,endOffset){var startMoved=(range.startContainer!==startContainer||range.startOffset!==startOffset);var endMoved=(range.endContainer!==endContainer||range.endOffset!==endOffset);range.startContainer=startContainer;range.startOffset=startOffset;range.endContainer=endContainer;range.endOffset=endOffset;updateCollapsedAndCommonAncestor(range);dispatchEvent(range,"boundarychange",{startMoved:startMoved,endMoved:endMoved});}
function detach(range){assertNotDetached(range);range.startContainer=range.startOffset=range.endContainer=range.endOffset=null;range.collapsed=range.commonAncestorContainer=null;dispatchEvent(range,"detach",null);range._listeners=null;}
function Range(doc){this.startContainer=doc;this.startOffset=0;this.endContainer=doc;this.endOffset=0;this._listeners={boundarychange:[],detach:[]};updateCollapsedAndCommonAncestor(this);}
createPrototypeRange(Range,updateBoundaries,detach);api.rangePrototype=RangePrototype.prototype;Range.rangeProperties=rangeProperties;Range.RangeIterator=RangeIterator;Range.copyComparisonConstants=copyComparisonConstants;Range.createPrototypeRange=createPrototypeRange;Range.inspect=inspect;Range.getRangeDocument=getRangeDocument;Range.rangesEqual=function(r1,r2){return r1.startContainer===r2.startContainer&&r1.startOffset===r2.startOffset&&r1.endContainer===r2.endContainer&&r1.endOffset===r2.endOffset;};api.DomRange=Range;api.RangeException=RangeException;});rangy.createModule("WrappedRange",function(api,module){api.requireModules(["DomUtil","DomRange"]);var WrappedRange;var dom=api.dom;var DomPosition=dom.DomPosition;var DomRange=api.DomRange;function getTextRangeContainerElement(textRange){var parentEl=textRange.parentElement();var range=textRange.duplicate();range.collapse(true);var startEl=range.parentElement();range=textRange.duplicate();range.collapse(false);var endEl=range.parentElement();var startEndContainer=(startEl==endEl)?startEl:dom.getCommonAncestor(startEl,endEl);return startEndContainer==parentEl?startEndContainer:dom.getCommonAncestor(parentEl,startEndContainer);}
function textRangeIsCollapsed(textRange){return textRange.compareEndPoints("StartToEnd",textRange)==0;}
function getTextRangeBoundaryPosition(textRange,wholeRangeContainerElement,isStart,isCollapsed){var workingRange=textRange.duplicate();workingRange.collapse(isStart);var containerElement=workingRange.parentElement();if(!dom.isAncestorOf(wholeRangeContainerElement,containerElement,true)){containerElement=wholeRangeContainerElement;}
if(!containerElement.canHaveHTML){return new DomPosition(containerElement.parentNode,dom.getNodeIndex(containerElement));}
var workingNode=dom.getDocument(containerElement).createElement("span");if(workingNode.parentNode){workingNode.parentNode.removeChild(workingNode);}
var comparison,workingComparisonType=isStart?"StartToStart":"StartToEnd";var previousNode,nextNode,boundaryPosition,boundaryNode;do{containerElement.insertBefore(workingNode,workingNode.previousSibling);workingRange.moveToElementText(workingNode);}while((comparison=workingRange.compareEndPoints(workingComparisonType,textRange))>0&&workingNode.previousSibling);boundaryNode=workingNode.nextSibling;if(comparison==-1&&boundaryNode&&dom.isCharacterDataNode(boundaryNode)){workingRange.setEndPoint(isStart?"EndToStart":"EndToEnd",textRange);var offset;if(/[\r\n]/.test(boundaryNode.data)){var tempRange=workingRange.duplicate();var rangeLength=tempRange.text.replace(/\r\n/g,"\r").length;offset=tempRange.moveStart("character",rangeLength);while((comparison=tempRange.compareEndPoints("StartToEnd",tempRange))==-1){offset++;tempRange.moveStart("character",1);}}else{var wrText=workingRange.text.replace(/\u00a0/g," ");var bnText=boundaryNode.data.replace(/\u00a0/g," ");if(bnText.indexOf(wrText)!==0){while(wrText.length>0&&bnText.indexOf(wrText)!==0){wrText=wrText.substr(1);}
offset=wrText.length;}else{offset=workingRange.text.length;}}
boundaryPosition=new DomPosition(boundaryNode,offset);}else{previousNode=(isCollapsed||!isStart)&&workingNode.previousSibling;nextNode=(isCollapsed||isStart)&&workingNode.nextSibling;if(nextNode&&dom.isCharacterDataNode(nextNode)){boundaryPosition=new DomPosition(nextNode,0);}else if(previousNode&&dom.isCharacterDataNode(previousNode)){boundaryPosition=new DomPosition(previousNode,previousNode.length);}else{boundaryPosition=new DomPosition(containerElement,dom.getNodeIndex(workingNode));}}
workingNode.parentNode.removeChild(workingNode);return boundaryPosition;}
function createBoundaryTextRange(boundaryPosition,isStart){var boundaryNode,boundaryParent,boundaryOffset=boundaryPosition.offset;var doc=dom.getDocument(boundaryPosition.node);var workingNode,childNodes,workingRange=doc.body.createTextRange();var nodeIsDataNode=dom.isCharacterDataNode(boundaryPosition.node);if(nodeIsDataNode){boundaryNode=boundaryPosition.node;boundaryParent=boundaryNode.parentNode;}else{childNodes=boundaryPosition.node.childNodes;boundaryNode=(boundaryOffset<childNodes.length)?childNodes[boundaryOffset]:null;boundaryParent=boundaryPosition.node;}
workingNode=doc.createElement("span");workingNode.innerHTML="&#feff;";if(boundaryNode){boundaryParent.insertBefore(workingNode,boundaryNode);}else{boundaryParent.appendChild(workingNode);}
try{workingRange.moveToElementText(workingNode);workingRange.collapse(!isStart);}catch(err){}
boundaryParent.removeChild(workingNode);if(nodeIsDataNode){workingRange[isStart?"moveStart":"moveEnd"]("character",boundaryOffset);}
return workingRange;}
if(api.features.implementsDomRange&&(!api.features.implementsTextRange||!api.config.preferTextRange)){(function(){var rangeProto;var rangeProperties=DomRange.rangeProperties;var canSetRangeStartAfterEnd;function updateRangeProperties(range){var i=rangeProperties.length,prop;while(i--){prop=rangeProperties[i];range[prop]=range.nativeRange[prop];}}
function updateNativeRange(range,startContainer,startOffset,endContainer,endOffset){var startMoved=(range.startContainer!==startContainer||range.startOffset!=startOffset);var endMoved=(range.endContainer!==endContainer||range.endOffset!=endOffset);if(startMoved||endMoved){range.setEnd(endContainer,endOffset);range.setStart(startContainer,startOffset);}}
function detach(range){range.nativeRange.detach();range.detached=true;var i=rangeProperties.length,prop;while(i--){prop=rangeProperties[i];range[prop]=null;}}
var createBeforeAfterNodeSetter;WrappedRange=function(range){if(!range){throw new Error("Range must be specified");}
this.nativeRange=range;updateRangeProperties(this);};DomRange.createPrototypeRange(WrappedRange,updateNativeRange,detach);rangeProto=WrappedRange.prototype;rangeProto.selectNode=function(node){this.nativeRange.selectNode(node);updateRangeProperties(this);};rangeProto.deleteContents=function(){this.nativeRange.deleteContents();updateRangeProperties(this);};rangeProto.extractContents=function(){var frag=this.nativeRange.extractContents();updateRangeProperties(this);return frag;};rangeProto.cloneContents=function(){return this.nativeRange.cloneContents();};rangeProto.surroundContents=function(node){this.nativeRange.surroundContents(node);updateRangeProperties(this);};rangeProto.collapse=function(isStart){this.nativeRange.collapse(isStart);updateRangeProperties(this);};rangeProto.cloneRange=function(){return new WrappedRange(this.nativeRange.cloneRange());};rangeProto.refresh=function(){updateRangeProperties(this);};rangeProto.toString=function(){return this.nativeRange.toString();};var testTextNode=document.createTextNode("test");dom.getBody(document).appendChild(testTextNode);var range=document.createRange();range.setStart(testTextNode,0);range.setEnd(testTextNode,0);try{range.setStart(testTextNode,1);canSetRangeStartAfterEnd=true;rangeProto.setStart=function(node,offset){this.nativeRange.setStart(node,offset);updateRangeProperties(this);};rangeProto.setEnd=function(node,offset){this.nativeRange.setEnd(node,offset);updateRangeProperties(this);};createBeforeAfterNodeSetter=function(name){return function(node){this.nativeRange[name](node);updateRangeProperties(this);};};}catch(ex){canSetRangeStartAfterEnd=false;rangeProto.setStart=function(node,offset){try{this.nativeRange.setStart(node,offset);}catch(ex){this.nativeRange.setEnd(node,offset);this.nativeRange.setStart(node,offset);}
updateRangeProperties(this);};rangeProto.setEnd=function(node,offset){try{this.nativeRange.setEnd(node,offset);}catch(ex){this.nativeRange.setStart(node,offset);this.nativeRange.setEnd(node,offset);}
updateRangeProperties(this);};createBeforeAfterNodeSetter=function(name,oppositeName){return function(node){try{this.nativeRange[name](node);}catch(ex){this.nativeRange[oppositeName](node);this.nativeRange[name](node);}
updateRangeProperties(this);};};}
rangeProto.setStartBefore=createBeforeAfterNodeSetter("setStartBefore","setEndBefore");rangeProto.setStartAfter=createBeforeAfterNodeSetter("setStartAfter","setEndAfter");rangeProto.setEndBefore=createBeforeAfterNodeSetter("setEndBefore","setStartBefore");rangeProto.setEndAfter=createBeforeAfterNodeSetter("setEndAfter","setStartAfter");range.selectNodeContents(testTextNode);if(range.startContainer==testTextNode&&range.endContainer==testTextNode&&range.startOffset==0&&range.endOffset==testTextNode.length){rangeProto.selectNodeContents=function(node){this.nativeRange.selectNodeContents(node);updateRangeProperties(this);};}else{rangeProto.selectNodeContents=function(node){this.setStart(node,0);this.setEnd(node,DomRange.getEndOffset(node));};}
range.selectNodeContents(testTextNode);range.setEnd(testTextNode,3);var range2=document.createRange();range2.selectNodeContents(testTextNode);range2.setEnd(testTextNode,4);range2.setStart(testTextNode,2);if(range.compareBoundaryPoints(range.START_TO_END,range2)==-1&range.compareBoundaryPoints(range.END_TO_START,range2)==1){rangeProto.compareBoundaryPoints=function(type,range){range=range.nativeRange||range;if(type==range.START_TO_END){type=range.END_TO_START;}else if(type==range.END_TO_START){type=range.START_TO_END;}
return this.nativeRange.compareBoundaryPoints(type,range);};}else{rangeProto.compareBoundaryPoints=function(type,range){return this.nativeRange.compareBoundaryPoints(type,range.nativeRange||range);};}
if(api.util.isHostMethod(range,"createContextualFragment")){rangeProto.createContextualFragment=function(fragmentStr){return this.nativeRange.createContextualFragment(fragmentStr);};}
dom.getBody(document).removeChild(testTextNode);range.detach();range2.detach();})();api.createNativeRange=function(doc){doc=doc||document;return doc.createRange();};}else if(api.features.implementsTextRange){WrappedRange=function(textRange){this.textRange=textRange;this.refresh();};WrappedRange.prototype=new DomRange(document);WrappedRange.prototype.refresh=function(){var start,end;var rangeContainerElement=getTextRangeContainerElement(this.textRange);if(textRangeIsCollapsed(this.textRange)){end=start=getTextRangeBoundaryPosition(this.textRange,rangeContainerElement,true,true);}else{start=getTextRangeBoundaryPosition(this.textRange,rangeContainerElement,true,false);end=getTextRangeBoundaryPosition(this.textRange,rangeContainerElement,false,false);}
this.setStart(start.node,start.offset);this.setEnd(end.node,end.offset);};DomRange.copyComparisonConstants(WrappedRange);var globalObj=(function(){return this;})();if(typeof globalObj.Range=="undefined"){globalObj.Range=WrappedRange;}
api.createNativeRange=function(doc){doc=doc||document;return doc.body.createTextRange();};}
if(api.features.implementsTextRange){WrappedRange.rangeToTextRange=function(range){if(range.collapsed){var tr=createBoundaryTextRange(new DomPosition(range.startContainer,range.startOffset),true);return tr;}else{var startRange=createBoundaryTextRange(new DomPosition(range.startContainer,range.startOffset),true);var endRange=createBoundaryTextRange(new DomPosition(range.endContainer,range.endOffset),false);var textRange=dom.getDocument(range.startContainer).body.createTextRange();textRange.setEndPoint("StartToStart",startRange);textRange.setEndPoint("EndToEnd",endRange);return textRange;}};}
WrappedRange.prototype.getName=function(){return"WrappedRange";};api.WrappedRange=WrappedRange;api.createRange=function(doc){doc=doc||document;return new WrappedRange(api.createNativeRange(doc));};api.createRangyRange=function(doc){doc=doc||document;return new DomRange(doc);};api.createIframeRange=function(iframeEl){return api.createRange(dom.getIframeDocument(iframeEl));};api.createIframeRangyRange=function(iframeEl){return api.createRangyRange(dom.getIframeDocument(iframeEl));};api.addCreateMissingNativeApiListener(function(win){var doc=win.document;if(typeof doc.createRange=="undefined"){doc.createRange=function(){return api.createRange(this);};}
doc=win=null;});});rangy.createModule("WrappedSelection",function(api,module){api.requireModules(["DomUtil","DomRange","WrappedRange"]);api.config.checkSelectionRanges=true;var BOOLEAN="boolean",windowPropertyName="_rangySelection",dom=api.dom,util=api.util,DomRange=api.DomRange,WrappedRange=api.WrappedRange,DOMException=api.DOMException,DomPosition=dom.DomPosition,getSelection,selectionIsCollapsed,CONTROL="Control";function getWinSelection(winParam){return(winParam||window).getSelection();}
function getDocSelection(winParam){return(winParam||window).document.selection;}
var implementsWinGetSelection=api.util.isHostMethod(window,"getSelection"),implementsDocSelection=api.util.isHostObject(document,"selection");var useDocumentSelection=implementsDocSelection&&(!implementsWinGetSelection||api.config.preferTextRange);if(useDocumentSelection){getSelection=getDocSelection;api.isSelectionValid=function(winParam){var doc=(winParam||window).document,nativeSel=doc.selection;return(nativeSel.type!="None"||dom.getDocument(nativeSel.createRange().parentElement())==doc);};}else if(implementsWinGetSelection){getSelection=getWinSelection;api.isSelectionValid=function(){return true;};}else{module.fail("Neither document.selection or window.getSelection() detected.");}
api.getNativeSelection=getSelection;var testSelection=getSelection();var testRange=api.createNativeRange(document);var body=dom.getBody(document);var selectionHasAnchorAndFocus=util.areHostObjects(testSelection,["anchorNode","focusNode"]&&util.areHostProperties(testSelection,["anchorOffset","focusOffset"]));api.features.selectionHasAnchorAndFocus=selectionHasAnchorAndFocus;var selectionHasExtend=util.isHostMethod(testSelection,"extend");api.features.selectionHasExtend=selectionHasExtend;var selectionHasRangeCount=(typeof testSelection.rangeCount=="number");api.features.selectionHasRangeCount=selectionHasRangeCount;var selectionSupportsMultipleRanges=false;var collapsedNonEditableSelectionsSupported=true;if(util.areHostMethods(testSelection,["addRange","getRangeAt","removeAllRanges"])&&typeof testSelection.rangeCount=="number"&&api.features.implementsDomRange){(function(){var iframe=document.createElement("iframe");body.appendChild(iframe);var iframeDoc=dom.getIframeDocument(iframe);iframeDoc.open();iframeDoc.write("<html><head></head><body>12</body></html>");iframeDoc.close();var sel=dom.getIframeWindow(iframe).getSelection();var docEl=iframeDoc.documentElement;var iframeBody=docEl.lastChild,textNode=iframeBody.firstChild;var r1=iframeDoc.createRange();r1.setStart(textNode,1);r1.collapse(true);sel.addRange(r1);collapsedNonEditableSelectionsSupported=(sel.rangeCount==1);sel.removeAllRanges();var r2=r1.cloneRange();r1.setStart(textNode,0);r2.setEnd(textNode,2);sel.addRange(r1);sel.addRange(r2);selectionSupportsMultipleRanges=(sel.rangeCount==2);r1.detach();r2.detach();body.removeChild(iframe);})();}
api.features.selectionSupportsMultipleRanges=selectionSupportsMultipleRanges;api.features.collapsedNonEditableSelectionsSupported=collapsedNonEditableSelectionsSupported;var implementsControlRange=false,testControlRange;if(body&&util.isHostMethod(body,"createControlRange")){testControlRange=body.createControlRange();if(util.areHostProperties(testControlRange,["item","add"])){implementsControlRange=true;}}
api.features.implementsControlRange=implementsControlRange;if(selectionHasAnchorAndFocus){selectionIsCollapsed=function(sel){return sel.anchorNode===sel.focusNode&&sel.anchorOffset===sel.focusOffset;};}else{selectionIsCollapsed=function(sel){return sel.rangeCount?sel.getRangeAt(sel.rangeCount-1).collapsed:false;};}
function updateAnchorAndFocusFromRange(sel,range,backwards){var anchorPrefix=backwards?"end":"start",focusPrefix=backwards?"start":"end";sel.anchorNode=range[anchorPrefix+"Container"];sel.anchorOffset=range[anchorPrefix+"Offset"];sel.focusNode=range[focusPrefix+"Container"];sel.focusOffset=range[focusPrefix+"Offset"];}
function updateAnchorAndFocusFromNativeSelection(sel){var nativeSel=sel.nativeSelection;sel.anchorNode=nativeSel.anchorNode;sel.anchorOffset=nativeSel.anchorOffset;sel.focusNode=nativeSel.focusNode;sel.focusOffset=nativeSel.focusOffset;}
function updateEmptySelection(sel){sel.anchorNode=sel.focusNode=null;sel.anchorOffset=sel.focusOffset=0;sel.rangeCount=0;sel.isCollapsed=true;sel._ranges.length=0;}
function getNativeRange(range){var nativeRange;if(range instanceof DomRange){nativeRange=range._selectionNativeRange;if(!nativeRange){nativeRange=api.createNativeRange(dom.getDocument(range.startContainer));nativeRange.setEnd(range.endContainer,range.endOffset);nativeRange.setStart(range.startContainer,range.startOffset);range._selectionNativeRange=nativeRange;range.attachListener("detach",function(){this._selectionNativeRange=null;});}}else if(range instanceof WrappedRange){nativeRange=range.nativeRange;}else if(api.features.implementsDomRange&&(range instanceof dom.getWindow(range.startContainer).Range)){nativeRange=range;}
return nativeRange;}
function rangeContainsSingleElement(rangeNodes){if(!rangeNodes.length||rangeNodes[0].nodeType!=1){return false;}
for(var i=1,len=rangeNodes.length;i<len;++i){if(!dom.isAncestorOf(rangeNodes[0],rangeNodes[i])){return false;}}
return true;}
function getSingleElementFromRange(range){var nodes=range.getNodes();if(!rangeContainsSingleElement(nodes)){throw new Error("getSingleElementFromRange: range "+range.inspect()+" did not consist of a single element");}
return nodes[0];}
function isTextRange(range){return!!range&&typeof range.text!="undefined";}
function updateFromTextRange(sel,range){var wrappedRange=new WrappedRange(range);sel._ranges=[wrappedRange];updateAnchorAndFocusFromRange(sel,wrappedRange,false);sel.rangeCount=1;sel.isCollapsed=wrappedRange.collapsed;}
function updateControlSelection(sel){sel._ranges.length=0;if(sel.docSelection.type=="None"){updateEmptySelection(sel);}else{var controlRange=sel.docSelection.createRange();if(isTextRange(controlRange)){updateFromTextRange(sel,controlRange);}else{sel.rangeCount=controlRange.length;var range,doc=dom.getDocument(controlRange.item(0));for(var i=0;i<sel.rangeCount;++i){range=api.createRange(doc);range.selectNode(controlRange.item(i));sel._ranges.push(range);}
sel.isCollapsed=sel.rangeCount==1&&sel._ranges[0].collapsed;updateAnchorAndFocusFromRange(sel,sel._ranges[sel.rangeCount-1],false);}}}
function addRangeToControlSelection(sel,range){var controlRange=sel.docSelection.createRange();var rangeElement=getSingleElementFromRange(range);var doc=dom.getDocument(controlRange.item(0));var newControlRange=dom.getBody(doc).createControlRange();for(var i=0,len=controlRange.length;i<len;++i){newControlRange.add(controlRange.item(i));}
try{newControlRange.add(rangeElement);}catch(ex){throw new Error("addRange(): Element within the specified Range could not be added to control selection (does it have layout?)");}
newControlRange.select();updateControlSelection(sel);}
var getSelectionRangeAt;if(util.isHostMethod(testSelection,"getRangeAt")){getSelectionRangeAt=function(sel,index){try{return sel.getRangeAt(index);}catch(ex){return null;}};}else if(selectionHasAnchorAndFocus){getSelectionRangeAt=function(sel){var doc=dom.getDocument(sel.anchorNode);var range=api.createRange(doc);range.setStart(sel.anchorNode,sel.anchorOffset);range.setEnd(sel.focusNode,sel.focusOffset);if(range.collapsed!==this.isCollapsed){range.setStart(sel.focusNode,sel.focusOffset);range.setEnd(sel.anchorNode,sel.anchorOffset);}
return range;};}
function WrappedSelection(selection,docSelection,win){this.nativeSelection=selection;this.docSelection=docSelection;this._ranges=[];this.win=win;this.refresh();}
api.getSelection=function(win){win=win||window;var sel=win[windowPropertyName];var nativeSel=getSelection(win),docSel=implementsDocSelection?getDocSelection(win):null;if(sel){sel.nativeSelection=nativeSel;sel.docSelection=docSel;sel.refresh(win);}else{sel=new WrappedSelection(nativeSel,docSel,win);win[windowPropertyName]=sel;}
return sel;};api.getIframeSelection=function(iframeEl){return api.getSelection(dom.getIframeWindow(iframeEl));};var selProto=WrappedSelection.prototype;function createControlSelection(sel,ranges){var doc=dom.getDocument(ranges[0].startContainer);var controlRange=dom.getBody(doc).createControlRange();for(var i=0,el;i<rangeCount;++i){el=getSingleElementFromRange(ranges[i]);try{controlRange.add(el);}catch(ex){throw new Error("setRanges(): Element within the one of the specified Ranges could not be added to control selection (does it have layout?)");}}
controlRange.select();updateControlSelection(sel);}
if(!useDocumentSelection&&selectionHasAnchorAndFocus&&util.areHostMethods(testSelection,["removeAllRanges","addRange"])){selProto.removeAllRanges=function(){this.nativeSelection.removeAllRanges();updateEmptySelection(this);};var addRangeBackwards=function(sel,range){var doc=DomRange.getRangeDocument(range);var endRange=api.createRange(doc);endRange.collapseToPoint(range.endContainer,range.endOffset);sel.nativeSelection.addRange(getNativeRange(endRange));sel.nativeSelection.extend(range.startContainer,range.startOffset);sel.refresh();};if(selectionHasRangeCount){selProto.addRange=function(range,backwards){if(implementsControlRange&&implementsDocSelection&&this.docSelection.type==CONTROL){addRangeToControlSelection(this,range);}else{if(backwards&&selectionHasExtend){addRangeBackwards(this,range);}else{var previousRangeCount;if(selectionSupportsMultipleRanges){previousRangeCount=this.rangeCount;}else{this.removeAllRanges();previousRangeCount=0;}
this.nativeSelection.addRange(getNativeRange(range));this.rangeCount=this.nativeSelection.rangeCount;if(this.rangeCount==previousRangeCount+1){if(api.config.checkSelectionRanges){var nativeRange=getSelectionRangeAt(this.nativeSelection,this.rangeCount-1);if(nativeRange&&!DomRange.rangesEqual(nativeRange,range)){range=new WrappedRange(nativeRange);}}
this._ranges[this.rangeCount-1]=range;updateAnchorAndFocusFromRange(this,range,selectionIsBackwards(this.nativeSelection));this.isCollapsed=selectionIsCollapsed(this);}else{this.refresh();}}}};}else{selProto.addRange=function(range,backwards){if(backwards&&selectionHasExtend){addRangeBackwards(this,range);}else{this.nativeSelection.addRange(getNativeRange(range));this.refresh();}};}
selProto.setRanges=function(ranges){if(implementsControlRange&&ranges.length>1){createControlSelection(this,ranges);}else{this.removeAllRanges();for(var i=0,len=ranges.length;i<len;++i){this.addRange(ranges[i]);}}};}else if(util.isHostMethod(testSelection,"empty")&&util.isHostMethod(testRange,"select")&&implementsControlRange&&useDocumentSelection){selProto.removeAllRanges=function(){try{var isNativeIE7=(jQuery.browser.msie&&jQuery.browser.version<8&&(typeof document.documentMode==='undefined'));if(!isNativeIE7){this.docSelection.empty();}
if(this.docSelection.type!="None"){if(isNativeIE7){this.docSelection.empty();}}}catch(ex){}
updateEmptySelection(this);};selProto.addRange=function(range){if(this.docSelection.type==CONTROL){addRangeToControlSelection(this,range);}else{try{WrappedRange.rangeToTextRange(range).select();this._ranges[0]=range;this.rangeCount=1;this.isCollapsed=this._ranges[0].collapsed;updateAnchorAndFocusFromRange(this,range,false);}catch(e){}}};selProto.setRanges=function(ranges){this.removeAllRanges();var rangeCount=ranges.length;if(rangeCount>1){createControlSelection(this,ranges);}else if(rangeCount){this.addRange(ranges[0]);}};}else{module.fail("No means of selecting a Range or TextRange was found");return false;}
selProto.getRangeAt=function(index){if(index<0||index>=this.rangeCount){throw new DOMException("INDEX_SIZE_ERR");}else{return this._ranges[index];}};var refreshSelection;if(useDocumentSelection){refreshSelection=function(sel){var range;if(api.isSelectionValid(sel.win)){range=sel.docSelection.createRange();}else{range=dom.getBody(sel.win.document).createTextRange();range.collapse(true);}
if(sel.docSelection.type==CONTROL){updateControlSelection(sel);}else if(isTextRange(range)){updateFromTextRange(sel,range);}else{updateEmptySelection(sel);}};}else if(util.isHostMethod(testSelection,"getRangeAt")&&typeof testSelection.rangeCount=="number"){refreshSelection=function(sel){if(implementsControlRange&&implementsDocSelection&&sel.docSelection.type==CONTROL){updateControlSelection(sel);}else{sel._ranges.length=sel.rangeCount=sel.nativeSelection.rangeCount;if(sel.rangeCount){for(var i=0,len=sel.rangeCount;i<len;++i){sel._ranges[i]=new api.WrappedRange(sel.nativeSelection.getRangeAt(i));}
updateAnchorAndFocusFromRange(sel,sel._ranges[sel.rangeCount-1],selectionIsBackwards(sel.nativeSelection));sel.isCollapsed=selectionIsCollapsed(sel);}else{updateEmptySelection(sel);}}};}else if(selectionHasAnchorAndFocus&&typeof testSelection.isCollapsed==BOOLEAN&&typeof testRange.collapsed==BOOLEAN&&api.features.implementsDomRange){refreshSelection=function(sel){var range,nativeSel=sel.nativeSelection;if(nativeSel.anchorNode){range=getSelectionRangeAt(nativeSel,0);sel._ranges=[range];sel.rangeCount=1;updateAnchorAndFocusFromNativeSelection(sel);sel.isCollapsed=selectionIsCollapsed(sel);}else{updateEmptySelection(sel);}};}else{module.fail("No means of obtaining a Range or TextRange from the user's selection was found");return false;}
selProto.refresh=function(checkForChanges){var oldRanges=checkForChanges?this._ranges.slice(0):null;refreshSelection(this);if(checkForChanges){var i=oldRanges.length;if(i!=this._ranges.length){return false;}
while(i--){if(!DomRange.rangesEqual(oldRanges[i],this._ranges[i])){return false;}}
return true;}};var removeRangeManually=function(sel,range){var ranges=sel.getAllRanges(),removed=false;sel.removeAllRanges();for(var i=0,len=ranges.length;i<len;++i){if(removed||range!==ranges[i]){sel.addRange(ranges[i]);}else{removed=true;}}
if(!sel.rangeCount){updateEmptySelection(sel);}};if(implementsControlRange){selProto.removeRange=function(range){if(this.docSelection.type==CONTROL){var controlRange=this.docSelection.createRange();var rangeElement=getSingleElementFromRange(range);var doc=dom.getDocument(controlRange.item(0));var newControlRange=dom.getBody(doc).createControlRange();var el,removed=false;for(var i=0,len=controlRange.length;i<len;++i){el=controlRange.item(i);if(el!==rangeElement||removed){newControlRange.add(controlRange.item(i));}else{removed=true;}}
newControlRange.select();updateControlSelection(this);}else{removeRangeManually(this,range);}};}else{selProto.removeRange=function(range){removeRangeManually(this,range);};}
var selectionIsBackwards;if(!useDocumentSelection&&selectionHasAnchorAndFocus&&api.features.implementsDomRange){selectionIsBackwards=function(sel){var backwards=false;if(sel.anchorNode){backwards=(dom.comparePoints(sel.anchorNode,sel.anchorOffset,sel.focusNode,sel.focusOffset)==1);}
return backwards;};selProto.isBackwards=function(){return selectionIsBackwards(this);};}else{selectionIsBackwards=selProto.isBackwards=function(){return false;};}
selProto.toString=function(){var rangeTexts=[];for(var i=0,len=this.rangeCount;i<len;++i){rangeTexts[i]=""+this._ranges[i];}
return rangeTexts.join("");};function assertNodeInSameDocument(sel,node){if(sel.anchorNode&&(dom.getDocument(sel.anchorNode)!==dom.getDocument(node))){throw new DOMException("WRONG_DOCUMENT_ERR");}}
selProto.collapse=function(node,offset){assertNodeInSameDocument(this,node);var range=api.createRange(dom.getDocument(node));range.collapseToPoint(node,offset);this.removeAllRanges();this.addRange(range);this.isCollapsed=true;};selProto.collapseToStart=function(){if(this.rangeCount){var range=this._ranges[0];this.collapse(range.startContainer,range.startOffset);}else{throw new DOMException("INVALID_STATE_ERR");}};selProto.collapseToEnd=function(){if(this.rangeCount){var range=this._ranges[this.rangeCount-1];this.collapse(range.endContainer,range.endOffset);}else{throw new DOMException("INVALID_STATE_ERR");}};selProto.selectAllChildren=function(node){assertNodeInSameDocument(this,node);var range=api.createRange(dom.getDocument(node));range.selectNodeContents(node);this.removeAllRanges();this.addRange(range);};selProto.deleteFromDocument=function(){if(implementsControlRange&&implementsDocSelection&&this.docSelection.type==CONTROL){var controlRange=this.docSelection.createRange();var element;while(controlRange.length){element=controlRange.item(0);controlRange.remove(element);element.parentNode.removeChild(element);}
this.refresh();}else if(this.rangeCount){var ranges=this.getAllRanges();this.removeAllRanges();for(var i=0,len=ranges.length;i<len;++i){ranges[i].deleteContents();}
this.addRange(ranges[len-1]);}};selProto.getAllRanges=function(){return this._ranges.slice(0);};selProto.setSingleRange=function(range){this.setRanges([range]);};selProto.containsNode=function(node,allowPartial){for(var i=0,len=this._ranges.length;i<len;++i){if(this._ranges[i].containsNode(node,allowPartial)){return true;}}
return false;};selProto.toHtml=function(){var html="";if(this.rangeCount){var container=DomRange.getRangeDocument(this._ranges[0]).createElement("div");for(var i=0,len=this._ranges.length;i<len;++i){container.appendChild(this._ranges[i].cloneContents());}
html=container.innerHTML;}
return html;};function inspect(sel){var rangeInspects=[];var anchor=new DomPosition(sel.anchorNode,sel.anchorOffset);var focus=new DomPosition(sel.focusNode,sel.focusOffset);var name=(typeof sel.getName=="function")?sel.getName():"Selection";if(typeof sel.rangeCount!="undefined"){for(var i=0,len=sel.rangeCount;i<len;++i){rangeInspects[i]=DomRange.inspect(sel.getRangeAt(i));}}
return"["+name+"(Ranges: "+rangeInspects.join(", ")+")(anchor: "+anchor.inspect()+", focus: "+focus.inspect()+"]";}
selProto.getName=function(){return"WrappedSelection";};selProto.inspect=function(){return inspect(this);};selProto.detach=function(){this.win[windowPropertyName]=null;this.win=this.anchorNode=this.focusNode=null;};WrappedSelection.inspect=inspect;api.Selection=WrappedSelection;api.selectionPrototype=selProto;api.addCreateMissingNativeApiListener(function(win){if(typeof win.getSelection=="undefined"){win.getSelection=function(){return api.getSelection(this);};}
win=null;});});window.rangy=rangy;}());define("vendor/rangy-core",function(){});define('aloha/rangy-core',['jquery','vendor/rangy-core'],function(jQuery){return window.rangy;});define('util/class',[],function(){var initializing=false,fnTest=/xyz/.test(function(){xyz;})?/\b_super\b/:/.*/;this.Class=function(){};Class.extend=function(){var _super=this.prototype;initializing=true;var prototype=new this();initializing=false;for(var i=0;i<arguments.length;i++){var prop=arguments[i];for(var name in prop){prototype[name]=typeof prop[name]=="function"&&typeof _super[name]=="function"&&fnTest.test(prop[name])?(function(name,fn){return function(){var tmp=this._super;this._super=_super[name];var ret=fn.apply(this,arguments);this._super=tmp;return ret;};})(name,prop[name]):prop[name];}}
function Class(){if(!initializing&&this._constructor)this._constructor.apply(this,arguments);}
Class.prototype=prototype;Class.constructor=Class;Class.extend=arguments.callee;return Class;};return this.Class;});window.GENTICS=window.GENTICS||{};window.GENTICS.Utils=window.GENTICS.Utils||{};define('util/lang',[],function(){});(function(window,undefined){var jQuery=window.alohaQuery||window.jQuery,$=jQuery,GENTICS=window.GENTICS,Class=window.Class,console=window.console;GENTICS.Utils.applyProperties=function(target,properties){var name;for(name in properties){if(properties.hasOwnProperty(name)){target[name]=properties[name];}}};GENTICS.Utils.uniqeString4=function(){return(((1+Math.random())*0x10000)|0).toString(16).substring(1);};GENTICS.Utils.guid=function(){var S4=GENTICS.Utils.uniqeString4;return(S4()+S4()+'-'+S4()+'-'+S4()+'-'+S4()+'-'+S4()+S4()+S4());};}(window));define('aloha/ecma5shims',[],function(){var $_;var shims={bind:function(owner){var obj=this.obj||this;var native_method=Function.prototype.bind;var args=Array.prototype.slice.call(arguments,1);if(native_method){return native_method.apply(obj,arguments);}
return function(){return obj.apply(owner,arguments.length===0?args:args.concat(Array.prototype.slice.call(arguments)));};},trim:function(){var obj=this.obj||this;var native_method=String.prototype.trim;if(native_method){return native_method.call(obj);}
return obj.replace(/^\s+/,'').replace(/\s+$/,'');},indexOf:function(find,i){var obj=this.obj||this;var native_method=Array.prototype.indexOf;if(native_method){return native_method.call(obj,find,i);}
if(i===undefined){i=0;}
if(i<0){i+=obj.length;}
if(i<0){i=0;}
var n;for(n=obj.length;i<n;i++){if(undefined!==obj[i]&&obj[i]===find){return i;}}
return-1;},forEach:function(action,that){var obj=this.obj||this;var native_method=Array.prototype.forEach;if(native_method){return native_method.call(obj,action,that);}
var i,n;for(i=0,n=obj.length;i<n;i++){if(undefined!==obj[i]){action.call(that,obj[i],i,obj);}}},map:function(mapper,that,chain){var obj=this.obj||this;var native_method=Array.prototype.map;var returnWrapper=(typeof arguments[arguments.length-1]=="boolean")?Array.prototype.pop.call(arguments):false;var result=[];if(native_method){result=native_method.call(obj,mapper,that);}else{var other=[];var i,n;for(i=0,n=obj.length;i<n;i++){if(undefined!==obj[i]){other[i]=mapper.call(that,obj[i],i,obj);}}
result=other;}
return returnWrapper?$_(result):result;},filter:function(filterFunc,that,chain){var obj=this.obj||this;var native_method=Array.prototype.filter;var returnWrapper=(typeof arguments[arguments.length-1]=="boolean")?Array.prototype.pop.call(arguments):false;var result=[];if(native_method){result=native_method.call(obj,filterFunc,that);}else{var other=[],v,i,n;for(i=0,n=obj.length;i<n;i++){if(undefined!==obj[i]&&filterFunc.call(that,v=obj[i],i,obj)){other.push(v);}}
result=other;}
return returnWrapper?$_(result):result;},every:function(tester,that){var obj=this.obj||this;var native_method=Array.prototype.every;if(native_method){return native_method.call(obj,tester,that);}
var i,n;for(i=0,n=obj.length;i<n;i++){if(undefined!==obj[i]&&!tester.call(that,obj[i],i,obj)){return false;}}
return true;},some:function(tester,that){var obj=this.obj||this;var native_method=Array.prototype.some;if(native_method){return native_method.call(obj,tester,that);}
var i,n;for(i=0,n=obj.length;i<n;i++){if(undefined!==obj[i]&&tester.call(that,obj[i],i,obj)){return true;}}
return false;},hasAttribute:function(attr){var obj=this.obj||this;var native_method=obj.hasAttribute;if(native_method){return obj.hasAttribute(attr);}
return!!obj.getAttribute(attr);}};$_=function(obj){var Wrapper=function(){};Wrapper.prototype=shims;var wrapper_instance=new Wrapper();wrapper_instance.obj=obj;return wrapper_instance;};var shim;for(shim in shims){if(shims.hasOwnProperty(shim)){$_[shim]=shims[shim];}}
if(typeof window.Node!='undefined'){$_.Node=window.Node;}else{$_.Node={'ELEMENT_NODE':1,'ATTRIBUTE_NODE':2,'TEXT_NODE':3,'CDATA_SECTION_NODE':4,'ENTITY_REFERENCE_NODE':5,'ENTITY_NODE':6,'PROCESSING_INSTRUCTION_NODE':7,'COMMENT_NODE':8,'DOCUMENT_NODE':9,'DOCUMENT_TYPE_NODE':10,'DOCUMENT_FRAGMENT_NODE':11,'NOTATION_NODE':12,'DOCUMENT_POSITION_DISCONNECTED':0x01,'DOCUMENT_POSITION_PRECEDING':0x02,'DOCUMENT_POSITION_FOLLOWING':0x04,'DOCUMENT_POSITION_CONTAINS':0x08,'DOCUMENT_POSITION_CONTAINED_BY':0x10,'DOCUMENT_POSITION_IMPLEMENTATION_SPECIFIC':0x20};}
function getRootParent(node){var parent=null;if(node){do{parent=node;}while(null!=(node=node.parentNode));}
return parent;}
function comparePosition(node1,node2){return(node1.contains(node2)&&16)+(node2.contains(node1)&&8)+(node1.sourceIndex>=0&&node2.sourceIndex>=0?(node1.sourceIndex<node2.sourceIndex&&4)+(node1.sourceIndex>node2.sourceIndex&&2):1);}
function getUseNode(node){if(null!=node.sourceIndex){return node;}
return node.parentNode.insertBefore(document.createComment(""),node);}
$_.compareDocumentPosition=function(node1,node2){if(document.documentElement.compareDocumentPosition){return node1.compareDocumentPosition(node2);}
if(!document.documentElement.contains){throw'neither compareDocumentPosition nor contains is supported by this browser.';}
if(node1==node2){return 0;}
if(getRootParent(node1)!=getRootParent(node2)){return 1;}
if(null!=node1.sourceIndex&&null!=node2.sourceIndex){return comparePosition(node1,node2);}
if(node1==document){return 20;}
if(node2==document){return 10;}
var useNode1=getUseNode(node1),useNode2=getUseNode(node2);var result=comparePosition(useNode1,useNode2);if(node1!=useNode1){useNode1.parentNode.removeChild(useNode1);}
if(node2!=useNode2){useNode2.parentNode.removeChild(useNode2);}
return result;};$_.getComputedStyle=function(node,style){if(window.getComputedStyle){return window.getComputedStyle(node,style);}
if(node.currentStyle){return node.currentStyle;}
return null;};return $_;});window.GENTICS=window.GENTICS||{};window.GENTICS.Utils=window.GENTICS.Utils||{};define('util/dom',['jquery','util/class','aloha/ecma5shims'],function(jQuery,Class,$_){var GENTICS=window.GENTICS,Node={'ELEMENT_NODE':1,'ATTRIBUTE_NODE':2,'TEXT_NODE':3,'CDATA_SECTION_NODE':4,'ENTITY_REFERENCE_NODE':5,'ENTITY_NODE':6,'PROCESSING_INSTRUCTION_NODE':7,'COMMENT_NODE':8,'DOCUMENT_NODE':9,'DOCUMENT_TYPE_NODE':10,'DOCUMENT_FRAGMENT_NODE':11,'NOTATION_NODE':12,'DOCUMENT_POSITION_DISCONNECTED':0x01,'DOCUMENT_POSITION_PRECEDING':0x02,'DOCUMENT_POSITION_FOLLOWING':0x04,'DOCUMENT_POSITION_CONTAINS':0x08,'DOCUMENT_POSITION_CONTAINED_BY':0x10,'DOCUMENT_POSITION_IMPLEMENTATION_SPECIFIC':0x20},blockElementNames={'P':true,'H1':true,'H2':true,'H3':true,'H4':true,'H5':true,'H6':true,'LI':true};var Dom=Class.extend({wordRegex:/[\u0041-\u005A\u0061-\u007A\u00AA\u00B5\u00BA\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u0525\u0531-\u0556\u0559\u0561-\u0587\u05D0-\u05EA\u05F0-\u05F2\u0621-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971\u0972\u0979-\u097F\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C33\u0C35-\u0C39\u0C3D\u0C58\u0C59\u0C60\u0C61\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D28\u0D2A-\u0D39\u0D3D\u0D60\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC\u0EDD\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8B\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10D0-\u10FA\u10FC\u1100-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F4\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1877\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191C\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19C1-\u19C7\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1CE9-\u1CEC\u1CEE-\u1CF1\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u2094\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2183\u2184\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2D00-\u2D25\u2D30-\u2D65\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005\u3006\u3031-\u3035\u303B\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31B7\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FCB\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA65F\uA662-\uA66E\uA67F-\uA697\uA6A0-\uA6E5\uA717-\uA71F\uA722-\uA788\uA78B\uA78C\uA7FB-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA80-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uABC0-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA2D\uFA30-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]/,nonWordRegex:/[^\u0041-\u005A\u0061-\u007A\u00AA\u00B5\u00BA\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u0525\u0531-\u0556\u0559\u0561-\u0587\u05D0-\u05EA\u05F0-\u05F2\u0621-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971\u0972\u0979-\u097F\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C33\u0C35-\u0C39\u0C3D\u0C58\u0C59\u0C60\u0C61\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D28\u0D2A-\u0D39\u0D3D\u0D60\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC\u0EDD\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8B\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10D0-\u10FA\u10FC\u1100-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F4\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1877\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191C\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19C1-\u19C7\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1CE9-\u1CEC\u1CEE-\u1CF1\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u2094\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2183\u2184\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2D00-\u2D25\u2D30-\u2D65\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005\u3006\u3031-\u3035\u303B\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31B7\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FCB\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA65F\uA662-\uA66E\uA67F-\uA697\uA6A0-\uA6E5\uA717-\uA71F\uA722-\uA788\uA78B\uA78C\uA7FB-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA80-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uABC0-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA2D\uFA30-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]/,mergeableTags:['b','code','del','em','i','ins','strong','sub','sup','#text'],nonWordBoundaryTags:['a','b','code','del','em','i','ins','span','strong','sub','sup','#text'],nonEmptyTags:['br'],tags:{'flow':['a','abbr','address','area','article','aside','audio','b','bdi','bdo','blockquote','br','button','canvas','cite','code','command','datalist','del','details','dfn','div','dl','em','embed','fieldset','figure','footer','form','h1','h2','h3','h4','h5','h6','header','hgroup','hr','i','iframe','img','input','ins','kbd','keygen','label','map','mark','math','menu','meter','nav','noscript','object','ol','output','p','pre','progress','q','ruby','s','samp','script','section','select','small','span','strong','style','sub','sup','svg','table','textarea','time','u','ul','var','video','wbr','#text'],'phrasing':['a','abbr','area','audio','b','bdi','bdo','br','button','canvas','cite','code','command','datalist','del','dfn','em','embed','i','iframe','img','input','ins','kbd','keygen','label','map','mark','math','meter','noscript','object','output','progress','q','ruby','samp','script','select','small','span','strong','sub','sup','svg','textarea','time','u','var','video','wbr','#text']},children:{'a':'phrasing','abbr':'phrasing','address':'flow','area':'empty','article':'flow','aside':'flow','audio':'source','b':'phrasing','base':'empty','bdo':'phrasing','blockquote':'phrasing','body':'flow','br':'empty','button':'phrasing','canvas':'phrasing','caption':'flow','cite':'phrasing','code':'phrasing','col':'empty','colgroup':'col','command':'empty','datalist':['phrasing','option'],'dd':'flow','del':'phrasing','div':'flow','details':['summary','flow'],'dfn':'flow','dl':['dt','dd'],'dt':'phrasing','em':'phrasing','embed':'empty','fieldset':['legend','flow'],'figcaption':'flow','figure':['figcaption','flow'],'footer':'flow','form':'flow','h1':'phrasing','h2':'phrasing','h3':'phrasing','h4':'phrasing','h5':'phrasing','h6':'phrasing','header':'flow','hgroup':['h1','h2','h3','h4','h5','h6'],'hr':'empty','i':'phrasing','iframe':'#text','img':'empty','input':'empty','ins':'phrasing','kbd':'phrasing','keygen':'empty','label':'phrasing','legend':'phrasing','li':'flow','link':'empty','map':'area','mark':'phrasing','menu':['li','flow'],'meta':'empty','meter':'phrasing','nav':'flow','noscript':'phrasing','object':'param','ol':'li','optgroup':'option','option':'#text','output':'phrasing','p':'phrasing','param':'empty','pre':'phrasing','progress':'phrasing','q':'phrasing','rp':'phrasing','rt':'phrasing','ruby':['phrasing','rt','rp'],'s':'phrasing','samp':'pharsing','script':'#script','section':'flow','select':['option','optgroup'],'small':'phrasing','source':'empty','span':'phrasing','strong':'phrasing','style':'phrasing','sub':'phrasing','summary':'phrasing','sup':'phrasing','table':['caption','colgroup','thead','tbody','tfoot','tr'],'tbody':'tr','td':'flow','textarea':'#text','tfoot':'tr','th':'phrasing','thead':'tr','time':'phrasing','title':'#text','tr':['th','td'],'track':'empty','u':'phrasing','ul':'li','var':'phrasing','video':'source','wbr':'empty'},blockLevelElements:['p','h1','h2','h3','h4','h5','h6','blockquote','div','pre'],listElements:['li','ol','ul'],split:function(range,limit,atEnd){var splitElement=jQuery(range.startContainer),splitPosition=range.startOffset,updateRange,path,parents,newDom,insertElement,secondPart,i,pathLength,element,jqelement,children,newElement,next,prev,offset;if(atEnd){splitElement=jQuery(range.endContainer);splitPosition=range.endOffset;}
if(limit.length<1){limit=jQuery(document.body);}
updateRange=(!range.isCollapsed()&&!atEnd);parents=splitElement.parents().get();parents.unshift(splitElement.get(0));jQuery.each(parents,function(index,element){var isLimit=limit.filter(function(){return this==element;}).length;if(isLimit){if(index>0){path=parents.slice(0,index);}
return false;}});if(!path){return true;}
path=path.reverse();for(i=0,pathLength=path.length;i<pathLength;++i){element=path[i];if(i===pathLength-1){if(element.nodeType===3){secondPart=document.createTextNode(element.data.substring(splitPosition,element.data.length));element.data=element.data.substring(0,splitPosition);}else{jqelement=jQuery(element);children=jqelement.contents();newElement=jqelement.clone(false).empty();secondPart=newElement.append(children.slice(splitPosition,children.length)).get(0);}
if(updateRange&&range.endContainer===element){range.endContainer=secondPart;range.endOffset-=splitPosition;range.clearCaches();}
if(insertElement){insertElement.prepend(secondPart);}else{jQuery(element).after(secondPart);}}else{newElement=jQuery(element).clone(false).empty();if(!newDom){newDom=newElement;}else{insertElement.prepend(newElement);}
insertElement=newElement;while(true){next=path[i+1].nextSibling;if(!next){break;}
insertElement.append(next);}
if(updateRange&&range.endContainer===element){range.endContainer=newElement.get(0);prev=path[i+1];offset=0;while(true){prev=prev.previousSibling;if(!prev){break;}
offset++;}
range.endOffset-=offset;range.clearCaches();}}}
jQuery(path[0]).after(newDom);return jQuery([path[0],newDom?newDom.get(0):secondPart]);},allowsNesting:function(outerDOMObject,innerDOMObject){if(!outerDOMObject||!outerDOMObject.nodeName||!innerDOMObject||!innerDOMObject.nodeName){return false;}
var outerNodeName=outerDOMObject.nodeName.toLowerCase(),innerNodeName=innerDOMObject.nodeName.toLowerCase();if(!this.children[outerNodeName]){return false;}
if(this.children[outerNodeName]==innerNodeName){return true;}
if(jQuery.isArray(this.children[outerNodeName])&&jQuery.inArray(innerNodeName,this.children[outerNodeName])>=0){return true;}
if(jQuery.isArray(this.tags[this.children[outerNodeName]])&&jQuery.inArray(innerNodeName,this.tags[this.children[outerNodeName]])>=0){return true;}
return false;},addMarkup:function(rangeObject,markup,nesting){if(rangeObject.startContainer.nodeType===3&&rangeObject.startOffset>0&&rangeObject.startOffset<rangeObject.startContainer.data.length){this.split(rangeObject,jQuery(rangeObject.startContainer).parent(),false);}
if(rangeObject.endContainer.nodeType===3&&rangeObject.endOffset>0&&rangeObject.endOffset<rangeObject.endContainer.data.length){this.split(rangeObject,jQuery(rangeObject.endContainer).parent(),true);}
var rangeTree=rangeObject.getRangeTree();this.recursiveAddMarkup(rangeTree,markup,rangeObject,nesting);this.doCleanup({'merge':true,'removeempty':true},rangeObject);},recursiveAddMarkup:function(rangeTree,markup,rangeObject,nesting){var i,innerRange,rangeLength;for(i=0,rangeLength=rangeTree.length;i<rangeLength;++i){if(rangeTree[i].type=='full'&&this.allowsNesting(markup.get(0),rangeTree[i].domobj)){if((nesting||rangeTree[i].domobj.nodeName!=markup.get(0).nodeName)&&(rangeTree[i].domobj.nodeType!==3||jQuery.trim(rangeTree[i].domobj.data).length!==0)){jQuery(rangeTree[i].domobj).wrap(markup);if(!nesting&&rangeTree[i].domobj.nodeType!==3){innerRange=new GENTICS.Utils.RangeObject();innerRange.startContainer=innerRange.endContainer=rangeTree[i].domobj.parentNode;innerRange.startOffset=0;innerRange.endOffset=innerRange.endContainer.childNodes.length;this.removeMarkup(innerRange,markup,jQuery(rangeTree[i].domobj.parentNode));}}}else{if((nesting||(rangeTree[i].domobj&&rangeTree[i].domobj.nodeName!==markup.get(0).nodeName))&&rangeTree[i].children&&rangeTree[i].children.length>0){this.recursiveAddMarkup(rangeTree[i].children,markup);}}}},findHighestElement:function(start,nodeName,limit){nodeName=nodeName.toLowerCase();var highestObject,testObject=start,isLimit=limit?function(){return limit.filter(function(){return testObject==this;}).length;}:function(){return false;};while(!isLimit()&&testObject){if(testObject.nodeName.toLowerCase()===nodeName){highestObject=testObject;}
testObject=testObject.parentNode;}
return highestObject;},removeMarkup:function(rangeObject,markup,limit){var nodeName=markup.get(0).nodeName,startSplitLimit=this.findHighestElement(rangeObject.startContainer,nodeName,limit),endSplitLimit=this.findHighestElement(rangeObject.endContainer,nodeName,limit),didSplit=false,highestObject,root,rangeTree;if(startSplitLimit&&rangeObject.startOffset>0){this.split(rangeObject,jQuery(startSplitLimit).parent(),false);didSplit=true;}
if(endSplitLimit){if(rangeObject.endContainer.nodeType===3&&rangeObject.endOffset<rangeObject.endContainer.data.length){this.split(rangeObject,jQuery(endSplitLimit).parent(),true);didSplit=true;}
if(rangeObject.endContainer.nodeType===1&&rangeObject.endOffset<rangeObject.endContainer.childNodes.length){this.split(rangeObject,jQuery(endSplitLimit).parent(),true);didSplit=true;}}
if(didSplit){rangeObject.correctRange();}
highestObject=this.findHighestElement(rangeObject.getCommonAncestorContainer(),nodeName,limit);root=highestObject?highestObject.parentNode:rangeObject.getCommonAncestorContainer();if(root){rangeTree=rangeObject.getRangeTree(root);this.recursiveRemoveMarkup(rangeTree,markup);this.doCleanup({'merge':true,'removeempty':true},rangeObject,root);}},recursiveRemoveMarkup:function(rangeTree,markup){var i,rangeLength,content;for(i=0,rangeLength=rangeTree.length;i<rangeLength;++i){if(rangeTree[i].type=='full'&&rangeTree[i].domobj.nodeName==markup.get(0).nodeName){content=jQuery(rangeTree[i].domobj).contents();if(content.length>0){content.first().unwrap();}else{jQuery(rangeTree[i].domobj).remove();}}
if(rangeTree[i].children){this.recursiveRemoveMarkup(rangeTree[i].children,markup);}}},doCleanup:function(cleanup,rangeObject,start){var that=this,prevNode,modifiedRange,startObject,startOffset,endOffset;if(typeof cleanup==='undefined'){cleanup={};}
if(typeof cleanup.merge==='undefined'){cleanup.merge=false;}
if(typeof cleanup.removeempty==='undefined'){cleanup.removeempty=false;}
if(typeof start==='undefined'&&rangeObject){start=rangeObject.getCommonAncestorContainer();}
prevNode=false;modifiedRange=false;startObject=jQuery(start);startOffset=rangeObject.startOffset;endOffset=rangeObject.endOffset;startObject.contents().each(function(){var index;var nodeType;try{nodeType=this.nodeType;index=that.getIndexInParent(this);}catch(e){return;}
switch(nodeType){case 1:if(prevNode&&prevNode.nodeName==this.nodeName){if(rangeObject.startContainer===startObject&&startOffset>index){rangeObject.startOffset-=1;modifiedRange=true;}
if(rangeObject.endContainer===startObject&&endOffset>index){rangeObject.endOffset-=1;modifiedRange=true;}
jQuery(prevNode).append(jQuery(this).contents());modifiedRange|=that.doCleanup(cleanup,rangeObject,prevNode);jQuery(this).remove();}else{modifiedRange|=that.doCleanup(cleanup,rangeObject,this);var removed=false;if(cleanup.removeempty){if(GENTICS.Utils.Dom.isBlockLevelElement(this)&&this.childNodes.length===0){removed=true;}
if(jQuery.inArray(this.nodeName.toLowerCase(),that.mergeableTags)>=0&&jQuery(this).text().length===0&&this.childNodes.length===0){removed=true;}}
if(!removed){if(jQuery.inArray(this.nodeName.toLowerCase(),that.mergeableTags)>=0){prevNode=this;}else{prevNode=false;}}else{if(rangeObject.startContainer===this.parentNode&&startOffset>index){rangeObject.startOffset=rangeObject.startOffset-1;modifiedRange=true;}
if(rangeObject.endContainer===this.parentNode&&endOffset>index){rangeObject.endOffset=rangeObject.endOffset-1;modifiedRange=true;}
jQuery(this).remove();}}
break;case 3:if(prevNode&&prevNode.nodeType===3&&cleanup.merge){if(rangeObject.startContainer===this){rangeObject.startContainer=prevNode;rangeObject.startOffset+=prevNode.nodeValue.length;modifiedRange=true;}else if(rangeObject.startContainer===prevNode.parentNode&&rangeObject.startOffset===that.getIndexInParent(prevNode)+1){rangeObject.startContainer=prevNode;rangeObject.startOffset=prevNode.nodeValue.length;modifiedRange=true;}
if(rangeObject.endContainer===this){rangeObject.endContainer=prevNode;rangeObject.endOffset+=prevNode.nodeValue.length;modifiedRange=true;}else if(rangeObject.endContainer===prevNode.parentNode&&rangeObject.endOffset===that.getIndexInParent(prevNode)+1){rangeObject.endContainer=prevNode;rangeObject.endOffset=prevNode.nodeValue.length;modifiedRange=true;}
prevNode.data+=this.data;}else if(!(this.nodeValue===''&&cleanup.removeempty)){prevNode=this;break;}
if(rangeObject.startContainer===this.parentNode&&rangeObject.startOffset>index){rangeObject.startOffset=rangeObject.startOffset-1;modifiedRange=true;}
if(rangeObject.endContainer===this.parentNode&&rangeObject.endOffset>index){rangeObject.endOffset=rangeObject.endOffset-1;modifiedRange=true;}
jQuery(this).remove();if(prevNode&&(!prevNode.nextSibling||prevNode.nextSibling.nodeType!==3)){var pos;for(pos=prevNode.data.length-1;pos>=0&&prevNode.data.length>1;pos--){if(prevNode.data.charAt(pos)==='\u200b'){prevNode.deleteData(pos,1);if(rangeObject.startContainer===prevNode&&rangeObject.startOffset>pos){rangeObject.startOffset--;modifiedRange=true;}
if(rangeObject.endContainer===prevNode&&rangeObject.endOffset>pos){rangeObject.endOffset--;modifiedRange=true;}}}}
break;}});if(modifiedRange){rangeObject.clearCaches();}
return modifiedRange;},getIndexInParent:function(node){if(!node){return false;}
var index=0,check=node.previousSibling;while(check){index++;check=check.previousSibling;}
return index;},isBlockLevelElement:function(node){if(!node){return false;}
if(node.nodeType===1&&jQuery.inArray(node.nodeName.toLowerCase(),this.blockLevelElements)>=0){return true;}
return false;},isLineBreakElement:function(node){if(!node){return false;}
return node.nodeType===1&&node.nodeName.toLowerCase()=='br';},isListElement:function(node){if(!node){return false;}
return node.nodeType===1&&jQuery.inArray(node.nodeName.toLowerCase(),this.listElements)>=0;},isSplitObject:function(el){return el.nodeType===1&&blockElementNames.hasOwnProperty(el.nodeName);},searchAdjacentTextNode:function(parent,index,searchleft,stopat){if(!parent||parent.nodeType!==1||index<0||index>parent.childNodes.length){return false;}
if(typeof stopat==='undefined'){stopat={'blocklevel':true,'list':true,'linebreak':true};}
if(typeof stopat.blocklevel==='undefined'){stopat.blocklevel=true;}
if(typeof stopat.list==='undefined'){stopat.list=true;}
if(typeof stopat.linebreak==='undefined'){stopat.linebreak=true;}
if(typeof searchleft==='undefined'){searchleft=true;}
var nextNode,currentParent=parent;if(searchleft&&index>0){nextNode=parent.childNodes[index-1];}
if(!searchleft&&index<parent.childNodes.length){nextNode=parent.childNodes[index];}
while(currentParent){if(!nextNode){if(stopat.blocklevel&&this.isBlockLevelElement(currentParent)){return false;}
if(stopat.list&&this.isListElement(currentParent)){return false;}
nextNode=searchleft?currentParent.previousSibling:currentParent.nextSibling;currentParent=currentParent.parentNode;continue;}else if(nextNode.nodeType===3&&jQuery.trim(nextNode.data).length>0){return nextNode;}
if(stopat.blocklevel&&this.isBlockLevelElement(nextNode)){return false;}
if(stopat.linebreak&&this.isLineBreakElement(nextNode)){return false;}
if(stopat.list&&this.isListElement(nextNode)){return false;}
if(nextNode.nodeType===3){nextNode=searchleft?nextNode.previousSibling:nextNode.nextSibling;}else{currentParent=nextNode;nextNode=searchleft?nextNode.lastChild:nextNode.firstChild;}}},insertIntoDOM:function(object,range,limit,atEnd,force){var parentElements=range.getContainerParents(limit,atEnd),that=this,newParent,container,offset,splitParts,contents;if(!limit){limit=jQuery(document.body);}
if(parentElements.length===0){newParent=limit.get(0);}else{jQuery.each(parentElements,function(index,parent){if(that.allowsNesting(parent,object.get(0))){newParent=parent;return false;}});}
if(typeof newParent==='undefined'&&limit.length>0){newParent=limit.get(0);}
if(!this.allowsNesting(newParent,object.get(0))&&!force){return false;}
if(typeof newParent!=='undefined'){splitParts=this.split(range,jQuery(newParent),atEnd);if(splitParts===true){container=range.startContainer;offset=range.startOffset;if(atEnd){container=range.endContainer;offset=range.endOffset;}
if(offset===0){contents=jQuery(container).contents();if(contents.length>0){contents.eq(0).before(object);}else{jQuery(container).append(object);}
return true;}
jQuery(container).contents().eq(offset-1).after(object);return true;}
if(splitParts){splitParts.eq(0).after(object);return true;}
return false;}
return false;},removeFromDOM:function(object,range,preserveContent){if(preserveContent){var indexInParent=this.getIndexInParent(object),numChildren=jQuery(object).contents().length,parent=object.parentNode;if(range.startContainer==parent&&range.startOffset>indexInParent){range.startOffset+=numChildren-1;}else if(range.startContainer==object){range.startContainer=parent;range.startOffset=indexInParent+range.startOffset;}
if(range.endContainer==parent&&range.endOffset>indexInParent){range.endOffset+=numChildren-1;}else if(range.endContainer==object){range.endContainer=parent;range.endOffset=indexInParent+range.endOffset;}
jQuery(object).contents().unwrap();this.doCleanup({'merge':true},range,parent);}},removeRange:function(rangeObject){if(!rangeObject){return false;}
if(rangeObject.isCollapsed()){return false;}
if(rangeObject.startContainer.nodeType==3&&rangeObject.startOffset>0&&rangeObject.startOffset<rangeObject.startContainer.data.length){this.split(rangeObject,jQuery(rangeObject.startContainer).parent(),false);}
if(rangeObject.endContainer.nodeType==3&&rangeObject.endOffset>0&&rangeObject.endOffset<rangeObject.endContainer.data.length){this.split(rangeObject,jQuery(rangeObject.endContainer).parent(),true);}
var rangeTree=rangeObject.getRangeTree();rangeObject.endContainer=rangeObject.startContainer;rangeObject.endOffset=rangeObject.startOffset;this.recursiveRemoveRange(rangeTree,rangeObject);this.doCleanup({'merge':true},rangeObject);rangeObject.clearCaches();},recursiveRemoveRange:function(rangeTree,rangeObject){var i;for(i=0;i<rangeTree.length;++i){if(rangeTree[i].type=='full'){if(jQuery(rangeObject.startContainer).parents().andSelf().filter(rangeTree[i].domobj).length>0){rangeObject.startContainer=rangeObject.endContainer=rangeTree[i].domobj.parentNode;rangeObject.startOffset=rangeObject.endOffset=this.getIndexInParent(rangeTree[i].domobj);}
jQuery(rangeTree[i].domobj).remove();}else if(rangeTree[i].type=='partial'&&rangeTree[i].children){this.recursiveRemoveRange(rangeTree[i].children,rangeObject);}}},extendToWord:function(range,fromBoundaries){var leftBoundary=this.searchWordBoundary(range.startContainer,range.startOffset,true),rightBoundary=this.searchWordBoundary(range.endContainer,range.endOffset,false);if(!fromBoundaries){if(range.startContainer==leftBoundary.container&&range.startOffset==leftBoundary.offset){return;}
if(range.endContainer==rightBoundary.container&&range.endOffset==rightBoundary.offset){return;}}
range.startContainer=leftBoundary.container;range.startOffset=leftBoundary.offset;range.endContainer=rightBoundary.container;range.endOffset=rightBoundary.offset;range.correctRange();range.clearCaches();},isWordBoundaryElement:function(object){if(!object||!object.nodeName){return false;}
return jQuery.inArray(object.nodeName.toLowerCase(),this.nonWordBoundaryTags)==-1;},searchWordBoundary:function(container,offset,searchleft){if(typeof searchleft==='undefined'){searchleft=true;}
var boundaryFound=false,wordBoundaryPos,tempWordBoundaryPos,textNode;while(!boundaryFound){if(container.nodeType===3){if(!searchleft){wordBoundaryPos=container.data.substring(offset).search(this.nonWordRegex);if(wordBoundaryPos!=-1){offset=offset+wordBoundaryPos;boundaryFound=true;}else{offset=this.getIndexInParent(container)+1;container=container.parentNode;}}else{wordBoundaryPos=container.data.substring(0,offset).search(this.nonWordRegex);tempWordBoundaryPos=wordBoundaryPos;while(tempWordBoundaryPos!=-1){wordBoundaryPos=tempWordBoundaryPos;tempWordBoundaryPos=container.data.substring(wordBoundaryPos+1,offset).search(this.nonWordRegex);if(tempWordBoundaryPos!=-1){tempWordBoundaryPos=tempWordBoundaryPos+wordBoundaryPos+1;}}
if(wordBoundaryPos!=-1){offset=wordBoundaryPos+1;boundaryFound=true;}else{offset=this.getIndexInParent(container);container=container.parentNode;}}}else if(container.nodeType===1){if(!searchleft){if(offset<container.childNodes.length){if(this.isWordBoundaryElement(container.childNodes[offset])){boundaryFound=true;}else{container=container.childNodes[offset];offset=0;}}else{if(this.isWordBoundaryElement(container)){boundaryFound=true;}else{offset=this.getIndexInParent(container)+1;container=container.parentNode;}}}else{if(offset>0){if(this.isWordBoundaryElement(container.childNodes[offset-1])){boundaryFound=true;}else{container=container.childNodes[offset-1];offset=container.nodeType===3?container.data.length:container.childNodes.length;}}else{if(this.isWordBoundaryElement(container)){boundaryFound=true;}else{offset=this.getIndexInParent(container);container=container.parentNode;}}}}}
if(container.nodeType!==3){textNode=this.searchAdjacentTextNode(container,offset,!searchleft);if(textNode){container=textNode;offset=searchleft?0:container.data.length;}}
return{'container':container,'offset':offset};},isEmpty:function(domObject){if(!domObject){return true;}
if(jQuery.inArray(domObject.nodeName.toLowerCase(),this.nonEmptyTags)!=-1){return false;}
if(domObject.nodeType===3){return domObject.data.search(/\S/)==-1;}
var i,childNodes;for(i=0,childNodes=domObject.childNodes.length;i<childNodes;++i){if(!this.isEmpty(domObject.childNodes[i])){return false;}}
return true;},setCursorAfter:function(domObject){var newRange=new GENTICS.Utils.RangeObject(),index=this.getIndexInParent(domObject),targetNode,offset;if(domObject.nodeType==3){targetNode=domObject;offset=targetNode.nodeValue.length;}else if(domObject.nextSibling&&domObject.nextSibling.nodeType==3){targetNode=domObject.nextSibling;offset=0;}else{targetNode=domObject.parentNode;offset=this.getIndexInParent(domObject)+1;}
newRange.startContainer=newRange.endContainer=targetNode;newRange.startOffset=newRange.endOffset=offset;newRange.select();return newRange;},selectDomNode:function(domObject){var newRange=new GENTICS.Utils.RangeObject();newRange.startContainer=newRange.endContainer=domObject.parentNode;newRange.startOffset=this.getIndexInParent(domObject);newRange.endOffset=newRange.startOffset+1;newRange.select();},setCursorInto:function(domObject){var newRange=new GENTICS.Utils.RangeObject();newRange.startContainer=newRange.endContainer=domObject;newRange.startOffset=newRange.endOffset=0;newRange.select();},isEditingHost:function(node){return node&&node.nodeType==1&&(node.contentEditable=="true"||(node.parentNode&&node.parentNode.nodeType==9&&node.parentNode.designMode=="on"));},isEditable:function(node){return node&&!this.isEditingHost(node)&&(node.nodeType!=1||node.contentEditable!="false")&&(this.isEditingHost(node.parentNode)||this.isEditable(node.parentNode));},getEditingHostOf:function(node){if(this.isEditingHost(node)){return node;}
if(this.isEditable(node)){var ancestor=node.parentNode;while(!this.isEditingHost(ancestor)){ancestor=ancestor.parentNode;}
return ancestor;}
return null;},inSameEditingHost:function(node1,node2){return this.getEditingHostOf(node1)&&this.getEditingHostOf(node1)==this.getEditingHostOf(node2);},isBlockNode:function(node){return node&&((node.nodeType==$_.Node.ELEMENT_NODE&&$_(["inline","inline-block","inline-table","none"]).indexOf($_.getComputedStyle(node).display)==-1)||node.nodeType==$_.Node.DOCUMENT_NODE||node.nodeType==$_.Node.DOCUMENT_FRAGMENT_NODE);},getFirstVisibleChild:function(node,includeNode){if(!node){return null;}
if((node.nodeType==$_.Node.TEXT_NODE&&this.isEmpty(node))||(node.nodeType==$_.Node.ELEMENT_NODE&&node.offsetHeight==0&&jQuery.inArray(node.nodeName.toLowerCase(),this.nonEmptyTags)===-1)){return null;}
if(node.nodeType==$_.Node.TEXT_NODE||(node.nodeType==$_.Node.ELEMENT_NODE&&node.childNodes.length==0)||!jQuery(node).contentEditable()){return includeNode?node:null;}
var i;for(i=0;i<node.childNodes.length;++i){var visibleChild=this.getFirstVisibleChild(node.childNodes[i],true);if(visibleChild!=null){return visibleChild;}}
return null;},getLastVisibleChild:function(node,includeNode){if(!node){return null;}
if((node.nodeType==$_.Node.TEXT_NODE&&this.isEmpty(node))||(node.nodeType==$_.Node.ELEMENT_NODE&&node.offsetHeight==0&&jQuery.inArray(node.nodeName.toLowerCase(),this.nonEmptyTags)===-1)){return null;}
if(node.nodeType==$_.Node.TEXT_NODE||(node.nodeType==$_.Node.ELEMENT_NODE&&node.childNodes.length==0)||!jQuery(node).contentEditable()){return includeNode?node:null;}
var i;for(i=node.childNodes.length-1;i>=0;--i){var visibleChild=this.getLastVisibleChild(node.childNodes[i],true);if(visibleChild!=null){return visibleChild;}}
return null;}});GENTICS.Utils.Dom=new Dom();return GENTICS.Utils.Dom;});define('aloha/pluginmanager',['jquery','util/class'],function(jQuery,Class){var Aloha=window.Aloha;return new(Class.extend({plugins:{},init:function(next,userPlugins){var me=this,globalSettings=(Aloha&&Aloha.settings)?Aloha.settings.plugins||{}:{},i,plugin,pluginName;for(pluginName in globalSettings){if(globalSettings.hasOwnProperty(pluginName)){plugin=this.plugins[pluginName]||false;if(plugin){plugin.settings=globalSettings[pluginName]||{};}}}
if(!userPlugins.length){for(pluginName in this.plugins){if(this.plugins.hasOwnProperty(pluginName)){userPlugins.push(pluginName);}}}
for(i=0;i<userPlugins.length;++i){pluginName=userPlugins[i];plugin=this.plugins[pluginName]||false;if(plugin){plugin.settings=plugin.settings||{};if(typeof plugin.settings.enabled==='undefined'){plugin.settings.enabled=true;}
if(plugin.settings.enabled){if(plugin.checkDependencies()){plugin.init();}}}}
next();},register:function(plugin){if(!plugin.name){throw new Error('Plugin does not have an name.');}
if(this.plugins[plugin.name]){throw new Error('Already registered the plugin "'+plugin.name+'"!');}
this.plugins[plugin.name]=plugin;},makeClean:function(obj){var i,plugin;for(plugin in this.plugins){if(this.plugins.hasOwnProperty(plugin)){if(Aloha.Log.isDebugEnabled()){Aloha.Log.debug(this,'Passing contents of HTML Element with id { '+obj.attr('id')+' } for cleaning to plugin { '+plugin+' }');}
this.plugins[plugin].makeClean(obj);}}},toString:function(){return'pluginmanager';}}))();});define('aloha/core',['jquery','aloha/pluginmanager'],function(jQuery,PluginManager){var Aloha=window.Aloha;jQuery.extend(true,Aloha,{version:'0.22.3',editables:[],activeEditable:null,settings:{},defaults:{},ui:{},OSName:'Unknown',stage:'loadingAloha',loadedPlugins:[],_pluginBaseUrlByName:{},init:function(){Aloha.stage='initAloha';Aloha.initAloha(function(){Aloha.stage='initPlugins';Aloha.initPlugins(function(){Aloha.stage='initGui';Aloha.initGui(function(){Aloha.stage='alohaReady';Aloha.trigger('aloha-ready');});});});},getLoadedPlugins:function(){return this.loadedPlugins;},isPluginLoaded:function(pluginName){var found=false;jQuery.each(this.loadedPlugins,function(){if(pluginName.toString()===this.toString()){found=true;}});return found;},initAloha:function(next){var $html=jQuery('html');if((jQuery.browser.webkit&&parseFloat(jQuery.browser.version)<532.5)||(jQuery.browser.mozilla&&parseFloat(jQuery.browser.version)<1.9)||(jQuery.browser.msie&&jQuery.browser.version<7)||(jQuery.browser.opera&&jQuery.browser.version<11)){if(window.console&&window.console.log){window.console.log('Your browser is not supported.');}}
jQuery('html').mousedown(function(e){if(Aloha.activeEditable&&!jQuery(".aloha-dialog").is(':visible')&&!Aloha.eventHandled){Aloha.activeEditable.blur();Aloha.activeEditable=null;}}).mouseup(function(e){Aloha.eventHandled=false;});if(jQuery.browser.webkit){$html.addClass('aloha-webkit');}else if(jQuery.browser.opera){$html.addClass('aloha-opera');}else if(jQuery.browser.msie){$html.addClass('aloha-ie'+parseInt(jQuery.browser.version,10));}else if(jQuery.browser.mozilla){$html.addClass('aloha-mozilla');}
Aloha.settings.base=Aloha.getAlohaUrl();Aloha.Log.init();if(Aloha.settings.errorhandling){window.onerror=function(msg,url,linenumber){Aloha.Log.error(Aloha,'Error message: '+msg+'\nURL: '+url+'\nLine Number: '+linenumber);return true;};}
if(navigator.appVersion.indexOf('Win')!=-1){Aloha.OSName='Win';}
if(navigator.appVersion.indexOf('Mac')!=-1){Aloha.OSName='Mac';}
if(navigator.appVersion.indexOf('X11')!=-1){Aloha.OSName='Unix';}
if(navigator.appVersion.indexOf('Linux')!=-1){Aloha.OSName='Linux';}
next();},initPlugins:function(next){PluginManager.init(next,this.getLoadedPlugins());},initGui:function(next){var i,editablesLength;Aloha.RepositoryManager.init();for(i=0,editablesLength=Aloha.editables.length;i<editablesLength;i++){if(!Aloha.editables[i].ready){Aloha.editables[i].init();}}
next();},activateEditable:function(editable){var i;for(i=0;i<Aloha.editables.length;i++){if(Aloha.editables[i]!=editable&&Aloha.editables[i].isActive){Aloha.editables[i].blur();}}
Aloha.activeEditable=editable;},getActiveEditable:function(){return Aloha.activeEditable;},deactivateEditable:function(){if(typeof Aloha.activeEditable==='undefined'||Aloha.activeEditable===null){return;}
Aloha.activeEditable.blur();Aloha.activeEditable=null;},getEditableById:function(id){var i,editablesLength;if(jQuery('#'+id).get(0).nodeName.toLowerCase()==='textarea'){id=id+'-aloha';}
for(i=0,editablesLength=Aloha.editables.length;i<editablesLength;i++){if(Aloha.editables[i].getId()==id){return Aloha.editables[i];}}
return null;},isEditable:function(obj){var i,editablesLength;for(i=0,editablesLength=Aloha.editables.length;i<editablesLength;i++){if(Aloha.editables[i].originalObj.get(0)===obj){return true;}}
return false;},getEditableHost:function($obj){var $parents,i,$editable,editablesLength=Aloha.editables.length;if(!$obj){return;}
$parents=$obj.parents().andSelf().each(function(){for(i=0;i<editablesLength;i++){if(Aloha.editables[i].originalObj.get(0)===this){$editable=Aloha.editables[i];return false;}}});return $editable;},log:function(level,component,message){if(typeof Aloha.Log!=="undefined"){Aloha.Log.log(level,component,message);}},registerEditable:function(editable){Aloha.editables.push(editable);},unregisterEditable:function(editable){var id=jQuery.inArray(editable,Aloha.editables);if(id!=-1){Aloha.editables.splice(id,1);}},toString:function(){return'Aloha';},isModified:function(){var i;for(i=0;i<Aloha.editables.length;i++){if(Aloha.editables[i].isModified&&Aloha.editables[i].isModified()){return true;}}
return false;},getAlohaUrl:function(suffix){return Aloha.settings.baseUrl;},getPluginUrl:function(name){var url;if(name){url=Aloha.settings._pluginBaseUrlByName[name];if(url){if(!url.match("^(\/|http[s]?:).*")){url=Aloha.getAlohaUrl()+'/'+url;}}}
return url;},disableObjectResizing:function(){try{var supported;try{supported=document.queryCommandSupported('enableObjectResizing');}catch(e){supported=false;Aloha.Log.log('enableObjectResizing is not supported.');}
if(supported){document.execCommand('enableObjectResizing',false,false);Aloha.Log.log('enableObjectResizing disabled.');}}catch(e2){Aloha.Log.error(e2,'Could not disable enableObjectResizing');}}});return Aloha;});define('aloha/console',['aloha/core','util/class','jquery'],function(Aloha,Class,jQuery){var AlohaConsole=Class.extend({init:function(){if(typeof Aloha.settings.logLevels==='undefined'||!Aloha.settings.logLevels){Aloha.settings.logLevels={'error':true,'warn':true};}
if(typeof Aloha.settings.logHistory==='undefined'||!Aloha.settings.logHistory){Aloha.settings.logHistory={};}
if(!Aloha.settings.logHistory.maxEntries){Aloha.settings.logHistory.maxEntries=100;}
if(!Aloha.settings.logHistory.highWaterMark){Aloha.settings.logHistory.highWaterMark=90;}
if(!Aloha.settings.logHistory.levels){Aloha.settings.logHistory.levels={'error':true,'warn':true};}
this.flushLogHistory();Aloha.trigger('aloha-logger-ready');},logHistory:[],highWaterMarkReached:false,log:function(level,component,message){if(typeof component==='undefined'){message=level;}
if(typeof component!=='string'&&component&&component.toString){component=component.toString();}
if(typeof message==='undefined'){message=component;component=undefined;}
if(typeof level==='undefined'||!level){level='log';}
level=level.toLowerCase();if(typeof Aloha.settings.logLevels==="undefined"){return;}
if(!Aloha.settings.logLevels[level]){return;}
component=component||"Unkown Aloha Component";this.addToLogHistory({'level':level,'component':component,'message':message,'date':new Date()});var console=window.console;switch(level){case'error':if(window.console&&console.error){if(!component&&!message){console.error("Error occured without message and component");}else{console.error(component+': '+message);}}
break;case'warn':if(window.console&&console.warn){console.warn(component+': '+message);}
break;case'info':if(window.console&&console.info){console.info(component+': '+message);}
break;case'debug':if(window.console&&console.log){console.log(component+' ['+level+']: '+message);}
break;default:if(window.console&&console.log){console.log(component+' ['+level+']: '+message);}
break;}},error:function(component,message){this.log('error',component,message);},warn:function(component,message){this.log('warn',component,message);},info:function(component,message){this.log('info',component,message);},debug:function(component,message){this.log('debug',component,message);},deprecated:function(component,message){this.log('warn',component,message);if(Aloha.settings.logLevels.deprecated){throw new Error(message);}},isLogLevelEnabled:function(level){return Aloha.settings&&Aloha.settings.logLevels&&Aloha.settings.logLevels[level];},isErrorEnabled:function(){return this.isLogLevelEnabled('error');},isWarnEnabled:function(){return this.isLogLevelEnabled('warn');},isInfoEnabled:function(){return this.isLogLevelEnabled('info');},isDebugEnabled:function(){return this.isLogLevelEnabled('debug');},addToLogHistory:function(entry){if(!Aloha.settings.logHistory){this.init();}
if(Aloha.settings.logHistory.maxEntries<=0||!Aloha.settings.logHistory.levels[entry.level]){return;}
this.logHistory.push(entry);if(!this.highWaterMarkReached){if(this.logHistory.length>=Aloha.settings.logHistory.maxEntries*Aloha.settings.logHistory.highWaterMark/100){Aloha.trigger('aloha-log-full');this.highWaterMarkReached=true;}}
while(this.logHistory.length>Aloha.settings.logHistory.maxEntries){this.logHistory.shift();}},getLogHistory:function(){return this.logHistory;},flushLogHistory:function(){this.logHistory=[];this.highWaterMarkReached=false;}});AlohaConsole=new AlohaConsole();Aloha.Log=Aloha.Console=AlohaConsole;return AlohaConsole;});window.GENTICS=window.GENTICS||{};window.GENTICS.Utils=window.GENTICS.Utils||{};define('util/range',['jquery','util/dom','util/class','aloha/console','aloha/rangy-core'],function(jQuery,Dom,Class,console,rangy){var GENTICS=window.GENTICS;var Aloha=window.Aloha;function selfAndParentsUntil(container,limit){var parents=[],cur;if(1===container.nodeType){cur=container;}else{cur=container.parentNode;}
for(;;){if(!cur||cur===limit||9===cur.nodeType){break;}
if(1===cur.nodeType){parents.push(cur);}
cur=cur.parentNode;}
return parents;}
GENTICS.Utils.RangeObject=Class.extend({_constructor:function(param){if(typeof param==='object'){if(typeof param.startContainer!=='undefined'){this.startContainer=param.startContainer;}
if(typeof param.startOffset!=='undefined'){this.startOffset=param.startOffset;}
if(typeof param.endContainer!=='undefined'){this.endContainer=param.endContainer;}
if(typeof param.endOffset!=='undefined'){this.endOffset=param.endOffset;}}else if(param===true){this.initializeFromUserSelection();}},startContainer:undefined,startOffset:undefined,endContainer:undefined,endOffset:undefined,deleteContents:function(){Dom.removeRange(this);},log:function(message){console.deprecated('Utils.RangeObject','log() is deprecated. use '+'console.log() from module "aloha/console" instead: '+message);},isCollapsed:function(){return(!this.endContainer||(this.startContainer===this.endContainer&&this.startOffset===this.endOffset));},getCommonAncestorContainer:function(){if(this.commonAncestorContainer){return this.commonAncestorContainer;}
this.updateCommonAncestorContainer();return this.commonAncestorContainer;},getContainerParents:function(limit,fromEnd){var container=fromEnd?this.endContainer:this.startContainer;if(!container){return false;}
return jQuery(selfAndParentsUntil(container,limit?limit[0]:null));},getStartContainerParents:function(limit){return this.getContainerParents(limit,false);},getEndContainerParents:function(limit){return this.getContainerParents(limit,true);},updateCommonAncestorContainer:function(commonAncestorContainer){if(!commonAncestorContainer){var parentsStartContainer=this.getStartContainerParents(),parentsEndContainer=this.getEndContainerParents(),i;if(!(parentsStartContainer.length>0&&parentsEndContainer.length>0)){console.warn('aloha/range','could not find commonAncestorContainer');return false;}
for(i=0;i<parentsStartContainer.length;i++){if(parentsEndContainer.index(parentsStartContainer[i])!=-1){this.commonAncestorContainer=parentsStartContainer[i];break;}}}else{this.commonAncestorContainer=commonAncestorContainer;}
console.debug(commonAncestorContainer?'commonAncestorContainer was set successfully':'commonAncestorContainer was calculated successfully');return true;},getCollapsedIERange:function(container,offset){var ieRange=document.body.createTextRange(),tmpRange,right,parent,left;left=this.searchElementToLeft(container,offset);if(left.element){tmpRange=document.body.createTextRange();tmpRange.moveToElementText(left.element);ieRange.setEndPoint('StartToEnd',tmpRange);if(left.characters!==0){ieRange.moveStart('character',left.characters);}else{ieRange.moveStart('character',1);ieRange.moveStart('character',-1);}}else{right=this.searchElementToRight(container,offset);parent=container.nodeType==3?container.parentNode:container;tmpRange=document.body.createTextRange();tmpRange.moveToElementText(parent);ieRange.setEndPoint('StartToStart',tmpRange);if(left.characters!==0){ieRange.moveStart('character',left.characters);}}
ieRange.collapse();return ieRange;},select:function(){var ieRange,endRange,startRange,range,sel;if(typeof this.startContainer==='undefined'||typeof this.endContainer==='undefined'){console.warn('can not select an empty range');return false;}
range=rangy.createRange();range.setStart(this.startContainer,this.startOffset);range.setEnd(this.endContainer,this.endOffset);sel=rangy.getSelection();sel.setSingleRange(range);},searchElementToLeft:function(container,offset){var checkElement,characters=0;if(container.nodeType===3){characters=offset;checkElement=container.previousSibling;}else{if(offset>0){checkElement=container.childNodes[offset-1];}}
while(checkElement&&checkElement.nodeType===3){characters+=checkElement.data.length;checkElement=checkElement.previousSibling;}
return{'element':checkElement,'characters':characters};},searchElementToRight:function(container,offset){var checkElement,characters=0;if(container.nodeType===3){characters=container.data.length-offset;checkElement=container.nextSibling;}else{if(offset<container.childNodes.length){checkElement=container.childNodes[offset];}}
while(checkElement&&checkElement.nodeType===3){characters+=checkElement.data.length;checkElement=checkElement.nextSibling;}
return{'element':checkElement,'characters':characters};},update:function(event){console.debug('now updating rangeObject');this.initializeFromUserSelection(event);this.updateCommonAncestorContainer();},initializeFromUserSelection:function(event){var selection=rangy.getSelection(),browserRange;if(!selection){return false;}
if(!selection.rangeCount){return false;}
browserRange=selection.getRangeAt(0);if(!browserRange){return false;}
this.startContainer=browserRange.startContainer;this.endContainer=browserRange.endContainer;this.startOffset=browserRange.startOffset;this.endOffset=browserRange.endOffset;this.correctRange();return;},correctRange:function(){var adjacentTextNode,textNode,checkedElement,parentNode,offset;this.clearCaches();if(this.isCollapsed()){if(this.startContainer.nodeType===1){if(this.startOffset>0&&this.startContainer.childNodes[this.startOffset-1].nodeType===3){this.startContainer=this.startContainer.childNodes[this.startOffset-1];this.startOffset=this.startContainer.data.length;this.endContainer=this.startContainer;this.endOffset=this.startOffset;return;}
if(this.startOffset>0&&this.startContainer.childNodes[this.startOffset-1].nodeType===1){adjacentTextNode=GENTICS.Utils.Dom.searchAdjacentTextNode(this.startContainer,this.startOffset,true);if(adjacentTextNode){this.startContainer=this.endContainer=adjacentTextNode;this.startOffset=this.endOffset=adjacentTextNode.data.length;return;}
adjacentTextNode=GENTICS.Utils.Dom.searchAdjacentTextNode(this.startContainer,this.startOffset,false);if(adjacentTextNode){this.startContainer=this.endContainer=adjacentTextNode;this.startOffset=this.endOffset=0;return;}}
if(this.startOffset<this.startContainer.childNodes.length&&this.startContainer.childNodes[this.startOffset].nodeType===3){this.startContainer=this.startContainer.childNodes[this.startOffset];this.startOffset=0;this.endContainer=this.startContainer;this.endOffset=0;return;}}
if(this.startContainer.nodeType===3&&this.startOffset===0){adjacentTextNode=GENTICS.Utils.Dom.searchAdjacentTextNode(this.startContainer.parentNode,GENTICS.Utils.Dom.getIndexInParent(this.startContainer),true);if(adjacentTextNode&&jQuery(adjacentTextNode).closest(Aloha.activeEditable.obj).length>0){this.startContainer=this.endContainer=adjacentTextNode;this.startOffset=this.endOffset=adjacentTextNode.data.length;}}}else{if(this.startContainer.nodeType===1){if(this.startOffset<this.startContainer.childNodes.length&&this.startContainer.childNodes[this.startOffset].nodeType===3){this.startContainer=this.startContainer.childNodes[this.startOffset];this.startOffset=0;}else if(this.startOffset<this.startContainer.childNodes.length&&this.startContainer.childNodes[this.startOffset].nodeType===1){textNode=false;checkedElement=this.startContainer.childNodes[this.startOffset];while(textNode===false&&checkedElement.childNodes&&checkedElement.childNodes.length>0){checkedElement=checkedElement.childNodes[0];if(checkedElement.nodeType===3){textNode=checkedElement;}}
if(textNode!==false){this.startContainer=textNode;this.startOffset=0;}}}
if(this.startContainer.nodeType===3&&this.startOffset===this.startContainer.data.length){adjacentTextNode=GENTICS.Utils.Dom.searchAdjacentTextNode(this.startContainer.parentNode,GENTICS.Utils.Dom.getIndexInParent(this.startContainer)+1,false);if(adjacentTextNode){this.startContainer=adjacentTextNode;this.startOffset=0;}}
if(this.endContainer.nodeType===3&&this.endOffset===0){if(this.endContainer.previousSibling&&this.endContainer.previousSibling.nodeType===3){this.endContainer=this.endContainer.previousSibling;this.endOffset=this.endContainer.data.length;}else if(this.endContainer.previousSibling&&this.endContainer.previousSibling.nodeType===1&&this.endContainer.parentNode){parentNode=this.endContainer.parentNode;for(offset=0;offset<parentNode.childNodes.length;++offset){if(parentNode.childNodes[offset]==this.endContainer){this.endOffset=offset;break;}}
this.endContainer=parentNode;}}
if(this.endContainer.nodeType==1&&this.endOffset===0){if(this.endContainer.previousSibling){if(this.endContainer.previousSibling.nodeType===3){this.endContainer=this.endContainer.previousSibling;this.endOffset=this.endContainer.data.length;}else if(this.endContainer.previousSibling.nodeType===1&&this.endContainer.previousSibling.childNodes&&this.endContainer.previousSibling.childNodes.length>0){this.endContainer=this.endContainer.previousSibling;this.endOffset=this.endContainer.childNodes.length;}}}
if(this.endContainer.nodeType==1){if(this.endOffset>0&&this.endContainer.childNodes[this.endOffset-1].nodeType===3){this.endContainer=this.endContainer.childNodes[this.endOffset-1];this.endOffset=this.endContainer.data.length;}else if(this.endOffset>0&&this.endContainer.childNodes[this.endOffset-1].nodeType===1){textNode=false;checkedElement=this.endContainer.childNodes[this.endOffset-1];while(textNode===false&&checkedElement.childNodes&&checkedElement.childNodes.length>0){checkedElement=checkedElement.childNodes[checkedElement.childNodes.length-1];if(checkedElement.nodeType===3){textNode=checkedElement;}}
if(textNode!==false){this.endContainer=textNode;this.endOffset=this.endContainer.data.length;}}}}},clearCaches:function(){this.commonAncestorContainer=undefined;},getRangeTree:function(root){if(typeof root==='undefined'){root=this.getCommonAncestorContainer();}
this.inselection=false;return this.recursiveGetRangeTree(root);},recursiveGetRangeTree:function(currentObject){var jQueryCurrentObject=jQuery(currentObject),childCount=0,that=this,currentElements=[];jQueryCurrentObject.contents().each(function(index){var type='none',startOffset=false,endOffset=false,collapsedFound=false,noneFound=false,partialFound=false,fullFound=false,i;if(that.isCollapsed()&&currentObject===that.startContainer&&that.startOffset===index){currentElements[childCount]=new GENTICS.Utils.RangeTree();currentElements[childCount].type='collapsed';currentElements[childCount].domobj=undefined;that.inselection=false;collapsedFound=true;childCount++;}
if(!that.inselection&&!collapsedFound){switch(this.nodeType){case 3:if(this===that.startContainer){that.inselection=true;type=that.startOffset>0?'partial':'full';startOffset=that.startOffset;endOffset=this.length;}
break;case 1:if(this===that.startContainer&&that.startOffset===0){that.inselection=true;type='full';}
if(currentObject===that.startContainer&&that.startOffset===index){that.inselection=true;type='full';}
break;}}
if(that.inselection&&!collapsedFound){if(type=='none'){type='full';}
switch(this.nodeType){case 3:if(this===that.endContainer){that.inselection=false;if(that.endOffset<this.length){type='partial';}
if(startOffset===false){startOffset=0;}
endOffset=that.endOffset;}
break;case 1:if(this===that.endContainer&&that.endOffset===0){that.inselection=false;}
break;}
if(currentObject===that.endContainer&&that.endOffset<=index){that.inselection=false;type='none';}}
currentElements[childCount]=new GENTICS.Utils.RangeTree();currentElements[childCount].domobj=this;currentElements[childCount].type=type;if(type=='partial'){currentElements[childCount].startOffset=startOffset;currentElements[childCount].endOffset=endOffset;}
currentElements[childCount].children=that.recursiveGetRangeTree(this);if(currentElements[childCount].children.length>0){for(i=0;i<currentElements[childCount].children.length;++i){switch(currentElements[childCount].children[i].type){case'none':noneFound=true;break;case'full':fullFound=true;break;case'partial':partialFound=true;break;}}
if(partialFound||(fullFound&&noneFound)){currentElements[childCount].type='partial';}else if(fullFound&&!partialFound&&!noneFound){currentElements[childCount].type='full';}}
childCount++;});if(this.isCollapsed()&&currentObject===this.startContainer&&this.startOffset==currentObject.childNodes.length){currentElements[childCount]=new GENTICS.Utils.RangeTree();currentElements[childCount].type='collapsed';currentElements[childCount].domobj=undefined;}
return currentElements;},findMarkup:function(comparator,limit,atEnd){var container=atEnd?this.endContainer:this.startContainer,parents,i,len;limit=limit?limit[0]:null;if(!container){return;}
parents=selfAndParentsUntil(container,limit);for(i=0,len=parents.length;i<len;i++){if(comparator.apply(parents[i])){return parents[i];}}
return false;},getText:function(){if(this.isCollapsed()){return'';}
return this.recursiveGetText(this.getRangeTree());},recursiveGetText:function(tree){if(!tree){return'';}
var that=this,text='';jQuery.each(tree,function(){if(this.type=='full'){text+=jQuery(this.domobj).text();}else if(this.type=='partial'&&this.domobj.nodeType===3){text+=jQuery(this.domobj).text().substring(this.startOffset,this.endOffset);}else if(this.type=='partial'&&this.domobj.nodeType===1&&this.children){text+=that.recursiveGetText(this.children);}});return text;}});GENTICS.Utils.RangeTree=Class.extend({domobj:{},type:null,children:[]});return GENTICS.Utils.RangeObject;});define('util/arrays',[],function(){function sortUnique(a,compFn){var i;if(compFn){a.sort(compFn);for(i=1;i<a.length;i++){if(0===compFn(a[i],a[i-1])){a.splice(i--,1);}}}else{a.sort();for(i=1;i<a.length;i++){if(a[i]==a[i-1]){a.splice(i--,1);}}}
return a;}
function equal(a,b,equalFn){var i,len=a.length;if(len!==b.length){return false;}
if(equalFn){for(i=0;i<len;i++){if(!equalFn(a[i],b[i])){return false;}}}else{for(i=0;i<len;i++){if(a[i]!==b[i]){return false;}}}
return true;}
function map(a,fn){var i,len,result=[];for(i=0,len=a.length;i<len;i++){result.push(fn(a[i]));}
return result;}
function mapNative(a,fn){return a.map(fn);}
function filter(a,pred){var i,len,value,result=[];for(i=0,len=a.length;i<len;i++){value=a[i];if(pred(value)){result.push(value);}}
return result;}
function indexOf(a,value){var i,len;for(i=0,len=a.length;i<len;i++){if(value===a[i]){return i;}}
return-1;}
function reduce(a,init,fn){var i,len;for(i=0,len=a.length;i<len;i++){init=fn(init,a[i]);}
return init;}
function applyNotNull(value,fn){return value==null?null:fn(value);}
return{filter:filter,indexOf:indexOf,reduce:reduce,applyNotNull:applyNotNull,sortUnique:sortUnique,equal:equal,map:Array.prototype.map?mapNative:map};});define('util/strings',['jquery'],function($){var spacesRx=/\s+/;function words(str){var list=str.split(spacesRx);if(list.length&&list[0]===""){list.shift();}
if(list.length&&list[list.length-1]===""){list.pop();}
return list;}
function dashesToCamelCase(s){return s.replace(/[\-]([a-z])/gi,function(all,upper){return upper.toUpperCase();});}
function camelCaseToDashes(s){return s.replace(/[A-Z]/g,function(match){return'-'+match.toLowerCase();});}
return{'words':words,'dashesToCamelCase':dashesToCamelCase,'camelCaseToDashes':camelCaseToDashes};});define('PubSub',[],function(){var channels={};var subscriptions={};var sid=0;function getSubscriptionChannel(sid){return subscriptions[sid]&&channels[subscriptions[sid].channel];}
function pub(channel,message){if(!channels[channel]){return 0;}
if(!message){message={};}else if(typeof message!=='object'){message={data:message};}
message.channel=channel;var sids=channels[channel].slice();var i;for(i=0;i<sids.length;++i){subscriptions[sids[i]].callback(message);}
return i;}
var PubSub={sub:function(channel,callback){if(typeof callback!=='function'){return-1;}
var subscriptionIds=channels[channel];if(!subscriptionIds){subscriptionIds=channels[channel]=[];}
subscriptionIds.push(++sid);subscriptions[sid]={channel:channel,callback:callback};return sid;},unsub:function(sid){if(-1===sid||!subscriptions[sid]){return false;}
var subscriptionIds=getSubscriptionChannel(sid);delete subscriptions[sid];var j=subscriptionIds.length;while(j){if(subscriptionIds[--j]===sid){subscriptionIds.splice(j,1);return true;}}
return false;},pub:function(channel,message){var segments=channel.split('.');var i;var len=segments.length;var channelName='';var tally=0;for(i=0;i<len;++i){channelName+=(0===i?'':'.')+segments[i];tally+=pub(channelName,message);}
return tally;}};return PubSub;});define('aloha/engine',['aloha/core','aloha/ecma5shims','jquery'],function(Aloha,$_,jQuery){function hasAttribute(obj,attr){var native_method=obj.hasAttribute;if(native_method){return obj.hasAttribute(attr);}
return(typeof obj.attributes[attr]!="undefined");}
var htmlNamespace="http://www.w3.org/1999/xhtml";var cssStylingFlag=false;var globalRange=null;var commands={};function isHtmlNamespace(ns){return ns===null||!ns||ns===htmlNamespace;}
function isHtmlElement_obsolete(node,tags){if(typeof tags=="string"){tags=[tags];}
if(typeof tags=="object"){tags=$_(tags).map(function(tag){return tag.toUpperCase();});}
return node&&node.nodeType==1&&isHtmlNamespace(node.namespaceURI)&&(typeof tags=="undefined"||$_(tags).indexOf(node.tagName)!=-1);}
function isAnyHtmlElement(node){return node&&node.nodeType==1&&isHtmlNamespace(node.namespaceURI);}
function isNamedHtmlElement(node,name){return node&&node.nodeType==1&&isHtmlNamespace(node.namespaceURI)&&name.toUpperCase()===node.nodeName;}
function arrayContainsInsensitive(array,str){var i,len;str=str.toUpperCase();for(i=0,len=array.length;i<len;i++){if(array[i].toUpperCase()===str){return true;}}
return false;}
function isHtmlElementInArray(node,array){return node&&node.nodeType==1&&isHtmlNamespace(node.namespaceURI)&&arrayContainsInsensitive(array,node.nodeName);}
function isMappedHtmlElement(node,map){return node&&node.nodeType==1&&isHtmlNamespace(node.namespaceURI)&&map[node.nodeName];}
function getStyleLength(node){var s;var styleLength=0;if(!node){return 0;}
if(!node.style){return 0;}
if(typeof node.style.length!=='undefined'){return node.style.length;}
for(s in node.style){if(node.style[s]&&node.style[s]!==0&&node.style[s]!=='false'){styleLength++;}}
return styleLength;}
function toArray(obj){if(!obj){return null;}
var array=[],i,l=obj.length;i=l>>>0;while(i--){array[i]=obj[i];}
return array;}
function nextNodeDescendants(node){while(node&&!node.nextSibling){node=node.parentNode;}
if(!node){return null;}
return node.nextSibling;}
function nextNode(node){if(node.hasChildNodes()){return node.firstChild;}
return nextNodeDescendants(node);}
function previousNode(node){if(node.previousSibling){node=node.previousSibling;while(node.hasChildNodes()){node=node.lastChild;}
return node;}
if(node.parentNode&&node.parentNode.nodeType==$_.Node.ELEMENT_NODE){return node.parentNode;}
return null;}
function isAncestor(ancestor,descendant){return ancestor&&descendant&&Boolean($_.compareDocumentPosition(ancestor,descendant)&$_.Node.DOCUMENT_POSITION_CONTAINED_BY);}
function isAncestorContainer(ancestor,descendant){return(ancestor||descendant)&&(ancestor==descendant||isAncestor(ancestor,descendant));}
function isDescendant(descendant,ancestor){return ancestor&&descendant&&Boolean($_.compareDocumentPosition(ancestor,descendant)&$_.Node.DOCUMENT_POSITION_CONTAINED_BY);}
function isBefore(node1,node2){return Boolean($_.compareDocumentPosition(node1,node2)&$_.Node.DOCUMENT_POSITION_FOLLOWING);}
function isAfter(node1,node2){return Boolean($_.compareDocumentPosition(node1,node2)&$_.Node.DOCUMENT_POSITION_PRECEDING);}
function getAncestors(node){var ancestors=[];while(node.parentNode){ancestors.unshift(node.parentNode);node=node.parentNode;}
return ancestors;}
function getDescendants(node){var descendants=[];var stop=nextNodeDescendants(node);while(null!=(node=nextNode(node))&&node!=stop){descendants.push(node);}
return descendants;}
function convertProperty(property){var map={"fontFamily":"font-family","fontSize":"font-size","fontStyle":"font-style","fontWeight":"font-weight","textDecoration":"text-decoration"};if(typeof map[property]!="undefined"){return map[property];}
return property;}
function cssSizeToLegacy(cssVal){return{"xx-small":1,"small":2,"medium":3,"large":4,"x-large":5,"xx-large":6,"xxx-large":7}[cssVal];}
function legacySizeToCss(legacyVal){return{1:"xx-small",2:"small",3:"medium",4:"large",5:"x-large",6:"xx-large",7:"xxx-large"}[legacyVal];}
function getDirectionality(element){if(element.dir=="ltr"){return"ltr";}
if(element.dir=="rtl"){return"rtl";}
if(!isAnyHtmlElement(element.parentNode)){return"ltr";}
return getDirectionality(element.parentNode);}
function getNodeIndex(node){var ret=0;while(node.previousSibling){ret++;node=node.previousSibling;}
return ret;}
function getNodeLength(node){switch(node.nodeType){case $_.Node.PROCESSING_INSTRUCTION_NODE:case $_.Node.DOCUMENT_TYPE_NODE:return 0;case $_.Node.TEXT_NODE:case $_.Node.COMMENT_NODE:return node.length;default:return node.childNodes.length;}}
function getPosition(nodeA,offsetA,nodeB,offsetB){if(nodeA==nodeB){if(offsetA==offsetB){return"equal";}
if(offsetA<offsetB){return"before";}
if(offsetA>offsetB){return"after";}}
var documentPosition=$_.compareDocumentPosition(nodeB,nodeA);if(documentPosition&$_.Node.DOCUMENT_POSITION_FOLLOWING){var pos=getPosition(nodeB,offsetB,nodeA,offsetA);if(pos=="before"){return"after";}
if(pos=="after"){return"before";}}
if(documentPosition&$_.Node.DOCUMENT_POSITION_CONTAINS){var child=nodeB;while(child.parentNode!=nodeA){child=child.parentNode;}
if(getNodeIndex(child)<offsetA){return"after";}}
return"before";}
function getFurthestAncestor(node){var root=node;while(root.parentNode!=null){root=root.parentNode;}
return root;}
function isContained(node,range){var pos1=getPosition(node,0,range.startContainer,range.startOffset);if(pos1!=="after"){return false;}
var pos2=getPosition(node,getNodeLength(node),range.endContainer,range.endOffset);if(pos2!=="before"){return false;}
return getFurthestAncestor(node)==getFurthestAncestor(range.startContainer);}
function getContainedNodes(range,condition){if(typeof condition=="undefined"){condition=function(){return true;};}
var node=range.startContainer;if(node.hasChildNodes()&&range.startOffset<node.childNodes.length){node=node.childNodes[range.startOffset];}else if(range.startOffset==getNodeLength(node)){node=nextNodeDescendants(node);}else{node=nextNode(node);}
var stop=range.endContainer;if(stop.hasChildNodes()&&range.endOffset<stop.childNodes.length){stop=stop.childNodes[range.endOffset];}else{stop=nextNodeDescendants(stop);}
var nodeList=[];while(isBefore(node,stop)){if(isContained(node,range)&&condition(node)){nodeList.push(node);node=nextNodeDescendants(node);continue;}
node=nextNode(node);}
return nodeList;}
function getAllContainedNodes(range,condition){if(typeof condition=="undefined"){condition=function(){return true;};}
var node=range.startContainer;if(node.hasChildNodes()&&range.startOffset<node.childNodes.length){node=node.childNodes[range.startOffset];}else if(range.startOffset==getNodeLength(node)){node=nextNodeDescendants(node);}else{node=nextNode(node);}
var stop=range.endContainer;if(stop.hasChildNodes()&&range.endOffset<stop.childNodes.length){stop=stop.childNodes[range.endOffset];}else{stop=nextNodeDescendants(stop);}
var nodeList=[];while(isBefore(node,stop)){if(isContained(node,range)&&condition(node)){nodeList.push(node);}
node=nextNode(node);}
return nodeList;}
function normalizeColor(color){if(color.toLowerCase()=="currentcolor"){return null;}
var outerSpan=document.createElement("span");document.body.appendChild(outerSpan);outerSpan.style.color="black";var innerSpan=document.createElement("span");outerSpan.appendChild(innerSpan);innerSpan.style.color=color;color=$_.getComputedStyle(innerSpan).color;if(color=="rgb(0, 0, 0)"){outerSpan.color="white";color=$_.getComputedStyle(innerSpan).color;if(color!="rgb(0, 0, 0)"){return null;}}
document.body.removeChild(outerSpan);if(/^rgba\([0-9]+, [0-9]+, [0-9]+, 1\)$/.test(color)){return color.replace("rgba","rgb").replace(", 1)",")");}
if(color=="transparent"){return"rgba(0, 0, 0, 0)";}
return color;}
function parseSimpleColor(color){color=color.toLowerCase();if($_(["aliceblue","antiquewhite","aqua","aquamarine","azure","beige","bisque","black","blanchedalmond","blue","blueviolet","brown","burlywood","cadetblue","chartreuse","chocolate","coral","cornflowerblue","cornsilk","crimson","cyan","darkblue","darkcyan","darkgoldenrod","darkgray","darkgreen","darkgrey","darkkhaki","darkmagenta","darkolivegreen","darkorange","darkorchid","darkred","darksalmon","darkseagreen","darkslateblue","darkslategray","darkslategrey","darkturquoise","darkviolet","deeppink","deepskyblue","dimgray","dimgrey","dodgerblue","firebrick","floralwhite","forestgreen","fuchsia","gainsboro","ghostwhite","gold","goldenrod","gray","green","greenyellow","grey","honeydew","hotpink","indianred","indigo","ivory","khaki","lavender","lavenderblush","lawngreen","lemonchiffon","lightblue","lightcoral","lightcyan","lightgoldenrodyellow","lightgray","lightgreen","lightgrey","lightpink","lightsalmon","lightseagreen","lightskyblue","lightslategray","lightslategrey","lightsteelblue","lightyellow","lime","limegreen","linen","magenta","maroon","mediumaquamarine","mediumblue","mediumorchid","mediumpurple","mediumseagreen","mediumslateblue","mediumspringgreen","mediumturquoise","mediumvioletred","midnightblue","mintcream","mistyrose","moccasin","navajowhite","navy","oldlace","olive","olivedrab","orange","orangered","orchid","palegoldenrod","palegreen","paleturquoise","palevioletred","papayawhip","peachpuff","peru","pink","plum","powderblue","purple","red","rosybrown","royalblue","saddlebrown","salmon","sandybrown","seagreen","seashell","sienna","silver","skyblue","slateblue","slategray","slategrey","snow","springgreen","steelblue","tan","teal","thistle","tomato","turquoise","violet","wheat","white","whitesmoke","yellow","yellowgreen"]).indexOf(color)!=-1){return color;}
color=normalizeColor(color);var matches=/^rgb\(([0-9]+), ([0-9]+), ([0-9]+)\)$/.exec(color);if(matches){return"#"+parseInt(matches[1],10).toString(16).replace(/^.$/,"0$&")+parseInt(matches[2],10).toString(16).replace(/^.$/,"0$&")+parseInt(matches[3],10).toString(16).replace(/^.$/,"0$&");}
return null;}
var getStateOverride,setStateOverride,unsetStateOverride,getValueOverride,setValueOverride,unsetValueOverride;var executionStackDepth=0;function normalizeFontSize(value){value=$_(value).trim();if(/^[\-+]?[0-9]+(\.[0-9]+)?([eE][\-+]?[0-9]+)?$/.test(value)){var mode;if(value[0]=="+"){value=value.slice(1);mode="relative-plus";}else if(value[0]=="-"){value=value.slice(1);mode="relative-minus";}else{mode="absolute";}
var num=parseInt(value,10);if(mode=="relative-plus"){num+=3;}
if(mode=="relative-minus"){num=3-num;}
if(num<1){num=1;}
if(num>7){num=7;}
value={1:"xx-small",2:"small",3:"medium",4:"large",5:"x-large",6:"xx-large",7:"xxx-large"}[num];}
return value;}
function getLegacyFontSize(size){size=normalizeFontSize(size);if(jQuery.inArray(size,["xx-small","x-small","small","medium","large","x-large","xx-large","xxx-large"])==-1&&!/^[0-9]+(\.[0-9]+)?(cm|mm|in|pt|pc|px)$/.test(size)){return null;}
var font=document.createElement("font");document.body.appendChild(font);if(size=="xxx-large"){font.size=7;}else{font.style.fontSize=size;}
var pixelSize=parseInt($_.getComputedStyle(font).fontSize,10);document.body.removeChild(font);var returnedSize=1;while(returnedSize<7){font=document.createElement("font");font.size=returnedSize;document.body.appendChild(font);var lowerBound=parseInt($_.getComputedStyle(font).fontSize,10);font.size=1+returnedSize;var upperBound=parseInt($_.getComputedStyle(font).fontSize,10);document.body.removeChild(font);var average=(upperBound+lowerBound)/2;if(pixelSize<average){return String(returnedSize);}
returnedSize++;}
return"7";}
function editCommandMethod(command,prop,range,callback){var ret;if(executionStackDepth==0&&typeof range!="undefined"){globalRange=range;}else if(executionStackDepth==0){globalRange=null;globalRange=range;}
if(!commands.hasOwnProperty(command)){throw"NOT_SUPPORTED_ERR";}
if(prop!="enabled"&&!commands[command].hasOwnProperty(prop)){throw"INVALID_ACCESS_ERR";}
executionStackDepth++;try{ret=callback();}catch(e){executionStackDepth--;throw e;}
executionStackDepth--;return ret;}
function myQueryCommandEnabled(command,range){command=command.toLowerCase();return editCommandMethod(command,"action",range,(function(command){return function(){return jQuery.inArray(command,["copy","cut","paste","selectall","stylewithcss","usecss"])!=-1||range!==null;};}(command)));}
function setActiveRange(range){var rangeObject=new window.GENTICS.Utils.RangeObject();rangeObject.startContainer=range.startContainer;rangeObject.startOffset=range.startOffset;rangeObject.endContainer=range.endContainer;rangeObject.endOffset=range.endOffset;rangeObject.select();}
function myExecCommand(commandArg,showUiArg,valueArg,range){var command=commandArg.toLowerCase();var showUi=showUiArg;var value=valueArg;if(arguments.length==1||(arguments.length>=4&&typeof showUi=="undefined")){showUi=false;}
if(arguments.length<=2||(arguments.length>=4&&typeof value=="undefined")){value="";}
return editCommandMethod(command,"action",range,(function(command,showUi,value){return function(){if(!myQueryCommandEnabled(command)){return false;}
commands[command].action(value,range);setActiveRange(range);return true;};}(command,showUi,value)));}
function myQueryCommandIndeterm(command,range){command=command.toLowerCase();return editCommandMethod(command,"indeterm",range,(function(command){return function(){if(!myQueryCommandEnabled(command,range)){return false;}
return commands[command].indeterm(range);};}(command)));}
function myQueryCommandState(command,range){command=command.toLowerCase();return editCommandMethod(command,"state",range,(function(command){return function(){if(!myQueryCommandEnabled(command,range)){return false;}
if(typeof getStateOverride(command,range)!="undefined"){return getStateOverride(command,range);}
return commands[command].state(range);};}(command)));}
function myQueryCommandSupported(command){command=command.toLowerCase();return commands.hasOwnProperty(command);}
function myQueryCommandValue(command,range){command=command.toLowerCase();return editCommandMethod(command,"value",range,function(){if(!myQueryCommandEnabled(command,range)){return"";}
if(command=="fontsize"&&getValueOverride("fontsize",range)!==undefined){return getLegacyFontSize(getValueOverride("fontsize",range));}
if(typeof getValueOverride(command,range)!="undefined"){return getValueOverride(command,range);}
return commands[command].value(range);});}
var prohibitedParagraphChildNamesMap={"ADDRESS":true,"ARTICLE":true,"ASIDE":true,"BLOCKQUOTE":true,"CAPTION":true,"CENTER":true,"COL":true,"COLGROUP":true,"DD":true,"DETAILS":true,"DIR":true,"DIV":true,"DL":true,"DT":true,"FIELDSET":true,"FIGCAPTION":true,"FIGURE":true,"FOOTER":true,"FORM":true,"H1":true,"H2":true,"H3":true,"H4":true,"H5":true,"H6":true,"HEADER":true,"HGROUP":true,"HR":true,"LI":true,"LISTING":true,"MENU":true,"NAV":true,"OL":true,"P":true,"PLAINTEXT":true,"PRE":true,"SECTION":true,"SUMMARY":true,"TABLE":true,"TBODY":true,"TD":true,"TFOOT":true,"TH":true,"THEAD":true,"TR":true,"UL":true,"XMP":true};function isProhibitedParagraphChild(node){return isMappedHtmlElement(node,prohibitedParagraphChildNamesMap);}
var nonBlockDisplayValuesMap={"inline":true,"inline-block":true,"inline-table":true,"none":true};function isBlockNode(node){return node&&((node.nodeType==$_.Node.ELEMENT_NODE&&!nonBlockDisplayValuesMap[$_.getComputedStyle(node).display])||node.nodeType==$_.Node.DOCUMENT_NODE||node.nodeType==$_.Node.DOCUMENT_FRAGMENT_NODE);}
function isInlineNode(node){return node&&!isBlockNode(node);}
function isEditingHost(node){return node&&node.nodeType==$_.Node.ELEMENT_NODE&&(node.contentEditable=="true"||(node.parentNode&&node.parentNode.nodeType==$_.Node.DOCUMENT_NODE&&node.parentNode.designMode=="on"));}
function isEditable(node){return node&&!isEditingHost(node)&&(node.nodeType!=$_.Node.ELEMENT_NODE||node.contentEditable!="false"||jQuery(node).hasClass('aloha-table-wrapper'))&&(isEditingHost(node.parentNode)||isEditable(node.parentNode));}
function hasEditableDescendants(node){var i;for(i=0;i<node.childNodes.length;i++){if(isEditable(node.childNodes[i])||hasEditableDescendants(node.childNodes[i])){return true;}}
return false;}
function getEditingHostOf(node){if(isEditingHost(node)){return node;}
if(isEditable(node)){var ancestor=node.parentNode;while(!isEditingHost(ancestor)){ancestor=ancestor.parentNode;}
return ancestor;}
return null;}
function inSameEditingHost(node1,node2){return getEditingHostOf(node1)&&getEditingHostOf(node1)==getEditingHostOf(node2);}
function isCollapsedLineBreak(br){if(!isNamedHtmlElement(br,'br')){return false;}
var ref=br.parentNode;while($_.getComputedStyle(ref).display=="inline"){ref=ref.parentNode;}
var origStyle={height:ref.style.height,maxHeight:ref.style.maxHeight,minHeight:ref.style.minHeight};ref.style.height='auto';ref.style.maxHeight='none';if(!(jQuery.browser.msie&&jQuery.browser.version<8)){ref.style.minHeight='0';}
var space=document.createTextNode('\u200b');var origHeight=ref.offsetHeight;if(origHeight==0){throw'isCollapsedLineBreak: original height is zero, bug?';}
br.parentNode.insertBefore(space,br.nextSibling);var finalHeight=ref.offsetHeight;space.parentNode.removeChild(space);ref.style.height=origStyle.height;ref.style.maxHeight=origStyle.maxHeight;if(!(jQuery.browser.msie&&jQuery.browser.version<8)){ref.style.minHeight=origStyle.minHeight;}
return origHeight<finalHeight-5;}
function isExtraneousLineBreak(br){if(!isNamedHtmlElement(br,'br')){return false;}
if(isNamedHtmlElement(br.parentNode,"li")&&br.parentNode.childNodes.length==1){return false;}
var ref=br.parentNode;while($_.getComputedStyle(ref).display=="inline"){ref=ref.parentNode;}
var origStyle={height:ref.style.height,maxHeight:ref.style.maxHeight,minHeight:ref.style.minHeight,contentEditable:ref.contentEditable};ref.style.height='auto';ref.style.maxHeight='none';ref.style.minHeight='0';if(jQuery.browser.msie&&jQuery.browser.version<=7){ref.contentEditable='false';}
var origHeight=ref.offsetHeight;if(origHeight==0){throw"isExtraneousLineBreak: original height is zero, bug?";}
var origBrDisplay=br.style.display;br.style.display='none';var finalHeight=ref.offsetHeight;ref.style.height=origStyle.height;ref.style.maxHeight=origStyle.maxHeight;ref.style.minHeight=origStyle.minHeight;if(jQuery.browser.msie&&jQuery.browser.version<=7){ref.contentEditable=origStyle.contentEditable;}
br.style.display=origBrDisplay;return origHeight==finalHeight;}
function isWhitespaceNode(node){return node&&node.nodeType==$_.Node.TEXT_NODE&&(node.data==""||(/^[\t\n\r ]+$/.test(node.data)&&node.parentNode&&node.parentNode.nodeType==$_.Node.ELEMENT_NODE&&jQuery.inArray($_.getComputedStyle(node.parentNode).whiteSpace,["normal","nowrap"])!=-1)||(/^[\t\r ]+$/.test(node.data)&&node.parentNode&&node.parentNode.nodeType==$_.Node.ELEMENT_NODE&&$_.getComputedStyle(node.parentNode).whiteSpace=="pre-line")||(/^[\t\n\r ]+$/.test(node.data)&&node.parentNode&&node.parentNode.nodeType==$_.Node.DOCUMENT_FRAGMENT_NODE));}
function collapseWhitespace(node,range){if(!isEditable(node)&&!isEditingHost(node)){return;}
if(!node||node.nodeType!==$_.Node.TEXT_NODE){return;}
if(jQuery.inArray($_.getComputedStyle(node.parentNode).whiteSpace,["pre","pre-wrap"])!=-1){return;}
if(!/[\t\n\r ]{2,}/.test(node.data)){return;}
var newData='';var correctStart=range.startContainer==node;var correctEnd=range.endContainer==node;var wsFound=false;var i;for(i=0;i<node.data.length;++i){if(/[\t\n\r ]/.test(node.data.substr(i,1))){if(!wsFound){newData+=' ';wsFound=true;}else{if(correctStart&&newData.length<range.startOffset){range.startOffset--;}
if(correctEnd&&newData.length<range.endOffset){range.endOffset--;}}}else{newData+=node.data.substr(i,1);wsFound=false;}}
node.data=newData;}
function isCollapsedWhitespaceNode(node){if(!isWhitespaceNode(node)){return false;}
if(node.data==""){return true;}
var ancestor=node.parentNode;if(!ancestor){return true;}
if($_(getAncestors(node)).some(function(ancestor){return ancestor.nodeType==$_.Node.ELEMENT_NODE&&$_.getComputedStyle(ancestor).display=="none";})){return true;}
while(!isBlockNode(ancestor)&&ancestor.parentNode){ancestor=ancestor.parentNode;}
var reference=node;while(reference!=ancestor){reference=previousNode(reference);if(isBlockNode(reference)||isNamedHtmlElement(reference,'br')){return true;}
if((reference.nodeType==$_.Node.TEXT_NODE&&!isWhitespaceNode(reference))||isNamedHtmlElement(reference,'img')){break;}}
reference=node;var stop=nextNodeDescendants(ancestor);while(reference!=stop){reference=nextNode(reference);if(isBlockNode(reference)||isNamedHtmlElement(reference,'br')){return true;}
if((reference&&reference.nodeType==$_.Node.TEXT_NODE&&!isWhitespaceNode(reference))||isNamedHtmlElement(reference,'img')){break;}}
return false;}
function isVisible(node){var i;if(!node){return false;}
if($_(getAncestors(node).concat(node)).filter(function(node){return node.nodeType==$_.Node.ELEMENT_NODE;},true).some(function(node){return $_.getComputedStyle(node).display=="none";})){return false;}
if(isBlockNode(node)||(node.nodeType==$_.Node.TEXT_NODE&&!isCollapsedWhitespaceNode(node))||isNamedHtmlElement(node,'img')||(isNamedHtmlElement(node,'br')&&!isExtraneousLineBreak(node))){return true;}
for(i=0;i<node.childNodes.length;i++){if(isVisible(node.childNodes[i])){return true;}}
return false;}
function isInvisible(node){return node&&!isVisible(node);}
function isCollapsedBlockProp(node){var i;if(isCollapsedLineBreak(node)&&!isExtraneousLineBreak(node)){return true;}
if(!isInlineNode(node)||node.nodeType!=$_.Node.ELEMENT_NODE){return false;}
var hasCollapsedBlockPropChild=false;for(i=0;i<node.childNodes.length;i++){if(!isInvisible(node.childNodes[i])&&!isCollapsedBlockProp(node.childNodes[i])){return false;}
if(isCollapsedBlockProp(node.childNodes[i])){hasCollapsedBlockPropChild=true;}}
return hasCollapsedBlockPropChild;}
function getActiveRange(){var ret;if(globalRange){ret=globalRange;}else if(Aloha.getSelection().rangeCount){ret=Aloha.getSelection().getRangeAt(0);}else{return null;}
if(jQuery.inArray(ret.startContainer.nodeType,[$_.Node.TEXT_NODE,$_.Node.ELEMENT_NODE])==-1||jQuery.inArray(ret.endContainer.nodeType,[$_.Node.TEXT_NODE,$_.Node.ELEMENT_NODE])==-1||!ret.startContainer.ownerDocument||!ret.endContainer.ownerDocument||!isDescendant(ret.startContainer,ret.startContainer.ownerDocument)||!isDescendant(ret.endContainer,ret.endContainer.ownerDocument)){throw"Invalid active range; test bug?";}
return ret;}
(function(){var stateOverrides={};var valueOverrides={};var storedRange=null;function resetOverrides(range){if(!storedRange||storedRange.startContainer!=range.startContainer||storedRange.endContainer!=range.endContainer||storedRange.startOffset!=range.startOffset||storedRange.endOffset!=range.endOffset){stateOverrides={};valueOverrides={};storedRange=range.cloneRange();}}
getStateOverride=function(command,range){resetOverrides(range);return stateOverrides[command];};setStateOverride=function(command,newState,range){resetOverrides(range);stateOverrides[command]=newState;};unsetStateOverride=function(command,range){resetOverrides(range);delete stateOverrides[command];};getValueOverride=function(command,range){resetOverrides(range);return valueOverrides[command];};setValueOverride=function(command,newValue,range){resetOverrides(range);valueOverrides[command]=newValue;if(command=="backcolor"){valueOverrides.hilitecolor=newValue;}else if(command=="hilitecolor"){valueOverrides.backcolor=newValue;}};unsetValueOverride=function(command,range){resetOverrides(range);delete valueOverrides[command];if(command=="backcolor"){delete valueOverrides.hilitecolor;}else if(command=="hilitecolor"){delete valueOverrides.backcolor;}};}());function movePreservingRanges(node,newParent,newIndex,range){if(newIndex==-1){newIndex=newParent.childNodes.length;}
var oldParent=node.parentNode;var oldIndex=getNodeIndex(node);var i;var ranges=[range];for(i=0;i<Aloha.getSelection().rangeCount;i++){ranges.push(Aloha.getSelection().getRangeAt(i));}
var boundaryPoints=[];$_(ranges).forEach(function(range){boundaryPoints.push([range.startContainer,range.startOffset]);boundaryPoints.push([range.endContainer,range.endOffset]);});$_(boundaryPoints).forEach(function(boundaryPoint){if(boundaryPoint[0]==newParent&&boundaryPoint[1]>newIndex){boundaryPoint[1]++;}
if(boundaryPoint[0]==oldParent&&(boundaryPoint[1]==oldIndex||boundaryPoint[1]==oldIndex+1)){boundaryPoint[0]=newParent;boundaryPoint[1]+=newIndex-oldIndex;}
if(boundaryPoint[0]==oldParent&&boundaryPoint[1]>oldIndex+1){boundaryPoint[1]--;}});if(newParent.childNodes.length==newIndex){newParent.appendChild(node);}else{newParent.insertBefore(node,newParent.childNodes[newIndex]);}
var newRange=null;if(boundaryPoints[0][1]>boundaryPoints[0][0].childNodes.length&&boundaryPoints[1][1]>boundaryPoints[1][0].childNodes.length){range.setStart(node,0);range.setEnd(node,0);}else{range.setStart(boundaryPoints[0][0],boundaryPoints[0][1]);range.setEnd(boundaryPoints[1][0],boundaryPoints[1][1]);Aloha.getSelection().removeAllRanges();for(i=1;i<ranges.length;i++){newRange=Aloha.createRange();newRange.setStart(boundaryPoints[2*i][0],boundaryPoints[2*i][1]);newRange.setEnd(boundaryPoints[2*i+1][0],boundaryPoints[2*i+1][1]);Aloha.getSelection().addRange(newRange);}
if(newRange){range=newRange;}}}
function copyAttributes(element,newElement){if(jQuery.browser.msie&&jQuery.browser.version>=7&&typeof element.attributes[jQuery.expando]!=='undefined'){jQuery(element).removeAttr(jQuery.expando);}
var attrs=element.attributes;var i;for(i=0;i<attrs.length;i++){var attr=attrs[i];if(typeof attr.specified==="undefined"||attr.specified){if(typeof newElement.setAttributeNS==='function'){newElement.setAttributeNS(attr.namespaceURI,attr.name,attr.value);}else{newElement.setAttribute(attr.name,attr.value);}}}}
function setTagName(element,newName,range){if(isNamedHtmlElement(element,newName)){return element;}
if(!element.parentNode){return element;}
var replacementElement=element.ownerDocument.createElement(newName);element.parentNode.insertBefore(replacementElement,element);copyAttributes(element,replacementElement);while(element.childNodes.length){movePreservingRanges(element.firstChild,replacementElement,replacementElement.childNodes.length,range);}
element.parentNode.removeChild(element);if(range.startContainer===element){range.startContainer=replacementElement;}
if(range.endContainer===element){range.endContainer=replacementElement;}
return replacementElement;}
function removeExtraneousLineBreaksBefore(node){var ref=node.previousSibling;if(!ref){return;}
while(ref.hasChildNodes()){ref=ref.lastChild;}
while(isInvisible(ref)&&!isExtraneousLineBreak(ref)&&ref!=node.parentNode){ref=previousNode(ref);}
if(isEditable(ref)&&isExtraneousLineBreak(ref)){ref.parentNode.removeChild(ref);}}
function removeExtraneousLineBreaksAtTheEndOf(node){var ref=node;while(ref.hasChildNodes()){ref=ref.lastChild;}
while(isInvisible(ref)&&!isExtraneousLineBreak(ref)&&ref!=node){ref=previousNode(ref);}
if(isEditable(ref)&&isExtraneousLineBreak(ref)){ref.parentNode.removeChild(ref);}}
function removeExtraneousLineBreaksFrom(node){removeExtraneousLineBreaksBefore(node);removeExtraneousLineBreaksAtTheEndOf(node);}
function wrap(nodeList,siblingCriteria,newParentInstructions,range){var i;if(typeof siblingCriteria=="undefined"){siblingCriteria=function(){return false;};}
if(typeof newParentInstructions=="undefined"){newParentInstructions=function(){return null;};}
if(!nodeList.length||!isEditable(nodeList[0])){return null;}
if(isInlineNode(nodeList[nodeList.length-1])&&!isNamedHtmlElement(nodeList[nodeList.length-1],"br")&&isNamedHtmlElement(nodeList[nodeList.length-1].nextSibling,"br")){nodeList.push(nodeList[nodeList.length-1].nextSibling);}
var newParent;if(isEditable(nodeList[0].previousSibling)&&siblingCriteria(nodeList[0].previousSibling)){newParent=nodeList[0].previousSibling;}else if(isEditable(nodeList[nodeList.length-1].nextSibling)&&siblingCriteria(nodeList[nodeList.length-1].nextSibling)){newParent=nodeList[nodeList.length-1].nextSibling;}else{newParent=newParentInstructions();}
if(!newParent){return null;}
if(!newParent.parentNode){nodeList[0].parentNode.insertBefore(newParent,nodeList[0]);var startContainer=range.startContainer,startOffset=range.startOffset,endContainer=range.endContainer,endOffset=range.endOffset;if(startContainer==newParent.parentNode&&startOffset>=getNodeIndex(newParent)){range.setStart(startContainer,startOffset+1);}
if(endContainer==newParent.parentNode&&endOffset>=getNodeIndex(newParent)){range.setEnd(endContainer,endOffset+1);}
if(globalRange&&globalRange!==range){startContainer=globalRange.startContainer;startOffset=globalRange.startOffset;endContainer=globalRange.endContainer;endOffset=globalRange.endOffset;if(startContainer==newParent.parentNode&&startOffset>=getNodeIndex(newParent)){globalRange.setStart(startContainer,startOffset+1);}
if(endContainer==newParent.parentNode&&endOffset>=getNodeIndex(newParent)){globalRange.setEnd(endContainer,endOffset+1);}}}
var originalParent=nodeList[0].parentNode;if(isBefore(newParent,nodeList[0])){if(!isInlineNode(newParent)&&isInlineNode(newParent.lastChild)&&isInlineNode(nodeList[0])&&!isNamedHtmlElement(newParent.lastChild,"BR")){newParent.appendChild(newParent.ownerDocument.createElement("br"));}
for(i=0;i<nodeList.length;i++){movePreservingRanges(nodeList[i],newParent,-1,range);}}else{if(!isInlineNode(newParent)&&isInlineNode(newParent.firstChild)&&isInlineNode(nodeList[nodeList.length-1])&&!isNamedHtmlElement(nodeList[nodeList.length-1],"BR")){newParent.insertBefore(newParent.ownerDocument.createElement("br"),newParent.firstChild);}
for(i=nodeList.length-1;i>=0;i--){movePreservingRanges(nodeList[i],newParent,0,range);}}
if(isEditable(originalParent)&&!originalParent.hasChildNodes()){originalParent.parentNode.removeChild(originalParent);}
if(isEditable(newParent.nextSibling)&&siblingCriteria(newParent.nextSibling)){if(!isInlineNode(newParent)&&isInlineNode(newParent.lastChild)&&isInlineNode(newParent.nextSibling.firstChild)&&!isNamedHtmlElement(newParent.lastChild,"BR")){newParent.appendChild(newParent.ownerDocument.createElement("br"));}
while(newParent.nextSibling.hasChildNodes()){movePreservingRanges(newParent.nextSibling.firstChild,newParent,-1,range);}
newParent.parentNode.removeChild(newParent.nextSibling);}
removeExtraneousLineBreaksFrom(newParent);return newParent;}
var namesOfElementsWithInlineContentsMap={"A":true,"ABBR":true,"B":true,"BDI":true,"BDO":true,"CITE":true,"CODE":true,"DFN":true,"EM":true,"H1":true,"H2":true,"H3":true,"H4":true,"H5":true,"H6":true,"I":true,"KBD":true,"MARK":true,"P":true,"PRE":true,"Q":true,"RP":true,"RT":true,"RUBY":true,"S":true,"SAMP":true,"SMALL":true,"SPAN":true,"STRONG":true,"SUB":true,"SUP":true,"U":true,"VAR":true,"ACRONYM":true,"LISTING":true,"STRIKE":true,"XMP":true,"BIG":true,"BLINK":true,"FONT":true,"MARQUEE":true,"NOBR":true,"TT":true};var tableRelatedElements={"colgroup":true,"table":true,"tbody":true,"tfoot":true,"thead":true,"tr":true};var scriptRelatedElements={"script":true,"style":true,"plaintext":true,"xmp":true};var prohibitedHeadingNestingMap=jQuery.extend({"H1":true,"H2":true,"H3":true,"H4":true,"H5":true,"H6":true},prohibitedParagraphChildNamesMap);var prohibitedTableNestingMap={"CAPTION":true,"COL":true,"COLGROUP":true,"TBODY":true,"TD":true,"TFOOT":true,"TH":true,"THEAD":true,"TR":true};var prohibitedDefNestingMap={"DD":true,"DT":true};var prohibitedNestingCombinationsMap={"A":jQuery.extend({"A":true},prohibitedParagraphChildNamesMap),"DD":prohibitedDefNestingMap,"DT":prohibitedDefNestingMap,"LI":{"LI":true},"NOBR":jQuery.extend({"NOBR":true},prohibitedParagraphChildNamesMap),"H1":prohibitedHeadingNestingMap,"H2":prohibitedHeadingNestingMap,"H3":prohibitedHeadingNestingMap,"H4":prohibitedHeadingNestingMap,"H5":prohibitedHeadingNestingMap,"H6":prohibitedHeadingNestingMap,"TD":prohibitedTableNestingMap,"TH":prohibitedTableNestingMap,"ABBR":prohibitedParagraphChildNamesMap,"B":prohibitedParagraphChildNamesMap,"BDI":prohibitedParagraphChildNamesMap,"BDO":prohibitedParagraphChildNamesMap,"CITE":prohibitedParagraphChildNamesMap,"CODE":prohibitedParagraphChildNamesMap,"DFN":prohibitedParagraphChildNamesMap,"EM":prohibitedParagraphChildNamesMap,"I":prohibitedParagraphChildNamesMap,"KBD":prohibitedParagraphChildNamesMap,"MARK":prohibitedParagraphChildNamesMap,"P":prohibitedParagraphChildNamesMap,"PRE":prohibitedParagraphChildNamesMap,"Q":prohibitedParagraphChildNamesMap,"RP":prohibitedParagraphChildNamesMap,"RT":prohibitedParagraphChildNamesMap,"RUBY":prohibitedParagraphChildNamesMap,"S":prohibitedParagraphChildNamesMap,"SAMP":prohibitedParagraphChildNamesMap,"SMALL":prohibitedParagraphChildNamesMap,"SPAN":prohibitedParagraphChildNamesMap,"STRONG":prohibitedParagraphChildNamesMap,"SUB":prohibitedParagraphChildNamesMap,"SUP":prohibitedParagraphChildNamesMap,"U":prohibitedParagraphChildNamesMap,"VAR":prohibitedParagraphChildNamesMap,"ACRONYM":prohibitedParagraphChildNamesMap,"LISTING":prohibitedParagraphChildNamesMap,"STRIKE":prohibitedParagraphChildNamesMap,"XMP":prohibitedParagraphChildNamesMap,"BIG":prohibitedParagraphChildNamesMap,"BLINK":prohibitedParagraphChildNamesMap,"FONT":prohibitedParagraphChildNamesMap,"MARQUEE":prohibitedParagraphChildNamesMap,"TT":prohibitedParagraphChildNamesMap};function isElementWithInlineContents(node){return isMappedHtmlElement(node,namesOfElementsWithInlineContentsMap);}
function isAllowedChild(child,parent_){if((tableRelatedElements[parent_]||isHtmlElementInArray(parent_,["colgroup","table","tbody","tfoot","thead","tr"]))&&typeof child=="object"&&child.nodeType==$_.Node.TEXT_NODE&&!/^[ \t\n\f\r]*$/.test(child.data)){return false;}
if((scriptRelatedElements[parent_]||isHtmlElementInArray(parent_,["script","style","plaintext","xmp"]))&&(typeof child!="object"||child.nodeType!=$_.Node.TEXT_NODE)){return false;}
if(typeof child=="object"&&(child.nodeType==$_.Node.DOCUMENT_NODE||child.nodeType==$_.Node.DOCUMENT_FRAGMENT_NODE||child.nodeType==$_.Node.DOCUMENT_TYPE_NODE)){return false;}
if(isAnyHtmlElement(child)){child=child.tagName.toLowerCase();}
if(typeof child!="string"){return true;}
if(isAnyHtmlElement(parent_)){var ancestor=parent_;while(ancestor){if(child=="a"&&isNamedHtmlElement(ancestor,'a')){return false;}
if(prohibitedParagraphChildNamesMap[child.toUpperCase()]&&isElementWithInlineContents(ancestor)){return false;}
if(/^h[1-6]$/.test(child)&&isAnyHtmlElement(ancestor)&&/^H[1-6]$/.test(ancestor.tagName)){return false;}
ancestor=ancestor.parentNode;}
parent_=parent_.tagName.toLowerCase();}
if(typeof parent_=="object"&&(parent_.nodeType==$_.Node.ELEMENT_NODE||parent_.nodeType==$_.Node.DOCUMENT_FRAGMENT_NODE)){return true;}
if(typeof parent_!="string"){return false;}
switch(parent_){case"colgroup":return child=="col";case"table":return jQuery.inArray(child,["caption","col","colgroup","tbody","td","tfoot","th","thead","tr"])!=-1;case"tbody":case"thead":case"tfoot":return jQuery.inArray(child,["td","th","tr"])!=-1;case"tr":return jQuery.inArray(child,["td","th"])!=-1;case"dl":return jQuery.inArray(child,["dt","dd"])!=-1;case"dir":case"ol":case"ul":return jQuery.inArray(child,["dir","li","ol","ul"])!=-1;case"hgroup":return(/^h[1-6]$/).test(child);}
if(jQuery.inArray(child,["body","caption","col","colgroup","frame","frameset","head","html","tbody","td","tfoot","th","thead","tr"])!=-1){return false;}
if(jQuery.inArray(child,["dd","dt"])!=-1&&parent_!="dl"){return false;}
if(child=="li"&&parent_!="ol"&&parent_!="ul"){return false;}
var leftSide=prohibitedNestingCombinationsMap[parent_.toUpperCase()];if(leftSide){var rightSide=leftSide[child.toUpperCase()];if(rightSide){return false;}}
return true;}
function isEffectivelyContained(node,range){if(range.collapsed){return false;}
if(isContained(node,range)){return true;}
if(node==range.startContainer&&node.nodeType==$_.Node.TEXT_NODE&&getNodeLength(node)!=range.startOffset){return true;}
if(node==range.endContainer&&node.nodeType==$_.Node.TEXT_NODE&&range.endOffset!=0){return true;}
if(node.hasChildNodes()&&$_(node.childNodes).every(function(child){return isEffectivelyContained(child,range);})&&(!isDescendant(range.startContainer,node)||range.startContainer.nodeType!=$_.Node.TEXT_NODE||range.startOffset==0)&&(!isDescendant(range.endContainer,node)||range.endContainer.nodeType!=$_.Node.TEXT_NODE||range.endOffset==getNodeLength(range.endContainer))){return true;}
return false;}
function getEffectivelyContainedNodes(range,condition){if(typeof condition=="undefined"){condition=function(){return true;};}
var node=range.startContainer;while(isEffectivelyContained(node.parentNode,range)){node=node.parentNode;}
var stop=nextNodeDescendants(range.endContainer);var nodeList=[];while(isBefore(node,stop)){if(isEffectivelyContained(node,range)&&condition(node)){nodeList.push(node);node=nextNodeDescendants(node);continue;}
node=nextNode(node);}
return nodeList;}
function getAllEffectivelyContainedNodes(range,condition){if(typeof condition=="undefined"){condition=function(){return true;};}
var node=range.startContainer;while(isEffectivelyContained(node.parentNode,range)){node=node.parentNode;}
var stop=nextNodeDescendants(range.endContainer);var nodeList=[];while(isBefore(node,stop)){if(isEffectivelyContained(node,range)&&condition(node)){nodeList.push(node);}
node=nextNode(node);}
return nodeList;}
function isModifiableElement(node){if(!isAnyHtmlElement(node)){return false;}
if(jQuery.inArray(node.tagName,["B","EM","I","S","SPAN","STRIKE","STRONG","SUB","SUP","U"])!=-1){if(node.attributes.length==0){return true;}
if(node.attributes.length==1&&hasAttribute(node,"style")){return true;}}
if(node.tagName=="FONT"||node.tagName=="A"){var numAttrs=node.attributes.length;if(hasAttribute(node,"style")){numAttrs--;}
if(node.tagName=="FONT"){if(hasAttribute(node,"color")){numAttrs--;}
if(hasAttribute(node,"face")){numAttrs--;}
if(hasAttribute(node,"size")){numAttrs--;}}
if(node.tagName=="A"&&hasAttribute(node,"href")){numAttrs--;}
if(numAttrs==0){return true;}}
return false;}
function isSimpleModifiableElement(node){if(!isAnyHtmlElement(node)){return false;}
if(jQuery.inArray(node.tagName,["A","B","EM","FONT","I","S","SPAN","STRIKE","STRONG","SUB","SUP","U"])==-1){return false;}
if(node.attributes.length==0){return true;}
if(node.attributes.length>1){return false;}
if(hasAttribute(node,"style")&&getStyleLength(node)==0){return true;}
if(node.tagName=="A"&&hasAttribute(node,"href")){return true;}
if(node.tagName=="FONT"&&(hasAttribute(node,"color")||hasAttribute(node,"face")||hasAttribute(node,"size"))){return true;}
if((node.tagName=="B"||node.tagName=="STRONG")&&hasAttribute(node,"style")&&getStyleLength(node)==1&&node.style.fontWeight!=""){return true;}
if((node.tagName=="I"||node.tagName=="EM")&&hasAttribute(node,"style")&&getStyleLength(node)==1&&node.style.fontStyle!=""){return true;}
if((node.tagName=="A"||node.tagName=="FONT"||node.tagName=="SPAN")&&hasAttribute(node,"style")&&getStyleLength(node)==1&&node.style.textDecoration==""){return true;}
if(jQuery.inArray(node.tagName,["A","FONT","S","SPAN","STRIKE","U"])!=-1&&hasAttribute(node,"style")&&getStyleLength(node)==1&&(node.style.textDecoration=="line-through"||node.style.textDecoration=="underline"||node.style.textDecoration=="overline"||node.style.textDecoration=="none")){return true;}
return false;}
function areEquivalentValues(command,val1,val2){if(val1===null&&val2===null){return true;}
if(typeof val1=="string"&&typeof val2=="string"&&val1==val2&&!(commands[command].hasOwnProperty("equivalentValues"))){return true;}
if(typeof val1=="string"&&typeof val2=="string"&&commands[command].hasOwnProperty("equivalentValues")&&commands[command].equivalentValues(val1,val2)){return true;}
return false;}
function areLooselyEquivalentValues(command,val1,val2){if(areEquivalentValues(command,val1,val2)){return true;}
if(command!="fontsize"||typeof val1!="string"||typeof val2!="string"){return false;}
var callee=areLooselyEquivalentValues;if(callee.sizeMap===undefined){callee.sizeMap={};var font=document.createElement("font");document.body.appendChild(font);$_(["xx-small","small","medium","large","x-large","xx-large","xxx-large"]).forEach(function(keyword){font.size=cssSizeToLegacy(keyword);callee.sizeMap[keyword]=$_.getComputedStyle(font).fontSize;});document.body.removeChild(font);}
return val1===callee.sizeMap[val2]||val2===callee.sizeMap[val1];}
function getEffectiveCommandValue(node,command){if(node.nodeType!=$_.Node.ELEMENT_NODE&&(!node.parentNode||node.parentNode.nodeType!=$_.Node.ELEMENT_NODE)){return null;}
if(node.nodeType!=$_.Node.ELEMENT_NODE){return getEffectiveCommandValue(node.parentNode,command);}
if(command=="createlink"||command=="unlink"){while(node&&(!isAnyHtmlElement(node)||node.tagName!="A"||!hasAttribute(node,"href"))){node=node.parentNode;}
if(!node){return null;}
return node.getAttribute("href");}
if(command=="backcolor"||command=="hilitecolor"){while(($_.getComputedStyle(node).backgroundColor=="rgba(0, 0, 0, 0)"||$_.getComputedStyle(node).backgroundColor===""||$_.getComputedStyle(node).backgroundColor=="transparent")&&node.parentNode&&node.parentNode.nodeType==$_.Node.ELEMENT_NODE){node=node.parentNode;}
if($_.getComputedStyle(node).backgroundColor=="rgba(0, 0, 0, 0)"||$_.getComputedStyle(node).backgroundColor===""||$_.getComputedStyle(node).backgroundColor=="transparent"){return"rgb(255, 255, 255)";}
return $_.getComputedStyle(node).backgroundColor;}
if(command=="subscript"||command=="superscript"){var affectedBySubscript=false;var affectedBySuperscript=false;while(isInlineNode(node)){var verticalAlign=$_.getComputedStyle(node).verticalAlign;if(isNamedHtmlElement(node,'sub')){affectedBySubscript=true;}else if(isNamedHtmlElement(node,'sup')){affectedBySuperscript=true;}
node=node.parentNode;}
if(affectedBySubscript&&affectedBySuperscript){return"mixed";}
if(affectedBySubscript){return"subscript";}
if(affectedBySuperscript){return"superscript";}
return null;}
if(command=="strikethrough"){do{if($_.getComputedStyle(node).textDecoration.indexOf("line-through")!=-1){return"line-through";}
node=node.parentNode;}while(node&&node.nodeType==$_.Node.ELEMENT_NODE);return null;}
if(command=="underline"){do{if($_.getComputedStyle(node).textDecoration.indexOf("underline")!=-1){return"underline";}
node=node.parentNode;}while(node&&node.nodeType==$_.Node.ELEMENT_NODE);return null;}
if(!commands[command].hasOwnProperty("relevantCssProperty")){throw"Bug: no relevantCssProperty for "+command+" in getEffectiveCommandValue";}
return $_.getComputedStyle(node)[commands[command].relevantCssProperty].toString();}
function getSpecifiedCommandValue(element,command){if((command=="backcolor"||command=="hilitecolor")&&$_.getComputedStyle(element).display!="inline"){return null;}
if(command=="createlink"||command=="unlink"){if(isAnyHtmlElement(element)&&element.tagName=="A"&&hasAttribute(element,"href")){return element.getAttribute("href");}
return null;}
if(command=="subscript"||command=="superscript"){if(isNamedHtmlElement(element,'sup')){return"superscript";}
if(isNamedHtmlElement(element,'sub')){return"subscript";}
return null;}
if(command=="strikethrough"&&element.style.textDecoration!=""){if(element.style.textDecoration.indexOf("line-through")!=-1){return"line-through";}
return null;}
if(command=="strikethrough"&&isHtmlElementInArray(element,["S","STRIKE"])){return"line-through";}
if(command=="underline"&&element.style.textDecoration!=""){if(element.style.textDecoration.indexOf("underline")!=-1){return"underline";}
return null;}
if(command=="underline"&&isNamedHtmlElement(element,'U')){return"underline";}
var property=commands[command].relevantCssProperty;if(property===null){return null;}
if(element.style[property]!=""){return element.style[property];}
if(isHtmlNamespace(element.namespaceURI)&&element.tagName=="FONT"){if(property=="color"&&hasAttribute(element,"color")){return element.color;}
if(property=="fontFamily"&&hasAttribute(element,"face")){return element.face;}
if(property=="fontSize"&&hasAttribute(element,"size")){var size=parseInt(element.size,10);if(size<1){size=1;}
if(size>7){size=7;}
return{1:"xx-small",2:"small",3:"medium",4:"large",5:"x-large",6:"xx-large",7:"xxx-large"}[size];}}
if(property=="fontWeight"&&(element.tagName=="B"||element.tagName=="STRONG")){return"bold";}
if(property=="fontStyle"&&(element.tagName=="I"||element.tagName=="EM")){return"italic";}
return null;}
function reorderModifiableDescendants(node,command,newValue,range){var candidate=node;while(isModifiableElement(candidate)&&candidate.childNodes.length==1&&isModifiableElement(candidate.firstChild)&&(!isSimpleModifiableElement(candidate)||!areEquivalentValues(command,getSpecifiedCommandValue(candidate,command),newValue))){candidate=candidate.firstChild;}
if(candidate==node||!isSimpleModifiableElement(candidate)||!areEquivalentValues(command,getSpecifiedCommandValue(candidate,command),newValue)||!areLooselyEquivalentValues(command,getEffectiveCommandValue(candidate,command),newValue)){return;}
while(candidate.hasChildNodes()){movePreservingRanges(candidate.firstChild,candidate.parentNode,getNodeIndex(candidate),range);}
node.parentNode.insertBefore(candidate,node.nextSibling);movePreservingRanges(node,candidate,-1,range);}
var recordValuesCommands=["subscript","bold","fontname","fontsize","forecolor","hilitecolor","italic","strikethrough","underline"];function recordValues(nodeList){var values=[];var nodes=jQuery.makeArray(nodeList);var i,j;var node;var command;var ancestor;var specifiedCommandValue;for(i=0;i<nodes.length;i++){node=nodes[i];for(j=0;j<recordValuesCommands.length;j++){command=recordValuesCommands[j];ancestor=node;if(ancestor.nodeType!=1){ancestor=ancestor.parentNode;}
specifiedCommandValue=null;while(ancestor&&ancestor.nodeType==1&&(specifiedCommandValue=getSpecifiedCommandValue(ancestor,command))===null){ancestor=ancestor.parentNode;}
values.push([node,command,specifiedCommandValue]);}}
return values;}
function clearValue(element,command,range){if(!isEditable(element)){return[];}
if(getSpecifiedCommandValue(element,command)===null){return[];}
if(isSimpleModifiableElement(element)){var children=Array.prototype.slice.call(toArray(element.childNodes));var i;for(i=0;i<children.length;i++){movePreservingRanges(children[i],element.parentNode,getNodeIndex(element),range);}
element.parentNode.removeChild(element);return children;}
if(command=="strikethrough"&&element.style.textDecoration.indexOf("line-through")!=-1){if(element.style.textDecoration=="line-through"){element.style.textDecoration="";}else{element.style.textDecoration=element.style.textDecoration.replace("line-through","");}
if(element.getAttribute("style")==""){element.removeAttribute("style");}}
if(command=="underline"&&element.style.textDecoration.indexOf("underline")!=-1){if(element.style.textDecoration=="underline"){element.style.textDecoration="";}else{element.style.textDecoration=element.style.textDecoration.replace("underline","");}
if(element.getAttribute("style")==""){element.removeAttribute("style");}}
if(commands[command].relevantCssProperty!==null){element.style[commands[command].relevantCssProperty]='';if(element.getAttribute("style")==""){element.removeAttribute("style");}}
if(isHtmlNamespace(element.namespaceURI)&&element.tagName=="FONT"){if(command=="forecolor"){element.removeAttribute("color");}
if(command=="fontname"){element.removeAttribute("face");}
if(command=="fontsize"){element.removeAttribute("size");}}
if(isNamedHtmlElement(element,'A')&&(command=="createlink"||command=="unlink")){element.removeAttribute("href");}
if(getSpecifiedCommandValue(element,command)===null){return[];}
return[setTagName(element,"span",range)];}
function forceValue(node,command,newValue,range){var children=[];var i;var specifiedValue;if(!node.parentNode){return;}
if(newValue===null){return;}
if(isAllowedChild(node,"span")){reorderModifiableDescendants(node.previousSibling,command,newValue,range);reorderModifiableDescendants(node.nextSibling,command,newValue,range);wrap([node],function(node){return isSimpleModifiableElement(node)&&areEquivalentValues(command,getSpecifiedCommandValue(node,command),newValue)&&areLooselyEquivalentValues(command,getEffectiveCommandValue(node,command),newValue);},function(){return null;},range);}
if(areLooselyEquivalentValues(command,getEffectiveCommandValue(node,command),newValue)){return;}
if(!isAllowedChild(node,"span")){for(i=0;i<node.childNodes.length;i++){if(node.childNodes[i].nodeType==$_.Node.ELEMENT_NODE){specifiedValue=getSpecifiedCommandValue(node.childNodes[i],command);if(specifiedValue!==null&&!areEquivalentValues(command,newValue,specifiedValue)){continue;}}
children.push(node.childNodes[i]);}
for(i=0;i<children.length;i++){forceValue(children[i],command,newValue,range);}
return;}
if(areLooselyEquivalentValues(command,getEffectiveCommandValue(node,command),newValue)){return;}
var newParent=null;if(!cssStylingFlag){if(command=="bold"&&(newValue=="bold"||newValue=="700")){newParent=node.ownerDocument.createElement("b");}
if(command=="italic"&&newValue=="italic"){newParent=node.ownerDocument.createElement("i");}
if(command=="strikethrough"&&newValue=="line-through"){newParent=node.ownerDocument.createElement("s");}
if(command=="underline"&&newValue=="underline"){newParent=node.ownerDocument.createElement("u");}
if(command=="forecolor"&&parseSimpleColor(newValue)){newParent=node.ownerDocument.createElement("span");jQuery(newParent).css('color',parseSimpleColor(newValue));}
if(command=="fontname"){newParent=node.ownerDocument.createElement("font");newParent.face=newValue;}}
if(command=="createlink"||command=="unlink"){newParent=node.ownerDocument.createElement("a");newParent.setAttribute("href",newValue);var ancestor=node.parentNode;while(ancestor){if(isNamedHtmlElement(ancestor,'A')){ancestor=setTagName(ancestor,"span",range);}
ancestor=ancestor.parentNode;}}
if(command=="fontsize"&&jQuery.inArray(newValue,["xx-small","small","medium","large","x-large","xx-large","xxx-large"])!=-1&&(!cssStylingFlag||newValue=="xxx-large")){newParent=node.ownerDocument.createElement("font");newParent.size=cssSizeToLegacy(newValue);}
if((command=="subscript"||command=="superscript")&&newValue=="subscript"){newParent=node.ownerDocument.createElement("sub");}
if((command=="subscript"||command=="superscript")&&newValue=="superscript"){newParent=node.ownerDocument.createElement("sup");}
if(!newParent){newParent=node.ownerDocument.createElement("span");}
node.parentNode.insertBefore(newParent,node);var property=commands[command].relevantCssProperty;if(property!==null&&!areLooselyEquivalentValues(command,getEffectiveCommandValue(newParent,command),newValue)){newParent.style[property]=newValue;}
if(command=="strikethrough"&&newValue=="line-through"&&getEffectiveCommandValue(newParent,"strikethrough")!="line-through"){newParent.style.textDecoration="line-through";}
if(command=="underline"&&newValue=="underline"&&getEffectiveCommandValue(newParent,"underline")!="underline"){newParent.style.textDecoration="underline";}
movePreservingRanges(node,newParent,newParent.childNodes.length,range);if(node.nodeType==$_.Node.ELEMENT_NODE&&!areEquivalentValues(command,getEffectiveCommandValue(node,command),newValue)){movePreservingRanges(node,newParent.parentNode,getNodeIndex(newParent),range);newParent.parentNode.removeChild(newParent);children=[];for(i=0;i<node.childNodes.length;i++){if(node.childNodes[i].nodeType==$_.Node.ELEMENT_NODE){specifiedValue=getSpecifiedCommandValue(node.childNodes[i],command);if(specifiedValue!==null&&!areEquivalentValues(command,newValue,specifiedValue)){continue;}}
children.push(node.childNodes[i]);}
for(i=0;i<children.length;i++){forceValue(children[i],command,newValue,range);}}}
function pushDownValues(node,command,newValue,range){if(!node.parentNode||node.parentNode.nodeType!=$_.Node.ELEMENT_NODE){return;}
if(areLooselyEquivalentValues(command,getEffectiveCommandValue(node,command),newValue)){return;}
var currentAncestor=node.parentNode;var ancestorList=[];while(isEditable(currentAncestor)&&currentAncestor.nodeType==$_.Node.ELEMENT_NODE&&!areLooselyEquivalentValues(command,getEffectiveCommandValue(currentAncestor,command),newValue)){ancestorList.push(currentAncestor);currentAncestor=currentAncestor.parentNode;}
if(!ancestorList.length){return;}
var propagatedValue=getSpecifiedCommandValue(ancestorList[ancestorList.length-1],command);if(propagatedValue===null&&propagatedValue!=newValue){return;}
if(newValue!==null&&!areLooselyEquivalentValues(command,getEffectiveCommandValue(ancestorList[ancestorList.length-1].parentNode,command),newValue)){return;}
while(ancestorList.length){currentAncestor=ancestorList.pop();if(getSpecifiedCommandValue(currentAncestor,command)!==null){propagatedValue=getSpecifiedCommandValue(currentAncestor,command);}
var children=Array.prototype.slice.call(toArray(currentAncestor.childNodes));if(getSpecifiedCommandValue(currentAncestor,command)!==null){clearValue(currentAncestor,command,range);}
var i;for(i=0;i<children.length;i++){var child=children[i];if(child==node){continue;}
if(child.nodeType==$_.Node.ELEMENT_NODE&&getSpecifiedCommandValue(child,command)!==null&&!areEquivalentValues(command,propagatedValue,getSpecifiedCommandValue(child,command))){continue;}
if(child==ancestorList[ancestorList.length-1]){continue;}
forceValue(child,command,propagatedValue,range);}}}
function restoreValues(values,range){$_(values).forEach(function(triple){var node=triple[0];var command=triple[1];var value=triple[2];var ancestor=node;if(!ancestor||ancestor.nodeType!=$_.Node.ELEMENT_NODE){ancestor=ancestor.parentNode;}
while(ancestor&&ancestor.nodeType==$_.Node.ELEMENT_NODE&&getSpecifiedCommandValue(ancestor,command)===null){ancestor=ancestor.parentNode;}
if(value===null&&ancestor&&ancestor.nodeType==$_.Node.ELEMENT_NODE){pushDownValues(node,command,null,range);}else if((ancestor&&ancestor.nodeType==$_.Node.ELEMENT_NODE&&!areEquivalentValues(command,getSpecifiedCommandValue(ancestor,command),value))||((!ancestor||ancestor.nodeType!=$_.Node.ELEMENT_NODE)&&value!==null)){forceValue(node,command,value,range);}});}
function setSelectionValue(command,newValue,range){range=range||getActiveRange();if(!$_(getAllEffectivelyContainedNodes(range)).filter(function(node){return node.nodeType==$_.Node.TEXT_NODE;},true).some(isEditable)){if(commands[command].hasOwnProperty("inlineCommandActivatedValues")){setStateOverride(command,$_(commands[command].inlineCommandActivatedValues).indexOf(newValue)!=-1,range);}
if(command=="subscript"){unsetStateOverride("superscript",range);}
if(command=="superscript"){unsetStateOverride("subscript",range);}
if(newValue===null){unsetValueOverride(command,range);}else if(commands[command].hasOwnProperty("value")){setValueOverride(command,newValue,range);}
return;}
if(isEditable(range.startContainer)&&range.startContainer.nodeType==$_.Node.TEXT_NODE&&range.startOffset!=0&&range.startOffset!=getNodeLength(range.startContainer)){var newNode=range.startContainer.splitText(range.startOffset);var newActiveRange=Aloha.createRange();if(range.startContainer==range.endContainer){var newEndOffset=range.endOffset-range.startOffset;newActiveRange.setEnd(newNode,newEndOffset);range.setEnd(newNode,newEndOffset);}
newActiveRange.setStart(newNode,0);Aloha.getSelection().removeAllRanges();Aloha.getSelection().addRange(newActiveRange);range.setStart(newNode,0);}
if(isEditable(range.endContainer)&&range.endContainer.nodeType==$_.Node.TEXT_NODE&&range.endOffset!=0&&range.endOffset!=getNodeLength(range.endContainer)){var activeRange=range;var newStart=[activeRange.startContainer,activeRange.startOffset];var newEnd=[activeRange.endContainer,activeRange.endOffset];activeRange.endContainer.splitText(activeRange.endOffset);activeRange.setStart(newStart[0],newStart[1]);activeRange.setEnd(newEnd[0],newEnd[1]);Aloha.getSelection().removeAllRanges();Aloha.getSelection().addRange(activeRange);}
$_(getAllEffectivelyContainedNodes(getActiveRange(),function(node){return isEditable(node)&&node.nodeType==$_.Node.ELEMENT_NODE;})).forEach(function(element){clearValue(element,command,range);});$_(getAllEffectivelyContainedNodes(range,isEditable)).forEach(function(node){pushDownValues(node,command,newValue,range);forceValue(node,command,newValue,range);});}
function getBlockAtNextPosition(node,offset){var i;if(node.nodeType===$_.Node.TEXT_NODE&&offset<node.length){for(i=offset;i<node.length;i++){if((node.data.charAt(i)!=='\t'&&node.data.charAt(i)!=='\r'&&node.data.charAt(i)!=='\n')||node.data.charCodeAt(i)===160){return false;}}}
if(node.nextSibling&&node.nextSibling.className&&node.nextSibling.className.indexOf("aloha-table-wrapper")>=0){return node.nextSibling;}
if(node.parentNode&&node.parentNode.nextSibling&&node.parentNode.nextSibling.className&&node.parentNode.nextSibling.className.indexOf("aloha-table-wrapper")>=0){return node.parentNode.nextSibling;}
if(node.parentNode&&node.parentNode.nextSibling&&isWhitespaceNode(node.parentNode.nextSibling)&&node.parentNode.nextSibling.nextSibling&&node.parentNode.nextSibling.nextSibling.className&&node.parentNode.nextSibling.nextSibling.className.indexOf("aloha-table-wrapper")>=0){return node.parentNode.nextSibling.nextSibling;}}
function getBlockAtPreviousPosition(node,offset){var i;if(node.nodeType===$_.Node.TEXT_NODE&&offset>0){for(i=offset-1;i>=0;i--){if((node.data.charAt(i)!=='\t'&&node.data.charAt(i)!=='\r'&&node.data.charAt(i)!=='\n')||node.data.charCodeAt(i)===160){return false;}}}
if(node.previousSibling&&node.previousSibling.className&&node.previousSibling.className.indexOf("aloha-table-wrapper")>=0){return node.previousSibling;}
if(node.parentNode&&node.parentNode.previousSibling&&node.parentNode.previousSibling.className&&node.parentNode.previousSibling.className.indexOf("aloha-table-wrapper")>=0){return node.parentNode.previousSibling;}
if(node.parentNode&&node.parentNode.previousSibling&&isWhitespaceNode(node.parentNode.previousSibling)&&node.parentNode.previousSibling.previousSibling&&node.parentNode.previousSibling.previousSibling.className&&node.parentNode.previousSibling.previousSibling.className.indexOf('aloha-table-wrapper')>=0){return node.parentNode.previousSibling.previousSibling;}
return false;}
function isBlockStartPoint(node,offset){return(!node.parentNode&&offset==0)||(0<=offset-1&&offset-1<node.childNodes.length&&isVisible(node.childNodes[offset-1])&&(isBlockNode(node.childNodes[offset-1])||isNamedHtmlElement(node.childNodes[offset-1],"br")));}
function isBlockEndPoint(node,offset){return(!node.parentNode&&offset==getNodeLength(node))||(offset<node.childNodes.length&&isVisible(node.childNodes[offset])&&isBlockNode(node.childNodes[offset]));}
function isBlockBoundaryPoint(node,offset){return isBlockStartPoint(node,offset)||isBlockEndPoint(node,offset);}
function followsLineBreak(node){var offset=0;while(!isBlockBoundaryPoint(node,offset)){if(0<=offset-1&&offset-1<node.childNodes.length&&isVisible(node.childNodes[offset-1])){return false;}
if(offset==0||!node.hasChildNodes()){offset=getNodeIndex(node);node=node.parentNode;}else{node=node.childNodes[offset-1];offset=getNodeLength(node);}}
return true;}
function precedesLineBreak(node){var offset=getNodeLength(node);while(!isBlockBoundaryPoint(node,offset)){if(offset<node.childNodes.length&&isVisible(node.childNodes[offset])){return false;}
if(offset==getNodeLength(node)||!node.hasChildNodes()){offset=1+getNodeIndex(node);node=node.parentNode;}else{node=node.childNodes[offset];offset=0;}}
return true;}
function splitParent(nodeList,range){var i;var originalParent=nodeList[0].parentNode;if(!isEditable(originalParent)||!originalParent.parentNode){return;}
if(jQuery.inArray(originalParent.firstChild,nodeList)!=-1){removeExtraneousLineBreaksBefore(originalParent);}
var firstChildInNodeList=jQuery.inArray(originalParent.firstChild,nodeList)!=-1;var lastChildInNodeList=jQuery.inArray(originalParent.lastChild,nodeList)!=-1;var followsLineBreak_=firstChildInNodeList&&followsLineBreak(originalParent);var precedesLineBreak_=lastChildInNodeList&&precedesLineBreak(originalParent);if(!firstChildInNodeList&&lastChildInNodeList){for(i=nodeList.length-1;i>=0;i--){movePreservingRanges(nodeList[i],originalParent.parentNode,1+getNodeIndex(originalParent),range);}
if(precedesLineBreak_&&!precedesLineBreak(nodeList[nodeList.length-1])){nodeList[nodeList.length-1].parentNode.insertBefore(document.createElement("br"),nodeList[nodeList.length-1].nextSibling);}
removeExtraneousLineBreaksAtTheEndOf(originalParent);return;}
if(!firstChildInNodeList){var clonedParent=originalParent.cloneNode(false);originalParent.removeAttribute("id");originalParent.parentNode.insertBefore(clonedParent,originalParent);while(nodeList[0].previousSibling){movePreservingRanges(originalParent.firstChild,clonedParent,clonedParent.childNodes.length,range);}}
for(i=0;i<nodeList.length;i++){movePreservingRanges(nodeList[i],originalParent.parentNode,getNodeIndex(originalParent),range);}
if(followsLineBreak_&&!followsLineBreak(nodeList[0])){nodeList[0].parentNode.insertBefore(document.createElement("br"),nodeList[0]);}
if(isInlineNode(nodeList[nodeList.length-1])&&!isNamedHtmlElement(nodeList[nodeList.length-1],"br")&&isNamedHtmlElement(originalParent.firstChild,"br")&&!isInlineNode(originalParent)){originalParent.removeChild(originalParent.firstChild);}
if(!originalParent.hasChildNodes()){if(originalParent.parentNode===range.startContainer&&originalParent.parentNode===range.endContainer&&range.startContainer===range.endContainer&&range.startOffset===range.endOffset&&originalParent.parentNode.childNodes.length===range.startOffset){range.startOffset=originalParent.parentNode.childNodes.length-1;range.endOffset=range.startOffset;}
originalParent.parentNode.removeChild(originalParent);if(precedesLineBreak_&&!precedesLineBreak(nodeList[nodeList.length-1])){nodeList[nodeList.length-1].parentNode.insertBefore(document.createElement("br"),nodeList[nodeList.length-1].nextSibling);}}else{removeExtraneousLineBreaksBefore(originalParent);}
if(!nodeList[nodeList.length-1].nextSibling&&nodeList[nodeList.length-1].parentNode){removeExtraneousLineBreaksAtTheEndOf(nodeList[nodeList.length-1].parentNode);}}
commands.backcolor={action:function(value,range){if(/^([0-9a-fA-F]{3}){1,2}$/.test(value)){value="#"+value;}
if(!/^(rgba?|hsla?)\(.*\)$/.test(value)&&!parseSimpleColor(value)&&value.toLowerCase()!="transparent"){return;}
setSelectionValue("backcolor",value,range);},standardInlineValueCommand:true,relevantCssProperty:"backgroundColor",equivalentValues:function(val1,val2){return normalizeColor(val1)===normalizeColor(val2);}};commands.bold={action:function(value,range){if(myQueryCommandState("bold",range)){setSelectionValue("bold","normal",range);}else{setSelectionValue("bold","bold",range);}},inlineCommandActivatedValues:["bold","600","700","800","900"],relevantCssProperty:"fontWeight",equivalentValues:function(val1,val2){return val1==val2||(val1=="bold"&&val2=="700")||(val1=="700"&&val2=="bold")||(val1=="normal"&&val2=="400")||(val1=="400"&&val2=="normal");}};commands.createlink={action:function(value,range){if(value===""){return;}
$_(getAllEffectivelyContainedNodes(getActiveRange())).forEach(function(node){$_(getAncestors(node)).forEach(function(ancestor){if(isEditable(ancestor)&&isNamedHtmlElement(ancestor,'a')&&hasAttribute(ancestor,"href")){ancestor.setAttribute("href",value);}});});setSelectionValue("createlink",value,range);},standardInlineValueCommand:true};commands.fontname={action:function(value,range){setSelectionValue("fontname",value,range);},standardInlineValueCommand:true,relevantCssProperty:"fontFamily"};commands.fontsize={action:function(value,range){if(value===""){return;}
value=normalizeFontSize(value);if(jQuery.inArray(value,["xx-small","x-small","small","medium","large","x-large","xx-large","xxx-large"])==-1&&!/^[0-9]+(\.[0-9]+)?(cm|mm|in|pt|pc)$/.test(value)){return;}
setSelectionValue("fontsize",value,range);},indeterm:function(){return $_(getAllEffectivelyContainedNodes(getActiveRange(),function(node){return isEditable(node)&&node.nodeType==$_.Node.TEXT_NODE;})).map(function(node){return getEffectiveCommandValue(node,"fontsize");},true).filter(function(value,i,arr){return $_(arr.slice(0,i)).indexOf(value)==-1;}).length>=2;},value:function(range){var node=getAllEffectivelyContainedNodes(range,function(node){return isEditable(node)&&node.nodeType==$_.Node.TEXT_NODE;})[0];if(node===undefined){node=range.startContainer;}
var pixelSize=getEffectiveCommandValue(node,"fontsize");return getLegacyFontSize(pixelSize);},relevantCssProperty:"fontSize"};commands.forecolor={action:function(value,range){if(/^([0-9a-fA-F]{3}){1,2}$/.test(value)){value="#"+value;}
if(!/^(rgba?|hsla?)\(.*\)$/.test(value)&&!parseSimpleColor(value)&&value.toLowerCase()!="transparent"){return;}
setSelectionValue("forecolor",value,range);},standardInlineValueCommand:true,relevantCssProperty:"color",equivalentValues:function(val1,val2){return normalizeColor(val1)===normalizeColor(val2);}};commands.hilitecolor={action:function(value,range){if(/^([0-9a-fA-F]{3}){1,2}$/.test(value)){value="#"+value;}
if(!/^(rgba?|hsla?)\(.*\)$/.test(value)&&!parseSimpleColor(value)&&value.toLowerCase()!="transparent"){return;}
setSelectionValue("hilitecolor",value,range);},indeterm:function(){return $_(getAllEffectivelyContainedNodes(getActiveRange(),function(node){return isEditable(node)&&node.nodeType==$_.Node.TEXT_NODE;})).map(function(node){return getEffectiveCommandValue(node,"hilitecolor");},true).filter(function(value,i,arr){return $_(arr.slice(0,i)).indexOf(value)==-1;}).length>=2;},standardInlineValueCommand:true,relevantCssProperty:"backgroundColor",equivalentValues:function(val1,val2){return normalizeColor(val1)===normalizeColor(val2);}};commands.italic={action:function(value,range){if(myQueryCommandState("italic",range)){setSelectionValue("italic","normal",range);}else{setSelectionValue("italic","italic",range);}},inlineCommandActivatedValues:["italic","oblique"],relevantCssProperty:"fontStyle"};commands.removeformat={action:function(value,range){var newEnd,newStart,newNode;function isRemoveFormatCandidate(node){return isEditable(node)&&isHtmlElementInArray(node,["abbr","acronym","b","bdi","bdo","big","blink","cite","code","dfn","em","font","i","ins","kbd","mark","nobr","q","s","samp","small","span","strike","strong","sub","sup","tt","u","var"]);}
var elementsToRemove=getAllEffectivelyContainedNodes(getActiveRange(),isRemoveFormatCandidate);$_(elementsToRemove).forEach(function(element){while(element.hasChildNodes()){movePreservingRanges(element.firstChild,element.parentNode,getNodeIndex(element),getActiveRange());}
element.parentNode.removeChild(element);});if(isEditable(getActiveRange().startContainer)&&getActiveRange().startContainer.nodeType==$_.Node.TEXT_NODE&&getActiveRange().startOffset!=0&&getActiveRange().startOffset!=getNodeLength(getActiveRange().startContainer)){if(getActiveRange().startContainer==getActiveRange().endContainer){newEnd=getActiveRange().endOffset-getActiveRange().startOffset;newNode=getActiveRange().startContainer.splitText(getActiveRange().startOffset);getActiveRange().setStart(newNode,0);getActiveRange().setEnd(newNode,newEnd);}else{getActiveRange().setStart(getActiveRange().startContainer.splitText(getActiveRange().startOffset),0);}}
if(isEditable(getActiveRange().endContainer)&&getActiveRange().endContainer.nodeType==$_.Node.TEXT_NODE&&getActiveRange().endOffset!=0&&getActiveRange().endOffset!=getNodeLength(getActiveRange().endContainer)){newStart=[getActiveRange().startContainer,getActiveRange().startOffset];newEnd=[getActiveRange().endContainer,getActiveRange().endOffset];getActiveRange().setEnd(document.documentElement,0);newEnd[0].splitText(newEnd[1]);getActiveRange().setStart(newStart[0],newStart[1]);getActiveRange().setEnd(newEnd[0],newEnd[1]);}
$_(getAllEffectivelyContainedNodes(getActiveRange(),isEditable)).forEach(function(node){while(isRemoveFormatCandidate(node.parentNode)&&inSameEditingHost(node.parentNode,node)){splitParent([node],getActiveRange());}});$_(["subscript","bold","fontname","fontsize","forecolor","hilitecolor","italic","strikethrough","underline"]).forEach(function(command){setSelectionValue(command,null,range);});}};commands.strikethrough={action:function(value,range){if(myQueryCommandState("strikethrough",range)){setSelectionValue("strikethrough",null,range);}else{setSelectionValue("strikethrough","line-through",range);}},inlineCommandActivatedValues:["line-through"]};commands.subscript={action:function(value,range){var state=myQueryCommandState("subscript",range);setSelectionValue("subscript",null,range);if(!state){setSelectionValue("subscript","subscript",range);}},indeterm:function(){var nodes=getAllEffectivelyContainedNodes(getActiveRange(),function(node){return isEditable(node)&&node.nodeType==$_.Node.TEXT_NODE;});return(($_(nodes).some(function(node){return getEffectiveCommandValue(node,"subscript")=="subscript";})&&$_(nodes).some(function(node){return getEffectiveCommandValue(node,"subscript")!="subscript";}))||$_(nodes).some(function(node){return getEffectiveCommandValue(node,"subscript")=="mixed";}));},inlineCommandActivatedValues:["subscript"]};commands.superscript={action:function(value,range){var state=myQueryCommandState("superscript",range);setSelectionValue("superscript",null,range);if(!state){setSelectionValue("superscript","superscript",range);}},indeterm:function(){var nodes=getAllEffectivelyContainedNodes(getActiveRange(),function(node){return isEditable(node)&&node.nodeType==$_.Node.TEXT_NODE;});return(($_(nodes).some(function(node){return getEffectiveCommandValue(node,"superscript")=="superscript";})&&$_(nodes).some(function(node){return getEffectiveCommandValue(node,"superscript")!="superscript";}))||$_(nodes).some(function(node){return getEffectiveCommandValue(node,"superscript")=="mixed";}));},inlineCommandActivatedValues:["superscript"]};commands.underline={action:function(value,range){if(myQueryCommandState("underline",range)){setSelectionValue("underline",null,range);}else{setSelectionValue("underline","underline",range);}},inlineCommandActivatedValues:["underline"]};commands.unlink={action:function(){var range=getActiveRange();var hyperlinks=[];var node;for(node=range.startContainer;node;node=node.parentNode){if(isNamedHtmlElement(node,'A')&&hasAttribute(node,"href")){hyperlinks.unshift(node);}}
for(node=range.startContainer;node!=nextNodeDescendants(range.endContainer);node=nextNode(node)){if(isNamedHtmlElement(node,'A')&&hasAttribute(node,"href")&&(isContained(node,range)||isAncestor(node,range.endContainer)||node==range.endContainer)){hyperlinks.push(node);}}
var i;for(i=0;i<hyperlinks.length;i++){clearValue(hyperlinks[i],"unlink",range);}},standardInlineValueCommand:true};function isIndentationElement(node){if(!isAnyHtmlElement(node)){return false;}
if(node.tagName=="BLOCKQUOTE"){return true;}
if(node.tagName!="DIV"){return false;}
if(typeof node.style.length!=='undefined'){var i;for(i=0;i<node.style.length;i++){if(/^(-[a-z]+-)?margin/.test(node.style[i])){return true;}}}else{var s;for(s in node.style){if(/^(-[a-z]+-)?margin/.test(s)&&node.style[s]&&node.style[s]!==0){return true;}}}
return false;}
function isSimpleIndentationElement(node){if(!isIndentationElement(node)){return false;}
if(node.tagName!="BLOCKQUOTE"&&node.tagName!="DIV"){return false;}
var i;for(i=0;i<node.attributes.length;i++){if(!isHtmlNamespace(node.attributes[i].namespaceURI)||jQuery.inArray(node.attributes[i].name,["style","class","dir"])==-1){return false;}}
if(typeof node.style.length!=='undefined'){for(i=0;i<node.style.length;i++){if(!/^(-[a-z]+-)?(margin|border|padding)/.test(node.style[i])){return false;}}}else{var s;for(s in node.style){if(!/^(-[a-z]+-)?(margin|border|padding)/.test(s)&&node.style[s]&&node.style[s]!==0&&node.style[s]!=='false'){return false;}}}
return true;}
function isNonListSingleLineContainer(node){return isHtmlElementInArray(node,["address","div","h1","h2","h3","h4","h5","h6","listing","p","pre","xmp"]);}
function isSingleLineContainer(node){return isNonListSingleLineContainer(node)||isHtmlElementInArray(node,["li","dt","dd"]);}
var defaultSingleLineContainerName="p";function isEndBreak(element){return(isNamedHtmlElement(element,'br')&&element.parentNode.lastChild===element);}
function createEndBreak(){return document.createElement("br");}
function ensureContainerEditable(container){if(!container){return;}
if(isNamedHtmlElement(container.lastChild,"br")){return;}
if($_(container.childNodes).some(isVisible)){return;}
if(!jQuery.browser.msie){container.appendChild(createEndBreak());}else if(jQuery.browser.msie&&jQuery.browser.version<=7&&isHtmlElementInArray(container,["p","h1","h2","h3","h4","h5","h6","pre","blockquote"])){if(!container.firstChild){container.appendChild(document.createTextNode('\u200b'));}}}
function fixDisallowedAncestors(node,range){var i;if(!isEditable(node)){return;}
if($_(getAncestors(node)).every(function(ancestor){return!inSameEditingHost(node,ancestor)||!isAllowedChild(node,ancestor);})&&!isHtmlElement_obsolete(node,defaultSingleLineContainerName)){if(isHtmlElementInArray(node,["dd","dt"])){wrap([node],function(sibling){return isNamedHtmlElement(sibling,'dl')&&!sibling.attributes.length;},function(){return document.createElement("dl");},range);return;}
if(!isProhibitedParagraphChild(node)){return;}
node=setTagName(node,defaultSingleLineContainerName,range);ensureContainerEditable(node);fixDisallowedAncestors(node,range);var descendants=getDescendants(node);for(i=0;i<descendants.length;i++){fixDisallowedAncestors(descendants[i],range);}
return;}
var values=recordValues([node]);var newStartOffset,newEndOffset;while(!isAllowedChild(node,node.parentNode)){for(i=node.parentNode.childNodes.length-1;i>=0;--i){if(node.parentNode.childNodes[i].nodeType==3&&node.parentNode.childNodes[i].data.length==0){node.parentNode.removeChild(node.parentNode.childNodes[i]);if(range.startContainer==node.parentNode&&range.startOffset>i){range.startOffset--;}
if(range.endContainer==node.parentNode&&range.endOffset>i){range.endOffset--;}}}
if(node.parentNode.childNodes.length==1){newStartOffset=range.startOffset;newEndOffset=range.endOffset;if(range.startContainer===node.parentNode&&range.startOffset>getNodeIndex(node)){newStartOffset=range.startOffset+(jQuery(node).contents().length-1);}
if(range.endContainer===node.parentNode&&range.endOffset>getNodeIndex(node)){newEndOffset=range.endOffset+(jQuery(node).contents().length-1);}
jQuery(node).contents().unwrap();range.startOffset=newStartOffset;range.endOffset=newEndOffset;break;}else{var originalParent=node.parentNode;splitParent([node],range);if(originalParent===node.parentNode){newStartOffset=range.startOffset;newEndOffset=range.endOffset;if(range.startContainer===node.parentNode&&range.startOffset>getNodeIndex(node)){newStartOffset=range.startOffset+(jQuery(node).contents().length-1);}
if(range.endContainer===node.parentNode&&range.endOffset>getNodeIndex(node)){newEndOffset=range.endOffset+(jQuery(node).contents().length-1);}
jQuery(node).contents().unwrap();range.startOffset=newStartOffset;range.endOffset=newEndOffset;break;}}}
restoreValues(values,range);}
function normalizeSublists(item,range){if(!isNamedHtmlElement(item,'LI')||!isEditable(item)||!isEditable(item.parentNode)){return;}
var newItem=null;function isOlUl(node){return isHtmlElementInArray(node,["OL","UL"]);}
while($_(item.childNodes).some(isOlUl)){var child=item.lastChild;if(isHtmlElementInArray(child,["OL","UL"])||(!newItem&&child.nodeType==$_.Node.TEXT_NODE&&/^[ \t\n\f\r]*$/.test(child.data))){newItem=null;movePreservingRanges(child,item.parentNode,1+getNodeIndex(item),range);}else{if(!newItem){newItem=item.ownerDocument.createElement("li");item.parentNode.insertBefore(newItem,item.nextSibling);}
movePreservingRanges(child,newItem,0,range);}}}
function unNormalizeSublists(item,range){if(!isHtmlElementInArray(item,["OL","UL"])||!isEditable(item)){return;}
var $list=jQuery(item);$list.children("ol,ul").each(function(index,sublist){if(isNamedHtmlElement(sublist.previousSibling,"LI")){movePreservingRanges(sublist,sublist.previousSibling,sublist.previousSibling.childNodes.length,range);}});}
function blockExtend(range){var startNode=range.startContainer;var startOffset=range.startOffset;var endNode=range.endContainer;var endOffset=range.endOffset;var liAncestors=$_(getAncestors(startNode).concat(startNode)).filter(function(ancestor){return isNamedHtmlElement(ancestor,'li');}).slice(-1);if(liAncestors.length){startOffset=getNodeIndex(liAncestors[0]);startNode=liAncestors[0].parentNode;}
if(!isBlockStartPoint(startNode,startOffset)){do{if(startOffset==0){startOffset=getNodeIndex(startNode);startNode=startNode.parentNode;}else{startOffset--;}}while(!isBlockBoundaryPoint(startNode,startOffset));}
while(startOffset==0&&startNode.parentNode){startOffset=getNodeIndex(startNode);startNode=startNode.parentNode;}
liAncestors=$_(getAncestors(endNode).concat(endNode)).filter(function(ancestor){return isNamedHtmlElement(ancestor,'li');}).slice(-1);if(liAncestors.length){endOffset=1+getNodeIndex(liAncestors[0]);endNode=liAncestors[0].parentNode;}
if(!isBlockEndPoint(endNode,endOffset)){do{if(endOffset==getNodeLength(endNode)){endOffset=1+getNodeIndex(endNode);endNode=endNode.parentNode;}else{endOffset++;}}while(!isBlockBoundaryPoint(endNode,endOffset));}
while(endOffset==getNodeLength(endNode)&&endNode.parentNode){endOffset=1+getNodeIndex(endNode);endNode=endNode.parentNode;}
var newRange=Aloha.createRange();newRange.setStart(startNode,startOffset);newRange.setEnd(endNode,endOffset);return newRange;}
function getSelectionListState(){var newRange=blockExtend(getActiveRange());var nodeList=getContainedNodes(newRange,function(node){return isEditable(node)&&!isIndentationElement(node)&&(isHtmlElementInArray(node,["ol","ul"])||isHtmlElementInArray(node.parentNode,["ol","ul"])||isAllowedChild(node,"li"));});if(!nodeList.length){return"none";}
if($_(nodeList).every(function(node){return(isNamedHtmlElement(node,'ol')||isNamedHtmlElement(node.parentNode,"ol")||(isNamedHtmlElement(node.parentNode,"li")&&isNamedHtmlElement(node.parentNode.parentNode,"ol")));})&&!$_(nodeList).some(function(node){return isNamedHtmlElement(node,'ul')||(node.querySelector&&node.querySelector("ul"));})){return"ol";}
if($_(nodeList).every(function(node){return(isNamedHtmlElement(node,'ul')||isNamedHtmlElement(node.parentNode,"ul")||(isNamedHtmlElement(node.parentNode,"li")&&isNamedHtmlElement(node.parentNode.parentNode,"ul")));})&&!$_(nodeList).some(function(node){return isNamedHtmlElement(node,'ol')||(node.querySelector&&node.querySelector("ol"));})){return"ul";}
var hasOl=$_(nodeList).some(function(node){return(isNamedHtmlElement(node,'ol')||isNamedHtmlElement(node.parentNode,"ol")||(node.querySelector&&node.querySelector("ol"))||(isNamedHtmlElement(node.parentNode,"li")&&isNamedHtmlElement(node.parentNode.parentNode,"ol")));});var hasUl=$_(nodeList).some(function(node){return(isNamedHtmlElement(node,'ul')||isNamedHtmlElement(node.parentNode,"ul")||(node.querySelector&&node.querySelector("ul"))||(isNamedHtmlElement(node.parentNode,"li")&&isNamedHtmlElement(node.parentNode.parentNode,"ul")));});if(hasOl&&hasUl){return"mixed";}
if(hasOl){return"mixed ol";}
if(hasUl){return"mixed ul";}
return"none";}
function getAlignmentValue(node){while((node&&node.nodeType!=$_.Node.ELEMENT_NODE)||(node.nodeType==$_.Node.ELEMENT_NODE&&jQuery.inArray($_.getComputedStyle(node).display,["inline","none"])!=-1)){node=node.parentNode;}
if(!node||node.nodeType!=$_.Node.ELEMENT_NODE){return"left";}
var resolvedValue=$_.getComputedStyle(node).textAlign.replace(/^-(moz|webkit)-/,"").replace(/^auto$/,"start");if(resolvedValue=="start"){return getDirectionality(node)=="ltr"?"left":"right";}
if(resolvedValue=="end"){return getDirectionality(node)=="ltr"?"right":"left";}
if(jQuery.inArray(resolvedValue,["center","justify","left","right"])!=-1){return resolvedValue;}
return"left";}
function recordCurrentOverrides(range){var overrides=[];if(getValueOverride("createlink",range)!==undefined){overrides.push(["createlink",getValueOverride("createlink",range)]);}
$_(["bold","italic","strikethrough","subscript","superscript","underline"]).forEach(function(command){if(getStateOverride(command,range)!==undefined){overrides.push([command,getStateOverride(command,range)]);}});$_(["fontname","fontsize","forecolor","hilitecolor"]).forEach(function(command){if(getValueOverride(command,range)!==undefined){overrides.push([command,getValueOverride(command,range)]);}});return overrides;}
function recordCurrentStatesAndValues(range){var overrides=[];var node=$_(getAllEffectivelyContainedNodes(range)).filter(function(node){return isEditable(node)&&node.nodeType==$_.Node.TEXT_NODE;})[0];if(!node){return overrides;}
overrides.push(["createlink",commands.createlink.value(range)]);$_(["bold","italic","strikethrough","subscript","superscript","underline"]).forEach(function(command){if($_(commands[command].inlineCommandActivatedValues).indexOf(getEffectiveCommandValue(node,command))!=-1){overrides.push([command,true]);}else{overrides.push([command,false]);}});$_(["fontname","fontsize","forecolor","hilitecolor"]).forEach(function(command){overrides.push([command,commands[command].value(range)]);});overrides.push(["fontsize",getEffectiveCommandValue(node,"fontsize")]);return overrides;}
function restoreStatesAndValues(overrides,range){var i;var command;var override;var node=$_(getAllEffectivelyContainedNodes(range)).filter(function(node){return isEditable(node)&&node.nodeType==$_.Node.TEXT_NODE;})[0];function isEditableTextNode(node){return isEditable(node)&&node.nodeType==$_.Node.TEXT_NODE;}
if(node){for(i=0;i<overrides.length;i++){command=overrides[i][0];override=overrides[i][1];if(typeof override=="boolean"&&myQueryCommandState(command,range)!=override){myExecCommand(command);}else if(typeof override=="string"&&command!="fontsize"&&!areEquivalentValues(command,myQueryCommandValue(command,range),override)){myExecCommand(command,false,override,range);}else if(typeof override=="string"&&command=="fontsize"&&((getValueOverride("fontsize",range)!==undefined&&getValueOverride("fontsize",range)!==override)||(getValueOverride("fontsize",range)===undefined&&!areLooselyEquivalentValues(command,getEffectiveCommandValue(node,"fontsize"),override)))){myExecCommand("fontsize",false,override,range);}else{continue;}
node=$_(getAllEffectivelyContainedNodes(range)).filter(isEditableTextNode)[0]||node;}}else{for(i=0;i<overrides.length;i++){command=overrides[i][0];override=overrides[i][1];if(typeof override=="boolean"){setStateOverride(command,override,range);}
if(typeof override=="string"){setValueOverride(command,override,range);}}}}
function canonicalSpaceSequence(n,nonBreakingStart,nonBreakingEnd){if(n==0){return"";}
if(n==1&&!nonBreakingStart&&!nonBreakingEnd){return" ";}
if(n==1){return"\xa0";}
var buffer="";var repeatedPair;if(nonBreakingStart){repeatedPair="\xa0 ";}else{repeatedPair=" \xa0";}
while(n>3){buffer+=repeatedPair;n-=2;}
if(n==3){buffer+=!nonBreakingStart&&!nonBreakingEnd?" \xa0 ":nonBreakingStart&&!nonBreakingEnd?"\xa0\xa0 ":!nonBreakingStart&&nonBreakingEnd?" \xa0\xa0":nonBreakingStart&&nonBreakingEnd?"\xa0 \xa0":"impossible";}else{buffer+=!nonBreakingStart&&!nonBreakingEnd?"\xa0 ":nonBreakingStart&&!nonBreakingEnd?"\xa0 ":!nonBreakingStart&&nonBreakingEnd?" \xa0":nonBreakingStart&&nonBreakingEnd?"\xa0\xa0":"impossible";}
return buffer;}
function canonicalizeWhitespace(node,offset){if(!isEditable(node)&&!isEditingHost(node)){return;}
var startNode=node;var startOffset=offset;while(true){if(0<=startOffset-1&&inSameEditingHost(startNode,startNode.childNodes[startOffset-1])){startNode=startNode.childNodes[startOffset-1];startOffset=getNodeLength(startNode);}else if(startOffset==0&&!followsLineBreak(startNode)&&inSameEditingHost(startNode,startNode.parentNode)){startOffset=getNodeIndex(startNode);startNode=startNode.parentNode;}else if(startNode.nodeType==$_.Node.TEXT_NODE&&jQuery.inArray($_.getComputedStyle(startNode.parentNode).whiteSpace,["pre","pre-wrap"])==-1&&startOffset!=0&&/[ \xa0]/.test(startNode.data[startOffset-1])){startOffset--;}else{break;}}
var endNode=startNode;var endOffset=startOffset;var length=0;var followsSpace=false;while(true){if(endOffset<endNode.childNodes.length&&inSameEditingHost(endNode,endNode.childNodes[endOffset])){endNode=endNode.childNodes[endOffset];endOffset=0;}else if(endOffset==getNodeLength(endNode)&&!precedesLineBreak(endNode)&&inSameEditingHost(endNode,endNode.parentNode)){endOffset=1+getNodeIndex(endNode);endNode=endNode.parentNode;}else if(endNode.nodeType==$_.Node.TEXT_NODE&&jQuery.inArray($_.getComputedStyle(endNode.parentNode).whiteSpace,["pre","pre-wrap"])==-1&&endOffset!=getNodeLength(endNode)&&/[ \xa0]/.test(endNode.data[endOffset])){if(followsSpace&&" "==endNode.data[endOffset]){endNode.deleteData(endOffset,1);continue;}
followsSpace=" "==endNode.data[endOffset];endOffset++;length++;}else{break;}}
var replacementWhitespace=canonicalSpaceSequence(length,startOffset==0&&followsLineBreak(startNode),endOffset==getNodeLength(endNode)&&precedesLineBreak(endNode));while(getPosition(startNode,startOffset,endNode,endOffset)=="before"){if(startOffset<startNode.childNodes.length){startNode=startNode.childNodes[startOffset];startOffset=0;}else if(startNode.nodeType!=$_.Node.TEXT_NODE||startOffset==getNodeLength(startNode)){startOffset=1+getNodeIndex(startNode);startNode=startNode.parentNode;}else{var element=replacementWhitespace[0];replacementWhitespace=replacementWhitespace.slice(1);if(element!=startNode.data[startOffset]){startNode.insertData(startOffset,element);startNode.deleteData(startOffset+1,1);}
startOffset++;}}}
function deleteContents(arg1,arg2,arg3,arg4,arg5){var range;var flags={};var i;if(arguments.length<3){range=arg1;}else{range=Aloha.createRange();range.setStart(arg1,arg2);range.setEnd(arg3,arg4);}
if(arguments.length==2){flags=arg2;}
if(arguments.length==5){flags=arg5;}
var blockMerging=null!=flags.blockMerging?!!flags.blockMerging:true;var stripWrappers=null!=flags.stripWrappers?!!flags.stripWrappers:true;if(!range){return;}
var startNode=range.startContainer;var startOffset=range.startOffset;var endNode=range.endContainer;var endOffset=range.endOffset;var referenceNode;while(startNode.hasChildNodes()){if(startOffset==getNodeLength(startNode)&&inSameEditingHost(startNode,startNode.parentNode)&&isInlineNode(startNode)){startOffset=1+getNodeIndex(startNode);startNode=startNode.parentNode;continue;}
if(startOffset==getNodeLength(startNode)){break;}
referenceNode=startNode.childNodes[startOffset];if(isBlockNode(referenceNode)||(referenceNode.nodeType==$_.Node.ELEMENT_NODE&&!referenceNode.hasChildNodes())||(referenceNode.nodeType!=$_.Node.ELEMENT_NODE&&referenceNode.nodeType!=$_.Node.TEXT_NODE)){break;}
startNode=referenceNode;startOffset=0;}
while(endNode.hasChildNodes()){if(endOffset==0&&inSameEditingHost(endNode,endNode.parentNode)&&isInlineNode(endNode)){endOffset=getNodeIndex(endNode);endNode=endNode.parentNode;continue;}
if(endOffset==0){break;}
referenceNode=endNode.childNodes[endOffset-1];if(isBlockNode(referenceNode)||(referenceNode.nodeType==$_.Node.ELEMENT_NODE&&!referenceNode.hasChildNodes())||(referenceNode.nodeType!=$_.Node.ELEMENT_NODE&&referenceNode.nodeType!=$_.Node.TEXT_NODE)){break;}
endNode=referenceNode;endOffset=getNodeLength(referenceNode);}
if(getPosition(endNode,endOffset,startNode,startOffset)!=="after"){range.setEnd(range.startContainer,range.startOffset);return;}
if(endNode.nodeType==$_.Node.TEXT_NODE&&endOffset==getNodeLength(endNode)&&startNode!=endNode){endOffset=1+getNodeIndex(endNode);endNode=endNode.parentNode;}
range.setStart(startNode,startOffset);range.setEnd(endNode,endOffset);var startBlock=range.startContainer;while(inSameEditingHost(startBlock,startBlock.parentNode)&&isInlineNode(startBlock)){startBlock=startBlock.parentNode;}
if((!isBlockNode(startBlock)&&!isEditingHost(startBlock))||!isAllowedChild("span",startBlock)||isHtmlElementInArray(startBlock,["td","th"])){startBlock=null;}
var endBlock=range.endContainer;while(inSameEditingHost(endBlock,endBlock.parentNode)&&isInlineNode(endBlock)){endBlock=endBlock.parentNode;}
if((!isBlockNode(endBlock)&&!isEditingHost(endBlock))||!isAllowedChild("span",endBlock)||isHtmlElementInArray(endBlock,["td","th"])){endBlock=null;}
var overrides=recordCurrentStatesAndValues(range);var parent_;if(startNode==endNode&&isEditable(startNode)&&startNode.nodeType==$_.Node.TEXT_NODE){parent_=startNode.parentNode;startNode.deleteData(startOffset,endOffset-startOffset);if(startOffset>0&&startNode.data.substr(startOffset-1,1)===' '&&startOffset<startNode.data.length&&startNode.data.substr(startOffset,1)===' '){startNode.replaceData(startOffset-1,1,'\xa0');}
canonicalizeWhitespace(startNode,startOffset);range.setStart(range.startContainer,range.startOffset);range.setEnd(range.startContainer,range.startOffset);restoreStatesAndValues(overrides,range);if((isEditable(parent_)||isEditingHost(parent_))&&!isInlineNode(parent_)){ensureContainerEditable(parent_);}
return;}
if(isEditable(startNode)&&startNode.nodeType==$_.Node.TEXT_NODE){startNode.deleteData(startOffset,getNodeLength(startNode)-startOffset);}
var nodeList=getContainedNodes(range,function(node){return isEditable(node)&&!isHtmlElementInArray(node,["thead","tbody","tfoot","tr","th","td"]);});for(i=0;i<nodeList.length;i++){var node=nodeList[i];parent_=node.parentNode;parent_.removeChild(node);if(stripWrappers||(!isAncestor(parent_,startNode)&&parent_!=startNode)){while(isEditable(parent_)&&isInlineNode(parent_)&&getNodeLength(parent_)==0){var grandparent=parent_.parentNode;grandparent.removeChild(parent_);parent_=grandparent;}}
if((isEditable(parent_)||isEditingHost(parent_))&&!isInlineNode(parent_)){ensureContainerEditable(parent_);}}
if(isEditable(endNode)&&endNode.nodeType==$_.Node.TEXT_NODE){endNode.deleteData(0,endOffset);}
canonicalizeWhitespace(range.startContainer,range.startOffset);canonicalizeWhitespace(range.endContainer,range.endOffset);if(!blockMerging||!startBlock||!endBlock||!inSameEditingHost(startBlock,endBlock)||startBlock==endBlock){range.setEnd(range.startContainer,range.startOffset);restoreStatesAndValues(overrides,range);return;}
if(startBlock.children.length==1&&isCollapsedBlockProp(startBlock.firstChild)){startBlock.removeChild(startBlock.firstChild);}
if(endBlock.children.length==1&&isCollapsedBlockProp(endBlock.firstChild)){endBlock.removeChild(endBlock.firstChild);}
var values;if(isAncestor(startBlock,endBlock)){referenceNode=endBlock;while(referenceNode.parentNode!=startBlock){referenceNode=referenceNode.parentNode;}
range.setStart(startBlock,getNodeIndex(referenceNode));range.setEnd(startBlock,getNodeIndex(referenceNode));if(!endBlock.hasChildNodes()){while(isEditable(endBlock)&&endBlock.parentNode.childNodes.length==1&&endBlock.parentNode!=startBlock){parent_=endBlock;parent_.removeChild(endBlock);endBlock=parent_;}
if(isEditable(endBlock)&&!isInlineNode(endBlock)&&isInlineNode(endBlock.previousSibling)&&isInlineNode(endBlock.nextSibling)){endBlock.parentNode.insertBefore(document.createElement("br"),endBlock.nextSibling);}
if(isEditable(endBlock)){endBlock.parentNode.removeChild(endBlock);}
restoreStatesAndValues(overrides,range);return;}
if(!isInlineNode(endBlock.firstChild)){restoreStatesAndValues(overrides,range);return;}
var children=[];children.push(endBlock.firstChild);while(!isNamedHtmlElement(children[children.length-1],"br")&&isInlineNode(children[children.length-1].nextSibling)){children.push(children[children.length-1].nextSibling);}
values=recordValues(children);while(children[0].parentNode!=startBlock){splitParent(children,range);}
if(isEditable(children[0].previousSibling)&&isNamedHtmlElement(children[0].previousSibling,"br")){children[0].parentNode.removeChild(children[0].previousSibling);}}else if(isDescendant(startBlock,endBlock)){range.setStart(startBlock,getNodeLength(startBlock));range.setEnd(startBlock,getNodeLength(startBlock));referenceNode=startBlock;while(referenceNode.parentNode!=endBlock){referenceNode=referenceNode.parentNode;}
if(isInlineNode(referenceNode.nextSibling)&&isNamedHtmlElement(startBlock.lastChild,"br")){startBlock.removeChild(startBlock.lastChild);}
var nodesToMove=[];if(referenceNode.nextSibling&&!isNamedHtmlElement(referenceNode.nextSibling,"br")&&!isBlockNode(referenceNode.nextSibling)){nodesToMove.push(referenceNode.nextSibling);}
if(nodesToMove.length&&nodesToMove[nodesToMove.length-1].nextSibling&&!isNamedHtmlElement(nodesToMove[nodesToMove.length-1].nextSibling,"br")&&!isBlockNode(nodesToMove[nodesToMove.length-1].nextSibling)){nodesToMove.push(nodesToMove[nodesToMove.length-1].nextSibling);}
values=recordValues(nodesToMove);$_(nodesToMove).forEach(function(node){movePreservingRanges(node,startBlock,-1,range);});if(isNamedHtmlElement(referenceNode.nextSibling,"br")){referenceNode.parentNode.removeChild(referenceNode.nextSibling);}}else{range.setStart(startBlock,getNodeLength(startBlock));range.setEnd(startBlock,getNodeLength(startBlock));if(isInlineNode(endBlock.firstChild)&&isNamedHtmlElement(startBlock.lastChild,"br")){startBlock.removeChild(startBlock.lastChild);}
values=recordValues([].slice.call(toArray(endBlock.childNodes)));while(endBlock.hasChildNodes()){movePreservingRanges(endBlock.firstChild,startBlock,-1,range);}
while(!endBlock.hasChildNodes()){parent_=endBlock.parentNode;parent_.removeChild(endBlock);endBlock=parent_;}}
restoreValues(values,range);ensureContainerEditable(startBlock);restoreStatesAndValues(overrides,range);}
function removePreservingDescendants(node,range){if(node.hasChildNodes()){splitParent([].slice.call(toArray(node.childNodes)),range);}else{node.parentNode.removeChild(node);}}
function cleanLists(node,range){if(node){jQuery(node).find('ul,ol,li').each(function(){jQuery(this).contents().each(function(){if(isWhitespaceNode(this)){var index=getNodeIndex(this);if(range.startContainer===this.parentNode&&range.startOffset>index){range.startOffset--;}else if(range.startContainer===this){range.startContainer=this.parentNode;range.startOffset=index;}
if(range.endContainer===this.parentNode&&range.endOffset>index){range.endOffset--;}else if(range.endContainer===this){range.endContainer=this.parentNode;range.endOffset=index;}
jQuery(this).remove();}});});}}
function indentNodes(nodeList,range){if(!nodeList.length){return;}
var firstNode=nodeList[0];if(isHtmlElementInArray(firstNode.parentNode,["OL","UL"])){var tag=firstNode.parentNode.tagName;wrap(nodeList,function(node){return isHtmlElement_obsolete(node,tag);},function(){return firstNode.ownerDocument.createElement(tag);},range);return;}
var newParent=wrap(nodeList,function(node){return isSimpleIndentationElement(node);},function(){return firstNode.ownerDocument.createElement("blockquote");},range);fixDisallowedAncestors(newParent,range);}
function outdentNode(node,range){if(!isEditable(node)){return;}
if(isSimpleIndentationElement(node)){removePreservingDescendants(node,range);return;}
if(isIndentationElement(node)){node.removeAttribute("class");node.removeAttribute("dir");node.style.margin="";node.style.padding="";node.style.border="";if(node.getAttribute("style")==""){node.removeAttribute("style");}
setTagName(node,"div",range);return;}
var currentAncestor=node.parentNode;var ancestorList=[];while(isEditable(currentAncestor)&&currentAncestor.nodeType==$_.Node.ELEMENT_NODE&&!isSimpleIndentationElement(currentAncestor)&&!isHtmlElementInArray(currentAncestor,["ol","ul"])){ancestorList.push(currentAncestor);currentAncestor=currentAncestor.parentNode;}
if(!isEditable(currentAncestor)||!isSimpleIndentationElement(currentAncestor)){currentAncestor=node.parentNode;ancestorList=[];while(isEditable(currentAncestor)&&currentAncestor.nodeType==$_.Node.ELEMENT_NODE&&!isIndentationElement(currentAncestor)&&!isHtmlElementInArray(currentAncestor,["ol","ul"])){ancestorList.push(currentAncestor);currentAncestor=currentAncestor.parentNode;}}
if(isHtmlElementInArray(node,["OL","UL"])&&(!isEditable(currentAncestor)||!isIndentationElement(currentAncestor))){node.removeAttribute("reversed");node.removeAttribute("start");node.removeAttribute("type");var children=[].slice.call(toArray(node.childNodes));if(node.attributes.length&&!isHtmlElementInArray(node.parentNode,["OL","UL"])){setTagName(node,"div",range);}else{var values=recordValues([].slice.call(toArray(node.childNodes)));removePreservingDescendants(node,range);restoreValues(values,range);}
var i;for(i=0;i<children.length;i++){fixDisallowedAncestors(children[i],range);}
return;}
if(!isEditable(currentAncestor)||!isIndentationElement(currentAncestor)){return;}
ancestorList.push(currentAncestor);var originalAncestor=currentAncestor;while(ancestorList.length){currentAncestor=ancestorList.pop();var target=node.parentNode==currentAncestor?node:ancestorList[ancestorList.length-1];if(isInlineNode(target)&&!isNamedHtmlElement(target,'BR')&&isNamedHtmlElement(target.nextSibling,"BR")){target.parentNode.removeChild(target.nextSibling);}
var precedingSiblings=[].slice.call(toArray(currentAncestor.childNodes),0,getNodeIndex(target));var followingSiblings=[].slice.call(toArray(currentAncestor.childNodes),1+getNodeIndex(target));indentNodes(precedingSiblings,range);indentNodes(followingSiblings,range);}
outdentNode(originalAncestor,range);}
function toggleLists(tagName,range){var mode=getSelectionListState()==tagName?"disable":"enable";tagName=tagName.toUpperCase();var otherTagName=tagName=="OL"?"UL":"OL";var items=[];(function(){var ancestorContainer;for(ancestorContainer=range.endContainer;ancestorContainer!=range.commonAncestorContainer;ancestorContainer=ancestorContainer.parentNode){if(isNamedHtmlElement(ancestorContainer,"li")){items.unshift(ancestorContainer);}}
for(ancestorContainer=range.startContainer;ancestorContainer;ancestorContainer=ancestorContainer.parentNode){if(isNamedHtmlElement(ancestorContainer,"li")){items.unshift(ancestorContainer);}}}());$_(items).forEach(function(thisArg){normalizeSublists(thisArg,range);});var newRange=blockExtend(range);if(mode=="enable"){$_(getAllContainedNodes(newRange,function(node){return isEditable(node)&&isHtmlElement_obsolete(node,otherTagName);})).forEach(function(list){if((isEditable(list.previousSibling)&&isHtmlElement_obsolete(list.previousSibling,tagName))||(isEditable(list.nextSibling)&&isHtmlElement_obsolete(list.nextSibling,tagName))){var children=[].slice.call(toArray(list.childNodes));var values=recordValues(children);splitParent(children,range);wrap(children,function(node){return isHtmlElement_obsolete(node,tagName);},function(){return null;},range);restoreValues(values,range);}else{setTagName(list,tagName,range);}});}
var nodeList=getContainedNodes(newRange,function(node){return isEditable(node)&&!isIndentationElement(node)&&(isHtmlElementInArray(node,["OL","UL"])||isHtmlElementInArray(node.parentNode,["OL","UL"])||isAllowedChild(node,"li"));});if(mode=="enable"){nodeList=$_(nodeList).filter(function(node){return!isHtmlElementInArray(node,["ol","ul"])||isHtmlElementInArray(node.parentNode,["ol","ul"]);});}
var sublist,values;function createLi(){return document.createElement("li");}
function isOlUl(node){return isHtmlElementInArray(node,["ol","ul"]);}
function makeIsElementPred(tagName){return function(node){return isHtmlElement_obsolete(node,tagName);};}
function makeCreateElement(tagName){return function(){return document.createElement(tagName);};}
function makeCreateElementSublist(tagName,sublist,range){return function(){if(!isEditable(sublist[0].parentNode)||!isSimpleIndentationElement(sublist[0].parentNode)||!isEditable(sublist[0].parentNode.previousSibling)||!isHtmlElement_obsolete(sublist[0].parentNode.previousSibling,tagName)){return document.createElement(tagName);}
var list=sublist[0].parentNode.previousSibling;normalizeSublists(list.lastChild,range);if(!isEditable(list.lastChild)||!isHtmlElement_obsolete(list.lastChild,tagName)){list.appendChild(document.createElement(tagName));}
return list.lastChild;};}
if(mode=="disable"){while(nodeList.length){sublist=[];sublist.push(nodeList.shift());if(isHtmlElement_obsolete(sublist[0],tagName)){outdentNode(sublist[0],range);continue;}
while(nodeList.length&&nodeList[0]==sublist[sublist.length-1].nextSibling&&!isHtmlElement_obsolete(nodeList[0],tagName)){sublist.push(nodeList.shift());}
values=recordValues(sublist);splitParent(sublist,range);var i;for(i=0;i<sublist.length;i++){fixDisallowedAncestors(sublist[i],range);}
restoreValues(values,range);}}else{while(nodeList.length){sublist=[];while(!sublist.length||(nodeList.length&&nodeList[0]==sublist[sublist.length-1].nextSibling)){if(isHtmlElementInArray(nodeList[0],["p","div"])){sublist.push(setTagName(nodeList[0],"li",range));nodeList.shift();}else if(isHtmlElementInArray(nodeList[0],["li","ol","ul"])){sublist.push(nodeList.shift());}else{var nodesToWrap=[];while(!nodesToWrap.length||(nodeList.length&&nodeList[0]==nodesToWrap[nodesToWrap.length-1].nextSibling&&isInlineNode(nodeList[0])&&isInlineNode(nodesToWrap[nodesToWrap.length-1])&&!isNamedHtmlElement(nodesToWrap[nodesToWrap.length-1],"br"))){nodesToWrap.push(nodeList.shift());}
sublist.push(wrap(nodesToWrap,undefined,createLi,range));}}
if(isHtmlElement_obsolete(sublist[0].parentNode,tagName)||$_(sublist).every(isOlUl)){continue;}
if(isHtmlElement_obsolete(sublist[0].parentNode,otherTagName)){values=recordValues(sublist);splitParent(sublist,range);wrap(sublist,makeIsElementPred(tagName),makeCreateElement(tagName),range);restoreValues(values,range);continue;}
fixDisallowedAncestors(wrap(sublist,makeIsElementPred(tagName),makeCreateElementSublist(tagName,sublist,range),range),range);}}}
function justifySelection(alignment,range){var newRange=blockExtend(range);var elementList=getAllContainedNodes(newRange,function(node){return node.nodeType==$_.Node.ELEMENT_NODE&&isEditable(node)&&(hasAttribute(node,"align")||node.style.textAlign!=""||isNamedHtmlElement(node,'center'));});var i;for(i=0;i<elementList.length;i++){var element=elementList[i];element.removeAttribute("align");element.style.textAlign="";if(element.getAttribute("style")==""){element.removeAttribute("style");}
if(isHtmlElementInArray(element,["div","span","center"])&&!element.attributes.length){removePreservingDescendants(element,range);}
if(isNamedHtmlElement(element,'center')&&element.attributes.length){setTagName(element,"div",range);}}
newRange=blockExtend(globalRange);var nodeList=[];nodeList=getContainedNodes(newRange,function(node){return isEditable(node)&&isAllowedChild(node,"div")&&getAlignmentValue(node)!=alignment;});function makeIsAlignedDiv(alignment){return function(node){return isNamedHtmlElement(node,'div')&&$_(node.attributes).every(function(attr){return(attr.name=="align"&&attr.value.toLowerCase()==alignment)||(attr.name=="style"&&getStyleLength(node)==1&&node.style.textAlign==alignment);});};}
function makeCreateAlignedDiv(alignment){return function(){var newParent=document.createElement("div");newParent.setAttribute("style","text-align: "+alignment);return newParent;};}
while(nodeList.length){var sublist=[];sublist.push(nodeList.shift());while(nodeList.length&&nodeList[0]==sublist[sublist.length-1].nextSibling){sublist.push(nodeList.shift());}
wrap(sublist,makeIsAlignedDiv(alignment),makeCreateAlignedDiv(alignment),range);}}
function moveOverZWSP(range,forward){var offset;if(!range.collapsed){return;}
offset=range.startOffset;if(forward){if(range.startContainer&&range.startContainer.nodeType===$_.Node.TEXT_NODE){while(offset<range.startContainer.data.length&&range.startContainer.data.charAt(offset)==='\u200b'){offset++;}}}else{if(range.startContainer&&range.startContainer.nodeType===$_.Node.TEXT_NODE){while(offset>0&&range.startContainer.data.charAt(offset-1)==='\u200b'){offset--;}}}
if(offset!==range.startOffset){range.setStart(range.startContainer,offset);range.setEnd(range.startContainer,offset);}}
commands["delete"]={action:function(value,range){var i;if(jQuery.browser.msie&&jQuery.browser.version<=7){moveOverZWSP(range,false);}
if(!range.collapsed){deleteContents(range);return;}
canonicalizeWhitespace(range.startContainer,range.startOffset);var node=range.startContainer;var offset=range.startOffset;var isBr=false;var isHr=false;while(true){if(offset>0){isBr=isNamedHtmlElement(node.childNodes[offset-1],"br")||false;isHr=isNamedHtmlElement(node.childNodes[offset-1],"hr")||false;}
if(offset==0&&isEditable(node.previousSibling)&&isInvisible(node.previousSibling)){node.parentNode.removeChild(node.previousSibling);continue;}
if(0<=offset-1&&offset-1<node.childNodes.length&&isEditable(node.childNodes[offset-1])&&(isInvisible(node.childNodes[offset-1])||isBr||isHr)){node.removeChild(node.childNodes[offset-1]);offset--;if(isBr||isHr){range.setStart(node,offset);range.setEnd(node,offset);return;}
continue;}
if((offset==0&&isInlineNode(node))||isInvisible(node)){offset=getNodeIndex(node);node=node.parentNode;continue;}
if(0<=offset-1&&offset-1<node.childNodes.length&&isEditable(node.childNodes[offset-1])&&isNamedHtmlElement(node.childNodes[offset-1],"a")){removePreservingDescendants(node.childNodes[offset-1],range);return;}
if(0<=offset-1&&offset-1<node.childNodes.length&&!isBlockNode(node.childNodes[offset-1])&&!isHtmlElementInArray(node.childNodes[offset-1],["br","img"])){node=node.childNodes[offset-1];offset=getNodeLength(node);continue;}
var brk=true;if(brk){break;}}
var delBlock=getBlockAtPreviousPosition(node,offset);if(delBlock){delBlock.parentNode.removeChild(delBlock);return;}
if(node.nodeType==$_.Node.TEXT_NODE&&offset!=0){range.setStart(node,offset-1);range.setEnd(node,offset-1);deleteContents(node,offset-1,node,offset);return;}
if(node.nodeType==$_.Node.TEXT_NODE&&offset==0&&jQuery.browser.msie){offset=1;range.setStart(node,offset);range.setEnd(node,offset);range.startOffset=0;deleteContents(range);return;}
if(isInlineNode(node)){return;}
if(0<=offset-1&&offset-1<node.childNodes.length&&isHtmlElementInArray(node.childNodes[offset-1],["br","hr","img"])){range.setStart(node,offset);range.setEnd(node,offset);deleteContents(range);return;}
if(isHtmlElementInArray(node,["li","dt","dd"])&&node==node.parentNode.firstChild&&offset==0){var items=[];var ancestor;for(ancestor=node.parentNode;ancestor;ancestor=ancestor.parentNode){if(isNamedHtmlElement(ancestor,'li')){items.unshift(ancestor);}}
for(i=0;i<items.length;i++){normalizeSublists(items[i],range);}
var values=recordValues([node]);splitParent([node],range);restoreValues(values,range);if(isHtmlElementInArray(node,["dd","dt"])&&$_(getAncestors(node)).every(function(ancestor){return!inSameEditingHost(node,ancestor)||!isAllowedChild(node,ancestor);})){node=setTagName(node,defaultSingleLineContainerName,range);}
fixDisallowedAncestors(node,range);for(i=0;i<items.length;i++){unNormalizeSublists(items[i].parentNode,range);}
return;}
var startNode=node;var startOffset=offset;while(true){if(startOffset==0){startOffset=getNodeIndex(startNode);startNode=startNode.parentNode;}else if(0<=startOffset-1&&startOffset-1<startNode.childNodes.length&&isEditable(startNode.childNodes[startOffset-1])&&isInvisible(startNode.childNodes[startOffset-1])){startNode.removeChild(startNode.childNodes[startOffset-1]);startOffset--;}else{break;}}
if(offset==0&&$_(getAncestors(node).concat(node)).filter(function(ancestor){return isEditable(ancestor)&&inSameEditingHost(ancestor,node)&&isIndentationElement(ancestor);}).length){var newRange=Aloha.createRange();newRange.setStart(node,0);newRange.setEnd(node,0);newRange=blockExtend(newRange);var nodeList=getContainedNodes(newRange,function(currentNode){return isEditable(currentNode)&&!hasEditableDescendants(currentNode);});for(i=0;i<nodeList.length;i++){outdentNode(nodeList[i],range);}
return;}
if(isNamedHtmlElement(startNode.childNodes[startOffset],"table")){return;}
if(0<=startOffset-1&&startOffset-1<startNode.childNodes.length&&isNamedHtmlElement(startNode.childNodes[startOffset-1],"table")){range.setStart(startNode,startOffset-1);range.setEnd(startNode,startOffset);return;}
if(offset==0&&(isNamedHtmlElement(startNode.childNodes[startOffset-1],"hr")||(isNamedHtmlElement(startNode.childNodes[startOffset-1],"br")&&(isNamedHtmlElement(startNode.childNodes[startOffset-1].previousSibling,"br")||!isInlineNode(startNode.childNodes[startOffset-1].previousSibling))))){range.setStart(node,offset);range.setEnd(node,offset);deleteContents(startNode,startOffset-1,startNode,startOffset);return;}
if(isHtmlElementInArray(startNode.childNodes[startOffset],["li","dt","dd"])&&isInlineNode(startNode.childNodes[startOffset].firstChild)&&startOffset!=0){var previousItem=startNode.childNodes[startOffset-1];if(isInlineNode(previousItem.lastChild)&&!isNamedHtmlElement(previousItem.lastChild,"br")){previousItem.appendChild(document.createElement("br"));}
if(isInlineNode(previousItem.lastChild)){previousItem.appendChild(document.createElement("br"));}}
if(isHtmlElementInArray(startNode.childNodes[startOffset],["li","dt","dd"])&&isHtmlElementInArray(startNode.childNodes[startOffset-1],["li","dt","dd"])){startNode=startNode.childNodes[startOffset-1];startOffset=getNodeLength(startNode);node=startNode.nextSibling;offset=0;}else{while(0<=startOffset-1&&startOffset-1<startNode.childNodes.length){if(isEditable(startNode.childNodes[startOffset-1])&&isInvisible(startNode.childNodes[startOffset-1])){startNode.removeChild(startNode.childNodes[startOffset-1]);startOffset--;}else{startNode=startNode.childNodes[startOffset-1];startOffset=getNodeLength(startNode);}}}
var delRange=Aloha.createRange();delRange.setStart(startNode,startOffset);delRange.setEnd(node,offset);deleteContents(delRange);if(!isAncestorContainer(document.body,range.startContainer)){if(delRange.startContainer.hasChildNodes()||delRange.startContainer.nodeType==$_.Node.TEXT_NODE){range.setStart(delRange.startContainer,delRange.startOffset);range.setEnd(delRange.startContainer,delRange.startOffset);}else{range.setStart(delRange.startContainer.parentNode,getNodeIndex(delRange.startContainer));range.setEnd(delRange.startContainer.parentNode,getNodeIndex(delRange.startContainer));}}}};var formattableBlockNames=["address","dd","div","dt","h1","h2","h3","h4","h5","h6","p","pre"];commands.formatblock={action:function(value){var i;if(/^<.*>$/.test(value)){value=value.slice(1,-1);}
value=value.toLowerCase();if($_(formattableBlockNames).indexOf(value)==-1){return;}
var newRange=blockExtend(getActiveRange());var nodeList=getContainedNodes(newRange,function(node){return isEditable(node)&&(isNonListSingleLineContainer(node)||isAllowedChild(node,"p")||isHtmlElementInArray(node,["dd","dt"]))&&!$_(getDescendants(node)).some(isProhibitedParagraphChild);});var values=recordValues(nodeList);function makeIsEditableElementInSameEditingHostDoesNotContainProhibitedParagraphChildren(node){return function(ancestor){return(isEditable(ancestor)&&inSameEditingHost(ancestor,node)&&isHtmlElement_obsolete(ancestor,formattableBlockNames)&&!$_(getDescendants(ancestor)).some(isProhibitedParagraphChild));};}
function makeIsElementWithoutAttributes(value){return function(node){return isHtmlElement_obsolete(node,value)&&!node.attributes.length;};}
function returnFalse(){return false;}
function makeCreateElement(value){return function(){return document.createElement(value);};}
for(i=0;i<nodeList.length;i++){var node=nodeList[i];while($_(getAncestors(node)).some(makeIsEditableElementInSameEditingHostDoesNotContainProhibitedParagraphChildren(node))){splitParent([node],newRange);}}
restoreValues(values,newRange);while(nodeList.length){var sublist;if(isSingleLineContainer(nodeList[0])){sublist=[].slice.call(toArray(nodeList[0].childNodes));values=recordValues(sublist);removePreservingDescendants(nodeList[0],newRange);restoreValues(values,newRange);nodeList.shift();}else{sublist=[];sublist.push(nodeList.shift());while(nodeList.length&&nodeList[0]==sublist[sublist.length-1].nextSibling&&!isSingleLineContainer(nodeList[0])&&!isNamedHtmlElement(sublist[sublist.length-1],"BR")){sublist.push(nodeList.shift());}}
fixDisallowedAncestors(wrap(sublist,jQuery.inArray(value,["div","p"])==-1?makeIsElementWithoutAttributes(value):returnFalse,makeCreateElement(value),newRange),newRange);}},indeterm:function(){var newRange=blockExtend(getActiveRange());var nodeList=getAllContainedNodes(newRange,function(node){return isVisible(node)&&isEditable(node)&&!node.hasChildNodes();});if(!nodeList.length){return false;}
var type=null;var i;for(i=0;i<nodeList.length;i++){var node=nodeList[i];while(isEditable(node.parentNode)&&inSameEditingHost(node,node.parentNode)&&!isHtmlElement_obsolete(node,formattableBlockNames)){node=node.parentNode;}
var currentType="";if(isEditable(node)&&isHtmlElement_obsolete(node,formattableBlockNames)&&!$_(getDescendants(node)).some(isProhibitedParagraphChild)){currentType=node.tagName;}
if(type===null){type=currentType;}else if(type!=currentType){return true;}}
return false;},value:function(){var newRange=blockExtend(getActiveRange());var nodes=getAllContainedNodes(newRange,function(node){return isVisible(node)&&isEditable(node)&&!node.hasChildNodes();});if(!nodes.length){return"";}
var node=nodes[0];while(isEditable(node.parentNode)&&inSameEditingHost(node,node.parentNode)&&!isHtmlElement_obsolete(node,formattableBlockNames)){node=node.parentNode;}
if(isEditable(node)&&isHtmlElement_obsolete(node,formattableBlockNames)&&!$_(getDescendants(node)).some(isProhibitedParagraphChild)){return node.tagName.toLowerCase();}
return"";}};commands.forwarddelete={action:function(value,range){if(jQuery.browser.msie&&jQuery.browser.version<=7){moveOverZWSP(range,true);}
if(!range.collapsed){deleteContents(range);return;}
canonicalizeWhitespace(range.startContainer,range.startOffset);var node=range.startContainer;var offset=range.startOffset;var isBr=false;var isHr=false;while(true){if(offset==getNodeLength(node)&&isEditable(node.nextSibling)&&isInvisible(node.nextSibling)){node.parentNode.removeChild(node.nextSibling);}else if(offset<node.childNodes.length&&isEditable(node.childNodes[offset])&&(isInvisible(node.childNodes[offset])||isBr||isHr)){node.removeChild(node.childNodes[offset]);if(isBr||isHr){ensureContainerEditable(node);range.setStart(node,offset);range.setEnd(node,offset);return;}}else if(offset<node.childNodes.length&&isCollapsedBlockProp(node.childNodes[offset])){offset++;}else if((offset==getNodeLength(node)&&isInlineNode(node))||isInvisible(node)){offset=1+getNodeIndex(node);node=node.parentNode;}else if(offset<node.childNodes.length&&!isBlockNode(node.childNodes[offset])&&!isHtmlElementInArray(node.childNodes[offset],["br","img"])){node=node.childNodes[offset];offset=0;}else{break;}}
canonicalizeWhitespace(range.startContainer,range.startOffset);var delBlock=getBlockAtNextPosition(node,offset);if(delBlock){delBlock.parentNode.removeChild(delBlock);return;}
var endOffset;if(node.nodeType==$_.Node.TEXT_NODE&&offset!=getNodeLength(node)){range.setStart(node,offset);range.setEnd(node,offset);endOffset=offset+1;while(endOffset!=node.length&&/^[\u0300-\u036f\u0591-\u05bd\u05c1\u05c2]$/.test(node.data[endOffset])){endOffset++;}
deleteContents(node,offset,node,endOffset);return;}
if(isInlineNode(node)){return;}
if(offset<node.childNodes.length&&isHtmlElementInArray(node.childNodes[offset],["br","hr","img"])){range.setStart(node,offset);range.setEnd(node,offset);deleteContents(node,offset,node,offset+1);return;}
var endNode=node;endOffset=offset;while(true){if(endOffset==getNodeLength(endNode)){endOffset=1+getNodeIndex(endNode);endNode=endNode.parentNode;}else if(endOffset<endNode.childNodes.length&&isEditable(endNode.childNodes[endOffset])&&isInvisible(endNode.childNodes[endOffset])){endNode.removeChild(endNode.childNodes[endOffset]);}else{break;}}
if(isNamedHtmlElement(endNode.childNodes[endOffset-1],"table")){return;}
if(isNamedHtmlElement(endNode.childNodes[endOffset],"table")){range.setStart(endNode,endOffset);range.setEnd(endNode,endOffset+1);return;}
if(offset==getNodeLength(node)&&isHtmlElementInArray(endNode.childNodes[endOffset],["br","hr"])){range.setStart(node,offset);range.setEnd(node,offset);deleteContents(endNode,endOffset,endNode,endOffset+1);return;}
while(endOffset<endNode.childNodes.length){if(isEditable(endNode.childNodes[endOffset])&&isInvisible(endNode.childNodes[endOffset])){endNode.removeChild(endNode.childNodes[endOffset]);}else{endNode=endNode.childNodes[endOffset];endOffset=0;}}
deleteContents(node,offset,endNode,endOffset);}};commands.indent={action:function(){var items=[];var node;for(node=getActiveRange().endContainer;node!=getActiveRange().commonAncestorContainer;node=node.parentNode){if(isNamedHtmlElement(node,"LI")){items.unshift(node);}}
for(node=getActiveRange().startContainer;node!=getActiveRange().commonAncestorContainer;node=node.parentNode){if(isNamedHtmlElement(node,"LI")){items.unshift(node);}}
for(node=getActiveRange().commonAncestorContainer;node;node=node.parentNode){if(isNamedHtmlElement(node,"LI")){items.unshift(node);}}
var i;for(i=0;i<items.length;i++){normalizeSublists(items[i],getActiveRange());}
var newRange=blockExtend(getActiveRange());var nodeList=[];nodeList=getContainedNodes(newRange,function(node){return isEditable(node)&&(isAllowedChild(node,"div")||isAllowedChild(node,"ol"));});if(nodeList.length&&isNamedHtmlElement(nodeList[0],"LI")&&isHtmlElementInArray(nodeList[0].parentNode,["OL","UL"])&&isNamedHtmlElement(nodeList[0].previousSibling,"LI")){normalizeSublists(nodeList[0].previousSibling,newRange);}
while(nodeList.length){var sublist=[];sublist.push(nodeList.shift());while(nodeList.length&&nodeList[0]==sublist[sublist.length-1].nextSibling){sublist.push(nodeList.shift());}
indentNodes(sublist,newRange);}}};commands.inserthorizontalrule={action:function(value,range){while(range.startOffset==0&&range.startContainer.parentNode){range.setStart(range.startContainer.parentNode,getNodeIndex(range.startContainer));}
while(range.endOffset==getNodeLength(range.endContainer)&&range.endContainer.parentNode){range.setEnd(range.endContainer.parentNode,1+getNodeIndex(range.endContainer));}
deleteContents(range,{blockMerging:false});if(!isEditable(getActiveRange().startContainer)&&!isEditingHost(getActiveRange().startContainer)){return;}
if(getActiveRange().startContainer.nodeType==$_.Node.TEXT_NODE&&getActiveRange().startOffset==0){getActiveRange().setStart(getActiveRange().startContainer.parentNode,getNodeIndex(getActiveRange().startContainer));getActiveRange().collapse(true);}
if(getActiveRange().startContainer.nodeType==$_.Node.TEXT_NODE&&getActiveRange().startOffset==getNodeLength(getActiveRange().startContainer)){getActiveRange().setStart(getActiveRange().startContainer.parentNode,1+getNodeIndex(getActiveRange().startContainer));getActiveRange().collapse(true);}
var hr=document.createElement("hr");range.insertNode(hr);fixDisallowedAncestors(hr,range);range.setStart(hr.parentNode,1+getNodeIndex(hr));range.setEnd(hr.parentNode,1+getNodeIndex(hr));Aloha.getSelection().removeAllRanges();Aloha.getSelection().addRange(range);}};commands.inserthtml={action:function(value,range){deleteContents(range);if(!isEditable(range.startContainer)&&!isEditingHost(range.startContainer)){return;}
var frag=range.createContextualFragment(value);var lastChild=frag.lastChild;if(!lastChild){return;}
var descendants=getDescendants(frag);if(isBlockNode(range.startContainer)){$_(range.startContainer.childNodes).filter(function(node,range){return isEditable(node)&&isCollapsedBlockProp(node)&&getNodeIndex(node)>=range.startOffset;},true).forEach(function(node){node.parentNode.removeChild(node);});}
range.insertNode(frag);if(isBlockNode(range.startContainer)){ensureContainerEditable(range.startContainer);}
range.setStart(lastChild.parentNode,1+getNodeIndex(lastChild));range.setEnd(lastChild.parentNode,1+getNodeIndex(lastChild));var i;for(i=0;i<descendants.length;i++){fixDisallowedAncestors(descendants[i],range);}
setActiveRange(range);}};commands.insertimage={action:function(value){if(value===""){return;}
var range=getActiveRange();deleteContents(range,{stripWrappers:false});if(!isEditable(getActiveRange().startContainer)&&!isEditingHost(getActiveRange().startContainer)){return;}
if(isBlockNode(range.startContainer)&&range.startContainer.childNodes.length==1&&isNamedHtmlElement(range.startContainer.firstChild,"br")&&range.startOffset==0){range.startContainer.removeChild(range.startContainer.firstChild);}
var img=document.createElement("img");img.setAttribute("src",value);range.insertNode(img);range.setStart(img.parentNode,1+getNodeIndex(img));range.setEnd(img.parentNode,1+getNodeIndex(img));Aloha.getSelection().removeAllRanges();Aloha.getSelection().addRange(range);img.removeAttribute("width");img.removeAttribute("height");}};commands.insertlinebreak={action:function(value,range){deleteContents(range,{stripWrappers:false});if(!isEditable(range.startContainer)&&!isEditingHost(range.startContainer)){return;}
if(range.startContainer.nodeType==$_.Node.ELEMENT_NODE&&!isAllowedChild("br",range.startContainer)){return;}
if(range.startContainer.nodeType!=$_.Node.ELEMENT_NODE&&!isAllowedChild("br",range.startContainer.parentNode)){return;}
var newNode,newOffset;if(range.startContainer.nodeType==$_.Node.TEXT_NODE&&range.startOffset==0){newNode=range.startContainer.parentNode;newOffset=getNodeIndex(range.startContainer);Aloha.getSelection().collapse(newNode,newOffset);range.setStart(newNode,newOffset);range.setEnd(newNode,newOffset);}
if(range.startContainer.nodeType==$_.Node.TEXT_NODE&&range.startOffset==getNodeLength(range.startContainer)){newNode=range.startContainer.parentNode;newOffset=1+getNodeIndex(range.startContainer);Aloha.getSelection().collapse(newNode,newOffset);range.setStart(newNode,newOffset);range.setEnd(newNode,newOffset);}
var br=document.createElement("br");range.insertNode(br);Aloha.getSelection().collapse(br.parentNode,1+getNodeIndex(br));range.setStart(br.parentNode,1+getNodeIndex(br));range.setEnd(br.parentNode,1+getNodeIndex(br));if(isCollapsedLineBreak(br)){range.insertNode(createEndBreak());Aloha.getSelection().collapse(br.parentNode,1+getNodeIndex(br));range.setStart(br.parentNode,1+getNodeIndex(br));range.setEnd(br.parentNode,1+getNodeIndex(br));}
if(jQuery.browser.msie&&jQuery.browser.version<8){br.parentNode.removeAttribute("style");}}};commands.insertorderedlist={action:function(value,range){toggleLists("ol",range);},indeterm:function(){return(/^mixed( ol)?$/).test(getSelectionListState());},state:function(){return getSelectionListState()=="ol";}};var listRelatedElements={"LI":true,"DT":true,"DD":true};commands.insertparagraph={action:function(value,range){var i;deleteContents(range);cleanLists(getEditingHostOf(range.startContainer),range);if(!isEditable(range.startContainer)&&!isEditingHost(range.startContainer)){return;}
var node=range.startContainer;var offset=range.startOffset;if(node.nodeType==$_.Node.TEXT_NODE&&offset!=0&&offset!=getNodeLength(node)){node.splitText(offset);}
if(node.nodeType==$_.Node.TEXT_NODE&&offset==getNodeLength(node)){offset=1+getNodeIndex(node);node=node.parentNode;}
if(node.nodeType==$_.Node.TEXT_NODE||node.nodeType==$_.Node.COMMENT_NODE){offset=getNodeIndex(node);node=node.parentNode;}
Aloha.getSelection().collapse(node,offset);range.setStart(node,offset);range.setEnd(node,offset);var container=node;while(!isSingleLineContainer(container)&&isEditable(container.parentNode)&&inSameEditingHost(node,container.parentNode)){container=container.parentNode;}
if(!isEditable(container)||!inSameEditingHost(container,node)||!isSingleLineContainer(container)){var tag=defaultSingleLineContainerName;var newRange=blockExtend(range);var nodeList=getContainedNodes(newRange,function(node){return isAllowedChild(node,"p");}).slice(0,1);if(!nodeList.length){if(!isAllowedChild(tag,range.startContainer)){return;}
container=document.createElement(tag);range.insertNode(container);container.appendChild(createEndBreak());Aloha.getSelection().collapse(container,0);range.setStart(container,0);range.setEnd(container,0);return;}
while(nodeList[nodeList.length-1].nextSibling&&isAllowedChild(nodeList[nodeList.length-1].nextSibling,"p")){nodeList.push(nodeList[nodeList.length-1].nextSibling);}
container=wrap(nodeList,function(){return false;},function(){return document.createElement(tag);},range);}
var oldHeight,newHeight;if(container.tagName=="ADDRESS"||container.tagName=="LISTING"||container.tagName=="PRE"){var br=document.createElement("br");oldHeight=container.offsetHeight;range.insertNode(br);newHeight=container.offsetHeight;Aloha.getSelection().collapse(node,offset+1);range.setStart(node,offset+1);range.setEnd(node,offset+1);if(oldHeight==newHeight&&!isDescendant(nextNode(br),container)){range.insertNode(createEndBreak());Aloha.getSelection().collapse(node,offset+1);range.setEnd(node,offset+1);}
return;}
if(listRelatedElements[container.tagName]&&(!container.hasChildNodes()||(container.childNodes.length==1&&isNamedHtmlElement(container.firstChild,"br")))){splitParent([container],range);if(isHtmlElementInArray(container,["dd","dt"])&&$_(getAncestors(container)).every(function(ancestor){return!inSameEditingHost(container,ancestor)||!isAllowedChild(container,ancestor);})){container=setTagName(container,defaultSingleLineContainerName,range);}
fixDisallowedAncestors(container,range);if(isNamedHtmlElement(container,'li')&&isNamedHtmlElement(container.nextSibling,"li")&&isHtmlElementInArray(container.nextSibling.firstChild,["ol","ul"])){var listParent=container.nextSibling,length=container.nextSibling.childNodes.length;for(i=0;i<length;i++){container.appendChild(listParent.childNodes[0]);}
listParent.parentNode.removeChild(listParent);}
return;}
var newLineRange=Aloha.createRange();newLineRange.setStart(range.startContainer,range.startOffset);newLineRange.setEnd(container,getNodeLength(container));while(newLineRange.startOffset==0&&newLineRange.startContainer!=container){newLineRange.setStart(newLineRange.startContainer.parentNode,getNodeIndex(newLineRange.startContainer));}
while(newLineRange.startOffset==getNodeLength(newLineRange.startContainer)&&newLineRange.startContainer!=container){newLineRange.setStart(newLineRange.startContainer.parentNode,1+getNodeIndex(newLineRange.startContainer));}
var containedInNewLineRange=getContainedNodes(newLineRange);var endOfLine=!containedInNewLineRange.length||(containedInNewLineRange.length==1&&isNamedHtmlElement(containedInNewLineRange[0],"br"));var newContainerName;if(/^H[1-6]$/.test(container.tagName)&&endOfLine){newContainerName=defaultSingleLineContainerName;}else if(container.tagName=="DT"&&endOfLine){newContainerName="dd";}else if(container.tagName=="DD"&&endOfLine){newContainerName="dt";}else{newContainerName=container.tagName.toLowerCase();}
var newContainer=document.createElement(newContainerName);copyAttributes(container,newContainer);newContainer.removeAttribute("id");container.parentNode.insertBefore(newContainer,container.nextSibling);var containedNodes=getAllContainedNodes(newLineRange);var frag=newLineRange.extractContents();var descendants=getDescendants(frag);for(i=0;i<descendants.length;i++){if(descendants[i].nodeType==$_.Node.ELEMENT_NODE&&$_(containedNodes).indexOf(descendants[i])==-1){descendants[i].removeAttribute("id");}}
var fragChildren=[],fragChild=frag.firstChild;if(fragChild){do{if(!isWhitespaceNode(fragChild)){fragChildren.push(fragChild);}}while(null!=(fragChild=fragChild.nextSibling));}
if(isNamedHtmlElement(newContainer,'li')&&fragChildren.length&&isHtmlElementInArray(fragChildren[0],["ul","ol"])){oldHeight=newContainer.offsetHeight;var endBr=createEndBreak();newContainer.appendChild(endBr);newHeight=newContainer.offsetHeight;if(oldHeight!==newHeight){newContainer.removeChild(endBr);}}
newContainer.appendChild(frag);ensureContainerEditable(container);ensureContainerEditable(newContainer);Aloha.getSelection().collapse(newContainer,0);range.setStart(newContainer,0);range.setEnd(newContainer,0);}};commands.inserttext={action:function(value,range){var i;deleteContents(range,{stripWrappers:false});if(!isEditable(range.startContainer)&&!isEditingHost(range.startContainer)){return;}
if(value.length>1){for(i=0;i<value.length;i++){commands.inserttext.action(value[i],range);}
return;}
if(value==""){return;}
if(value=="\n"){commands.insertparagraph.action('',range);return;}
var node=range.startContainer;var offset=range.startOffset;if(0<=offset-1&&offset-1<node.childNodes.length&&node.childNodes[offset-1].nodeType==$_.Node.TEXT_NODE){node=node.childNodes[offset-1];offset=getNodeLength(node);}
if(0<=offset&&offset<node.childNodes.length&&node.childNodes[offset].nodeType==$_.Node.TEXT_NODE){node=node.childNodes[offset];offset=0;}
var refElement=node.nodeType==$_.Node.ELEMENT_NODE?node:node.parentNode;if(value==" "&&refElement.nodeType==$_.Node.ELEMENT_NODE&&jQuery.inArray($_.getComputedStyle(refElement).whiteSpace,["pre","pre-wrap"])==-1){value="\xa0";}
var overrides=recordCurrentOverrides(range);if(node.nodeType==$_.Node.TEXT_NODE){node.insertData(offset,value);Aloha.getSelection().collapse(node,offset);range.setStart(node,offset);Aloha.getSelection().extend(node,offset+1);range.setEnd(node,offset+1);}else{if(node.childNodes.length==1&&isCollapsedLineBreak(node.firstChild)){node.removeChild(node.firstChild);}
var text=document.createTextNode(value);range.insertNode(text);Aloha.getSelection().collapse(text,0);range.setStart(text,0);Aloha.getSelection().extend(text,1);range.setEnd(text,1);}
restoreStatesAndValues(overrides);canonicalizeWhitespace(range.startContainer,range.startOffset);canonicalizeWhitespace(range.endContainer,range.endOffset);Aloha.getSelection().collapseToEnd();range.collapse(false);}};commands.insertunorderedlist={action:function(value,range){toggleLists("ul",range);},indeterm:function(){return(/^mixed( ul)?$/).test(getSelectionListState());},state:function(){return getSelectionListState()=="ul";}};commands.justifycenter={action:function(value,range){justifySelection("center",range);},indeterm:function(){var nodes=getAllContainedNodes(blockExtend(getActiveRange()),function(node){return isEditable(node)&&isVisible(node)&&!node.hasChildNodes();});return $_(nodes).some(function(node){return getAlignmentValue(node)=="center";})&&$_(nodes).some(function(node){return getAlignmentValue(node)!="center";});},state:function(){var nodes=getAllContainedNodes(blockExtend(getActiveRange()),function(node){return isEditable(node)&&isVisible(node)&&!node.hasChildNodes();});return nodes.length&&$_(nodes).every(function(node){return getAlignmentValue(node)=="center";});},value:function(){var nodes=getAllContainedNodes(blockExtend(getActiveRange()),function(node){return isEditable(node)&&isVisible(node)&&!node.hasChildNodes();});if(nodes.length){return getAlignmentValue(nodes[0]);}
return"left";}};commands.justifyfull={action:function(value,range){justifySelection("justify",range);},indeterm:function(){var nodes=getAllContainedNodes(blockExtend(getActiveRange()),function(node){return isEditable(node)&&isVisible(node)&&!node.hasChildNodes();});return $_(nodes).some(function(node){return getAlignmentValue(node)=="justify";})&&$_(nodes).some(function(node){return getAlignmentValue(node)!="justify";});},state:function(){var nodes=getAllContainedNodes(blockExtend(getActiveRange()),function(node){return isEditable(node)&&isVisible(node)&&!node.hasChildNodes();});return nodes.length&&$_(nodes).every(function(node){return getAlignmentValue(node)=="justify";});},value:function(){var nodes=getAllContainedNodes(blockExtend(getActiveRange()),function(node){return isEditable(node)&&isVisible(node)&&!node.hasChildNodes();});if(nodes.length){return getAlignmentValue(nodes[0]);}
return"left";}};commands.justifyleft={action:function(value,range){justifySelection("left",range);},indeterm:function(){var nodes=getAllContainedNodes(blockExtend(getActiveRange()),function(node){return isEditable(node)&&isVisible(node)&&!node.hasChildNodes();});return $_(nodes).some(function(node){return getAlignmentValue(node)=="left";})&&$_(nodes).some(function(node){return getAlignmentValue(node)!="left";});},state:function(){var nodes=getAllContainedNodes(blockExtend(getActiveRange()),function(node){return isEditable(node)&&isVisible(node)&&!node.hasChildNodes();});return nodes.length&&$_(nodes).every(function(node){return getAlignmentValue(node)=="left";});},value:function(){var nodes=getAllContainedNodes(blockExtend(getActiveRange()),function(node){return isEditable(node)&&isVisible(node)&&!node.hasChildNodes();});if(nodes.length){return getAlignmentValue(nodes[0]);}
return"left";}};commands.justifyright={action:function(value,range){justifySelection("right",range);},indeterm:function(){var nodes=getAllContainedNodes(blockExtend(getActiveRange()),function(node){return isEditable(node)&&isVisible(node)&&!node.hasChildNodes();});return $_(nodes).some(function(node){return getAlignmentValue(node)=="right";})&&$_(nodes).some(function(node){return getAlignmentValue(node)!="right";});},state:function(){var nodes=getAllContainedNodes(blockExtend(getActiveRange()),function(node){return isEditable(node)&&isVisible(node)&&!node.hasChildNodes();});return nodes.length&&$_(nodes).every(function(node){return getAlignmentValue(node)=="right";});},value:function(){var nodes=getAllContainedNodes(blockExtend(getActiveRange()),function(node){return isEditable(node)&&isVisible(node)&&!node.hasChildNodes();});if(nodes.length){return getAlignmentValue(nodes[0]);}
return"left";}};commands.outdent={action:function(){var items=[];(function(){var ancestorContainer;for(ancestorContainer=getActiveRange().endContainer;ancestorContainer!=getActiveRange().commonAncestorContainer;ancestorContainer=ancestorContainer.parentNode){if(isNamedHtmlElement(ancestorContainer,"li")){items.unshift(ancestorContainer);}}
for(ancestorContainer=getActiveRange().startContainer;ancestorContainer;ancestorContainer=ancestorContainer.parentNode){if(isNamedHtmlElement(ancestorContainer,"li")){items.unshift(ancestorContainer);}}}());$_(items).forEach(function(thisArg){normalizeSublists(thisArg,getActiveRange());});var newRange=blockExtend(getActiveRange());var nodeList=getContainedNodes(newRange,function(node){return isEditable(node)&&(!$_(getDescendants(node)).some(isEditable)||isHtmlElementInArray(node,["ol","ul"])||(isNamedHtmlElement(node,'li')&&isHtmlElementInArray(node.parentNode,["ol","ul"])));});while(nodeList.length){while(nodeList.length&&(isHtmlElementInArray(nodeList[0],["OL","UL"])||!isHtmlElementInArray(nodeList[0].parentNode,["OL","UL"]))){outdentNode(nodeList.shift(),newRange);}
if(!nodeList.length){break;}
var sublist=[];sublist.push(nodeList.shift());while(nodeList.length&&nodeList[0]==sublist[sublist.length-1].nextSibling&&!isHtmlElementInArray(nodeList[0],["OL","UL"])){sublist.push(nodeList.shift());}
var values=recordValues(sublist);splitParent(sublist,newRange);$_(sublist).forEach(fixDisallowedAncestors);restoreValues(values,newRange);}}};commands.selectall={action:function(){var target=document.body;if(!target){target=document.documentElement;}
if(!target){Aloha.getSelection().removeAllRanges();}else{Aloha.getSelection().selectAllChildren(target);}}};commands.stylewithcss={action:function(value){cssStylingFlag=String(value).toLowerCase()!="false";},state:function(){return cssStylingFlag;}};commands.usecss={action:function(value){cssStylingFlag=String(value).toLowerCase()=="false";}};(function(){var commandNames=[];var command;for(command in commands){if(commands.hasOwnProperty(command)){commandNames.push(command);}}
$_(commandNames).forEach(function(command){if(null==commands[command].relevantCssProperty){commands[command].relevantCssProperty=null;}
if(null!=commands[command].inlineCommandActivatedValues&&null==commands[command].indeterm){commands[command].indeterm=function(range){var values=$_(getAllEffectivelyContainedNodes(range,function(node){return isEditable(node)&&node.nodeType==$_.Node.TEXT_NODE;})).map(function(node){return getEffectiveCommandValue(node,command);});var matchingValues=$_(values).filter(function(value){return $_(commands[command].inlineCommandActivatedValues).indexOf(value)!=-1;});return matchingValues.length>=1&&values.length-matchingValues.length>=1;};}
if(null!=commands[command].inlineCommandActivatedValues){commands[command].state=function(range){var nodes=getAllEffectivelyContainedNodes(range,function(node){return isEditable(node)&&node.nodeType==$_.Node.TEXT_NODE;});if(nodes.length==0){return $_(commands[command].inlineCommandActivatedValues).indexOf(getEffectiveCommandValue(range.startContainer,command))!=-1;}
return $_(nodes).every(function(node){return $_(commands[command].inlineCommandActivatedValues).indexOf(getEffectiveCommandValue(node,command))!=-1;});};}
if(null!=commands[command].standardInlineValueCommand){commands[command].indeterm=function(){var values=$_(getAllEffectivelyContainedNodes(getActiveRange())).filter(function(node){return isEditable(node)&&node.nodeType==$_.Node.TEXT_NODE;},true).map(function(node){return getEffectiveCommandValue(node,command);});var i;for(i=1;i<values.length;i++){if(values[i]!=values[i-1]){return true;}}
return false;};commands[command].value=function(range){var refNode=getAllEffectivelyContainedNodes(range,function(node){return isEditable(node)&&node.nodeType==$_.Node.TEXT_NODE;})[0];if(typeof refNode=="undefined"){refNode=range.startContainer;}
return getEffectiveCommandValue(refNode,command);};}});}());return{commands:commands,execCommand:myExecCommand,queryCommandIndeterm:myQueryCommandIndeterm,queryCommandState:myQueryCommandState,queryCommandValue:myQueryCommandValue,queryCommandEnabled:myQueryCommandEnabled,queryCommandSupported:myQueryCommandSupported,copyAttributes:copyAttributes,createEndBreak:createEndBreak,isEndBreak:isEndBreak,ensureContainerEditable:ensureContainerEditable,isEditingHost:isEditingHost,isEditable:isEditable};});;define('aloha/selection',['aloha/core','jquery','util/class','util/range','util/arrays','util/strings','aloha/console','PubSub','aloha/engine','aloha/ecma5shims','aloha/rangy-core'],function(Aloha,jQuery,Class,Range,Arrays,Strings,console,PubSub,Engine,e5s){var GENTICS=window.GENTICS;function isCollapsedAndEmptyOrEndBr(rangeObject){var firstChild;if(rangeObject.startContainer!==rangeObject.endContainer){return false;}
if(rangeObject.startContainer.nodeType!=1){return false;}
firstChild=rangeObject.startContainer.firstChild;return(!firstChild||(!firstChild.nextSibling&&firstChild.nodeName=='BR'));}
function isCollapsedAndEndBr(rangeObject){if(rangeObject.startContainer!==rangeObject.endContainer){return false;}
if(rangeObject.startContainer.nodeType!=1){return false;}
return Engine.isEndBreak(rangeObject.startContainer);}
var prevStartContext=null;var prevEndContext=null;function makeContextHtml(node,parents){var result=[],parent,len,i;if(1===node.nodeType&&node.nodeName!=='BODY'&&node.nodeName!=='HTML'){result.push(node.cloneNode(false).outerHTML);}else{result.push('#'+node.nodeType);}
for(i=0,len=parents.length;i<len;i++){parent=parents[i];if(parent.nodeName==='BODY'||parent.nodeName==='HTML'){break;}
result.push(parent.cloneNode(false).outerHTML);}
return result.join('');}
function getChangedContext(node,context){var until=Aloha.activeEditable?Aloha.activeEditable.obj.parent()[0]:null;var parents=jQuery(node).parentsUntil(until).get();var html=makeContextHtml(node,parents);var equal=(context&&node===context.node&&Arrays.equal(context.parents,parents)&&html===context.html);return equal?null:{node:node,parents:parents,html:html};}
function triggerSelectionContextChanged(rangeObject,event){var startContainer=rangeObject.startContainer;var endContainer=rangeObject.endContainer;if(!startContainer||!endContainer){console.warn("aloha/selection","encountered range object without start or end container");return;}
var startContext=getChangedContext(startContainer,prevStartContext);var endContext=getChangedContext(endContainer,prevEndContext);if(!startContext&&!endContext){return;}
prevStartContext=startContext;prevEndContext=endContext;PubSub.pub('aloha.selection.context-change',{range:rangeObject,event:event});}
var Selection=Class.extend({_constructor:function(){this.rangeObject={};this.preventSelectionChangedFlag=false;this.tagHierarchy={'textNode':{},'abbr':{'textNode':true},'b':{'textNode':true,'b':true,'i':true,'em':true,'sup':true,'sub':true,'br':true,'span':true,'img':true,'a':true,'del':true,'ins':true,'u':true,'cite':true,'q':true,'code':true,'abbr':true,'strong':true},'pre':{'textNode':true,'b':true,'i':true,'em':true,'sup':true,'sub':true,'br':true,'span':true,'img':true,'a':true,'del':true,'ins':true,'u':true,'cite':true,'q':true,'code':true,'abbr':true},'blockquote':{'textNode':true,'b':true,'i':true,'em':true,'sup':true,'sub':true,'br':true,'span':true,'img':true,'a':true,'del':true,'ins':true,'u':true,'cite':true,'q':true,'code':true,'abbr':true,'p':true,'h1':true,'h2':true,'h3':true,'h4':true,'h5':true,'h6':true},'ins':{'textNode':true,'b':true,'i':true,'em':true,'sup':true,'sub':true,'br':true,'span':true,'img':true,'a':true,'u':true,'p':true,'h1':true,'h2':true,'h3':true,'h4':true,'h5':true,'h6':true},'ul':{'li':true},'ol':{'li':true},'li':{'textNode':true,'b':true,'i':true,'em':true,'sup':true,'sub':true,'br':true,'span':true,'img':true,'ul':true,'ol':true,'h1':true,'h2':true,'h3':true,'h4':true,'h5':true,'h6':true,'del':true,'ins':true,'u':true,'a':true},'tr':{'td':true,'th':true},'table':{'tr':true},'div':{'textNode':true,'b':true,'i':true,'em':true,'sup':true,'sub':true,'br':true,'span':true,'img':true,'ul':true,'ol':true,'table':true,'h1':true,'h2':true,'h3':true,'h4':true,'h5':true,'h6':true,'del':true,'ins':true,'u':true,'p':true,'div':true,'pre':true,'blockquote':true,'a':true},'h1':{'textNode':true,'b':true,'i':true,'em':true,'sup':true,'sub':true,'br':true,'span':true,'img':true,'a':true,'del':true,'ins':true,'u':true}};this.tagHierarchy={'textNode':this.tagHierarchy.textNode,'abbr':this.tagHierarchy.abbr,'br':this.tagHierarchy.textNode,'img':this.tagHierarchy.textNode,'b':this.tagHierarchy.b,'strong':this.tagHierarchy.b,'code':this.tagHierarchy.b,'q':this.tagHierarchy.b,'blockquote':this.tagHierarchy.blockquote,'cite':this.tagHierarchy.b,'i':this.tagHierarchy.b,'em':this.tagHierarchy.b,'sup':this.tagHierarchy.b,'sub':this.tagHierarchy.b,'span':this.tagHierarchy.b,'del':this.tagHierarchy.del,'ins':this.tagHierarchy.ins,'u':this.tagHierarchy.b,'p':this.tagHierarchy.b,'pre':this.tagHierarchy.pre,'a':this.tagHierarchy.b,'ul':this.tagHierarchy.ul,'ol':this.tagHierarchy.ol,'li':this.tagHierarchy.li,'td':this.tagHierarchy.li,'div':this.tagHierarchy.div,'h1':this.tagHierarchy.h1,'h2':this.tagHierarchy.h1,'h3':this.tagHierarchy.h1,'h4':this.tagHierarchy.h1,'h5':this.tagHierarchy.h1,'h6':this.tagHierarchy.h1,'table':this.tagHierarchy.table};this.replacingElements={'h1':{'p':true,'h1':true,'h2':true,'h3':true,'h4':true,'h5':true,'h6':true,'pre':true,'blockquote':true}};this.replacingElements={'h1':this.replacingElements.h1,'h2':this.replacingElements.h1,'h3':this.replacingElements.h1,'h4':this.replacingElements.h1,'h5':this.replacingElements.h1,'h6':this.replacingElements.h1,'pre':this.replacingElements.h1,'p':this.replacingElements.h1,'blockquote':this.replacingElements.h1};this.allowedToStealElements={'h1':{'textNode':true}};this.allowedToStealElements={'h1':this.allowedToStealElements.h1,'h2':this.allowedToStealElements.h1,'h3':this.allowedToStealElements.h1,'h4':this.allowedToStealElements.h1,'h5':this.allowedToStealElements.h1,'h6':this.allowedToStealElements.h1,'p':this.tagHierarchy.b};},SelectionTree:function(){this.domobj={};this.selection=undefined;this.children=[];},onChange:function(objectClicked,event,timeout){if(this.updateSelectionTimeout){window.clearTimeout(this.updateSelectionTimeout);}
var selection=this;this.updateSelectionTimeout=window.setTimeout(function(){var range=new Aloha.Selection.SelectionRange(true);if(!range.startContainer||'HTML'===range.startContainer.nodeName||'BODY'===range.startContainer.nodeName){if(!this.updateSelectionTimeout){selection.onChange(objectClicked,event,10+(timeout||5)*2);}
return;}
Aloha.Selection._updateSelection(event,range);},timeout||5);},preventSelectionChanged:function(){this.preventSelectionChangedFlag=true;},isSelectionChangedPrevented:function(){var prevented=this.preventSelectionChangedFlag;this.preventSelectionChangedFlag=false;return prevented;},isSelectionEditable:function(){return(this.rangeObject.commonAncestorContainer&&jQuery(this.rangeObject.commonAncestorContainer).contentEditable());},isFloatingMenuVisible:function(){var visible=jQuery(Aloha.Selection.rangeObject.commonAncestorContainer).attr('data-aloha-floatingmenu-visible');if(visible!=='undefined'){if(visible==='true'){return true;}
return false;}
return false;},updateSelection:function(event){return this._updateSelection(event,null);},_updateSelection:function(event,range){if(event&&event.originalEvent&&true===event.originalEvent.stopSelectionUpdate){return false;}
if(typeof range==='undefined'){return false;}
this.rangeObject=range=range||new Aloha.Selection.SelectionRange(true);range.update();if(range&&range.startContainer&&range.endContainer){var inEditable=jQuery(range.commonAncestorContainer).closest('.aloha-editable').length;if(inEditable){var validStartPosition=!(3===range.startContainer.nodeType&&!jQuery(range.startContainer.parentNode).contentEditable());var validEndPosition=!(3===range.endContainer.nodeType&&!jQuery(range.endContainer.parentNode).contentEditable());if(!validStartPosition||!validEndPosition){Aloha.getSelection().removeAllRanges();return true;}}}
if(this.isSelectionChangedPrevented()){return true;}
Aloha.trigger('aloha-selection-changed-before',[this.rangeObject,event]);Aloha.trigger('aloha-selection-changed',[this.rangeObject,event]);triggerSelectionContextChanged(this.rangeObject,event);Aloha.trigger('aloha-selection-changed-after',[this.rangeObject,event]);return true;},getSelectionTree:function(rangeObject){if(!rangeObject){return this.rangeObject.getSelectionTree();}
if(!rangeObject.commonAncestorContainer){Aloha.Log.error(this,'the rangeObject is missing the commonAncestorContainer');return false;}
this.inselection=false;if(GENTICS.Utils.Dom.doCleanup({'merge':true},rangeObject)){rangeObject.update();rangeObject.select();}
return this.recursiveGetSelectionTree(rangeObject,rangeObject.commonAncestorContainer);},recursiveGetSelectionTree:function(rangeObject,currentObject){var jQueryCurrentObject=jQuery(currentObject),childCount=0,that=this,currentElements=[];jQueryCurrentObject.contents().each(function(index){var selectionType='none',startOffset=false,endOffset=false,collapsedFound=false,i,elementsLength,noneFound=false,partialFound=false,fullFound=false;if(rangeObject.isCollapsed()&&currentObject===rangeObject.startContainer&&rangeObject.startOffset==index){currentElements[childCount]=new Aloha.Selection.SelectionTree();currentElements[childCount].selection='collapsed';currentElements[childCount].domobj=undefined;that.inselection=false;collapsedFound=true;childCount++;}
if(!that.inselection&&!collapsedFound){var nodeType;try{nodeType=this.nodeType;}catch(e){return;}
switch(nodeType){case 3:if(this===rangeObject.startContainer){that.inselection=true;selectionType=rangeObject.startOffset>0?'partial':'full';startOffset=rangeObject.startOffset;endOffset=this.length;}
break;case 1:if(this===rangeObject.startContainer&&rangeObject.startOffset===0){that.inselection=true;selectionType='full';}
if(currentObject===rangeObject.startContainer&&rangeObject.startOffset===index){that.inselection=true;selectionType='full';}
break;}}
if(that.inselection&&!collapsedFound){if(selectionType=='none'){selectionType='full';}
switch(this.nodeType){case 3:if(this===rangeObject.endContainer){that.inselection=false;if(rangeObject.endOffset<this.length){selectionType='partial';}
if(startOffset===false){startOffset=0;}
endOffset=rangeObject.endOffset;}
break;case 1:if(this===rangeObject.endContainer&&rangeObject.endOffset===0){that.inselection=false;}
break;}
if(currentObject===rangeObject.endContainer&&rangeObject.endOffset<=index){that.inselection=false;selectionType='none';}}
currentElements[childCount]=new Aloha.Selection.SelectionTree();currentElements[childCount].domobj=this;currentElements[childCount].selection=selectionType;if(selectionType=='partial'){currentElements[childCount].startOffset=startOffset;currentElements[childCount].endOffset=endOffset;}
currentElements[childCount].children=that.recursiveGetSelectionTree(rangeObject,this);elementsLength=currentElements[childCount].children.length;if(elementsLength>0){for(i=0;i<elementsLength;++i){switch(currentElements[childCount].children[i].selection){case'none':noneFound=true;break;case'full':fullFound=true;break;case'partial':partialFound=true;break;}}
if(partialFound||(fullFound&&noneFound)){currentElements[childCount].selection='partial';}else if(fullFound&&!partialFound&&!noneFound){currentElements[childCount].selection='full';}}
childCount++;});if(rangeObject.isCollapsed()&&currentObject===rangeObject.startContainer&&rangeObject.startOffset==currentObject.childNodes.length){currentElements[childCount]=new Aloha.Selection.SelectionTree();currentElements[childCount].selection='collapsed';currentElements[childCount].domobj=undefined;}
return currentElements;},getRangeObject:function(){return this.rangeObject;},isRangeObjectWithinMarkup:function(rangeObject,startOrEnd,markupObject,tagComparator,limitObject){var domObj=!startOrEnd?rangeObject.startContainer:rangeObject.endContainer,that=this,parents=jQuery(domObj).parents(),returnVal=false,i=-1;if(typeof tagComparator!=='undefined'&&typeof tagComparator!=='function'){Aloha.Log.error(this,'parameter tagComparator is not a function');}
if(typeof tagComparator==='undefined'){tagComparator=function(domobj,markupObject){return that.standardTextLevelSemanticsComparator(domobj,markupObject);};}
if(parents.length>0){parents.each(function(){if(this===limitObject){Aloha.Log.debug(that,'reached limit dom obj');return false;}
if(tagComparator(this,markupObject)){if(returnVal===false){returnVal=[];}
Aloha.Log.debug(that,'reached object equal to markup');i++;returnVal[i]=this;return true;}});}
return returnVal;},standardSectionsAndGroupingContentComparator:function(domobj,markupObject){if(domobj.nodeType!==1){Aloha.Log.debug(this,'only element nodes (nodeType == 1) can be compared');return false;}
if(!markupObject[0].nodeName){return false;}
var elemMap=Aloha.Selection.replacingElements[domobj.nodeName.toLowerCase()];return elemMap&&elemMap[markupObject[0].nodeName.toLowerCase()];},standardTagNameComparator:function(domobj,markupObject){if(domobj.nodeType===1){if(domobj.nodeName!=markupObject[0].nodeName){return false;}
return true;}
Aloha.Log.debug(this,'only element nodes (nodeType == 1) can be compared');return false;},standardTextLevelSemanticsComparator:function(domobj,markupObject){if(domobj.nodeType===1){if(domobj.nodeName!=markupObject[0].nodeName){return false;}
if(!this.standardAttributesComparator(domobj,markupObject)){return false;}
return true;}
Aloha.Log.debug(this,'only element nodes (nodeType == 1) can be compared');return false;},standardAttributesComparator:function(domobj,markupObject){var classesA=Strings.words((domobj&&domobj.className)||'');var classesB=Strings.words((markupObject.length&&markupObject[0].className)||'');Arrays.sortUnique(classesA);Arrays.sortUnique(classesB);return Arrays.equal(classesA,classesB);},changeMarkup:function(rangeObject,markupObject,tagComparator){var tagName=markupObject[0].tagName.toLowerCase(),newCAC,limitObject,backupRangeObject,relevantMarkupObjectsAtSelectionStart=this.isRangeObjectWithinMarkup(rangeObject,false,markupObject,tagComparator,limitObject),relevantMarkupObjectsAtSelectionEnd=this.isRangeObjectWithinMarkup(rangeObject,true,markupObject,tagComparator,limitObject),nextSibling,relevantMarkupObjectAfterSelection,prevSibling,relevantMarkupObjectBeforeSelection,extendedRangeObject;var parentElement;if(this.replacingElements[tagName]){backupRangeObject=rangeObject;rangeObject=new this.SelectionRange(rangeObject);if(Aloha.activeEditable){newCAC=Aloha.activeEditable.obj.get(0);}else{newCAC=jQuery('body');}
rangeObject.update(newCAC);markupObject.isReplacingElement=true;}else{if(rangeObject.isCollapsed()){Aloha.Log.debug(this,'early returning from applying markup because nothing is currently selected');return false;}}
if(Aloha.activeEditable){limitObject=Aloha.activeEditable.obj[0];}else{limitObject=jQuery('body');}
if(!markupObject.isReplacingElement&&rangeObject.startOffset===0){if(null!=(prevSibling=this.getTextNodeSibling(false,rangeObject.commonAncestorContainer.parentNode,rangeObject.startContainer))){relevantMarkupObjectBeforeSelection=this.isRangeObjectWithinMarkup({startContainer:prevSibling,startOffset:0},false,markupObject,tagComparator,limitObject);}}
if(!markupObject.isReplacingElement&&(rangeObject.endOffset===rangeObject.endContainer.length)){if(null!=(nextSibling=this.getTextNodeSibling(true,rangeObject.commonAncestorContainer.parentNode,rangeObject.endContainer))){relevantMarkupObjectAfterSelection=this.isRangeObjectWithinMarkup({startContainer:nextSibling,startOffset:0},false,markupObject,tagComparator,limitObject);}}
if(!markupObject.isReplacingElement&&(relevantMarkupObjectsAtSelectionStart&&!relevantMarkupObjectsAtSelectionEnd)){Aloha.Log.info(this,'markup 2 non-markup');this.prepareForRemoval(rangeObject.getSelectionTree(),markupObject,tagComparator);jQuery(relevantMarkupObjectsAtSelectionStart).addClass('preparedForRemoval');this.insertCroppedMarkups(relevantMarkupObjectsAtSelectionStart,rangeObject,false,tagComparator);}else if(!markupObject.isReplacingElement&&relevantMarkupObjectsAtSelectionStart&&relevantMarkupObjectsAtSelectionEnd){Aloha.Log.info(this,'markup 2 markup');this.prepareForRemoval(rangeObject.getSelectionTree(),markupObject,tagComparator);this.splitRelevantMarkupObject(relevantMarkupObjectsAtSelectionStart,relevantMarkupObjectsAtSelectionEnd,rangeObject,tagComparator);}else if(!markupObject.isReplacingElement&&((!relevantMarkupObjectsAtSelectionStart&&relevantMarkupObjectsAtSelectionEnd)||relevantMarkupObjectAfterSelection||relevantMarkupObjectBeforeSelection)){Aloha.Log.info(this,'non-markup 2 markup OR with next2markup');if(relevantMarkupObjectBeforeSelection&&relevantMarkupObjectAfterSelection){extendedRangeObject=new Aloha.Selection.SelectionRange(rangeObject);extendedRangeObject.startContainer=jQuery(relevantMarkupObjectBeforeSelection[relevantMarkupObjectBeforeSelection.length-1]).textNodes()[0];extendedRangeObject.startOffset=0;extendedRangeObject.endContainer=jQuery(relevantMarkupObjectAfterSelection[relevantMarkupObjectAfterSelection.length-1]).textNodes().last()[0];extendedRangeObject.endOffset=extendedRangeObject.endContainer.length;extendedRangeObject.update();this.applyMarkup(extendedRangeObject.getSelectionTree(),rangeObject,markupObject,tagComparator);Aloha.Log.info(this,'double extending previous markup(previous and after selection), actually wrapping it ...');}else if(relevantMarkupObjectBeforeSelection&&!relevantMarkupObjectAfterSelection&&!relevantMarkupObjectsAtSelectionEnd){this.extendExistingMarkupWithSelection(relevantMarkupObjectBeforeSelection,rangeObject,false,tagComparator);Aloha.Log.info(this,'extending previous markup');}else if(relevantMarkupObjectBeforeSelection&&!relevantMarkupObjectAfterSelection&&relevantMarkupObjectsAtSelectionEnd){extendedRangeObject=new Aloha.Selection.SelectionRange(rangeObject);extendedRangeObject.startContainer=jQuery(relevantMarkupObjectBeforeSelection[relevantMarkupObjectBeforeSelection.length-1]).textNodes()[0];extendedRangeObject.startOffset=0;extendedRangeObject.endContainer=jQuery(relevantMarkupObjectsAtSelectionEnd[relevantMarkupObjectsAtSelectionEnd.length-1]).textNodes().last()[0];extendedRangeObject.endOffset=extendedRangeObject.endContainer.length;extendedRangeObject.update();this.applyMarkup(extendedRangeObject.getSelectionTree(),rangeObject,markupObject,tagComparator);Aloha.Log.info(this,'double extending previous markup(previous and relevant at the end), actually wrapping it ...');}else if(!relevantMarkupObjectBeforeSelection&&relevantMarkupObjectAfterSelection){this.extendExistingMarkupWithSelection(relevantMarkupObjectAfterSelection,rangeObject,true,tagComparator);Aloha.Log.info(this,'extending following markup backwards');}else{this.extendExistingMarkupWithSelection(relevantMarkupObjectsAtSelectionEnd,rangeObject,true,tagComparator);}}else if(markupObject.isReplacingElement||(!relevantMarkupObjectsAtSelectionStart&&!relevantMarkupObjectsAtSelectionEnd&&!relevantMarkupObjectBeforeSelection&&!relevantMarkupObjectAfterSelection)){Aloha.Log.info(this,'non-markup 2 non-markup');if(isCollapsedAndEmptyOrEndBr(rangeObject)){var newMarkup=markupObject.clone();if(isCollapsedAndEndBr(rangeObject)){newMarkup[0].appendChild(Engine.createEndBreak());}
if(Aloha.activeEditable&&jQuery.browser.mozilla){Aloha.activeEditable.obj.focus();}
if(Engine.isEditable(rangeObject.startContainer)){Engine.copyAttributes(rangeObject.startContainer,newMarkup[0]);jQuery(rangeObject.startContainer).after(newMarkup[0]).remove();}else if(Engine.isEditingHost(rangeObject.startContainer)){jQuery(rangeObject.startContainer).append(newMarkup[0]);Engine.ensureContainerEditable(newMarkup[0]);}
backupRangeObject.startContainer=newMarkup[0];backupRangeObject.endContainer=newMarkup[0];backupRangeObject.startOffset=0;backupRangeObject.endOffset=0;return;}
this.applyMarkup(rangeObject.getSelectionTree(),rangeObject,markupObject,tagComparator,{setRangeObject2NewMarkup:true});backupRangeObject.startContainer=rangeObject.startContainer;backupRangeObject.endContainer=rangeObject.endContainer;backupRangeObject.startOffset=rangeObject.startOffset;backupRangeObject.endOffset=rangeObject.endOffset;}
if(markupObject.isReplacingElement){if(backupRangeObject&&backupRangeObject.startContainer.className&&backupRangeObject.startContainer.className.indexOf('preparedForRemoval')>-1){parentElement=jQuery(backupRangeObject.startContainer).parents(markupObject[0].tagName).get(0);backupRangeObject.startContainer=parentElement;rangeObject.startContainer=parentElement;}
if(backupRangeObject&&backupRangeObject.endContainer.className&&backupRangeObject.endContainer.className.indexOf('preparedForRemoval')>-1){parentElement=jQuery(backupRangeObject.endContainer).parents(markupObject[0].tagName).get(0);backupRangeObject.endContainer=parentElement;rangeObject.endContainer=parentElement;}}
jQuery('.preparedForRemoval').zap();if(markupObject.isReplacingElement){if(e5s.Node.ELEMENT_NODE===backupRangeObject.startContainer.nodeType&&backupRangeObject.startContainer.childNodes&&backupRangeObject.startContainer.childNodes.length<backupRangeObject.startOffset){backupRangeObject.startOffset=backupRangeObject.startContainer.childNodes.length;rangeObject.startOffset=backupRangeObject.startContainer.childNodes.length;}
if(e5s.Node.ELEMENT_NODE===backupRangeObject.endContainer.nodeType&&backupRangeObject.endContainer.childNodes&&backupRangeObject.endContainer.childNodes.length<backupRangeObject.endOffset){backupRangeObject.endOffset=backupRangeObject.endContainer.childNodes.length;rangeObject.endOffset=backupRangeObject.endContainer.childNodes.length;}
rangeObject.endContainer=backupRangeObject.endContainer;rangeObject.endOffset=backupRangeObject.endOffset;rangeObject.startContainer=backupRangeObject.startContainer;rangeObject.startOffset=backupRangeObject.startOffset;backupRangeObject.update();backupRangeObject.select();}else{rangeObject.update();rangeObject.select();}},areMarkupObjectsAsLongAsRangeObject:function(relevantMarkupObjectsAtSelectionStart,relevantMarkupObjectsAtSelectionEnd,rangeObject){var i,el,textNode,relMarkupEnd,relMarkupStart;if(rangeObject.startOffset!==0){return false;}
for(i=0,relMarkupStart=relevantMarkupObjectsAtSelectionStart.length;i<relMarkupStart;i++){el=jQuery(relevantMarkupObjectsAtSelectionStart[i]);if(el.textNodes().first()[0]!==rangeObject.startContainer){return false;}}
for(i=0,relMarkupEnd=relevantMarkupObjectsAtSelectionEnd.length;i<relMarkupEnd;i++){el=jQuery(relevantMarkupObjectsAtSelectionEnd[i]);textNode=el.textNodes().last()[0];if(textNode!==rangeObject.endContainer||textNode.length!=rangeObject.endOffset){return false;}}
return true;},splitRelevantMarkupObject:function(relevantMarkupObjectsAtSelectionStart,relevantMarkupObjectsAtSelectionEnd,rangeObject,tagComparator){jQuery(relevantMarkupObjectsAtSelectionStart).addClass('preparedForRemoval');jQuery(relevantMarkupObjectsAtSelectionEnd).addClass('preparedForRemoval');if(this.areMarkupObjectsAsLongAsRangeObject(relevantMarkupObjectsAtSelectionStart,relevantMarkupObjectsAtSelectionEnd,rangeObject)){return true;}
var relevantMarkupObjectAtSelectionStartAndEnd=this.intersectRelevantMarkupObjects(relevantMarkupObjectsAtSelectionStart,relevantMarkupObjectsAtSelectionEnd);if(relevantMarkupObjectAtSelectionStartAndEnd){this.insertCroppedMarkups([relevantMarkupObjectAtSelectionStartAndEnd],rangeObject,false,tagComparator);this.insertCroppedMarkups([relevantMarkupObjectAtSelectionStartAndEnd],rangeObject,true,tagComparator);}else{this.insertCroppedMarkups(relevantMarkupObjectsAtSelectionStart,rangeObject,false,tagComparator);this.insertCroppedMarkups(relevantMarkupObjectsAtSelectionEnd,rangeObject,true,tagComparator);}
return true;},intersectRelevantMarkupObjects:function(relevantMarkupObjectsAtSelectionStart,relevantMarkupObjectsAtSelectionEnd){var intersection=false,i,elStart,j,elEnd,relMarkupStart,relMarkupEnd;if(!relevantMarkupObjectsAtSelectionStart||!relevantMarkupObjectsAtSelectionEnd){return intersection;}
relMarkupStart=relevantMarkupObjectsAtSelectionStart.length;relMarkupEnd=relevantMarkupObjectsAtSelectionEnd.length;for(i=0;i<relMarkupStart;i++){elStart=relevantMarkupObjectsAtSelectionStart[i];for(j=0;j<relMarkupEnd;j++){elEnd=relevantMarkupObjectsAtSelectionEnd[j];if(elStart===elEnd){intersection=elStart;}}}
return intersection;},extendExistingMarkupWithSelection:function(relevantMarkupObjects,rangeObject,startOrEnd,tagComparator){var extendMarkupsAtStart,extendMarkupsAtEnd,objects,i,relMarkupLength,el,textnodes,nodeNr;if(!startOrEnd){extendMarkupsAtStart=true;}
if(startOrEnd){extendMarkupsAtEnd=true;}
objects=[];for(i=0,relMarkupLength=relevantMarkupObjects.length;i<relMarkupLength;i++){objects[i]=new this.SelectionRange();el=relevantMarkupObjects[i];if(extendMarkupsAtEnd&&!extendMarkupsAtStart){objects[i].startContainer=rangeObject.startContainer;objects[i].startOffset=rangeObject.startOffset;textnodes=jQuery(el).textNodes(true);nodeNr=textnodes.length-1;objects[i].endContainer=textnodes[nodeNr];objects[i].endOffset=textnodes[nodeNr].length;objects[i].update();this.applyMarkup(objects[i].getSelectionTree(),rangeObject,this.getClonedMarkup4Wrapping(el),tagComparator,{setRangeObject2NewMarkup:true});}
if(!extendMarkupsAtEnd&&extendMarkupsAtStart){textnodes=jQuery(el).textNodes(true);objects[i].startContainer=textnodes[0];objects[i].startOffset=0;objects[i].endContainer=rangeObject.endContainer;objects[i].endOffset=rangeObject.endOffset;objects[i].update();this.applyMarkup(objects[i].getSelectionTree(),rangeObject,this.getClonedMarkup4Wrapping(el),tagComparator,{setRangeObject2NewMarkup:true});}}
return true;},getClonedMarkup4Wrapping:function(domobj){var wrapper=jQuery(domobj.outerHTML).removeClass('preparedForRemoval').empty();if(wrapper.attr('class').length===0){wrapper.removeAttr('class');}
return wrapper;},insertCroppedMarkups:function(relevantMarkupObjects,rangeObject,startOrEnd,tagComparator){var cropMarkupsAtEnd,cropMarkupsAtStart,textnodes,objects,i,el,textNodes;if(!startOrEnd){cropMarkupsAtEnd=true;}else{cropMarkupsAtStart=true;}
objects=[];for(i=0;i<relevantMarkupObjects.length;i++){objects[i]=new this.SelectionRange();el=relevantMarkupObjects[i];if(cropMarkupsAtEnd&&!cropMarkupsAtStart){textNodes=jQuery(el).textNodes(true);objects[i].startContainer=textNodes[0];objects[i].startOffset=0;if(objects[i].startContainer===rangeObject.startContainer&&objects[i].startOffset===rangeObject.startOffset){continue;}
if(rangeObject.startOffset===0){objects[i].endContainer=this.getTextNodeSibling(false,el,rangeObject.startContainer);objects[i].endOffset=objects[i].endContainer.length;}else{objects[i].endContainer=rangeObject.startContainer;objects[i].endOffset=rangeObject.startOffset;}
objects[i].update();this.applyMarkup(objects[i].getSelectionTree(),rangeObject,this.getClonedMarkup4Wrapping(el),tagComparator,{setRangeObject2NextSibling:true});}
if(!cropMarkupsAtEnd&&cropMarkupsAtStart){objects[i].startContainer=rangeObject.endContainer;objects[i].startOffset=rangeObject.endOffset;textnodes=jQuery(el).textNodes(true);objects[i].endContainer=textnodes[textnodes.length-1];objects[i].endOffset=textnodes[textnodes.length-1].length;objects[i].update();this.applyMarkup(objects[i].getSelectionTree(),rangeObject,this.getClonedMarkup4Wrapping(el),tagComparator,{setRangeObject2PreviousSibling:true});}}
return true;},changeMarkupOnSelection:function(markupObject){var rangeObject=this.getRangeObject();this.changeMarkup(rangeObject,markupObject,this.getStandardTagComparator(markupObject));GENTICS.Utils.Dom.doCleanup({'merge':true},rangeObject);rangeObject.update();rangeObject.select();this.rangeObject=rangeObject;},applyMarkup:function(selectionTree,rangeObject,markupObject,tagComparator,options){var optimizedSelectionTree,i,el,breakpoint;options=options||{};this.prepareForRemoval(selectionTree,markupObject,tagComparator);optimizedSelectionTree=this.optimizeSelectionTree4Markup(selectionTree,markupObject,tagComparator);breakpoint=true;for(i=0;i<optimizedSelectionTree.length;i++){el=optimizedSelectionTree[i];if(el.wrappable){this.wrapMarkupAroundSelectionTree(el.elements,rangeObject,markupObject,tagComparator,options);}else{Aloha.Log.debug(this,'dive further into non-wrappable object');this.applyMarkup(el.element.children,rangeObject,markupObject,tagComparator,options);}}},getMarkupType:function(markupObject){var nn=jQuery(markupObject)[0].nodeName.toLowerCase();if(markupObject.outerHtml){Aloha.Log.debug(this,'Node name detected: '+nn+' for: '+markupObject.outerHtml());}
if(nn=='#text'){return'textNode';}
if(this.replacingElements[nn]){return'sectionOrGroupingContent';}
if(this.tagHierarchy[nn]){return'textLevelSemantics';}
Aloha.Log.warn(this,'unknown markup passed to this.getMarkupType(...): '+markupObject.outerHtml());},getStandardTagComparator:function(markupObject){var that=this,result;switch(this.getMarkupType(markupObject)){case'textNode':result=function(p1,p2){return false;};break;case'sectionOrGroupingContent':result=function(domobj,markupObject){return that.standardSectionsAndGroupingContentComparator(domobj,markupObject);};break;default:result=function(domobj,markupObject){return that.standardTextLevelSemanticsComparator(domobj,markupObject);};break;}
return result;},prepareForRemoval:function(selectionTree,markupObject,tagComparator){var that=this,i,el;if(typeof tagComparator!=='undefined'&&typeof tagComparator!=='function'){Aloha.Log.error(this,'parameter tagComparator is not a function');}
if(typeof tagComparator==='undefined'){tagComparator=this.getStandardTagComparator(markupObject);}
for(i=0;i<selectionTree.length;i++){el=selectionTree[i];if(el.domobj&&(el.selection=='full'||(el.selection=='partial'&&markupObject.isReplacingElement))){if(el.domobj.nodeType===1&&tagComparator(el.domobj,markupObject)){Aloha.Log.debug(this,'Marking for removal: '+el.domobj.nodeName);jQuery(el.domobj).addClass('preparedForRemoval');}}
if(el.selection!='none'&&el.children.length>0){this.prepareForRemoval(el.children,markupObject,tagComparator);}}},wrapMarkupAroundSelectionTree:function(selectionTree,rangeObject,markupObject,tagComparator,options){var objects2wrap=[],j=-1,breakpoint=true,preText='',postText='',prevOrNext,textNode2Start,textnodes,newMarkup,i,el,middleText;Aloha.Log.debug(this,'The formatting <'+markupObject[0].tagName+'> will be wrapped around the selection');for(i=0;i<selectionTree.length;i++){el=selectionTree[i];if(el.domobj&&!this.canTag1WrapTag2(el.domobj.parentNode.tagName.toLowerCase(),markupObject[0].tagName.toLowerCase())){Aloha.Log.info(this,'Skipping the wrapping of <'+markupObject[0].tagName.toLowerCase()+'> because this tag is not allowed inside <'+el.domobj.parentNode.tagName.toLowerCase()+'>');continue;}
if(el.domobj&&el.domobj.nodeType===3&&jQuery.trim(el.domobj.nodeValue).length===0){continue;}
if(el.domobj&&el.selection=='partial'&&!markupObject.isReplacingElement){if(el.startOffset!==undefined&&el.endOffset===undefined){j++;preText+=el.domobj.data.substr(0,el.startOffset);el.domobj.data=el.domobj.data.substr(el.startOffset,el.domobj.data.length-el.startOffset);objects2wrap[j]=el.domobj;}else if(el.endOffset!==undefined&&el.startOffset===undefined){j++;postText+=el.domobj.data.substr(el.endOffset,el.domobj.data.length-el.endOffset);el.domobj.data=el.domobj.data.substr(0,el.endOffset);objects2wrap[j]=el.domobj;}else if(el.endOffset!==undefined&&el.startOffset!==undefined){if(el.startOffset==el.endOffset){Aloha.Log.debug(this,'skipping empty selection');continue;}
j++;preText+=el.domobj.data.substr(0,el.startOffset);middleText=el.domobj.data.substr(el.startOffset,el.endOffset-el.startOffset);postText+=el.domobj.data.substr(el.endOffset,el.domobj.data.length-el.endOffset);el.domobj.data=middleText;objects2wrap[j]=el.domobj;}else{Aloha.Log.debug(this,'diving into object');this.applyMarkup(el.children,rangeObject,markupObject,tagComparator,options);}}
if(el.domobj&&(el.selection=='full'||(el.selection=='partial'&&markupObject.isReplacingElement))){j++;objects2wrap[j]=el.domobj;}}
if(objects2wrap.length>0){objects2wrap=jQuery(objects2wrap);jQuery.each(objects2wrap,function(index,element){if(jQuery.browser.msie&&element.nodeType==3&&!element.nextSibling&&!element.previousSibling&&element.parentNode&&element.parentNode.nodeName.toLowerCase()=='li'){element.data=jQuery.trim(element.data);}});newMarkup=objects2wrap.wrapAll(markupObject).parent();newMarkup.before(preText).after(postText);if(options.setRangeObject2NewMarkup){textnodes=objects2wrap.textNodes();if(textnodes.index(rangeObject.startContainer)!=-1){rangeObject.startOffset=0;}
if(textnodes.index(rangeObject.endContainer)!=-1){rangeObject.endOffset=rangeObject.endContainer.length;}
breakpoint=true;}
if(options.setRangeObject2NextSibling){prevOrNext=true;textNode2Start=newMarkup.textNodes(true).last()[0];if(objects2wrap.index(rangeObject.startContainer)!=-1){rangeObject.startContainer=this.getTextNodeSibling(prevOrNext,newMarkup.parent(),textNode2Start);rangeObject.startOffset=0;}
if(objects2wrap.index(rangeObject.endContainer)!=-1){rangeObject.endContainer=this.getTextNodeSibling(prevOrNext,newMarkup.parent(),textNode2Start);rangeObject.endOffset=rangeObject.endOffset-textNode2Start.length;}}
if(options.setRangeObject2PreviousSibling){prevOrNext=false;textNode2Start=newMarkup.textNodes(true).first()[0];if(objects2wrap.index(rangeObject.startContainer)!=-1){rangeObject.startContainer=this.getTextNodeSibling(prevOrNext,newMarkup.parent(),textNode2Start);rangeObject.startOffset=0;}
if(objects2wrap.index(rangeObject.endContainer)!=-1){rangeObject.endContainer=this.getTextNodeSibling(prevOrNext,newMarkup.parent(),textNode2Start);rangeObject.endOffset=rangeObject.endContainer.length;}}}},getTextNodeSibling:function(previousOrNext,commonAncestorContainer,currentTextNode){var textNodes=jQuery(commonAncestorContainer).textNodes(true),newIndex,index;index=textNodes.index(currentTextNode);if(index==-1){return false;}
newIndex=index+(!previousOrNext?-1:1);return textNodes[newIndex]||false;},optimizeSelectionTree4Markup:function(selectionTree,markupObject,tagComparator){var groupMap=[],outerGroupIndex=0,innerGroupIndex=0,that=this,i,j,endPosition,startPosition;if(typeof tagComparator==='undefined'){tagComparator=function(domobj,markupObject){return that.standardTextLevelSemanticsComparator(markupObject);};}
for(i=0;i<selectionTree.length;i++){if(selectionTree[i].domobj&&selectionTree[i].selection!='none'){if(markupObject.isReplacingElement&&tagComparator(markupObject[0],jQuery(selectionTree[i].domobj))){if(groupMap[outerGroupIndex]!==undefined){outerGroupIndex++;}
groupMap[outerGroupIndex]={};groupMap[outerGroupIndex].wrappable=true;groupMap[outerGroupIndex].elements=[];groupMap[outerGroupIndex].elements[innerGroupIndex]=selectionTree[i];outerGroupIndex++;}else if(this.canMarkupBeApplied2ElementAsWhole([selectionTree[i]],markupObject)){if(groupMap[outerGroupIndex]===undefined){groupMap[outerGroupIndex]={};groupMap[outerGroupIndex].wrappable=true;groupMap[outerGroupIndex].elements=[];}
if(markupObject.isReplacingElement){startPosition=i;for(j=i-1;j>=0;j--){if(this.canMarkupBeApplied2ElementAsWhole([selectionTree[j]],markupObject)&&this.isMarkupAllowedToStealSelectionTreeElement(selectionTree[j],markupObject)){startPosition=j;}else{break;}}
endPosition=i;for(j=i+1;j<selectionTree.length;j++){if(this.canMarkupBeApplied2ElementAsWhole([selectionTree[j]],markupObject)&&this.isMarkupAllowedToStealSelectionTreeElement(selectionTree[j],markupObject)){endPosition=j;}else{break;}}
innerGroupIndex=0;for(j=startPosition;j<=endPosition;j++){groupMap[outerGroupIndex].elements[innerGroupIndex]=selectionTree[j];groupMap[outerGroupIndex].elements[innerGroupIndex].selection='full';innerGroupIndex++;}
innerGroupIndex=0;}else{groupMap[outerGroupIndex].elements[innerGroupIndex]=selectionTree[i];innerGroupIndex++;}}else{if(groupMap[outerGroupIndex]!==undefined){outerGroupIndex++;}
groupMap[outerGroupIndex]={};groupMap[outerGroupIndex].wrappable=false;groupMap[outerGroupIndex].element=selectionTree[i];innerGroupIndex=0;outerGroupIndex++;}}}
return groupMap;},isMarkupAllowedToStealSelectionTreeElement:function(selectionTreeElement,markupObject){if(!selectionTreeElement.domobj){return false;}
var maybeTextNodeName=selectionTreeElement.domobj.nodeName.toLowerCase(),nodeName=(maybeTextNodeName=='#text')?'textNode':maybeTextNodeName,markupName=markupObject[0].nodeName.toLowerCase(),elemMap=this.allowedToStealElements[markupName];return elemMap&&elemMap[nodeName];},canMarkupBeApplied2ElementAsWhole:function(selectionTree,markupObject){var htmlTag,i,el,returnVal;if(markupObject.jquery){htmlTag=markupObject[0].tagName;}
if(markupObject.tagName){htmlTag=markupObject.tagName;}
returnVal=true;for(i=0;i<selectionTree.length;i++){el=selectionTree[i];if(el.domobj&&(el.selection!="none"||markupObject.isReplacingElement)){if(!this.canTag1WrapTag2(htmlTag,el.domobj.nodeName)){return false;}
if(el.children.length>0&&!this.canMarkupBeApplied2ElementAsWhole(el.children,markupObject)){return false;}}}
return returnVal;},canTag1WrapTag2:function(t1,t2){t1=(t1=='#text')?'textNode':t1.toLowerCase();t2=(t2=='#text')?'textNode':t2.toLowerCase();var t1Map=this.tagHierarchy[t1];if(!t1Map){return true;}
if(!this.tagHierarchy[t2]){return true;}
return t1Map[t2];},mayInsertTag:function(tagName){var i;if(typeof this.rangeObject.unmodifiableMarkupAtStart=='object'){for(i=0;i<this.rangeObject.unmodifiableMarkupAtStart.length;++i){if(!this.canTag1WrapTag2(this.rangeObject.unmodifiableMarkupAtStart[i].nodeName,tagName)){return false;}}
return true;}
Aloha.Log.warn(this,'Unable to determine whether tag '+tagName+' may be inserted');return true;},toString:function(){return'Aloha.Selection';},SelectionRange:GENTICS.Utils.RangeObject.extend({_constructor:function(rangeObject){this._super(rangeObject);if(rangeObject){if(rangeObject.commonAncestorContainer){this.commonAncestorContainer=rangeObject.commonAncestorContainer;}
if(rangeObject.selectionTree){this.selectionTree=rangeObject.selectionTree;}
if(rangeObject.limitObject){this.limitObject=rangeObject.limitObject;}
if(rangeObject.markupEffectiveAtStart){this.markupEffectiveAtStart=rangeObject.markupEffectiveAtStart;}
if(rangeObject.unmodifiableMarkupAtStart){this.unmodifiableMarkupAtStart=rangeObject.unmodifiableMarkupAtStart;}
if(rangeObject.splitObject){this.splitObject=rangeObject.splitObject;}}},commonAncestorContainer:undefined,selectionTree:undefined,markupEffectiveAtStart:[],unmodifiableMarkupAtStart:[],limitObject:undefined,splitObject:undefined,select:function(){this._super();Aloha.Selection.updateSelection();},update:function(commonAncestorContainer){this.updatelimitObject();this.updateMarkupEffectiveAtStart();this.updateCommonAncestorContainer(commonAncestorContainer);this.selectionTree=undefined;},getSelectionTree:function(){if(!this.selectionTree){this.selectionTree=Aloha.Selection.getSelectionTree(this);}
return this.selectionTree;},getSelectedSiblings:function(domobj){var selectionTree=this.getSelectionTree();return this.recursionGetSelectedSiblings(domobj,selectionTree);},recursionGetSelectedSiblings:function(domobj,selectionTree){var selectedSiblings=false,foundObj=false,i;for(i=0;i<selectionTree.length;++i){if(selectionTree[i].domobj===domobj){foundObj=true;selectedSiblings=[];}else if(!foundObj&&selectionTree[i].children){selectedSiblings=this.recursionGetSelectedSiblings(domobj,selectionTree[i].children);if(selectedSiblings!==false){break;}}else if(foundObj&&selectionTree[i].domobj&&selectionTree[i].selection!='collapsed'&&selectionTree[i].selection!='none'){selectedSiblings.push(selectionTree[i].domobj);}else if(foundObj&&selectionTree[i].selection=='none'){break;}}
return selectedSiblings;},updateMarkupEffectiveAtStart:function(){this.markupEffectiveAtStart=[];this.unmodifiableMarkupAtStart=[];var parents=this.getStartContainerParents(),limitFound=false,splitObjectWasSet,i,el;for(i=0;i<parents.length;i++){el=parents[i];if(!limitFound&&(el!==this.limitObject)){this.markupEffectiveAtStart[i]=el;if(!splitObjectWasSet&&GENTICS.Utils.Dom.isSplitObject(el)){splitObjectWasSet=true;this.splitObject=el;}}else{limitFound=true;this.unmodifiableMarkupAtStart.push(el);}}
if(!splitObjectWasSet){this.splitObject=false;}
return;},updatelimitObject:function(){if(Aloha.editables&&Aloha.editables.length>0){var parents=this.getStartContainerParents(),editables=Aloha.editables,i,el,j,editable;for(i=0;i<parents.length;i++){el=parents[i];for(j=0;j<editables.length;j++){editable=editables[j].obj[0];if(el===editable){this.limitObject=el;return true;}}}}
this.limitObject=jQuery('body');return true;},toString:function(verbose){if(!verbose){return'Aloha.Selection.SelectionRange';}
return'Aloha.Selection.SelectionRange {start ['+this.startContainer.nodeValue+'] offset '+this.startOffset+', end ['+this.endContainer.nodeValue+'] offset '+this.endOffset+'}';}})});function nestedListInIEWorkaround(range){var nextSibling;if(jQuery.browser.msie&&range.startContainer===range.endContainer&&range.startOffset===range.endOffset&&range.startContainer.nodeType==3&&range.startOffset==range.startContainer.data.length&&range.startContainer.nextSibling){nextSibling=range.startContainer.nextSibling;if('OL'===nextSibling.nodeName||'UL'===nextSibling.nodeName){if(range.startContainer.data[range.startContainer.data.length-1]==' '){range.startOffset=range.endOffset=range.startOffset-1;}else{range.startContainer.data=range.startContainer.data+' ';}}}}
function correctRange(range){nestedListInIEWorkaround(range);return range;}
var AlohaSelection=Class.extend({_constructor:function(nativeSelection){this._nativeSelection=nativeSelection;this.ranges=[];this.preventChange=false;},anchorNode:null,anchorOffset:0,focusNode:null,focusOffset:0,isCollapsed:false,rangeCount:0,collapse:function(parentNode,offset){this._nativeSelection.collapse(parentNode,offset);},collapseToStart:function(){throw"NOT_IMPLEMENTED";},extend:function(parentNode,offset){},modify:function(alter,direction,granularity){},collapseToEnd:function(){throw"NOT_IMPLEMENTED";},selectAllChildren:function(parentNode){throw"NOT_IMPLEMENTED";},deleteFromDocument:function(){throw"NOT_IMPLEMENTED";},getRangeAt:function(index){return correctRange(this._nativeSelection.getRangeAt(index));},addRange:function(range){this._nativeSelection.addRange(range);this._nativeSelection._ranges[0]=correctRange(range);Aloha.Selection.updateSelection();},removeRange:function(range){this._nativeSelection.removeRange();},removeAllRanges:function(){this._nativeSelection.removeAllRanges();},refresh:function(event){},toString:function(){return'Aloha.Selection';},getRangeCount:function(){return this._nativeSelection.rangeCount;}});Aloha.getSelection=function(target){target=(target!==document||target!==window)?window:target;return new AlohaSelection(window.rangy.getSelection(target));};Aloha.createRange=function(givenWindow){return window.rangy.createRange(givenWindow);};var selection=new Selection();Aloha.Selection=selection;return selection;});define('aloha/block-jump',['aloha/core','jquery'],function(Aloha,$){var zeroWidthNode=null;function replaceMergeTextNode(node,text){node.deleteData(0,node.length);if(''!==text){if(node.nextSibling&&3===node.nextSibling.nodeType){node.nextSibling.insertData(0,text);}else if(node.previousSibling&&3===node.previousSibling.nodeType){node.previousSibling.insertData(node.previousSibling.length,text);}else{node.insertData(0,text);}}
setTimeout(function(){if(0===node.length){$(node).remove();}},0);}
function removeZeroWidthTextNodeFix(){if(!zeroWidthNode){return;}
var text=zeroWidthNode.nodeValue.replace(/\u200b/,'');if(text===zeroWidthNode.nodeValue){console.warn('Expected to remove the zero width text node fix, but couldn\'t find it');}
replaceMergeTextNode(zeroWidthNode,text);zeroWidthNode=null;}
function insertZeroWidthTextNodeFix(block,isGoingLeft){removeZeroWidthTextNodeFix();zeroWidthNode=document.createTextNode("\u200b");if(isGoingLeft){$(block).after(zeroWidthNode);}else{$(block).before(zeroWidthNode);}
Aloha.bind('aloha-selection-changed',function(event){removeZeroWidthTextNodeFix();Aloha.unbind(event);});return zeroWidthNode;}
return{removeZeroWidthTextNodeFix:removeZeroWidthTextNodeFix,insertZeroWidthTextNodeFix:insertZeroWidthTextNodeFix};});define('aloha/markup',['aloha/core','util/class','jquery','aloha/ecma5shims','aloha/console','aloha/block-jump'],function(Aloha,Class,jQuery,shims,console,BlockJump){var GENTICS=window.GENTICS;var isOldIE=!!(jQuery.browser.msie&&9>parseInt(jQuery.browser.version,10));function isBR(node){return'BR'===node.nodeName;}
function isBlock(node){return'false'===jQuery(node).attr('contenteditable');}
function isTextNode(node){return node&&3===node.nodeType;}
function nodeLength(node){return!node?0:(isTextNode(node)?node.length:node.childNodes.length);}
function isVisibleTextNode(node){return 0<node.data.replace(/\s+/g,'').length;}
function nextVisibleNode(node){if(!node){return null;}
if(node.nextSibling){if(isTextNode(node.nextSibling)&&!isVisibleTextNode(node.nextSibling)){return nextVisibleNode(node.nextSibling);}
if(isBR(node.nextSibling)&&node.nextSibling===node.parentNode.lastChild){return nextVisibleNode(node.nextSibling);}
if(''===node.nextSibling.innerHTML&&!isBlock(node.nextSibling)){return nextVisibleNode(node.nextSibling);}
return node.nextSibling;}
if(node.parentNode){return nextVisibleNode(node.parentNode);}
return null;}
function prevVisibleNode(node){if(!node){return null;}
if(node.previousSibling){if(isTextNode(node.previousSibling)&&!isVisibleTextNode(node.previousSibling)){return prevVisibleNode(node.previousSibling);}
if(''===node.previousSibling.innerHTML&&!isBlock(node.previousSibling)){return prevVisibleNode(node.previouSibling);}
return node.previousSibling;}
if(node.parentNode){return prevVisibleNode(node.parentNode);}
return null;}
function isFrontPosition(node,offset){return(0===offset)||(offset<=node.data.length-node.data.replace(/^\s+/,'').length);}
function isBlockInsideEditable($block){return $block.parent().hasClass('aloha-editable');}
function isEndPosition(node,offset){var length=nodeLength(node);if(length===offset){return true;}
var isText=isTextNode(node);if(isText&&node.data.replace(/\s+$/,'').length===offset){return true;}
if(1===length&&!isText){return isBR(node.childNodes[0]);}
return false;}
function blink(node){jQuery(node).stop(true).css({opacity:0}).fadeIn(0).delay(100).fadeIn(function(){jQuery(node).css({opacity:1});});return node;}
function nodeContains(node1,node2){return isOldIE?(shims.compareDocumentPosition(node1,node2)&16):0<jQuery(node1).find(node2).length;}
function isInsidePlaceholder(range){var start=range.startContainer;var end=range.endContainer;var $placeholder=window.$_alohaPlaceholder;return $placeholder.is(start)||$placeholder.is(end)||nodeContains($placeholder[0],start)||nodeContains($placeholder[0],end);}
function cleanupPlaceholders(range){if(window.$_alohaPlaceholder&&!isInsidePlaceholder(range)){if(0===window.$_alohaPlaceholder.html().replace(/^(&nbsp;)*$/,'').length){window.$_alohaPlaceholder.remove();}
window.$_alohaPlaceholder=null;}}
function jumpBlock(block,isGoingLeft,currentRange){var range=new GENTICS.Utils.RangeObject();var sibling=isGoingLeft?prevVisibleNode(block):nextVisibleNode(block);if(!sibling||isBlock(sibling)){var $landing=jQuery('<div>&nbsp;</div>');if(isGoingLeft){jQuery(block).before($landing);}else{jQuery(block).after($landing);}
range.startContainer=range.endContainer=$landing[0];range.startOffset=range.endOffset=0;cleanupPlaceholders(range);window.$_alohaPlaceholder=$landing;}else{var moveToBoundaryPositionInIE=((currentRange.startContainer.nodeType===3&&currentRange.startContainer===currentRange.endContainer&&currentRange.startContainer.nodeValue!==""&&(isGoingLeft?currentRange.startOffset===1:currentRange.endOffset+1===currentRange.endContainer.length))||(currentRange.startContainer.nodeType===1&&(!currentRange.startOffset||(currentRange.startContainer.childNodes[currentRange.startOffset]&&currentRange.startContainer.childNodes[currentRange.startOffset].nodeType===1))));if(moveToBoundaryPositionInIE){var zeroWidthNode=BlockJump.insertZeroWidthTextNodeFix(block,isGoingLeft);range.startContainer=range.endContainer=zeroWidthNode;range.startOffset=range.endOffset=isGoingLeft?1:0;}else{range.startContainer=range.endContainer=sibling;range.startOffset=range.endOffset=isGoingLeft?nodeLength(sibling):0;if(!isGoingLeft){BlockJump.insertZeroWidthTextNodeFix(block,true);}}
cleanupPlaceholders(range);}
range.select();Aloha.trigger('aloha-block-selected',block);Aloha.Selection.preventSelectionChanged();}
Aloha.Markup=Class.extend({keyHandlers:{},addKeyHandler:function(keyCode,handler){if(!this.keyHandlers[keyCode]){this.keyHandlers[keyCode]=[];}
this.keyHandlers[keyCode].push(handler);},removeKeyHandler:function(keyCode){if(this.keyHandlers[keyCode]){this.keyHandlers[keyCode]=null;}},insertBreak:function(){var range=Aloha.Selection.rangeObject,nonWSIndex,nextTextNode,newBreak;if(!range.isCollapsed()){this.removeSelectedMarkup();}
newBreak=jQuery('<br/>');GENTICS.Utils.Dom.insertIntoDOM(newBreak,range,Aloha.activeEditable.obj);nextTextNode=GENTICS.Utils.Dom.searchAdjacentTextNode(newBreak.parent().get(0),GENTICS.Utils.Dom.getIndexInParent(newBreak.get(0))+1,false);if(nextTextNode){nonWSIndex=nextTextNode.data.search(/\S/);if(nonWSIndex>0){nextTextNode.data=nextTextNode.data.substring(nonWSIndex);}}
range.startContainer=range.endContainer=newBreak.get(0).parentNode;range.startOffset=range.endOffset=GENTICS.Utils.Dom.getIndexInParent(newBreak.get(0))+1;range.correctRange();range.clearCaches();range.select();},preProcessKeyStrokes:function(event){if(event.type!=='keydown'){return false;}
var rangeObject,handlers,i;if(this.keyHandlers[event.keyCode]){handlers=this.keyHandlers[event.keyCode];for(i=0;i<handlers.length;++i){if(!handlers[i](event)){return false;}}}
if(event.keyCode===37||event.keyCode===39){if(Aloha.getSelection().getRangeCount()){rangeObject=Aloha.getSelection().getRangeAt(0);if(this.processCursor(rangeObject,event.keyCode)){cleanupPlaceholders(Aloha.Selection.rangeObject);return true;}}
return false;}
if(event.keyCode===8){event.preventDefault();Aloha.execCommand('delete',false);return false;}
if(event.keyCode===46){Aloha.execCommand('forwarddelete',false);return false;}
if(event.keyCode===13){if(event.shiftKey){Aloha.execCommand('insertlinebreak',false);return false;}
Aloha.execCommand('insertparagraph',false);return false;}
return true;},processCursor:function(range,keyCode){if(!range.collapsed){return true;}
BlockJump.removeZeroWidthTextNodeFix();var node=range.startContainer,selection=Aloha.getSelection();if(!node){return true;}
var sibling,offset;if(jQuery.browser.msie&&parseInt(jQuery.browser.version,10)<=7&&isTextNode(node)){if(keyCode==37){offset=range.startOffset;while(offset>0&&node.data.charAt(offset-1)==='\u200b'){offset--;}
if(offset!=range.startOffset){range.setStart(range.startContainer,offset);range.setEnd(range.startContainer,offset);selection=Aloha.getSelection();selection.removeAllRanges();selection.addRange(range);}}else if(keyCode==39){offset=range.startOffset;while(offset<node.data.length&&node.data.charAt(offset)==='\u200b'){offset++;}
if(offset!=range.startOffset){range.setStart(range.startContainer,offset);range.setEnd(range.startContainer,offset);selection.removeAllRanges();selection.addRange(range);}}}
if(isOldIE&&!jQuery(node).contentEditable()){var $parentBlock=jQuery(node).parents('[contenteditable=false]');var isInsideBlock=$parentBlock.length>0;if(isInsideBlock){if(isBlockInsideEditable($parentBlock)){sibling=$parentBlock[0];}else{return true;}}}
var isLeft;if(!sibling){isLeft=(37===keyCode||38===keyCode);offset=range.startOffset;if(isTextNode(node)){if(isLeft){var isApproachingFrontPosition=(1===offset);if(!isApproachingFrontPosition&&!isFrontPosition(node,offset)){return true;}}else if(!isEndPosition(node,offset)){return true;}}else{node=node.childNodes[offset===nodeLength(node)?offset-1:offset];}
sibling=isLeft?prevVisibleNode(node):nextVisibleNode(node);}
if(isBlock(sibling)){jumpBlock(sibling,isLeft,range);return false;}
return true;},processShiftEnter:function(rangeObject){this.insertHTMLBreak(rangeObject.getSelectionTree(),rangeObject);},processEnter:function(rangeObject){if(rangeObject.splitObject){this.splitRangeObject(rangeObject);}else{this.insertHTMLBreak(rangeObject.getSelectionTree(),rangeObject);}},insertHTMLCode:function(html){var rangeObject=Aloha.Selection.rangeObject;this.insertHTMLBreak(rangeObject.getSelectionTree(),rangeObject,jQuery(html));},insertHTMLBreak:function(selectionTree,rangeObject,inBetweenMarkup){var i,treeLength,el,jqEl,jqElBefore,jqElAfter,tmpObject,offset,checkObj;inBetweenMarkup=inBetweenMarkup||jQuery('<br/>');for(i=0,treeLength=selectionTree.length;i<treeLength;++i){el=selectionTree[i];jqEl=el.domobj?jQuery(el.domobj):undefined;if(el.selection!=='none'){if(el.selection=='collapsed'){if(i>0){jqElBefore=jQuery(selectionTree[i-1].domobj);jqElBefore.after(inBetweenMarkup);}else{jqElAfter=jQuery(selectionTree[1].domobj);jqElAfter.before(inBetweenMarkup);}
rangeObject.startContainer=rangeObject.endContainer=inBetweenMarkup[0].parentNode;rangeObject.startOffset=rangeObject.endOffset=GENTICS.Utils.Dom.getIndexInParent(inBetweenMarkup[0])+1;rangeObject.correctRange();}else if(el.domobj&&el.domobj.nodeType===3){if(el.domobj.nextSibling&&el.domobj.nextSibling.nodeType==1&&Aloha.Selection.replacingElements[el.domobj.nextSibling.nodeName.toLowerCase()]){jqEl.after('<br/>');}
if(this.needEndingBreak()){checkObj=el.domobj;while(checkObj){if(checkObj.nextSibling){checkObj=false;}else{checkObj=checkObj.parentNode;if(GENTICS.Utils.Dom.isBlockLevelElement(checkObj)||GENTICS.Utils.Dom.isListElement(checkObj)){break;}
if(checkObj===rangeObject.limitObject){checkObj=false;}}}
if(checkObj){jQuery(checkObj).append('<br class="aloha-cleanme" />');}}
jqEl.between(inBetweenMarkup,el.startOffset);offset=0;tmpObject=inBetweenMarkup[0];while(tmpObject){tmpObject=tmpObject.previousSibling;++offset;}
rangeObject.startContainer=inBetweenMarkup[0].parentNode;rangeObject.endContainer=inBetweenMarkup[0].parentNode;rangeObject.startOffset=offset;rangeObject.endOffset=offset;rangeObject.correctRange();}else if(el.domobj&&el.domobj.nodeType===1){if(jqEl.parent().find('br.aloha-ephemera').length===0){jQuery(rangeObject.limitObject).find('br.aloha-ephemera').remove();jQuery(rangeObject.commonAncestorContainer).append(this.getFillUpElement(rangeObject.splitObject));}
jqEl.after(inBetweenMarkup);rangeObject.startContainer=rangeObject.commonAncestorContainer;rangeObject.endContainer=rangeObject.startContainer;rangeObject.startOffset=i+2;rangeObject.endOffset=i+2;rangeObject.update();}}}
rangeObject.select();},needEndingBreak:function(){return!jQuery.browser.msie;},getSelectedText:function(){var rangeObject=Aloha.Selection.rangeObject;if(rangeObject.isCollapsed()){return false;}
return this.getFromSelectionTree(rangeObject.getSelectionTree(),true);},getFromSelectionTree:function(selectionTree,astext){var text='',i,treeLength,el,clone;for(i=0,treeLength=selectionTree.length;i<treeLength;i++){el=selectionTree[i];if(el.selection=='partial'){if(el.domobj.nodeType===3){text+=el.domobj.data.substring(el.startOffset,el.endOffset);}else if(el.domobj.nodeType===1&&el.children){if(astext){text+=this.getFromSelectionTree(el.children,astext);}else{clone=jQuery(el.domobj.outerHTML).empty();clone.html(this.getFromSelectionTree(el.children,astext));text+=clone.outerHTML();}}}else if(el.selection=='full'){if(el.domobj.nodeType===3){text+=jQuery(el.domobj).text();}else if(el.domobj.nodeType===1&&el.children){text+=astext?jQuery(el.domobj).text():jQuery(el.domobj).outerHTML();}}}
return text;},getSelectedMarkup:function(){var rangeObject=Aloha.Selection.rangeObject;return rangeObject.isCollapsed()?null:this.getFromSelectionTree(rangeObject.getSelectionTree(),false);},removeSelectedMarkup:function(){var rangeObject=Aloha.Selection.rangeObject,newRange;if(rangeObject.isCollapsed()){return;}
newRange=new Aloha.Selection.SelectionRange();this.removeFromSelectionTree(rangeObject.getSelectionTree(),newRange);newRange.update();GENTICS.Utils.Dom.doCleanup({'merge':true,'removeempty':true},Aloha.Selection.rangeObject);Aloha.Selection.rangeObject=newRange;newRange.correctRange();newRange.update();newRange.select();Aloha.Selection.updateSelection();},removeFromSelectionTree:function(selectionTree,newRange){var firstPartialElement,newdata,i,el,adjacentTextNode,treeLength;for(i=0,treeLength=selectionTree.length;i<treeLength;i++){el=selectionTree[i];if(el.selection=='partial'){if(el.domobj.nodeType===3){newdata='';if(el.startOffset>0){newdata+=el.domobj.data.substring(0,el.startOffset);}
if(el.endOffset<el.domobj.data.length){newdata+=el.domobj.data.substring(el.endOffset,el.domobj.data.length);}
el.domobj.data=newdata;if(!newRange.startContainer){newRange.startContainer=newRange.endContainer=el.domobj;newRange.startOffset=newRange.endOffset=el.startOffset;}}else if(el.domobj.nodeType===1&&el.children){this.removeFromSelectionTree(el.children,newRange);if(firstPartialElement){if(firstPartialElement.nodeName==el.domobj.nodeName){jQuery(firstPartialElement).append(jQuery(el.domobj).contents());jQuery(el.domobj).remove();}}else{firstPartialElement=el.domobj;}}}else if(el.selection=='full'){if(!newRange.startContainer){adjacentTextNode=GENTICS.Utils.Dom.searchAdjacentTextNode(el.domobj.parentNode,GENTICS.Utils.Dom.getIndexInParent(el.domobj)+1,false,{'blocklevel':false});if(adjacentTextNode){newRange.startContainer=newRange.endContainer=adjacentTextNode;newRange.startOffset=newRange.endOffset=0;}else{newRange.startContainer=newRange.endContainer=el.domobj.parentNode;newRange.startOffset=newRange.endOffset=GENTICS.Utils.Dom.getIndexInParent(el.domobj)+1;}}
jQuery(el.domobj).remove();}}},splitRangeObject:function(rangeObject,markup){var splitObject=jQuery(rangeObject.splitObject),selectionTree,insertAfterObject,followUpContainer;rangeObject.update(rangeObject.splitObject);selectionTree=rangeObject.getSelectionTree();followUpContainer=this.getSplitFollowUpContainer(rangeObject);this.splitRangeObjectHelper(selectionTree,rangeObject,followUpContainer);if(followUpContainer.hasClass('preparedForRemoval')){followUpContainer.removeClass('preparedForRemoval');}
insertAfterObject=this.getInsertAfterObject(rangeObject,followUpContainer);jQuery(followUpContainer).insertAfter(insertAfterObject);if(rangeObject.splitObject.nodeName.toLowerCase()==='li'&&!Aloha.Selection.standardTextLevelSemanticsComparator(rangeObject.splitObject,followUpContainer)){jQuery(rangeObject.splitObject).remove();}
rangeObject.startContainer=null;var followContents=followUpContainer.contents();if(followContents.length>0&&followContents.get(0).nodeType==1&&followContents.get(0).nodeName.toLowerCase()==='br'){rangeObject.startContainer=followUpContainer.get(0);}
if(!rangeObject.startContainer){rangeObject.startContainer=followUpContainer.textNodes(true,true).first().get(0);}
if(!rangeObject.startContainer){rangeObject.startContainer=followUpContainer.textNodes(false).first().parent().get(0);}
if(rangeObject.startContainer){rangeObject.endContainer=rangeObject.startContainer;rangeObject.startOffset=0;rangeObject.endOffset=0;}else{rangeObject.startContainer=rangeObject.endContainer=followUpContainer.parent().get(0);rangeObject.startOffset=rangeObject.endOffset=GENTICS.Utils.Dom.getIndexInParent(followUpContainer.get(0));}
rangeObject.update();rangeObject.select();},getInsertAfterObject:function(rangeObject,followUpContainer){var passedSplitObject,i,el;for(i=0;i<rangeObject.markupEffectiveAtStart.length;i++){el=rangeObject.markupEffectiveAtStart[i];if(el===rangeObject.splitObject){passedSplitObject=true;}
if(!passedSplitObject){continue;}
if(Aloha.Selection.canTag1WrapTag2(jQuery(el).parent()[0].nodeName,followUpContainer[0].nodeName)){return el;}}
return false;},getFillUpElement:function(splitObject){if(jQuery.browser.msie){return false;}
return jQuery('<br class="aloha-cleanme"/>');},removeElementContentWhitespaceObj:function(domArray){var correction=0,removeLater=[],i,el,removeIndex;for(i=0;i<domArray.length;++i){el=domArray[i];if(el.isElementContentWhitespace){removeLater[removeLater.length]=i;}}
for(i=0;i<removeLater.length;++i){removeIndex=removeLater[i];domArray.splice(removeIndex-correction,1);++correction;}},splitRangeObjectHelper:function(selectionTree,rangeObject,followUpContainer,inBetweenMarkup){if(!followUpContainer){Aloha.Log.warn(this,'no followUpContainer, no inBetweenMarkup, nothing to do...');}
var fillUpElement=this.getFillUpElement(rangeObject.splitObject),splitObject=jQuery(rangeObject.splitObject),startMoving=false,el,i,completeText,jqObj,mirrorLevel,parent,treeLength;if(selectionTree.length>0){mirrorLevel=followUpContainer.contents();if(mirrorLevel.length!==selectionTree.length){this.removeElementContentWhitespaceObj(mirrorLevel);}
for(i=0,treeLength=selectionTree.length;i<treeLength;++i){el=selectionTree[i];if((el.selection==='none'&&startMoving===false)||(el.domobj&&el.domobj.nodeType===3&&el===selectionTree[(selectionTree.length-1)]&&el.startOffset===el.domobj.data.length)){if(followUpContainer.textNodes().length>1||(el.domobj.nodeType===1&&el.children.length===0)){mirrorLevel.eq(i).remove();}else if(GENTICS.Utils.Dom.isSplitObject(followUpContainer[0])){if(fillUpElement){followUpContainer.html(fillUpElement);}else{followUpContainer.empty();}}else{followUpContainer.empty();followUpContainer.addClass('preparedForRemoval');}
continue;}else{if(el.selection!=='none'){if(el.domobj&&el.domobj.nodeType===3&&el.startOffset!==undefined){completeText=el.domobj.data;if(el.startOffset>0){el.domobj.data=completeText.substr(0,el.startOffset);}else if(selectionTree.length>1){jQuery(el.domobj).remove();}else{parent=jQuery(el.domobj).parent();if(GENTICS.Utils.Dom.isSplitObject(parent[0])){if(fillUpElement){parent.html(fillUpElement);}else{parent.empty();}}else{parent.remove();}}
if(completeText.length-el.startOffset>0){mirrorLevel[i].data=completeText.substr(el.startOffset,completeText.length);}else if(mirrorLevel.length>1){mirrorLevel.eq((i)).remove();}else if(GENTICS.Utils.Dom.isBlockLevelElement(followUpContainer[0])){if(fillUpElement){followUpContainer.html(fillUpElement);}else{followUpContainer.empty();}}else{followUpContainer.empty();followUpContainer.addClass('preparedForRemoval');}}
startMoving=true;if(el.children.length>0){this.splitRangeObjectHelper(el.children,rangeObject,mirrorLevel.eq(i),inBetweenMarkup);}}else{if(el.selection==='none'&&startMoving===true){jqObj=jQuery(el.domobj).remove();}}}}}else{Aloha.Log.error(this,'can not split splitObject due to an empty selection tree');}
splitObject.find('br.aloha-ephemera:gt(0)').remove();followUpContainer.find('br.aloha-ephemera:gt(0)').remove();splitObject.find('.preparedForRemoval').remove();followUpContainer.find('.preparedForRemoval').remove();if(splitObject.contents().length===0&&GENTICS.Utils.Dom.isSplitObject(splitObject[0])&&fillUpElement){splitObject.html(fillUpElement);}
if(followUpContainer.contents().length===0&&GENTICS.Utils.Dom.isSplitObject(followUpContainer[0])&&fillUpElement){followUpContainer.html(fillUpElement);}},getSplitFollowUpContainer:function(rangeObject){var tagName=rangeObject.splitObject.nodeName.toLowerCase(),returnObj,inside,lastObj;switch(tagName){case'h1':case'h2':case'h3':case'h4':case'h5':case'h6':lastObj=jQuery(rangeObject.splitObject).textNodes(':not(.aloha-cleanme)').last()[0];if(lastObj&&rangeObject.startContainer===lastObj&&rangeObject.startOffset===lastObj.length){returnObj=jQuery('<p></p>');inside=jQuery(rangeObject.splitObject.outerHTML).contents();returnObj.append(inside);return returnObj;}
break;case'li':if(rangeObject.startContainer.nodeName.toLowerCase()==='br'&&jQuery(rangeObject.startContainer).hasClass('aloha-ephemera')){returnObj=jQuery('<p></p>');inside=jQuery(rangeObject.splitObject.outerHTML).contents();returnObj.append(inside);return returnObj;}
if(!rangeObject.splitObject.nextSibling&&jQuery.trim(jQuery(rangeObject.splitObject).text()).length===0){returnObj=jQuery('<p></p>');return returnObj;}
break;}
return jQuery(rangeObject.splitObject.outerHTML);},transformDomObject:function(domobj,nodeName,range){var jqOldObj=jQuery(domobj),jqNewObj=jQuery('<'+nodeName+'>'),i,attributes=jqOldObj[0].cloneNode(false).attributes;if(attributes){for(i=0;i<attributes.length;++i){if(typeof attributes[i].specified==='undefined'||attributes[i].specified){jqNewObj.attr(attributes[i].nodeName,attributes[i].nodeValue);}}}
if(jqOldObj[0].style&&jqOldObj[0].style.cssText){jqNewObj[0].style.cssText=jqOldObj[0].style.cssText;}
jqOldObj.contents().appendTo(jqNewObj);jqOldObj.replaceWith(jqNewObj);if(range){if(range.startContainer==domobj){range.startContainer=jqNewObj.get(0);}
if(range.endContainer==domobj){range.endContainer=jqNewObj.get(0);}}
return jqNewObj;},toString:function(){return'Aloha.Markup';}});Aloha.Markup=new Aloha.Markup();return Aloha.Markup;});define('aloha/observable',['jquery'],function(jQuery,undefined){var $=jQuery;return{_eventHandlers:null,bind:function(eventType,handler,scope){this._eventHandlers=this._eventHandlers||{};if(!this._eventHandlers[eventType]){this._eventHandlers[eventType]=[];}
this._eventHandlers[eventType].push({handler:handler,scope:(scope||window)});},unbind:function(eventType,handler){this._eventHandlers=this._eventHandlers||{};if(!this._eventHandlers[eventType]){return;}
if(!handler){this._eventHandlers[eventType]=[];}else{this._eventHandlers[eventType]=$.grep(this._eventHandlers[eventType],function(element){if(element.handler===handler){return false;}
return true;});}},trigger:function(eventType){this._eventHandlers=this._eventHandlers||{};if(!this._eventHandlers[eventType]){return;}
var preparedArguments=[];$.each(arguments,function(i,argument){if(i>0){preparedArguments.push(argument);}});$.each(this._eventHandlers[eventType],function(index,element){element.handler.apply(element.scope,preparedArguments);});},unbindAll:function(){this._eventHandlers=null;}};});define('aloha/registry',['jquery','aloha/observable','util/class'],function(jQuery,Observable,Class){return Class.extend(Observable,{_entries:null,_ids:null,_constructor:function(){this._entries={};this._ids=[];},register:function(id,entry){this._entries[id]=entry;this._ids.push(id);this.trigger('register',entry,id);},unregister:function(id){var i,oldEntry=this._entries[id];delete this._entries[id];for(i in this._ids){if(this._ids.hasOwnProperty(i)&&this._ids[i]===id){this._ids.splice(i,1);break;}}
this.trigger('unregister',oldEntry,id);},get:function(id){return this._entries[id];},has:function(id){return(this._entries[id]?true:false);},getEntries:function(){return jQuery.extend({},this._entries);},getIds:function(){return jQuery.extend([],this._ids);}});});define('aloha/contenthandlermanager',['jquery','aloha/registry','util/class','aloha/console'],function(jQuery,Registry,Class,console){return new(Registry.extend({createHandler:function(definition){if(typeof definition.handleContent!=='function'){throw'ContentHandler has no function handleContent().';}
var AbstractContentHandler=Class.extend({handleContent:function(content){}},definition);return new AbstractContentHandler();},handleContent:function(content,options){var handler,id,ids=this.getIds();if(typeof options.contenthandler==='undefined'){options.contenthandler=[];for(id in ids){if(ids.hasOwnProperty(id)){options.contenthandler.push(ids[id]);}}}
for(id in options.contenthandler){if(options.contenthandler.hasOwnProperty(id)){handler=this.get(options.contenthandler[id]);if(handler){if(typeof handler.handleContent==='function'){content=handler.handleContent(content,options);}else{console.error('A valid content handler needs the method handleContent.');}}
if(null===content){break;}}}
return content;}}))();});define('util/trees',['jquery'],function($){function walk(form,step,inplace){var type=$.type(form),subResult,result,resultOff,len,i,key;if('array'===type){result=(inplace?form:[]);resultOff=0;for(i=0,len=form.length;i<len;i++){subResult=step(form[i]);if(subResult.length){result[resultOff++]=subResult[0];}}
if(resultOff!==result.length){result=result.slice(0,resultOff);}}else if('object'===type){result=(inplace?form:{});for(key in form){if(form.hasOwnProperty(key)){subResult=step(form[key]);if(subResult.length){result[key]=subResult[0];}else{delete result[key];}}}}else{result=form;}
return result;}
function walkInplace(form,step){return walk(form,step,true);}
function walkDomInplace(form,step){var subResult,child,nextChild;if(1===form.nodeType){child=form.firstChild;while(child){subResult=step(child);nextChild=child.nextSibling;if(subResult.length){if(subResult[0]!==child){form.replaceChild(subResult[0],child);}}else{form.removeChild(child);}
child=nextChild;}}
return form;}
function prewalkStep(step,fn,walk,form){return[walk(fn(form),step)];}
function postwalkStep(step,fn,walk,form){return[fn(walk(form,step))];}
function prepruneStep(step,fn,walk,form){return fn(form)?[]:[walk(form,step)];}
function postpruneStep(step,fn,walk,form){var subForm=walk(form,step);return fn(subForm)?[]:[subForm];}
function prepost(step,fnOrPred,walk,form){function prepostStep(form){return step(prepostStep,fnOrPred,walk,form);}
return prepostStep(form)[0];}
function prewalk(form,fn,inplace){return prepost(prewalkStep,fn,inplace?walkInplace:walk,form);}
function postwalk(form,fn,inplace){return prepost(postwalkStep,fn,inplace?walkInplace:walk,form);}
function preprune(form,pred,inplace){return prepost(prepruneStep,pred,inplace?walkInplace:walk,form);}
function postprune(form,pred,inplace){return prepost(postpruneStep,pred,inplace?walkInplace:walk,form);}
function prewalkDom(form,fn,inplace){return prepost(prewalkStep,fn,walkDomInplace,inplace?form:form.cloneNode(true));}
function postwalkDom(form,fn,inplace){return prepost(postwalkStep,fn,walkDomInplace,inplace?form:form.cloneNode(true));}
function prepruneDom(form,pred,inplace){return prepost(prepruneStep,pred,walkDomInplace,inplace?form:form.cloneNode(true));}
function postpruneDom(form,pred,inplace){return prepost(postpruneStep,pred,walkDomInplace,inplace?form:form.cloneNode(true));}
function isLeaf(form){var type=$.type(form);return type!=='object'&&type!=='array';}
function identityStep(step,walk,form){return[walk(form,step)];}
function leaves(form,leaf,inplace){var leafWalk=inplace?walkInplace:walk;function leafStep(form){if(isLeaf(form)){return[leaf(form)];}
return identityStep(leafStep,leafWalk,form);}
return leafStep(form)[0];}
function clone(form){function cloneStep(form){return identityStep(cloneStep,walk,form);}
return cloneStep(form)[0];}
function flatten(form){var inplace=true;var result=[];leaves(form,function(leaf){result.push(leaf);return leaf;},inplace);return result;}
return{prewalk:prewalk,postwalk:postwalk,preprune:preprune,postprune:postprune,prewalkDom:prewalkDom,postwalkDom:postwalkDom,prepruneDom:prepruneDom,postpruneDom:postpruneDom,isLeaf:isLeaf,leaves:leaves,clone:clone,flatten:flatten,walk:walk,walkInplace:walkInplace,walkDomInplace:walkDomInplace};});define('util/maps',[],function(){function isEmpty(obj){var name;for(name in obj){if(obj.hasOwnProperty(name)){return false;}}
return true;}
function fillKeys(map,keys,value){var i=keys.length;while(i--){map[keys[i]]=value;}
return map;}
function fillTuples(map,tuples){var i=tuples.length,tuple;while(i--){tuple=tuples[i];map[tuple[0]]=tuple[1];}
return map;}
function keys(map){var ks=[],k;for(k in map){if(map.hasOwnProperty(k)){ks.push(k);}}
return ks;}
return{isEmpty:isEmpty,fillTuples:fillTuples,fillKeys:fillKeys,keys:keys};});define('util/browser',['jquery'],function($){return{ie7:$.browser.msie&&parseInt($.browser.version,10)<8};});define('util/dom2',['jquery','util/maps','util/strings','util/browser'],function($,Maps,Strings,Browser){var spacesRx=/\s+/;var attrRegex=/\s([^<\s=]+)(?:=(?:"[^"]*"|'[^']*'|[^\s]+))?/g;function moveNextAll(parent,firstChild,refChild){while(firstChild){var nextChild=firstChild.nextSibling;parent.insertBefore(firstChild,refChild);firstChild=nextChild;}}
function attrNames(elem){var names=[];var html=elem.cloneNode(false).outerHTML;var match;while(null!=(match=attrRegex.exec(html))){names.push(match[1]);}
return names;}
function attrs(elem){var as=[];var names=attrNames(elem);var i;var len;for(i=0,len=names.length;i<len;i++){var name=names[i];var value=$.attr(elem,name);if(null==value){value="";}else{value=value.toString();}
as.push([name,value]);}
return as;}
function indexByClassHaveList(elems,classMap){var index={},indexed,classes,elem,cls,len,i,j;for(i=0,len=elems.length;i<len;i++){elem=elems[i];if(elem.className){classes=Strings.words(elem.className);for(j=0;j<classes.length;j++){cls=classes[j];if(classMap[cls]){indexed=index[cls];if(indexed){indexed.push(elem);}else{index[cls]=[elem];}}}}}
return index;}
function indexByClass(root,classMap){var elems;if(Browser.ie7){elems=root.getElementsByTagName('*');}else{elems=$(root).find('.'+Maps.keys(classMap).join(',.'));}
return indexByClassHaveList(elems,classMap);}
function indexByName(root,names){var i,index={},len;for(i=0,len=names.length;i<len;i++){var name=names[i];index[name]=$.makeArray(root.getElementsByTagName(name));}
return index;}
return{moveNextAll:moveNextAll,attrNames:attrNames,attrs:attrs,indexByClass:indexByClass,indexByName:indexByName,indexByClassHaveList:indexByClassHaveList};});define('util/functions',[],function(){function identity(arg){return arg;}
return{identity:identity};});define('util/misc',[],function(){function anyRx(rxs,str){var i,len;for(i=0,len=rxs.length;i<len;i++){if(rxs[i].test(str)){return true;}}
return false;}
return{anyRx:anyRx};});define('aloha/ephemera',['jquery','aloha/core','aloha/console','util/strings','util/trees','util/arrays','util/maps','util/dom2','util/functions','util/misc','PubSub'],function($,Aloha,console,Strings,Trees,Arrays,Maps,Dom,Functions,Misc,PubSub){var ephemeraMap={classMap:{'aloha-cleanme':true,'aloha-ui-wrapper':true,'aloha-ui-filler':true,'aloha-ui-attr':true},attrMap:{'hidefocus':true,'hideFocus':true,'tabindex':true,'tabIndex':true,'TABLE.contenteditable':true,'TABLE.contentEditable':true},attrRxs:[/^(?:nodeIndex|sizcache|sizset|jquery)[\w\d]*$/i],pruneFns:[]};var commonClsSubstr='aloha-';function checkCommonSubstr(clss){var i,len;for(i=0,len=clss.length;i<len;i++){if(-1===clss[i].indexOf(commonClsSubstr)){console.warn('Class "'+clss[i]+'" was set to be ephemeral,'+'which hurts peformance.'+' Add the common substring "'+commonClsSubstr+'" to the class to fix this problem.');commonClsSubstr='';}}}
function classes(){var clss=Array.prototype.slice.call(arguments);Maps.fillKeys(ephemeraMap.classMap,clss,true);checkCommonSubstr(clss);PubSub.pub('aloha.ephemera.classes',{ephemera:ephemeraMap,newClasses:clss});}
function attributes(){var attrs=Array.prototype.slice.call(arguments);Maps.fillKeys(ephemeraMap.attrMap,attrs,true);PubSub.pub('aloha.ephemera.attributes',{ephemera:ephemeraMap,newAttributes:attrs});}
function ephemera(emap){if(emap){if(emap.classMap){$.extend(ephemeraMap.classMap,emap.classMap);}
if(emap.attrMap){$.extend(ephemeraMap.attrMap,emap.attrMap);}
if(emap.attrRxs){ephemeraMap.attrRxs=ephemeraMap.attrRxs.concat(emap.attrRxs);}
if(emap.pruneFns){ephemeraMap.pruneFns=ephemeraMap.pruneFns.concat(emap.pruneFns);}
PubSub.pub('aloha.ephemera',{ephemera:ephemeraMap,newEphemera:emap});}
return ephemeraMap;}
function markElement(elem){$(elem).addClass('aloha-cleanme');}
function markAttribute(elem,attr){elem=$(elem);var data=elem.attr('data-aloha-ui-attr');data=(null==data||''===data?attr:data+' '+attr);elem.attr('data-aloha-ui-attr',data);elem.addClass('aloha-ui-attr');}
function markWrapper(elem){$(elem).addClass('aloha-ui-wrapper');}
function markFiller(elem){$(elem).addClass('aloha-ui-filler');}
function pruneMarkedAttrs(elem){var $elem=$(elem);var data=$elem.attr('data-aloha-ui-attr');var i;var attrs;$elem.removeAttr('data-aloha-ui-attr');if(typeof data==='string'){attrs=Strings.words(data);for(i=0;i<attrs.length;i++){$elem.removeAttr(attrs[i]);}}}
function isAttrEphemeral(elem,attrName,attrMap,attrRxs){return attrMap[attrName]||Misc.anyRx(attrRxs,attrName)||attrMap[elem.nodeName+'.'+attrName];}
function pruneEmapAttrs(elem,emap){var $elem=null,attrs=Dom.attrNames(elem),name,i,len;for(i=0,len=attrs.length;i<len;i++){name=attrs[i];if(isAttrEphemeral(elem,name,emap.attrMap,emap.attrRxs)){$elem=$elem||$(elem);$elem.removeAttr(name);}}}
function pruneElem(elem,emap){var className=elem.className;if(className&&-1!==className.indexOf(commonClsSubstr)){var classes=Strings.words(className);if(-1!==Arrays.indexOf(classes,'aloha-cleanme')){$.removeData(elem);return false;}
if(-1!==Arrays.indexOf(classes,'aloha-ui-wrapper')||-1!==Arrays.indexOf(classes,'aloha-ui-filler')){Dom.moveNextAll(elem.parentNode,elem.firstChild,elem.nextSibling);$.removeData(elem);return false;}
if(-1!==Arrays.indexOf(classes,'aloha-ui-attr')){pruneMarkedAttrs(elem);}
var persistentClasses=Arrays.filter(classes,function(cls){return!emap.classMap[cls];});if(persistentClasses.length!==classes.length){if(0===persistentClasses.length){$(elem).removeAttr('class');}else{elem.className=persistentClasses.join(' ');}}}
pruneEmapAttrs(elem,emap);return true;}
function pruneStep(emap,step,node){if(1===node.nodeType){if(!pruneElem(node,emap)){return[];}
node=Trees.walkDomInplace(node,step);}
node=Arrays.reduce(emap.pruneFns,node,Arrays.applyNotNull);if(!node){return[];}
return[node];}
function prune(elem,emap){emap=emap||ephemeraMap;function pruneStepClosure(node){return pruneStep(emap,pruneStepClosure,node);}
return pruneStepClosure(elem)[0];}
if(Aloha.settings.ephemera){ephemera(Aloha.settings.ephemera);}
return{ephemera:ephemera,classes:classes,attributes:attributes,markElement:markElement,markAttribute:markAttribute,markWrapper:markWrapper,markFiller:markFiller,prune:prune,isAttrEphemeral:isAttrEphemeral};});define('aloha/editable',['aloha/core','util/class','jquery','aloha/pluginmanager','aloha/selection','aloha/markup','aloha/contenthandlermanager','aloha/console','aloha/block-jump','aloha/ephemera','util/dom2'],function(Aloha,Class,jQuery,PluginManager,Selection,Markup,ContentHandlerManager,console,BlockJump,Ephemera,Dom){var unescape=window.unescape,GENTICS=window.GENTICS,ignoreNextActivateEvent=false;var editableContentCache={};Aloha.defaults.contentHandler={};Aloha.defaults.contentHandler.initEditable=['blockelement','sanitize'];Aloha.defaults.contentHandler.getContents=['blockelement','sanitize','basic'];if(typeof Aloha.settings.contentHandler==='undefined'){Aloha.settings.contentHandler={};}
var defaultContentSerializer=function(editableElement){return jQuery(editableElement).html();};var contentSerializer=defaultContentSerializer;Aloha.Editable=Class.extend({_constructor:function(obj){if(!obj.attr('id')){obj.attr('id',GENTICS.Utils.guid());}
this.obj=obj;this.originalObj=obj;this.ready=false;this.sccDelimiters=[':',';','.','!','?',',',unescape('%u0009'),unescape('%u0020'),unescape('%u0008'),unescape('%u007F'),'Enter'];this.sccIdle=5000;this.sccDelay=500;this.sccTimerIdle=false;this.sccTimerDelay=false;this.keyCodeMap={93:'Apps',18:'Alt',20:'CapsLock',17:'Control',40:'Down',35:'End',13:'Enter',112:'F1',113:'F2',114:'F3',115:'F4',116:'F5',117:'F6',118:'F7',119:'F8',120:'F9',121:'F10',122:'F11',123:'F12',36:'Home',45:'Insert',37:'Left',224:'Meta',34:'PageDown',33:'PageUp',19:'Pause',44:'PrintScreen',39:'Right',145:'Scroll',16:'Shift',38:'Up',91:'Win',92:'Win'};this.placeholderClass='aloha-placeholder';Aloha.registerEditable(this);},init:function(){var me=this;this.settings=Aloha.settings;if(Aloha.settings&&Aloha.settings.smartContentChange){if(Aloha.settings.smartContentChange.delimiters){this.sccDelimiters=Aloha.settings.smartContentChange.delimiters;}
if(Aloha.settings.smartContentChange.idle){this.sccIdle=Aloha.settings.smartContentChange.idle;}
if(Aloha.settings.smartContentChange.delay){this.sccDelay=Aloha.settings.smartContentChange.delay;}}
if(!this.check(this.obj)){this.destroy();return;}
if(typeof Aloha.settings.contentHandler.getContents==='undefined'){Aloha.settings.contentHandler.getContents=Aloha.defaults.contentHandler.getContents;}
if(typeof Aloha.settings.contentHandler.initEditable==='undefined'){Aloha.settings.contentHandler.initEditable=Aloha.defaults.contentHandler.initEditable;}
var content=me.obj.html();content=ContentHandlerManager.handleContent(content,{contenthandler:Aloha.settings.contentHandler.initEditable,command:'initEditable'});me.obj.html(content);Aloha.bind('aloha-ready',function(){me.obj.addClass('aloha-editable').contentEditable(true);me.obj.mousedown(function(e){if(!Aloha.eventHandled){Aloha.eventHandled=true;return me.activate(e);}});me.obj.mouseup(function(e){Aloha.eventHandled=false;});me.obj.focus(function(e){return me.activate(e);});me.obj.add('.aloha-block',me.obj).keydown(function(event){var letEventPass=Markup.preProcessKeyStrokes(event);me.keyCode=event.which;if(!letEventPass){me.smartContentChange(event);}
return letEventPass;});me.obj.keypress(function(event){Aloha.activeEditable.smartContentChange(event);});me.obj.keyup(function(event){if(event.keyCode===27){Aloha.deactivateEditable();return false;}});me.obj.contentEditableSelectionChange(function(event){Selection.onChange(me.obj,event);return me.obj;});me.setUnmodified();me.snapshotContent=me.getContents();if(jQuery.browser.mozilla){me.initEmptyEditable();}
me.initPlaceholder();me.ready=true;window.setTimeout(function(){Aloha.disableObjectResizing();},20);Aloha.trigger('aloha-editable-created',[me]);});},isActive:false,originalContent:null,range:undefined,check:function(){var me=this,obj=this.obj,el=obj.get(0),nodeName=el.nodeName.toLowerCase(),textElements=['a','abbr','address','article','aside','b','bdo','blockquote','cite','code','command','del','details','dfn','div','dl','em','footer','h1','h2','h3','h4','h5','h6','header','i','ins','menu','nav','p','pre','q','ruby','section','small','span','strong','sub','sup','var'],i,div;for(i=0;i<textElements.length;++i){if(nodeName===textElements[i]){return true;}}
switch(nodeName){case'label':case'button':break;case'textarea':case'input':div=jQuery('<div id="'+this.getId()+'-aloha" class="aloha-'+nodeName+'" />').insertAfter(obj);div.height(obj.height()).width(obj.width()).html(obj.val());obj.hide();obj.parents('form:first').submit(function(){obj.val(me.getContents());});this.obj=div;return true;default:break;}
return false;},initPlaceholder:function(){if(Aloha.settings.placeholder&&this.isEmpty()){this.addPlaceholder();}},isEmpty:function(){var editableTrimedContent=jQuery.trim(this.getContents()),onlyBrTag=(editableTrimedContent==='<br>')?true:false;return(editableTrimedContent.length===0||onlyBrTag);},initEmptyEditable:function(){var obj=this.obj;if(this.empty(this.getContents())){jQuery(obj).prepend('<br class="aloha-cleanme" />');}},addPlaceholder:function(){var div=jQuery('<div>'),span=jQuery('<span>'),el,obj=this.obj;if(GENTICS.Utils.Dom.allowsNesting(obj[0],div[0])){el=div;}else{el=span;}
if(jQuery("."+this.placeholderClass,obj).length!==0){return;}
jQuery(obj).append(el.addClass(this.placeholderClass));jQuery.each(Aloha.settings.placeholder,function(selector,selectorConfig){if(obj.is(selector)){el.html(selectorConfig);}});jQuery('br',obj).remove();},removePlaceholder:function(obj,setCursor){var placeholderClass=this.placeholderClass,range;if(jQuery("."+this.placeholderClass,obj).length===0){return;}
if(setCursor===true){window.setTimeout(function(){range=new Selection.SelectionRange();range.startContainer=range.endContainer=obj.get(0);range.startOffset=range.endOffset=0;jQuery('.'+placeholderClass,obj).remove();range.select();},100);}else{jQuery('.'+placeholderClass,obj).remove();}},destroy:function(){if(this===Aloha.getActiveEditable()){this.blur();}
switch(this.originalObj.get(0).nodeName.toLowerCase()){case'label':case'button':break;case'textarea':case'input':this.originalObj.val(this.getContents());this.obj.remove();this.originalObj.show();break;default:break;}
this.ready=false;this.removePlaceholder(this.obj);this.obj.removeClass('aloha-editable').contentEditable(false).unbind('mousedown click dblclick focus keydown keypress keyup');Aloha.trigger('aloha-editable-destroyed',[this]);Aloha.unregisterEditable(this);},setUnmodified:function(){this.originalContent=this.getContents();},isModified:function(){return this.originalContent!==this.getContents();},toString:function(){return'Aloha.Editable';},isDisabled:function(){return!this.obj.contentEditable()||this.obj.contentEditable()==='false';},disable:function(){return this.isDisabled()||this.obj.contentEditable(false);},enable:function(){return this.isDisabled()&&this.obj.contentEditable(true);},activate:function(e){var oldActive=Aloha.getActiveEditable();if(ignoreNextActivateEvent){ignoreNextActivateEvent=false;return;}
if(e&&e.type==='focus'&&oldActive!==null&&oldActive.obj.parent().get(0)===e.currentTarget){return;}
if(this.isActive||this.isDisabled()){return;}
this.obj.addClass('aloha-editable-active');Aloha.activateEditable(this);ignoreNextActivateEvent=true;this.removePlaceholder(this.obj,true);ignoreNextActivateEvent=false;this.isActive=true;Aloha.trigger('aloha-editable-activated',{'oldActive':oldActive,'editable':this});},blur:function(){this.obj.blur();this.isActive=false;this.initPlaceholder();this.obj.removeClass('aloha-editable-active');Aloha.trigger('aloha-editable-deactivated',{editable:this});Aloha.activeEditable.smartContentChange({type:'blur'},null);},empty:function(str){return(null===str)||(jQuery.trim(str)===''||str==='<br/>');},getContents:function(asObject){var raw=this.obj.html();var cache=editableContentCache[this.getId()];if(!cache||raw!==cache.raw){BlockJump.removeZeroWidthTextNodeFix();var $clone=this.obj.clone(false);this.removePlaceholder($clone);$clone=jQuery(Ephemera.prune($clone[0]));PluginManager.makeClean($clone);$clone=jQuery('<div>'+ContentHandlerManager.handleContent($clone.html(),{contenthandler:Aloha.settings.contentHandler.getContents,command:'getContents'})+'</div>');cache=editableContentCache[this.getId()]={};cache.raw=raw;cache.element=$clone;}
if(asObject){return cache.element.clone().contents();}
if(null==cache.serialized){cache.serialized=contentSerializer(cache.element[0]);}
return cache.serialized;},setContents:function(content,asObject){var reactivate=null;if(Aloha.getActiveEditable()===this){Aloha.deactivateEditable();reactivate=this;}
this.obj.html(content);if(null!==reactivate){reactivate.activate();}
this.smartContentChange({type:'set-contents'});return asObject?this.obj.contents():contentSerializer(this.obj[0]);},getId:function(){return this.obj.attr('id');},smartContentChange:function(event){var me=this,uniChar=null,re,match;if(event&&(event.metaKey||event.crtlKey||event.altKey)){return false;}
if(event&&event.originalEvent){re=new RegExp("U\\+(\\w{4})");match=re.exec(event.originalEvent.keyIdentifier);uniChar=(this.keyCodeMap[this.keyCode]||String.fromCharCode(event.which)||'unknown');}
var snapshot=null;function getSnapshotContent(){if(null==snapshot){snapshot=me.getSnapshotContent();}
return snapshot;}
if(jQuery.inArray(uniChar,this.sccDelimiters)>=0){clearTimeout(this.sccTimerIdle);clearTimeout(this.sccTimerDelay);this.sccTimerDelay=window.setTimeout(function(){Aloha.trigger('aloha-smart-content-changed',{'editable':me,'keyIdentifier':event.originalEvent.keyIdentifier,'keyCode':event.keyCode,'char':uniChar,'triggerType':'keypress','getSnapshotContent':getSnapshotContent});console.debug('Aloha.Editable','smartContentChanged: event type keypress triggered');},this.sccDelay);}else if(event&&event.type==='paste'){Aloha.trigger('aloha-smart-content-changed',{'editable':me,'keyIdentifier':null,'keyCode':null,'char':null,'triggerType':'paste','getSnapshotContent':getSnapshotContent});}else if(event&&event.type==='blur'){Aloha.trigger('aloha-smart-content-changed',{'editable':me,'keyIdentifier':null,'keyCode':null,'char':null,'triggerType':'blur','getSnapshotContent':getSnapshotContent});}else if(event&&event.type==='block-change'){Aloha.trigger('aloha-smart-content-changed',{'editable':me,'keyIdentifier':null,'keyCode':null,'char':null,'triggerType':'block-change','getSnapshotContent':getSnapshotContent});}else if(uniChar!==null){clearTimeout(this.sccTimerDelay);clearTimeout(this.sccTimerIdle);this.sccTimerIdle=window.setTimeout(function(){Aloha.trigger('aloha-smart-content-changed',{'editable':me,'keyIdentifier':null,'keyCode':null,'char':null,'triggerType':'idle','getSnapshotContent':getSnapshotContent});},this.sccIdle);}},getSnapshotContent:function(){var ret=this.snapshotContent;this.snapshotContent=this.getContents();return ret;}});Aloha.Editable.setContentSerializer=function(serializerFunction){contentSerializer=serializerFunction;};Aloha.Editable.getContentSerializer=function(){return contentSerializer;};});define('aloha/plugin',['aloha/core','jquery','util/class','aloha/pluginmanager','aloha/console'],function(Aloha,jQuery,Class,PluginManager,console){var Plugin=Class.extend({name:null,defaults:{},settings:{},dependencies:[],_constructor:function(name){if(typeof name!=="string"){console.error('Cannot initialise unnamed plugin, skipping');}else{this.name=name;}},checkDependencies:function(){var dependenciesSatisfied=true,that=this;jQuery.each(this.dependencies,function(){if(!Aloha.isPluginLoaded(this)){dependenciesSatisfied=false;console.error('plugin.'+that.name,'Required plugin "'+this+'" not found.');}});return dependenciesSatisfied;},init:function(){},getEditableConfig:function(obj){var configObj=null,configSpecified=false,that=this;if(this.settings.editables){jQuery.each(this.settings.editables,function(selector,selectorConfig){var k;if(obj.is(selector)){configSpecified=true;if(selectorConfig instanceof Array){configObj=[];configObj=jQuery.merge(configObj,selectorConfig);}else if(typeof selectorConfig==="object"){configObj={};configObj['aloha-editable-selector']=selector;for(k in selectorConfig){if(selectorConfig.hasOwnProperty(k)){if(selectorConfig[k]instanceof Array){configObj[k]=selectorConfig[k];}else if(typeof selectorConfig[k]==="object"){configObj[k]={};configObj[k]=jQuery.extend(true,configObj[k],that.config[k],selectorConfig[k]);}else{configObj[k]=selectorConfig[k];}}}}else{configObj=selectorConfig;}}});}
if(!configSpecified){if(typeof this.settings.config==='undefined'||!this.settings.config){configObj=this.config;}else{configObj=this.settings.config;}}
return configObj;},makeClean:function(obj){},getUID:function(id){console.deprecated('plugin','getUID() is deprecated. Use plugin.name instead.');return this.name;},toString:function(){return this.name;},log:function(level,message){console.deprecated('plugin','log() is deprecated. Use Aloha.console instead.');console.log(level,this,message);}});Plugin.create=function(pluginName,definition){var pluginInstance=new(Plugin.extend(definition))(pluginName);pluginInstance.settings=jQuery.extendObjects(true,pluginInstance.defaults,Aloha.settings[pluginName]);PluginManager.register(pluginInstance);return pluginInstance;};return Plugin;});define('aloha/command',['aloha/core','aloha/registry','aloha/engine','util/dom','aloha/contenthandlermanager'],function(Aloha,Registry,Engine,Dom,ContentHandlerManager){var CommandManager={execCommand:function(commandId,showUi,value,range){var evtObj={commandId:commandId,preventDefault:false};Aloha.trigger('aloha-command-will-execute',evtObj);if(evtObj.preventDefault===true){return;}
if(!range){if(!Aloha.getSelection().getRangeCount()){return;}
range=Aloha.getSelection().getRangeAt(0);}
if(commandId.toLowerCase()==='inserthtml'){value=ContentHandlerManager.handleContent(value,{contenthandler:Aloha.settings.contentHandler.insertHtml,command:'insertHtml'});}
Engine.execCommand(commandId,showUi,value,range);if(Aloha.getSelection().getRangeCount()){range=Aloha.getSelection().getRangeAt(0);var startnode=range.commonAncestorContainer;if(startnode.parentNode){startnode=startnode.parentNode;}
var rangeObject=new window.GENTICS.Utils.RangeObject();rangeObject.startContainer=range.startContainer;rangeObject.startOffset=range.startOffset;rangeObject.endContainer=range.endContainer;rangeObject.endOffset=range.endOffset;Dom.doCleanup({merge:true,removeempty:false},rangeObject,startnode);rangeObject.select();}
Aloha.trigger('aloha-command-executed',commandId);},queryCommandEnabled:function(commandId,range){if(!range){if(!Aloha.getSelection().getRangeCount()){return;}
range=Aloha.getSelection().getRangeAt(0);}
return Engine.queryCommandEnabled(commandId,range);},queryCommandIndeterm:function(commandId,range){if(!range){if(!Aloha.getSelection().getRangeCount()){return;}
range=Aloha.getSelection().getRangeAt(0);}
return Engine.queryCommandIndeterm(commandId,range);},queryCommandState:function(commandId,range){if(!range){if(!Aloha.getSelection().getRangeCount()){return;}
range=Aloha.getSelection().getRangeAt(0);}
return Engine.queryCommandState(commandId,range);},queryCommandSupported:function(commandId){return Engine.queryCommandSupported(commandId);},queryCommandValue:function(commandId,range){if(!range){if(!Aloha.getSelection().getRangeCount()){return;}
range=Aloha.getSelection().getRangeAt(0);}
return Engine.queryCommandValue(commandId,range);},querySupportedCommands:function(){var commands=[],command;for(command in Engine.commands){if(Engine.commands.hasOwnProperty(command)){commands.push(command);}}
return commands;}};CommandManager=new(Registry.extend(CommandManager))();Aloha.execCommand=CommandManager.execCommand;Aloha.queryCommandEnabled=CommandManager.queryCommandEnabled;Aloha.queryCommandIndeterm=CommandManager.queryCommandIndeterm;Aloha.queryCommandState=CommandManager.queryCommandState;Aloha.queryCommandSupported=CommandManager.queryCommandSupported;Aloha.queryCommandValue=CommandManager.queryCommandValue;Aloha.querySupportedCommands=CommandManager.querySupportedCommands;return CommandManager;});define('aloha/jquery.aloha',['aloha/core','aloha/selection','jquery','aloha/console'],function(Aloha,Selection,jQuery,console){var XMLSerializer=window.XMLSerializer;jQuery.fn.between=function(content,offset){var offSize,fullText;if(this[0].nodeType!==3){offSize=this.children().size();if(offset>offSize){offset=offSize;}
if(offset<=0){this.prepend(content);}else{this.children().eq(offset-1).after(content);}}else{if(offset<=0){this.before(content);}else if(offset>=this[0].length){this.after(content);}else{fullText=this[0].data;this[0].data=fullText.substring(0,offset);this.after(fullText.substring(offset,fullText.length));this.after(content);}}};jQuery.fn.contentEditable=function(b){var $el=jQuery(this);var ce='contenteditable';if(jQuery.browser.msie&&parseInt(jQuery.browser.version,10)==7){ce='contentEditable';}
if(typeof b==='undefined'){if(typeof $el[0]==='undefined'){console.warn('The jquery object did not contain any valid elements.');return undefined;}
if(typeof $el[0].isContentEditable==='undefined'){console.warn('Could not determine whether the is editable or not. I assume it is.');return true;}
return $el[0].isContentEditable;}
if(b===''){$el.removeAttr(ce);}else{if(b&&b!=='false'){b='true';}else{b='false';}
$el.attr(ce,b);}
return $el;};jQuery.fn.aloha=function(){var $this=jQuery(this);Aloha.bind('aloha-ready',function(){$this.each(function(){if(!Aloha.isEditable(this)){new Aloha.Editable(jQuery(this)).init();}});});return $this;};jQuery.fn.mahalo=function(){return this.each(function(){if(Aloha.isEditable(this)){Aloha.getEditableById(jQuery(this).attr('id')).destroy();}});};jQuery.fn.contentEditableSelectionChange=function(callback){var that=this;this.keyup(function(event){var rangeObject=Selection.getRangeObject();callback(event);});this.dblclick(function(event){callback(event);});this.mousedown(function(event){that.selectionStarted=true;});jQuery(document).mouseup(function(event){Selection.eventOriginalTarget=that;if(that.selectionStarted){callback(event);}
Selection.eventOriginalTarget=false;that.selectionStarted=false;});return this;};jQuery.fn.outerHtml=jQuery.fn.outerHtml||function(){var $el=jQuery(this),el=$el.get(0);if(typeof el.outerHTML!='undefined'){return el.outerHTML;}
try{return(new XMLSerializer()).serializeToString(el);}catch(e){try{return el.xml;}catch(e2){}}};jQuery.fn.zap=function(){return this.each(function(){jQuery(this.childNodes).insertBefore(this);}).remove();};jQuery.fn.textNodes=function(excludeBreaks,includeEmptyTextNodes){var ret=[],doSomething=function(el){var i,childLength;if((el.nodeType===3&&jQuery.trim(el.data)&&!includeEmptyTextNodes)||(el.nodeType===3&&includeEmptyTextNodes)||(el.nodeName=="BR"&&!excludeBreaks)){ret.push(el);}else{for(i=0,childLength=el.childNodes.length;i<childLength;++i){doSomething(el.childNodes[i]);}}};doSomething(this[0]);return jQuery(ret);};jQuery.extendObjects=jQuery.fn.extendObjects=function(arg1,arg2){var options,name,src,copy,copyIsArray,clone,start=1,target=arg1||{},length=arguments.length,deep=false,i;if(typeof target==="boolean"){deep=target;target=arg2||{};start=2;}
if(typeof target!=="object"&&!jQuery.isFunction(target)){target={};}
if(length===start){target=this;--start;}
for(i=start;i<length;i++){if((options=arguments[i])!=null){for(name in options){if(options.hasOwnProperty(name)){src=target[name];copy=options[name];if(target===copy){continue;}
if(deep&&copy&&(jQuery.isPlainObject(copy)||true===(copyIsArray=jQuery.isArray(copy)))){if(copyIsArray){copyIsArray=false;clone=src&&jQuery.isArray(src)?src:[];}else{clone=src&&jQuery.isPlainObject(src)?src:{};}
if(jQuery.isArray(copy)){target[name]=copy;}else{target[name]=jQuery.extendObjects(deep,clone,copy);}}else if(copy!==undefined){target[name]=copy;}}}}}
return target;};jQuery.hotkeys={version:"0.8",specialKeys:{8:"backspace",9:"tab",13:"return",16:"shift",17:"ctrl",18:"alt",19:"pause",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"del",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9",106:"*",107:"+",109:"-",110:".",111:"/",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"numlock",145:"scroll",191:"/",224:"meta"},shiftNums:{"`":"~","1":"!","2":"@","3":"#","4":"$","5":"%","6":"^","7":"&","8":"*","9":"(","0":")","-":"_","=":"+",";":": ","'":"\"",",":"<",".":">","/":"?","\\":"|"}};function applyKeyHandler(handler,context,args,event){if(context!==event.target&&(/textarea|input|select/i.test(event.target.nodeName)||event.target.type==="text")){return;}
return handler.apply(context,args);}
function keyHandler(handleObj){var origHandler,keys,handle,i;if(typeof handleObj.data!=="string"){return;}
origHandler=handleObj.handler;keys=handleObj.data.toLowerCase().split(" ");handle={};for(i=0;i<keys.length;i++){handle[keys[i]]=true;}
handleObj.handler=function(event){if(this!==event.target){return;}
var special=event.type!=="keypress"&&jQuery.hotkeys.specialKeys[event.which],modif="",character;if(event.altKey&&special!=="alt"){modif+="alt+";}
if(event.ctrlKey&&special!=="ctrl"){modif+="ctrl+";}
if(event.metaKey&&!event.ctrlKey&&special!=="meta"){modif+="meta+";}
if(event.shiftKey&&special!=="shift"){modif+="shift+";}
if(special){if(handle[modif+special]){return applyKeyHandler(origHandler,this,arguments,event);}}else{character=String.fromCharCode(event.which).toLowerCase();if(handle[modif+character]){return applyKeyHandler(origHandler,this,arguments,event);}
if(handle[modif+jQuery.hotkeys.shiftNums[character]]){return applyKeyHandler(origHandler,this,arguments,event);}
if(modif==="shift+"){if(handle[jQuery.hotkeys.shiftNums[character]]){return applyKeyHandler(origHandler,this,arguments,event);}}}};}
jQuery.each(['keydown','keyup','keypress'],function(){jQuery.event.special[this]={add:keyHandler};});});define('aloha/sidebar',['aloha/core','jquery','aloha/selection','PubSub'],function(Aloha,$,Selection,PubSub){var uid=+(new Date());if(!$.easing.easeOutExpo){$.extend($.easing,{easeOutExpo:function(x,t,b,c,d){return(t==d)?b+c:c*(-Math.pow(2,-10*t/d)+1)+b;},easeOutElastic:function(x,t,b,c,d){var m=Math,s=1.70158,p=0,a=c;if(!t){return b;}
if((t/=d)==1){return b+c;}
if(!p){p=d*0.3;}
if(a<m.abs(c)){a=c;s=p/4;}else{s=p/(2*m.PI)*m.asin(c/a);}
return a*m.pow(2,-10*t)*m.sin((t*d-s)*(2*m.PI)/p)+c+b;}});}
var Panel=function Panel(opts){this.id=null;this.folds={};this.button=null;this.title=$('<div class="aloha-sidebar-panel-title">'+'<span class="aloha-sidebar-panel-title-arrow"></span>'+'<span class="aloha-sidebar-panel-title-text">Untitled</span>'+'</div>');this.content=$('<div class="aloha-sidebar-panel-content">'+'<div class="aloha-sidebar-panel-content-inner">'+'<div class="aloha-sidebar-panel-content-inner-text"></div>'+'</div>'+'</div>');this.element=null;this.effectiveElement=null;this.expanded=false;this.isActive=true;this.init(opts);};var Sidebar=function Sidebar(opts){var sidebar=this;this.id='aloha-sidebar-'+(++uid);this.panels={};this.container=$('<div class="aloha-ui aloha-sidebar-bar">'+'<div class="aloha-sidebar-handle">'+'<span class="aloha-sidebar-handle-icon"></span>'+'</div>'+'<div class="aloha-sidebar-inner">'+'<ul class="aloha-sidebar-panels"></ul>'+'</div>'+'</div>');this.width=300;this.opened=false;this.isOpen=false;this.isCompletelyOpen=false;this.settings={rotateIcons:!$.browser.msie,overlayPage:true};$(function(){if(!((typeof Aloha.settings.sidebar!=='undefined')&&Aloha.settings.sidebar.disabled)){sidebar.init(opts);}});};var previousViewportHeight=null;var previousActivePanelIds=null;$.extend(Sidebar.prototype,{init:function(opts){var that=this;var panels;if(typeof opts==='object'){panels=opts.panels;delete opts.panels;}
$.extend(this,opts);if(typeof panels==='object'){$.each(panels,function(){that.addPanel(this,true);});}
var bar=this.container;if(this.position==='right'){bar.addClass('aloha-sidebar-right');}
bar.hide().appendTo($('body')).click(function(){that.barClicked.apply(that,arguments);}).find('.aloha-sidebar-panels').width(this.width);bar.width(this.width);this.width=bar.width();this.updateHeight();this.initToggler();this.container.css(this.position==='right'?'marginRight':'marginLeft',-this.width);if(this.opened){this.open(0);}
this.toggleHandleIcon(this.isOpen);this.subscribeToEvents();$(window).resize(function(){that.updateHeight();that.correctHeight();});this.correctHeight();},show:function(){this.container.css('display','block');return this;},hide:function(){this.container.css('display','none');return this;},checkActivePanels:function(range){var effective=[];if(typeof range!=='undefined'&&typeof range.markupEffectiveAtStart!=='undefined'){var l=range.markupEffectiveAtStart.length;var i;for(i=0;i<l;++i){effective.push($(range.markupEffectiveAtStart[i]));}}
var that=this;$.each(this.panels,function(){that.showActivePanel(this,effective);});this.correctHeight();},subscribeToEvents:function(){var that=this;PubSub.sub('aloha.selection.context-change',function(message){if(that.isOpen){that.checkActivePanels(message.range);}
that.lastRange=message.range;});Aloha.bind('aloha-editable-deactivated',function(event,params){if(that.isOpen){that.checkActivePanels();}
that.lastRange=null;});this.container.mousedown(function(e){e.originalEvent.stopSelectionUpdate=true;Aloha.eventHandled=true;});this.container.mouseup(function(e){e.originalEvent.stopSelectionUpdate=true;Aloha.eventHandled=false;});},correctHeight:function(){if(!this.isOpen){return;}
if(!this.isCompletelyOpen){this.correctHeightWhenCompletelyOpen=true;return;}
var viewportHeight=$(window).height();var activePanelIds=[];var panels=[];var panelId;for(panelId in this.panels){if(this.panels.hasOwnProperty(panelId)){if(this.panels[panelId].isActive){panels.push(this.panels[panelId]);activePanelIds.push(panelId);}}}
if(0===panels.length){return;}
activePanelIds=activePanelIds.sort().join(',');if(previousActivePanelIds===activePanelIds&&previousViewportHeight===viewportHeight){return;}
previousViewportHeight=viewportHeight;previousActivePanelIds=activePanelIds;var height=this.container.find('.aloha-sidebar-inner').height();var remainingHeight=height-((panels[0].title.outerHeight()+10)*panels.length);var panel;var targetHeight;var panelInner;var panelText;var undone;var toadd=0;var math=Math;var j;while(panels.length>0&&remainingHeight>0){remainingHeight+=toadd;toadd=0;undone=[];for(j=panels.length-1;j>=0;--j){panel=panels[j];panelInner=panel.content.find('.aloha-sidebar-panel-content-inner');targetHeight=math.min(panelInner.height('auto').height(),math.floor(remainingHeight/(j+1)));panelInner.height(targetHeight);remainingHeight-=targetHeight;panelText=panelInner.find('.aloha-sidebar-panel-content-inner-text');if(panelText.height()>targetHeight){undone.push(panel);toadd+=targetHeight;panelInner.css({'overflow-x':'hidden','overflow-y':'scroll'});}else{panelInner.css('overflow-y','hidden');}
if(panel.expanded){panel.expand();}}
panels=undone;}},showActivePanel:function(panel,elements){elements.push(null);var li=panel.content.parent('li');var activeOn=panel.activeOn;var effective=$();var count=0;var j=elements.length;var i;for(i=0;i<j;++i){if(activeOn(elements[i])){++count;if(elements[i]){$.merge(effective,elements[i]);}}}
if(count){panel.activate(effective);}else{panel.deactivate();}},initToggler:function(){var that=this;var bar=this.container;var icon=bar.find('.aloha-sidebar-handle-icon');var toggledClass='aloha-sidebar-toggled';var bounceTimer;var isRight=(this.position==='right');if(this.opened){this.rotateHandleArrow(isRight?0:180,0);}
$(function(){if(typeof Aloha.settings.sidebar!=='undefined'&&Aloha.settings.sidebar.handle&&Aloha.settings.sidebar.handle.top){$(bar.find('.aloha-sidebar-handle'))[0].style.top=Aloha.settings.sidebar.handle.top;}});bar.find('.aloha-sidebar-handle').click(function(){if(bounceTimer){clearInterval(bounceTimer);}
icon.stop().css('marginLeft',4);if(that.isOpen){$(this).removeClass(toggledClass);that.close();that.isOpen=false;}else{$(this).addClass(toggledClass);that.open();that.isOpen=true;}}).hover(function(){var flag=that.isOpen?-1:1;if(bounceTimer){clearInterval(bounceTimer);}
icon.stop();$(this).stop().animate(isRight?{marginLeft:'-='+(flag*5)}:{marginRight:'-='+(flag*5)},200);bounceTimer=setInterval(function(){flag*=-1;icon.animate(isRight?{left:'-='+(flag*4)}:{right:'-='+(flag*4)},300);},300);},function(){if(bounceTimer){clearInterval(bounceTimer);}
icon.stop().css(isRight?'left':'right',5);$(this).stop().animate(isRight?{marginLeft:0}:{marginRight:0},600,'easeOutElastic');});},roundCorners:function(){var bar=this.container;var lis=bar.find('.aloha-sidebar-panels>li:not(.aloha-sidebar-deactivated)');var topClass='aloha-sidebar-panel-top';var bottomClass='aloha-sidebar-panel-bottom';bar.find('.aloha-sidebar-panel-top, .aloha-sidebar-panel-bottom').removeClass(topClass).removeClass(bottomClass);lis.first().find('.aloha-sidebar-panel-title').addClass(topClass);lis.last().find('.aloha-sidebar-panel-content').addClass(bottomClass);},updateHeight:function(){var h=$(window).height();this.container.height(h).find('.aloha-sidebar-inner').height(h);},barClicked:function(ev){this.handleBarclick($(ev.target));},handleBarclick:function(el){if(el.hasClass('aloha-sidebar-panel-title')){this.togglePanel(el);}else if(!el.hasClass('aloha-sidebar-panel-content')&&!el.hasClass('aloha-sidebar-handle')&&!el.hasClass('aloha-sidebar-bar')){this.handleBarclick(el.parent());}},getPanelById:function(id){return this.panels[id];},getPanelByElement:function(el){var li=(el[0].tagName==='LI')?el:el.parent('li');return this.getPanelById(li[0].id);},togglePanel:function(el){this.getPanelByElement(el).toggle();},rotateHandleIcon:function(angle,duration){var arr=this.container.find('.aloha-sidebar-handle-icon');arr.animate({angle:angle},{duration:(typeof duration==='number'||typeof duration==='string')?duration:500,easing:'easeOutExpo',step:function(val,fx){arr.css({'-o-transform':'rotate('+val+'deg)','-webkit-transform':'rotate('+val+'deg)','-moz-transform':'rotate('+val+'deg)','-ms-transform':'rotate('+val+'deg)'});}});},toggleHandleIcon:function(isOpen){var isPointingLeft=(this.position==='right')^isOpen;if(this.settings.rotateIcons){this.rotateHandleIcon(isPointingLeft?180:0,0);}else{var icon=this.container.find('.aloha-sidebar-handle-icon');if(isPointingLeft){icon.addClass('aloha-sidebar-handle-icon-left');}else{icon.removeClass('aloha-sidebar-handle-icon-left');}}},open:function(duration,callback){if(this.isOpen){return this;}
var isRight=(this.position==='right');var anim=isRight?{marginRight:0}:{marginLeft:0};var sidebar=this;this.toggleHandleIcon(true);this.container.animate(anim,(typeof duration==='number'||typeof duration==='string')?duration:500,'easeOutExpo');if(!this.settings.overlayPage){$('body').animate(isRight?{marginRight:'+='+this.width}:{marginLeft:'+='+this.width},500,'easeOutExpo',function(){sidebar.isCompletelyOpen=true;if(sidebar.correctHeightWhenCompletelyOpen){sidebar.correctHeight();}});}
this.isOpen=true;this.correctHeight();if(this.lastRange){this.checkActivePanels(this.lastRange);}
$('body').trigger('aloha-sidebar-opened',this);return this;},close:function(duration,callback){if(!this.isOpen){return this;}
var isRight=(this.position==='right');var anim=isRight?{marginRight:-this.width}:{marginLeft:-this.width};this.toggleHandleIcon(false);this.container.animate(anim,(typeof duration==='number'||typeof duration==='string')?duration:500,'easeOutExpo');if(!this.settings.overlayPage){$('body').animate(isRight?{marginRight:'-='+this.width}:{marginLeft:'-='+this.width},500,'easeOutExpo');}
this.isOpen=false;this.isCompletelyOpen=false;return this;},activatePanel:function(panel,element){if(typeof panel==='string'){panel=this.getPanelById(panel);}
if(panel){panel.activate(element);}
this.roundCorners();return this;},expandPanel:function(panel,callback){if(typeof panel==='string'){panel=this.getPanelById(panel);}
if(panel){panel.expand(callback);}
return this;},collapsePanel:function(panel,callback){if(typeof panel==='string'){panel=this.getPanelById(panel);}
if(panel){panel.collapse(callback);}
return this;},addPanel:function(panel,deferRounding){if(!(panel instanceof Panel)){if(!panel.width){panel.width=this.width;}
panel.sidebar=this;panel=new Panel(panel);}
this.panels[panel.id]=panel;this.container.find('.aloha-sidebar-panels').append(panel.element);this.checkActivePanels(Selection.getRangeObject());return panel;}});$.extend(Panel.prototype,{init:function(opts){this.setTitle(opts.title).setContent(opts.content);delete opts.title;delete opts.content;$.extend(this,opts);if(!this.id){this.id='aloha-sidebar-'+(++uid);}
var li=this.element=$('<li id="'+this.id+'">').append(this.title,this.content);if(this.expanded){this.content.height('auto');}
this.toggleTitleIcon(this.expanded);this.coerceActiveOn();this.title.attr('unselectable','on').css('-moz-user-select','none').each(function(){this.onselectstart=function(){return false;};});if(typeof this.onInit==='function'){this.onInit.apply(this);}},toggleTitleIcon:function(isExpanded){if(this.sidebar.settings.rotateIcons){this.rotateTitleIcon(isExpanded?90:0);}else{var icon=this.title.find('.aloha-sidebar-panel-title-arrow');if(isExpanded){icon.addClass('aloha-sidebar-panel-title-arrow-down');}else{icon.removeClass('aloha-sidebar-panel-title-arrow-down');}}},coerceActiveOn:function(){if(typeof this.activeOn!=='function'){var activeOn=this.activeOn;this.activeOn=(function(){var typeofActiveOn=typeof activeOn,fn;if(typeofActiveOn==='boolean'){fn=function(){return activeOn;};}else if(typeofActiveOn==='undefined'){fn=function(){return true;};}else if(typeofActiveOn==='string'){fn=function(el){return el?el.is(activeOn):false;};}else{fn=function(){return false;};}
return fn;}());}},activate:function(effective){this.isActive=true;this.content.parent('li').show().removeClass('aloha-sidebar-deactivated');this.effectiveElement=effective;if(typeof this.onActivate==='function'){this.onActivate.call(this,effective);}},deactivate:function(){if(!this.isActive){return;}
this.isActive=false;this.content.parent('li').hide().addClass('aloha-sidebar-deactivated');this.effectiveElement=null;},toggle:function(){if(this.expanded){this.collapse();}else{this.expand();}},expand:function(callback){var that=this;var el=this.content;var old_h=el.height();var new_h=el.height('auto').height();el.height(old_h).stop().animate({height:new_h},500,'easeOutExpo',function(){if(typeof callback==='function'){callback.call(that);}});this.element.removeClass('collapsed');this.toggleTitleIcon(true);this.expanded=true;return this;},collapse:function(duration,callback){var that=this;this.element.addClass('collapsed');this.content.stop().animate({height:5},250,'easeOutExpo',function(){if(typeof callback==='function'){callback.call(that);}});this.toggleTitleIcon(false);this.expanded=false;return this;},setTitle:function(html){this.title.find('.aloha-sidebar-panel-title-text').html(html);return this;},setContent:function(html){if(!html||html===''){html='&nbsp;';}
this.content.find('.aloha-sidebar-panel-content-inner-text').html(html);return this;},rotateTitleIcon:function(angle,duration){var arr=this.title.find('.aloha-sidebar-panel-title-arrow');arr.animate({angle:angle},{duration:(typeof duration==='number')?duration:500,easing:'easeOutExpo',step:function(val,fx){arr.css({'-o-transform':'rotate('+val+'deg)','-webkit-transform':'rotate('+val+'deg)','-moz-transform':'rotate('+val+'deg)','-ms-transform':'rotate('+val+'deg)'});}});},renderEffectiveParents:function(effective,renderer){var el=effective.first();var content=[];var path=[];var activeOn=this.activeOn;var l;var pathRev;while(el.length>0&&!el.is('.aloha-editable')){if(activeOn(el)){path.push('<span>'+el[0].tagName.toLowerCase()+'</span>');l=path.length;pathRev=[];while(l--){pathRev.push(path[l]);}
content.push('<div class="aloha-sidebar-panel-parent">'
+'<div class="aloha-sidebar-panel-parent-path">'
+pathRev.join('')
+'</div>'
+'<div class="aloha-sidebar-panel-parent-content'
+'aloha-sidebar-opened">'
+((typeof renderer==='function')?renderer(el):'----')+'</div>'+'</div>');}
el=el.parent();}
this.setContent(content.join(''));$('.aloha-sidebar-panel-parent-path').click(function(){var $content=$(this).parent().find('.aloha-sidebar-panel-parent-content');if($content.hasClass('aloha-sidebar-opened')){$content.hide().removeClass('aloha-sidebar-opened');}else{$content.show().addClass('aloha-sidebar-opened');}});this.content.height('auto').find('.aloha-sidebar-panel-content-inner').height('auto');}});var left=new Sidebar({position:'left',width:250});var right=new Sidebar({position:'right',width:250});Aloha.Sidebar={left:left,right:right};return Aloha.Sidebar;});window.GENTICS=window.GENTICS||{};window.GENTICS.Utils=window.GENTICS.Utils||{};define('util/position',['jquery'],function(jQuery){var $=jQuery,GENTICS=window.GENTICS,Class=window.Class,console=window.console;GENTICS.Utils.Position={};GENTICS.Utils.Position.w=jQuery(window);GENTICS.Utils.Position.Scroll={top:0,left:0,isScrolling:false};GENTICS.Utils.Position.ScrollCorrection={top:100,left:50};GENTICS.Utils.Position.Mouse={x:0,y:0,oldX:0,oldY:0,isMoving:false,triggeredMouseStop:true};GENTICS.Utils.Position.mouseStopCallbacks=[];GENTICS.Utils.Position.mouseMoveCallbacks=[];GENTICS.Utils.Position.update=function(){var st=this.w.scrollTop(),sl=this.w.scrollLeft(),i;if(this.Scroll.isScrolling){if(this.Scroll.top==st&&this.Scroll.left==sl){this.Scroll.isScrolling=false;}}else{if(this.Scroll.top!=st||this.Scroll.left!=sl){this.Scroll.isScrolling=true;}}
this.Scroll.top=st;this.Scroll.left=sl;if(this.Mouse.x==this.Mouse.oldX&&this.Mouse.y==this.Mouse.oldY){this.Mouse.isMoving=false;if(!this.Mouse.triggeredMouseStop){this.Mouse.triggeredMouseStop=true;for(i=0;i<this.mouseStopCallbacks.length;i++){this.mouseStopCallbacks[i].call();}}}else{this.Mouse.isMoving=true;this.Mouse.triggeredMouseStop=false;for(i=0;i<this.mouseMoveCallbacks.length;i++){this.mouseMoveCallbacks[i].call();}}
this.Mouse.oldX=this.Mouse.x;this.Mouse.oldY=this.Mouse.y;};GENTICS.Utils.Position.addMouseStopCallback=function(callback){this.mouseStopCallbacks.push(callback);return(this.mouseStopCallbacks.length-1);};GENTICS.Utils.Position.addMouseMoveCallback=function(callback){this.mouseMoveCallbacks.push(callback);return(this.mouseMoveCallbacks.length-1);};jQuery(function(){window.setInterval(function(){GENTICS.Utils.Position.update();},500);});jQuery('html').mousemove(function(e){GENTICS.Utils.Position.Mouse.x=e.pageX;GENTICS.Utils.Position.Mouse.y=e.pageY;});});define('aloha/repositorymanager',['aloha/core','util/class','jquery','aloha/console'],function(Aloha,Class,jQuery,console){Aloha.RepositoryManager=Class.extend({repositories:[],settings:{},initialized:false,init:function(){var repositories=this.repositories;if(Aloha.settings&&Aloha.settings.repositories){this.settings=Aloha.settings.repositories;}
this.settings.timeout=this.settings.timeout||5000;var count_repositories=repositories.length;var i;for(i=0;i<count_repositories;++i){var repository=repositories[i];this.initRepository(repository);}
this.initialized=true;},register:function(repository){if(!this.getRepository(repository.repositoryId)){this.repositories.push(repository);if(this.initialized){this.initRepository(repository);}}else{console.warn(this,'A repository with name { '+repository.repositoryId+' } already registerd. Ignoring this.');}},initRepository:function(repository){if(!repository.settings){repository.settings={};}
if(this.settings[repository.repositoryId]){jQuery.extend(repository.settings,this.settings[repository.repositoryId]);}
repository.init();},getRepository:function(repositoryId){var repositories=this.repositories,i,j=repositories.length;for(i=0;i<j;++i){if(repositories[i].repositoryId===repositoryId){return repositories[i];}}
return null;},query:function(params,callback){var that=this,repo,allitems=[],allmetainfo={numItems:0,hasMoreItems:false},repositories=[],numOpenCallbacks=0,timer,i,j,processResults=function(items,metainfo){if(numOpenCallbacks===0){return;}
var j=items?items.length:0;if(j){if(!items[0].repositoryId){var repoId=this.repositoryId,i;for(i=0;i<j;++i){items[i].repositoryId=repoId;}}
jQuery.merge(allitems,items);}
if(metainfo&&allmetainfo){if(jQuery.isNumeric(metainfo.numItems)&&jQuery.isNumeric(allmetainfo.numItems)){allmetainfo.numItems+=metainfo.numItems;}else{allmetainfo.numItems=undefined;}
if(typeof metainfo.hasMoreItems==='boolean'&&typeof allmetainfo.hasMoreItems==='boolean'){allmetainfo.hasMoreItems=allmetainfo.hasMoreItems||metainfo.hasMoreItems;}else{allmetainfo.hasMoreItems=undefined;}
if(metainfo.timeout){allmetainfo.timeout=true;}}else{allmetainfo=undefined;}
console.debug(this,"The repository "+this.repositoryId+" returned with "+j+" results.");if(--numOpenCallbacks===0){that.queryCallback(callback,allitems,allmetainfo,timer);}};var timeout=parseInt(params.timeout,10)||this.settings.timeout;timer=window.setTimeout(function(){if(numOpenCallbacks>0){console.warn(this,numOpenCallbacks+" repositories did not return before the configured timeout of "+timeout+"ms.");}
numOpenCallbacks=0;allmetainfo=allmetainfo||{};allmetainfo.timeout=true;that.queryCallback(callback,allitems,allmetainfo,timer);},timeout);if(params.repositoryId){repositories.push(this.getRepository(params.repositoryId));}else{repositories=this.repositories;}
j=repositories.length;var repoQueue=[];for(i=0;i<j;++i){repo=repositories[i];if((!params.repositoryId||repo.repositoryId===params.repositoryId)&&typeof repo.query==='function'){++numOpenCallbacks;repoQueue.push(repo);}}
j=repoQueue.length;function makeApplyRepoToProcessResults(repo){return function(){processResults.apply(repo,arguments);};}
for(i=0;i<j;++i){repo=repoQueue[i];repo.query(params,makeApplyRepoToProcessResults(repo));}
if(numOpenCallbacks===0){this.queryCallback(callback,allitems,allmetainfo,timer);}},queryCallback:function(callback,items,metainfo,timer){if(timer){clearTimeout(timer);timer=undefined;}
var result={items:items,results:items.length};if(metainfo){result.numItems=metainfo.numItems;result.hasMoreItems=metainfo.hasMoreItems;result.timeout=metainfo.timeout;}
callback.call(this,result);},getChildren:function(params,callback){var that=this,repo,allitems=[],repositories=[],numOpenCallbacks=0,timer,i,j,processResults=function(items){if(numOpenCallbacks===0){return;}
if(allitems&&items){jQuery.merge(allitems,items);}
if(--numOpenCallbacks===0){that.getChildrenCallback(callback,allitems,timer);}};if(params.inFolderId==='aloha'){var repoFilter=params.repositoryFilter,hasRepoFilter=(repoFilter&&repoFilter.length);j=this.repositories.length;for(i=0;i<j;++i){repo=this.repositories[i];if(!hasRepoFilter||jQuery.inArray(repo.repositoryId,repoFilter)>-1){repositories.push(new Aloha.RepositoryFolder({id:repo.repositoryId,name:repo.repositoryName,repositoryId:repo.repositoryId,type:'repository',hasMoreItems:true}));}}
that.getChildrenCallback(callback,repositories,null);return;}
repositories=this.repositories;var timeout=parseInt(params.timeout,10)||this.settings.timeout;timer=window.setTimeout(function(){numOpenCallbacks=0;that.getChildrenCallback(callback,allitems,timer);},timeout);j=repositories.length;function makeApplyRepoToProcessResults(repo){return function(){processResults.apply(repo,arguments);};}
for(i=0;i<j;++i){repo=repositories[i];if((!params.repositoryId||repo.repositoryId===params.repositoryId)&&typeof repo.getChildren==='function'){++numOpenCallbacks;repo.getChildren(params,makeApplyRepoToProcessResults(repo));}}
if(numOpenCallbacks===0){this.getChildrenCallback(callback,allitems,timer);}},getChildrenCallback:function(callback,items,timer){if(timer){clearTimeout(timer);timer=undefined;}
callback.call(this,items);},makeClean:function(obj){var that=this,repository={},i=0,j=that.repositories.length;obj.find('[data-gentics-aloha-repository='+this.prefix+']').each(function(){while(i<j){repository.makeClean(obj);i+=1;}
console.debug(that,'Passing contents of HTML Element with id { '+this.attr('id')+' } for cleaning to repository { '+repository.repositoryId+' }');repository.makeClean(this);});},markObject:function(obj,item){if(!obj){return;}
if(item){var repository=this.getRepository(item.repositoryId);if(repository){jQuery(obj).attr({'data-gentics-aloha-repository':item.repositoryId,'data-gentics-aloha-object-id':item.id});repository.markObject(obj,item);}else{console.error(this,'Trying to apply a repository { '+item.name+' } to an object, but item has no repositoryId.');}}else{jQuery(obj).removeAttr('data-gentics-aloha-repository').removeAttr('data-gentics-aloha-object-id');}},getObject:function(obj,callback){var that=this,$obj=jQuery(obj),repository=this.getRepository($obj.attr('data-gentics-aloha-repository')),itemId=$obj.attr('data-gentics-aloha-object-id');if(repository&&itemId){this.itemCache=this.itemCache||[];this.itemCache[repository.repositoryId]=this.itemCache[repository.repositoryId]||[];if(this.itemCache[repository.repositoryId][itemId]){callback.call(this,[this.itemCache[repository.repositoryId][itemId]]);}else{repository.getObjectById(itemId,function(items){that.itemCache[repository.repositoryId][itemId]=items[0];callback.call(this,items);});}}},folderOpened:function(folder){var repository=this.getRepository(folder.repositoryId);if(typeof repository.folderOpened==='function'){repository.folderOpened(folder);}},folderClosed:function(folder){var repository=this.getRepository(folder.repositoryId);if(typeof repository.folderClosed==='function'){repository.folderClosed(folder);}},folderSelected:function(folder){var repository=this.getRepository(folder.repositoryId);if(typeof repository.folderSelected==='function'){repository.folderSelected(folder);}},getSelectedFolder:function(){var i,len=this.repositories.length,selected;for(i=0;i<len;++i){if(typeof this.repositories[i].getSelectedFolder==='function'){selected=this.repositories[i].getSelectedFolder();if(selected){return selected;}}}},toString:function(){return'repositorymanager';}});Aloha.RepositoryManager=new Aloha.RepositoryManager();return Aloha.RepositoryManager;});define('aloha/repository',['aloha/core','util/class','aloha/repositorymanager'],function(Aloha,Class,RepositoryManager){var AbstractRepository=Class.extend({_constructor:function(repositoryId,repositoryName){this.repositoryId=repositoryId;this.settings={};this.repositoryName=repositoryName||repositoryId;RepositoryManager.register(this);},init:function(){},query:null,getChildren:null,makeClean:function(obj){},markObject:function(obj,repositoryItem){},setTemplate:function(template){if(template){this.template=template;}else{this.template=null;}},hasTemplate:function(){return this.template?true:false;},getTemplate:function(){return this.template;},getObjectById:function(itemId,callback){return true;}});Aloha.AbstractRepository=AbstractRepository;return AbstractRepository;});define('aloha/repositoryobjects',['aloha/core','util/class'],function(Aloha,Class){var GENTICS=window.GENTICS;Aloha.RepositoryObject=function(){};Aloha.RepositoryDocument=Class.extend({_constructor:function(properties){var p=properties;this.type='document';if(!p.id||!p.name||!p.repositoryId){return;}
GENTICS.Utils.applyProperties(this,properties);this.baseType='document';}});Aloha.RepositoryFolder=Class.extend({_constructor:function(properties){var p=properties;this.type='folder';if(!p.id||!p.name||!p.repositoryId){return;}
GENTICS.Utils.applyProperties(this,properties);this.baseType='folder';}});});(function(global){function getLoadConfig(){var scripts,script,plugins=Aloha.settings.plugins&&Aloha.settings.plugins.load,baseUrl=Aloha.settings.baseUrl,pluginsAttr,regexAlohaJs=/\/aloha.js(\?\S*)?$/,regexStripFilename=/\/[^\/]*\.js$/,i;if(!plugins||!baseUrl){scripts=document.getElementsByTagName('script');for(i=0;i<scripts.length;i++){script=scripts[i];pluginsAttr=script.getAttribute('data-aloha-plugins');if(null!=pluginsAttr){if(!plugins){plugins=pluginsAttr;}
if(!baseUrl){baseUrl=script.src.replace(regexStripFilename,'');}
break;}
if(!baseUrl&&regexAlohaJs.test(script.src)){baseUrl=script.src.replace(regexAlohaJs,'');}}}
if(typeof plugins==='string'&&plugins!==''){plugins=plugins.replace(/\s+/g,'').split(',');}
return{baseUrl:baseUrl,plugins:plugins||[]};}
function isDeferInit(){var scripts=document.getElementsByTagName('script');for(var i=0;i<scripts.length;i++){var attr=scripts[i].getAttribute('data-aloha-defer-init');if("true"===attr){return true;}}
return false;}
function mergePluginPaths(paths,bundlePath,pluginName){var resourceFolders=['nls','css','vendor','res'],resourceFolder,i;paths[pluginName]=bundlePath+'/'+pluginName+'/lib';for(i=0;i<resourceFolders.length;i++){var resourceFolder=resourceFolders[i];paths[pluginName+'/'+resourceFolder]=bundlePath+'/'+pluginName+'/'+resourceFolder;}}
function getPluginLoadConfig(plugins){var paths={},entryPoints=[],names=[],baseUrlByName={},map={},parts,bundleName,pluginName,basePath=Aloha.settings.basePath||'',bundlePath,bundles=Aloha.settings.bundles||{},i;for(i=0;i<plugins.length;i++){parts=plugins[i].split('/');bundleName=parts[0];pluginName=parts[1];if(bundles[bundleName]){bundlePath=basePath+bundles[bundleName];}else{bundlePath=basePath+'../plugins/'+bundleName;}
mergePluginPaths(paths,bundlePath,pluginName);baseUrlByName[pluginName]=bundlePath+'/'+pluginName;entryPoints.push(pluginName+'/'+pluginName+'-plugin');map[pluginName]={'jquery':'aloha/jquery'};}
return{paths:paths,entryPoints:entryPoints,baseUrlByName:baseUrlByName,names:names,map:map};}
function mergeObjects(){var clone={};var objects=Array.prototype.slice.call(arguments);var name;var i;var obj;for(i=0;i<objects.length;i++){obj=objects[i];for(name in obj){if(obj.hasOwnProperty(name)){clone[name]=objects[i][name];}}}
return clone;}
function createDefine(name,module){define(name,function(){return module;});}
function load(){Aloha.defaults={};Aloha.settings=Aloha.settings||{};var loadConfig=getLoadConfig();var pluginConfig=getPluginLoadConfig(loadConfig.plugins);Aloha.settings.baseUrl=loadConfig.baseUrl;Aloha.settings.loadedPlugins=pluginConfig.names;Aloha.settings._pluginBaseUrlByName=pluginConfig.baseUrlByName;var coreMap={'aloha':{'jquery':'aloha/jquery'},'aloha/jquery':{'jquery':'jquery'},'jqueryui':{'jquery':'aloha/jquery'},'vendor':{'jquery':'aloha/jquery'},'util':{'jquery':'aloha/jquery'},'RepositoryBrowser':{'jquery':'aloha/jquery'},'jstree':{'jquery':'aloha/jquery'},'jqgrid':{'jquery':'aloha/jquery'},'jqgrid-locale-en':{'jquery':'aloha/jquery'},'jqgrid-locale-de':{'jquery':'aloha/jquery'},'jquery-layout':{'jquery':'aloha/jquery'}};var moduleMap=mergeObjects(coreMap,pluginConfig.map)
var defaultConfig={context:'aloha',locale:Aloha.settings.locale||'en',baseUrl:Aloha.settings.baseUrl,map:moduleMap,urlArgs:"bust="+(new Date()).getTime()};var DependencyManagement=global.__DEPS__||(global.__DEPS__={});DependencyManagement.lang=defaultConfig.locale;var defaultPaths={jquery:'vendor/jquery-1.7.2',jqueryui:'vendor/jquery-ui-1.9m6'};var browserPaths={PubSub:'vendor/pubsub/js/pubsub-unminified','Class':'vendor/class',RepositoryBrowser:'vendor/repository-browser/js/repository-browser-unminified',jstree:'vendor/jquery.jstree',jqgrid:'vendor/jquery.jqgrid','jquery-layout':'vendor/jquery.layout','jqgrid-locale-en':'vendor/grid.locale.en','jqgrid-locale-de':'vendor/grid.locale.de','repository-browser-i18n-de':'vendor/repository-browser/js/repository-browser-unminified','repository-browser-i18n-en':'vendor/repository-browser/js/repository-browser-unminified'};var requireConfig=mergeObjects(defaultConfig,Aloha.settings.requireConfig);requireConfig.paths=mergeObjects(defaultPaths,browserPaths,pluginConfig.paths,requireConfig.paths);var predefinedModules=Aloha.settings.predefinedModules||{};if(Aloha.settings.jQuery){predefinedModules.jquery=Aloha.settings.jQuery;}
var moduleName;for(moduleName in predefinedModules)if(predefinedModules.hasOwnProperty(moduleName)){createDefine(moduleName,predefinedModules[moduleName]);delete requireConfig.paths[moduleName];}
var alohaRequire=require.config(requireConfig);Aloha.require=function(callback){if(1===arguments.length&&typeof callback==='function'){return alohaRequire(['aloha'],callback);}
return alohaRequire.apply(this,arguments);};var deferredReady;Aloha.bind=function(type,fn){Aloha.require(['aloha/jquery'],function(jQuery){Aloha.bind=function(type,fn){deferredReady=deferredReady||jQuery.Deferred();if('aloha-ready'===type){if('alohaReady'!==Aloha.stage){deferredReady.done(fn);}else{fn();}}else{jQuery(Aloha,'body').bind(type,fn);}
return this;};Aloha.bind(type,fn);});return this;};Aloha.trigger=function(type,data){Aloha.require(['aloha/jquery'],function(jQuery){Aloha.trigger=function(type,data){deferredReady=deferredReady||jQuery.Deferred();if('aloha-ready'===type){jQuery(deferredReady.resolve);}
jQuery(Aloha,'body').trigger(type,data);return this;};Aloha.trigger(type,data);});return this;};Aloha.unbind=function(typeOrEvent){Aloha.require(['aloha/jquery'],function(jQuery){Aloha.unbind=function(typeOrEvent){jQuery(Aloha,'body').unbind(typeOrEvent);};Aloha.unbind(typeOrEvent);});};Aloha.ready=function(fn){this.bind('aloha-ready',fn);return this;};var jQueryThatWasPassedToUs=Aloha.settings.jQuery;define('aloha/jquery',['jquery'],function(jQuery){return jQueryThatWasPassedToUs||jQuery;});Aloha.jQuery=jQueryThatWasPassedToUs;define('aloha',['aloha/jquery','util/json2','aloha/rangy-core','util/class','util/lang','util/range','util/dom','aloha/core','aloha/editable','aloha/console','aloha/markup','aloha/plugin','aloha/selection','aloha/command','aloha/jquery.aloha','aloha/sidebar','util/position','aloha/repositorymanager','aloha/repository','aloha/repositoryobjects','aloha/contenthandlermanager'],function(jQuery){Aloha.jQuery=jQuery;Aloha.settings=jQuery.extendObjects(true,{},Aloha.defaults,Aloha.settings);return Aloha;});Aloha.stage='loadingAloha';require(requireConfig,['aloha','aloha/jquery'],function(Aloha,jQuery){Aloha.stage='loadPlugins';require(requireConfig,pluginConfig.entryPoints,function(){jQuery(function(){window.rangy.init();Aloha.init();});});});}
global.Aloha=global.Aloha||{};if(global.Aloha.deferInit||isDeferInit()){global.Aloha.deferInit=load;}else{Aloha._load=load;}}(window));define('ui/context',['aloha','jquery','util/class'],function(Aloha,$,Class){var id='aloha-ui-context',selector='#'+id,element;element=$(selector);if(!element.length){element=$('<div>',{'class':'aloha','id':id});$(function(){element.appendTo('body');});}
var Context=Class.extend({surfaces:[],containers:[]});$.extend(Context,{selector:selector,element:element});return Context;});define('ui/scopes',['jquery','PubSub','util/maps'],function($,PubSub,Maps){var scopes={'Aloha.empty':[],'Aloha.global':['Aloha.empty'],'Aloha.continuoustext':['Aloha.global']},activeScopes=[],addedScopes={},scopeSetDuringSelectionChanged=false;function pushScopeAncestors(ancestorScopes,scope){if(!scopes.hasOwnProperty(scope)){return;}
var parentScopes=scopes[scope];for(var i=0;i<parentScopes.length;i++){var parentScope=parentScopes[i];ancestorScopes.push(parentScope);pushScopeAncestors(ancestorScopes,parentScope);}}
Aloha.bind('aloha-selection-changed-before',function(){scopeSetDuringSelectionChanged=false;});Aloha.bind('aloha-selection-changed-after',function(event,range,originalEvent){if(typeof originalEvent!=='undefined'&&!scopeSetDuringSelectionChanged){Scopes.setScope('Aloha.continuoustext');}});var Scopes={enterScope:function(scope,requestor){requestor=requestor||'_globalCounter';var counters=addedScopes[scope];if(!counters){counters=addedScopes[scope]={};}
var counter=counters[requestor]||0;counter+=1;counters[requestor]=counter;if(!counter){PubSub.pub('aloha.ui.scope.change');}},leaveScope:function(scope,requestor,force){requestor=requestor||'_globalCounter';var counters=addedScopes[scope];if(!counters){return;}
var counter=counters[requestor];if(!counter){return;}
counter-=1;if(counter&&!force){counters[requestor]=counter;}else{delete counters[requestor];if(Maps.isEmpty(counters)){delete addedScopes[scope];}
PubSub.pub('aloha.ui.scope.change');}},isActiveScope:function(scope){if(addedScopes[scope]){return true;}
var isActive=(-1!==$.inArray(scope,activeScopes));if(isActive){return true;}
return false;},getPrimaryScope:function(){return activeScopes[0];},setScope:function(scope){scopeSetDuringSelectionChanged=true;if(activeScopes[0]!=scope){activeScopes=[scope];pushScopeAncestors(activeScopes,scope);PubSub.pub('aloha.ui.scope.change');}},createScope:function(scope,parentScopes){if(!parentScopes){parentScopes=['Aloha.empty'];}else if(typeof parentScopes==='string'){parentScopes=[parentScopes];}
scopes[scope]=parentScopes;}};return Scopes;});define('ui/container',['jquery','util/class','ui/scopes'],function($,Class,Scopes){var uid=0;function getShowOnId(showOn){if(!showOn.showOnId){showOn.showOnId=++uid;}
return showOn.showOnId;}
function toggleContainers(containers,show){var action=show?'show':'hide',i;for(i=0;i<containers.length;i++){containers[i][action]();}}
var scopeFns={};var returnTrue=function(){return true;};function normalizeShowOn(container,showOn){switch($.type(showOn)){case'function':return showOn;case'object':if(showOn.scope){if(scopeFns[showOn.scope]){return scopeFns[showOn.scope];}
return scopeFns[showOn.scope]=function(){return Scopes.isActiveScope(showOn.scope);};}else{throw"Invalid showOn configuration";}
default:return returnTrue;}}
var Container=Class.extend({element:null,_constructor:function(context,settings){var showOn=normalizeShowOn(this,settings.showOn),key=getShowOnId(showOn),group=context.containers[key];this.context=context;if(!group){group=context.containers[key]={shouldShow:showOn,containers:[]};}
group.containers.push(this);},show:function(){},hide:function(){},focus:function(){},foreground:function(){},childVisible:function(childComponent,visible){},childFocus:function(childComponent){},childForeground:function(childComponent){}});$.extend(Container,{showContainersForContext:function(context,eventType){var group,groupKey,containerGroups;if(!context.containers){return;}
containerGroups=context.containers;for(groupKey in containerGroups){if(containerGroups.hasOwnProperty(groupKey)){group=containerGroups[groupKey];toggleContainers(group.containers,group.shouldShow(eventType));}}}});return Container;});define('ui/surface',['aloha/core','jquery','util/class','ui/container'],function(Aloha,$,Class,Container){var Surface=Class.extend({_constructor:function(context){context.surfaces.push(this);},isActive:function(){return true;}});$.extend(Surface,{range:null,show:function(context){$.each(context.surfaces,function(i,surface){surface.show();});},hide:function(context){$.each(context.surfaces,function(i,surface){surface.hide();});},trackRange:function(element){element.bind('mousedown',function(e){e.originalEvent.stopSelectionUpdate=true;Aloha.eventHandled=true;Surface.suppressHide=true;if(Aloha.activeEditable){var selection=Aloha.getSelection();Surface.range=(0<selection.getRangeCount())?selection.getRangeAt(0):null;}});element.bind('mouseup',function(e){e.originalEvent.stopSelectionUpdate=true;Aloha.eventHandled=false;Surface.suppressHide=false;});}});return Surface;});define('ui/component',['aloha/core','jquery','util/class'],function(Aloha,$,Class){var idCounter=0;var Component=Class.extend({id:0,isInstance:true,container:null,type:null,visible:true,_constructor:function(){this.id=idCounter++;this.init();},adoptParent:function(container){this.container=container;},init:function(){},isVisible:function(){return this.visible;},show:function(show_opt){if(false===show_opt){this.hide();return;}
if(!this.visible){this.visible=true;this.element.show();if(this.container){this.container.childVisible(this,true);}}},hide:function(){if(this.visible){this.visible=false;this.element.hide();if(this.container){this.container.childVisible(this,false);}}},focus:function(){this.element.focus();if(this.container){this.container.childFocus(this);}},foreground:function(){if(this.container){this.container.childForeground(this);}},enable:function(enable_opt){},disable:function(){}});return Component;});define('jqueryui',['jquery'],function(jQuery){var $=jQuery;(function($,undefined){$.ui=$.ui||{};if($.ui.version){return;}
$.extend($.ui,{version:"1.9m6",keyCode:{ALT:18,BACKSPACE:8,CAPS_LOCK:20,COMMA:188,COMMAND:91,COMMAND_LEFT:91,COMMAND_RIGHT:93,CONTROL:17,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,INSERT:45,LEFT:37,MENU:93,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SHIFT:16,SPACE:32,TAB:9,UP:38,WINDOWS:91}});$.fn.extend({_focus:$.fn.focus,focus:function(delay,fn){return typeof delay==="number"?this.each(function(){var elem=this;setTimeout(function(){$(elem).focus();if(fn){fn.call(elem);}},delay);}):this._focus.apply(this,arguments);},scrollParent:function(){var scrollParent;if(($.browser.msie&&(/(static|relative)/).test(this.css('position')))||(/absolute/).test(this.css('position'))){scrollParent=this.parents().filter(function(){return(/(relative|absolute|fixed)/).test($.curCSS(this,'position',1))&&(/(auto|scroll)/).test($.curCSS(this,'overflow',1)+$.curCSS(this,'overflow-y',1)+$.curCSS(this,'overflow-x',1));}).eq(0);}else{scrollParent=this.parents().filter(function(){return(/(auto|scroll)/).test($.curCSS(this,'overflow',1)+$.curCSS(this,'overflow-y',1)+$.curCSS(this,'overflow-x',1));}).eq(0);}
return(/fixed/).test(this.css('position'))||!scrollParent.length?$(document):scrollParent;},zIndex:function(zIndex){if(zIndex!==undefined){return this.css("zIndex",zIndex);}
if(this.length){var elem=$(this[0]),position,value;while(elem.length&&elem[0]!==document){position=elem.css("position");if(position==="absolute"||position==="relative"||position==="fixed"){value=parseInt(elem.css("zIndex"),10);if(!isNaN(value)&&value!==0){return value;}}
elem=elem.parent();}}
return 0;},disableSelection:function(){return this.bind(($.support.selectstart?"selectstart":"mousedown")+".ui-disableSelection",function(event){event.preventDefault();});},enableSelection:function(){return this.unbind(".ui-disableSelection");}});$.each(["Width","Height"],function(i,name){var side=name==="Width"?["Left","Right"]:["Top","Bottom"],type=name.toLowerCase(),orig={innerWidth:$.fn.innerWidth,innerHeight:$.fn.innerHeight,outerWidth:$.fn.outerWidth,outerHeight:$.fn.outerHeight};function reduce(elem,size,border,margin){$.each(side,function(){size-=parseFloat($.curCSS(elem,"padding"+this,true))||0;if(border){size-=parseFloat($.curCSS(elem,"border"+this+"Width",true))||0;}
if(margin){size-=parseFloat($.curCSS(elem,"margin"+this,true))||0;}});return size;}
$.fn["inner"+name]=function(size){if(size===undefined){return orig["inner"+name].call(this);}
return this.each(function(){$(this).css(type,reduce(this,size)+"px");});};$.fn["outer"+name]=function(size,margin){if(typeof size!=="number"){return orig["outer"+name].call(this,size);}
return this.each(function(){$(this).css(type,reduce(this,size,true,margin)+"px");});};});function focusable(element,isTabIndexNotNaN){var nodeName=element.nodeName.toLowerCase();if("area"===nodeName){var map=element.parentNode,mapName=map.name,img;if(!element.href||!mapName||map.nodeName.toLowerCase()!=="map"){return false;}
img=$("img[usemap=#"+mapName+"]")[0];return!!img&&visible(img);}
return(/input|select|textarea|button|object/.test(nodeName)?!element.disabled:"a"==nodeName?element.href||isTabIndexNotNaN:isTabIndexNotNaN)&&visible(element);}
function visible(element){return!$(element).parents().andSelf().filter(function(){return $.curCSS(this,"visibility")==="hidden"||$.expr.filters.hidden(this);}).length;}
$.extend($.expr[":"],{data:function(elem,i,match){return!!$.data(elem,match[3]);},focusable:function(element){return focusable(element,!isNaN($.attr(element,"tabindex")));},tabbable:function(element){var tabIndex=$.attr(element,"tabindex"),isTabIndexNaN=isNaN(tabIndex);return(isTabIndexNaN||tabIndex>=0)&&focusable(element,!isTabIndexNaN);}});$(function(){var body=document.body,div=body.appendChild(div=document.createElement("div"));$.extend(div.style,{minHeight:"100px",height:"auto",padding:0,borderWidth:0});$.support.minHeight=div.offsetHeight===100;$.support.selectstart="onselectstart"in div;body.removeChild(div).style.display="none";});$.extend($.ui,{plugin:{add:function(module,option,set){var proto=$.ui[module].prototype;for(var i in set){proto.plugins[i]=proto.plugins[i]||[];proto.plugins[i].push([option,set[i]]);}},call:function(instance,name,args){var set=instance.plugins[name];if(!set||!instance.element[0].parentNode){return;}
for(var i=0;i<set.length;i++){if(instance.options[set[i][0]]){set[i][1].apply(instance.element,args);}}}},contains:$.contains,hasScroll:function(el,a){if($(el).css("overflow")==="hidden"){return false;}
var scroll=(a&&a==="left")?"scrollLeft":"scrollTop",has=false;if(el[scroll]>0){return true;}
el[scroll]=1;has=(el[scroll]>0);el[scroll]=0;return has;},isOverAxis:function(x,reference,size){return(x>reference)&&(x<(reference+size));},isOver:function(y,x,top,left,height,width){return $.ui.isOverAxis(y,top,height)&&$.ui.isOverAxis(x,left,width);}});})(jQuery);(function($,undefined){var slice=Array.prototype.slice;var _cleanData=$.cleanData;$.cleanData=function(elems){for(var i=0,elem;(elem=elems[i])!=null;i++){try{$(elem).triggerHandler("remove");}catch(e){}}
_cleanData(elems);};$.widget=function(name,base,prototype){var namespace=name.split(".")[0],fullName;name=name.split(".")[1];fullName=namespace+"-"+name;if(!prototype){prototype=base;base=$.Widget;}
$.expr[":"][fullName]=function(elem){return!!$.data(elem,name);};$[namespace]=$[namespace]||{};$[namespace][name]=$.extend(function(options,element){if(!this._createWidget){return new $[namespace][name](options,element);}
if(arguments.length){this._createWidget(options,element);}},$[namespace][name],{version:prototype.version});var basePrototype=new base();basePrototype.options=$.widget.extend({},basePrototype.options);$.each(prototype,function(prop,value){if($.isFunction(value)){prototype[prop]=(function(){var _super=function(method){return base.prototype[method].apply(this,slice.call(arguments,1));};var _superApply=function(method,args){return base.prototype[method].apply(this,args);};return function(){var __super=this._super,__superApply=this._superApply,returnValue;this._super=_super;this._superApply=_superApply;returnValue=value.apply(this,arguments);this._super=__super;this._superApply=__superApply;return returnValue;};}());}});$[namespace][name].prototype=$.widget.extend(basePrototype,{namespace:namespace,widgetName:name,widgetEventPrefix:name,widgetBaseClass:fullName},prototype);$.widget.bridge(name,$[namespace][name]);};$.widget.extend=function(target){var input=slice.call(arguments,1),inputIndex=0,inputLength=input.length,key,value;for(;inputIndex<inputLength;inputIndex++){for(key in input[inputIndex]){value=input[inputIndex][key];if(input[inputIndex].hasOwnProperty(key)&&value!==undefined){target[key]=$.isPlainObject(value)?$.widget.extend({},target[key],value):value;}}}
return target;};$.widget.bridge=function(name,object){$.fn[name]=function(options){var isMethodCall=typeof options==="string",args=slice.call(arguments,1),returnValue=this;options=!isMethodCall&&args.length?$.widget.extend.apply(null,[options].concat(args)):options;if(isMethodCall){this.each(function(){var instance=$.data(this,name);if(!instance){return $.error("cannot call methods on "+name+" prior to initialization; "+"attempted to call method '"+options+"'");}
if(!$.isFunction(instance[options])||options.charAt(0)==="_"){return $.error("no such method '"+options+"' for "+name+" widget instance");}
var methodValue=instance[options].apply(instance,args);if(methodValue!==instance&&methodValue!==undefined){returnValue=methodValue&&methodValue.jquery?returnValue.pushStack(methodValue.get()):methodValue;return false;}});}else{this.each(function(){var instance=$.data(this,name);if(instance){instance.option(options||{})._init();}else{object(options,this);}});}
return returnValue;};};$.Widget=function(options,element){if(!this._createWidget){return new $[namespace][name](options,element);}
if(arguments.length){this._createWidget(options,element);}};$.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:false,create:null},_createWidget:function(options,element){element=$(element||this.defaultElement||this)[0];this.element=$(element);this.options=$.widget.extend({},this.options,this._getCreateOptions(),options);this.bindings=$();this.hoverable=$();this.focusable=$();if(element!==this){$.data(element,this.widgetName,this);this._bind({remove:"destroy"});}
this._create();this._trigger("create");this._init();},_getCreateOptions:$.noop,_create:$.noop,_init:$.noop,destroy:function(){this._destroy();this.element.unbind("."+this.widgetName).removeData(this.widgetName);this.widget().unbind("."+this.widgetName).removeAttr("aria-disabled").removeClass(this.widgetBaseClass+"-disabled "+"ui-state-disabled");this.bindings.unbind("."+this.widgetName);this.hoverable.removeClass("ui-state-hover");this.focusable.removeClass("ui-state-focus");},_destroy:$.noop,widget:function(){return this.element;},option:function(key,value){var options=key,parts,curOption,i;if(arguments.length===0){return $.widget.extend({},this.options);}
if(typeof key==="string"){options={};parts=key.split(".");key=parts.shift();if(parts.length){curOption=options[key]=$.widget.extend({},this.options[key]);for(i=0;i<parts.length-1;i++){curOption[parts[i]]=curOption[parts[i]]||{};curOption=curOption[parts[i]];}
key=parts.pop();if(value===undefined){return curOption[key]===undefined?null:curOption[key];}
curOption[key]=value;}else{if(value===undefined){return this.options[key]===undefined?null:this.options[key];}
options[key]=value;}}
this._setOptions(options);return this;},_setOptions:function(options){var that=this;$.each(options,function(key,value){that._setOption(key,value);});return this;},_setOption:function(key,value){this.options[key]=value;if(key==="disabled"){this.widget().toggleClass(this.widgetBaseClass+"-disabled ui-state-disabled",!!value).attr("aria-disabled",value);this.hoverable.removeClass("ui-state-hover");this.focusable.removeClass("ui-state-focus");}
return this;},enable:function(){return this._setOption("disabled",false);},disable:function(){return this._setOption("disabled",true);},_bind:function(element,handlers){if(!handlers){handlers=element;element=this.element;}else{element=$(element);this.bindings=this.bindings.add(element);}
var instance=this;$.each(handlers,function(event,handler){function handlerProxy(){if(instance.options.disabled===true||$(this).hasClass("ui-state-disabled")){return;}
return(typeof handler==="string"?instance[handler]:handler).apply(instance,arguments);}
var match=event.match(/^(\w+)\s*(.*)$/),eventName=match[1]+"."+instance.widgetName,selector=match[2];if(selector){instance.widget().delegate(selector,eventName,handlerProxy);}else{element.bind(eventName,handlerProxy);}});},_delay:function(handler,delay){function handlerProxy(){return(typeof handler==="string"?instance[handler]:handler).apply(instance,arguments);}
var instance=this;return setTimeout(handlerProxy,delay||0);},_hoverable:function(element){this.hoverable=this.hoverable.add(element);this._bind(element,{mouseenter:function(event){$(event.currentTarget).addClass("ui-state-hover");},mouseleave:function(event){$(event.currentTarget).removeClass("ui-state-hover");}});},_focusable:function(element){this.focusable=this.focusable.add(element);this._bind(element,{focusin:function(event){$(event.currentTarget).addClass("ui-state-focus");},focusout:function(event){$(event.currentTarget).removeClass("ui-state-focus");}});},_trigger:function(type,event,data){var callback=this.options[type],args;event=$.Event(event);event.type=(type===this.widgetEventPrefix?type:this.widgetEventPrefix+type).toLowerCase();data=data||{};if(event.originalEvent){for(var i=$.event.props.length,prop;i;){prop=$.event.props[--i];event[prop]=event.originalEvent[prop];}}
this.element.trigger(event,data);args=$.isArray(data)?[event].concat(data):[event,data];return!($.isFunction(callback)&&callback.apply(this.element[0],args)===false||event.isDefaultPrevented());}};$.each({show:"fadeIn",hide:"fadeOut"},function(method,defaultEffect){$.Widget.prototype["_"+method]=function(element,options,callback){if(typeof options==="string"){options={effect:options};}
var hasOptions,effectName=!options?method:options===true||typeof options==="number"?defaultEffect:options.effect||defaultEffect;options=options||{};if(typeof options==="number"){options={duration:options};}
hasOptions=!$.isEmptyObject(options);options.complete=callback;if(options.delay){element.delay(options.delay);}
if(hasOptions&&$.effects&&($.effects.effect[effectName]||$.uiBackCompat!==false&&$.effects[effectName])){element[method](options);}else if(effectName!==method&&element[effectName]){element[effectName](options.duration,options.easing,callback);}else{element.queue(function(next){$(this)[method]();if(callback){callback.call(element[0]);}
next();});}};});if($.uiBackCompat!==false){$.Widget.prototype._getCreateOptions=function(){return $.metadata&&$.metadata.get(this.element[0])[this.widgetName];};}})(jQuery);(function($,undefined){var mouseHandled=false;$(document).mouseup(function(e){mouseHandled=false;});$.widget("ui.mouse",{version:"1.9m6",options:{cancel:':input,option',distance:1,delay:0},_mouseInit:function(){var self=this;this.element.bind('mousedown.'+this.widgetName,function(event){return self._mouseDown(event);}).bind('click.'+this.widgetName,function(event){if(true===$.data(event.target,self.widgetName+'.preventClickEvent')){$.removeData(event.target,self.widgetName+'.preventClickEvent');event.stopImmediatePropagation();return false;}});this.started=false;},_mouseDestroy:function(){this.element.unbind('.'+this.widgetName);},_mouseDown:function(event){if(mouseHandled){return};(this._mouseStarted&&this._mouseUp(event));this._mouseDownEvent=event;var self=this,btnIsLeft=(event.which==1),elIsCancel=(typeof this.options.cancel=="string"&&event.target.nodeName?$(event.target).closest(this.options.cancel).length:false);if(!btnIsLeft||elIsCancel||!this._mouseCapture(event)){return true;}
this.mouseDelayMet=!this.options.delay;if(!this.mouseDelayMet){this._mouseDelayTimer=setTimeout(function(){self.mouseDelayMet=true;},this.options.delay);}
if(this._mouseDistanceMet(event)&&this._mouseDelayMet(event)){this._mouseStarted=(this._mouseStart(event)!==false);if(!this._mouseStarted){event.preventDefault();return true;}}
if(true===$.data(event.target,this.widgetName+'.preventClickEvent')){$.removeData(event.target,this.widgetName+'.preventClickEvent');}
this._mouseMoveDelegate=function(event){return self._mouseMove(event);};this._mouseUpDelegate=function(event){return self._mouseUp(event);};$(document).bind('mousemove.'+this.widgetName,this._mouseMoveDelegate).bind('mouseup.'+this.widgetName,this._mouseUpDelegate);event.preventDefault();mouseHandled=true;return true;},_mouseMove:function(event){if($.browser.msie&&!(document.documentMode>=9)&&!event.button){return this._mouseUp(event);}
if(this._mouseStarted){this._mouseDrag(event);return event.preventDefault();}
if(this._mouseDistanceMet(event)&&this._mouseDelayMet(event)){this._mouseStarted=(this._mouseStart(this._mouseDownEvent,event)!==false);(this._mouseStarted?this._mouseDrag(event):this._mouseUp(event));}
return!this._mouseStarted;},_mouseUp:function(event){$(document).unbind('mousemove.'+this.widgetName,this._mouseMoveDelegate).unbind('mouseup.'+this.widgetName,this._mouseUpDelegate);if(this._mouseStarted){this._mouseStarted=false;if(event.target==this._mouseDownEvent.target){$.data(event.target,this.widgetName+'.preventClickEvent',true);}
this._mouseStop(event);}
return false;},_mouseDistanceMet:function(event){return(Math.max(Math.abs(this._mouseDownEvent.pageX-event.pageX),Math.abs(this._mouseDownEvent.pageY-event.pageY))>=this.options.distance);},_mouseDelayMet:function(event){return this.mouseDelayMet;},_mouseStart:function(event){},_mouseDrag:function(event){},_mouseStop:function(event){},_mouseCapture:function(event){return true;}});})(jQuery);(function($,undefined){$.widget("ui.draggable",$.ui.mouse,{version:"1.9m6",widgetEventPrefix:"drag",options:{addClasses:true,appendTo:"parent",axis:false,connectToSortable:false,containment:false,cursor:"auto",cursorAt:false,grid:false,handle:false,helper:"original",iframeFix:false,opacity:false,refreshPositions:false,revert:false,revertDuration:500,scope:"default",scroll:true,scrollSensitivity:20,scrollSpeed:20,snap:false,snapMode:"both",snapTolerance:20,stack:false,zIndex:false},_create:function(){if(this.options.helper=='original'&&!(/^(?:r|a|f)/).test(this.element.css("position")))
this.element[0].style.position='relative';(this.options.addClasses&&this.element.addClass("ui-draggable"));(this.options.disabled&&this.element.addClass("ui-draggable-disabled"));this._mouseInit();},destroy:function(){if(!this.element.data('draggable'))return;this.element.removeData("draggable").unbind(".draggable").removeClass("ui-draggable"
+" ui-draggable-dragging"
+" ui-draggable-disabled");this._mouseDestroy();return this;},_mouseCapture:function(event){var o=this.options;if(this.helper||o.disabled||$(event.target).is('.ui-resizable-handle'))
return false;this.handle=this._getHandle(event);if(!this.handle)
return false;$(o.iframeFix===true?"iframe":o.iframeFix).each(function(){$('<div class="ui-draggable-iframeFix" style="background: #fff;"></div>').css({width:this.offsetWidth+"px",height:this.offsetHeight+"px",position:"absolute",opacity:"0.001",zIndex:1000}).css($(this).offset()).appendTo("body");});return true;},_mouseStart:function(event){var o=this.options;this.helper=this._createHelper(event);this._cacheHelperProportions();if($.ui.ddmanager)
$.ui.ddmanager.current=this;this._cacheMargins();this.cssPosition=this.helper.css("position");this.scrollParent=this.helper.scrollParent();this.offset=this.positionAbs=this.element.offset();this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left};$.extend(this.offset,{click:{left:event.pageX-this.offset.left,top:event.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()});this.originalPosition=this.position=this._generatePosition(event);this.originalPageX=event.pageX;this.originalPageY=event.pageY;(o.cursorAt&&this._adjustOffsetFromHelper(o.cursorAt));if(o.containment)
this._setContainment();if(this._trigger("start",event)===false){this._clear();return false;}
this._cacheHelperProportions();if($.ui.ddmanager&&!o.dropBehaviour)
$.ui.ddmanager.prepareOffsets(this,event);this.helper.addClass("ui-draggable-dragging");this._mouseDrag(event,true);if($.ui.ddmanager)$.ui.ddmanager.dragStart(this,event);return true;},_mouseDrag:function(event,noPropagation){this.position=this._generatePosition(event);this.positionAbs=this._convertPositionTo("absolute");if(!noPropagation){var ui=this._uiHash();if(this._trigger('drag',event,ui)===false){this._mouseUp({});return false;}
this.position=ui.position;}
if(!this.options.axis||this.options.axis!="y")this.helper[0].style.left=this.position.left+'px';if(!this.options.axis||this.options.axis!="x")this.helper[0].style.top=this.position.top+'px';if($.ui.ddmanager)$.ui.ddmanager.drag(this,event);return false;},_mouseStop:function(event){var dropped=false;if($.ui.ddmanager&&!this.options.dropBehaviour)
dropped=$.ui.ddmanager.drop(this,event);if(this.dropped){dropped=this.dropped;this.dropped=false;}
if(!this.element[0]||!this.element[0].parentNode)
return false;if((this.options.revert=="invalid"&&!dropped)||(this.options.revert=="valid"&&dropped)||this.options.revert===true||($.isFunction(this.options.revert)&&this.options.revert.call(this.element,dropped))){var self=this;$(this.helper).animate(this.originalPosition,parseInt(this.options.revertDuration,10),function(){if(self._trigger("stop",event)!==false){self._clear();}});}else{if(this._trigger("stop",event)!==false){this._clear();}}
return false;},_mouseUp:function(event){if(this.options.iframeFix===true){$("div.ui-draggable-iframeFix").each(function(){this.parentNode.removeChild(this);});}
if($.ui.ddmanager)$.ui.ddmanager.dragStop(this,event);return $.ui.mouse.prototype._mouseUp.call(this,event);},cancel:function(){if(this.helper.is(".ui-draggable-dragging")){this._mouseUp({});}else{this._clear();}
return this;},_getHandle:function(event){var handle=!this.options.handle||!$(this.options.handle,this.element).length?true:false;$(this.options.handle,this.element).find("*").andSelf().each(function(){if(this==event.target)handle=true;});return handle;},_createHelper:function(event){var o=this.options;var helper=$.isFunction(o.helper)?$(o.helper.apply(this.element[0],[event])):(o.helper=='clone'?this.element.clone().removeAttr('id'):this.element);if(!helper.parents('body').length)
helper.appendTo((o.appendTo=='parent'?this.element[0].parentNode:o.appendTo));if(helper[0]!=this.element[0]&&!(/(fixed|absolute)/).test(helper.css("position")))
helper.css("position","absolute");return helper;},_adjustOffsetFromHelper:function(obj){if(typeof obj=='string'){obj=obj.split(' ');}
if($.isArray(obj)){obj={left:+obj[0],top:+obj[1]||0};}
if('left'in obj){this.offset.click.left=obj.left+this.margins.left;}
if('right'in obj){this.offset.click.left=this.helperProportions.width-obj.right+this.margins.left;}
if('top'in obj){this.offset.click.top=obj.top+this.margins.top;}
if('bottom'in obj){this.offset.click.top=this.helperProportions.height-obj.bottom+this.margins.top;}},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var po=this.offsetParent.offset();if(this.cssPosition=='absolute'&&this.scrollParent[0]!=document&&$.contains(this.scrollParent[0],this.offsetParent[0])){po.left+=this.scrollParent.scrollLeft();po.top+=this.scrollParent.scrollTop();}
if((this.offsetParent[0]==document.body)||(this.offsetParent[0].tagName&&this.offsetParent[0].tagName.toLowerCase()=='html'&&$.browser.msie))
po={top:0,left:0};return{top:po.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:po.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)};},_getRelativeOffset:function(){if(this.cssPosition=="relative"){var p=this.element.position();return{top:p.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:p.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()};}else{return{top:0,left:0};}},_cacheMargins:function(){this.margins={left:(parseInt(this.element.css("marginLeft"),10)||0),top:(parseInt(this.element.css("marginTop"),10)||0),right:(parseInt(this.element.css("marginRight"),10)||0),bottom:(parseInt(this.element.css("marginBottom"),10)||0)};},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()};},_setContainment:function(){var o=this.options;if(o.containment=='parent')o.containment=this.helper[0].parentNode;if(o.containment=='document'||o.containment=='window')this.containment=[o.containment=='document'?0:$(window).scrollLeft()-this.offset.relative.left-this.offset.parent.left,o.containment=='document'?0:$(window).scrollTop()-this.offset.relative.top-this.offset.parent.top,(o.containment=='document'?0:$(window).scrollLeft())+$(o.containment=='document'?document:window).width()-this.helperProportions.width-this.margins.left,(o.containment=='document'?0:$(window).scrollTop())+($(o.containment=='document'?document:window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top];if(!(/^(document|window|parent)$/).test(o.containment)&&o.containment.constructor!=Array){var c=$(o.containment);var ce=c[0];if(!ce)return;var co=c.offset();var over=($(ce).css("overflow")!='hidden');this.containment=[(parseInt($(ce).css("borderLeftWidth"),10)||0)+(parseInt($(ce).css("paddingLeft"),10)||0),(parseInt($(ce).css("borderTopWidth"),10)||0)+(parseInt($(ce).css("paddingTop"),10)||0),(over?Math.max(ce.scrollWidth,ce.offsetWidth):ce.offsetWidth)-(parseInt($(ce).css("borderLeftWidth"),10)||0)-(parseInt($(ce).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left-this.margins.right,(over?Math.max(ce.scrollHeight,ce.offsetHeight):ce.offsetHeight)-(parseInt($(ce).css("borderTopWidth"),10)||0)-(parseInt($(ce).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top-this.margins.bottom];this.relative_container=c;}else if(o.containment.constructor==Array){this.containment=o.containment;}},_convertPositionTo:function(d,pos){if(!pos)pos=this.position;var mod=d=="absolute"?1:-1;var o=this.options,scroll=this.cssPosition=='absolute'&&!(this.scrollParent[0]!=document&&$.contains(this.scrollParent[0],this.offsetParent[0]))?this.offsetParent:this.scrollParent,scrollIsRootNode=(/(html|body)/i).test(scroll[0].tagName);return{top:(pos.top
+this.offset.relative.top*mod
+this.offset.parent.top*mod
-($.browser.safari&&$.browser.version<526&&this.cssPosition=='fixed'?0:(this.cssPosition=='fixed'?-this.scrollParent.scrollTop():(scrollIsRootNode?0:scroll.scrollTop()))*mod)),left:(pos.left
+this.offset.relative.left*mod
+this.offset.parent.left*mod
-($.browser.safari&&$.browser.version<526&&this.cssPosition=='fixed'?0:(this.cssPosition=='fixed'?-this.scrollParent.scrollLeft():scrollIsRootNode?0:scroll.scrollLeft())*mod))};},_generatePosition:function(event){var o=this.options,scroll=this.cssPosition=='absolute'&&!(this.scrollParent[0]!=document&&$.contains(this.scrollParent[0],this.offsetParent[0]))?this.offsetParent:this.scrollParent,scrollIsRootNode=(/(html|body)/i).test(scroll[0].tagName);var pageX=event.pageX;var pageY=event.pageY;if(this.originalPosition){var containment;if(this.containment){if(this.relative_container){var co=this.relative_container.offset();containment=[this.containment[0]+co.left,this.containment[1]+co.top,this.containment[2]+co.left,this.containment[3]+co.top];}
else{containment=this.containment;}
if(event.pageX-this.offset.click.left<containment[0])pageX=containment[0]+this.offset.click.left;if(event.pageY-this.offset.click.top<containment[1])pageY=containment[1]+this.offset.click.top;if(event.pageX-this.offset.click.left>containment[2])pageX=containment[2]+this.offset.click.left;if(event.pageY-this.offset.click.top>containment[3])pageY=containment[3]+this.offset.click.top;}
if(o.grid){var top=o.grid[1]?this.originalPageY+Math.round((pageY-this.originalPageY)/o.grid[1])*o.grid[1]:this.originalPageY;pageY=containment?(!(top-this.offset.click.top<containment[1]||top-this.offset.click.top>containment[3])?top:(!(top-this.offset.click.top<containment[1])?top-o.grid[1]:top+o.grid[1])):top;var left=o.grid[0]?this.originalPageX+Math.round((pageX-this.originalPageX)/o.grid[0])*o.grid[0]:this.originalPageX;pageX=containment?(!(left-this.offset.click.left<containment[0]||left-this.offset.click.left>containment[2])?left:(!(left-this.offset.click.left<containment[0])?left-o.grid[0]:left+o.grid[0])):left;}}
return{top:(pageY
-this.offset.click.top
-this.offset.relative.top
-this.offset.parent.top
+($.browser.safari&&$.browser.version<526&&this.cssPosition=='fixed'?0:(this.cssPosition=='fixed'?-this.scrollParent.scrollTop():(scrollIsRootNode?0:scroll.scrollTop())))),left:(pageX
-this.offset.click.left
-this.offset.relative.left
-this.offset.parent.left
+($.browser.safari&&$.browser.version<526&&this.cssPosition=='fixed'?0:(this.cssPosition=='fixed'?-this.scrollParent.scrollLeft():scrollIsRootNode?0:scroll.scrollLeft())))};},_clear:function(){this.helper.removeClass("ui-draggable-dragging");if(this.helper[0]!=this.element[0]&&!this.cancelHelperRemoval)this.helper.remove();this.helper=null;this.cancelHelperRemoval=false;},_trigger:function(type,event,ui){ui=ui||this._uiHash();$.ui.plugin.call(this,type,[event,ui]);if(type=="drag")this.positionAbs=this._convertPositionTo("absolute");return $.Widget.prototype._trigger.call(this,type,event,ui);},plugins:{},_uiHash:function(event){return{helper:this.helper,position:this.position,originalPosition:this.originalPosition,offset:this.positionAbs};}});$.ui.plugin.add("draggable","connectToSortable",{start:function(event,ui){var inst=$(this).data("draggable"),o=inst.options,uiSortable=$.extend({},ui,{item:inst.element});inst.sortables=[];$(o.connectToSortable).each(function(){var sortable=$.data(this,'sortable');if(sortable&&!sortable.options.disabled){inst.sortables.push({instance:sortable,shouldRevert:sortable.options.revert});sortable.refreshPositions();sortable._trigger("activate",event,uiSortable);}});},stop:function(event,ui){var inst=$(this).data("draggable"),uiSortable=$.extend({},ui,{item:inst.element});$.each(inst.sortables,function(){if(this.instance.isOver){this.instance.isOver=0;inst.cancelHelperRemoval=true;this.instance.cancelHelperRemoval=false;if(this.shouldRevert)this.instance.options.revert=true;this.instance._mouseStop(event);this.instance.options.helper=this.instance.options._helper;if(inst.options.helper=='original')
this.instance.currentItem.css({top:'auto',left:'auto'});}else{this.instance.cancelHelperRemoval=false;this.instance._trigger("deactivate",event,uiSortable);}});},drag:function(event,ui){var inst=$(this).data("draggable"),self=this;var checkPos=function(o){var dyClick=this.offset.click.top,dxClick=this.offset.click.left;var helperTop=this.positionAbs.top,helperLeft=this.positionAbs.left;var itemHeight=o.height,itemWidth=o.width;var itemTop=o.top,itemLeft=o.left;return $.ui.isOver(helperTop+dyClick,helperLeft+dxClick,itemTop,itemLeft,itemHeight,itemWidth);};$.each(inst.sortables,function(i){this.instance.positionAbs=inst.positionAbs;this.instance.helperProportions=inst.helperProportions;this.instance.offset.click=inst.offset.click;if(this.instance._intersectsWith(this.instance.containerCache)){if(!this.instance.isOver){this.instance.isOver=1;this.instance.currentItem=$(self).clone().removeAttr('id').appendTo(this.instance.element).data("sortable-item",true);this.instance.options._helper=this.instance.options.helper;this.instance.options.helper=function(){return ui.helper[0];};event.target=this.instance.currentItem[0];this.instance._mouseCapture(event,true);this.instance._mouseStart(event,true,true);this.instance.offset.click.top=inst.offset.click.top;this.instance.offset.click.left=inst.offset.click.left;this.instance.offset.parent.left-=inst.offset.parent.left-this.instance.offset.parent.left;this.instance.offset.parent.top-=inst.offset.parent.top-this.instance.offset.parent.top;inst._trigger("toSortable",event);inst.dropped=this.instance.element;inst.currentItem=inst.element;this.instance.fromOutside=inst;}
if(this.instance.currentItem)this.instance._mouseDrag(event);}else{if(this.instance.isOver){this.instance.isOver=0;this.instance.cancelHelperRemoval=true;this.instance.options.revert=false;this.instance._trigger('out',event,this.instance._uiHash(this.instance));this.instance._mouseStop(event,true);this.instance.options.helper=this.instance.options._helper;this.instance.currentItem.remove();if(this.instance.placeholder)this.instance.placeholder.remove();inst._trigger("fromSortable",event);inst.dropped=false;}};});}});$.ui.plugin.add("draggable","cursor",{start:function(event,ui){var t=$('body'),o=$(this).data('draggable').options;if(t.css("cursor"))o._cursor=t.css("cursor");t.css("cursor",o.cursor);},stop:function(event,ui){var o=$(this).data('draggable').options;if(o._cursor)$('body').css("cursor",o._cursor);}});$.ui.plugin.add("draggable","opacity",{start:function(event,ui){var t=$(ui.helper),o=$(this).data('draggable').options;if(t.css("opacity"))o._opacity=t.css("opacity");t.css('opacity',o.opacity);},stop:function(event,ui){var o=$(this).data('draggable').options;if(o._opacity)$(ui.helper).css('opacity',o._opacity);}});$.ui.plugin.add("draggable","scroll",{start:function(event,ui){var i=$(this).data("draggable");if(i.scrollParent[0]!=document&&i.scrollParent[0].tagName!='HTML')i.overflowOffset=i.scrollParent.offset();},drag:function(event,ui){var i=$(this).data("draggable"),o=i.options,scrolled=false;if(i.scrollParent[0]!=document&&i.scrollParent[0].tagName!='HTML'){if(!o.axis||o.axis!='x'){if((i.overflowOffset.top+i.scrollParent[0].offsetHeight)-event.pageY<o.scrollSensitivity)
i.scrollParent[0].scrollTop=scrolled=i.scrollParent[0].scrollTop+o.scrollSpeed;else if(event.pageY-i.overflowOffset.top<o.scrollSensitivity)
i.scrollParent[0].scrollTop=scrolled=i.scrollParent[0].scrollTop-o.scrollSpeed;}
if(!o.axis||o.axis!='y'){if((i.overflowOffset.left+i.scrollParent[0].offsetWidth)-event.pageX<o.scrollSensitivity)
i.scrollParent[0].scrollLeft=scrolled=i.scrollParent[0].scrollLeft+o.scrollSpeed;else if(event.pageX-i.overflowOffset.left<o.scrollSensitivity)
i.scrollParent[0].scrollLeft=scrolled=i.scrollParent[0].scrollLeft-o.scrollSpeed;}}else{if(!o.axis||o.axis!='x'){if(event.pageY-$(document).scrollTop()<o.scrollSensitivity)
scrolled=$(document).scrollTop($(document).scrollTop()-o.scrollSpeed);else if($(window).height()-(event.pageY-$(document).scrollTop())<o.scrollSensitivity)
scrolled=$(document).scrollTop($(document).scrollTop()+o.scrollSpeed);}
if(!o.axis||o.axis!='y'){if(event.pageX-$(document).scrollLeft()<o.scrollSensitivity)
scrolled=$(document).scrollLeft($(document).scrollLeft()-o.scrollSpeed);else if($(window).width()-(event.pageX-$(document).scrollLeft())<o.scrollSensitivity)
scrolled=$(document).scrollLeft($(document).scrollLeft()+o.scrollSpeed);}}
if(scrolled!==false&&$.ui.ddmanager&&!o.dropBehaviour)
$.ui.ddmanager.prepareOffsets(i,event);}});$.ui.plugin.add("draggable","snap",{start:function(event,ui){var i=$(this).data("draggable"),o=i.options;i.snapElements=[];$(o.snap.constructor!=String?(o.snap.items||':data(draggable)'):o.snap).each(function(){var $t=$(this);var $o=$t.offset();if(this!=i.element[0])i.snapElements.push({item:this,width:$t.outerWidth(),height:$t.outerHeight(),top:$o.top,left:$o.left});});},drag:function(event,ui){var inst=$(this).data("draggable"),o=inst.options;var d=o.snapTolerance;var x1=ui.offset.left,x2=x1+inst.helperProportions.width,y1=ui.offset.top,y2=y1+inst.helperProportions.height;for(var i=inst.snapElements.length-1;i>=0;i--){var l=inst.snapElements[i].left,r=l+inst.snapElements[i].width,t=inst.snapElements[i].top,b=t+inst.snapElements[i].height;if(!((l-d<x1&&x1<r+d&&t-d<y1&&y1<b+d)||(l-d<x1&&x1<r+d&&t-d<y2&&y2<b+d)||(l-d<x2&&x2<r+d&&t-d<y1&&y1<b+d)||(l-d<x2&&x2<r+d&&t-d<y2&&y2<b+d))){if(inst.snapElements[i].snapping)(inst.options.snap.release&&inst.options.snap.release.call(inst.element,event,$.extend(inst._uiHash(),{snapItem:inst.snapElements[i].item})));inst.snapElements[i].snapping=false;continue;}
if(o.snapMode!='inner'){var ts=Math.abs(t-y2)<=d;var bs=Math.abs(b-y1)<=d;var ls=Math.abs(l-x2)<=d;var rs=Math.abs(r-x1)<=d;if(ts)ui.position.top=inst._convertPositionTo("relative",{top:t-inst.helperProportions.height,left:0}).top-inst.margins.top;if(bs)ui.position.top=inst._convertPositionTo("relative",{top:b,left:0}).top-inst.margins.top;if(ls)ui.position.left=inst._convertPositionTo("relative",{top:0,left:l-inst.helperProportions.width}).left-inst.margins.left;if(rs)ui.position.left=inst._convertPositionTo("relative",{top:0,left:r}).left-inst.margins.left;}
var first=(ts||bs||ls||rs);if(o.snapMode!='outer'){var ts=Math.abs(t-y1)<=d;var bs=Math.abs(b-y2)<=d;var ls=Math.abs(l-x1)<=d;var rs=Math.abs(r-x2)<=d;if(ts)ui.position.top=inst._convertPositionTo("relative",{top:t,left:0}).top-inst.margins.top;if(bs)ui.position.top=inst._convertPositionTo("relative",{top:b-inst.helperProportions.height,left:0}).top-inst.margins.top;if(ls)ui.position.left=inst._convertPositionTo("relative",{top:0,left:l}).left-inst.margins.left;if(rs)ui.position.left=inst._convertPositionTo("relative",{top:0,left:r-inst.helperProportions.width}).left-inst.margins.left;}
if(!inst.snapElements[i].snapping&&(ts||bs||ls||rs||first))
(inst.options.snap.snap&&inst.options.snap.snap.call(inst.element,event,$.extend(inst._uiHash(),{snapItem:inst.snapElements[i].item})));inst.snapElements[i].snapping=(ts||bs||ls||rs||first);};}});$.ui.plugin.add("draggable","stack",{start:function(event,ui){var o=$(this).data("draggable").options;var group=$.makeArray($(o.stack)).sort(function(a,b){return(parseInt($(a).css("zIndex"),10)||0)-(parseInt($(b).css("zIndex"),10)||0);});if(!group.length){return;}
var min=parseInt(group[0].style.zIndex)||0;$(group).each(function(i){this.style.zIndex=min+i;});this[0].style.zIndex=min+group.length;}});$.ui.plugin.add("draggable","zIndex",{start:function(event,ui){var t=$(ui.helper),o=$(this).data("draggable").options;if(t.css("zIndex"))o._zIndex=t.css("zIndex");t.css('zIndex',o.zIndex);},stop:function(event,ui){var o=$(this).data("draggable").options;if(o._zIndex)$(ui.helper).css('zIndex',o._zIndex);}});})(jQuery);(function($,undefined){$.widget("ui.droppable",{version:"1.9m6",widgetEventPrefix:"drop",options:{accept:'*',activeClass:false,addClasses:true,greedy:false,hoverClass:false,scope:'default',tolerance:'intersect'},_create:function(){var o=this.options,accept=o.accept;this.isover=0;this.isout=1;this.accept=$.isFunction(accept)?accept:function(d){return d.is(accept);};this.proportions={width:this.element[0].offsetWidth,height:this.element[0].offsetHeight};$.ui.ddmanager.droppables[o.scope]=$.ui.ddmanager.droppables[o.scope]||[];$.ui.ddmanager.droppables[o.scope].push(this);(o.addClasses&&this.element.addClass("ui-droppable"));},destroy:function(){var drop=$.ui.ddmanager.droppables[this.options.scope];for(var i=0;i<drop.length;i++)
if(drop[i]==this)
drop.splice(i,1);this.element.removeClass("ui-droppable ui-droppable-disabled").removeData("droppable").unbind(".droppable");return this;},_setOption:function(key,value){if(key=='accept'){this.accept=$.isFunction(value)?value:function(d){return d.is(value);};}
$.Widget.prototype._setOption.apply(this,arguments);},_activate:function(event){var draggable=$.ui.ddmanager.current;if(this.options.activeClass)this.element.addClass(this.options.activeClass);(draggable&&this._trigger('activate',event,this.ui(draggable)));},_deactivate:function(event){var draggable=$.ui.ddmanager.current;if(this.options.activeClass)this.element.removeClass(this.options.activeClass);(draggable&&this._trigger('deactivate',event,this.ui(draggable)));},_over:function(event){var draggable=$.ui.ddmanager.current;if(!draggable||(draggable.currentItem||draggable.element)[0]==this.element[0])return;if(this.accept.call(this.element[0],(draggable.currentItem||draggable.element))){if(this.options.hoverClass)this.element.addClass(this.options.hoverClass);this._trigger('over',event,this.ui(draggable));}},_out:function(event){var draggable=$.ui.ddmanager.current;if(!draggable||(draggable.currentItem||draggable.element)[0]==this.element[0])return;if(this.accept.call(this.element[0],(draggable.currentItem||draggable.element))){if(this.options.hoverClass)this.element.removeClass(this.options.hoverClass);this._trigger('out',event,this.ui(draggable));}},_drop:function(event,custom){var draggable=custom||$.ui.ddmanager.current;if(!draggable||(draggable.currentItem||draggable.element)[0]==this.element[0])return false;var childrenIntersection=false;this.element.find(":data(droppable)").not(".ui-draggable-dragging").each(function(){var inst=$.data(this,'droppable');if(inst.options.greedy&&!inst.options.disabled&&inst.options.scope==draggable.options.scope&&inst.accept.call(inst.element[0],(draggable.currentItem||draggable.element))&&$.ui.intersect(draggable,$.extend(inst,{offset:inst.element.offset()}),inst.options.tolerance)){childrenIntersection=true;return false;}});if(childrenIntersection)return false;if(this.accept.call(this.element[0],(draggable.currentItem||draggable.element))){if(this.options.activeClass)this.element.removeClass(this.options.activeClass);if(this.options.hoverClass)this.element.removeClass(this.options.hoverClass);this._trigger('drop',event,this.ui(draggable));return this.element;}
return false;},ui:function(c){return{draggable:(c.currentItem||c.element),helper:c.helper,position:c.position,offset:c.positionAbs};}});$.ui.intersect=function(draggable,droppable,toleranceMode){if(!droppable.offset)return false;var x1=(draggable.positionAbs||draggable.position.absolute).left,x2=x1+draggable.helperProportions.width,y1=(draggable.positionAbs||draggable.position.absolute).top,y2=y1+draggable.helperProportions.height;var l=droppable.offset.left,r=l+droppable.proportions.width,t=droppable.offset.top,b=t+droppable.proportions.height;switch(toleranceMode){case'fit':return(l<=x1&&x2<=r&&t<=y1&&y2<=b);break;case'intersect':return(l<x1+(draggable.helperProportions.width/2)&&x2-(draggable.helperProportions.width/2)<r&&t<y1+(draggable.helperProportions.height/2)&&y2-(draggable.helperProportions.height/2)<b);break;case'pointer':var draggableLeft=((draggable.positionAbs||draggable.position.absolute).left+(draggable.clickOffset||draggable.offset.click).left),draggableTop=((draggable.positionAbs||draggable.position.absolute).top+(draggable.clickOffset||draggable.offset.click).top),isOver=$.ui.isOver(draggableTop,draggableLeft,t,l,droppable.proportions.height,droppable.proportions.width);return isOver;break;case'touch':return((y1>=t&&y1<=b)||(y2>=t&&y2<=b)||(y1<t&&y2>b))&&((x1>=l&&x1<=r)||(x2>=l&&x2<=r)||(x1<l&&x2>r));break;default:return false;break;}};$.ui.ddmanager={current:null,droppables:{'default':[]},prepareOffsets:function(t,event){var m=$.ui.ddmanager.droppables[t.options.scope]||[];var type=event?event.type:null;var list=(t.currentItem||t.element).find(":data(droppable)").andSelf();droppablesLoop:for(var i=0;i<m.length;i++){if(m[i].options.disabled||(t&&!m[i].accept.call(m[i].element[0],(t.currentItem||t.element))))continue;for(var j=0;j<list.length;j++){if(list[j]==m[i].element[0]){m[i].proportions.height=0;continue droppablesLoop;}};m[i].visible=m[i].element.css("display")!="none";if(!m[i].visible)continue;if(type=="mousedown")m[i]._activate.call(m[i],event);m[i].offset=m[i].element.offset();m[i].proportions={width:m[i].element[0].offsetWidth,height:m[i].element[0].offsetHeight};}},drop:function(draggable,event){var dropped=false;$.each($.ui.ddmanager.droppables[draggable.options.scope]||[],function(){if(!this.options)return;if(!this.options.disabled&&this.visible&&$.ui.intersect(draggable,this,this.options.tolerance))
dropped=dropped||this._drop.call(this,event);if(!this.options.disabled&&this.visible&&this.accept.call(this.element[0],(draggable.currentItem||draggable.element))){this.isout=1;this.isover=0;this._deactivate.call(this,event);}});return dropped;},dragStart:function(draggable,event){draggable.element.parentsUntil("body").bind("scroll.droppable",function(){if(!draggable.options.refreshPositions)$.ui.ddmanager.prepareOffsets(draggable,event);});},drag:function(draggable,event){if(draggable.options.refreshPositions)$.ui.ddmanager.prepareOffsets(draggable,event);$.each($.ui.ddmanager.droppables[draggable.options.scope]||[],function(){if(this.options.disabled||this.greedyChild||!this.visible)return;var intersects=$.ui.intersect(draggable,this,this.options.tolerance);var c=!intersects&&this.isover==1?'isout':(intersects&&this.isover==0?'isover':null);if(!c)return;var parentInstance;if(this.options.greedy){var parent=this.element.parents(':data(droppable):eq(0)');if(parent.length){parentInstance=$.data(parent[0],'droppable');parentInstance.greedyChild=(c=='isover'?1:0);}}
if(parentInstance&&c=='isover'){parentInstance['isover']=0;parentInstance['isout']=1;parentInstance._out.call(parentInstance,event);}
this[c]=1;this[c=='isout'?'isover':'isout']=0;this[c=="isover"?"_over":"_out"].call(this,event);if(parentInstance&&c=='isout'){parentInstance['isout']=0;parentInstance['isover']=1;parentInstance._over.call(parentInstance,event);}});},dragStop:function(draggable,event){draggable.element.parentsUntil("body").unbind("scroll.droppable");if(!draggable.options.refreshPositions)$.ui.ddmanager.prepareOffsets(draggable,event);}};})(jQuery);(function($,undefined){$.widget("ui.resizable",$.ui.mouse,{version:"1.9m6",widgetEventPrefix:"resize",options:{alsoResize:false,animate:false,animateDuration:"slow",animateEasing:"swing",aspectRatio:false,autoHide:false,containment:false,ghost:false,grid:false,handles:"e,s,se",helper:false,maxHeight:null,maxWidth:null,minHeight:10,minWidth:10,zIndex:1000},_create:function(){var self=this,o=this.options;this.element.addClass("ui-resizable");$.extend(this,{_aspectRatio:!!(o.aspectRatio),aspectRatio:o.aspectRatio,originalElement:this.element,_proportionallyResizeElements:[],_helper:o.helper||o.ghost||o.animate?o.helper||'ui-resizable-helper':null});if(this.element[0].nodeName.match(/canvas|textarea|input|select|button|img/i)){if(/relative/.test(this.element.css('position'))&&$.browser.opera)
this.element.css({position:'relative',top:'auto',left:'auto'});this.element.wrap($('<div class="ui-wrapper" style="overflow: hidden;"></div>').css({position:this.element.css('position'),width:this.element.outerWidth(),height:this.element.outerHeight(),top:this.element.css('top'),left:this.element.css('left')}));this.element=this.element.parent().data("resizable",this.element.data('resizable'));this.elementIsWrapper=true;this.element.css({marginLeft:this.originalElement.css("marginLeft"),marginTop:this.originalElement.css("marginTop"),marginRight:this.originalElement.css("marginRight"),marginBottom:this.originalElement.css("marginBottom")});this.originalElement.css({marginLeft:0,marginTop:0,marginRight:0,marginBottom:0});this.originalResizeStyle=this.originalElement.css('resize');this.originalElement.css('resize','none');this._proportionallyResizeElements.push(this.originalElement.css({position:'static',zoom:1,display:'block'}));this.originalElement.css({margin:this.originalElement.css('margin')});this._proportionallyResize();}
this.handles=o.handles||(!$('.ui-resizable-handle',this.element).length?"e,s,se":{n:'.ui-resizable-n',e:'.ui-resizable-e',s:'.ui-resizable-s',w:'.ui-resizable-w',se:'.ui-resizable-se',sw:'.ui-resizable-sw',ne:'.ui-resizable-ne',nw:'.ui-resizable-nw'});if(this.handles.constructor==String){if(this.handles=='all')this.handles='n,e,s,w,se,sw,ne,nw';var n=this.handles.split(",");this.handles={};for(var i=0;i<n.length;i++){var handle=$.trim(n[i]),hname='ui-resizable-'+handle;var axis=$('<div class="ui-resizable-handle '+hname+'"></div>');if(/sw|se|ne|nw/.test(handle))axis.css({zIndex:++o.zIndex});if('se'==handle){axis.addClass('ui-icon ui-icon-gripsmall-diagonal-se');};this.handles[handle]='.ui-resizable-'+handle;this.element.append(axis);}}
this._renderAxis=function(target){target=target||this.element;for(var i in this.handles){if(this.handles[i].constructor==String)
this.handles[i]=$(this.handles[i],this.element).show();if(this.elementIsWrapper&&this.originalElement[0].nodeName.match(/textarea|input|select|button/i)){var axis=$(this.handles[i],this.element),padWrapper=0;padWrapper=/sw|ne|nw|se|n|s/.test(i)?axis.outerHeight():axis.outerWidth();var padPos=['padding',/ne|nw|n/.test(i)?'Top':/se|sw|s/.test(i)?'Bottom':/^e$/.test(i)?'Right':'Left'].join("");target.css(padPos,padWrapper);this._proportionallyResize();}
if(!$(this.handles[i]).length)
continue;}};this._renderAxis(this.element);this._handles=$('.ui-resizable-handle',this.element).disableSelection();this._handles.mouseover(function(){if(!self.resizing){if(this.className)
var axis=this.className.match(/ui-resizable-(se|sw|ne|nw|n|e|s|w)/i);self.axis=axis&&axis[1]?axis[1]:'se';}});if(o.autoHide){this._handles.hide();$(this.element).addClass("ui-resizable-autohide").hover(function(){if(o.disabled)return;$(this).removeClass("ui-resizable-autohide");self._handles.show();},function(){if(o.disabled)return;if(!self.resizing){$(this).addClass("ui-resizable-autohide");self._handles.hide();}});}
this._mouseInit();},destroy:function(){this._mouseDestroy();var _destroy=function(exp){$(exp).removeClass("ui-resizable ui-resizable-disabled ui-resizable-resizing").removeData("resizable").unbind(".resizable").find('.ui-resizable-handle').remove();};if(this.elementIsWrapper){_destroy(this.element);var wrapper=this.element;wrapper.after(this.originalElement.css({position:wrapper.css('position'),width:wrapper.outerWidth(),height:wrapper.outerHeight(),top:wrapper.css('top'),left:wrapper.css('left')})).remove();}
this.originalElement.css('resize',this.originalResizeStyle);_destroy(this.originalElement);return this;},_mouseCapture:function(event){var handle=false;for(var i in this.handles){if($(this.handles[i])[0]==event.target){handle=true;}}
return!this.options.disabled&&handle;},_mouseStart:function(event){var o=this.options,iniPos=this.element.position(),el=this.element;this.resizing=true;this.documentScroll={top:$(document).scrollTop(),left:$(document).scrollLeft()};if(el.is('.ui-draggable')||(/absolute/).test(el.css('position'))){el.css({position:'absolute',top:iniPos.top,left:iniPos.left});}
if($.browser.opera&&(/relative/).test(el.css('position')))
el.css({position:'relative',top:'auto',left:'auto'});this._renderProxy();var curleft=num(this.helper.css('left')),curtop=num(this.helper.css('top'));if(o.containment){curleft+=$(o.containment).scrollLeft()||0;curtop+=$(o.containment).scrollTop()||0;}
this.offset=this.helper.offset();this.position={left:curleft,top:curtop};this.size=this._helper?{width:el.outerWidth(),height:el.outerHeight()}:{width:el.width(),height:el.height()};this.originalSize=this._helper?{width:el.outerWidth(),height:el.outerHeight()}:{width:el.width(),height:el.height()};this.originalPosition={left:curleft,top:curtop};this.sizeDiff={width:el.outerWidth()-el.width(),height:el.outerHeight()-el.height()};this.originalMousePosition={left:event.pageX,top:event.pageY};this.aspectRatio=(typeof o.aspectRatio=='number')?o.aspectRatio:((this.originalSize.width/this.originalSize.height)||1);var cursor=$('.ui-resizable-'+this.axis).css('cursor');$('body').css('cursor',cursor=='auto'?this.axis+'-resize':cursor);el.addClass("ui-resizable-resizing");this._propagate("start",event);return true;},_mouseDrag:function(event){var el=this.helper,o=this.options,props={},self=this,smp=this.originalMousePosition,a=this.axis;var dx=(event.pageX-smp.left)||0,dy=(event.pageY-smp.top)||0;var trigger=this._change[a];if(!trigger)return false;var data=trigger.apply(this,[event,dx,dy]),ie6=$.browser.msie&&$.browser.version<7,csdif=this.sizeDiff;this._updateVirtualBoundaries(event.shiftKey);if(this._aspectRatio||event.shiftKey)
data=this._updateRatio(data,event);data=this._respectSize(data,event);this._propagate("resize",event);el.css({top:this.position.top+"px",left:this.position.left+"px",width:this.size.width+"px",height:this.size.height+"px"});if(!this._helper&&this._proportionallyResizeElements.length)
this._proportionallyResize();this._updateCache(data);this._trigger('resize',event,this.ui());return false;},_mouseStop:function(event){this.resizing=false;var o=this.options,self=this;if(this._helper){var pr=this._proportionallyResizeElements,ista=pr.length&&(/textarea/i).test(pr[0].nodeName),soffseth=ista&&$.ui.hasScroll(pr[0],'left')?0:self.sizeDiff.height,soffsetw=ista?0:self.sizeDiff.width;var s={width:(self.helper.width()-soffsetw),height:(self.helper.height()-soffseth)},left=(parseInt(self.element.css('left'),10)+(self.position.left-self.originalPosition.left))||null,top=(parseInt(self.element.css('top'),10)+(self.position.top-self.originalPosition.top))||null;if(!o.animate)
this.element.css($.extend(s,{top:top,left:left}));self.helper.height(self.size.height);self.helper.width(self.size.width);if(this._helper&&!o.animate)this._proportionallyResize();}
$('body').css('cursor','auto');this.element.removeClass("ui-resizable-resizing");this._propagate("stop",event);if(this._helper)this.helper.remove();return false;},_updateVirtualBoundaries:function(forceAspectRatio){var o=this.options,pMinWidth,pMaxWidth,pMinHeight,pMaxHeight,b;b={minWidth:isNumber(o.minWidth)?o.minWidth:0,maxWidth:isNumber(o.maxWidth)?o.maxWidth:Infinity,minHeight:isNumber(o.minHeight)?o.minHeight:0,maxHeight:isNumber(o.maxHeight)?o.maxHeight:Infinity};if(this._aspectRatio||forceAspectRatio){pMinWidth=b.minHeight*this.aspectRatio;pMinHeight=b.minWidth/this.aspectRatio;pMaxWidth=b.maxHeight*this.aspectRatio;pMaxHeight=b.maxWidth/this.aspectRatio;if(pMinWidth>b.minWidth)b.minWidth=pMinWidth;if(pMinHeight>b.minHeight)b.minHeight=pMinHeight;if(pMaxWidth<b.maxWidth)b.maxWidth=pMaxWidth;if(pMaxHeight<b.maxHeight)b.maxHeight=pMaxHeight;}
this._vBoundaries=b;},_updateCache:function(data){var o=this.options;this.offset=this.helper.offset();if(isNumber(data.left))this.position.left=data.left;if(isNumber(data.top))this.position.top=data.top;if(isNumber(data.height))this.size.height=data.height;if(isNumber(data.width))this.size.width=data.width;},_updateRatio:function(data,event){var o=this.options,cpos=this.position,csize=this.size,a=this.axis;if(isNumber(data.height))data.width=(data.height*this.aspectRatio);else if(isNumber(data.width))data.height=(data.width/this.aspectRatio);if(a=='sw'){data.left=cpos.left+(csize.width-data.width);data.top=null;}
if(a=='nw'){data.top=cpos.top+(csize.height-data.height);data.left=cpos.left+(csize.width-data.width);}
return data;},_respectSize:function(data,event){var el=this.helper,o=this._vBoundaries,pRatio=this._aspectRatio||event.shiftKey,a=this.axis,ismaxw=isNumber(data.width)&&o.maxWidth&&(o.maxWidth<data.width),ismaxh=isNumber(data.height)&&o.maxHeight&&(o.maxHeight<data.height),isminw=isNumber(data.width)&&o.minWidth&&(o.minWidth>data.width),isminh=isNumber(data.height)&&o.minHeight&&(o.minHeight>data.height);if(isminw)data.width=o.minWidth;if(isminh)data.height=o.minHeight;if(ismaxw)data.width=o.maxWidth;if(ismaxh)data.height=o.maxHeight;var dw=this.originalPosition.left+this.originalSize.width,dh=this.position.top+this.size.height;var cw=/sw|nw|w/.test(a),ch=/nw|ne|n/.test(a);if(isminw&&cw)data.left=dw-o.minWidth;if(ismaxw&&cw)data.left=dw-o.maxWidth;if(isminh&&ch)data.top=dh-o.minHeight;if(ismaxh&&ch)data.top=dh-o.maxHeight;var isNotwh=!data.width&&!data.height;if(isNotwh&&!data.left&&data.top)data.top=null;else if(isNotwh&&!data.top&&data.left)data.left=null;return data;},_proportionallyResize:function(){var o=this.options;if(!this._proportionallyResizeElements.length)return;var element=this.helper||this.element;for(var i=0;i<this._proportionallyResizeElements.length;i++){var prel=this._proportionallyResizeElements[i];if(!this.borderDif){var b=[prel.css('borderTopWidth'),prel.css('borderRightWidth'),prel.css('borderBottomWidth'),prel.css('borderLeftWidth')],p=[prel.css('paddingTop'),prel.css('paddingRight'),prel.css('paddingBottom'),prel.css('paddingLeft')];this.borderDif=$.map(b,function(v,i){var border=parseInt(v,10)||0,padding=parseInt(p[i],10)||0;return border+padding;});}
if($.browser.msie&&!(!($(element).is(':hidden')||$(element).parents(':hidden').length)))
continue;prel.css({height:(element.height()-this.borderDif[0]-this.borderDif[2])||0,width:(element.width()-this.borderDif[1]-this.borderDif[3])||0});};},_renderProxy:function(){var el=this.element,o=this.options;this.elementOffset=el.offset();if(this._helper){this.helper=this.helper||$('<div style="overflow:hidden;"></div>');var ie6=$.browser.msie&&$.browser.version<7,ie6offset=(ie6?1:0),pxyoffset=(ie6?2:-1);this.helper.addClass(this._helper).css({width:this.element.outerWidth()+pxyoffset,height:this.element.outerHeight()+pxyoffset,position:'absolute',left:this.elementOffset.left-ie6offset+'px',top:this.elementOffset.top-ie6offset+'px',zIndex:++o.zIndex});this.helper.appendTo("body").disableSelection();}else{this.helper=this.element;}},_change:{e:function(event,dx,dy){return{width:this.originalSize.width+dx};},w:function(event,dx,dy){var o=this.options,cs=this.originalSize,sp=this.originalPosition;return{left:sp.left+dx,width:cs.width-dx};},n:function(event,dx,dy){var o=this.options,cs=this.originalSize,sp=this.originalPosition;return{top:sp.top+dy,height:cs.height-dy};},s:function(event,dx,dy){return{height:this.originalSize.height+dy};},se:function(event,dx,dy){return $.extend(this._change.s.apply(this,arguments),this._change.e.apply(this,[event,dx,dy]));},sw:function(event,dx,dy){return $.extend(this._change.s.apply(this,arguments),this._change.w.apply(this,[event,dx,dy]));},ne:function(event,dx,dy){return $.extend(this._change.n.apply(this,arguments),this._change.e.apply(this,[event,dx,dy]));},nw:function(event,dx,dy){return $.extend(this._change.n.apply(this,arguments),this._change.w.apply(this,[event,dx,dy]));}},_propagate:function(n,event){$.ui.plugin.call(this,n,[event,this.ui()]);(n!="resize"&&this._trigger(n,event,this.ui()));},plugins:{},ui:function(){return{originalElement:this.originalElement,element:this.element,helper:this.helper,position:this.position,size:this.size,originalSize:this.originalSize,originalPosition:this.originalPosition};}});$.ui.plugin.add("resizable","alsoResize",{start:function(event,ui){var self=$(this).data("resizable"),o=self.options;var _store=function(exp){$(exp).each(function(){var el=$(this);el.data("resizable-alsoresize",{width:parseInt(el.width(),10),height:parseInt(el.height(),10),left:parseInt(el.css('left'),10),top:parseInt(el.css('top'),10),position:el.css('position')});});};if(typeof(o.alsoResize)=='object'&&!o.alsoResize.parentNode){if(o.alsoResize.length){o.alsoResize=o.alsoResize[0];_store(o.alsoResize);}
else{$.each(o.alsoResize,function(exp){_store(exp);});}}else{_store(o.alsoResize);}},resize:function(event,ui){var self=$(this).data("resizable"),o=self.options,os=self.originalSize,op=self.originalPosition;var delta={height:(self.size.height-os.height)||0,width:(self.size.width-os.width)||0,top:(self.position.top-op.top)||0,left:(self.position.left-op.left)||0},_alsoResize=function(exp,c){$(exp).each(function(){var el=$(this),start=$(this).data("resizable-alsoresize"),style={},css=c&&c.length?c:el.parents(ui.originalElement[0]).length?['width','height']:['width','height','top','left'];$.each(css,function(i,prop){var sum=(start[prop]||0)+(delta[prop]||0);if(sum&&sum>=0)
style[prop]=sum||null;});if($.browser.opera&&/relative/.test(el.css('position'))){self._revertToRelativePosition=true;el.css({position:'absolute',top:'auto',left:'auto'});}
el.css(style);});};if(typeof(o.alsoResize)=='object'&&!o.alsoResize.nodeType){$.each(o.alsoResize,function(exp,c){_alsoResize(exp,c);});}else{_alsoResize(o.alsoResize);}},stop:function(event,ui){var self=$(this).data("resizable"),o=self.options;var _reset=function(exp){$(exp).each(function(){var el=$(this);el.css({position:el.data("resizable-alsoresize").position});});};if(self._revertToRelativePosition){self._revertToRelativePosition=false;if(typeof(o.alsoResize)=='object'&&!o.alsoResize.nodeType){$.each(o.alsoResize,function(exp){_reset(exp);});}else{_reset(o.alsoResize);}}
$(this).removeData("resizable-alsoresize");}});$.ui.plugin.add("resizable","animate",{stop:function(event,ui){var self=$(this).data("resizable"),o=self.options;var pr=self._proportionallyResizeElements,ista=pr.length&&(/textarea/i).test(pr[0].nodeName),soffseth=ista&&$.ui.hasScroll(pr[0],'left')?0:self.sizeDiff.height,soffsetw=ista?0:self.sizeDiff.width;var style={width:(self.size.width-soffsetw),height:(self.size.height-soffseth)},left=(parseInt(self.element.css('left'),10)+(self.position.left-self.originalPosition.left))||null,top=(parseInt(self.element.css('top'),10)+(self.position.top-self.originalPosition.top))||null;self.element.animate($.extend(style,top&&left?{top:top,left:left}:{}),{duration:o.animateDuration,easing:o.animateEasing,step:function(){var data={width:parseInt(self.element.css('width'),10),height:parseInt(self.element.css('height'),10),top:parseInt(self.element.css('top'),10),left:parseInt(self.element.css('left'),10)};if(pr&&pr.length)$(pr[0]).css({width:data.width,height:data.height});self._updateCache(data);self._propagate("resize",event);}});}});$.ui.plugin.add("resizable","containment",{start:function(event,ui){var self=$(this).data("resizable"),o=self.options,el=self.element;var oc=o.containment,ce=(oc instanceof $)?oc.get(0):(/parent/.test(oc))?el.parent().get(0):oc;if(!ce)return;self.containerElement=$(ce);if(/document/.test(oc)||oc==document){self.containerOffset={left:0,top:0};self.containerPosition={left:0,top:0};self.parentData={element:$(document),left:0,top:0,width:$(document).width(),height:$(document).height()||document.body.parentNode.scrollHeight};}
else{var element=$(ce),p=[];$(["Top","Right","Left","Bottom"]).each(function(i,name){p[i]=num(element.css("padding"+name));});self.containerOffset=element.offset();self.containerPosition=element.position();self.containerSize={height:(element.innerHeight()-p[3]),width:(element.innerWidth()-p[1])};var co=self.containerOffset,ch=self.containerSize.height,cw=self.containerSize.width,width=($.ui.hasScroll(ce,"left")?ce.scrollWidth:cw),height=($.ui.hasScroll(ce)?ce.scrollHeight:ch);self.parentData={element:ce,left:co.left,top:co.top,width:width,height:height};}},resize:function(event,ui){var self=$(this).data("resizable"),o=self.options,ps=self.containerSize,co=self.containerOffset,cs=self.size,cp=self.position,pRatio=self._aspectRatio||event.shiftKey,cop={top:0,left:0},ce=self.containerElement;if(ce[0]!=document&&(/static/).test(ce.css('position')))cop=co;if(cp.left<(self._helper?co.left:0)){self.size.width=self.size.width+(self._helper?(self.position.left-co.left):(self.position.left-cop.left));if(pRatio)self.size.height=self.size.width/o.aspectRatio;self.position.left=o.helper?co.left:0;}
if(cp.top<(self._helper?co.top:0)){self.size.height=self.size.height+(self._helper?(self.position.top-co.top):self.position.top);if(pRatio)self.size.width=self.size.height*o.aspectRatio;self.position.top=self._helper?co.top:0;}
self.offset.left=self.parentData.left+self.position.left;self.offset.top=self.parentData.top+self.position.top;var woset=Math.abs((self._helper?self.offset.left-cop.left:(self.offset.left-cop.left))+self.sizeDiff.width),hoset=Math.abs((self._helper?self.offset.top-cop.top:(self.offset.top-co.top))+self.sizeDiff.height);var isParent=self.containerElement.get(0)==self.element.parent().get(0),isOffsetRelative=/relative|absolute/.test(self.containerElement.css('position'));if(isParent&&isOffsetRelative)woset-=self.parentData.left;if(woset+self.size.width>=self.parentData.width){self.size.width=self.parentData.width-woset;if(pRatio)self.size.height=self.size.width/self.aspectRatio;}
if(hoset+self.size.height>=self.parentData.height){self.size.height=self.parentData.height-hoset;if(pRatio)self.size.width=self.size.height*self.aspectRatio;}},stop:function(event,ui){var self=$(this).data("resizable"),o=self.options,cp=self.position,co=self.containerOffset,cop=self.containerPosition,ce=self.containerElement;var helper=$(self.helper),ho=helper.offset(),w=helper.outerWidth()-self.sizeDiff.width,h=helper.outerHeight()-self.sizeDiff.height;if(self._helper&&!o.animate&&(/relative/).test(ce.css('position')))
$(this).css({left:ho.left-cop.left-co.left,width:w,height:h});if(self._helper&&!o.animate&&(/static/).test(ce.css('position')))
$(this).css({left:ho.left-cop.left-co.left,width:w,height:h});}});$.ui.plugin.add("resizable","ghost",{start:function(event,ui){var self=$(this).data("resizable"),o=self.options,cs=self.size;self.ghost=self.originalElement.clone();self.ghost.css({opacity:.25,display:'block',position:'relative',height:cs.height,width:cs.width,margin:0,left:0,top:0}).addClass('ui-resizable-ghost').addClass(typeof o.ghost=='string'?o.ghost:'');self.ghost.appendTo(self.helper);},resize:function(event,ui){var self=$(this).data("resizable"),o=self.options;if(self.ghost)self.ghost.css({position:'relative',height:self.size.height,width:self.size.width});},stop:function(event,ui){var self=$(this).data("resizable"),o=self.options;if(self.ghost&&self.helper)self.helper.get(0).removeChild(self.ghost.get(0));}});$.ui.plugin.add("resizable","grid",{resize:function(event,ui){var self=$(this).data("resizable"),o=self.options,cs=self.size,os=self.originalSize,op=self.originalPosition,a=self.axis,ratio=o._aspectRatio||event.shiftKey;o.grid=typeof o.grid=="number"?[o.grid,o.grid]:o.grid;var ox=Math.round((cs.width-os.width)/(o.grid[0]||1))*(o.grid[0]||1),oy=Math.round((cs.height-os.height)/(o.grid[1]||1))*(o.grid[1]||1);if(/^(se|s|e)$/.test(a)){self.size.width=os.width+ox;self.size.height=os.height+oy;}
else if(/^(ne)$/.test(a)){self.size.width=os.width+ox;self.size.height=os.height+oy;self.position.top=op.top-oy;}
else if(/^(sw)$/.test(a)){self.size.width=os.width+ox;self.size.height=os.height+oy;self.position.left=op.left-ox;}
else{self.size.width=os.width+ox;self.size.height=os.height+oy;self.position.top=op.top-oy;self.position.left=op.left-ox;}}});var num=function(v){return parseInt(v,10)||0;};var isNumber=function(value){return!isNaN(parseInt(value,10));};})(jQuery);(function($,undefined){$.widget("ui.selectable",$.ui.mouse,{version:"1.9m6",options:{appendTo:'body',autoRefresh:true,distance:0,filter:'*',tolerance:'touch'},_create:function(){var self=this;this.element.addClass("ui-selectable");this.dragged=false;var selectees;this.refresh=function(){selectees=$(self.options.filter,self.element[0]);selectees.each(function(){var $this=$(this);var pos=$this.offset();$.data(this,"selectable-item",{element:this,$element:$this,left:pos.left,top:pos.top,right:pos.left+$this.outerWidth(),bottom:pos.top+$this.outerHeight(),startselected:false,selected:$this.hasClass('ui-selected'),selecting:$this.hasClass('ui-selecting'),unselecting:$this.hasClass('ui-unselecting')});});};this.refresh();this.selectees=selectees.addClass("ui-selectee");this._mouseInit();this.helper=$("<div class='ui-selectable-helper'></div>");},destroy:function(){this.selectees.removeClass("ui-selectee").removeData("selectable-item");this.element.removeClass("ui-selectable ui-selectable-disabled").removeData("selectable").unbind(".selectable");this._mouseDestroy();return this;},_mouseStart:function(event){var self=this;this.opos=[event.pageX,event.pageY];if(this.options.disabled)
return;var options=this.options;this.selectees=$(options.filter,this.element[0]);this._trigger("start",event);$(options.appendTo).append(this.helper);this.helper.css({"left":event.clientX,"top":event.clientY,"width":0,"height":0});if(options.autoRefresh){this.refresh();}
this.selectees.filter('.ui-selected').each(function(){var selectee=$.data(this,"selectable-item");selectee.startselected=true;if(!event.metaKey){selectee.$element.removeClass('ui-selected');selectee.selected=false;selectee.$element.addClass('ui-unselecting');selectee.unselecting=true;self._trigger("unselecting",event,{unselecting:selectee.element});}});$(event.target).parents().andSelf().each(function(){var selectee=$.data(this,"selectable-item");if(selectee){var doSelect=!event.metaKey||!selectee.$element.hasClass('ui-selected');selectee.$element.removeClass(doSelect?"ui-unselecting":"ui-selected").addClass(doSelect?"ui-selecting":"ui-unselecting");selectee.unselecting=!doSelect;selectee.selecting=doSelect;selectee.selected=doSelect;if(doSelect){self._trigger("selecting",event,{selecting:selectee.element});}else{self._trigger("unselecting",event,{unselecting:selectee.element});}
return false;}});},_mouseDrag:function(event){var self=this;this.dragged=true;if(this.options.disabled)
return;var options=this.options;var x1=this.opos[0],y1=this.opos[1],x2=event.pageX,y2=event.pageY;if(x1>x2){var tmp=x2;x2=x1;x1=tmp;}
if(y1>y2){var tmp=y2;y2=y1;y1=tmp;}
this.helper.css({left:x1,top:y1,width:x2-x1,height:y2-y1});this.selectees.each(function(){var selectee=$.data(this,"selectable-item");if(!selectee||selectee.element==self.element[0])
return;var hit=false;if(options.tolerance=='touch'){hit=(!(selectee.left>x2||selectee.right<x1||selectee.top>y2||selectee.bottom<y1));}else if(options.tolerance=='fit'){hit=(selectee.left>x1&&selectee.right<x2&&selectee.top>y1&&selectee.bottom<y2);}
if(hit){if(selectee.selected){selectee.$element.removeClass('ui-selected');selectee.selected=false;}
if(selectee.unselecting){selectee.$element.removeClass('ui-unselecting');selectee.unselecting=false;}
if(!selectee.selecting){selectee.$element.addClass('ui-selecting');selectee.selecting=true;self._trigger("selecting",event,{selecting:selectee.element});}}else{if(selectee.selecting){if(event.metaKey&&selectee.startselected){selectee.$element.removeClass('ui-selecting');selectee.selecting=false;selectee.$element.addClass('ui-selected');selectee.selected=true;}else{selectee.$element.removeClass('ui-selecting');selectee.selecting=false;if(selectee.startselected){selectee.$element.addClass('ui-unselecting');selectee.unselecting=true;}
self._trigger("unselecting",event,{unselecting:selectee.element});}}
if(selectee.selected){if(!event.metaKey&&!selectee.startselected){selectee.$element.removeClass('ui-selected');selectee.selected=false;selectee.$element.addClass('ui-unselecting');selectee.unselecting=true;self._trigger("unselecting",event,{unselecting:selectee.element});}}}});return false;},_mouseStop:function(event){var self=this;this.dragged=false;var options=this.options;$('.ui-unselecting',this.element[0]).each(function(){var selectee=$.data(this,"selectable-item");selectee.$element.removeClass('ui-unselecting');selectee.unselecting=false;selectee.startselected=false;self._trigger("unselected",event,{unselected:selectee.element});});$('.ui-selecting',this.element[0]).each(function(){var selectee=$.data(this,"selectable-item");selectee.$element.removeClass('ui-selecting').addClass('ui-selected');selectee.selecting=false;selectee.selected=true;selectee.startselected=true;self._trigger("selected",event,{selected:selectee.element});});this._trigger("stop",event);this.helper.remove();return false;}});})(jQuery);(function($,undefined){$.widget("ui.sortable",$.ui.mouse,{version:"1.9m6",widgetEventPrefix:"sort",options:{appendTo:"parent",axis:false,connectWith:false,containment:false,cursor:'auto',cursorAt:false,dropOnEmpty:true,forcePlaceholderSize:false,forceHelperSize:false,grid:false,handle:false,helper:"original",items:'> *',opacity:false,placeholder:false,revert:false,scroll:true,scrollSensitivity:20,scrollSpeed:20,scope:"default",tolerance:"intersect",zIndex:1000},_create:function(){var o=this.options;this.containerCache={};this.element.addClass("ui-sortable");this.refresh();this.floating=this.items.length?o.axis==='x'||(/left|right/).test(this.items[0].item.css('float'))||(/inline|table-cell/).test(this.items[0].item.css('display')):false;this.offset=this.element.offset();this._mouseInit();},destroy:function(){this.element.removeClass("ui-sortable ui-sortable-disabled").removeData("sortable").unbind(".sortable");this._mouseDestroy();for(var i=this.items.length-1;i>=0;i--)
this.items[i].item.removeData("sortable-item");return this;},_setOption:function(key,value){if(key==="disabled"){this.options[key]=value;this.widget().toggleClass("ui-sortable-disabled",!!value);}else{$.Widget.prototype._setOption.apply(this,arguments);}},_mouseCapture:function(event,overrideHandle){if(this.reverting){return false;}
if(this.options.disabled||this.options.type=='static')return false;this._refreshItems(event);var currentItem=null,self=this,nodes=$(event.target).parents().each(function(){if($.data(this,'sortable-item')==self){currentItem=$(this);return false;}});if($.data(event.target,'sortable-item')==self)currentItem=$(event.target);if(!currentItem)return false;if(this.options.handle&&!overrideHandle){var validHandle=false;$(this.options.handle,currentItem).find("*").andSelf().each(function(){if(this==event.target)validHandle=true;});if(!validHandle)return false;}
this.currentItem=currentItem;this._removeCurrentsFromItems();return true;},_mouseStart:function(event,overrideHandle,noActivation){var o=this.options,self=this;this.currentContainer=this;this.refreshPositions();this.helper=this._createHelper(event);this._cacheHelperProportions();this._cacheMargins();this.scrollParent=this.helper.scrollParent();this.offset=this.currentItem.offset();this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left};this.helper.css("position","absolute");this.cssPosition=this.helper.css("position");$.extend(this.offset,{click:{left:event.pageX-this.offset.left,top:event.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()});this.originalPosition=this._generatePosition(event);this.originalPageX=event.pageX;this.originalPageY=event.pageY;(o.cursorAt&&this._adjustOffsetFromHelper(o.cursorAt));this.domPosition={prev:this.currentItem.prev()[0],parent:this.currentItem.parent()[0]};if(this.helper[0]!=this.currentItem[0]){this.currentItem.hide();}
this._createPlaceholder();if(o.containment)
this._setContainment();if(o.cursor){if($('body').css("cursor"))this._storedCursor=$('body').css("cursor");$('body').css("cursor",o.cursor);}
if(o.opacity){if(this.helper.css("opacity"))this._storedOpacity=this.helper.css("opacity");this.helper.css("opacity",o.opacity);}
if(o.zIndex){if(this.helper.css("zIndex"))this._storedZIndex=this.helper.css("zIndex");this.helper.css("zIndex",o.zIndex);}
if(this.scrollParent[0]!=document&&this.scrollParent[0].tagName!='HTML')
this.overflowOffset=this.scrollParent.offset();this._trigger("start",event,this._uiHash());if(!this._preserveHelperProportions)
this._cacheHelperProportions();if(!noActivation){for(var i=this.containers.length-1;i>=0;i--){this.containers[i]._trigger("activate",event,self._uiHash(this));}}
if($.ui.ddmanager)
$.ui.ddmanager.current=this;if($.ui.ddmanager&&!o.dropBehaviour)
$.ui.ddmanager.prepareOffsets(this,event);this.dragging=true;this.helper.addClass("ui-sortable-helper");this._mouseDrag(event);return true;},_mouseDrag:function(event){this.position=this._generatePosition(event);this.positionAbs=this._convertPositionTo("absolute");if(!this.lastPositionAbs){this.lastPositionAbs=this.positionAbs;}
if(this.options.scroll){var o=this.options,scrolled=false;if(this.scrollParent[0]!=document&&this.scrollParent[0].tagName!='HTML'){if((this.overflowOffset.top+this.scrollParent[0].offsetHeight)-event.pageY<o.scrollSensitivity)
this.scrollParent[0].scrollTop=scrolled=this.scrollParent[0].scrollTop+o.scrollSpeed;else if(event.pageY-this.overflowOffset.top<o.scrollSensitivity)
this.scrollParent[0].scrollTop=scrolled=this.scrollParent[0].scrollTop-o.scrollSpeed;if((this.overflowOffset.left+this.scrollParent[0].offsetWidth)-event.pageX<o.scrollSensitivity)
this.scrollParent[0].scrollLeft=scrolled=this.scrollParent[0].scrollLeft+o.scrollSpeed;else if(event.pageX-this.overflowOffset.left<o.scrollSensitivity)
this.scrollParent[0].scrollLeft=scrolled=this.scrollParent[0].scrollLeft-o.scrollSpeed;}else{if(event.pageY-$(document).scrollTop()<o.scrollSensitivity)
scrolled=$(document).scrollTop($(document).scrollTop()-o.scrollSpeed);else if($(window).height()-(event.pageY-$(document).scrollTop())<o.scrollSensitivity)
scrolled=$(document).scrollTop($(document).scrollTop()+o.scrollSpeed);if(event.pageX-$(document).scrollLeft()<o.scrollSensitivity)
scrolled=$(document).scrollLeft($(document).scrollLeft()-o.scrollSpeed);else if($(window).width()-(event.pageX-$(document).scrollLeft())<o.scrollSensitivity)
scrolled=$(document).scrollLeft($(document).scrollLeft()+o.scrollSpeed);}
if(scrolled!==false&&$.ui.ddmanager&&!o.dropBehaviour)
$.ui.ddmanager.prepareOffsets(this,event);}
this.positionAbs=this._convertPositionTo("absolute");if(!this.options.axis||this.options.axis!="y")this.helper[0].style.left=this.position.left+'px';if(!this.options.axis||this.options.axis!="x")this.helper[0].style.top=this.position.top+'px';for(var i=this.items.length-1;i>=0;i--){var item=this.items[i],itemElement=item.item[0],intersection=this._intersectsWithPointer(item);if(!intersection)continue;if(itemElement!=this.currentItem[0]&&this.placeholder[intersection==1?"next":"prev"]()[0]!=itemElement&&!$.contains(this.placeholder[0],itemElement)&&(this.options.type=='semi-dynamic'?!$.contains(this.element[0],itemElement):true)){this.direction=intersection==1?"down":"up";if(this.options.tolerance=="pointer"||this._intersectsWithSides(item)){this._rearrange(event,item);}else{break;}
this._trigger("change",event,this._uiHash());break;}}
this._contactContainers(event);if($.ui.ddmanager)$.ui.ddmanager.drag(this,event);this._trigger('sort',event,this._uiHash());this.lastPositionAbs=this.positionAbs;return false;},_mouseStop:function(event,noPropagation){if(!event)return;if($.ui.ddmanager&&!this.options.dropBehaviour)
$.ui.ddmanager.drop(this,event);if(this.options.revert){var self=this;var cur=self.placeholder.offset();self.reverting=true;$(this.helper).animate({left:cur.left-this.offset.parent.left-self.margins.left+(this.offsetParent[0]==document.body?0:this.offsetParent[0].scrollLeft),top:cur.top-this.offset.parent.top-self.margins.top+(this.offsetParent[0]==document.body?0:this.offsetParent[0].scrollTop)},parseInt(this.options.revert,10)||500,function(){self._clear(event);});}else{this._clear(event,noPropagation);}
return false;},cancel:function(){var self=this;if(this.dragging){this._mouseUp({target:null});if(this.options.helper=="original")
this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper");else
this.currentItem.show();for(var i=this.containers.length-1;i>=0;i--){this.containers[i]._trigger("deactivate",null,self._uiHash(this));if(this.containers[i].containerCache.over){this.containers[i]._trigger("out",null,self._uiHash(this));this.containers[i].containerCache.over=0;}}}
if(this.placeholder){if(this.placeholder[0].parentNode)this.placeholder[0].parentNode.removeChild(this.placeholder[0]);if(this.options.helper!="original"&&this.helper&&this.helper[0].parentNode)this.helper.remove();$.extend(this,{helper:null,dragging:false,reverting:false,_noFinalSort:null});if(this.domPosition.prev){$(this.domPosition.prev).after(this.currentItem);}else{$(this.domPosition.parent).prepend(this.currentItem);}}
return this;},serialize:function(o){var items=this._getItemsAsjQuery(o&&o.connected);var str=[];o=o||{};$(items).each(function(){var res=($(o.item||this).attr(o.attribute||'id')||'').match(o.expression||(/(.+)[-=_](.+)/));if(res)str.push((o.key||res[1]+'[]')+'='+(o.key&&o.expression?res[1]:res[2]));});if(!str.length&&o.key){str.push(o.key+'=');}
return str.join('&');},toArray:function(o){var items=this._getItemsAsjQuery(o&&o.connected);var ret=[];o=o||{};items.each(function(){ret.push($(o.item||this).attr(o.attribute||'id')||'');});return ret;},_intersectsWith:function(item){var x1=this.positionAbs.left,x2=x1+this.helperProportions.width,y1=this.positionAbs.top,y2=y1+this.helperProportions.height;var l=item.left,r=l+item.width,t=item.top,b=t+item.height;var dyClick=this.offset.click.top,dxClick=this.offset.click.left;var isOverElement=(y1+dyClick)>t&&(y1+dyClick)<b&&(x1+dxClick)>l&&(x1+dxClick)<r;if(this.options.tolerance=="pointer"||this.options.forcePointerForContainers||(this.options.tolerance!="pointer"&&this.helperProportions[this.floating?'width':'height']>item[this.floating?'width':'height'])){return isOverElement;}else{return(l<x1+(this.helperProportions.width/2)&&x2-(this.helperProportions.width/2)<r&&t<y1+(this.helperProportions.height/2)&&y2-(this.helperProportions.height/2)<b);}},_intersectsWithPointer:function(item){var isOverElementHeight=$.ui.isOverAxis(this.positionAbs.top+this.offset.click.top,item.top,item.height),isOverElementWidth=$.ui.isOverAxis(this.positionAbs.left+this.offset.click.left,item.left,item.width),isOverElement=isOverElementHeight&&isOverElementWidth,verticalDirection=this._getDragVerticalDirection(),horizontalDirection=this._getDragHorizontalDirection();if(!isOverElement)
return false;return this.floating?(((horizontalDirection&&horizontalDirection=="right")||verticalDirection=="down")?2:1):(verticalDirection&&(verticalDirection=="down"?2:1));},_intersectsWithSides:function(item){var isOverBottomHalf=$.ui.isOverAxis(this.positionAbs.top+this.offset.click.top,item.top+(item.height/2),item.height),isOverRightHalf=$.ui.isOverAxis(this.positionAbs.left+this.offset.click.left,item.left+(item.width/2),item.width),verticalDirection=this._getDragVerticalDirection(),horizontalDirection=this._getDragHorizontalDirection();if(this.floating&&horizontalDirection){return((horizontalDirection=="right"&&isOverRightHalf)||(horizontalDirection=="left"&&!isOverRightHalf));}else{return verticalDirection&&((verticalDirection=="down"&&isOverBottomHalf)||(verticalDirection=="up"&&!isOverBottomHalf));}},_getDragVerticalDirection:function(){var delta=this.positionAbs.top-this.lastPositionAbs.top;return delta!=0&&(delta>0?"down":"up");},_getDragHorizontalDirection:function(){var delta=this.positionAbs.left-this.lastPositionAbs.left;return delta!=0&&(delta>0?"right":"left");},refresh:function(event){this._refreshItems(event);this.refreshPositions();return this;},_connectWith:function(){var options=this.options;return options.connectWith.constructor==String?[options.connectWith]:options.connectWith;},_getItemsAsjQuery:function(connected){var self=this;var items=[];var queries=[];var connectWith=this._connectWith();if(connectWith&&connected){for(var i=connectWith.length-1;i>=0;i--){var cur=$(connectWith[i]);for(var j=cur.length-1;j>=0;j--){var inst=$.data(cur[j],'sortable');if(inst&&inst!=this&&!inst.options.disabled){queries.push([$.isFunction(inst.options.items)?inst.options.items.call(inst.element):$(inst.options.items,inst.element).not(".ui-sortable-helper").not('.ui-sortable-placeholder'),inst]);}};};}
queries.push([$.isFunction(this.options.items)?this.options.items.call(this.element,null,{options:this.options,item:this.currentItem}):$(this.options.items,this.element).not(".ui-sortable-helper").not('.ui-sortable-placeholder'),this]);for(var i=queries.length-1;i>=0;i--){queries[i][0].each(function(){items.push(this);});};return $(items);},_removeCurrentsFromItems:function(){var list=this.currentItem.find(":data(sortable-item)");for(var i=0;i<this.items.length;i++){for(var j=0;j<list.length;j++){if(list[j]==this.items[i].item[0])
this.items.splice(i,1);};};},_refreshItems:function(event){this.items=[];this.containers=[this];var items=this.items;var self=this;var queries=[[$.isFunction(this.options.items)?this.options.items.call(this.element[0],event,{item:this.currentItem}):$(this.options.items,this.element),this]];var connectWith=this._connectWith();if(connectWith){for(var i=connectWith.length-1;i>=0;i--){var cur=$(connectWith[i]);for(var j=cur.length-1;j>=0;j--){var inst=$.data(cur[j],'sortable');if(inst&&inst!=this&&!inst.options.disabled){queries.push([$.isFunction(inst.options.items)?inst.options.items.call(inst.element[0],event,{item:this.currentItem}):$(inst.options.items,inst.element),inst]);this.containers.push(inst);}};};}
for(var i=queries.length-1;i>=0;i--){var targetData=queries[i][1];var _queries=queries[i][0];for(var j=0,queriesLength=_queries.length;j<queriesLength;j++){var item=$(_queries[j]);item.data('sortable-item',targetData);items.push({item:item,instance:targetData,width:0,height:0,left:0,top:0});};};},refreshPositions:function(fast){if(this.offsetParent&&this.helper){this.offset.parent=this._getParentOffset();}
for(var i=this.items.length-1;i>=0;i--){var item=this.items[i];if(item.instance!=this.currentContainer&&this.currentContainer&&item.item[0]!=this.currentItem[0])
continue;var t=this.options.toleranceElement?$(this.options.toleranceElement,item.item):item.item;if(!fast){item.width=t.outerWidth();item.height=t.outerHeight();}
var p=t.offset();item.left=p.left;item.top=p.top;};if(this.options.custom&&this.options.custom.refreshContainers){this.options.custom.refreshContainers.call(this);}else{for(var i=this.containers.length-1;i>=0;i--){var p=this.containers[i].element.offset();this.containers[i].containerCache.left=p.left;this.containers[i].containerCache.top=p.top;this.containers[i].containerCache.width=this.containers[i].element.outerWidth();this.containers[i].containerCache.height=this.containers[i].element.outerHeight();};}
return this;},_createPlaceholder:function(that){var self=that||this,o=self.options;if(!o.placeholder||o.placeholder.constructor==String){var className=o.placeholder;o.placeholder={element:function(){var el=$(document.createElement(self.currentItem[0].nodeName)).addClass(className||self.currentItem[0].className+" ui-sortable-placeholder").removeClass("ui-sortable-helper")[0];if(!className)
el.style.visibility="hidden";return el;},update:function(container,p){if(className&&!o.forcePlaceholderSize)return;if(!p.height()){p.height(self.currentItem.innerHeight()-parseInt(self.currentItem.css('paddingTop')||0,10)-parseInt(self.currentItem.css('paddingBottom')||0,10));};if(!p.width()){p.width(self.currentItem.innerWidth()-parseInt(self.currentItem.css('paddingLeft')||0,10)-parseInt(self.currentItem.css('paddingRight')||0,10));};}};}
self.placeholder=$(o.placeholder.element.call(self.element,self.currentItem));self.currentItem.after(self.placeholder);o.placeholder.update(self,self.placeholder);},_contactContainers:function(event){var innermostContainer=null,innermostIndex=null;for(var i=this.containers.length-1;i>=0;i--){if($.contains(this.currentItem[0],this.containers[i].element[0]))
continue;if(this._intersectsWith(this.containers[i].containerCache)){if(innermostContainer&&$.contains(this.containers[i].element[0],innermostContainer.element[0]))
continue;innermostContainer=this.containers[i];innermostIndex=i;}else{if(this.containers[i].containerCache.over){this.containers[i]._trigger("out",event,this._uiHash(this));this.containers[i].containerCache.over=0;}}}
if(!innermostContainer)return;if(this.containers.length===1){this.containers[innermostIndex]._trigger("over",event,this._uiHash(this));this.containers[innermostIndex].containerCache.over=1;}else if(this.currentContainer!=this.containers[innermostIndex]){var dist=10000;var itemWithLeastDistance=null;var base=this.positionAbs[this.containers[innermostIndex].floating?'left':'top'];for(var j=this.items.length-1;j>=0;j--){if(!$.contains(this.containers[innermostIndex].element[0],this.items[j].item[0]))continue;var cur=this.items[j][this.containers[innermostIndex].floating?'left':'top'];if(Math.abs(cur-base)<dist){dist=Math.abs(cur-base);itemWithLeastDistance=this.items[j];}}
if(!itemWithLeastDistance&&!this.options.dropOnEmpty)
return;this.currentContainer=this.containers[innermostIndex];itemWithLeastDistance?this._rearrange(event,itemWithLeastDistance,null,true):this._rearrange(event,null,this.containers[innermostIndex].element,true);this._trigger("change",event,this._uiHash());this.containers[innermostIndex]._trigger("change",event,this._uiHash(this));this.options.placeholder.update(this.currentContainer,this.placeholder);this.containers[innermostIndex]._trigger("over",event,this._uiHash(this));this.containers[innermostIndex].containerCache.over=1;}},_createHelper:function(event){var o=this.options;var helper=$.isFunction(o.helper)?$(o.helper.apply(this.element[0],[event,this.currentItem])):(o.helper=='clone'?this.currentItem.clone():this.currentItem);if(!helper.parents('body').length)
$(o.appendTo!='parent'?o.appendTo:this.currentItem[0].parentNode)[0].appendChild(helper[0]);if(helper[0]==this.currentItem[0])
this._storedCSS={width:this.currentItem[0].style.width,height:this.currentItem[0].style.height,position:this.currentItem.css("position"),top:this.currentItem.css("top"),left:this.currentItem.css("left")};if(helper[0].style.width==''||o.forceHelperSize)helper.width(this.currentItem.width());if(helper[0].style.height==''||o.forceHelperSize)helper.height(this.currentItem.height());return helper;},_adjustOffsetFromHelper:function(obj){if(typeof obj=='string'){obj=obj.split(' ');}
if($.isArray(obj)){obj={left:+obj[0],top:+obj[1]||0};}
if('left'in obj){this.offset.click.left=obj.left+this.margins.left;}
if('right'in obj){this.offset.click.left=this.helperProportions.width-obj.right+this.margins.left;}
if('top'in obj){this.offset.click.top=obj.top+this.margins.top;}
if('bottom'in obj){this.offset.click.top=this.helperProportions.height-obj.bottom+this.margins.top;}},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var po=this.offsetParent.offset();if(this.cssPosition=='absolute'&&this.scrollParent[0]!=document&&$.contains(this.scrollParent[0],this.offsetParent[0])){po.left+=this.scrollParent.scrollLeft();po.top+=this.scrollParent.scrollTop();}
if((this.offsetParent[0]==document.body)||(this.offsetParent[0].tagName&&this.offsetParent[0].tagName.toLowerCase()=='html'&&$.browser.msie))
po={top:0,left:0};return{top:po.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:po.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)};},_getRelativeOffset:function(){if(this.cssPosition=="relative"){var p=this.currentItem.position();return{top:p.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:p.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()};}else{return{top:0,left:0};}},_cacheMargins:function(){this.margins={left:(parseInt(this.currentItem.css("marginLeft"),10)||0),top:(parseInt(this.currentItem.css("marginTop"),10)||0)};},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()};},_setContainment:function(){var o=this.options;if(o.containment=='parent')o.containment=this.helper[0].parentNode;if(o.containment=='document'||o.containment=='window')this.containment=[0-this.offset.relative.left-this.offset.parent.left,0-this.offset.relative.top-this.offset.parent.top,$(o.containment=='document'?document:window).width()-this.helperProportions.width-this.margins.left,($(o.containment=='document'?document:window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top];if(!(/^(document|window|parent)$/).test(o.containment)){var ce=$(o.containment)[0];var co=$(o.containment).offset();var over=($(ce).css("overflow")!='hidden');this.containment=[co.left+(parseInt($(ce).css("borderLeftWidth"),10)||0)+(parseInt($(ce).css("paddingLeft"),10)||0)-this.margins.left,co.top+(parseInt($(ce).css("borderTopWidth"),10)||0)+(parseInt($(ce).css("paddingTop"),10)||0)-this.margins.top,co.left+(over?Math.max(ce.scrollWidth,ce.offsetWidth):ce.offsetWidth)-(parseInt($(ce).css("borderLeftWidth"),10)||0)-(parseInt($(ce).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left,co.top+(over?Math.max(ce.scrollHeight,ce.offsetHeight):ce.offsetHeight)-(parseInt($(ce).css("borderTopWidth"),10)||0)-(parseInt($(ce).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top];}},_convertPositionTo:function(d,pos){if(!pos)pos=this.position;var mod=d=="absolute"?1:-1;var o=this.options,scroll=this.cssPosition=='absolute'&&!(this.scrollParent[0]!=document&&$.contains(this.scrollParent[0],this.offsetParent[0]))?this.offsetParent:this.scrollParent,scrollIsRootNode=(/(html|body)/i).test(scroll[0].tagName);return{top:(pos.top
+this.offset.relative.top*mod
+this.offset.parent.top*mod
-($.browser.safari&&this.cssPosition=='fixed'?0:(this.cssPosition=='fixed'?-this.scrollParent.scrollTop():(scrollIsRootNode?0:scroll.scrollTop()))*mod)),left:(pos.left
+this.offset.relative.left*mod
+this.offset.parent.left*mod
-($.browser.safari&&this.cssPosition=='fixed'?0:(this.cssPosition=='fixed'?-this.scrollParent.scrollLeft():scrollIsRootNode?0:scroll.scrollLeft())*mod))};},_generatePosition:function(event){var o=this.options,scroll=this.cssPosition=='absolute'&&!(this.scrollParent[0]!=document&&$.contains(this.scrollParent[0],this.offsetParent[0]))?this.offsetParent:this.scrollParent,scrollIsRootNode=(/(html|body)/i).test(scroll[0].tagName);if(this.cssPosition=='relative'&&!(this.scrollParent[0]!=document&&this.scrollParent[0]!=this.offsetParent[0])){this.offset.relative=this._getRelativeOffset();}
var pageX=event.pageX;var pageY=event.pageY;if(this.originalPosition){if(this.containment){if(event.pageX-this.offset.click.left<this.containment[0])pageX=this.containment[0]+this.offset.click.left;if(event.pageY-this.offset.click.top<this.containment[1])pageY=this.containment[1]+this.offset.click.top;if(event.pageX-this.offset.click.left>this.containment[2])pageX=this.containment[2]+this.offset.click.left;if(event.pageY-this.offset.click.top>this.containment[3])pageY=this.containment[3]+this.offset.click.top;}
if(o.grid){var top=this.originalPageY+Math.round((pageY-this.originalPageY)/o.grid[1])*o.grid[1];pageY=this.containment?(!(top-this.offset.click.top<this.containment[1]||top-this.offset.click.top>this.containment[3])?top:(!(top-this.offset.click.top<this.containment[1])?top-o.grid[1]:top+o.grid[1])):top;var left=this.originalPageX+Math.round((pageX-this.originalPageX)/o.grid[0])*o.grid[0];pageX=this.containment?(!(left-this.offset.click.left<this.containment[0]||left-this.offset.click.left>this.containment[2])?left:(!(left-this.offset.click.left<this.containment[0])?left-o.grid[0]:left+o.grid[0])):left;}}
return{top:(pageY
-this.offset.click.top
-this.offset.relative.top
-this.offset.parent.top
+($.browser.safari&&this.cssPosition=='fixed'?0:(this.cssPosition=='fixed'?-this.scrollParent.scrollTop():(scrollIsRootNode?0:scroll.scrollTop())))),left:(pageX
-this.offset.click.left
-this.offset.relative.left
-this.offset.parent.left
+($.browser.safari&&this.cssPosition=='fixed'?0:(this.cssPosition=='fixed'?-this.scrollParent.scrollLeft():scrollIsRootNode?0:scroll.scrollLeft())))};},_rearrange:function(event,i,a,hardRefresh){a?a[0].appendChild(this.placeholder[0]):i.item[0].parentNode.insertBefore(this.placeholder[0],(this.direction=='down'?i.item[0]:i.item[0].nextSibling));this.counter=this.counter?++this.counter:1;var self=this,counter=this.counter;window.setTimeout(function(){if(counter==self.counter)self.refreshPositions(!hardRefresh);},0);},_clear:function(event,noPropagation){this.reverting=false;var delayedTriggers=[],self=this;if(!this._noFinalSort&&this.currentItem.parent().length)this.placeholder.before(this.currentItem);this._noFinalSort=null;if(this.helper[0]==this.currentItem[0]){for(var i in this._storedCSS){if(this._storedCSS[i]=='auto'||this._storedCSS[i]=='static')this._storedCSS[i]='';}
this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper");}else{this.currentItem.show();}
if(this.fromOutside&&!noPropagation)delayedTriggers.push(function(event){this._trigger("receive",event,this._uiHash(this.fromOutside));});if((this.fromOutside||this.domPosition.prev!=this.currentItem.prev().not(".ui-sortable-helper")[0]||this.domPosition.parent!=this.currentItem.parent()[0])&&!noPropagation)delayedTriggers.push(function(event){this._trigger("update",event,this._uiHash());});if(!$.contains(this.element[0],this.currentItem[0])){if(!noPropagation)delayedTriggers.push(function(event){this._trigger("remove",event,this._uiHash());});for(var i=this.containers.length-1;i>=0;i--){if($.contains(this.containers[i].element[0],this.currentItem[0])&&!noPropagation){delayedTriggers.push((function(c){return function(event){c._trigger("receive",event,this._uiHash(this));};}).call(this,this.containers[i]));delayedTriggers.push((function(c){return function(event){c._trigger("update",event,this._uiHash(this));};}).call(this,this.containers[i]));}};};for(var i=this.containers.length-1;i>=0;i--){if(!noPropagation)delayedTriggers.push((function(c){return function(event){c._trigger("deactivate",event,this._uiHash(this));};}).call(this,this.containers[i]));if(this.containers[i].containerCache.over){delayedTriggers.push((function(c){return function(event){c._trigger("out",event,this._uiHash(this));};}).call(this,this.containers[i]));this.containers[i].containerCache.over=0;}}
if(this._storedCursor)$('body').css("cursor",this._storedCursor);if(this._storedOpacity)this.helper.css("opacity",this._storedOpacity);if(this._storedZIndex)this.helper.css("zIndex",this._storedZIndex=='auto'?'':this._storedZIndex);this.dragging=false;if(this.cancelHelperRemoval){if(!noPropagation){this._trigger("beforeStop",event,this._uiHash());for(var i=0;i<delayedTriggers.length;i++){delayedTriggers[i].call(this,event);};this._trigger("stop",event,this._uiHash());}
return false;}
if(!noPropagation)this._trigger("beforeStop",event,this._uiHash());this.placeholder[0].parentNode.removeChild(this.placeholder[0]);if(this.helper[0]!=this.currentItem[0])this.helper.remove();this.helper=null;if(!noPropagation){for(var i=0;i<delayedTriggers.length;i++){delayedTriggers[i].call(this,event);};this._trigger("stop",event,this._uiHash());}
this.fromOutside=false;return true;},_trigger:function(){if($.Widget.prototype._trigger.apply(this,arguments)===false){this.cancel();}},_uiHash:function(inst){var self=inst||this;return{helper:self.helper,placeholder:self.placeholder||$([]),position:self.position,originalPosition:self.originalPosition,offset:self.positionAbs,item:self.currentItem,sender:inst?inst.element:null};}});})(jQuery);;jQuery.effects||(function($,undefined){var backCompat=$.uiBackCompat!==false;$.effects={effect:{}};$.each(["backgroundColor","borderBottomColor","borderLeftColor","borderRightColor","borderTopColor","borderColor","color","outlineColor"],function(i,attr){$.fx.step[attr]=function(fx){if(!fx.colorInit){fx.start=getColor(fx.elem,attr);fx.end=getRGB(fx.end);fx.colorInit=true;}
fx.elem.style[attr]="rgb("+
Math.max(Math.min(parseInt((fx.pos*(fx.end[0]-fx.start[0]))+fx.start[0],10),255),0)+","+
Math.max(Math.min(parseInt((fx.pos*(fx.end[1]-fx.start[1]))+fx.start[1],10),255),0)+","+
Math.max(Math.min(parseInt((fx.pos*(fx.end[2]-fx.start[2]))+fx.start[2],10),255),0)+")";};});function getRGB(color){var result;if(color&&color.constructor===Array&&color.length===3)
return color;if(result=/rgb\(\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*\)/.exec(color))
return[parseInt(result[1],10),parseInt(result[2],10),parseInt(result[3],10)];if(result=/rgb\(\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*\)/.exec(color))
return[parseFloat(result[1])*2.55,parseFloat(result[2])*2.55,parseFloat(result[3])*2.55];if(result=/#([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})/.exec(color))
return[parseInt(result[1],16),parseInt(result[2],16),parseInt(result[3],16)];if(result=/#([a-fA-F0-9])([a-fA-F0-9])([a-fA-F0-9])/.exec(color))
return[parseInt(result[1]+result[1],16),parseInt(result[2]+result[2],16),parseInt(result[3]+result[3],16)];if(result=/rgba\(0, 0, 0, 0\)/.exec(color))
return colors["transparent"];return colors[$.trim(color).toLowerCase()];}
function getColor(elem,attr){var color;do{color=$.curCSS(elem,attr);if(color!=""&&color!=="transparent"||$.nodeName(elem,"body"))
break;attr="backgroundColor";}while(elem=elem.parentNode);return getRGB(color);};var colors={aqua:[0,255,255],azure:[240,255,255],beige:[245,245,220],black:[0,0,0],blue:[0,0,255],brown:[165,42,42],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgrey:[169,169,169],darkgreen:[0,100,0],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkviolet:[148,0,211],fuchsia:[255,0,255],gold:[255,215,0],green:[0,128,0],indigo:[75,0,130],khaki:[240,230,140],lightblue:[173,216,230],lightcyan:[224,255,255],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightyellow:[255,255,224],lime:[0,255,0],magenta:[255,0,255],maroon:[128,0,0],navy:[0,0,128],olive:[128,128,0],orange:[255,165,0],pink:[255,192,203],purple:[128,0,128],violet:[128,0,128],red:[255,0,0],silver:[192,192,192],white:[255,255,255],yellow:[255,255,0],transparent:[255,255,255]};var classAnimationActions=["add","remove","toggle"],shorthandStyles={border:1,borderBottom:1,borderColor:1,borderLeft:1,borderRight:1,borderTop:1,borderWidth:1,margin:1,padding:1},dataSpace="ec.storage.";$.each(["borderLeftStyle","borderRightStyle","borderBottomStyle","borderTopStyle"],function(_,prop){$.fx.step[prop]=function(fx){if(fx.end!=="none"&&!fx.setAttr||fx.pos===1&&!fx.setAttr){jQuery.style(fx.elem,prop,fx.end);fx.setAttr=true;}};});function getElementStyles(){var style=document.defaultView?document.defaultView.getComputedStyle(this,null):this.currentStyle,newStyle={},key,camelCase,len;if(style&&style.length&&style[0]&&style[style[0]]){len=style.length;while(len--){key=style[len];if(typeof style[key]==="string"){newStyle[$.camelCase(key)]=style[key];}}}else{for(key in style){if(typeof style[key]==="string"){newStyle[key]=style[key];}}}
return newStyle;}
function styleDifference(oldStyle,newStyle){var diff={},name,value;for(name in newStyle){value=newStyle[name];if(oldStyle[name]!=value){if(!shorthandStyles[name]){if($.fx.step[name]||!isNaN(parseFloat(value))){diff[name]=value;}}}}
return diff;}
$.effects.animateClass=function(value,duration,easing,callback){var o=$.speed(duration,easing,callback);return this.queue(function(){var animated=$(this),baseClass=animated.attr("class"),finalClass,allAnimations=o.children?animated.find("*").andSelf():animated;allAnimations=allAnimations.map(function(){var el=$(this);return{el:el,originalStyleAttr:el.attr("style")||" ",start:getElementStyles.call(this)};});$.each(classAnimationActions,function(i,action){if(value[action]){animated[action+"Class"](value[action]);}});finalClass=animated.attr("class");allAnimations=allAnimations.map(function(){this.end=getElementStyles.call(this.el[0]);this.diff=styleDifference(this.start,this.end);return this;});animated.attr("class",baseClass);allAnimations=allAnimations.map(function(){var styleInfo=this,dfd=$.Deferred();this.el.animate(this.diff,{duration:o.duration,easing:o.easing,queue:false,complete:function(){dfd.resolve(styleInfo);}});return dfd.promise();});$.when.apply($,allAnimations.get()).done(function(){animated.attr("class",finalClass);$.each(arguments,function(){if(typeof this.el.attr("style")==="object"){this.el.attr("style").cssText="";this.el.attr("style").cssText=this.originalStyleAttr;}else{this.el.attr("style",this.originalStyleAttr);}});o.complete.call(animated[0]);});});};$.fn.extend({_addClass:$.fn.addClass,addClass:function(classNames,speed,easing,callback){return speed?$.effects.animateClass.apply(this,[{add:classNames},speed,easing,callback]):this._addClass(classNames);},_removeClass:$.fn.removeClass,removeClass:function(classNames,speed,easing,callback){return speed?$.effects.animateClass.apply(this,[{remove:classNames},speed,easing,callback]):this._removeClass(classNames);},_toggleClass:$.fn.toggleClass,toggleClass:function(classNames,force,speed,easing,callback){if(typeof force==="boolean"||force===undefined){if(!speed){return this._toggleClass(classNames,force);}else{return $.effects.animateClass.apply(this,[(force?{add:classNames}:{remove:classNames}),speed,easing,callback]);}}else{return $.effects.animateClass.apply(this,[{toggle:classNames},force,speed,easing]);}},switchClass:function(remove,add,speed,easing,callback){return $.effects.animateClass.apply(this,[{add:add,remove:remove},speed,easing,callback]);}});$.extend($.effects,{version:"1.9m6",save:function(element,set){for(var i=0;i<set.length;i++){if(set[i]!==null){element.data(dataSpace+set[i],element[0].style[set[i]]);}}},restore:function(element,set){for(var i=0;i<set.length;i++){if(set[i]!==null){element.css(set[i],element.data(dataSpace+set[i]));}}},setMode:function(el,mode){if(mode==="toggle"){mode=el.is(":hidden")?"show":"hide";}
return mode;},getBaseline:function(origin,original){var y,x;switch(origin[0]){case"top":y=0;break;case"middle":y=0.5;break;case"bottom":y=1;break;default:y=origin[0]/original.height;};switch(origin[1]){case"left":x=0;break;case"center":x=0.5;break;case"right":x=1;break;default:x=origin[1]/original.width;};return{x:x,y:y};},createWrapper:function(element){if(element.parent().is(".ui-effects-wrapper")){return element.parent();}
var props={width:element.outerWidth(true),height:element.outerHeight(true),"float":element.css("float")},wrapper=$("<div></div>").addClass("ui-effects-wrapper").css({fontSize:"100%",background:"transparent",border:"none",margin:0,padding:0}),size={width:element.width(),height:element.height()},active=document.activeElement;element.wrap(wrapper);if(element[0]===active||$.contains(element[0],active)){$(active).focus();}
wrapper=element.parent();if(element.css("position")==="static"){wrapper.css({position:"relative"});element.css({position:"relative"});}else{$.extend(props,{position:element.css("position"),zIndex:element.css("z-index")});$.each(["top","left","bottom","right"],function(i,pos){props[pos]=element.css(pos);if(isNaN(parseInt(props[pos],10))){props[pos]="auto";}});element.css({position:"relative",top:0,left:0,right:"auto",bottom:"auto"});}
element.css(size);return wrapper.css(props).show();},removeWrapper:function(element){var active=document.activeElement;if(element.parent().is(".ui-effects-wrapper")){element.parent().replaceWith(element);if(element[0]===active||$.contains(element[0],active)){$(active).focus();}}
return element;},setTransition:function(element,list,factor,value){value=value||{};$.each(list,function(i,x){var unit=element.cssUnit(x);if(unit[0]>0)value[x]=unit[0]*factor+unit[1];});return value;}});function _normalizeArguments(effect,options,speed,callback){if($.isPlainObject(effect)){return effect;}
effect={effect:effect};if(options===undefined){options={};}
if($.isFunction(options)){callback=options;speed=null;options={};}
if($.type(options)==="number"||$.fx.speeds[options]){callback=speed;speed=options;options={};}
if($.isFunction(speed)){callback=speed;speed=null;}
if(options){$.extend(effect,options);}
speed=speed||options.duration;effect.duration=$.fx.off?0:typeof speed==="number"?speed:speed in $.fx.speeds?$.fx.speeds[speed]:$.fx.speeds._default;effect.complete=callback||options.complete;return effect;}
function standardSpeed(speed){if(!speed||typeof speed==="number"||$.fx.speeds[speed]){return true;}
if(typeof speed==="string"&&!$.effects.effect[speed]){if(backCompat&&$.effects[speed]){return false;}
return true;}
return false;}
$.fn.extend({effect:function(effect,options,speed,callback){var args=_normalizeArguments.apply(this,arguments),mode=args.mode,queue=args.queue,effectMethod=$.effects.effect[args.effect],oldEffectMethod=!effectMethod&&backCompat&&$.effects[args.effect];if($.fx.off||!(effectMethod||oldEffectMethod)){if(mode){return this[mode](args.duration,args.complete);}else{return this.each(function(){if(args.complete){args.complete.call(this);}});}}
function run(next){var elem=$(this),complete=args.complete,mode=args.mode;function done(){if($.isFunction(complete)){complete.call(elem[0]);}
if($.isFunction(next)){next();}}
if(elem.is(":hidden")?mode==="hide":mode==="show"){done();}else{effectMethod.call(elem[0],args,done);}}
if(effectMethod){return queue===false?this.each(run):this.queue(queue||"fx",run);}else{return oldEffectMethod.call(this,{options:args,duration:args.duration,callback:args.complete,mode:args.mode});}},_show:$.fn.show,show:function(speed){if(standardSpeed(speed)){return this._show.apply(this,arguments);}else{var args=_normalizeArguments.apply(this,arguments);args.mode="show";return this.effect.call(this,args);}},_hide:$.fn.hide,hide:function(speed){if(standardSpeed(speed)){return this._hide.apply(this,arguments);}else{var args=_normalizeArguments.apply(this,arguments);args.mode="hide";return this.effect.call(this,args);}},__toggle:$.fn.toggle,toggle:function(speed){if(standardSpeed(speed)||typeof speed==="boolean"||$.isFunction(speed)){return this.__toggle.apply(this,arguments);}else{var args=_normalizeArguments.apply(this,arguments);args.mode="toggle";return this.effect.call(this,args);}},cssUnit:function(key){var style=this.css(key),val=[];$.each(["em","px","%","pt"],function(i,unit){if(style.indexOf(unit)>0)
val=[parseFloat(style),unit];});return val;}});$.easing.jswing=$.easing.swing;$.extend($.easing,{def:"easeOutQuad",swing:function(x,t,b,c,d){return $.easing[$.easing.def](x,t,b,c,d);},easeInQuad:function(x,t,b,c,d){return c*(t/=d)*t+b;},easeOutQuad:function(x,t,b,c,d){return-c*(t/=d)*(t-2)+b;},easeInOutQuad:function(x,t,b,c,d){if((t/=d/2)<1)return c/2*t*t+b;return-c/2*((--t)*(t-2)-1)+b;},easeInCubic:function(x,t,b,c,d){return c*(t/=d)*t*t+b;},easeOutCubic:function(x,t,b,c,d){return c*((t=t/d-1)*t*t+1)+b;},easeInOutCubic:function(x,t,b,c,d){if((t/=d/2)<1)return c/2*t*t*t+b;return c/2*((t-=2)*t*t+2)+b;},easeInQuart:function(x,t,b,c,d){return c*(t/=d)*t*t*t+b;},easeOutQuart:function(x,t,b,c,d){return-c*((t=t/d-1)*t*t*t-1)+b;},easeInOutQuart:function(x,t,b,c,d){if((t/=d/2)<1)return c/2*t*t*t*t+b;return-c/2*((t-=2)*t*t*t-2)+b;},easeInQuint:function(x,t,b,c,d){return c*(t/=d)*t*t*t*t+b;},easeOutQuint:function(x,t,b,c,d){return c*((t=t/d-1)*t*t*t*t+1)+b;},easeInOutQuint:function(x,t,b,c,d){if((t/=d/2)<1)return c/2*t*t*t*t*t+b;return c/2*((t-=2)*t*t*t*t+2)+b;},easeInSine:function(x,t,b,c,d){return-c*Math.cos(t/d*(Math.PI/2))+c+b;},easeOutSine:function(x,t,b,c,d){return c*Math.sin(t/d*(Math.PI/2))+b;},easeInOutSine:function(x,t,b,c,d){return-c/2*(Math.cos(Math.PI*t/d)-1)+b;},easeInExpo:function(x,t,b,c,d){return(t==0)?b:c*Math.pow(2,10*(t/d-1))+b;},easeOutExpo:function(x,t,b,c,d){return(t==d)?b+c:c*(-Math.pow(2,-10*t/d)+1)+b;},easeInOutExpo:function(x,t,b,c,d){if(t==0)return b;if(t==d)return b+c;if((t/=d/2)<1)return c/2*Math.pow(2,10*(t-1))+b;return c/2*(-Math.pow(2,-10* --t)+2)+b;},easeInCirc:function(x,t,b,c,d){return-c*(Math.sqrt(1-(t/=d)*t)-1)+b;},easeOutCirc:function(x,t,b,c,d){return c*Math.sqrt(1-(t=t/d-1)*t)+b;},easeInOutCirc:function(x,t,b,c,d){if((t/=d/2)<1)return-c/2*(Math.sqrt(1-t*t)-1)+b;return c/2*(Math.sqrt(1-(t-=2)*t)+1)+b;},easeInElastic:function(x,t,b,c,d){var s=1.70158,p=d*0.3,a=c;if(t==0)return b;if((t/=d)==1)return b+c;if(a<Math.abs(c)){a=c;s=p/4;}else{s=p/(2*Math.PI)*Math.asin(c/a);}
return-(a*Math.pow(2,10*(t-=1))*Math.sin((t*d-s)*(2*Math.PI)/p))+b;},easeOutElastic:function(x,t,b,c,d){var s=1.70158,p=d*0.3,a=c;if(t==0)return b;if((t/=d)==1)return b+c;if(a<Math.abs(c)){a=c;s=p/4;}else{s=p/(2*Math.PI)*Math.asin(c/a);}
return a*Math.pow(2,-10*t)*Math.sin((t*d-s)*(2*Math.PI)/p)+c+b;},easeInOutElastic:function(x,t,b,c,d){var s=1.70158,p=d*(0.3*1.5),a=c;if(t==0)return b;if((t/=d/2)==2)return b+c;if(a<Math.abs(c)){a=c;s=p/4;}else{s=p/(2*Math.PI)*Math.asin(c/a);}
if(t<1)return-.5*(a*Math.pow(2,10*(t-=1))*Math.sin((t*d-s)*(2*Math.PI)/p))+b;return a*Math.pow(2,-10*(t-=1))*Math.sin((t*d-s)*(2*Math.PI)/p)*.5+c+b;},easeInBack:function(x,t,b,c,d,s){if(s==undefined)s=1.70158;return c*(t/=d)*t*((s+1)*t-s)+b;},easeOutBack:function(x,t,b,c,d,s){if(s==undefined)s=1.70158;return c*((t=t/d-1)*t*((s+1)*t+s)+1)+b;},easeInOutBack:function(x,t,b,c,d,s){if(s==undefined)s=1.70158;if((t/=d/2)<1)return c/2*(t*t*(((s*=1.525)+1)*t-s))+b;return c/2*((t-=2)*t*(((s*=1.525)+1)*t+s)+2)+b;},easeInBounce:function(x,t,b,c,d){return c-$.easing.easeOutBounce(x,d-t,0,c,d)+b;},easeOutBounce:function(x,t,b,c,d){if((t/=d)<(1/2.75)){return c*(7.5625*t*t)+b;}else if(t<(2/2.75)){return c*(7.5625*(t-=(1.5/2.75))*t+.75)+b;}else if(t<(2.5/2.75)){return c*(7.5625*(t-=(2.25/2.75))*t+.9375)+b;}else{return c*(7.5625*(t-=(2.625/2.75))*t+.984375)+b;}},easeInOutBounce:function(x,t,b,c,d){if(t<d/2)return $.easing.easeInBounce(x,t*2,0,c,d)*.5+b;return $.easing.easeOutBounce(x,t*2-d,0,c,d)*.5+c*.5+b;}});})(jQuery);(function($,undefined){var rvertical=/up|down|vertical/,rpositivemotion=/up|left|vertical|horizontal/;$.effects.effect.blind=function(o,done){var el=$(this),props=["position","top","bottom","left","right","height","width"],mode=$.effects.setMode(el,o.mode||"hide"),direction=o.direction||"up",vertical=rvertical.test(direction),ref=vertical?"height":"width",ref2=vertical?"top":"left",motion=rpositivemotion.test(direction),animation={},show=mode==="show",wrapper,distance;if(el.parent().is(".ui-effects-wrapper")){$.effects.save(el.parent(),props);}else{$.effects.save(el,props);}
el.show();wrapper=$.effects.createWrapper(el).css({overflow:"hidden"});distance=wrapper[ref]();animation[ref]=show?distance:0;if(!motion){el.css(vertical?"bottom":"right",0).css(vertical?"top":"left","").css({position:"absolute"});animation[ref2]=show?0:distance;}
if(show){wrapper.css(ref,0);if(!motion){wrapper.css(ref2,distance);}}
wrapper.animate(animation,{duration:o.duration,easing:o.easing,queue:false,complete:function(){if(mode==="hide"){el.hide();}
$.effects.restore(el,props);$.effects.removeWrapper(el);done();}});};})(jQuery);(function($,undefined){$.effects.effect.bounce=function(o,done){var el=$(this),props=["position","top","bottom","left","right","height","width"],mode=$.effects.setMode(el,o.mode||"effect"),hide=mode==="hide",show=mode==="show",direction=o.direction||"up",distance=o.distance,times=o.times||5,anims=times*2+(show||hide?1:0),speed=o.duration/anims,easing=o.easing,ref=(direction==="up"||direction==="down")?"top":"left",motion=(direction==="up"||direction==="left"),i,upAnim,downAnim,queue=el.queue(),queuelen=queue.length;if(show||hide){props.push("opacity");}
$.effects.save(el,props);el.show();$.effects.createWrapper(el);if(!distance){distance=el[ref==="top"?"outerHeight":"outerWidth"]()/3;}
if(show){downAnim={opacity:1};downAnim[ref]=0;el.css("opacity",0).css(ref,motion?-distance*2:distance*2).animate(downAnim,speed,easing);}
if(hide){distance=distance/Math.pow(2,times-1);}
downAnim={};downAnim[ref]=0;for(i=0;i<times;i++){upAnim={};upAnim[ref]=(motion?"-=":"+=")+distance;el.animate(upAnim,speed,easing).animate(downAnim,speed,easing);distance=hide?distance*2:distance/2;}
if(hide){upAnim={opacity:0};upAnim[ref]=(motion?"-=":"+=")+distance;el.animate(upAnim,speed,easing);}
el.queue(function(){if(hide){el.hide();}
$.effects.restore(el,props);$.effects.removeWrapper(el);done();});if(queuelen>1){queue.splice.apply(queue,[1,0].concat(queue.splice(queuelen,anims+1)));}
el.dequeue();};})(jQuery);(function($,undefined){$.effects.effect.clip=function(o,done){var el=$(this),props=["position","top","bottom","left","right","height","width"],mode=$.effects.setMode(el,o.mode||"hide"),show=mode==="show",direction=o.direction||"vertical",vert=direction==="vertical",size=vert?"height":"width",position=vert?"top":"left",animation={},wrapper,animate,distance;$.effects.save(el,props);el.show();wrapper=$.effects.createWrapper(el).css({overflow:"hidden"});animate=(el[0].tagName==="IMG")?wrapper:el;distance=animate[size]();if(show){animate.css(size,0);animate.css(position,distance/2);}
animation[size]=show?distance:0;animation[position]=show?0:distance/2;animate.animate(animation,{queue:false,duration:o.duration,easing:o.easing,complete:function(){if(!show){el.hide();}
$.effects.restore(el,props);$.effects.removeWrapper(el);done();}});};})(jQuery);(function($,undefined){$.effects.effect.drop=function(o,done){var el=$(this),props=["position","top","bottom","left","right","opacity","height","width"],mode=$.effects.setMode(el,o.mode||"hide"),show=mode==="show",direction=o.direction||"left",ref=(direction==="up"||direction==="down")?"top":"left",motion=(direction==="up"||direction==="left")?"pos":"neg",animation={opacity:show?1:0},distance;$.effects.save(el,props);el.show();$.effects.createWrapper(el);distance=o.distance||el[ref=="top"?"outerHeight":"outerWidth"]({margin:true})/2;if(show){el.css("opacity",0).css(ref,motion=="pos"?-distance:distance);}
animation[ref]=(show?(motion==="pos"?"+=":"-="):(motion==="pos"?"-=":"+="))
+distance;el.animate(animation,{queue:false,duration:o.duration,easing:o.easing,complete:function(){mode=="hide"&&el.hide();$.effects.restore(el,props);$.effects.removeWrapper(el);done();}});};})(jQuery);(function($,undefined){$.effects.effect.explode=function(o,done){var rows=o.pieces?Math.round(Math.sqrt(o.pieces)):3,cells=rows,el=$(this),mode=$.effects.setMode(el,o.mode||"hide"),show=mode==="show",offset=el.show().css("visibility","hidden").offset(),width=Math.ceil(el.outerWidth()/cells),height=Math.ceil(el.outerHeight()/rows),pieces=[],i,j,left,top,mx,my;for(i=0;i<rows;i++){top=offset.top+i*height;my=i-(rows-1)/2;for(j=0;j<cells;j++){left=offset.left+j*width;mx=j-(cells-1)/2;el.clone().appendTo("body").wrap("<div></div>").css({position:"absolute",visibility:"visible",left:-j*width,top:-i*height}).parent().addClass("ui-effects-explode").css({position:"absolute",overflow:"hidden",width:width,height:height,left:left+(show?mx*width:0),top:top+(show?my*height:0),opacity:show?0:1}).animate({left:left+(show?0:mx*width),top:top+(show?0:my*height),opacity:show?1:0},o.duration||500,o.easing,childComplete);}}
function childComplete(){pieces.push(this);if(pieces.length==rows*cells){animComplete();}}
function animComplete(){el.css({visibility:"visible"});$(pieces).remove();if(!show){el.hide();}
done();}};})(jQuery);(function($,undefined){$.effects.effect.fade=function(o,done){var el=$(this),mode=$.effects.setMode(el,o.mode||"toggle"),hide=mode==="hide";el.show();el.animate({opacity:hide?0:1},{queue:false,duration:o.duration,easing:o.easing,complete:function(){if(hide){el.hide();}
done();}});};})(jQuery);(function($,undefined){$.effects.effect.fold=function(o,done){var el=$(this),props=["position","top","bottom","left","right","height","width"],mode=$.effects.setMode(el,o.mode||"hide"),show=mode==="show",hide=mode==="hide",size=o.size||15,percent=/([0-9]+)%/.exec(size),horizFirst=!!o.horizFirst,widthFirst=show!=horizFirst,ref=widthFirst?["width","height"]:["height","width"],duration=o.duration/2,wrapper,distance,animation1={},animation2={};$.effects.save(el,props);el.show();wrapper=$.effects.createWrapper(el).css({overflow:"hidden"});distance=widthFirst?[wrapper.width(),wrapper.height()]:[wrapper.height(),wrapper.width()];if(percent){size=parseInt(percent[1],10)/100*distance[hide?0:1];}
if(show){wrapper.css(horizFirst?{height:0,width:size}:{height:size,width:0});}
animation1[ref[0]]=show?distance[0]:size;animation2[ref[1]]=show?distance[1]:0;wrapper.animate(animation1,duration,o.easing).animate(animation2,duration,o.easing,function(){if(hide){el.hide();}
$.effects.restore(el,props);$.effects.removeWrapper(el);done();});};})(jQuery);(function($,undefined){$.effects.effect.highlight=function(o,done){var elem=$(this),props=["backgroundImage","backgroundColor","opacity"],mode=$.effects.setMode(elem,o.mode||"show"),animation={backgroundColor:elem.css("backgroundColor")};if(mode==="hide"){animation.opacity=0;}
$.effects.save(elem,props);elem.show().css({backgroundImage:"none",backgroundColor:o.color||"#ffff99"}).animate(animation,{queue:false,duration:o.duration,easing:o.easing,complete:function(){if(mode==="hide"){elem.hide();}
$.effects.restore(elem,props);done();}});};})(jQuery);(function($,undefined){$.effects.effect.pulsate=function(o,done){var elem=$(this),mode=$.effects.setMode(elem,o.mode||"show"),show=mode==="show",hide=mode==="hide",showhide=(show||mode==="hide"),anims=((o.times||5)*2)+(showhide?1:0),duration=o.duration/anims,animateTo=0,queue=elem.queue(),queuelen=queue.length,i;if(show||!elem.is(":visible")){elem.css("opacity",0).show();animateTo=1;}
for(i=1;i<anims;i++){elem.animate({opacity:animateTo},duration,o.easing);animateTo=1-animateTo;}
elem.animate({opacity:animateTo},duration,o.easing);elem.queue(function(){if(hide){elem.hide();}
done();});if(queuelen>1){queue.splice.apply(queue,[1,0].concat(queue.splice(queuelen,anims+1)));}
elem.dequeue();};})(jQuery);(function($,undefined){$.effects.effect.puff=function(o,done){var elem=$(this),mode=$.effects.setMode(elem,o.mode||"hide"),hide=mode==="hide",percent=parseInt(o.percent,10)||150,factor=percent/100,original={height:elem.height(),width:elem.width()};$.extend(o,{effect:"scale",queue:false,fade:true,mode:mode,complete:done,percent:hide?percent:100,from:hide?original:{height:original.height*factor,width:original.width*factor}});elem.effect(o);};$.effects.effect.scale=function(o,done){var el=$(this),options=$.extend(true,{},o),mode=$.effects.setMode(el,o.mode||"effect"),percent=parseInt(o.percent,10)||(parseInt(o.percent,10)==0?0:(mode=="hide"?0:100)),direction=o.direction||"both",origin=o.origin,original={height:el.height(),width:el.width(),outerHeight:el.outerHeight(),outerWidth:el.outerWidth()},factor={y:direction!="horizontal"?(percent/100):1,x:direction!="vertical"?(percent/100):1};options.effect="size";options.queue=false;options.complete=done;if(mode!="effect"){options.origin=origin||["middle","center"];options.restore=true;}
options.from=o.from||(mode=="show"?{height:0,width:0}:original);options.to={height:original.height*factor.y,width:original.width*factor.x,outerHeight:original.outerHeight*factor.y,outerWidth:original.outerWidth*factor.x};if(options.fade){if(mode=="show"){options.from.opacity=0;options.to.opacity=1;}
if(mode=="hide"){options.from.opacity=1;options.to.opacity=0;}};el.effect(options);};$.effects.effect.size=function(o,done){var el=$(this),props=["position","top","bottom","left","right","width","height","overflow","opacity"],props1=["position","top","bottom","left","right","overflow","opacity"],props2=["width","height","overflow"],cProps=["fontSize"],vProps=["borderTopWidth","borderBottomWidth","paddingTop","paddingBottom"],hProps=["borderLeftWidth","borderRightWidth","paddingLeft","paddingRight"],mode=$.effects.setMode(el,o.mode||"effect"),restore=o.restore||mode!=="effect",scale=o.scale||"both",origin=o.origin||["middle","center"],original,baseline,factor,position=el.css("position"),originalVerticalPositioning=el.css("bottom")!=="auto"?"bottom":"top";originalHorizontalPositioning=el.css("right")!=="auto"?"right":"left";if(mode==="show"){el.show();}
original={height:el.height(),width:el.width(),outerHeight:el.outerHeight(),outerWidth:el.outerWidth()};el.from=o.from||original;el.to=o.to||original;factor={from:{y:el.from.height/original.height,x:el.from.width/original.width},to:{y:el.to.height/original.height,x:el.to.width/original.width}};if(scale=="box"||scale=="both"){if(factor.from.y!==factor.to.y){props=props.concat(vProps);el.from=$.effects.setTransition(el,vProps,factor.from.y,el.from);el.to=$.effects.setTransition(el,vProps,factor.to.y,el.to);};if(factor.from.x!==factor.to.x){props=props.concat(hProps);el.from=$.effects.setTransition(el,hProps,factor.from.x,el.from);el.to=$.effects.setTransition(el,hProps,factor.to.x,el.to);};};if(scale=="content"||scale=="both"){if(factor.from.y!==factor.to.y){props=props.concat(cProps);el.from=$.effects.setTransition(el,cProps,factor.from.y,el.from);el.to=$.effects.setTransition(el,cProps,factor.to.y,el.to);};};$.effects.save(el,restore?props:props1);el.show();$.effects.createWrapper(el);el.css("overflow","hidden").css(el.from);if(origin){baseline=$.effects.getBaseline(origin,original);el.from.top=(original.outerHeight-el.outerHeight())*baseline.y;el.from.left=(original.outerWidth-el.outerWidth())*baseline.x;el.to.top=(original.outerHeight-el.to.outerHeight)*baseline.y;el.to.left=(original.outerWidth-el.to.outerWidth)*baseline.x;}
el.css(el.from);if(scale=="content"||scale=="both"){vProps=vProps.concat(["marginTop","marginBottom"]).concat(cProps);hProps=hProps.concat(["marginLeft","marginRight"]);props2=props.concat(vProps).concat(hProps);el.find("*[width]").each(function(){var child=$(this),c_original={height:child.height(),width:child.width()};if(restore)$.effects.save(child,props2);child.from={height:c_original.height*factor.from.y,width:c_original.width*factor.from.x};child.to={height:c_original.height*factor.to.y,width:c_original.width*factor.to.x};if(factor.from.y!=factor.to.y){child.from=$.effects.setTransition(child,vProps,factor.from.y,child.from);child.to=$.effects.setTransition(child,vProps,factor.to.y,child.to);};if(factor.from.x!=factor.to.x){child.from=$.effects.setTransition(child,hProps,factor.from.x,child.from);child.to=$.effects.setTransition(child,hProps,factor.to.x,child.to);};child.css(child.from);child.animate(child.to,o.duration,o.easing,function(){if(restore)$.effects.restore(child,props2);});});};el.animate(el.to,{queue:false,duration:o.duration,easing:o.easing,complete:function(){if(el.to.opacity===0){el.css("opacity",el.from.opacity);}
if(mode=="hide"){el.hide();}
$.effects.restore(el,restore?props:props1);if(!restore){if(position==="static"){el.css({position:"relative",top:el.to.top,left:el.to.left});}else{$.each([originalVerticalPositioning,originalHorizontalPositioning],function(idx,pos){el.css(pos,function(_,str){var val=parseInt(str,10),toRef=idx?el.to.left:el.to.top,delta=idx?el.to.outerWidth-el.from.outerWidth:el.to.outerHeight-el.from.outerHeight,same=origin[idx]===pos,mid=origin[idx]==="middle"||origin[idx]==="center",direction=pos=="left"||pos=="top";if(str==="auto"){return toRef+"px";}
if(!direction){if(position==="relative"){toRef*=-1;}else if(!mid){toRef-=delta*(same?-1:1);}}
return val+toRef+"px";});});}}
$.effects.removeWrapper(el);done();}});};})(jQuery);(function($,undefined){$.effects.effect.shake=function(o,done){var el=$(this),props=["position","top","bottom","left","right","height","width"],mode=$.effects.setMode(el,o.mode||"effect"),direction=o.direction||"left",distance=o.distance||20,times=o.times||3,anims=times*2+1,speed=o.duration,ref=(direction=="up"||direction=="down")?"top":"left",positiveMotion=(direction=="up"||direction=="left"),animation={},animation1={},animation2={},i,queue=el.queue(),queuelen=queue.length;$.effects.save(el,props);el.show();$.effects.createWrapper(el);animation[ref]=(positiveMotion?"-=":"+=")+distance;animation1[ref]=(positiveMotion?"+=":"-=")+distance*2;animation2[ref]=(positiveMotion?"-=":"+=")+distance*2;el.animate(animation,speed,o.easing);for(i=1;i<times;i++){el.animate(animation1,speed,o.easing).animate(animation2,speed,o.easing);};el.animate(animation1,speed,o.easing).animate(animation,speed/2,o.easing).queue(function(){if(mode==="hide"){el.hide();}
$.effects.restore(el,props);$.effects.removeWrapper(el);done();});if(queuelen>1){queue.splice.apply(queue,[1,0].concat(queue.splice(queuelen,anims+1)));}
el.dequeue();};})(jQuery);(function($,undefined){$.effects.effect.slide=function(o,done){var el=$(this),props=["position","top","bottom","left","right","width","height"],mode=$.effects.setMode(el,o.mode||"show"),show=mode==="show",direction=o.direction||"left",ref=(direction=="up"||direction=="down")?"top":"left",positiveMotion=(direction=="up"||direction=="left"),distance,animation={},size;$.effects.save(el,props);el.show();distance=o.distance||el[ref==="top"?"outerHeight":"outerWidth"]({margin:true});$.effects.createWrapper(el).css({overflow:"hidden"});if(show){el.css(ref,positiveMotion?(isNaN(distance)?"-"+distance:-distance):distance);}
animation[ref]=(show?(positiveMotion?"+=":"-="):(positiveMotion?"-=":"+="))
+distance;el.animate(animation,{queue:false,duration:o.duration,easing:o.easing,complete:function(){if(mode==="hide"){el.hide();}
$.effects.restore(el,props);$.effects.removeWrapper(el);done();}});};})(jQuery);(function($,undefined){$.effects.effect.transfer=function(o,done){var elem=$(this),target=$(o.to),targetFixed=target.css("position")==="fixed",body=$("body"),fixTop=targetFixed?body.scrollTop():0,fixLeft=targetFixed?body.scrollLeft():0,endPosition=target.offset(),animation={top:endPosition.top-fixTop,left:endPosition.left-fixLeft,height:target.innerHeight(),width:target.innerWidth()},startPosition=elem.offset(),transfer=$('<div class="ui-effects-transfer"></div>').appendTo(document.body).addClass(o.className).css({top:startPosition.top-fixTop,left:startPosition.left-fixLeft,height:elem.innerHeight(),width:elem.innerWidth(),position:targetFixed?"fixed":"absolute"}).animate(animation,o.duration,o.easing,function(){transfer.remove();done();});};})(jQuery);(function($,undefined){var lastToggle={};$.widget("ui.accordion",{version:"1.9m6",options:{active:0,animated:"slide",collapsible:false,event:"click",header:"> li > :first-child,> :not(li):even",heightStyle:"auto",icons:{activeHeader:"ui-icon-triangle-1-s",header:"ui-icon-triangle-1-e"},activate:null,beforeActivate:null},_create:function(){var self=this,options=self.options;self.element.addClass("ui-accordion ui-widget ui-helper-reset");self.headers=self.element.find(options.header).addClass("ui-accordion-header ui-helper-reset ui-state-default ui-corner-all");self._hoverable(self.headers);self._focusable(self.headers);self.headers.find(":first-child").addClass("ui-accordion-heading");self.headers.next().addClass("ui-accordion-content ui-helper-reset ui-widget-content ui-corner-bottom");if(!options.collapsible&&options.active===false){options.active=0;}
if(options.active<0){options.active+=this.headers.length;}
self.active=self._findActive(options.active).addClass("ui-state-default ui-state-active").toggleClass("ui-corner-all").toggleClass("ui-corner-top");self.active.next().addClass("ui-accordion-content-active");self._createIcons();self.refresh();self.element.attr("role","tablist");self.headers.attr("role","tab").bind("keydown.accordion",$.proxy(self,"_keydown")).next().attr("role","tabpanel");self.headers.not(self.active).attr({"aria-expanded":"false","aria-selected":"false",tabIndex:-1}).next().hide();if(!self.active.length){self.headers.eq(0).attr("tabIndex",0);}else{self.active.attr({"aria-expanded":"true","aria-selected":"true",tabIndex:0});}
if(!$.browser.safari){self.headers.find("a").attr("tabIndex",-1);}
this._setupEvents(options.event);},_createIcons:function(){var icons=this.options.icons;if(icons){$("<span>").addClass("ui-accordion-header-icon ui-icon "+icons.header).prependTo(this.headers);this.active.children(".ui-accordion-header-icon").removeClass(icons.header).addClass(icons.activeHeader);this.element.addClass("ui-accordion-icons");}},_destroyIcons:function(){this.headers.children(".ui-accordion-header-icon").remove();this.element.removeClass("ui-accordion-icons");},_destroy:function(){this.element.removeClass("ui-accordion ui-widget ui-helper-reset").removeAttr("role");this.headers.unbind(".accordion").removeClass("ui-accordion-header ui-accordion-disabled ui-helper-reset ui-state-default ui-corner-all ui-state-active ui-state-disabled ui-corner-top").removeAttr("role").removeAttr("aria-expanded").removeAttr("aria-selected").removeAttr("tabIndex").find("a").removeAttr("tabIndex").end().find(".ui-accordion-heading").removeClass("ui-accordion-heading");this._destroyIcons();var contents=this.headers.next().css("display","").removeAttr("role").removeClass("ui-helper-reset ui-widget-content ui-corner-bottom ui-accordion-content ui-accordion-content-active ui-accordion-disabled ui-state-disabled");if(this.options.heightStyle!=="content"){contents.css("height","");}},_setOption:function(key,value){if(key==="active"){this._activate(value);return;}
if(key==="event"){if(this.options.event){this.headers.unbind(this.options.event+".accordion",this._eventHandler);}
this._setupEvents(value);}
this._super("_setOption",key,value);if(key==="collapsible"&&!value&&this.options.active===false){this._activate(0);}
if(key==="icons"){this._destroyIcons();if(value){this._createIcons();}}
if(key==="disabled"){this.headers.add(this.headers.next()).toggleClass("ui-accordion-disabled ui-state-disabled",!!value);}},_keydown:function(event){if(this.options.disabled||event.altKey||event.ctrlKey){return;}
var keyCode=$.ui.keyCode,length=this.headers.length,currentIndex=this.headers.index(event.target),toFocus=false;switch(event.keyCode){case keyCode.RIGHT:case keyCode.DOWN:toFocus=this.headers[(currentIndex+1)%length];break;case keyCode.LEFT:case keyCode.UP:toFocus=this.headers[(currentIndex-1+length)%length];break;case keyCode.SPACE:case keyCode.ENTER:this._eventHandler(event);}
if(toFocus){$(event.target).attr("tabIndex",-1);$(toFocus).attr("tabIndex",0);toFocus.focus();event.preventDefault();}},refresh:function(){var options=this.options,parent=this.element.parent(),maxHeight,overflow;if(options.heightStyle==="fill"){if(!$.support.minHeight){overflow=parent.css("overflow");parent.css("overflow","hidden");}
maxHeight=parent.height();this.element.siblings(":visible").each(function(){var elem=$(this),position=elem.css("position");if(position==="absolute"||position==="fixed"){return;}
maxHeight-=elem.outerHeight(true);});if(overflow){parent.css("overflow",overflow);}
this.headers.each(function(){maxHeight-=$(this).outerHeight(true);});this.headers.next().each(function(){$(this).height(Math.max(0,maxHeight-
$(this).innerHeight()+$(this).height()));}).css("overflow","auto");}else if(options.heightStyle==="auto"){maxHeight=0;this.headers.next().each(function(){maxHeight=Math.max(maxHeight,$(this).height("").height());}).height(maxHeight);}
return this;},_activate:function(index){var active=this._findActive(index)[0];if(active===this.active[0]){return;}
active=active||this.active[0];this._eventHandler({target:active,currentTarget:active,preventDefault:$.noop});},_findActive:function(selector){return typeof selector==="number"?this.headers.eq(selector):$();},_setupEvents:function(event){if(event){this.headers.bind(event.split(" ").join(".accordion ")+".accordion",$.proxy(this,"_eventHandler"));}},_eventHandler:function(event){var options=this.options,active=this.active,clicked=$(event.currentTarget),clickedIsActive=clicked[0]===active[0],collapsing=clickedIsActive&&options.collapsible,toShow=collapsing?$():clicked.next(),toHide=active.next(),eventData={oldHeader:active,oldContent:toHide,newHeader:collapsing?$():clicked,newContent:toShow};event.preventDefault();if(options.disabled||(clickedIsActive&&!options.collapsible)||(this._trigger("beforeActivate",event,eventData)===false)){return;}
options.active=collapsing?false:this.headers.index(clicked);this.active=clickedIsActive?$():clicked;this._toggle(eventData);active.removeClass("ui-state-active ui-corner-top").addClass("ui-state-default ui-corner-all").children(".ui-accordion-header-icon").removeClass(options.icons.activeHeader).addClass(options.icons.header);if(!clickedIsActive){clicked.removeClass("ui-state-default ui-corner-all").addClass("ui-state-active ui-corner-top").children(".ui-accordion-header-icon").removeClass(options.icons.header).addClass(options.icons.activeHeader);clicked.next().addClass("ui-accordion-content-active");}},_toggle:function(data){var self=this,options=self.options,toShow=data.newContent,toHide=data.oldContent;function complete(){self._completed(data);}
if(options.animated){var animations=$.ui.accordion.animations,animation=options.animated,additional;if(!animations[animation]){additional={easing:$.easing[animation]?animation:"slide",duration:700};animation="slide";}
animations[animation]({toShow:toShow,toHide:toHide,prevShow:lastToggle.toShow,prevHide:lastToggle.toHide,complete:complete,down:toShow.length&&(!toHide.length||(toShow.index()<toHide.index()))},additional);}else{toHide.hide();toShow.show();complete();}
toHide.prev().attr({"aria-expanded":"false","aria-selected":"false",tabIndex:-1}).blur();toShow.prev().attr({"aria-expanded":"true","aria-selected":"true",tabIndex:0}).focus();},_completed:function(data){var toShow=data.newContent,toHide=data.oldContent;if(this.options.heightStyle==="content"){toShow.add(toHide).css({height:"",overflow:""});}
toHide.removeClass("ui-accordion-content-active");if(toHide.length){toHide.parent()[0].className=toHide.parent()[0].className;}
this._trigger("activate",null,data);}});$.extend($.ui.accordion,{animations:{slide:function(options,additions){if(options.prevShow||options.prevHide){options.prevHide.stop(true,true);options.toHide=options.prevShow;}
var showOverflow=options.toShow.css("overflow"),hideOverflow=options.toHide.css("overflow"),percentDone=0,showProps={},hideProps={},fxAttrs=["height","paddingTop","paddingBottom"],originalWidth;options=$.extend({easing:"swing",duration:300},options,additions);lastToggle=options;if(!options.toHide.size()){originalWidth=options.toShow[0].style.width;options.toShow.show().width(options.toShow.width()).hide().animate({height:"show",paddingTop:"show",paddingBottom:"show"},{duration:options.duration,easing:options.easing,complete:function(){options.toShow.width(originalWidth);options.complete();}});return;}
if(!options.toShow.size()){options.toHide.animate({height:"hide",paddingTop:"hide",paddingBottom:"hide"},options);return;}
var s=options.toShow;originalWidth=s[0].style.width;s.width(parseInt(s.parent().width(),10)
-parseInt(s.css("paddingLeft"),10)
-parseInt(s.css("paddingRight"),10)
-(parseInt(s.css("borderLeftWidth"),10)||0)
-(parseInt(s.css("borderRightWidth"),10)||0));$.each(fxAttrs,function(i,prop){hideProps[prop]="hide";var parts=(""+$.css(options.toShow[0],prop)).match(/^([\d+-.]+)(.*)$/),propVal=prop==="height"&&parts[1]==="0"?1:parts[1];showProps[prop]={value:propVal,unit:parts[2]||"px"};});options.toShow.css({height:0,overflow:"hidden"}).show();options.toHide.filter(":hidden").each(options.complete).end().filter(":visible").animate(hideProps,{step:function(now,settings){if(settings.prop=="height"||settings.prop=="paddingTop"||settings.prop=="paddingBottom"){percentDone=(settings.end-settings.start===0)?0:(settings.now-settings.start)/(settings.end-settings.start);}
options.toShow[0].style[settings.prop]=(percentDone*showProps[settings.prop].value)
+showProps[settings.prop].unit;},duration:options.duration,easing:options.easing,complete:function(){options.toShow.css({width:originalWidth,overflow:showOverflow});options.toHide.css("overflow",hideOverflow);options.complete();}});},bounceslide:function(options){this.slide(options,{easing:options.down?"easeOutBounce":"swing",duration:options.down?1000:200});}}});if($.uiBackCompat!==false){(function($,prototype){$.extend(prototype.options,{navigation:false,navigationFilter:function(){return this.href.toLowerCase()===location.href.toLowerCase();}});var _create=prototype._create;prototype._create=function(){if(this.options.navigation){var self=this,headers=this.element.find(this.options.header),content=headers.next(),current=headers.add(content).find("a").filter(this.options.navigationFilter)
[0];if(current){headers.add(content).each(function(index){if($.contains(this,current)){self.options.active=Math.floor(index/2);return false;}});}}
_create.call(this);};}(jQuery,jQuery.ui.accordion.prototype));(function($,prototype){$.extend(prototype.options,{heightStyle:null,autoHeight:true,clearStyle:false,fillSpace:false});var _create=prototype._create,_setOption=prototype._setOption;$.extend(prototype,{_create:function(){this.options.heightStyle=this.options.heightStyle||this._mergeHeightStyle();_create.call(this);},_setOption:function(key,value){if(key==="autoHeight"||key==="clearStyle"||key==="fillSpace"){this.options.heightStyle=this._mergeHeightStyle();}
_setOption.apply(this,arguments);},_mergeHeightStyle:function(){var options=this.options;if(options.fillSpace){return"fill";}
if(options.clearStyle){return"content";}
if(options.autoHeight){return"auto";}}});}(jQuery,jQuery.ui.accordion.prototype));(function($,prototype){$.extend(prototype.options.icons,{activeHeader:null,headerSelected:"ui-icon-triangle-1-s"});var _createIcons=prototype._createIcons;prototype._createIcons=function(){this.options.icons.activeHeader=this.options.icons.activeHeader||this.options.icons.headerSelected;_createIcons.call(this);};}(jQuery,jQuery.ui.accordion.prototype));(function($,prototype){prototype.activate=prototype._activate;var _findActive=prototype._findActive;prototype._findActive=function(index){if(index===-1){index=false;}
if(index&&typeof index!=="number"){index=this.headers.index(this.headers.filter(index));if(index===-1){index=false;}}
return _findActive.call(this,index);};}(jQuery,jQuery.ui.accordion.prototype));jQuery.ui.accordion.prototype.resize=jQuery.ui.accordion.prototype.refresh;(function($,prototype){$.extend(prototype.options,{change:null,changestart:null});var _trigger=prototype._trigger;prototype._trigger=function(type,event,data){var ret=_trigger.apply(this,arguments);if(!ret){return false;}
if(type==="beforeActivate"){ret=_trigger.call(this,"changestart",event,data);}else if(type==="activate"){ret=_trigger.call(this,"change",event,data);}
return ret;};}(jQuery,jQuery.ui.accordion.prototype));}})(jQuery);(function($,undefined){var requestIndex=0;$.widget("ui.autocomplete",{version:"1.9m6",defaultElement:"<input>",options:{appendTo:"body",autoFocus:false,delay:300,minLength:1,position:{my:"left top",at:"left bottom",collision:"none"},source:null,change:null,close:null,focus:null,open:null,response:null,search:null,select:null},pending:0,_create:function(){var self=this,doc=this.element[0].ownerDocument,suppressKeyPress,suppressInput;this.valueMethod=this.element[this.element.is("input,textarea")?"val":"text"];this.element.addClass("ui-autocomplete-input").attr("autocomplete","off").attr({role:"textbox","aria-autocomplete":"list","aria-haspopup":"true"}).bind("keydown.autocomplete",function(event){if(self.options.disabled||self.element.prop("readOnly")){suppressKeyPress=true;suppressInput=true;return;}
suppressKeyPress=false;suppressInput=false;var keyCode=$.ui.keyCode;switch(event.keyCode){case keyCode.PAGE_UP:suppressKeyPress=true;self._move("previousPage",event);break;case keyCode.PAGE_DOWN:suppressKeyPress=true;self._move("nextPage",event);break;case keyCode.UP:suppressKeyPress=true;self._move("previous",event);event.preventDefault();break;case keyCode.DOWN:suppressKeyPress=true;self._move("next",event);event.preventDefault();break;case keyCode.ENTER:case keyCode.NUMPAD_ENTER:if(self.menu.active){suppressKeyPress=true;event.preventDefault();}
case keyCode.TAB:if(!self.menu.active){return;}
self.menu.select(event);break;case keyCode.ESCAPE:self._value(self.term);self.close(event);break;default:self._searchTimeout(event);break;}}).bind("keypress.autocomplete",function(event){if(suppressKeyPress){suppressKeyPress=false;event.preventDefault();return;}
var keyCode=$.ui.keyCode;switch(event.keyCode){case keyCode.PAGE_UP:self._move("previousPage",event);break;case keyCode.PAGE_DOWN:self._move("nextPage",event);break;case keyCode.UP:self._move("previous",event);event.preventDefault();break;case keyCode.DOWN:self._move("next",event);event.preventDefault();break;}}).bind("input.autocomplete",function(event){if(suppressInput){suppressInput=false;event.preventDefault();return;}
self._searchTimeout(event);}).bind("focus.autocomplete",function(){if(self.options.disabled){return;}
self.selectedItem=null;self.previous=self._value();}).bind("blur.autocomplete",function(event){if(self.options.disabled){return;}
clearTimeout(self.searching);self.closing=setTimeout(function(){self.close(event);self._change(event);},150);});this._initSource();this.response=function(){return self._response.apply(self,arguments);};this.menu=$("<ul></ul>").addClass("ui-autocomplete").appendTo($(this.options.appendTo||"body",doc)[0]).mousedown(function(event){var menuElement=self.menu.element[0];if(!$(event.target).closest(".ui-menu-item").length){setTimeout(function(){$(document).one('mousedown',function(event){if(event.target!==self.element[0]&&event.target!==menuElement&&!$.contains(menuElement,event.target)){self.close();}});},1);}
setTimeout(function(){clearTimeout(self.closing);},13);}).menu({input:$(),focus:function(event,ui){var item=ui.item.data("item.autocomplete");if(false!==self._trigger("focus",event,{item:item})){if(/^key/.test(event.originalEvent.type)){self._value(item.value);}}},select:function(event,ui){var item=ui.item.data("item.autocomplete"),previous=self.previous;if(self.element[0]!==doc.activeElement){self.element.focus();self.previous=previous;setTimeout(function(){self.previous=previous;self.selectedItem=item;},1);}
if(false!==self._trigger("select",event,{item:item})){self._value(item.value);}
self.term=self._value();self.close(event);self.selectedItem=item;},blur:function(event,ui){if(self.menu.element.is(":visible")&&(self._value()!==self.term)){self._value(self.term);}}}).zIndex(this.element.zIndex()+1).hide().data("menu");if($.fn.bgiframe){this.menu.element.bgiframe();}},_destroy:function(){clearTimeout(this.searching);this.element.removeClass("ui-autocomplete-input").removeAttr("autocomplete").removeAttr("role").removeAttr("aria-autocomplete").removeAttr("aria-haspopup");this.menu.element.remove();},_setOption:function(key,value){this._super("_setOption",key,value);if(key==="source"){this._initSource();}
if(key==="appendTo"){this.menu.element.appendTo($(value||"body",this.element[0].ownerDocument)[0])}
if(key==="disabled"&&value&&this.xhr){this.xhr.abort();}},_initSource:function(){var self=this,array,url;if($.isArray(this.options.source)){array=this.options.source;this.source=function(request,response){response($.ui.autocomplete.filter(array,request.term));};}else if(typeof this.options.source==="string"){url=this.options.source;this.source=function(request,response){if(self.xhr){self.xhr.abort();}
self.xhr=$.ajax({url:url,data:request,dataType:"json",autocompleteRequest:++requestIndex,success:function(data,status){if(this.autocompleteRequest===requestIndex){response(data);}},error:function(){if(this.autocompleteRequest===requestIndex){response([]);}}});};}else{this.source=this.options.source;}},_searchTimeout:function(event){var self=this;self.searching=setTimeout(function(){if(self.term!=self.element.val()){self.selectedItem=null;self.search(null,event);}},self.options.delay);},search:function(value,event){value=value!=null?value:this._value();this.term=this._value();if(value.length<this.options.minLength){return this.close(event);}
clearTimeout(this.closing);if(this._trigger("search",event)===false){return;}
return this._search(value);},_search:function(value){this.pending++;this.element.addClass("ui-autocomplete-loading");this.source({term:value},this.response);},_response:function(content){if(content){content=this._normalize(content);}
this._trigger("response",null,{content:content});if(!this.options.disabled&&content&&content.length){this._suggest(content);this._trigger("open");}else{this.close();}
this.pending--;if(!this.pending){this.element.removeClass("ui-autocomplete-loading");}},close:function(event){clearTimeout(this.closing);if(this.menu.element.is(":visible")){this.menu.element.hide();this.menu.blur();this._trigger("close",event);}},_change:function(event){if(this.previous!==this._value()){this._trigger("change",event,{item:this.selectedItem});}},_normalize:function(items){if(items.length&&items[0].label&&items[0].value){return items;}
return $.map(items,function(item){if(typeof item==="string"){return{label:item,value:item};}
return $.extend({label:item.label||item.value,value:item.value||item.label},item);});},_suggest:function(items){var ul=this.menu.element.empty().zIndex(this.element.zIndex()+1);this._renderMenu(ul,items);this.menu.blur();this.menu.refresh();ul.show();this._resizeMenu();ul.position($.extend({of:this.element},this.options.position));if(this.options.autoFocus){this.menu.next(new $.Event("mouseover"));}},_resizeMenu:function(){var ul=this.menu.element;ul.outerWidth(Math.max(ul.width("").outerWidth(),this.element.outerWidth()));},_renderMenu:function(ul,items){var self=this;$.each(items,function(index,item){self._renderItem(ul,item);});},_renderItem:function(ul,item){return $("<li></li>").data("item.autocomplete",item).append($("<a></a>").text(item.label)).appendTo(ul);},_move:function(direction,event){if(!this.menu.element.is(":visible")){this.search(null,event);return;}
if(this.menu.first()&&/^previous/.test(direction)||this.menu.last()&&/^next/.test(direction)){this._value(this.term);this.menu.blur();return;}
this.menu[direction](event);},widget:function(){return this.menu.element;},_value:function(value){return this.valueMethod.apply(this.element,arguments);}});$.extend($.ui.autocomplete,{escapeRegex:function(value){return value.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&");},filter:function(array,term){var matcher=new RegExp($.ui.autocomplete.escapeRegex(term),"i");return $.grep(array,function(value){return matcher.test(value.label||value.value||value);});}});}(jQuery));(function($,undefined){var lastActive,startXPos,startYPos,clickDragged,baseClasses="ui-button ui-widget ui-state-default ui-corner-all",stateClasses="ui-state-hover ui-state-active ",typeClasses="ui-button-icons-only ui-button-icon-only ui-button-text-icons ui-button-text-icon-primary ui-button-text-icon-secondary ui-button-text-only",formResetHandler=function(){var buttons=$(this).find(":ui-button");setTimeout(function(){buttons.button("refresh");},1);},radioGroup=function(radio){var name=radio.name,form=radio.form,radios=$([]);if(name){if(form){radios=$(form).find("[name='"+name+"']");}else{radios=$("[name='"+name+"']",radio.ownerDocument).filter(function(){return!this.form;});}}
return radios;};$.widget("ui.button",{version:"1.9m6",defaultElement:"<button>",options:{disabled:null,text:true,label:null,icons:{primary:null,secondary:null}},_create:function(){this.element.closest("form").unbind("reset.button").bind("reset.button",formResetHandler);if(typeof this.options.disabled!=="boolean"){this.options.disabled=this.element.prop("disabled");}
this._determineButtonType();this.hasTitle=!!this.buttonElement.attr("title");var self=this,options=this.options,toggleButton=this.type==="checkbox"||this.type==="radio",hoverClass="ui-state-hover"+(!toggleButton?" ui-state-active":""),focusClass="ui-state-focus";if(options.label===null){options.label=this.buttonElement.html();}
if(this.element.is(":disabled")){options.disabled=true;}
this.buttonElement.addClass(baseClasses).attr("role","button").bind("mouseenter.button",function(){if(options.disabled){return;}
$(this).addClass("ui-state-hover");if(this===lastActive){$(this).addClass("ui-state-active");}}).bind("mouseleave.button",function(){if(options.disabled){return;}
$(this).removeClass(hoverClass);}).bind("click.button",function(event){if(options.disabled){event.preventDefault();event.stopImmediatePropagation();}});this.element.bind("focus.button",function(){self.buttonElement.addClass(focusClass);}).bind("blur.button",function(){self.buttonElement.removeClass(focusClass);});if(toggleButton){this.element.bind("change.button",function(){if(clickDragged){return;}
self.refresh();});this.buttonElement.bind("mousedown.button",function(event){if(options.disabled){return;}
clickDragged=false;startXPos=event.pageX;startYPos=event.pageY;}).bind("mouseup.button",function(event){if(options.disabled){return;}
if(startXPos!==event.pageX||startYPos!==event.pageY){clickDragged=true;}});}
if(this.type==="checkbox"){this.buttonElement.bind("click.button",function(){if(options.disabled||clickDragged){return false;}
$(this).toggleClass("ui-state-active");self.buttonElement.attr("aria-pressed",self.element[0].checked);});}else if(this.type==="radio"){this.buttonElement.bind("click.button",function(){if(options.disabled||clickDragged){return false;}
$(this).addClass("ui-state-active");self.buttonElement.attr("aria-pressed","true");var radio=self.element[0];radioGroup(radio).not(radio).map(function(){return $(this).button("widget")[0];}).removeClass("ui-state-active").attr("aria-pressed","false");});}else{this.buttonElement.bind("mousedown.button",function(){if(options.disabled){return false;}
$(this).addClass("ui-state-active");lastActive=this;$(document).one("mouseup",function(){lastActive=null;});}).bind("mouseup.button",function(){if(options.disabled){return false;}
$(this).removeClass("ui-state-active");}).bind("keydown.button",function(event){if(options.disabled){return false;}
if(event.keyCode==$.ui.keyCode.SPACE||event.keyCode==$.ui.keyCode.ENTER){$(this).addClass("ui-state-active");}}).bind("keyup.button",function(){$(this).removeClass("ui-state-active");});if(this.buttonElement.is("a")){this.buttonElement.keyup(function(event){if(event.keyCode===$.ui.keyCode.SPACE){$(this).click();}});}}
this._setOption("disabled",options.disabled);this._resetButton();},_determineButtonType:function(){if(this.element.is(":checkbox")){this.type="checkbox";}else if(this.element.is(":radio")){this.type="radio";}else if(this.element.is("input")){this.type="input";}else{this.type="button";}
if(this.type==="checkbox"||this.type==="radio"){var ancestor=this.element.parents().last(),labelSelector="label[for='"+this.element.attr("id")+"']";this.buttonElement=ancestor.find(labelSelector);if(!this.buttonElement.length){ancestor=ancestor.length?ancestor.siblings():this.element.siblings();this.buttonElement=ancestor.filter(labelSelector);if(!this.buttonElement.length){this.buttonElement=ancestor.find(labelSelector);}}
this.element.addClass("ui-helper-hidden-accessible");var checked=this.element.is(":checked");if(checked){this.buttonElement.addClass("ui-state-active");}
this.buttonElement.prop("aria-pressed",checked);}else{this.buttonElement=this.element;}},widget:function(){return this.buttonElement;},_destroy:function(){this.element.removeClass("ui-helper-hidden-accessible");this.buttonElement.removeClass(baseClasses+" "+stateClasses+" "+typeClasses).removeAttr("role").removeAttr("aria-pressed").html(this.buttonElement.find(".ui-button-text").html());if(!this.hasTitle){this.buttonElement.removeAttr("title");}},_setOption:function(key,value){this._super("_setOption",key,value);if(key==="disabled"){if(value){this.element.prop("disabled",true);}else{this.element.prop("disabled",false);}
return;}
this._resetButton();},refresh:function(){var isDisabled=this.element.is(":disabled");if(isDisabled!==this.options.disabled){this._setOption("disabled",isDisabled);}
if(this.type==="radio"){radioGroup(this.element[0]).each(function(){if($(this).is(":checked")){$(this).button("widget").addClass("ui-state-active").attr("aria-pressed","true");}else{$(this).button("widget").removeClass("ui-state-active").attr("aria-pressed","false");}});}else if(this.type==="checkbox"){if(this.element.is(":checked")){this.buttonElement.addClass("ui-state-active").attr("aria-pressed","true");}else{this.buttonElement.removeClass("ui-state-active").attr("aria-pressed","false");}}},_resetButton:function(){if(this.type==="input"){if(this.options.label){this.element.val(this.options.label);}
return;}
var buttonElement=this.buttonElement.removeClass(typeClasses),buttonText=$("<span></span>").addClass("ui-button-text").html(this.options.label).appendTo(buttonElement.empty()).text(),icons=this.options.icons,multipleIcons=icons.primary&&icons.secondary,buttonClasses=[];if(icons.primary||icons.secondary){if(this.options.text){buttonClasses.push("ui-button-text-icon"+(multipleIcons?"s":(icons.primary?"-primary":"-secondary")));}
if(icons.primary){buttonElement.prepend("<span class='ui-button-icon-primary ui-icon "+icons.primary+"'></span>");}
if(icons.secondary){buttonElement.append("<span class='ui-button-icon-secondary ui-icon "+icons.secondary+"'></span>");}
if(!this.options.text){buttonClasses.push(multipleIcons?"ui-button-icons-only":"ui-button-icon-only");if(!this.hasTitle){buttonElement.attr("title",buttonText);}}}else{buttonClasses.push("ui-button-text-only");}
buttonElement.addClass(buttonClasses.join(" "));}});$.ui.button.version="1.9m6";$.widget("ui.buttonset",{options:{items:":button, :submit, :reset, :checkbox, :radio, a, :data(button)"},_create:function(){this.element.addClass("ui-buttonset");},_init:function(){this.refresh();},_setOption:function(key,value){if(key==="disabled"){this.buttons.button("option",key,value);}
this._super("_setOption",key,value);},refresh:function(){var rtl=this.element.css("direction")==="rtl";this.buttons=this.element.find(this.options.items).filter(":ui-button").button("refresh").end().not(":ui-button").button().end().map(function(){return $(this).button("widget")[0];}).removeClass("ui-corner-all ui-corner-left ui-corner-right").filter(":first").addClass(rtl?"ui-corner-right":"ui-corner-left").end().filter(":last").addClass(rtl?"ui-corner-left":"ui-corner-right").end().end();},_destroy:function(){this.element.removeClass("ui-buttonset");this.buttons.map(function(){return $(this).button("widget")[0];}).removeClass("ui-corner-left ui-corner-right").end().button("destroy");}});}(jQuery));(function($,undefined){$.extend($.ui,{datepicker:{version:"1.9m6"}});var PROP_NAME='datepicker';var dpuuid=new Date().getTime();var instActive;function Datepicker(){this.debug=false;this._curInst=null;this._keyEvent=false;this._disabledInputs=[];this._datepickerShowing=false;this._inDialog=false;this._mainDivId='ui-datepicker-div';this._inlineClass='ui-datepicker-inline';this._appendClass='ui-datepicker-append';this._triggerClass='ui-datepicker-trigger';this._dialogClass='ui-datepicker-dialog';this._disableClass='ui-datepicker-disabled';this._unselectableClass='ui-datepicker-unselectable';this._currentClass='ui-datepicker-current-day';this._dayOverClass='ui-datepicker-days-cell-over';this.regional=[];this.regional['']={closeText:'Done',prevText:'Prev',nextText:'Next',currentText:'Today',monthNames:['January','February','March','April','May','June','July','August','September','October','November','December'],monthNamesShort:['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'],dayNames:['Sunday','Monday','Tuesday','Wednesday','Thursday','Friday','Saturday'],dayNamesShort:['Sun','Mon','Tue','Wed','Thu','Fri','Sat'],dayNamesMin:['Su','Mo','Tu','We','Th','Fr','Sa'],weekHeader:'Wk',dateFormat:'mm/dd/yy',firstDay:0,isRTL:false,showMonthAfterYear:false,yearSuffix:''};this._defaults={showOn:'focus',showAnim:'fadeIn',showOptions:{},defaultDate:null,appendText:'',buttonText:'...',buttonImage:'',buttonImageOnly:false,hideIfNoPrevNext:false,navigationAsDateFormat:false,gotoCurrent:false,changeMonth:false,changeYear:false,yearRange:'c-10:c+10',showOtherMonths:false,selectOtherMonths:false,showWeek:false,calculateWeek:this.iso8601Week,shortYearCutoff:'+10',minDate:null,maxDate:null,duration:'fast',beforeShowDay:null,beforeShow:null,onSelect:null,onChangeMonthYear:null,onClose:null,numberOfMonths:1,showCurrentAtPos:0,stepMonths:1,stepBigMonths:12,altField:'',altFormat:'',constrainInput:true,showButtonPanel:false,autoSize:false,disabled:false};$.extend(this._defaults,this.regional['']);this.dpDiv=bindHover($('<div id="'+this._mainDivId+'" class="ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all"></div>'));}
$.extend(Datepicker.prototype,{markerClassName:'hasDatepicker',maxRows:4,log:function(){if(this.debug)
console.log.apply('',arguments);},_widgetDatepicker:function(){return this.dpDiv;},setDefaults:function(settings){extendRemove(this._defaults,settings||{});return this;},_attachDatepicker:function(target,settings){var inlineSettings=null;for(var attrName in this._defaults){var attrValue=target.getAttribute('date:'+attrName);if(attrValue){inlineSettings=inlineSettings||{};try{inlineSettings[attrName]=eval(attrValue);}catch(err){inlineSettings[attrName]=attrValue;}}}
var nodeName=target.nodeName.toLowerCase();var inline=(nodeName=='div'||nodeName=='span');if(!target.id){this.uuid+=1;target.id='dp'+this.uuid;}
var inst=this._newInst($(target),inline);inst.settings=$.extend({},settings||{},inlineSettings||{});if(nodeName=='input'){this._connectDatepicker(target,inst);}else if(inline){this._inlineDatepicker(target,inst);}},_newInst:function(target,inline){var id=target[0].id.replace(/([^A-Za-z0-9_-])/g,'\\\\$1');return{id:id,input:target,selectedDay:0,selectedMonth:0,selectedYear:0,drawMonth:0,drawYear:0,inline:inline,dpDiv:(!inline?this.dpDiv:bindHover($('<div class="'+this._inlineClass+' ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all"></div>')))};},_connectDatepicker:function(target,inst){var input=$(target);inst.append=$([]);inst.trigger=$([]);if(input.hasClass(this.markerClassName))
return;this._attachments(input,inst);input.addClass(this.markerClassName).keydown(this._doKeyDown).keypress(this._doKeyPress).keyup(this._doKeyUp).bind("setData.datepicker",function(event,key,value){inst.settings[key]=value;}).bind("getData.datepicker",function(event,key){return this._get(inst,key);});this._autoSize(inst);$.data(target,PROP_NAME,inst);if(inst.settings.disabled){this._disableDatepicker(target);}},_attachments:function(input,inst){var appendText=this._get(inst,'appendText');var isRTL=this._get(inst,'isRTL');if(inst.append)
inst.append.remove();if(appendText){inst.append=$('<span class="'+this._appendClass+'">'+appendText+'</span>');input[isRTL?'before':'after'](inst.append);}
input.unbind('focus',this._showDatepicker);if(inst.trigger)
inst.trigger.remove();var showOn=this._get(inst,'showOn');if(showOn=='focus'||showOn=='both')
input.focus(this._showDatepicker);if(showOn=='button'||showOn=='both'){var buttonText=this._get(inst,'buttonText');var buttonImage=this._get(inst,'buttonImage');inst.trigger=$(this._get(inst,'buttonImageOnly')?$('<img/>').addClass(this._triggerClass).attr({src:buttonImage,alt:buttonText,title:buttonText}):$('<button type="button"></button>').addClass(this._triggerClass).html(buttonImage==''?buttonText:$('<img/>').attr({src:buttonImage,alt:buttonText,title:buttonText})));input[isRTL?'before':'after'](inst.trigger);inst.trigger.click(function(){if($.datepicker._datepickerShowing&&$.datepicker._lastInput==input[0])
$.datepicker._hideDatepicker();else
$.datepicker._showDatepicker(input[0]);return false;});}},_autoSize:function(inst){if(this._get(inst,'autoSize')&&!inst.inline){var date=new Date(2009,12-1,20);var dateFormat=this._get(inst,'dateFormat');if(dateFormat.match(/[DM]/)){var findMax=function(names){var max=0;var maxI=0;for(var i=0;i<names.length;i++){if(names[i].length>max){max=names[i].length;maxI=i;}}
return maxI;};date.setMonth(findMax(this._get(inst,(dateFormat.match(/MM/)?'monthNames':'monthNamesShort'))));date.setDate(findMax(this._get(inst,(dateFormat.match(/DD/)?'dayNames':'dayNamesShort')))+20-date.getDay());}
inst.input.attr('size',this._formatDate(inst,date).length);}},_inlineDatepicker:function(target,inst){var divSpan=$(target);if(divSpan.hasClass(this.markerClassName))
return;divSpan.addClass(this.markerClassName).append(inst.dpDiv).bind("setData.datepicker",function(event,key,value){inst.settings[key]=value;}).bind("getData.datepicker",function(event,key){return this._get(inst,key);});$.data(target,PROP_NAME,inst);this._setDate(inst,this._getDefaultDate(inst),true);this._updateDatepicker(inst);this._updateAlternate(inst);if(inst.settings.disabled){this._disableDatepicker(target);}
inst.dpDiv.css("display","block");},_dialogDatepicker:function(input,date,onSelect,settings,pos){var inst=this._dialogInst;if(!inst){this.uuid+=1;var id='dp'+this.uuid;this._dialogInput=$('<input type="text" id="'+id+'" style="position: absolute; top: -100px; width: 0px; z-index: -10;"/>');this._dialogInput.keydown(this._doKeyDown);$('body').append(this._dialogInput);inst=this._dialogInst=this._newInst(this._dialogInput,false);inst.settings={};$.data(this._dialogInput[0],PROP_NAME,inst);}
extendRemove(inst.settings,settings||{});date=(date&&date.constructor==Date?this._formatDate(inst,date):date);this._dialogInput.val(date);this._pos=(pos?(pos.length?pos:[pos.pageX,pos.pageY]):null);if(!this._pos){var browserWidth=document.documentElement.clientWidth;var browserHeight=document.documentElement.clientHeight;var scrollX=document.documentElement.scrollLeft||document.body.scrollLeft;var scrollY=document.documentElement.scrollTop||document.body.scrollTop;this._pos=[(browserWidth/2)-100+scrollX,(browserHeight/2)-150+scrollY];}
this._dialogInput.css('left',(this._pos[0]+20)+'px').css('top',this._pos[1]+'px');inst.settings.onSelect=onSelect;this._inDialog=true;this.dpDiv.addClass(this._dialogClass);this._showDatepicker(this._dialogInput[0]);if($.blockUI)
$.blockUI(this.dpDiv);$.data(this._dialogInput[0],PROP_NAME,inst);return this;},_destroyDatepicker:function(target){var $target=$(target);var inst=$.data(target,PROP_NAME);if(!$target.hasClass(this.markerClassName)){return;}
var nodeName=target.nodeName.toLowerCase();$.removeData(target,PROP_NAME);if(nodeName=='input'){inst.append.remove();inst.trigger.remove();$target.removeClass(this.markerClassName).unbind('focus',this._showDatepicker).unbind('keydown',this._doKeyDown).unbind('keypress',this._doKeyPress).unbind('keyup',this._doKeyUp);}else if(nodeName=='div'||nodeName=='span')
$target.removeClass(this.markerClassName).empty();},_enableDatepicker:function(target){var $target=$(target);var inst=$.data(target,PROP_NAME);if(!$target.hasClass(this.markerClassName)){return;}
var nodeName=target.nodeName.toLowerCase();if(nodeName=='input'){target.disabled=false;inst.trigger.filter('button').each(function(){this.disabled=false;}).end().filter('img').css({opacity:'1.0',cursor:''});}
else if(nodeName=='div'||nodeName=='span'){var inline=$target.children('.'+this._inlineClass);inline.children().removeClass('ui-state-disabled');inline.find("select.ui-datepicker-month, select.ui-datepicker-year").prop("disabled",false);}
this._disabledInputs=$.map(this._disabledInputs,function(value){return(value==target?null:value);});},_disableDatepicker:function(target){var $target=$(target);var inst=$.data(target,PROP_NAME);if(!$target.hasClass(this.markerClassName)){return;}
var nodeName=target.nodeName.toLowerCase();if(nodeName=='input'){target.disabled=true;inst.trigger.filter('button').each(function(){this.disabled=true;}).end().filter('img').css({opacity:'0.5',cursor:'default'});}
else if(nodeName=='div'||nodeName=='span'){var inline=$target.children('.'+this._inlineClass);inline.children().addClass('ui-state-disabled');inline.find("select.ui-datepicker-month, select.ui-datepicker-year").prop("disabled",true);}
this._disabledInputs=$.map(this._disabledInputs,function(value){return(value==target?null:value);});this._disabledInputs[this._disabledInputs.length]=target;},_isDisabledDatepicker:function(target){if(!target){return false;}
for(var i=0;i<this._disabledInputs.length;i++){if(this._disabledInputs[i]==target)
return true;}
return false;},_getInst:function(target){try{return $.data(target,PROP_NAME);}
catch(err){throw'Missing instance data for this datepicker';}},_optionDatepicker:function(target,name,value){var inst=this._getInst(target);if(arguments.length==2&&typeof name=='string'){return(name=='defaults'?$.extend({},$.datepicker._defaults):(inst?(name=='all'?$.extend({},inst.settings):this._get(inst,name)):null));}
var settings=name||{};if(typeof name=='string'){settings={};settings[name]=value;}
if(inst){if(this._curInst==inst){this._hideDatepicker();}
var date=this._getDateDatepicker(target,true);var minDate=this._getMinMaxDate(inst,'min');var maxDate=this._getMinMaxDate(inst,'max');extendRemove(inst.settings,settings);if(minDate!==null&&settings['dateFormat']!==undefined&&settings['minDate']===undefined)
inst.settings.minDate=this._formatDate(inst,minDate);if(maxDate!==null&&settings['dateFormat']!==undefined&&settings['maxDate']===undefined)
inst.settings.maxDate=this._formatDate(inst,maxDate);this._attachments($(target),inst);this._autoSize(inst);this._setDate(inst,date);this._updateAlternate(inst);this._updateDatepicker(inst);}},_changeDatepicker:function(target,name,value){this._optionDatepicker(target,name,value);},_refreshDatepicker:function(target){var inst=this._getInst(target);if(inst){this._updateDatepicker(inst);}},_setDateDatepicker:function(target,date){var inst=this._getInst(target);if(inst){this._setDate(inst,date);this._updateDatepicker(inst);this._updateAlternate(inst);}},_getDateDatepicker:function(target,noDefault){var inst=this._getInst(target);if(inst&&!inst.inline)
this._setDateFromField(inst,noDefault);return(inst?this._getDate(inst):null);},_doKeyDown:function(event){var inst=$.datepicker._getInst(event.target);var handled=true;var isRTL=inst.dpDiv.is('.ui-datepicker-rtl');inst._keyEvent=true;if($.datepicker._datepickerShowing)
switch(event.keyCode){case 9:$.datepicker._hideDatepicker();handled=false;break;case 13:var sel=$('td.'+$.datepicker._dayOverClass+':not(.'+
$.datepicker._currentClass+')',inst.dpDiv);if(sel[0])
$.datepicker._selectDay(event.target,inst.selectedMonth,inst.selectedYear,sel[0]);var onSelect=$.datepicker._get(inst,'onSelect');if(onSelect){var dateStr=$.datepicker._formatDate(inst);onSelect.apply((inst.input?inst.input[0]:null),[dateStr,inst]);}
else
$.datepicker._hideDatepicker();return false;break;case 27:$.datepicker._hideDatepicker();break;case 33:$.datepicker._adjustDate(event.target,(event.ctrlKey?-$.datepicker._get(inst,'stepBigMonths'):-$.datepicker._get(inst,'stepMonths')),'M');break;case 34:$.datepicker._adjustDate(event.target,(event.ctrlKey?+$.datepicker._get(inst,'stepBigMonths'):+$.datepicker._get(inst,'stepMonths')),'M');break;case 35:if(event.ctrlKey||event.metaKey)$.datepicker._clearDate(event.target);handled=event.ctrlKey||event.metaKey;break;case 36:if(event.ctrlKey||event.metaKey)$.datepicker._gotoToday(event.target);handled=event.ctrlKey||event.metaKey;break;case 37:if(event.ctrlKey||event.metaKey)$.datepicker._adjustDate(event.target,(isRTL?+1:-1),'D');handled=event.ctrlKey||event.metaKey;if(event.originalEvent.altKey)$.datepicker._adjustDate(event.target,(event.ctrlKey?-$.datepicker._get(inst,'stepBigMonths'):-$.datepicker._get(inst,'stepMonths')),'M');break;case 38:if(event.ctrlKey||event.metaKey)$.datepicker._adjustDate(event.target,-7,'D');handled=event.ctrlKey||event.metaKey;break;case 39:if(event.ctrlKey||event.metaKey)$.datepicker._adjustDate(event.target,(isRTL?-1:+1),'D');handled=event.ctrlKey||event.metaKey;if(event.originalEvent.altKey)$.datepicker._adjustDate(event.target,(event.ctrlKey?+$.datepicker._get(inst,'stepBigMonths'):+$.datepicker._get(inst,'stepMonths')),'M');break;case 40:if(event.ctrlKey||event.metaKey)$.datepicker._adjustDate(event.target,+7,'D');handled=event.ctrlKey||event.metaKey;break;default:handled=false;}
else if(event.keyCode==36&&event.ctrlKey)
$.datepicker._showDatepicker(this);else{handled=false;}
if(handled){event.preventDefault();event.stopPropagation();}},_doKeyPress:function(event){var inst=$.datepicker._getInst(event.target);if($.datepicker._get(inst,'constrainInput')){var chars=$.datepicker._possibleChars($.datepicker._get(inst,'dateFormat'));var chr=String.fromCharCode(event.charCode==undefined?event.keyCode:event.charCode);return event.ctrlKey||event.metaKey||(chr<' '||!chars||chars.indexOf(chr)>-1);}},_doKeyUp:function(event){var inst=$.datepicker._getInst(event.target);if(inst.input.val()!=inst.lastVal){try{var date=$.datepicker.parseDate($.datepicker._get(inst,'dateFormat'),(inst.input?inst.input.val():null),$.datepicker._getFormatConfig(inst));if(date){$.datepicker._setDateFromField(inst);$.datepicker._updateAlternate(inst);$.datepicker._updateDatepicker(inst);}}
catch(event){$.datepicker.log(event);}}
return true;},_showDatepicker:function(input){input=input.target||input;if(input.nodeName.toLowerCase()!='input')
input=$('input',input.parentNode)[0];if($.datepicker._isDisabledDatepicker(input)||$.datepicker._lastInput==input)
return;var inst=$.datepicker._getInst(input);if($.datepicker._curInst&&$.datepicker._curInst!=inst){if($.datepicker._datepickerShowing){$.datepicker._triggerOnClose($.datepicker._curInst);}
$.datepicker._curInst.dpDiv.stop(true,true);}
var beforeShow=$.datepicker._get(inst,'beforeShow');var beforeShowSettings=beforeShow?beforeShow.apply(input,[input,inst]):{};if(beforeShowSettings===false){return;}
extendRemove(inst.settings,beforeShowSettings);inst.lastVal=null;$.datepicker._lastInput=input;$.datepicker._setDateFromField(inst);if($.datepicker._inDialog)
input.value='';if(!$.datepicker._pos){$.datepicker._pos=$.datepicker._findPos(input);$.datepicker._pos[1]+=input.offsetHeight;}
var isFixed=false;$(input).parents().each(function(){isFixed|=$(this).css('position')=='fixed';return!isFixed;});if(isFixed&&$.browser.opera){$.datepicker._pos[0]-=document.documentElement.scrollLeft;$.datepicker._pos[1]-=document.documentElement.scrollTop;}
var offset={left:$.datepicker._pos[0],top:$.datepicker._pos[1]};$.datepicker._pos=null;inst.dpDiv.empty();inst.dpDiv.css({position:'absolute',display:'block',top:'-1000px'});$.datepicker._updateDatepicker(inst);offset=$.datepicker._checkOffset(inst,offset,isFixed);inst.dpDiv.css({position:($.datepicker._inDialog&&$.blockUI?'static':(isFixed?'fixed':'absolute')),display:'none',left:offset.left+'px',top:offset.top+'px'});if(!inst.inline){var showAnim=$.datepicker._get(inst,'showAnim');var duration=$.datepicker._get(inst,'duration');var postProcess=function(){var cover=inst.dpDiv.find('iframe.ui-datepicker-cover');if(!!cover.length){var borders=$.datepicker._getBorders(inst.dpDiv);cover.css({left:-borders[0],top:-borders[1],width:inst.dpDiv.outerWidth(),height:inst.dpDiv.outerHeight()});}};inst.dpDiv.zIndex($(input).zIndex()+1);$.datepicker._datepickerShowing=true;if($.effects&&($.effects.effect[showAnim]||$.effects[showAnim]))
inst.dpDiv.show(showAnim,$.datepicker._get(inst,'showOptions'),duration,postProcess);else
inst.dpDiv[showAnim||'show']((showAnim?duration:null),postProcess);if(!showAnim||!duration)
postProcess();if(inst.input.is(':visible')&&!inst.input.is(':disabled'))
inst.input.focus();$.datepicker._curInst=inst;}},_updateDatepicker:function(inst){var self=this;self.maxRows=4;var borders=$.datepicker._getBorders(inst.dpDiv);instActive=inst;inst.dpDiv.empty().append(this._generateHTML(inst));var cover=inst.dpDiv.find('iframe.ui-datepicker-cover');if(!!cover.length){cover.css({left:-borders[0],top:-borders[1],width:inst.dpDiv.outerWidth(),height:inst.dpDiv.outerHeight()})}
inst.dpDiv.find('.'+this._dayOverClass+' a').mouseover();var numMonths=this._getNumberOfMonths(inst);var cols=numMonths[1];var width=17;inst.dpDiv.removeClass('ui-datepicker-multi-2 ui-datepicker-multi-3 ui-datepicker-multi-4').width('');if(cols>1)
inst.dpDiv.addClass('ui-datepicker-multi-'+cols).css('width',(width*cols)+'em');inst.dpDiv[(numMonths[0]!=1||numMonths[1]!=1?'add':'remove')+'Class']('ui-datepicker-multi');inst.dpDiv[(this._get(inst,'isRTL')?'add':'remove')+'Class']('ui-datepicker-rtl');if(inst==$.datepicker._curInst&&$.datepicker._datepickerShowing&&inst.input&&inst.input.is(':visible')&&!inst.input.is(':disabled')&&inst.input[0]!=document.activeElement)
inst.input.focus();if(inst.yearshtml){var origyearshtml=inst.yearshtml;setTimeout(function(){if(origyearshtml===inst.yearshtml&&inst.yearshtml){inst.dpDiv.find('select.ui-datepicker-year:first').replaceWith(inst.yearshtml);}
origyearshtml=inst.yearshtml=null;},0);}},_getBorders:function(elem){var convert=function(value){return{thin:1,medium:2,thick:3}[value]||value;};return[parseFloat(convert(elem.css('border-left-width'))),parseFloat(convert(elem.css('border-top-width')))];},_checkOffset:function(inst,offset,isFixed){var dpWidth=inst.dpDiv.outerWidth();var dpHeight=inst.dpDiv.outerHeight();var inputWidth=inst.input?inst.input.outerWidth():0;var inputHeight=inst.input?inst.input.outerHeight():0;var viewWidth=document.documentElement.clientWidth+$(document).scrollLeft();var viewHeight=document.documentElement.clientHeight+$(document).scrollTop();offset.left-=(this._get(inst,'isRTL')?(dpWidth-inputWidth):0);offset.left-=(isFixed&&offset.left==inst.input.offset().left)?$(document).scrollLeft():0;offset.top-=(isFixed&&offset.top==(inst.input.offset().top+inputHeight))?$(document).scrollTop():0;offset.left-=Math.min(offset.left,(offset.left+dpWidth>viewWidth&&viewWidth>dpWidth)?Math.abs(offset.left+dpWidth-viewWidth):0);offset.top-=Math.min(offset.top,(offset.top+dpHeight>viewHeight&&viewHeight>dpHeight)?Math.abs(dpHeight+inputHeight):0);return offset;},_findPos:function(obj){var inst=this._getInst(obj);var isRTL=this._get(inst,'isRTL');while(obj&&(obj.type=='hidden'||obj.nodeType!=1||$.expr.filters.hidden(obj))){obj=obj[isRTL?'previousSibling':'nextSibling'];}
var position=$(obj).offset();return[position.left,position.top];},_triggerOnClose:function(inst){var onClose=this._get(inst,'onClose');if(onClose)
onClose.apply((inst.input?inst.input[0]:null),[(inst.input?inst.input.val():''),inst]);},_hideDatepicker:function(input){var inst=this._curInst;if(!inst||(input&&inst!=$.data(input,PROP_NAME)))
return;if(this._datepickerShowing){var showAnim=this._get(inst,'showAnim');var duration=this._get(inst,'duration');var postProcess=function(){$.datepicker._tidyDialog(inst);this._curInst=null;};if($.effects&&($.effects.effect[showAnim]||$.effects[showAnim]))
inst.dpDiv.hide(showAnim,$.datepicker._get(inst,'showOptions'),duration,postProcess);else
inst.dpDiv[(showAnim=='slideDown'?'slideUp':(showAnim=='fadeIn'?'fadeOut':'hide'))]((showAnim?duration:null),postProcess);if(!showAnim)
postProcess();$.datepicker._triggerOnClose(inst);this._datepickerShowing=false;this._lastInput=null;if(this._inDialog){this._dialogInput.css({position:'absolute',left:'0',top:'-100px'});if($.blockUI){$.unblockUI();$('body').append(this.dpDiv);}}
this._inDialog=false;}},_tidyDialog:function(inst){inst.dpDiv.removeClass(this._dialogClass).unbind('.ui-datepicker-calendar');},_checkExternalClick:function(event){if(!$.datepicker._curInst)
return;var $target=$(event.target);if($target[0].id!=$.datepicker._mainDivId&&$target.parents('#'+$.datepicker._mainDivId).length==0&&!$target.hasClass($.datepicker.markerClassName)&&!$target.hasClass($.datepicker._triggerClass)&&$.datepicker._datepickerShowing&&!($.datepicker._inDialog&&$.blockUI))
$.datepicker._hideDatepicker();},_adjustDate:function(id,offset,period){var target=$(id);var inst=this._getInst(target[0]);if(this._isDisabledDatepicker(target[0])){return;}
this._adjustInstDate(inst,offset+
(period=='M'?this._get(inst,'showCurrentAtPos'):0),period);this._updateDatepicker(inst);},_gotoToday:function(id){var target=$(id);var inst=this._getInst(target[0]);if(this._get(inst,'gotoCurrent')&&inst.currentDay){inst.selectedDay=inst.currentDay;inst.drawMonth=inst.selectedMonth=inst.currentMonth;inst.drawYear=inst.selectedYear=inst.currentYear;}
else{var date=new Date();inst.selectedDay=date.getDate();inst.drawMonth=inst.selectedMonth=date.getMonth();inst.drawYear=inst.selectedYear=date.getFullYear();}
this._notifyChange(inst);this._adjustDate(target);},_selectMonthYear:function(id,select,period){var target=$(id);var inst=this._getInst(target[0]);inst['selected'+(period=='M'?'Month':'Year')]=inst['draw'+(period=='M'?'Month':'Year')]=parseInt(select.options[select.selectedIndex].value,10);this._notifyChange(inst);this._adjustDate(target);},_selectDay:function(id,month,year,td){var target=$(id);if($(td).hasClass(this._unselectableClass)||this._isDisabledDatepicker(target[0])){return;}
var inst=this._getInst(target[0]);inst.selectedDay=inst.currentDay=$('a',td).html();inst.selectedMonth=inst.currentMonth=month;inst.selectedYear=inst.currentYear=year;this._selectDate(id,this._formatDate(inst,inst.currentDay,inst.currentMonth,inst.currentYear));},_clearDate:function(id){var target=$(id);var inst=this._getInst(target[0]);this._selectDate(target,'');},_selectDate:function(id,dateStr){var target=$(id);var inst=this._getInst(target[0]);dateStr=(dateStr!=null?dateStr:this._formatDate(inst));if(inst.input)
inst.input.val(dateStr);this._updateAlternate(inst);var onSelect=this._get(inst,'onSelect');if(onSelect)
onSelect.apply((inst.input?inst.input[0]:null),[dateStr,inst]);else if(inst.input)
inst.input.trigger('change');if(inst.inline)
this._updateDatepicker(inst);else{this._hideDatepicker();this._lastInput=inst.input[0];if(typeof(inst.input[0])!='object')
inst.input.focus();this._lastInput=null;}},_updateAlternate:function(inst){var altField=this._get(inst,'altField');if(altField){var altFormat=this._get(inst,'altFormat')||this._get(inst,'dateFormat');var date=this._getDate(inst);var dateStr=this.formatDate(altFormat,date,this._getFormatConfig(inst));$(altField).each(function(){$(this).val(dateStr);});}},noWeekends:function(date){var day=date.getDay();return[(day>0&&day<6),''];},iso8601Week:function(date){var checkDate=new Date(date.getTime());checkDate.setDate(checkDate.getDate()+4-(checkDate.getDay()||7));var time=checkDate.getTime();checkDate.setMonth(0);checkDate.setDate(1);return Math.floor(Math.round((time-checkDate)/86400000)/7)+1;},parseDate:function(format,value,settings){if(format==null||value==null)
throw'Invalid arguments';value=(typeof value=='object'?value.toString():value+'');if(value=='')
return null;var shortYearCutoff=(settings?settings.shortYearCutoff:null)||this._defaults.shortYearCutoff;shortYearCutoff=(typeof shortYearCutoff!='string'?shortYearCutoff:new Date().getFullYear()%100+parseInt(shortYearCutoff,10));var dayNamesShort=(settings?settings.dayNamesShort:null)||this._defaults.dayNamesShort;var dayNames=(settings?settings.dayNames:null)||this._defaults.dayNames;var monthNamesShort=(settings?settings.monthNamesShort:null)||this._defaults.monthNamesShort;var monthNames=(settings?settings.monthNames:null)||this._defaults.monthNames;var year=-1;var month=-1;var day=-1;var doy=-1;var literal=false;var lookAhead=function(match){var matches=(iFormat+1<format.length&&format.charAt(iFormat+1)==match);if(matches)
iFormat++;return matches;};var getNumber=function(match){var isDoubled=lookAhead(match);var size=(match=='@'?14:(match=='!'?20:(match=='y'&&isDoubled?4:(match=='o'?3:2))));var digits=new RegExp('^\\d{1,'+size+'}');var num=value.substring(iValue).match(digits);if(!num)
throw'Missing number at position '+iValue;iValue+=num[0].length;return parseInt(num[0],10);};var getName=function(match,shortNames,longNames){var names=$.map(lookAhead(match)?longNames:shortNames,function(v,k){return[[k,v]];}).sort(function(a,b){return-(a[1].length-b[1].length);});var index=-1;$.each(names,function(i,pair){var name=pair[1];if(value.substr(iValue,name.length).toLowerCase()==name.toLowerCase()){index=pair[0];iValue+=name.length;return false;}});if(index!=-1)
return index+1;else
throw'Unknown name at position '+iValue;};var checkLiteral=function(){if(value.charAt(iValue)!=format.charAt(iFormat))
throw'Unexpected literal at position '+iValue;iValue++;};var iValue=0;for(var iFormat=0;iFormat<format.length;iFormat++){if(literal)
if(format.charAt(iFormat)=="'"&&!lookAhead("'"))
literal=false;else
checkLiteral();else
switch(format.charAt(iFormat)){case'd':day=getNumber('d');break;case'D':getName('D',dayNamesShort,dayNames);break;case'o':doy=getNumber('o');break;case'm':month=getNumber('m');break;case'M':month=getName('M',monthNamesShort,monthNames);break;case'y':year=getNumber('y');break;case'@':var date=new Date(getNumber('@'));year=date.getFullYear();month=date.getMonth()+1;day=date.getDate();break;case'!':var date=new Date((getNumber('!')-this._ticksTo1970)/10000);year=date.getFullYear();month=date.getMonth()+1;day=date.getDate();break;case"'":if(lookAhead("'"))
checkLiteral();else
literal=true;break;default:checkLiteral();}}
if(iValue<value.length){var extra=value.substr(iValue);if(!/^\s+/.test(extra)){throw"Extra/unparsed characters found in date: "+extra;}}
if(year==-1)
year=new Date().getFullYear();else if(year<100)
year+=new Date().getFullYear()-new Date().getFullYear()%100+
(year<=shortYearCutoff?0:-100);if(doy>-1){month=1;day=doy;do{var dim=this._getDaysInMonth(year,month-1);if(day<=dim)
break;month++;day-=dim;}while(true);}
var date=this._daylightSavingAdjust(new Date(year,month-1,day));if(date.getFullYear()!=year||date.getMonth()+1!=month||date.getDate()!=day)
throw'Invalid date';return date;},ATOM:'yy-mm-dd',COOKIE:'D, dd M yy',ISO_8601:'yy-mm-dd',RFC_822:'D, d M y',RFC_850:'DD, dd-M-y',RFC_1036:'D, d M y',RFC_1123:'D, d M yy',RFC_2822:'D, d M yy',RSS:'D, d M y',TICKS:'!',TIMESTAMP:'@',W3C:'yy-mm-dd',_ticksTo1970:(((1970-1)*365+Math.floor(1970/4)-Math.floor(1970/100)+
Math.floor(1970/400))*24*60*60*10000000),formatDate:function(format,date,settings){if(!date)
return'';var dayNamesShort=(settings?settings.dayNamesShort:null)||this._defaults.dayNamesShort;var dayNames=(settings?settings.dayNames:null)||this._defaults.dayNames;var monthNamesShort=(settings?settings.monthNamesShort:null)||this._defaults.monthNamesShort;var monthNames=(settings?settings.monthNames:null)||this._defaults.monthNames;var lookAhead=function(match){var matches=(iFormat+1<format.length&&format.charAt(iFormat+1)==match);if(matches)
iFormat++;return matches;};var formatNumber=function(match,value,len){var num=''+value;if(lookAhead(match))
while(num.length<len)
num='0'+num;return num;};var formatName=function(match,value,shortNames,longNames){return(lookAhead(match)?longNames[value]:shortNames[value]);};var output='';var literal=false;if(date)
for(var iFormat=0;iFormat<format.length;iFormat++){if(literal)
if(format.charAt(iFormat)=="'"&&!lookAhead("'"))
literal=false;else
output+=format.charAt(iFormat);else
switch(format.charAt(iFormat)){case'd':output+=formatNumber('d',date.getDate(),2);break;case'D':output+=formatName('D',date.getDay(),dayNamesShort,dayNames);break;case'o':output+=formatNumber('o',Math.round((new Date(date.getFullYear(),date.getMonth(),date.getDate()).getTime()-new Date(date.getFullYear(),0,0).getTime())/86400000),3);break;case'm':output+=formatNumber('m',date.getMonth()+1,2);break;case'M':output+=formatName('M',date.getMonth(),monthNamesShort,monthNames);break;case'y':output+=(lookAhead('y')?date.getFullYear():(date.getYear()%100<10?'0':'')+date.getYear()%100);break;case'@':output+=date.getTime();break;case'!':output+=date.getTime()*10000+this._ticksTo1970;break;case"'":if(lookAhead("'"))
output+="'";else
literal=true;break;default:output+=format.charAt(iFormat);}}
return output;},_possibleChars:function(format){var chars='';var literal=false;var lookAhead=function(match){var matches=(iFormat+1<format.length&&format.charAt(iFormat+1)==match);if(matches)
iFormat++;return matches;};for(var iFormat=0;iFormat<format.length;iFormat++)
if(literal)
if(format.charAt(iFormat)=="'"&&!lookAhead("'"))
literal=false;else
chars+=format.charAt(iFormat);else
switch(format.charAt(iFormat)){case'd':case'm':case'y':case'@':chars+='0123456789';break;case'D':case'M':return null;case"'":if(lookAhead("'"))
chars+="'";else
literal=true;break;default:chars+=format.charAt(iFormat);}
return chars;},_get:function(inst,name){return inst.settings[name]!==undefined?inst.settings[name]:this._defaults[name];},_setDateFromField:function(inst,noDefault){if(inst.input.val()==inst.lastVal){return;}
var dateFormat=this._get(inst,'dateFormat');var dates=inst.lastVal=inst.input?inst.input.val():null;var date,defaultDate;date=defaultDate=this._getDefaultDate(inst);var settings=this._getFormatConfig(inst);try{date=this.parseDate(dateFormat,dates,settings)||defaultDate;}catch(event){this.log(event);dates=(noDefault?'':dates);}
inst.selectedDay=date.getDate();inst.drawMonth=inst.selectedMonth=date.getMonth();inst.drawYear=inst.selectedYear=date.getFullYear();inst.currentDay=(dates?date.getDate():0);inst.currentMonth=(dates?date.getMonth():0);inst.currentYear=(dates?date.getFullYear():0);this._adjustInstDate(inst);},_getDefaultDate:function(inst){return this._restrictMinMax(inst,this._determineDate(inst,this._get(inst,'defaultDate'),new Date()));},_determineDate:function(inst,date,defaultDate){var offsetNumeric=function(offset){var date=new Date();date.setDate(date.getDate()+offset);return date;};var offsetString=function(offset){try{return $.datepicker.parseDate($.datepicker._get(inst,'dateFormat'),offset,$.datepicker._getFormatConfig(inst));}
catch(e){}
var date=(offset.toLowerCase().match(/^c/)?$.datepicker._getDate(inst):null)||new Date();var year=date.getFullYear();var month=date.getMonth();var day=date.getDate();var pattern=/([+-]?[0-9]+)\s*(d|D|w|W|m|M|y|Y)?/g;var matches=pattern.exec(offset);while(matches){switch(matches[2]||'d'){case'd':case'D':day+=parseInt(matches[1],10);break;case'w':case'W':day+=parseInt(matches[1],10)*7;break;case'm':case'M':month+=parseInt(matches[1],10);day=Math.min(day,$.datepicker._getDaysInMonth(year,month));break;case'y':case'Y':year+=parseInt(matches[1],10);day=Math.min(day,$.datepicker._getDaysInMonth(year,month));break;}
matches=pattern.exec(offset);}
return new Date(year,month,day);};var newDate=(date==null||date===''?defaultDate:(typeof date=='string'?offsetString(date):(typeof date=='number'?(isNaN(date)?defaultDate:offsetNumeric(date)):new Date(date.getTime()))));newDate=(newDate&&newDate.toString()=='Invalid Date'?defaultDate:newDate);if(newDate){newDate.setHours(0);newDate.setMinutes(0);newDate.setSeconds(0);newDate.setMilliseconds(0);}
return this._daylightSavingAdjust(newDate);},_daylightSavingAdjust:function(date){if(!date)return null;date.setHours(date.getHours()>12?date.getHours()+2:0);return date;},_setDate:function(inst,date,noChange){var clear=!date;var origMonth=inst.selectedMonth;var origYear=inst.selectedYear;var newDate=this._restrictMinMax(inst,this._determineDate(inst,date,new Date()));inst.selectedDay=inst.currentDay=newDate.getDate();inst.drawMonth=inst.selectedMonth=inst.currentMonth=newDate.getMonth();inst.drawYear=inst.selectedYear=inst.currentYear=newDate.getFullYear();if((origMonth!=inst.selectedMonth||origYear!=inst.selectedYear)&&!noChange)
this._notifyChange(inst);this._adjustInstDate(inst);if(inst.input){inst.input.val(clear?'':this._formatDate(inst));}},_getDate:function(inst){var startDate=(!inst.currentYear||(inst.input&&inst.input.val()=='')?null:this._daylightSavingAdjust(new Date(inst.currentYear,inst.currentMonth,inst.currentDay)));return startDate;},_generateHTML:function(inst){var today=new Date();today=this._daylightSavingAdjust(new Date(today.getFullYear(),today.getMonth(),today.getDate()));var isRTL=this._get(inst,'isRTL');var showButtonPanel=this._get(inst,'showButtonPanel');var hideIfNoPrevNext=this._get(inst,'hideIfNoPrevNext');var navigationAsDateFormat=this._get(inst,'navigationAsDateFormat');var numMonths=this._getNumberOfMonths(inst);var showCurrentAtPos=this._get(inst,'showCurrentAtPos');var stepMonths=this._get(inst,'stepMonths');var isMultiMonth=(numMonths[0]!=1||numMonths[1]!=1);var currentDate=this._daylightSavingAdjust((!inst.currentDay?new Date(9999,9,9):new Date(inst.currentYear,inst.currentMonth,inst.currentDay)));var minDate=this._getMinMaxDate(inst,'min');var maxDate=this._getMinMaxDate(inst,'max');var drawMonth=inst.drawMonth-showCurrentAtPos;var drawYear=inst.drawYear;if(drawMonth<0){drawMonth+=12;drawYear--;}
if(maxDate){var maxDraw=this._daylightSavingAdjust(new Date(maxDate.getFullYear(),maxDate.getMonth()-(numMonths[0]*numMonths[1])+1,maxDate.getDate()));maxDraw=(minDate&&maxDraw<minDate?minDate:maxDraw);while(this._daylightSavingAdjust(new Date(drawYear,drawMonth,1))>maxDraw){drawMonth--;if(drawMonth<0){drawMonth=11;drawYear--;}}}
inst.drawMonth=drawMonth;inst.drawYear=drawYear;var prevText=this._get(inst,'prevText');prevText=(!navigationAsDateFormat?prevText:this.formatDate(prevText,this._daylightSavingAdjust(new Date(drawYear,drawMonth-stepMonths,1)),this._getFormatConfig(inst)));var prev=(this._canAdjustMonth(inst,-1,drawYear,drawMonth)?'<a class="ui-datepicker-prev ui-corner-all" onclick="DP_jQuery_'+dpuuid+'.datepicker._adjustDate(\'#'+inst.id+'\', -'+stepMonths+', \'M\');"'+' title="'+prevText+'"><span class="ui-icon ui-icon-circle-triangle-'+(isRTL?'e':'w')+'">'+prevText+'</span></a>':(hideIfNoPrevNext?'':'<a class="ui-datepicker-prev ui-corner-all ui-state-disabled" title="'+prevText+'"><span class="ui-icon ui-icon-circle-triangle-'+(isRTL?'e':'w')+'">'+prevText+'</span></a>'));var nextText=this._get(inst,'nextText');nextText=(!navigationAsDateFormat?nextText:this.formatDate(nextText,this._daylightSavingAdjust(new Date(drawYear,drawMonth+stepMonths,1)),this._getFormatConfig(inst)));var next=(this._canAdjustMonth(inst,+1,drawYear,drawMonth)?'<a class="ui-datepicker-next ui-corner-all" onclick="DP_jQuery_'+dpuuid+'.datepicker._adjustDate(\'#'+inst.id+'\', +'+stepMonths+', \'M\');"'+' title="'+nextText+'"><span class="ui-icon ui-icon-circle-triangle-'+(isRTL?'w':'e')+'">'+nextText+'</span></a>':(hideIfNoPrevNext?'':'<a class="ui-datepicker-next ui-corner-all ui-state-disabled" title="'+nextText+'"><span class="ui-icon ui-icon-circle-triangle-'+(isRTL?'w':'e')+'">'+nextText+'</span></a>'));var currentText=this._get(inst,'currentText');var gotoDate=(this._get(inst,'gotoCurrent')&&inst.currentDay?currentDate:today);currentText=(!navigationAsDateFormat?currentText:this.formatDate(currentText,gotoDate,this._getFormatConfig(inst)));var controls=(!inst.inline?'<button type="button" class="ui-datepicker-close ui-state-default ui-priority-primary ui-corner-all" onclick="DP_jQuery_'+dpuuid+'.datepicker._hideDatepicker();">'+this._get(inst,'closeText')+'</button>':'');var buttonPanel=(showButtonPanel)?'<div class="ui-datepicker-buttonpane ui-widget-content">'+(isRTL?controls:'')+
(this._isInRange(inst,gotoDate)?'<button type="button" class="ui-datepicker-current ui-state-default ui-priority-secondary ui-corner-all" onclick="DP_jQuery_'+dpuuid+'.datepicker._gotoToday(\'#'+inst.id+'\');"'+'>'+currentText+'</button>':'')+(isRTL?'':controls)+'</div>':'';var firstDay=parseInt(this._get(inst,'firstDay'),10);firstDay=(isNaN(firstDay)?0:firstDay);var showWeek=this._get(inst,'showWeek');var dayNames=this._get(inst,'dayNames');var dayNamesShort=this._get(inst,'dayNamesShort');var dayNamesMin=this._get(inst,'dayNamesMin');var monthNames=this._get(inst,'monthNames');var monthNamesShort=this._get(inst,'monthNamesShort');var beforeShowDay=this._get(inst,'beforeShowDay');var showOtherMonths=this._get(inst,'showOtherMonths');var selectOtherMonths=this._get(inst,'selectOtherMonths');var calculateWeek=this._get(inst,'calculateWeek')||this.iso8601Week;var defaultDate=this._getDefaultDate(inst);var html='';for(var row=0;row<numMonths[0];row++){var group='';this.maxRows=4;for(var col=0;col<numMonths[1];col++){var selectedDate=this._daylightSavingAdjust(new Date(drawYear,drawMonth,inst.selectedDay));var cornerClass=' ui-corner-all';var calender='';if(isMultiMonth){calender+='<div class="ui-datepicker-group';if(numMonths[1]>1)
switch(col){case 0:calender+=' ui-datepicker-group-first';cornerClass=' ui-corner-'+(isRTL?'right':'left');break;case numMonths[1]-1:calender+=' ui-datepicker-group-last';cornerClass=' ui-corner-'+(isRTL?'left':'right');break;default:calender+=' ui-datepicker-group-middle';cornerClass='';break;}
calender+='">';}
calender+='<div class="ui-datepicker-header ui-widget-header ui-helper-clearfix'+cornerClass+'">'+
(/all|left/.test(cornerClass)&&row==0?(isRTL?next:prev):'')+
(/all|right/.test(cornerClass)&&row==0?(isRTL?prev:next):'')+
this._generateMonthYearHeader(inst,drawMonth,drawYear,minDate,maxDate,row>0||col>0,monthNames,monthNamesShort)+'</div><table class="ui-datepicker-calendar"><thead>'+'<tr>';var thead=(showWeek?'<th class="ui-datepicker-week-col">'+this._get(inst,'weekHeader')+'</th>':'');for(var dow=0;dow<7;dow++){var day=(dow+firstDay)%7;thead+='<th'+((dow+firstDay+6)%7>=5?' class="ui-datepicker-week-end"':'')+'>'+'<span title="'+dayNames[day]+'">'+dayNamesMin[day]+'</span></th>';}
calender+=thead+'</tr></thead><tbody>';var daysInMonth=this._getDaysInMonth(drawYear,drawMonth);if(drawYear==inst.selectedYear&&drawMonth==inst.selectedMonth)
inst.selectedDay=Math.min(inst.selectedDay,daysInMonth);var leadDays=(this._getFirstDayOfMonth(drawYear,drawMonth)-firstDay+7)%7;var curRows=Math.ceil((leadDays+daysInMonth)/7);var numRows=(isMultiMonth?this.maxRows>curRows?this.maxRows:curRows:curRows);this.maxRows=numRows;var printDate=this._daylightSavingAdjust(new Date(drawYear,drawMonth,1-leadDays));for(var dRow=0;dRow<numRows;dRow++){calender+='<tr>';var tbody=(!showWeek?'':'<td class="ui-datepicker-week-col">'+
this._get(inst,'calculateWeek')(printDate)+'</td>');for(var dow=0;dow<7;dow++){var daySettings=(beforeShowDay?beforeShowDay.apply((inst.input?inst.input[0]:null),[printDate]):[true,'']);var otherMonth=(printDate.getMonth()!=drawMonth);var unselectable=(otherMonth&&!selectOtherMonths)||!daySettings[0]||(minDate&&printDate<minDate)||(maxDate&&printDate>maxDate);tbody+='<td class="'+
((dow+firstDay+6)%7>=5?' ui-datepicker-week-end':'')+
(otherMonth?' ui-datepicker-other-month':'')+
((printDate.getTime()==selectedDate.getTime()&&drawMonth==inst.selectedMonth&&inst._keyEvent)||(defaultDate.getTime()==printDate.getTime()&&defaultDate.getTime()==selectedDate.getTime())?' '+this._dayOverClass:'')+
(unselectable?' '+this._unselectableClass+' ui-state-disabled':'')+
(otherMonth&&!showOtherMonths?'':' '+daySettings[1]+
(printDate.getTime()==currentDate.getTime()?' '+this._currentClass:'')+
(printDate.getTime()==today.getTime()?' ui-datepicker-today':''))+'"'+
((!otherMonth||showOtherMonths)&&daySettings[2]?' title="'+daySettings[2]+'"':'')+
(unselectable?'':' onclick="DP_jQuery_'+dpuuid+'.datepicker._selectDay(\'#'+
inst.id+'\','+printDate.getMonth()+','+printDate.getFullYear()+', this);return false;"')+'>'+
(otherMonth&&!showOtherMonths?'&#xa0;':(unselectable?'<span class="ui-state-default">'+printDate.getDate()+'</span>':'<a class="ui-state-default'+
(printDate.getTime()==today.getTime()?' ui-state-highlight':'')+
(printDate.getTime()==currentDate.getTime()?' ui-state-active':'')+
(otherMonth?' ui-priority-secondary':'')+'" href="#">'+printDate.getDate()+'</a>'))+'</td>';printDate.setDate(printDate.getDate()+1);printDate=this._daylightSavingAdjust(printDate);}
calender+=tbody+'</tr>';}
drawMonth++;if(drawMonth>11){drawMonth=0;drawYear++;}
calender+='</tbody></table>'+(isMultiMonth?'</div>'+
((numMonths[0]>0&&col==numMonths[1]-1)?'<div class="ui-datepicker-row-break"></div>':''):'');group+=calender;}
html+=group;}
html+=buttonPanel+($.browser.msie&&parseInt($.browser.version,10)<7&&!inst.inline?'<iframe src="javascript:false;" class="ui-datepicker-cover" frameborder="0"></iframe>':'');inst._keyEvent=false;return html;},_generateMonthYearHeader:function(inst,drawMonth,drawYear,minDate,maxDate,secondary,monthNames,monthNamesShort){var changeMonth=this._get(inst,'changeMonth');var changeYear=this._get(inst,'changeYear');var showMonthAfterYear=this._get(inst,'showMonthAfterYear');var html='<div class="ui-datepicker-title">';var monthHtml='';if(secondary||!changeMonth)
monthHtml+='<span class="ui-datepicker-month">'+monthNames[drawMonth]+'</span>';else{var inMinYear=(minDate&&minDate.getFullYear()==drawYear);var inMaxYear=(maxDate&&maxDate.getFullYear()==drawYear);monthHtml+='<select class="ui-datepicker-month" '+'onchange="DP_jQuery_'+dpuuid+'.datepicker._selectMonthYear(\'#'+inst.id+'\', this, \'M\');" '+'>';for(var month=0;month<12;month++){if((!inMinYear||month>=minDate.getMonth())&&(!inMaxYear||month<=maxDate.getMonth()))
monthHtml+='<option value="'+month+'"'+
(month==drawMonth?' selected="selected"':'')+'>'+monthNamesShort[month]+'</option>';}
monthHtml+='</select>';}
if(!showMonthAfterYear)
html+=monthHtml+(secondary||!(changeMonth&&changeYear)?'&#xa0;':'');if(!inst.yearshtml){inst.yearshtml='';if(secondary||!changeYear)
html+='<span class="ui-datepicker-year">'+drawYear+'</span>';else{var years=this._get(inst,'yearRange').split(':');var thisYear=new Date().getFullYear();var determineYear=function(value){var year=(value.match(/c[+-].*/)?drawYear+parseInt(value.substring(1),10):(value.match(/[+-].*/)?thisYear+parseInt(value,10):parseInt(value,10)));return(isNaN(year)?thisYear:year);};var year=determineYear(years[0]);var endYear=Math.max(year,determineYear(years[1]||''));year=(minDate?Math.max(year,minDate.getFullYear()):year);endYear=(maxDate?Math.min(endYear,maxDate.getFullYear()):endYear);inst.yearshtml+='<select class="ui-datepicker-year" '+'onchange="DP_jQuery_'+dpuuid+'.datepicker._selectMonthYear(\'#'+inst.id+'\', this, \'Y\');" '+'>';for(;year<=endYear;year++){inst.yearshtml+='<option value="'+year+'"'+
(year==drawYear?' selected="selected"':'')+'>'+year+'</option>';}
inst.yearshtml+='</select>';html+=inst.yearshtml;inst.yearshtml=null;}}
html+=this._get(inst,'yearSuffix');if(showMonthAfterYear)
html+=(secondary||!(changeMonth&&changeYear)?'&#xa0;':'')+monthHtml;html+='</div>';return html;},_adjustInstDate:function(inst,offset,period){var year=inst.drawYear+(period=='Y'?offset:0);var month=inst.drawMonth+(period=='M'?offset:0);var day=Math.min(inst.selectedDay,this._getDaysInMonth(year,month))+
(period=='D'?offset:0);var date=this._restrictMinMax(inst,this._daylightSavingAdjust(new Date(year,month,day)));inst.selectedDay=date.getDate();inst.drawMonth=inst.selectedMonth=date.getMonth();inst.drawYear=inst.selectedYear=date.getFullYear();if(period=='M'||period=='Y')
this._notifyChange(inst);},_restrictMinMax:function(inst,date){var minDate=this._getMinMaxDate(inst,'min');var maxDate=this._getMinMaxDate(inst,'max');var newDate=(minDate&&date<minDate?minDate:date);newDate=(maxDate&&newDate>maxDate?maxDate:newDate);return newDate;},_notifyChange:function(inst){var onChange=this._get(inst,'onChangeMonthYear');if(onChange)
onChange.apply((inst.input?inst.input[0]:null),[inst.selectedYear,inst.selectedMonth+1,inst]);},_getNumberOfMonths:function(inst){var numMonths=this._get(inst,'numberOfMonths');return(numMonths==null?[1,1]:(typeof numMonths=='number'?[1,numMonths]:numMonths));},_getMinMaxDate:function(inst,minMax){return this._determineDate(inst,this._get(inst,minMax+'Date'),null);},_getDaysInMonth:function(year,month){return 32-this._daylightSavingAdjust(new Date(year,month,32)).getDate();},_getFirstDayOfMonth:function(year,month){return new Date(year,month,1).getDay();},_canAdjustMonth:function(inst,offset,curYear,curMonth){var numMonths=this._getNumberOfMonths(inst);var date=this._daylightSavingAdjust(new Date(curYear,curMonth+(offset<0?offset:numMonths[0]*numMonths[1]),1));if(offset<0)
date.setDate(this._getDaysInMonth(date.getFullYear(),date.getMonth()));return this._isInRange(inst,date);},_isInRange:function(inst,date){var minDate=this._getMinMaxDate(inst,'min');var maxDate=this._getMinMaxDate(inst,'max');return((!minDate||date.getTime()>=minDate.getTime())&&(!maxDate||date.getTime()<=maxDate.getTime()));},_getFormatConfig:function(inst){var shortYearCutoff=this._get(inst,'shortYearCutoff');shortYearCutoff=(typeof shortYearCutoff!='string'?shortYearCutoff:new Date().getFullYear()%100+parseInt(shortYearCutoff,10));return{shortYearCutoff:shortYearCutoff,dayNamesShort:this._get(inst,'dayNamesShort'),dayNames:this._get(inst,'dayNames'),monthNamesShort:this._get(inst,'monthNamesShort'),monthNames:this._get(inst,'monthNames')};},_formatDate:function(inst,day,month,year){if(!day){inst.currentDay=inst.selectedDay;inst.currentMonth=inst.selectedMonth;inst.currentYear=inst.selectedYear;}
var date=(day?(typeof day=='object'?day:this._daylightSavingAdjust(new Date(year,month,day))):this._daylightSavingAdjust(new Date(inst.currentYear,inst.currentMonth,inst.currentDay)));return this.formatDate(this._get(inst,'dateFormat'),date,this._getFormatConfig(inst));}});function bindHover(dpDiv){var selector='button, .ui-datepicker-prev, .ui-datepicker-next, .ui-datepicker-calendar td a';return dpDiv.delegate(selector,'mouseout',function(){$(this).removeClass('ui-state-hover');if(this.className.indexOf('ui-datepicker-prev')!=-1)$(this).removeClass('ui-datepicker-prev-hover');if(this.className.indexOf('ui-datepicker-next')!=-1)$(this).removeClass('ui-datepicker-next-hover');}).delegate(selector,'mouseover',function(){if(!$.datepicker._isDisabledDatepicker(instActive.inline?dpDiv.parent()[0]:instActive.input[0])){$(this).parents('.ui-datepicker-calendar').find('a').removeClass('ui-state-hover');$(this).addClass('ui-state-hover');if(this.className.indexOf('ui-datepicker-prev')!=-1)$(this).addClass('ui-datepicker-prev-hover');if(this.className.indexOf('ui-datepicker-next')!=-1)$(this).addClass('ui-datepicker-next-hover');}});}
function extendRemove(target,props){$.extend(target,props);for(var name in props)
if(props[name]==null||props[name]==undefined)
target[name]=props[name];return target;};function isArray(a){return(a&&(($.browser.safari&&typeof a=='object'&&a.length)||(a.constructor&&a.constructor.toString().match(/\Array\(\)/))));};$.fn.datepicker=function(options){if(!this.length){return this;}
if(!$.datepicker.initialized){$(document).mousedown($.datepicker._checkExternalClick).find('body').append($.datepicker.dpDiv);$.datepicker.initialized=true;}
var otherArgs=Array.prototype.slice.call(arguments,1);if(typeof options=='string'&&(options=='isDisabled'||options=='getDate'||options=='widget'))
return $.datepicker['_'+options+'Datepicker'].apply($.datepicker,[this[0]].concat(otherArgs));if(options=='option'&&arguments.length==2&&typeof arguments[1]=='string')
return $.datepicker['_'+options+'Datepicker'].apply($.datepicker,[this[0]].concat(otherArgs));return this.each(function(){typeof options=='string'?$.datepicker['_'+options+'Datepicker'].apply($.datepicker,[this].concat(otherArgs)):$.datepicker._attachDatepicker(this,options);});};$.datepicker=new Datepicker();$.datepicker.initialized=false;$.datepicker.uuid=new Date().getTime();$.datepicker.version="1.9m6";window['DP_jQuery_'+dpuuid]=$;})(jQuery);(function($,undefined){var uiDialogClasses="ui-dialog ui-widget ui-widget-content ui-corner-all ",sizeRelatedOptions={buttons:true,height:true,maxHeight:true,maxWidth:true,minHeight:true,minWidth:true,width:true},resizableRelatedOptions={maxHeight:true,maxWidth:true,minHeight:true,minWidth:true};$.widget("ui.dialog",{version:"1.9m6",options:{autoOpen:true,buttons:{},closeOnEscape:true,closeText:"close",dialogClass:"",draggable:true,hide:null,height:"auto",maxHeight:false,maxWidth:false,minHeight:150,minWidth:150,modal:false,position:{my:"center",at:"center",of:window,collision:"fit",using:function(pos){var topOffset=$(this).css(pos).offset().top;if(topOffset<0){$(this).css("top",pos.top-topOffset);}}},resizable:true,show:null,stack:true,title:"",width:300,zIndex:1000},_create:function(){this.originalTitle=this.element.attr("title");if(typeof this.originalTitle!=="string"){this.originalTitle="";}
this.options.title=this.options.title||this.originalTitle;var self=this,options=self.options,title=options.title||"&#160;",titleId=$.ui.dialog.getTitleId(self.element),uiDialog=(self.uiDialog=$("<div>")).addClass(uiDialogClasses+options.dialogClass).css({display:"none",outline:0,zIndex:options.zIndex}).attr("tabIndex",-1).keydown(function(event){if(options.closeOnEscape&&!event.isDefaultPrevented()&&event.keyCode&&event.keyCode===$.ui.keyCode.ESCAPE){self.close(event);event.preventDefault();}}).attr({role:"dialog","aria-labelledby":titleId}).mousedown(function(event){self.moveToTop(false,event);}).appendTo("body"),uiDialogContent=self.element.show().removeAttr("title").addClass("ui-dialog-content ui-widget-content").appendTo(uiDialog),uiDialogTitlebar=(self.uiDialogTitlebar=$("<div>")).addClass("ui-dialog-titlebar  ui-widget-header  "+"ui-corner-all  ui-helper-clearfix").prependTo(uiDialog),uiDialogTitlebarClose=$("<a href='#'></a>").addClass("ui-dialog-titlebar-close  ui-corner-all").attr("role","button").click(function(event){event.preventDefault();self.close(event);}).appendTo(uiDialogTitlebar),uiDialogTitlebarCloseText=(self.uiDialogTitlebarCloseText=$("<span>")).addClass("ui-icon ui-icon-closethick").text(options.closeText).appendTo(uiDialogTitlebarClose),uiDialogTitle=$("<span>").addClass("ui-dialog-title").attr("id",titleId).html(title).prependTo(uiDialogTitlebar);uiDialogTitlebar.find("*").add(uiDialogTitlebar).disableSelection();this._hoverable(uiDialogTitlebarClose);this._focusable(uiDialogTitlebarClose);if(options.draggable&&$.fn.draggable){self._makeDraggable();}
if(options.resizable&&$.fn.resizable){self._makeResizable();}
self._createButtons(options.buttons);self._isOpen=false;if($.fn.bgiframe){uiDialog.bgiframe();}},_init:function(){if(this.options.autoOpen){this.open();}},_destroy:function(){var self=this;if(self.overlay){self.overlay.destroy();}
self.uiDialog.hide();self.element.removeClass("ui-dialog-content ui-widget-content").hide().appendTo("body");self.uiDialog.remove();if(self.originalTitle){self.element.attr("title",self.originalTitle);}},widget:function(){return this.uiDialog;},close:function(event){if(!this._isOpen){return self;}
var self=this,maxZ,thisZ;if(false===self._trigger("beforeClose",event)){return;}
self._isOpen=false;if(self.overlay){self.overlay.destroy();}
self.uiDialog.unbind("keypress.ui-dialog");if(self.options.hide){self.uiDialog.hide(self.options.hide,function(){self._trigger("close",event);});}else{self.uiDialog.hide();self._trigger("close",event);}
$.ui.dialog.overlay.resize();if(self.options.modal){maxZ=0;$(".ui-dialog").each(function(){if(this!==self.uiDialog[0]){thisZ=$(this).css("z-index");if(!isNaN(thisZ)){maxZ=Math.max(maxZ,thisZ);}}});$.ui.dialog.maxZ=maxZ;}
return self;},isOpen:function(){return this._isOpen;},moveToTop:function(force,event){var self=this,options=self.options,saveScroll;if((options.modal&&!force)||(!options.stack&&!options.modal)){return self._trigger("focus",event);}
if(options.zIndex>$.ui.dialog.maxZ){$.ui.dialog.maxZ=options.zIndex;}
if(self.overlay){$.ui.dialog.maxZ+=1;$.ui.dialog.overlay.maxZ=$.ui.dialog.maxZ;self.overlay.$el.css("z-index",$.ui.dialog.overlay.maxZ);}
saveScroll={scrollTop:self.element.scrollTop(),scrollLeft:self.element.scrollLeft()};$.ui.dialog.maxZ+=1;self.uiDialog.css("z-index",$.ui.dialog.maxZ);self.element.attr(saveScroll);self._trigger("focus",event);return self;},open:function(){if(this._isOpen){return;}
var self=this,options=self.options,uiDialog=self.uiDialog;self._size();self._position(options.position);uiDialog.show(options.show);self.overlay=options.modal?new $.ui.dialog.overlay(self):null;self.moveToTop(true);if(options.modal){uiDialog.bind("keydown.ui-dialog",function(event){if(event.keyCode!==$.ui.keyCode.TAB){return;}
var tabbables=$(":tabbable",this),first=tabbables.filter(":first"),last=tabbables.filter(":last");if(event.target===last[0]&&!event.shiftKey){first.focus(1);return false;}else if(event.target===first[0]&&event.shiftKey){last.focus(1);return false;}});}
var hasFocus=self.element.find(":tabbable");if(!hasFocus.length){hasFocus=uiDialog.find(".ui-dialog-buttonpane :tabbable");if(!hasFocus.length){hasFocus=uiDialog;}}
hasFocus.eq(0).focus();self._isOpen=true;self._trigger("open");return self;},_createButtons:function(buttons){var self=this,hasButtons=false;self.uiDialog.find(".ui-dialog-buttonpane").remove();if(typeof buttons==="object"&&buttons!==null){$.each(buttons,function(){return!(hasButtons=true);});}
if(hasButtons){var uiDialogButtonPane=$("<div>").addClass("ui-dialog-buttonpane  ui-widget-content ui-helper-clearfix"),uiButtonSet=$("<div>").addClass("ui-dialog-buttonset").appendTo(uiDialogButtonPane);$.each(buttons,function(name,props){props=$.isFunction(props)?{click:props,text:name}:props;var button=$("<button type='button'>").attr(props,true).unbind("click").click(function(){props.click.apply(self.element[0],arguments);}).appendTo(uiButtonSet);if($.fn.button){button.button();}});self.uiDialog.addClass("ui-dialog-buttons");uiDialogButtonPane.appendTo(self.uiDialog);}else{self.uiDialog.removeClass("ui-dialog-buttons");}},_makeDraggable:function(){var self=this,options=self.options,doc=$(document);function filteredUi(ui){return{position:ui.position,offset:ui.offset};}
self.uiDialog.draggable({cancel:".ui-dialog-content, .ui-dialog-titlebar-close",handle:".ui-dialog-titlebar",containment:"document",start:function(event,ui){$(this).addClass("ui-dialog-dragging");self._trigger("dragStart",event,filteredUi(ui));},drag:function(event,ui){self._trigger("drag",event,filteredUi(ui));},stop:function(event,ui){options.position=[ui.position.left-doc.scrollLeft(),ui.position.top-doc.scrollTop()];$(this).removeClass("ui-dialog-dragging");self._trigger("dragStop",event,filteredUi(ui));$.ui.dialog.overlay.resize();}});},_makeResizable:function(handles){handles=(handles===undefined?this.options.resizable:handles);var self=this,options=self.options,position=self.uiDialog.css("position"),resizeHandles=typeof handles==='string'?handles:"n,e,s,w,se,sw,ne,nw";function filteredUi(ui){return{originalPosition:ui.originalPosition,originalSize:ui.originalSize,position:ui.position,size:ui.size};}
self.uiDialog.resizable({cancel:".ui-dialog-content",containment:"document",alsoResize:self.element,maxWidth:options.maxWidth,maxHeight:options.maxHeight,minWidth:options.minWidth,minHeight:self._minHeight(),handles:resizeHandles,start:function(event,ui){$(this).addClass("ui-dialog-resizing");self._trigger("resizeStart",event,filteredUi(ui));},resize:function(event,ui){self._trigger("resize",event,filteredUi(ui));},stop:function(event,ui){$(this).removeClass("ui-dialog-resizing");options.height=$(this).height();options.width=$(this).width();self._trigger("resizeStop",event,filteredUi(ui));$.ui.dialog.overlay.resize();}}).css("position",position).find(".ui-resizable-se").addClass("ui-icon ui-icon-grip-diagonal-se");},_minHeight:function(){var options=this.options;if(options.height==="auto"){return options.minHeight;}else{return Math.min(options.minHeight,options.height);}},_position:function(position){var myAt=[],offset=[0,0],isVisible;if(position){if(typeof position==="string"||(typeof position==="object"&&"0"in position)){myAt=position.split?position.split(" "):[position[0],position[1]];if(myAt.length===1){myAt[1]=myAt[0];}
$.each(["left","top"],function(i,offsetPosition){if(+myAt[i]===myAt[i]){offset[i]=myAt[i];myAt[i]=offsetPosition;}});position={my:myAt.join(" "),at:myAt.join(" "),offset:offset.join(" ")};}
position=$.extend({},$.ui.dialog.prototype.options.position,position);}else{position=$.ui.dialog.prototype.options.position;}
isVisible=this.uiDialog.is(":visible");if(!isVisible){this.uiDialog.show();}
this.uiDialog.position(position);if(!isVisible){this.uiDialog.hide();}},_setOptions:function(options){var self=this,resizableOptions={},resize=false;$.each(options,function(key,value){self._setOption(key,value);if(key in sizeRelatedOptions){resize=true;}
if(key in resizableRelatedOptions){resizableOptions[key]=value;}});if(resize){this._size();}
if(this.uiDialog.is(":data(resizable)")){this.uiDialog.resizable("option",resizableOptions);}},_setOption:function(key,value){var self=this,uiDialog=self.uiDialog;switch(key){case"buttons":self._createButtons(value);break;case"closeText":self.uiDialogTitlebarCloseText.text(""+value);break;case"dialogClass":uiDialog.removeClass(self.options.dialogClass).addClass(uiDialogClasses+value);break;case"disabled":if(value){uiDialog.addClass("ui-dialog-disabled");}else{uiDialog.removeClass("ui-dialog-disabled");}
break;case"draggable":var isDraggable=uiDialog.is(":data(draggable)");if(isDraggable&&!value){uiDialog.draggable("destroy");}
if(!isDraggable&&value){self._makeDraggable();}
break;case"position":self._position(value);break;case"resizable":var isResizable=uiDialog.is(":data(resizable)");if(isResizable&&!value){uiDialog.resizable("destroy");}
if(isResizable&&typeof value==="string"){uiDialog.resizable("option","handles",value);}
if(!isResizable&&value!==false){self._makeResizable(value);}
break;case"title":$(".ui-dialog-title",self.uiDialogTitlebar).html(""+(value||"&#160;"));break;}
this._super("_setOption",key,value);},_size:function(){var options=this.options,nonContentHeight,minContentHeight,isVisible=this.uiDialog.is(":visible");this.element.show().css({width:"auto",minHeight:0,height:0});if(options.minWidth>options.width){options.width=options.minWidth;}
nonContentHeight=this.uiDialog.css({height:"auto",width:options.width}).height();minContentHeight=Math.max(0,options.minHeight-nonContentHeight);if(options.height==="auto"){if($.support.minHeight){this.element.css({minHeight:minContentHeight,height:"auto"});}else{this.uiDialog.show();var autoHeight=this.element.css("height","auto").height();if(!isVisible){this.uiDialog.hide();}
this.element.height(Math.max(autoHeight,minContentHeight));}}else{this.element.height(Math.max(options.height-nonContentHeight,0));}
if(this.uiDialog.is(":data(resizable)")){this.uiDialog.resizable("option","minHeight",this._minHeight());}}});$.extend($.ui.dialog,{uuid:0,maxZ:0,getTitleId:function($el){var id=$el.attr("id");if(!id){this.uuid+=1;id=this.uuid;}
return"ui-dialog-title-"+id;},overlay:function(dialog){this.$el=$.ui.dialog.overlay.create(dialog);}});$.extend($.ui.dialog.overlay,{instances:[],oldInstances:[],maxZ:0,events:$.map("focus,mousedown,mouseup,keydown,keypress,click".split(","),function(event){return event+".dialog-overlay";}).join(" "),create:function(dialog){if(this.instances.length===0){setTimeout(function(){if($.ui.dialog.overlay.instances.length){$(document).bind($.ui.dialog.overlay.events,function(event){if($(event.target).zIndex()<$.ui.dialog.overlay.maxZ){return false;}});}},1);$(document).bind("keydown.dialog-overlay",function(event){if(dialog.options.closeOnEscape&&!event.isDefaultPrevented()&&event.keyCode&&event.keyCode===$.ui.keyCode.ESCAPE){dialog.close(event);event.preventDefault();}});$(window).bind("resize.dialog-overlay",$.ui.dialog.overlay.resize);}
var $el=(this.oldInstances.pop()||$("<div>").addClass("ui-widget-overlay")).appendTo(document.body).css({width:this.width(),height:this.height()});if($.fn.bgiframe){$el.bgiframe();}
this.instances.push($el);return $el;},destroy:function($el){var indexOf=$.inArray($el,this.instances);if(indexOf!==-1){this.oldInstances.push(this.instances.splice(indexOf,1)[0]);}
if(this.instances.length===0){$([document,window]).unbind(".dialog-overlay");}
$el.height(0).width(0).remove();var maxZ=0;$.each(this.instances,function(){maxZ=Math.max(maxZ,this.css("z-index"));});this.maxZ=maxZ;},height:function(){var scrollHeight,offsetHeight;if($.browser.msie){scrollHeight=Math.max(document.documentElement.scrollHeight,document.body.scrollHeight);offsetHeight=Math.max(document.documentElement.offsetHeight,document.body.offsetHeight);if(scrollHeight<offsetHeight){return $(window).height()+"px";}else{return scrollHeight+"px";}}else{return $(document).height()+"px";}},width:function(){var scrollWidth,offsetWidth;if($.browser.msie){scrollWidth=Math.max(document.documentElement.scrollWidth,document.body.scrollWidth);offsetWidth=Math.max(document.documentElement.offsetWidth,document.body.offsetWidth);if(scrollWidth<offsetWidth){return $(window).width()+"px";}else{return scrollWidth+"px";}}else{return $(document).width()+"px";}},resize:function(){var $overlays=$([]);$.each($.ui.dialog.overlay.instances,function(){$overlays=$overlays.add(this);});$overlays.css({width:0,height:0}).css({width:$.ui.dialog.overlay.width(),height:$.ui.dialog.overlay.height()});}});$.extend($.ui.dialog.overlay.prototype,{destroy:function(){$.ui.dialog.overlay.destroy(this.$el);}});}(jQuery));(function($){var idIncrement=0;var collapseSetup=0;var collapseMenus={};function collapseHandler(event){if(!$(event.target).closest(".ui-menu").length){for(var menuId in collapseMenus){if(collapseMenus.hasOwnProperty(menuId)){collapseMenus[menuId].collapseAll(event);}}}}
function setupCollapseBehaviour(menu){if(collapseMenus[menu.menuId]){return;}
collapseMenus[menu.menuId]=menu;if(!collapseSetup++){$('body').click(collapseHandler);}}
function teardownCollapseBehaviour(menu){if(!collapseMenus[menu.menuId]){return;}
delete collapseMenus[menu.menuId];if(collapseSetup&&!--collapseSetup){$('body').unbind('click',collapseHandler);}}
$.widget("ui.menu",{version:"1.9m6",defaultElement:"<ul>",delay:150,options:{position:{my:"left top",at:"right top"}},_create:function(){this.activeMenu=this.element;this.menuId=this.element.attr("id")||"ui-menu-"+idIncrement++;if(this.element.find(".ui-icon").length){this.element.addClass("ui-menu-icons");}
this.element.addClass("ui-menu ui-widget ui-widget-content ui-corner-all").attr({id:this.menuId,role:"menu"}).bind("click.menu",$.proxy(function(event){if(this.options.disabled){event.preventDefault();}},this));this._bind({"click .ui-menu-item:has(a)":function(event){event.stopImmediatePropagation();var target=$(event.currentTarget);if(!this.active||(this.active[0]!==target[0])){this.focus(event,target);}
this.select(event);},"mouseover .ui-menu-item":function(event){event.stopImmediatePropagation();var target=$(event.currentTarget);target.siblings().children(".ui-state-active").removeClass("ui-state-active");this.focus(event,target);},"mouseleave":"_mouseleave","mouseleave .ui-menu":"_mouseleave","mouseout .ui-menu-item":"blur","focus":function(event){this.focus(event,$(event.target).children(".ui-menu-item:first"));},"blur":"collapseAll"});this.refresh();this.element.attr("tabIndex",0);this._bind({"keydown":function(event){switch(event.keyCode){case $.ui.keyCode.PAGE_UP:this.previousPage(event);event.preventDefault();event.stopImmediatePropagation();break;case $.ui.keyCode.PAGE_DOWN:this.nextPage(event);event.preventDefault();event.stopImmediatePropagation();break;case $.ui.keyCode.HOME:this._move("first","first",event);event.preventDefault();event.stopImmediatePropagation();break;case $.ui.keyCode.END:this._move("last","last",event);event.preventDefault();event.stopImmediatePropagation();break;case $.ui.keyCode.UP:this.previous(event);event.preventDefault();event.stopImmediatePropagation();break;case $.ui.keyCode.DOWN:this.next(event);event.preventDefault();event.stopImmediatePropagation();break;case $.ui.keyCode.LEFT:if(this.collapse(event)){event.stopImmediatePropagation();}
event.preventDefault();break;case $.ui.keyCode.RIGHT:if(this.expand(event)){event.stopImmediatePropagation();}
event.preventDefault();break;case $.ui.keyCode.ENTER:if(this.active.children("a[aria-haspopup='true']").length){if(this.expand(event)){event.stopImmediatePropagation();}}
else{this.select(event);event.stopImmediatePropagation();}
event.preventDefault();break;case $.ui.keyCode.ESCAPE:if(this.collapse(event)){event.stopImmediatePropagation();}
event.preventDefault();break;default:event.stopPropagation();clearTimeout(this.filterTimer);var match,prev=this.previousFilter||"",character=String.fromCharCode(event.keyCode),skip=false;if(character==prev){skip=true;}else{character=prev+character;}
function escape(value){return value.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&");}
match=this.activeMenu.children(".ui-menu-item").filter(function(){return new RegExp("^"+escape(character),"i").test($(this).children("a").text());});match=skip&&match.index(this.active.next())!=-1?this.active.nextAll(".ui-menu-item"):match;if(!match.length){character=String.fromCharCode(event.keyCode);match=this.activeMenu.children(".ui-menu-item").filter(function(){return new RegExp("^"+escape(character),"i").test($(this).children("a").text());});}
if(match.length){this.focus(event,match);if(match.length>1){this.previousFilter=character;this.filterTimer=this._delay(function(){delete this.previousFilter;},1000);}else{delete this.previousFilter;}}else{delete this.previousFilter;}}}});},_destroy:function(){this.element.removeAttr("aria-activedescendant").find("ul").andSelf().removeClass("ui-menu ui-widget ui-widget-content ui-corner-all").removeAttr("role").removeAttr("tabIndex").removeAttr("aria-labelledby").removeAttr("aria-expanded").removeAttr("aria-hidden").show();this.element.find(".ui-menu-item").unbind(".menu").removeClass("ui-menu-item").removeAttr("role").children("a").removeClass("ui-corner-all ui-state-hover").removeAttr("tabIndex").removeAttr("role").removeAttr("aria-haspopup").removeAttr("id").children(".ui-icon").remove();},refresh:function(){var submenus=this.element.find("ul:not(.ui-menu)").addClass("ui-menu ui-widget ui-widget-content ui-corner-all").attr("role","menu").hide().attr("aria-hidden","true").attr("aria-expanded","false");var menuId=this.menuId;submenus.add(this.element).children("li:not(.ui-menu-item):has(a)").addClass("ui-menu-item").attr("role","presentation").children("a").addClass("ui-corner-all").attr("tabIndex",-1).attr("role","menuitem").attr("id",function(i){return menuId+"-"+i;});submenus.each(function(){var menu=$(this),item=menu.prev("a");item.attr("aria-haspopup","true").prepend('<span class="ui-menu-icon ui-icon ui-icon-carat-1-e"></span>');menu.attr("aria-labelledby",item.attr("id"));});},focus:function(event,item){this.blur(event);if(this._hasScroll()){var borderTop=parseFloat($.curCSS(this.activeMenu[0],"borderTopWidth",true))||0,paddingTop=parseFloat($.curCSS(this.activeMenu[0],"paddingTop",true))||0,offset=item.offset().top-this.activeMenu.offset().top-borderTop-paddingTop,scroll=this.activeMenu.scrollTop(),elementHeight=this.activeMenu.height(),itemHeight=item.height();if(offset<0){this.activeMenu.scrollTop(scroll+offset);}else if(offset+itemHeight>elementHeight){this.activeMenu.scrollTop(scroll+offset-elementHeight+itemHeight);}}
this.active=item.first().children("a").addClass("ui-state-focus").end();this.element.attr("aria-activedescendant",this.active.children("a").attr("id"));this.active.parent().closest(".ui-menu-item").children("a:first").addClass("ui-state-active");this.timer=this._delay(function(){this._close();},this.delay);var nested=$(">ul",item);if(nested.length&&(/^mouse/.test(event.type))){this._startOpening(nested);}
this.activeMenu=item.parent();this._trigger("focus",event,{item:item});},blur:function(event){if(!this.active){return;}
clearTimeout(this.timer);this.active.children("a").removeClass("ui-state-focus");this.active=null;this._trigger("blur",event,{item:this.active});},_startOpening:function(submenu){clearTimeout(this.timer);if(submenu.attr("aria-hidden")!=="true"){return;}
this.timer=this._delay(function(){this._close();this._open(submenu);},this.delay);},_open:function(submenu){clearTimeout(this.timer);this.element.find(".ui-menu").not(submenu.parents()).hide().attr("aria-hidden","true");var position=$.extend({},{of:this.active},$.type(this.options.position)=="function"?this.options.position(this.active):this.options.position);submenu.show().removeAttr("aria-hidden").attr("aria-expanded","true").position(position);setupCollapseBehaviour(this);},collapseAll:function(event){var currentMenu=false;if(event){var target=$(event.target);if(target.is("ui.menu")){currentMenu=target;}else if(target.closest(".ui-menu").length){currentMenu=target.closest(".ui-menu");}}
this._close(currentMenu);if(!currentMenu){this.blur(event);this.activeMenu=this.element;}},_close:function(startMenu){if(!startMenu){startMenu=this.active?this.active.parent():this.element;}
startMenu.find("ul").hide().attr("aria-hidden","true").attr("aria-expanded","false").end().find("a.ui-state-active").removeClass("ui-state-active");if(startMenu[0]===this.element[0]){teardownCollapseBehaviour(this);}},collapse:function(event){var newItem=this.active&&this.active.parents("li:not(.ui-menubar-item)").first();if(newItem&&newItem.length){this._close();this.focus(event,newItem);return true;}},expand:function(event){var newItem=this.active&&this.active.children("ul").children("li").first();if(newItem&&newItem.length){this._open(newItem.parent());this._delay(function(){this.focus(event,newItem);},20);return true;}},next:function(event){this._move("next","first",event);},previous:function(event){this._move("prev","last",event);},first:function(){return this.active&&!this.active.prevAll(".ui-menu-item").length;},last:function(){return this.active&&!this.active.nextAll(".ui-menu-item").length;},_move:function(direction,filter,event){if(!this.active){this.focus(event,this.activeMenu.children(".ui-menu-item")[filter]());return;}
var next;if(direction==="first"||direction==="last"){next=this.active[direction==="first"?"prevAll":"nextAll"](".ui-menu-item").eq(-1);}else{next=this.active[direction+"All"](".ui-menu-item").eq(0);}
if(next.length){this.focus(event,next);}else{this.focus(event,this.activeMenu.children(".ui-menu-item")[filter]());}},nextPage:function(event){if(this._hasScroll()){if(!this.active){this.focus(event,this.activeMenu.children(".ui-menu-item").first());return;}
if(this.last()){return;}
var base=this.active.offset().top,height=this.element.height(),result;this.active.nextAll(".ui-menu-item").each(function(){result=$(this);return $(this).offset().top-base-height<0;});this.focus(event,result);}else{this.focus(event,this.activeMenu.children(".ui-menu-item")
[!this.active?"first":"last"]());}},previousPage:function(event){if(this._hasScroll()){if(!this.active){this.focus(event,this.activeMenu.children(".ui-menu-item").first());return;}
if(this.first()){return;}
var base=this.active.offset().top,height=this.element.height(),result;this.active.prevAll(".ui-menu-item").each(function(){result=$(this);return $(this).offset().top-base+height>0;});this.focus(event,result);}else{this.focus(event,this.activeMenu.children(".ui-menu-item").first());}},_hasScroll:function(){return this.element.height()<this.element.prop("scrollHeight");},_mouseleave:function(event){this.collapseAll(event);this.blur();},select:function(event){var ui={item:this.active};this.collapseAll(event);this._trigger("select",event,ui);}});}(jQuery));(function($){$.widget("ui.menubar",{version:"1.9m6",options:{autoExpand:false,buttons:false,menuIcon:false,position:{my:"left top",at:"left bottom"}},_create:function(){var that=this;var items=this.items=this.element.children("li").addClass("ui-menubar-item").attr("role","presentation").children("button, a");items.slice(1).attr("tabIndex",-1);this.element.addClass("ui-menubar ui-widget-header ui-helper-clearfix").attr("role","menubar");this._focusable(items);this._hoverable(items);items.next("ul").menu({position:{within:this.options.position.within},select:function(event,ui){ui.item.parents("ul.ui-menu:last").hide();that._close();$(event.target).prev().focus();that._trigger("select",event,ui);}}).hide().attr({"aria-hidden":"true","aria-expanded":"false"}).bind("keydown.menubar",function(event){var menu=$(this);if(menu.is(":hidden"))
return;switch(event.keyCode){case $.ui.keyCode.LEFT:that._left(event);event.preventDefault();break;case $.ui.keyCode.RIGHT:that._right(event);event.preventDefault();break;};});items.each(function(){var input=$(this),menu=input.next("ul");input.bind("click.menubar focus.menubar mouseenter.menubar",function(event){if(event.type=="focus"&&!event.originalEvent){return;}
event.preventDefault();if(event.type=="click"&&menu.is(":visible")&&that.active&&that.active[0]==menu[0]){that._close();return;}
if((that.open&&event.type=="mouseenter")||event.type=="click"||that.options.autoExpand){if(that.options.autoExpand){clearTimeout(that.timer);}
that._open(event,menu);}}).bind("keydown",function(event){switch(event.keyCode){case $.ui.keyCode.SPACE:case $.ui.keyCode.UP:case $.ui.keyCode.DOWN:that._open(event,$(this).next());event.preventDefault();break;case $.ui.keyCode.LEFT:that._prev(event,$(this));event.preventDefault();break;case $.ui.keyCode.RIGHT:that._next(event,$(this));event.preventDefault();break;}}).addClass("ui-button ui-widget ui-button-text-only ui-menubar-link").attr("role","menuitem").attr("aria-haspopup","true").wrapInner("<span class='ui-button-text'></span>");if(that.options.autoExpand){input.bind("mouseleave.menubar",function(event){that.timer=setTimeout(function(){that._close();},150);});menu.bind("mouseleave.menubar",function(event){that.timer=setTimeout(function(){that._close();},150);}).bind("mouseenter.menubar",function(event){clearTimeout(that.timer);});}
if(that.options.menuIcon){input.addClass("ui-state-default").append("<span class='ui-button-icon-secondary ui-icon ui-icon-triangle-1-s'></span>");input.removeClass("ui-button-text-only").addClass("ui-button-text-icon-secondary");}
if(!that.options.buttons){input.addClass("ui-menubar-link").removeClass("ui-state-default");};});that._bind({keydown:function(event){if(event.keyCode==$.ui.keyCode.ESCAPE&&that.active&&that.active.menu("collapse",event)!==true){var active=that.active;that.active.blur();that._close(event);active.prev().focus();}},focusin:function(event){clearTimeout(that.closeTimer);},focusout:function(event){that.closeTimer=setTimeout(function(){that._close(event);},100);}});},_destroy:function(){var items=this.element.children("li").removeClass("ui-menubar-item").removeAttr("role").children("button, a");this.element.removeClass("ui-menubar ui-widget-header ui-helper-clearfix").removeAttr("role").unbind(".menubar");items.unbind(".menubar").removeClass("ui-button ui-widget ui-button-text-only ui-menubar-link ui-state-default").removeAttr("role").removeAttr("aria-haspopup").children("span.ui-button-text").each(function(i,e){var item=$(this);item.parent().html(item.html());}).end().children(".ui-icon").remove();this.element.find(":ui-menu").menu("destroy").show().removeAttr("aria-hidden").removeAttr("aria-expanded").removeAttr("tabindex").unbind(".menubar");},_close:function(){if(!this.active||!this.active.length)
return;this.active.menu("collapseAll").hide().attr({"aria-hidden":"true","aria-expanded":"false"});this.active.prev().removeClass("ui-state-active").removeAttr("tabIndex");this.active=null;this.open=false;},_open:function(event,menu){if(this.active&&this.active[0]==menu[0]){return;}
if(this.active){this.active.menu("collapseAll").hide().attr({"aria-hidden":"true","aria-expanded":"false"});this.active.prev().removeClass("ui-state-active");}
var button=menu.prev().addClass("ui-state-active").attr("tabIndex",-1);this.active=menu.show().position($.extend({of:button},this.options.position)).removeAttr("aria-hidden").attr("aria-expanded","true").menu("focus",event,menu.children("li").first()).focus().focusin();this.open=true;},_prev:function(event,button){button.attr("tabIndex",-1);var prev=button.parent().prevAll("li").children(".ui-button").eq(0);if(prev.length){prev.removeAttr("tabIndex")[0].focus();}else{var lastItem=this.element.children("li:last").children(".ui-button:last");lastItem.removeAttr("tabIndex")[0].focus();}},_next:function(event,button){button.attr("tabIndex",-1);var next=button.parent().nextAll("li").children(".ui-button").eq(0);if(next.length){next.removeAttr("tabIndex")[0].focus();}else{var firstItem=this.element.children("li:first").children(".ui-button:first");firstItem.removeAttr("tabIndex")[0].focus();}},_left:function(event){var prev=this.active.parent().prevAll("li:eq(0)").children(".ui-menu").eq(0);if(prev.length){this._open(event,prev);}else{var lastItem=this.element.children("li:last").children(".ui-menu:first");this._open(event,lastItem);}},_right:function(event){var next=this.active.parent().nextAll("li:eq(0)").children(".ui-menu").eq(0);if(next.length){this._open(event,next);}else{var firstItem=this.element.children("li:first").children(".ui-menu:first");this._open(event,firstItem);}}});}(jQuery));(function($){var idIncrement=0;$.widget("ui.popup",{version:"1.9m6",options:{position:{my:"left top",at:"left bottom"}},_create:function(){if(!this.options.trigger){this.options.trigger=this.element.prev();}
if(!this.element.attr("id")){this.element.attr("id","ui-popup-"+idIncrement++);this.generatedId=true;}
if(!this.element.attr("role")){this.element.attr("role","dialog");this.generatedRole=true;}
this.options.trigger.attr("aria-haspopup","true").attr("aria-owns",this.element.attr("id"));this.element.addClass("ui-popup");this.close();this._bind(this.options.trigger,{keydown:function(event){if($.ui.button&&this.options.trigger.is("a:ui-button")&&event.keyCode==$.ui.keyCode.SPACE){event.preventDefault();}
if(event.keyCode==$.ui.keyCode.SPACE&&this.options.trigger.is("a:not(:ui-button)")){this.options.trigger.trigger("click",event);}
if(event.keyCode==$.ui.keyCode.DOWN){event.preventDefault();this.options.trigger.trigger("click",event);}},click:function(event){event.preventDefault();if(this.isOpen){return;}
clearTimeout(this.closeTimer);this._delay(function(){this.open(event);},1);}});if(!this.element.is(":ui-menu")){this._bind({keydown:function(event){if(event.keyCode!==$.ui.keyCode.TAB){return;}
var tabbables=$(":tabbable",this.element),first=tabbables.first(),last=tabbables.last();if(event.target===last[0]&&!event.shiftKey){first.focus(1);event.preventDefault();}else if(event.target===first[0]&&event.shiftKey){last.focus(1);event.preventDefault();}}});}
this._bind({focusout:function(event){this.closeTimer=this._delay(function(){this.close(event);},100);},focusin:function(event){clearTimeout(this.closeTimer);}});this._bind({keyup:function(event){if(event.keyCode==$.ui.keyCode.ESCAPE&&this.element.is(":visible")){this.close(event);this.options.trigger.focus();}}});this._bind(document,{click:function(event){if(this.isOpen&&!$(event.target).closest(".ui-popup").length){this.close(event);}}})},_destroy:function(){this.element.show().removeClass("ui-popup").removeAttr("aria-hidden").removeAttr("aria-expanded").unbind("keypress.ui-popup");this.options.trigger.removeAttr("aria-haspopup").removeAttr("aria-owns");if(this.generatedId){this.element.removeAttr("id");}
if(this.generatedRole){this.element.removeAttr("role");}},open:function(event){var position=$.extend({},{of:this.options.trigger},this.options.position);this.element.show().attr("aria-hidden","false").attr("aria-expanded","true").position(position);if(this.element.is(":ui-menu")){this.element.menu("focus",event,this.element.children("li").first());this.element.focus();}else{var tabbables=this.element.find(":tabbable");this.removeTabIndex=false;if(!tabbables.length){if(!this.element.is(":tabbable")){this.element.attr("tabindex","0");this.removeTabIndex=true;}
tabbables=tabbables.add(this.element[0]);}
tabbables.first().focus(1);}
this.options.trigger.attr("tabindex",-1);this.isOpen=true;this._trigger("open",event);},close:function(event){this.element.hide().attr("aria-hidden","true").attr("aria-expanded","false");this.options.trigger.attr("tabindex",0);if(this.removeTabIndex){this.element.removeAttr("tabindex");}
this.isOpen=false;this._trigger("close",event);}});}(jQuery));(function($,undefined){$.ui=$.ui||{};var rhorizontal=/left|center|right/,rvertical=/top|center|bottom/,roffset=/[+-]\d+%?/,rposition=/^\w+/,rpercent=/%$/,center="center",_position=$.fn.position;$.position={scrollbarWidth:function(){var w1,w2,div=$("<div style='display:block;width:50px;height:50px;overflow:hidden;'><div style='height:100px;width:auto;'></div></div>"),innerDiv=div.children()[0];$("body").append(div);w1=innerDiv.offsetWidth;div.css("overflow","scroll");w2=innerDiv.offsetWidth;if(w1===w2){w2=div[0].clientWidth;}
div.remove();return w1-w2;},getScrollInfo:function(within){var notWindow=within[0]!==window,overflowX=notWindow?within.css("overflow-x"):"",overflowY=notWindow?within.css("overflow-y"):"",scrollbarWidth=overflowX==="auto"||overflowX==="scroll"?$.position.scrollbarWidth():0,scrollbarHeight=overflowY==="auto"||overflowY==="scroll"?$.position.scrollbarWidth():0;return{height:within.height()<within[0].scrollHeight?scrollbarHeight:0,width:within.width()<within[0].scrollWidth?scrollbarWidth:0};}};$.fn.position=function(options){if(!options||!options.of){return _position.apply(this,arguments);}
options=$.extend({},options);var target=$(options.of),within=$(options.within||window),targetElem=target[0],collision=(options.collision||"flip").split(" "),offsets={},atOffset,targetWidth,targetHeight,basePosition;if(targetElem.nodeType===9){targetWidth=target.width();targetHeight=target.height();basePosition={top:0,left:0};}else if($.isWindow(targetElem)){targetWidth=target.width();targetHeight=target.height();basePosition={top:target.scrollTop(),left:target.scrollLeft()};}else if(targetElem.preventDefault){options.at="left top";targetWidth=targetHeight=0;basePosition={top:options.of.pageY,left:options.of.pageX};}else{targetWidth=target.outerWidth();targetHeight=target.outerHeight();basePosition=target.offset();}
$.each(["my","at"],function(){var pos=(options[this]||"").split(" "),horizontalOffset,verticalOffset;if(pos.length===1){pos=rhorizontal.test(pos[0])?pos.concat([center]):rvertical.test(pos[0])?[center].concat(pos):[center,center];}
pos[0]=rhorizontal.test(pos[0])?pos[0]:center;pos[1]=rvertical.test(pos[1])?pos[1]:center;horizontalOffset=roffset.exec(pos[0]);verticalOffset=roffset.exec(pos[1]);offsets[this]=[horizontalOffset?horizontalOffset[0]:0,verticalOffset?verticalOffset[0]:0];options[this]=[rposition.exec(pos[0])[0],rposition.exec(pos[1])[0]];});if(collision.length===1){collision[1]=collision[0];}
if(options.at[0]==="right"){basePosition.left+=targetWidth;}else if(options.at[0]===center){basePosition.left+=targetWidth/2;}
if(options.at[1]==="bottom"){basePosition.top+=targetHeight;}else if(options.at[1]===center){basePosition.top+=targetHeight/2;}
atOffset=[parseInt(offsets.at[0],10)*(rpercent.test(offsets.at[0])?targetWidth/100:1),parseInt(offsets.at[1],10)*(rpercent.test(offsets.at[1])?targetHeight/100:1)];basePosition.left+=atOffset[0];basePosition.top+=atOffset[1];return this.each(function(){var elem=$(this),elemWidth=elem.outerWidth(),elemHeight=elem.outerHeight(),marginLeft=parseInt($.curCSS(this,"marginLeft",true))||0,marginTop=parseInt($.curCSS(this,"marginTop",true))||0,scrollInfo=$.position.getScrollInfo(within),collisionWidth=elemWidth+marginLeft+
(parseInt($.curCSS(this,"marginRight",true))||0)+scrollInfo.width,collisionHeight=elemHeight+marginTop+
(parseInt($.curCSS(this,"marginBottom",true))||0)+scrollInfo.height,position=$.extend({},basePosition),myOffset=[parseInt(offsets.my[0],10)*(rpercent.test(offsets.my[0])?elem.outerWidth()/100:1),parseInt(offsets.my[1],10)*(rpercent.test(offsets.my[1])?elem.outerHeight()/100:1)],collisionPosition;if(options.my[0]==="right"){position.left-=elemWidth;}else if(options.my[0]===center){position.left-=elemWidth/2;}
if(options.my[1]==="bottom"){position.top-=elemHeight;}else if(options.my[1]===center){position.top-=elemHeight/2;}
position.left+=myOffset[0];position.top+=myOffset[1];collisionPosition={marginLeft:marginLeft,marginTop:marginTop};$.each(["left","top"],function(i,dir){if($.ui.position[collision[i]]){$.ui.position[collision[i]][dir](position,{targetWidth:targetWidth,targetHeight:targetHeight,elemWidth:elemWidth,elemHeight:elemHeight,collisionPosition:collisionPosition,collisionWidth:collisionWidth,collisionHeight:collisionHeight,offset:[atOffset[0]+myOffset[0],atOffset[1]+myOffset[1]],my:options.my,at:options.at,within:within,elem:elem});}});if($.fn.bgiframe){elem.bgiframe();}
elem.offset($.extend(position,{using:options.using}));});};$.ui.position={fit:{left:function(position,data){var within=data.within,win=$(window),isWindow=$.isWindow(data.within[0]),withinOffset=isWindow?win.scrollLeft():within.offset().left,outerWidth=isWindow?win.width():within.outerWidth(),collisionPosLeft=position.left-data.collisionPosition.marginLeft,overLeft=withinOffset-collisionPosLeft,overRight=collisionPosLeft+data.collisionWidth-outerWidth-withinOffset,newOverRight,newOverLeft;if(data.collisionWidth>outerWidth){if(overLeft>0&&overRight<=0){newOverRight=position.left+overLeft+data.collisionWidth-outerWidth-withinOffset;position.left+=overLeft-newOverRight;}else if(overRight>0&&overLeft<=0){position.left=withinOffset;}else{if(overLeft>overRight){position.left=withinOffset+outerWidth-data.collisionWidth;}else{position.left=withinOffset;}}}else if(overLeft>0){position.left+=overLeft;}else if(overRight>0){position.left-=overRight;}else{position.left=Math.max(position.left-collisionPosLeft,position.left);}},top:function(position,data){var within=data.within,win=$(window),isWindow=$.isWindow(data.within[0]),withinOffset=isWindow?win.scrollTop():within.offset().top,outerHeight=isWindow?win.height():within.outerHeight(),collisionPosTop=position.top-data.collisionPosition.marginTop,overTop=withinOffset-collisionPosTop,overBottom=collisionPosTop+data.collisionHeight-outerHeight-withinOffset,newOverTop,newOverBottom;if(data.collisionHeight>outerHeight){if(overTop>0&&overBottom<=0){newOverBottom=position.top+overTop+data.collisionHeight-outerHeight-withinOffset;position.top+=overTop-newOverBottom;}else if(overBottom>0&&overTop<=0){position.top=withinOffset;}else{if(overTop>overBottom){position.top=withinOffset+outerHeight-data.collisionHeight;}else{position.top=withinOffset;}}}else if(overTop>0){position.top+=overTop;}else if(overBottom>0){position.top-=overBottom;}else{position.top=Math.max(position.top-collisionPosTop,position.top);}}},flip:{left:function(position,data){if(data.at[0]===center){return;}
data.elem.removeClass("ui-flipped-left ui-flipped-right");var within=data.within,win=$(window),isWindow=$.isWindow(data.within[0]),withinOffset=(isWindow?0:within.offset().left)+within.scrollLeft(),outerWidth=isWindow?within.width():within.outerWidth(),collisionPosLeft=position.left-data.collisionPosition.marginLeft,overLeft=collisionPosLeft-withinOffset,overRight=collisionPosLeft+data.collisionWidth-outerWidth-withinOffset,left=data.my[0]==="left",myOffset=data.my[0]==="left"?-data.elemWidth:data.my[0]==="right"?data.elemWidth:0,atOffset=data.at[0]==="left"?data.targetWidth:-data.targetWidth,offset=-2*data.offset[0],newOverRight,newOverLeft;if(overLeft<0){newOverRight=position.left+myOffset+atOffset+offset+data.collisionWidth-outerWidth-withinOffset;if(newOverRight<0||newOverRight<Math.abs(overLeft)){data.elem.addClass("ui-flipped-right");position.left+=myOffset+atOffset+offset;}}
else if(overRight>0){newOverLeft=position.left-data.collisionPosition.marginLeft+myOffset+atOffset+offset-withinOffset;if(newOverLeft>0||Math.abs(newOverLeft)<overRight){data.elem.addClass("ui-flipped-left");position.left+=myOffset+atOffset+offset;}}},top:function(position,data){if(data.at[1]===center){return;}
data.elem.removeClass("ui-flipped-top ui-flipped-bottom");var within=data.within,win=$(window),isWindow=$.isWindow(data.within[0]),withinOffset=(isWindow?0:within.offset().top)+within.scrollTop(),outerHeight=isWindow?within.height():within.outerHeight(),collisionPosTop=position.top-data.collisionPosition.marginTop,overTop=collisionPosTop-withinOffset,overBottom=collisionPosTop+data.collisionHeight-outerHeight-withinOffset,top=data.my[1]==="top",myOffset=top?-data.elemHeight:data.my[1]==="bottom"?data.elemHeight:0,atOffset=data.at[1]==="top"?data.targetHeight:-data.targetHeight,offset=-2*data.offset[1],newOverTop,newOverBottom;if(overTop<0){newOverBottom=position.top+myOffset+atOffset+offset+data.collisionHeight-outerHeight-withinOffset;if(newOverBottom<0||newOverBottom<Math.abs(overTop)){data.elem.addClass("ui-flipped-bottom");position.top+=myOffset+atOffset+offset;}}
else if(overBottom>0){newOverTop=position.top-data.collisionPosition.marginTop+myOffset+atOffset+offset-withinOffset;if(newOverTop>0||Math.abs(newOverTop)<overBottom){data.elem.addClass("ui-flipped-top");position.top+=myOffset+atOffset+offset;}}}},flipfit:{left:function(){$.ui.position.flip.left.apply(this,arguments);$.ui.position.fit.left.apply(this,arguments);},top:function(){$.ui.position.flip.top.apply(this,arguments);$.ui.position.fit.top.apply(this,arguments);}}};if($.uiBackCompat!==false){(function($){var _position=$.fn.position;$.fn.position=function(options){if(!options||!options.offset){return _position.call(this,options);}
var offset=options.offset.split(" "),at=options.at.split(" ");if(offset.length===1){offset[1]=offset[0];}
if(/^\d/.test(offset[0])){offset[0]="+"+offset[0];}
if(/^\d/.test(offset[1])){offset[1]="+"+offset[1];}
if(at.length===1){if(/left|center|right/.test(at[0])){at[1]="center";}else{at[1]=at[0];at[0]="center";}}
return _position.call(this,$.extend(options,{at:at[0]+offset[0]+" "+at[1]+offset[1],offset:undefined}));}}(jQuery));}}(jQuery));(function($,undefined){$.widget("ui.progressbar",{version:"1.9m6",options:{value:0,max:100},min:0,_create:function(){this.element.addClass("ui-progressbar ui-widget ui-widget-content ui-corner-all").attr({role:"progressbar","aria-valuemin":this.min,"aria-valuemax":this.options.max,"aria-valuenow":this._value()});this.valueDiv=$("<div class='ui-progressbar-value ui-widget-header ui-corner-left'></div>").appendTo(this.element);this.oldValue=this._value();this._refreshValue();},_destroy:function(){this.element.removeClass("ui-progressbar ui-widget ui-widget-content ui-corner-all").removeAttr("role").removeAttr("aria-valuemin").removeAttr("aria-valuemax").removeAttr("aria-valuenow");this.valueDiv.remove();},value:function(newValue){if(newValue===undefined){return this._value();}
this._setOption("value",newValue);return this;},_setOption:function(key,value){if(key==="value"){this.options.value=value;this._refreshValue();if(this._value()===this.options.max){this._trigger("complete");}}
this._super("_setOption",key,value);},_value:function(){var val=this.options.value;if(typeof val!=="number"){val=0;}
return Math.min(this.options.max,Math.max(this.min,val));},_percentage:function(){return 100*this._value()/this.options.max;},_refreshValue:function(){var value=this.value();var percentage=this._percentage();if(this.oldValue!==value){this.oldValue=value;this._trigger("change");}
this.valueDiv.toggle(value>this.min).toggleClass("ui-corner-right",value===this.options.max).width(percentage.toFixed(0)+"%");this.element.attr("aria-valuenow",value);}});})(jQuery);(function($,undefined){var numPages=5;$.widget("ui.slider",$.ui.mouse,{version:"1.9m6",widgetEventPrefix:"slide",options:{animate:false,distance:0,max:100,min:0,orientation:"horizontal",range:false,step:1,value:0,values:null},_create:function(){var self=this,o=this.options,existingHandles=this.element.find(".ui-slider-handle").addClass("ui-state-default ui-corner-all"),handle="<a class='ui-slider-handle ui-state-default ui-corner-all' href='#'></a>",handleCount=(o.values&&o.values.length)||1,handles=[];this._keySliding=false;this._mouseSliding=false;this._animateOff=true;this._handleIndex=null;this._detectOrientation();this._mouseInit();this.element.addClass("ui-slider"+" ui-slider-"+this.orientation+" ui-widget"+" ui-widget-content"+" ui-corner-all"+
(o.disabled?" ui-slider-disabled ui-disabled":""));this.range=$([]);if(o.range){if(o.range===true){if(!o.values){o.values=[this._valueMin(),this._valueMin()];}
if(o.values.length&&o.values.length!==2){o.values=[o.values[0],o.values[0]];}}
this.range=$("<div></div>").appendTo(this.element).addClass("ui-slider-range"+" ui-widget-header"+
((o.range==="min"||o.range==="max")?" ui-slider-range-"+o.range:""));}
for(var i=existingHandles.length;i<handleCount;i+=1){handles.push(handle);}
this.handles=existingHandles.add($(handles.join("")).appendTo(self.element));this.handle=this.handles.eq(0);this.handles.add(this.range).filter("a").click(function(event){event.preventDefault();}).hover(function(){if(!o.disabled){$(this).addClass("ui-state-hover");}},function(){$(this).removeClass("ui-state-hover");}).focus(function(){if(!o.disabled){$(".ui-slider .ui-state-focus").removeClass("ui-state-focus");$(this).addClass("ui-state-focus");}else{$(this).blur();}}).blur(function(){$(this).removeClass("ui-state-focus");});this.handles.each(function(i){$(this).data("index.ui-slider-handle",i);});this.handles.keydown(function(event){var ret=true,index=$(this).data("index.ui-slider-handle"),allowed,curVal,newVal,step;if(self.options.disabled){return;}
switch(event.keyCode){case $.ui.keyCode.HOME:case $.ui.keyCode.END:case $.ui.keyCode.PAGE_UP:case $.ui.keyCode.PAGE_DOWN:case $.ui.keyCode.UP:case $.ui.keyCode.RIGHT:case $.ui.keyCode.DOWN:case $.ui.keyCode.LEFT:ret=false;if(!self._keySliding){self._keySliding=true;$(this).addClass("ui-state-active");allowed=self._start(event,index);if(allowed===false){return;}}
break;}
step=self.options.step;if(self.options.values&&self.options.values.length){curVal=newVal=self.values(index);}else{curVal=newVal=self.value();}
switch(event.keyCode){case $.ui.keyCode.HOME:newVal=self._valueMin();break;case $.ui.keyCode.END:newVal=self._valueMax();break;case $.ui.keyCode.PAGE_UP:newVal=self._trimAlignValue(curVal+((self._valueMax()-self._valueMin())/numPages));break;case $.ui.keyCode.PAGE_DOWN:newVal=self._trimAlignValue(curVal-((self._valueMax()-self._valueMin())/numPages));break;case $.ui.keyCode.UP:case $.ui.keyCode.RIGHT:if(curVal===self._valueMax()){return;}
newVal=self._trimAlignValue(curVal+step);break;case $.ui.keyCode.DOWN:case $.ui.keyCode.LEFT:if(curVal===self._valueMin()){return;}
newVal=self._trimAlignValue(curVal-step);break;}
self._slide(event,index,newVal);return ret;}).keyup(function(event){var index=$(this).data("index.ui-slider-handle");if(self._keySliding){self._keySliding=false;self._stop(event,index);self._change(event,index);$(this).removeClass("ui-state-active");}});this._refreshValue();this._animateOff=false;},destroy:function(){this.handles.remove();this.range.remove();this.element.removeClass("ui-slider"+" ui-slider-horizontal"+" ui-slider-vertical"+" ui-slider-disabled"+" ui-widget"+" ui-widget-content"+" ui-corner-all").removeData("slider").unbind(".slider");this._mouseDestroy();return this;},_mouseCapture:function(event){var o=this.options,position,normValue,distance,closestHandle,self,index,allowed,offset,mouseOverHandle;if(o.disabled){return false;}
this.elementSize={width:this.element.outerWidth(),height:this.element.outerHeight()};this.elementOffset=this.element.offset();position={x:event.pageX,y:event.pageY};normValue=this._normValueFromMouse(position);distance=this._valueMax()-this._valueMin()+1;self=this;this.handles.each(function(i){var thisDistance=Math.abs(normValue-self.values(i));if(distance>thisDistance){distance=thisDistance;closestHandle=$(this);index=i;}});if(o.range===true&&this.values(1)===o.min){index+=1;closestHandle=$(this.handles[index]);}
allowed=this._start(event,index);if(allowed===false){return false;}
this._mouseSliding=true;self._handleIndex=index;closestHandle.addClass("ui-state-active").focus();offset=closestHandle.offset();mouseOverHandle=!$(event.target).parents().andSelf().is(".ui-slider-handle");this._clickOffset=mouseOverHandle?{left:0,top:0}:{left:event.pageX-offset.left-(closestHandle.width()/2),top:event.pageY-offset.top-
(closestHandle.height()/2)-
(parseInt(closestHandle.css("borderTopWidth"),10)||0)-
(parseInt(closestHandle.css("borderBottomWidth"),10)||0)+
(parseInt(closestHandle.css("marginTop"),10)||0)};if(!this.handles.hasClass("ui-state-hover")){this._slide(event,index,normValue);}
this._animateOff=true;return true;},_mouseStart:function(event){return true;},_mouseDrag:function(event){var position={x:event.pageX,y:event.pageY},normValue=this._normValueFromMouse(position);this._slide(event,this._handleIndex,normValue);return false;},_mouseStop:function(event){this.handles.removeClass("ui-state-active");this._mouseSliding=false;this._stop(event,this._handleIndex);this._change(event,this._handleIndex);this._handleIndex=null;this._clickOffset=null;this._animateOff=false;return false;},_detectOrientation:function(){this.orientation=(this.options.orientation==="vertical")?"vertical":"horizontal";},_normValueFromMouse:function(position){var pixelTotal,pixelMouse,percentMouse,valueTotal,valueMouse;if(this.orientation==="horizontal"){pixelTotal=this.elementSize.width;pixelMouse=position.x-this.elementOffset.left-(this._clickOffset?this._clickOffset.left:0);}else{pixelTotal=this.elementSize.height;pixelMouse=position.y-this.elementOffset.top-(this._clickOffset?this._clickOffset.top:0);}
percentMouse=(pixelMouse/pixelTotal);if(percentMouse>1){percentMouse=1;}
if(percentMouse<0){percentMouse=0;}
if(this.orientation==="vertical"){percentMouse=1-percentMouse;}
valueTotal=this._valueMax()-this._valueMin();valueMouse=this._valueMin()+percentMouse*valueTotal;return this._trimAlignValue(valueMouse);},_start:function(event,index){var uiHash={handle:this.handles[index],value:this.value()};if(this.options.values&&this.options.values.length){uiHash.value=this.values(index);uiHash.values=this.values();}
return this._trigger("start",event,uiHash);},_slide:function(event,index,newVal){var otherVal,newValues,allowed;if(this.options.values&&this.options.values.length){otherVal=this.values(index?0:1);if((this.options.values.length===2&&this.options.range===true)&&((index===0&&newVal>otherVal)||(index===1&&newVal<otherVal))){newVal=otherVal;}
if(newVal!==this.values(index)){newValues=this.values();newValues[index]=newVal;allowed=this._trigger("slide",event,{handle:this.handles[index],value:newVal,values:newValues});otherVal=this.values(index?0:1);if(allowed!==false){this.values(index,newVal,true);}}}else{if(newVal!==this.value()){allowed=this._trigger("slide",event,{handle:this.handles[index],value:newVal});if(allowed!==false){this.value(newVal);}}}},_stop:function(event,index){var uiHash={handle:this.handles[index],value:this.value()};if(this.options.values&&this.options.values.length){uiHash.value=this.values(index);uiHash.values=this.values();}
this._trigger("stop",event,uiHash);},_change:function(event,index){if(!this._keySliding&&!this._mouseSliding){var uiHash={handle:this.handles[index],value:this.value()};if(this.options.values&&this.options.values.length){uiHash.value=this.values(index);uiHash.values=this.values();}
this._trigger("change",event,uiHash);}},value:function(newValue){if(arguments.length){this.options.value=this._trimAlignValue(newValue);this._refreshValue();this._change(null,0);return;}
return this._value();},values:function(index,newValue){var vals,newValues,i;if(arguments.length>1){this.options.values[index]=this._trimAlignValue(newValue);this._refreshValue();this._change(null,index);return;}
if(arguments.length){if($.isArray(arguments[0])){vals=this.options.values;newValues=arguments[0];for(i=0;i<vals.length;i+=1){vals[i]=this._trimAlignValue(newValues[i]);this._change(null,i);}
this._refreshValue();}else{if(this.options.values&&this.options.values.length){return this._values(index);}else{return this.value();}}}else{return this._values();}},_setOption:function(key,value){var i,valsLength=0;if($.isArray(this.options.values)){valsLength=this.options.values.length;}
$.Widget.prototype._setOption.apply(this,arguments);switch(key){case"disabled":if(value){this.handles.filter(".ui-state-focus").blur();this.handles.removeClass("ui-state-hover");this.handles.prop("disabled",true);this.element.addClass("ui-disabled");}else{this.handles.prop("disabled",false);this.element.removeClass("ui-disabled");}
break;case"orientation":this._detectOrientation();this.element.removeClass("ui-slider-horizontal ui-slider-vertical").addClass("ui-slider-"+this.orientation);this._refreshValue();break;case"value":this._animateOff=true;this._refreshValue();this._change(null,0);this._animateOff=false;break;case"values":this._animateOff=true;this._refreshValue();for(i=0;i<valsLength;i+=1){this._change(null,i);}
this._animateOff=false;break;}},_value:function(){var val=this.options.value;val=this._trimAlignValue(val);return val;},_values:function(index){var val,vals,i;if(arguments.length){val=this.options.values[index];val=this._trimAlignValue(val);return val;}else{vals=this.options.values.slice();for(i=0;i<vals.length;i+=1){vals[i]=this._trimAlignValue(vals[i]);}
return vals;}},_trimAlignValue:function(val){if(val<=this._valueMin()){return this._valueMin();}
if(val>=this._valueMax()){return this._valueMax();}
var step=(this.options.step>0)?this.options.step:1,valModStep=(val-this._valueMin())%step,alignValue=val-valModStep;if(Math.abs(valModStep)*2>=step){alignValue+=(valModStep>0)?step:(-step);}
return parseFloat(alignValue.toFixed(5));},_valueMin:function(){return this.options.min;},_valueMax:function(){return this.options.max;},_refreshValue:function(){var oRange=this.options.range,o=this.options,self=this,animate=(!this._animateOff)?o.animate:false,valPercent,_set={},lastValPercent,value,valueMin,valueMax;if(this.options.values&&this.options.values.length){this.handles.each(function(i,j){valPercent=(self.values(i)-self._valueMin())/(self._valueMax()-self._valueMin())*100;_set[self.orientation==="horizontal"?"left":"bottom"]=valPercent+"%";$(this).stop(1,1)[animate?"animate":"css"](_set,o.animate);if(self.options.range===true){if(self.orientation==="horizontal"){if(i===0){self.range.stop(1,1)[animate?"animate":"css"]({left:valPercent+"%"},o.animate);}
if(i===1){self.range[animate?"animate":"css"]({width:(valPercent-lastValPercent)+"%"},{queue:false,duration:o.animate});}}else{if(i===0){self.range.stop(1,1)[animate?"animate":"css"]({bottom:(valPercent)+"%"},o.animate);}
if(i===1){self.range[animate?"animate":"css"]({height:(valPercent-lastValPercent)+"%"},{queue:false,duration:o.animate});}}}
lastValPercent=valPercent;});}else{value=this.value();valueMin=this._valueMin();valueMax=this._valueMax();valPercent=(valueMax!==valueMin)?(value-valueMin)/(valueMax-valueMin)*100:0;_set[self.orientation==="horizontal"?"left":"bottom"]=valPercent+"%";this.handle.stop(1,1)[animate?"animate":"css"](_set,o.animate);if(oRange==="min"&&this.orientation==="horizontal"){this.range.stop(1,1)[animate?"animate":"css"]({width:valPercent+"%"},o.animate);}
if(oRange==="max"&&this.orientation==="horizontal"){this.range[animate?"animate":"css"]({width:(100-valPercent)+"%"},{queue:false,duration:o.animate});}
if(oRange==="min"&&this.orientation==="vertical"){this.range.stop(1,1)[animate?"animate":"css"]({height:valPercent+"%"},o.animate);}
if(oRange==="max"&&this.orientation==="vertical"){this.range[animate?"animate":"css"]({height:(100-valPercent)+"%"},{queue:false,duration:o.animate});}}}});}(jQuery));(function($){function modifier(fn){return function(){var previous=this.element.val();fn.apply(this,arguments);this._refresh();if(previous!==this.element.val()){this._trigger("change");}};}
$.widget("ui.spinner",{version:"1.9m6",defaultElement:"<input>",widgetEventPrefix:"spin",options:{incremental:true,max:null,min:null,numberFormat:null,page:10,step:1,change:null,spin:null,start:null,stop:null},_create:function(){this._value(this.element.val(),true);this._draw();this._bind(this._events);this._refresh();},_getCreateOptions:function(){var options={},element=this.element;$.each(["min","max","step"],function(i,option){var value=element.attr(option);if(value!==undefined&&value.length){options[option]=value;}});return options;},_events:{keydown:function(event){if(this._start(event)&&this._keydown(event)){event.preventDefault();}},keyup:"_stop",focus:function(){this.uiSpinner.addClass("ui-state-active");this.previous=this.element.val();},blur:function(event){this._refresh();this.uiSpinner.removeClass("ui-state-active");if(this.previous!==this.element.val()){this._trigger("change",event);}},mousewheel:function(event,delta){if(!delta){return;}
if(!this.spinning&&!this._start(event)){return false;}
this._spin((delta>0?1:-1)*this.options.step,event);clearTimeout(this.mousewheelTimer);this.mousewheelTimer=setTimeout(function(){if(this.spinning){this._stop(event);}},100);event.preventDefault();},"mousedown .ui-spinner-button":function(event){event.preventDefault();if(document.activeElement!==this.element[0]){this.element.focus();}
if(this._start(event)===false){return;}
this._repeat(null,$(event.currentTarget).hasClass("ui-spinner-up")?1:-1,event);},"mouseup .ui-spinner-button":"_stop","mouseenter .ui-spinner-button":function(event){if(!$(event.currentTarget).hasClass("ui-state-active")){return;}
if(this._start(event)===false){return false;}
this._repeat(null,$(event.currentTarget).hasClass("ui-spinner-up")?1:-1,event);},"mouseleave .ui-spinner-button":"_stop"},_draw:function(){var uiSpinner=this.uiSpinner=this.element.addClass("ui-spinner-input").attr("autocomplete","off").wrap(this._uiSpinnerHtml()).parent().append(this._buttonHtml());this._hoverable(uiSpinner);this.element.attr("role","spinbutton");this.buttons=uiSpinner.find(".ui-spinner-button").attr("tabIndex",-1).button().removeClass("ui-corner-all");if(this.buttons.height()===uiSpinner.height()){uiSpinner.height(uiSpinner.height());}
if(this.options.disabled){this.disable();}},_keydown:function(event){var options=this.options,keyCode=$.ui.keyCode;switch(event.keyCode){case keyCode.UP:this._repeat(null,1,event);return true;case keyCode.DOWN:this._repeat(null,-1,event);return true;case keyCode.PAGE_UP:this._repeat(null,options.page,event);return true;case keyCode.PAGE_DOWN:this._repeat(null,-options.page,event);return true;}
return false;},_uiSpinnerHtml:function(){return"<span class='ui-spinner ui-state-default ui-widget ui-widget-content ui-corner-all'></span>";},_buttonHtml:function(){return""+"<a class='ui-spinner-button ui-spinner-up ui-corner-tr'>"+"<span class='ui-icon ui-icon-triangle-1-n'>&#9650;</span>"+"</a>"+"<a class='ui-spinner-button ui-spinner-down ui-corner-br'>"+"<span class='ui-icon ui-icon-triangle-1-s'>&#9660;</span>"+"</a>";},_start:function(event){if(!this.spinning&&this._trigger("start",event)===false){return false;}
if(!this.counter){this.counter=1;}
this.spinning=true;return true;},_repeat:function(i,steps,event){i=i||500;clearTimeout(this.timer);this.timer=this._delay(function(){this._repeat(40,steps,event);},i);this._spin(steps*this.options.step,event);},_spin:function(step,event){var value=this.value()||0;if(!this.counter){this.counter=1;}
value=this._adjustValue(value+step*this._increment(this.counter));if(!this.spinning||this._trigger("spin",event,{value:value})!==false){this._value(value);this.counter++;}},_increment:function(i){var incremental=this.options.incremental;if(incremental){return $.isFunction(incremental)?incremental(i):Math.floor(i*i*i/50000-i*i/500+17*i/200+1);}
return 1;},_precision:function(){var precision=this._precisionOf(this.options.step);if(this.options.min!==null){precision=Math.max(precision,this._precisionOf(this.options.min));}
return precision;},_precisionOf:function(num){var str=num.toString(),decimal=str.indexOf(".");return decimal===-1?0:str.length-decimal-1;},_adjustValue:function(value){var base,aboveMin,options=this.options;base=options.min!==null?options.min:0;aboveMin=value-base;aboveMin=Math.round(aboveMin/options.step)*options.step;value=base+aboveMin;value=parseFloat(value.toFixed(this._precision()));if(options.max!==null&&value>options.max){return options.max;}
if(options.min!==null&&value<options.min){return options.min;}
return value;},_stop:function(event){if(!this.spinning){return;}
clearTimeout(this.timer);clearTimeout(this.mousewheelTimer);this.counter=0;this.spinning=false;this._trigger("stop",event);},_setOption:function(key,value){this._super("_setOption",key,value);if(key==="disabled"){if(value){this.element.prop("disabled",true);this.buttons.button("disable");}else{this.element.prop("disabled",false);this.buttons.button("enable");}}},_setOptions:modifier(function(options){this._super("_setOptions",options);this._value(this.element.val());}),_parse:function(val){if(typeof val==="string"&&val!==""){val=window.Globalize&&this.options.numberFormat?Globalize.parseFloat(val):+val;}
return val===""||isNaN(val)?null:val;},_format:function(value){if(value===""){return"";}
return window.Globalize&&this.options.numberFormat?Globalize.format(value,this.options.numberFormat):value;},_refresh:function(){this.element.attr({"aria-valuemin":this.options.min,"aria-valuemax":this.options.max,"aria-valuenow":this._parse(this.element.val())});},_value:function(value,allowAny){var parsed;if(value!==""){parsed=this._parse(value);if(parsed!==null){if(!allowAny){parsed=this._adjustValue(parsed);}
value=this._format(parsed);}}
this.element.val(value);this._refresh();},destroy:function(){this.element.removeClass("ui-spinner-input").prop("disabled",false).removeAttr("autocomplete").removeAttr("role").removeAttr("aria-valuemin").removeAttr("aria-valuemax").removeAttr("aria-valuenow");this._super("destroy");this.uiSpinner.replaceWith(this.element);},stepUp:modifier(function(steps){this._stepUp(steps);}),_stepUp:function(steps){this._spin((steps||1)*this.options.step);},stepDown:modifier(function(steps){this._stepDown(steps);}),_stepDown:function(steps){this._spin((steps||1)* -this.options.step);},pageUp:modifier(function(pages){this._stepUp((pages||1)*this.options.page);}),pageDown:modifier(function(pages){this._stepDown((pages||1)*this.options.page);}),value:function(newVal){if(!arguments.length){return this._parse(this.element.val());}
modifier(this._value).call(this,newVal);},widget:function(){return this.uiSpinner;}});}(jQuery));(function($,undefined){var tabId=0;function getNextTabId(){return++tabId;}
var isLocal=(function(){var rhash=/#.*$/,currentPage=location.href.replace(rhash,"");return function(anchor){anchor=anchor.cloneNode(false);return anchor.hash.length>1&&anchor.href.replace(rhash,"")===currentPage;};})();$.widget("ui.tabs",{version:"1.9m6",options:{active:null,collapsible:false,event:"click",fx:null,activate:null,beforeActivate:null,beforeLoad:null,load:null},_create:function(){var that=this,options=that.options,active=options.active;that.running=false;that.element.addClass("ui-tabs ui-widget ui-widget-content ui-corner-all");that._processTabs();if(active===null){if(location.hash){that.anchors.each(function(i,tab){if(tab.hash===location.hash){active=i;return false;}});}
if(active===null){active=that.lis.filter(".ui-tabs-active").index();}
if(active===null||active===-1){active=that.lis.length?0:false;}}
if(active!==false){active=this.lis.eq(active).index();if(active===-1){active=options.collapsible?false:0;}}
options.active=active;if(!options.collapsible&&options.active===false&&this.anchors.length){options.active=0;}
if($.isArray(options.disabled)){options.disabled=$.unique(options.disabled.concat($.map(this.lis.filter(".ui-state-disabled"),function(n,i){return that.lis.index(n);}))).sort();}
this._setupFx(options.fx);this._refresh();this.panels.hide();this.lis.removeClass("ui-tabs-active ui-state-active");if(options.active!==false&&this.anchors.length){this.active=this._findActive(options.active);var panel=that._getPanelForTab(this.active);panel.show();this.lis.eq(options.active).addClass("ui-tabs-active ui-state-active");this.load(options.active);}else{this.active=$();}},_setOption:function(key,value){if(key=="active"){this._activate(value);return;}
if(key==="disabled"){this._setupDisabled(value);return;}
this._super("_setOption",key,value);if(key==="collapsible"&&!value&&this.options.active===false){this._activate(0);}
if(key==="event"){this._setupEvents(value);}
if(key==="fx"){this._setupFx(value);}},_tabId:function(a){return $(a).attr("aria-controls")||"ui-tabs-"+getNextTabId();},_sanitizeSelector:function(hash){return hash?hash.replace(/[!"$%&'()*+,.\/:;<=>?@[\]^`{|}~]/g,"\\$&"):"";},refresh:function(){var self=this,options=this.options,lis=this.list.children(":has(a[href])");options.disabled=$.map(lis.filter(".ui-state-disabled"),function(tab){return lis.index(tab);});this._processTabs();this._refresh();this.panels.not(this._getPanelForTab(this.active)).hide();if(options.active===false||!this.anchors.length){options.active=false;this.active=$();}else if(this.active.length&&!$.contains(this.list[0],this.active[0])){var next=options.active-1;this._activate(next>=0?next:0);}else{options.active=this.anchors.index(this.active);}},_refresh:function(){var options=this.options;this.element.toggleClass("ui-tabs-collapsible",options.collapsible);this.list.addClass("ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all");this.lis.addClass("ui-state-default ui-corner-top");this.panels.addClass("ui-tabs-panel ui-widget-content ui-corner-bottom");this._setupDisabled(options.disabled);this._setupEvents(options.event);this.lis.unbind(".tabs");this._focusable(this.lis);this._hoverable(this.lis);},_processTabs:function(){var self=this;this.list=this.element.find("ol,ul").eq(0);this.lis=$(" > li:has(a[href])",this.list);this.anchors=this.lis.map(function(){return $("a",this)[0];});this.panels=$([]);this.anchors.each(function(i,a){var selector,panel;if(isLocal(a)){selector=a.hash;panel=self.element.find(self._sanitizeSelector(selector));}else{var id=self._tabId(a);selector="#"+id;panel=self.element.find(selector);if(!panel.length){panel=self._createPanel(id);panel.insertAfter(self.panels[i-1]||self.list);}}
if(panel.length){self.panels=self.panels.add(panel);}
$(a).attr("aria-controls",selector.substring(1));});},_createPanel:function(id){return $("<div></div>").attr("id",id).addClass("ui-tabs-panel ui-widget-content ui-corner-bottom").data("destroy.tabs",true);},_setupDisabled:function(disabled){if($.isArray(disabled)){if(!disabled.length){disabled=false;}else if(disabled.length===this.anchors.length){disabled=true;}}
for(var i=0,li;(li=this.lis[i]);i++){$(li).toggleClass("ui-state-disabled",(disabled===true||$.inArray(i,disabled)!==-1));}
this.options.disabled=disabled;},_setupFx:function(fx){if(fx){if($.isArray(fx)){this.hideFx=fx[0];this.showFx=fx[1];}else{this.hideFx=this.showFx=fx;}}},_resetStyle:function($el,fx){if(!$.support.opacity&&fx.opacity){$el[0].style.removeAttribute("filter");}},_setupEvents:function(event){this.anchors.unbind(".tabs");if(event){this.anchors.bind(event.split(" ").join(".tabs ")+".tabs",$.proxy(this,"_eventHandler"));}
this.anchors.bind("click.tabs",function(event){event.preventDefault();});},_eventHandler:function(event){var that=this,options=that.options,active=that.active,clicked=$(event.currentTarget),clickedIsActive=clicked[0]===active[0],collapsing=clickedIsActive&&options.collapsible,toShow=collapsing?$():that._getPanelForTab(clicked),toHide=!active.length?$():that._getPanelForTab(active),tab=clicked.closest("li"),eventData={oldTab:active,oldPanel:toHide,newTab:collapsing?$():clicked,newPanel:toShow};event.preventDefault();if(tab.hasClass("ui-state-disabled")||tab.hasClass("ui-tabs-loading")||that.running||(clickedIsActive&&!options.collapsible)||(that._trigger("beforeActivate",event,eventData)===false)){clicked[0].blur();return;}
options.active=collapsing?false:that.anchors.index(clicked);that.active=clickedIsActive?$():clicked;if(that.xhr){that.xhr.abort();}
if(!toHide.length&&!toShow.length){throw"jQuery UI Tabs: Mismatching fragment identifier.";}
if(toShow.length){that.load(that.anchors.index(clicked),event);clicked[0].blur();}
that._toggle(event,eventData);},_toggle:function(event,eventData){var that=this,options=that.options,toShow=eventData.newPanel,toHide=eventData.oldPanel;that.running=true;function complete(){that.running=false;that._trigger("activate",event,eventData);}
function show(){eventData.newTab.closest("li").addClass("ui-tabs-active ui-state-active");if(toShow.length&&that.showFx){toShow.animate(that.showFx,that.showFx.duration||"normal",function(){that._resetStyle($(this),that.showFx);complete();});}else{toShow.show();complete();}}
if(toHide.length&&that.hideFx){toHide.animate(that.hideFx,that.hideFx.duration||"normal",function(){eventData.oldTab.closest("li").removeClass("ui-tabs-active ui-state-active");that._resetStyle($(this),that.hideFx);show();});}else{eventData.oldTab.closest("li").removeClass("ui-tabs-active ui-state-active");toHide.hide();show();}},_activate:function(index){var active=this._findActive(index)[0];if(active===this.active[0]){return;}
active=active||this.active[0];this._eventHandler({target:active,currentTarget:active,preventDefault:$.noop});},_findActive:function(selector){return typeof selector==="number"?this.anchors.eq(selector):typeof selector==="string"?this.anchors.filter("[href$='"+selector+"']"):$();},_getIndex:function(index){if(typeof index=="string"){index=this.anchors.index(this.anchors.filter("[href$="+index+"]"));}
return index;},_destroy:function(){var o=this.options;if(this.xhr){this.xhr.abort();}
this.element.removeClass("ui-tabs ui-widget ui-widget-content ui-corner-all ui-tabs-collapsible");this.list.removeClass("ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all");this.anchors.unbind(".tabs").removeData("href.tabs").removeData("load.tabs");this.lis.unbind(".tabs").add(this.panels).each(function(){if($.data(this,"destroy.tabs")){$(this).remove();}else{$(this).removeClass(["ui-state-default","ui-corner-top","ui-tabs-active","ui-state-active","ui-state-disabled","ui-tabs-panel","ui-widget-content","ui-corner-bottom"].join(" "));}});return this;},enable:function(index){var disabled=this.options.disabled;if(disabled===false){return;}
if(index===undefined){disabled=false;}else{index=this._getIndex(index);if($.isArray(disabled)){disabled=$.map(disabled,function(num){return num!==index?num:null;});}else{disabled=$.map(this.lis,function(li,num){return num!==index?num:null;});}}
this._setupDisabled(disabled);},disable:function(index){var disabled=this.options.disabled;if(disabled===true){return;}
if(index===undefined){disabled=true;}else{index=this._getIndex(index);if($.inArray(index,disabled)!==-1){return;}
if($.isArray(disabled)){disabled=$.merge([index],disabled).sort();}else{disabled=[index];}}
this._setupDisabled(disabled);},load:function(index,event){index=this._getIndex(index);var self=this,options=this.options,anchor=this.anchors.eq(index),panel=self._getPanelForTab(anchor),eventData={tab:anchor,panel:panel};if(isLocal(anchor[0])){return;}
this.xhr=$.ajax({url:anchor.attr("href"),beforeSend:function(jqXHR,settings){return self._trigger("beforeLoad",event,$.extend({jqXHR:jqXHR,ajaxSettings:settings},eventData));}});if(this.xhr){this.lis.eq(index).addClass("ui-tabs-loading");this.xhr.success(function(response){panel.html(response);self._trigger("load",event,eventData);}).complete(function(jqXHR,status){if(status==="abort"){self.panels.stop(false,true);}
self.lis.eq(index).removeClass("ui-tabs-loading");if(jqXHR===self.xhr){delete self.xhr;}});}
return this;},_getPanelForTab:function(tab){var id=$(tab).attr("aria-controls");return this.element.find(this._sanitizeSelector("#"+id));}});if($.uiBackCompat!==false){$.ui.tabs.prototype._ui=function(tab,panel){return{tab:tab,panel:panel,index:this.anchors.index(tab)};};(function($,prototype){prototype.url=function(index,url){this.anchors.eq(index).attr("href",url);};}(jQuery,jQuery.ui.tabs.prototype));(function($,prototype){$.extend(prototype.options,{ajaxOptions:null,cache:false});var _create=prototype._create,_setOption=prototype._setOption,_destroy=prototype._destroy,oldurl=prototype.url||$.noop;$.extend(prototype,{_create:function(){_create.call(this);var self=this;this.element.bind("tabsbeforeload.tabs",function(event,ui){if($.data(ui.tab[0],"cache.tabs")){event.preventDefault();return;}
$.extend(ui.ajaxSettings,self.options.ajaxOptions,{error:function(xhr,s,e){try{self.options.ajaxOptions.error(xhr,s,ui.tab.closest("li").index(),ui.tab[0]);}
catch(e){}}});ui.jqXHR.success(function(){if(self.options.cache){$.data(ui.tab[0],"cache.tabs",true);}});});},_setOption:function(key,value){if(key==="cache"&&value===false){this.anchors.removeData("cache.tabs");}
_setOption.apply(this,arguments);},_destroy:function(){this.anchors.removeData("cache.tabs");_destroy.call(this);},url:function(index,url){this.anchors.eq(index).removeData("cache.tabs");oldurl.apply(this,arguments);}});}(jQuery,jQuery.ui.tabs.prototype));(function($,prototype){prototype.abort=function(){if(this.xhr){this.xhr.abort();}};}(jQuery,jQuery.ui.tabs.prototype));$.widget("ui.tabs",$.ui.tabs,{options:{spinner:"<em>Loading&#8230;</em>"},_create:function(){this._super("_create");this._bind({tabsbeforeload:function(event,ui){if(!this.options.spinner){return;}
var span=ui.tab.find("span"),html=span.html();span.html(this.options.spinner);ui.jqXHR.complete(function(){span.html(html);});}});}});(function($,prototype){$.extend(prototype.options,{enable:null,disable:null});var enable=prototype.enable,disable=prototype.disable;prototype.enable=function(index){var options=this.options,trigger;if(index&&options.disabled===true||($.isArray(options.disabled)&&$.inArray(index,options.disabled)!==-1)){trigger=true;}
enable.apply(this,arguments);if(trigger){this._trigger("enable",null,this._ui(this.anchors[index],this.panels[index]));}};prototype.disable=function(index){var options=this.options,trigger;if(index&&options.disabled===false||($.isArray(options.disabled)&&$.inArray(index,options.disabled)===-1)){trigger=true;}
disable.apply(this,arguments);if(trigger){this._trigger("disable",null,this._ui(this.anchors[index],this.panels[index]));}};}(jQuery,jQuery.ui.tabs.prototype));(function($,prototype){$.extend(prototype.options,{add:null,remove:null,tabTemplate:"<li><a href='#{href}'><span>#{label}</span></a></li>"});prototype.add=function(url,label,index){if(index===undefined){index=this.anchors.length;}
var options=this.options,li=$(options.tabTemplate.replace(/#\{href\}/g,url).replace(/#\{label\}/g,label)),id=!url.indexOf("#")?url.replace("#",""):this._tabId(li.find("a")[0]);li.addClass("ui-state-default ui-corner-top").data("destroy.tabs",true);li.find("a").attr("aria-controls",id);var doInsertAfter=index>=this.lis.length;var panel=this.element.find("#"+id);if(!panel.length){panel=this._createPanel(id);if(doInsertAfter){if(index>0){panel.insertAfter(this.panels.eq(-1));}else{panel.appendTo(this.element);}}else{panel.insertBefore(this.panels[index]);}}
panel.addClass("ui-tabs-panel ui-widget-content ui-corner-bottom").hide();if(doInsertAfter){li.appendTo(this.list);}else{li.insertBefore(this.lis[index]);}
options.disabled=$.map(options.disabled,function(n){return n>=index?++n:n;});this.refresh();if(this.lis.length===1&&options.active===false){this.option("active",0);}
this._trigger("add",null,this._ui(this.anchors[index],this.panels[index]));return this;};prototype.remove=function(index){index=this._getIndex(index);var options=this.options,tab=this.lis.eq(index).remove(),panel=this._getPanelForTab(tab.find("a[aria-controls]")).remove();if(tab.hasClass("ui-tabs-active")&&this.anchors.length>2){this._activate(index+(index+1<this.anchors.length?1:-1));}
options.disabled=$.map($.grep(options.disabled,function(n){return n!==index;}),function(n){return n>=index?--n:n;});this.refresh();this._trigger("remove",null,this._ui(tab.find("a")[0],panel[0]));return this;};}(jQuery,jQuery.ui.tabs.prototype));(function($,prototype){prototype.length=function(){return this.anchors.length;};}(jQuery,jQuery.ui.tabs.prototype));(function($,prototype){$.extend(prototype.options,{idPrefix:"ui-tabs-"});var _tabId=prototype._tabId;prototype._tabId=function(a){return $(a).attr("aria-controls")||a.title&&a.title.replace(/\s/g,"_").replace(/[^\w\u00c0-\uFFFF-]/g,"")||this.options.idPrefix+getNextTabId();};}(jQuery,jQuery.ui.tabs.prototype));(function($,prototype){$.extend(prototype.options,{panelTemplate:"<div></div>"});var _createPanel=prototype._createPanel;prototype._createPanel=function(id){return $(this.options.panelTemplate).attr("id",id).addClass("ui-tabs-panel ui-widget-content ui-corner-bottom").data("destroy.tabs",true);};}(jQuery,jQuery.ui.tabs.prototype));(function($,prototype){var _create=prototype._create,_setOption=prototype._setOption,_eventHandler=prototype._eventHandler;prototype._create=function(){var options=this.options;if(options.active===null&&options.selected!==undefined){options.active=options.selected===-1?false:options.selected;}
_create.call(this);options.selected=options.active;if(options.selected===false){options.selected=-1;}};prototype._setOption=function(key,value){if(key!=="selected"){return _setOption.apply(this,arguments);}
var options=this.options;_setOption.call(this,"active",value===-1?false:value);options.selected=options.active;if(options.selected===false){options.selected=-1;}};prototype._eventHandler=function(event){_eventHandler.apply(this,arguments);this.options.selected=this.options.active;if(this.options.selected===false){this.options.selected=-1;}};}(jQuery,jQuery.ui.tabs.prototype));(function($,prototype){$.extend(prototype.options,{show:null,select:null});var _create=prototype._create,_trigger=prototype._trigger;prototype._create=function(){_create.call(this);if(this.options.active!==false){this._trigger("show",null,this._ui(this.active[0],this._getPanelForTab(this.active)[0]));}};prototype._trigger=function(type,event,data){var ret=_trigger.apply(this,arguments);if(!ret){return false;}
if(type==="beforeActivate"&&data.newTab.length){ret=_trigger.call(this,"select",event,{tab:data.newTab[0],panel:data.newPanel[0],index:data.newTab.closest("li").index()});}else if(type==="activate"&&data.newTab.length){ret=_trigger.call(this,"show",event,{tab:data.newTab[0],panel:data.newPanel[0],index:data.newTab.closest("li").index()});}};}(jQuery,jQuery.ui.tabs.prototype));(function($,prototype){prototype.select=function(index){index=this._getIndex(index);if(index===-1){if(this.options.collapsible&&this.options.selected!==-1){index=this.options.selected;}else{return;}}
this.anchors.eq(index).trigger(this.options.event+".tabs");};}(jQuery,jQuery.ui.tabs.prototype));var listId=0;function getNextListId(){return++listId;}
$.widget("ui.tabs",$.ui.tabs,{options:{cookie:null},_create:function(){var options=this.options,active;if(options.active==null&&options.cookie){active=parseInt(this._cookie(),10);if(active===-1){active=false;}
options.active=active;}
this._super("_create");},_cookie:function(active){var cookie=[this.cookie||(this.cookie=this.options.cookie.name||"ui-tabs-"+getNextListId())];if(arguments.length){cookie.push(active===false?-1:active);cookie.push(this.options.cookie);}
return $.cookie.apply(null,cookie);},_refresh:function(){this._super("_refresh");if(this.options.cookie){this._cookie(this.options.active,this.options.cookie);}},_eventHandler:function(event){this._superApply("_eventHandler",arguments);if(this.options.cookie){this._cookie(this.options.active,this.options.cookie);}},_destroy:function(){this._super("_destroy");if(this.options.cookie){this._cookie(null,this.options.cookie);}}});$.widget("ui.tabs",$.ui.tabs,{_trigger:function(type,event,data){var _data=$.extend({},data);if(type==="load"){_data.panel=_data.panel[0];_data.tab=_data.tab[0];}
return this._super("_trigger",type,event,_data);}});}})(jQuery);(function($){var increments=0;$.widget("ui.tooltip",{version:"1.9m6",options:{content:function(){return $(this).attr("title");},hide:true,items:"[title]",position:{my:"left+15 center",at:"right center",collision:"flipfit flipfit"},show:true,tooltipClass:null,close:null,open:null},_create:function(){this._bind({mouseover:"open",focusin:"open"});this.tooltips={};},_setOption:function(key,value){if(key==="disabled"){this[value?"_disable":"_enable"]();this.options[key]=value;return;}
this._super("_setOption",key,value);},_disable:function(){var that=this;$.each(this.tooltips,function(id,element){var event=$.Event("blur");event.target=event.currentTarget=element[0];that.close(event,true);});this.element.find(this.options.items).andSelf().each(function(){var element=$(this);if(element.is("[title]")){element.data("tooltip-title",element.attr("title")).attr("title","");}});},_enable:function(){this.element.find(this.options.items).andSelf().each(function(){var element=$(this);if(element.data("tooltip-title")){element.attr("title",element.data("tooltip-title"));}});},open:function(event){var content,that=this,target=$(event?event.target:this.element).closest(this.options.items);if(!target.length||target.attr("aria-describedby")){return;}
if(!target.data("tooltip-title")){target.data("tooltip-title",target.attr("title"));}
content=this.options.content.call(target[0],function(response){setTimeout(function(){that._open(event,target,response);},1);});if(content){that._open(event,target,content);}},_open:function(event,target,content){if(!content){return;}
if(target.is("[title]")){target.attr("title","");}
var tooltip=this._find(target);if(!tooltip.length){tooltip=this._tooltip(target);target.attr("aria-describedby",tooltip.attr("id"));}
tooltip.find(".ui-tooltip-content").html(content);tooltip.stop(true).position($.extend({of:target},this.options.position)).hide();this._show(tooltip,this.options.show);this._trigger("open",event,{tooltip:tooltip});this._bind(target,{mouseleave:"close",blur:"close",keyup:function(event){if(event.keyCode==$.ui.keyCode.ESCAPE){var fakeEvent=$.Event(event);fakeEvent.currentTarget=target[0];this.close(fakeEvent,true);}}});},close:function(event,force){var that=this,target=$(event?event.currentTarget:this.element),tooltip=this._find(target);if(!force&&document.activeElement===target[0]){return;}
if(target.data("tooltip-title")){target.attr("title",target.data("tooltip-title"));}
target.removeAttr("aria-describedby");tooltip.stop(true);this._hide(tooltip,this.options.hide,function(){$(this).remove();delete that.tooltips[this.id];});target.unbind("mouseleave.tooltip blur.tooltip keyup.tooltip");this._trigger("close",event,{tooltip:tooltip});},_tooltip:function(element){var id="ui-tooltip-"+increments++,tooltip=$("<div>").attr({id:id,role:"tooltip"}).addClass("ui-tooltip ui-widget ui-corner-all ui-widget-content "+
(this.options.tooltipClass||""));$("<div>").addClass("ui-tooltip-content").appendTo(tooltip);tooltip.appendTo(document.body);if($.fn.bgiframe){tooltip.bgiframe();}
this.tooltips[id]=element;return tooltip;},_find:function(target){var id=target.attr("aria-describedby");return id?$("#"+id):$();},_destroy:function(){$.each(this.tooltips,function(id){$("#"+id).remove();});}});}(jQuery));return jQuery.ui;});define('ui/tab',['aloha/core','jquery','ui/container','ui/component','PubSub','jqueryui'],function(Aloha,$,Container,Component,PubSub){var idCounter=0;var slottedComponents={};var Tab=Container.extend({_elemBySlot:null,_groupBySlot:null,_groupByComponent:null,_constructor:function(context,settings,components){var thisTab=this,i,j,elem,groupedComponents,group,groupProps,componentName;this._elemBySlot={};this._groupBySlot={};this._groupByComponent={};this._super(context,settings);this.container=settings.container;this.list=this.container.data('list');this.panels=this.container.data('panels');this.id='tab-ui-container-'+(++idCounter);this.panel=$('<div>',{id:this.id,'unselectable':'on'});this.handle=$('<li><a href="'+location.href.replace(/#.*$/,'')+'#'+this.id+'">'+
settings.label+'</a></li>');for(i=0;i<components.length;i++){if(typeof components[i]==='string'){if(1===components[i].length&&components[i].charCodeAt(0)===10){this.panel.append('<div>',{'unselectable':'on'});}else{elem=$('<span>',{'unselectable':'on'});this._elemBySlot[components[i]]=elem;this.panel.append(elem);}}else{group=$('<div>',{'class':'aloha-ui-component-group aloha-ui-hidden','unselectable':'on'}).appendTo(this.panel);groupProps={element:group,visibleCounter:0};groupedComponents=components[i];for(j=0;j<groupedComponents.length;j++){this._groupBySlot[groupedComponents[j]]=groupProps;if(groupedComponents[j]&&1===groupedComponents[j].length&&groupedComponents[j].charCodeAt(0)===10){group.append($('<div>',{'unselectable':'on'}));}else{componentName=groupedComponents[j];elem=$('<span>',{'unselectable':'on'});this._elemBySlot[groupedComponents[j]]=elem;group.append(elem);}}}}
this.panel.append($('<div>',{'class':'aloha-ui-clear','unselectable':'on'}));this.handle.appendTo(this.list);this.panel.appendTo(this.panels);this.container.tabs('refresh');var alohaTabs=settings.container.data('aloha-tabs');this.index=alohaTabs.length;alohaTabs.push(this);},adoptInto:function(slot,component){var elem=this._elemBySlot[slot],group;if(!elem){return false;}
slottedComponents[slot]=component;component.adoptParent(this);elem.append(component.element);group=this._groupBySlot[slot];if(group){this._groupByComponent[component.id]=group;if(component.isVisible()){if(!group.visibleCounter){group.element.removeClass('aloha-ui-hidden');}
group.visibleCounter+=1;}}
return true;},foreground:function(){this.container.tabs('select',this.index);},childForeground:function(childComponent){this.foreground();},hasVisibleComponents:function(){var siblings=this._elemBySlot;var slot;for(slot in siblings){if(siblings.hasOwnProperty(slot)&&slottedComponents[slot]){if(slottedComponents[slot].visible){return true;}}}
return false;},childVisible:function(childComponent,visible){if(visible){childComponent.container.show();}else if(!childComponent.container.hasVisibleComponents()){childComponent.container.hide();}
var group=this._groupByComponent[childComponent.id];if(!group){return;}
if(visible){if(0===group.visibleCounter){group.element.removeClass('aloha-ui-hidden');}
group.visibleCounter+=1;}else{group.visibleCounter-=1;if(0===group.visibleCounter){group.element.addClass('aloha-ui-hidden');}}},show:function(){if(!this.list.children().length){return;}
this.handle.show();this.visible=true;this.container.show();if(!this.container.find('.ui-tabs-active').length||this.container.tabs('option','selected')===this.index){this.foreground();}},hide:function(){var tabs=this.list.children();if(0===tabs.length){return;}
this.handle.hide();this.visible=false;if(this.index===this.container.tabs('option','selected')){tabs=this.container.data('aloha-tabs');var i;for(i=0;i<tabs.length;++i){if(tabs[i].visible){this.container.tabs('select',i);return;}}
this.handle.removeClass('ui-tabs-active');this.container.hide();}}});$.extend(Tab,{createContainer:function(){var $container=$('<div>',{'unselectable':'on'});var $list=$('<ul>',{'unselectable':'on'}).appendTo($container);var $panels=$('<div>',{'unselectable':'on'}).appendTo($container);$container.data('list',$list).data('panels',$panels).data('aloha-tabs',[]).tabs({select:function(event,ui){var tabs=$container.data('aloha-tabs');$container.data('aloha-active-container',tabs[ui.index]);PubSub.pub('aloha.ui.container.selected',{data:tabs[ui.index]});}});return $container;}});return Tab;});define('ui/subguarded',['aloha/core','jquery','PubSub'],function(Aloha,jQuery,PubSub){var alohaUid=0;var registeredArguments={};var registeredGuards={};function getUid(func){if(!func.alohaUid){func.alohaUid=++alohaUid;}
return func.alohaUid;}
function getRegisteredGuards(event){return registeredGuards[event]||[];}
function getArguments(guard){return registeredArguments[guard.alohaUid]||[];}
function registerArguments(guard,args){if(!registeredArguments[guard.alohaUid]){registeredArguments[guard.alohaUid]=[];}
registeredArguments[guard.alohaUid].push(args);return registeredArguments[guard.alohaUid];}
function registerGuard(event,guard){if(!registeredGuards[event]){registeredGuards[event]=[];}
registeredGuards[event].push(guard);return registeredGuards[event];}
function trigger(event){var guards=getRegisteredGuards(event);var i;for(i=0;i<guards.length;i++){guards[i].apply(null,[getArguments(guards[i])].concat(arguments));}}
function sub(){var args=Array.prototype.slice.call(arguments);var events=args.shift();if(typeof events==='string'){events=[events];}
var guard=args.shift();getUid(guard);registerArguments(guard,args);var i;var event;var bindHandler=function($event,range,nativeEvent){trigger(event,$event,range,nativeEvent);};var pubsubHandler=function(){trigger(event);};for(i=0;i<events.length;i++){event=events[i];registerGuard(event,guard);Aloha.bind(event,bindHandler);PubSub.sub(event,pubsubHandler);}}
return sub;});define('vendor/amplify.store',['util/json2'],function(){var amplify={};(function(amplify,undefined){var store=amplify.store=function(key,value,options,type){var type=store.type;if(options&&options.type&&options.type in store.types){type=options.type;}
return store.types[type](key,value,options||{});};store.types={};store.type=null;store.addType=function(type,storage){if(!store.type){store.type=type;}
store.types[type]=storage;store[type]=function(key,value,options){options=options||{};options.type=type;return store(key,value,options);};}
store.error=function(){return"amplify.store quota exceeded";};var rprefix=/^__amplify__/;function createFromStorageInterface(storageType,storage){store.addType(storageType,function(key,value,options){var storedValue,parsed,i,remove,ret=value,now=(new Date()).getTime();if(!key){ret={};remove=[];i=0;try{key=storage.length;while(key=storage.key(i++)){if(rprefix.test(key)){parsed=JSON.parse(storage.getItem(key));if(parsed.expires&&parsed.expires<=now){remove.push(key);}else{ret[key.replace(rprefix,"")]=parsed.data;}}}
while(key=remove.pop()){storage.removeItem(key);}}catch(error){}
return ret;}
key="__amplify__"+key;if(value===undefined){storedValue=storage.getItem(key);parsed=storedValue?JSON.parse(storedValue):{expires:-1};if(parsed.expires&&parsed.expires<=now){storage.removeItem(key);}else{return parsed.data;}}else{if(value===null){storage.removeItem(key);}else{parsed=JSON.stringify({data:value,expires:options.expires?now+options.expires:null});try{storage.setItem(key,parsed);}catch(error){store[storageType]();try{storage.setItem(key,parsed);}catch(error){throw store.error();}}}}
return ret;});}
for(var webStorageType in{localStorage:1,sessionStorage:1}){try{if(window[webStorageType].getItem){createFromStorageInterface(webStorageType,window[webStorageType]);}}catch(e){}}
if(window.globalStorage){try{createFromStorageInterface("globalStorage",window.globalStorage[window.location.hostname]);if(store.type==="sessionStorage"){store.type="globalStorage";}}catch(e){}}
(function(){if(store.types.localStorage){return;}
var div=document.createElement("div"),attrKey="amplify";div.style.display="none";document.getElementsByTagName("head")[0].appendChild(div);try{div.addBehavior("#default#userdata");div.load(attrKey);}catch(e){div.parentNode.removeChild(div);return;}
store.addType("userData",function(key,value,options){div.load(attrKey);var attr,parsed,prevValue,i,remove,ret=value,now=(new Date()).getTime();if(!key){ret={};remove=[];i=0;while(attr=div.XMLDocument.documentElement.attributes[i++]){parsed=JSON.parse(attr.value);if(parsed.expires&&parsed.expires<=now){remove.push(attr.name);}else{ret[attr.name]=parsed.data;}}
while(key=remove.pop()){div.removeAttribute(key);}
div.save(attrKey);return ret;}
key=key.replace(/[^-._0-9A-Za-z\xb7\xc0-\xd6\xd8-\xf6\xf8-\u037d\u37f-\u1fff\u200c-\u200d\u203f\u2040\u2070-\u218f]/g,"-");if(value===undefined){attr=div.getAttribute(key);parsed=attr?JSON.parse(attr):{expires:-1};if(parsed.expires&&parsed.expires<=now){div.removeAttribute(key);}else{return parsed.data;}}else{if(value===null){div.removeAttribute(key);}else{prevValue=div.getAttribute(key);parsed=JSON.stringify({data:value,expires:(options.expires?(now+options.expires):null)});div.setAttribute(key,parsed);}}
try{div.save(attrKey);}catch(error){if(prevValue===null){div.removeAttribute(key);}else{div.setAttribute(key,prevValue);}
store.userData();try{div.setAttribute(key,parsed);div.save(attrKey);}catch(error){if(prevValue===null){div.removeAttribute(key);}else{div.setAttribute(key,prevValue);}
throw store.error();}}
return ret;});}());(function(){var memory={},timeout={};function copy(obj){return obj===undefined?undefined:JSON.parse(JSON.stringify(obj));}
store.addType("memory",function(key,value,options){if(!key){return copy(memory);}
if(value===undefined){return copy(memory[key]);}
if(timeout[key]){clearTimeout(timeout[key]);delete timeout[key];}
if(value===null){delete memory[key];return null;}
memory[key]=value;if(options.expires){timeout[key]=setTimeout(function(){delete memory[key];delete timeout[key];},options.expires);}
return value;});}());}(amplify));return amplify;});define('ui/floating',['jquery','aloha/core','ui/surface','ui/subguarded','vendor/amplify.store'],function($,Aloha,Surface,subguarded,amplifyStore){var DISTANCE=10;var DURATION=500;var $WINDOW=$(window);var POSITION_STYLE=($.browser.msie&&/^7\.\d+/.test($.browser.version))?'absolute':'fixed';function floatTo($element,position,duration,callback){if('absolute'===POSITION_STYLE){position.top+=$WINDOW.scrollTop();position.left+=$WINDOW.scrollLeft();}
$element.stop().animate(position,duration,function(){callback(position);});}
function floatAbove($element,position,duration,callback){position.top-=$element.height()+DISTANCE;floatTo($element,position,duration,callback);}
function floatBelow($element,position,duration,callback){position.top+=DISTANCE;floatTo($element,position,duration,callback);}
function storePinPosition(offset){amplifyStore.store('Aloha.FloatingMenu.pinned','true');amplifyStore.store('Aloha.FloatingMenu.top',offset.top);amplifyStore.store('Aloha.FloatingMenu.left',offset.left);}
function unstorePinPosition(){amplifyStore.store('Aloha.FloatingMenu.pinned',null);amplifyStore.store('Aloha.FloatingMenu.top',null);amplifyStore.store('Aloha.FloatingMenu.left',null);}
function getPinState(){if(amplifyStore.store('Aloha.FloatingMenu.pinned')==='true'){return{top:parseInt(amplifyStore.store('Aloha.FloatingMenu.top'),10),left:parseInt(amplifyStore.store('Aloha.FloatingMenu.left'),10),isPinned:true};}
return{top:null,left:null,isPinned:false};}
function forcePositionIntoWindow(position){var left=position.left;var top=position.top;if(top<0){top=0;}else if(top>$WINDOW.height()){top=$WINDOW.height()/2;}
if(left<0){left=0;}else if(left>$WINDOW.width()){left=$WINDOW.width()/2;}
return{top:top,left:left};}
function floatSurface(surface,editable,duration,callback){if(typeof duration!=='number'){duration=DURATION;}
var topGutter=(parseInt($('body').css('marginTop'),10)||0)
+(parseInt($('body').css('paddingTop'),10)||0);var $element=surface.$element;var surfaceOrientation=$element.offset();var editableOrientation=editable.obj.offset();var scrollTop=$WINDOW.scrollTop();var availableSpace=editableOrientation.top-scrollTop-topGutter;var left=editableOrientation.left;var horizontalOverflow=left+$element.width()-$WINDOW.width()
-DISTANCE;if(horizontalOverflow>0){left-=horizontalOverflow;}
if(availableSpace>=$element.height()){editableOrientation.top-=scrollTop;floatAbove($element,editableOrientation,duration,callback);}else if(availableSpace+$element.height()>editableOrientation.top+editable.obj.height()){floatBelow($element,{top:editableOrientation.top+editable.obj.height(),left:left},duration,callback);}else{floatBelow($element,{top:topGutter,left:left},duration,callback);}}
function togglePinSurface(surface,position,isFloating){var $surface=surface.$element;if(isFloating){unstorePinPosition();$surface.find('.aloha-ui-pin').removeClass('aloha-ui-pin-down');}else{storePinPosition(position);$surface.find('.aloha-ui-pin').addClass('aloha-ui-pin-down');}
$surface.css({position:'fixed',top:position.top});}
function onActivatedSurface(tuples,eventName,$event,range,nativeEvent){var i;for(i=0;i<tuples.length;i++){if(tuples[i][0].isActive()){tuples[i][1]($event,range,nativeEvent);}}}
function setPositionStyleToFixed(surface){if($.browser.msie){var $parent=surface.$element.parent();surface.$element.appendTo('body');surface.$element.css('position',POSITION_STYLE);if($parent.length){surface.$element.appendTo($parent);}else{surface.$element.detach();}}else{surface.$element.css('position',POSITION_STYLE);}}
function makeFloating(surface,SurfaceTypeManager){subguarded(['aloha-selection-changed','aloha.ui.container.selected'],onActivatedSurface,surface,function(){surface._move();});var updateSurfacePosition=function(){var position=forcePositionIntoWindow({top:SurfaceTypeManager.pinTop,left:SurfaceTypeManager.pinLeft});SurfaceTypeManager.setFloatingPosition(position);surface.$element.css({top:position.top,left:position.left});};$WINDOW.scroll(function(){surface._move(0);});$WINDOW.resize(function(){if(!SurfaceTypeManager.isFloatingMode){updateSurfacePosition();}});surface.addPin();setPositionStyleToFixed(surface);if(!SurfaceTypeManager.isFloatingMode){updateSurfacePosition();}
surface.$element.css('z-index',10100).draggable({distance:20,stop:function(event,ui){SurfaceTypeManager.setFloatingPosition(ui.position);if(!SurfaceTypeManager.isFloatingMode){storePinPosition(ui.position);}}});}
return{getPinState:getPinState,makeFloating:makeFloating,floatSurface:floatSurface,togglePinSurface:togglePinSurface};});(function(){var nlsRegExp=/(^.*(^|\/)nls(\/|$))([^\/]*)\/?([^\/]*)/;function addPart(locale,master,needed,toLoad,prefix,suffix){if(master[locale]){needed.push(locale);if(master[locale]===true||master[locale]===1){toLoad.push(prefix+locale+'/'+suffix);}}}
function addIfExists(req,locale,toLoad,prefix,suffix){var fullName=prefix+locale+'/'+suffix;if(require._fileExists(req.toUrl(fullName))){toLoad.push(fullName);}}
function mixin(target,source,force){var prop;for(prop in source){if(source.hasOwnProperty(prop)&&(!target.hasOwnProperty(prop)||force)){target[prop]=source[prop];}else if(typeof source[prop]==='object'){mixin(target[prop],source[prop],force);}}}
define('i18n',['module'],function(module){var masterConfig=module.config();return{version:'2.0.1',load:function(name,req,onLoad,config){config=config||{};if(config.locale){masterConfig.locale=config.locale;}
var masterName,match=nlsRegExp.exec(name),prefix=match[1],locale=match[4],suffix=match[5],parts=locale.split("-"),toLoad=[],value={},i,part,current="";if(match[5]){prefix=match[1];masterName=prefix+suffix;}else{masterName=name;suffix=match[4];locale=masterConfig.locale;if(!locale){locale=masterConfig.locale=typeof navigator==="undefined"?"root":(navigator.language||navigator.userLanguage||"root").toLowerCase();}
parts=locale.split("-");}
if(config.isBuild){toLoad.push(masterName);addIfExists(req,"root",toLoad,prefix,suffix);for(i=0;i<parts.length;i++){part=parts[i];current+=(current?"-":"")+part;addIfExists(req,current,toLoad,prefix,suffix);}
req(toLoad,function(){onLoad();});}else{req([masterName],function(master){var needed=[],part;addPart("root",master,needed,toLoad,prefix,suffix);for(i=0;i<parts.length;i++){part=parts[i];current+=(current?"-":"")+part;addPart(current,master,needed,toLoad,prefix,suffix);}
req(toLoad,function(){var i,partBundle,part;for(i=needed.length-1;i>-1&&needed[i];i--){part=needed[i];partBundle=master[part];if(partBundle===true||partBundle===1){partBundle=req(prefix+part+'/'+suffix);}
mixin(value,partBundle);}
value.t=function(key,defaultValue){if(this[key]){return this[key];}else if(defaultValue){return defaultValue;}else{return key;}}
onLoad(value);});});}}};});}());define('ui/nls/i18n',{"root":{"button.bold.label":"Bold","button.italic.label":"Italic","button.strikethrough.label":"Strikethrough","button.subscript.label":"Subscript","button.superscript.label":"Superscript","button.underline.label":"Underline","button.p.label":"Paragraph","button.h1.label":"Heading 1","button.h2.label":"Heading 2","button.h3.label":"Heading 3","button.h4.label":"Heading 4","button.h5.label":"Heading 5","button.h6.label":"Heading 6","button.pre.label":"Preformatted text","button.removeFormatting.label":"Remove formatting","button.ol.label":"Insert ordered list","button.ul.label":"Insert unordered list","button.indent.label":"Indent list","button.outdent.label":"Outdent list","button.createLink.label":"Insert link","button.removeLink.label":"Remove link","button.createAbbr.label":"Insert abbreviation","button.characterPicker.label":"Pick special characters","button.createLink.label":"Insert link","button.removeLink.label":"Remove link","button.createAbbr.label":"Insert abbreviation","button.characterPicker.label":"Pick special characters","button.justifyLeft.label":"Align to the left","button.justifyRight.label":"Align to the right","button.justifyCenter.label":"Center","button.justifyFull.label":"Justify","button.horizontalRule.label":"Insert horizontal rule","button.createLanguageAnnotation.label":"Insert language annotation","button.metaview.label":"Switch between meta and normal view","button.quote.label":"Format selection as quote","button.blockquote.label":"Format selection as blockquote","tab.format.label":"Format","tab.insert.label":"Insert","tab.abbr.label":"Abbreviation","tab.img.label":"Image","tab.link.label":"Link","tab.list.label":"List","tab.table.label":"Table","tab.col.label":"Table Column","tab.row.label":"Table Row","tab.cell.label":"Table Cell","tab.wai-lang.label":"Language annotation"},"ca":true,"de":true,"mk":true,"pt-br":true,"ru":true,"uk":true,"zh-hans":true});define('ui/toolbar',['jquery','aloha/core','ui/surface','ui/tab','ui/floating','ui/context','i18n!ui/nls/i18n','jqueryui'],function($,Aloha,Surface,Tab,floating,Context,i18n){var Toolbar=Surface.extend({_moveTimeout:null,$_container:null,_tabBySlot:null,_tabs:[],_constructor:function(context,tabs){var tabSettings,tabInstance,i,key;this._super(context);this.$element=$('<div>',{'class':'aloha-ui aloha-ui-toolbar','unselectable':'on'});this.$_container=Tab.createContainer().appendTo(this.$element);this._tabBySlot={};for(i=0;i<tabs.length;i++){tabSettings=tabs[i];tabInstance=new Tab(context,{label:i18n.t(tabSettings.label,tabSettings.label),showOn:tabSettings.showOn,container:this.$_container},tabSettings.components);for(key in tabInstance._elemBySlot){if(tabInstance._elemBySlot.hasOwnProperty(key)){this._tabBySlot[key]=tabInstance;}}
this._tabs.push({tab:tabInstance,settings:tabSettings});}
floating.makeFloating(this,Toolbar);},adoptInto:function(slot,component){var tab=this._tabBySlot[slot];return tab&&tab.adoptInto(slot,component);},getActiveContainer:function(){return this.$_container.data('aloha-active-container');},getContainers:function(){return this.$_container.data('aloha-tabs');},_move:function(duration){var toolbar=this;if(toolbar._moveTimeout){clearTimeout(toolbar._moveTimeout);}
toolbar._moveTimeout=setTimeout(function(){toolbar._moveTimeout=null;if(Aloha.activeEditable&&Toolbar.isFloatingMode){floating.floatSurface(toolbar,Aloha.activeEditable,duration,Toolbar.setFloatingPosition);}},20);},addPin:function(){var $pin=$('<div class="aloha-ui-pin">');var $element=this.$element;$element.find('.ui-tabs').append($pin);$element.find('.ui-tabs').hover(function(){$element.addClass('aloha-ui-hover');},function(){$element.removeClass('aloha-ui-hover');});if(!Toolbar.isFloatingMode){$pin.addClass('aloha-ui-pin-down');}
var surface=this;$pin.click(function(){Toolbar.isFloatingMode=!Toolbar.isFloatingMode;var position;if(Toolbar.isFloatingMode){position={top:Toolbar.pinTop,left:Toolbar.pinLeft};}else{position=surface.$element.offset();position.top-=$(window).scrollTop();}
Toolbar.setFloatingPosition(position);floating.togglePinSurface(surface,position,Toolbar.isFloatingMode);});},show:function(){Toolbar.$surfaceContainer.children().detach();Toolbar.$surfaceContainer.append(this.$element);Toolbar.$surfaceContainer.stop().fadeTo(200,1);var position=Toolbar.getFloatingPosition();this.$element.stop().css({top:position.top,left:position.left});this._move();},hide:function(){Toolbar.$surfaceContainer.stop().fadeOut(200,function(){Toolbar.$surfaceContainer.children().detach();});}});$.extend(Toolbar,{$surfaceContainer:null,isFloatingMode:true,pinLeft:0,pinTop:0,init:function(){Toolbar.$surfaceContainer=$('<div>',{'class':'aloha aloha-surface aloha-toolbar','unselectable':'on'}).hide();$(function(){Toolbar.$surfaceContainer.appendTo('body');});Surface.trackRange(Toolbar.$surfaceContainer);var pinState=floating.getPinState();Toolbar.pinTop=pinState.top;Toolbar.pinLeft=pinState.left;Toolbar.isFloatingMode=!pinState.isPinned;},setFloatingPosition:function(position){Toolbar.pinTop=position.top;Toolbar.pinLeft=position.left;},getFloatingPosition:function(){return{top:Toolbar.pinTop,left:Toolbar.pinLeft};}});Toolbar.init();return Toolbar;});define('ui/settings',['jquery','util/arrays','util/maps','util/trees'],function($,Arrays,Maps,Trees){var defaultToolbarSettings={tabs:[{label:'tab.link.label',showOn:{scope:'link'},components:['editLink','removeLink','linkBrowser']},{label:"tab.img.label",showOn:{scope:'image'},components:[["imageSource","\n","imageTitle"],["imageResizeWidth","\n","imageResizeHeight"],["imageAlignLeft","imageAlignRight","imageAlignNone","imageIncPadding","\n","imageCropButton","imageCnrReset","imageCnrRatio","imageDecPadding"],["imageBrowser"]]},{label:"tab.abbr.label",showOn:{scope:'abbr'},components:[["abbrText","removeAbbr"]]},{label:"tab.wai-lang.label",showOn:{scope:'wai-lang'},components:[["wailangfield","removewailang"]]},{label:"tab.table.label",showOn:{scope:'table.cell'},components:[["mergecells","splitcells","tableCaption","tableSummary","formatTable"]]},{label:"tab.col.label",showOn:{scope:'table.column'},components:[["addcolumnleft","addcolumnright","deletecolumns","columnheader","mergecellsColumn","splitcellsColumn","formatColumn"]]},{label:"tab.row.label",showOn:{scope:'table.row'},components:[["addrowbefore","addrowafter","deleterows","rowheader","mergecellsRow","splitcellsRow","formatRow"]]},{label:"tab.cell.label",showOn:{scope:'table.cell'},components:[["alignTop","alignMiddle","alignBottom","formatCell"]]}]};function combineToolbarSettings(userTabs,defaultTabs,exclude){var defaultTabsByLabel=Maps.fillTuples({},Arrays.map(defaultTabs,function(tab){return[tab.label,tab];}));var exclusionLookup=makeExclusionMap(userTabs,exclude);function pruneDefaultComponents(form){return'array'===$.type(form)?!form.length:exclusionLookup[form];};userTabs=mergeDefaultComponents(userTabs,defaultTabsByLabel,pruneDefaultComponents);defaultTabs=remainingDefaultTabs(defaultTabs,exclusionLookup,pruneDefaultComponents);return userTabs.concat(defaultTabs);}
function remainingDefaultTabs(defaultTabs,exclusionLookup,pruneDefaultComponents){var i,tab,tabs=[],defaultTab,components;for(i=0;i<defaultTabs.length;i++){defaultTab=defaultTabs[i];if(!exclusionLookup[defaultTab.label]){components=Trees.postprune(defaultTab.components,pruneDefaultComponents);if(components){tab=$.extend({},defaultTab);tab.components=components;tabs.push(tab);}}}
return tabs;}
function mergeDefaultComponents(userTabs,defaultTabsByLabel,pruneDefaultComponents){var i,tab,tabs=[],userTab,components,defaultTab,defaultComponents;for(i=0;i<userTabs.length;i++){userTab=userTabs[i];components=userTab.components||[];defaultTab=defaultTabsByLabel[userTab.label];if(!userTab.exclusive&&defaultTab){defaultComponents=Trees.postprune(defaultTab.components,pruneDefaultComponents);if(defaultComponents){components=components.concat(defaultComponents);}}
tab=$.extend({},defaultTab||{},userTab);tab.components=components;tabs.push(tab);}
return tabs;}
function makeExclusionMap(userTabs,exclude){var i,map=Maps.fillKeys({},exclude,true);for(i=0;i<userTabs.length;i++){map[userTabs[i].label]=true;Maps.fillKeys(map,Trees.flatten(userTabs[i].components),true);}
return map;}
return{defaultToolbarSettings:defaultToolbarSettings,combineToolbarSettings:combineToolbarSettings};});define('ui/ui-plugin',['jquery','aloha','ui/context','ui/container','ui/surface','ui/toolbar','ui/scopes','ui/settings','PubSub','jqueryui'],function($,Aloha,Context,Container,Surface,Toolbar,Scopes,Settings,PubSub){var context=new Context(),toolbar=new Toolbar(context,getToolbarSettings());Aloha.bind('aloha-editable-activated',function(event,alohaEvent){Surface.show(context);Container.showContainersForContext(context,event);});Aloha.bind('aloha-editable-deactivated',function(event,alohaEvent){if(!Surface.suppressHide){Surface.hide(context);}});PubSub.sub('aloha.ui.scope.change',function(){Container.showContainersForContext(context);primaryScopeForegroundTab(Scopes.getPrimaryScope());});function getToolbarSettings(){var userSettings=Aloha.settings.toolbar,defaultSettings=Settings.defaultToolbarSettings;if(!userSettings){return defaultSettings.tabs;}
return Settings.combineToolbarSettings(userSettings.tabs||[],defaultSettings.tabs,userSettings.exclude||[]);}
function primaryScopeForegroundTab(){var tabs=toolbar._tabs,primaryScope=Scopes.getPrimaryScope(),settings,i;for(i=0;i<tabs.length;i++){settings=tabs[i].settings;if('object'===$.type(settings.showOn)&&settings.showOn.scope===primaryScope){tabs[i].tab.foreground();break;}}}
function adoptInto(slot,component){return toolbar.adoptInto(slot,component);}
function showToolbar(event){Surface.show(context);Container.showContainersForContext(context,event);}
return{adoptInto:adoptInto,showToolbar:showToolbar};});define('ui/ui',['jquery','ui/ui-plugin'],function($,UiPlugin){var components={};function adopt(name,SuperTypeOrInstance,settings){var Type,component;if('string'!==$.type(name)){settings=SuperTypeOrInstance;SuperTypeOrInstance=name;name=settings.name;}else{settings=$.extend({name:name},settings);}
if(!SuperTypeOrInstance.isInstance){Type=settings?SuperTypeOrInstance.extend(settings):SuperTypeOrInstance;component=new Type();}else{component=SuperTypeOrInstance;}
components[name]=component;UiPlugin.adoptInto(name,component);return component;}
function getComponentAtSlot(slot){return components[slot]||null;}
return{adopt:adopt,getAdoptedComponent:getComponentAtSlot};});define('ui/utils',['jquery','jqueryui'],function($){function wrapWithLabel(labelText,element){return $('<label>',{'class':'aloha-ui-label'}).append($('<span>',{'class':'aloha-ui-label-text','text':labelText})).append(element);}
function makeButton(button,props,hasMenu){button.button({label:makeButtonLabel(props),text:!!(props.text||props.html),icons:{primary:props.icon||(props.iconUrl&&'aloha-ui-inline-icon-container')||null,secondary:(hasMenu&&'aloha-jqueryui-icon ui-icon-triangle-1-s')||null}});if(props.iconUrl){button.button('widget').children('.ui-button-icon-primary').append(makeButtonIconFromUrl(props.iconUrl));}
return button;}
function makeButtonLabel(props){return props.html||props.text||props.tooltip;}
function makeButtonLabelWithIcon(props){var label=makeButtonLabel(props);if(props.iconUrl){label=makeButtonIconFromUrl(props.iconUrl)+label;}
return label;}
function makeButtonIconFromUrl(iconUrl){return'<img class="aloha-ui-inline-icon" src="'+iconUrl+'">';}
function makeButtonElement(attr){return $('<button>',attr).attr('type','button');}
return{wrapWithLabel:wrapWithLabel,makeButton:makeButton,makeButtonElement:makeButtonElement,makeButtonLabel:makeButtonLabel,makeButtonLabelWithIcon:makeButtonLabelWithIcon,makeButtonIconFromUrl:makeButtonIconFromUrl};});define('ui/vendor/jquery-ui-autocomplete-html',["jquery","jqueryui"],function(jQuery){(function($){var proto=$.ui.autocomplete.prototype,initSource=proto._initSource;function filter(array,term){var matcher=new RegExp($.ui.autocomplete.escapeRegex(term),"i");return $.grep(array,function(value){return matcher.test($("<div>").html(value.label||value.value||value).text());});}
$.extend(proto,{_initSource:function(){if(this.options.html&&$.isArray(this.options.source)){this.source=function(request,response){response(filter(this.options.source,request.term));};}else{initSource.call(this);}},_renderItem:function(ul,item){return $("<li></li>").data("item.autocomplete",item).append($("<a></a>")[this.options.html?"html":"text"](item.label)).appendTo(ul);}});})(jQuery);});define('ui/port-helper-attribute-field',['jquery','ui/ui','ui/component','ui/scopes','ui/context','ui/utils','aloha/repositorymanager','aloha/selection','aloha/console','ui/vendor/jquery-ui-autocomplete-html'],function($,Ui,Component,Scopes,Context,Utils,RepositoryManager,Selection,console){var AttributeField=function(props){var valueField=props.valueField||'id',displayField=props.displayField||'name',objectTypeFilter=props.objectTypeFilter||['all'],placeholder=props.placeholder,noTargetHighlight=!!props.noTargetHighlight,element=props.element?$(props.element):$('<input id="aloha-attribute-field-'+props.name+'">'),component,template,resourceItem,resourceValue,targetObject,targetAttribute,lastAttributeValue;if(props.cls){element.addClass(props.cls);}
if(props.width){element.width(props.width);}
component=Ui.adopt(props.name,Component,{scope:props.scope,init:function(){if(props.element){this.element=element;}else{if(props.label){this.element=Utils.wrapWithLabel(props.label,element);if(props.labelClass){this.element.addClass(props.labelClass);}}else{this.element=$('<span>').append(element);}}
element.autocomplete({'html':true,'appendTo':Context.selector,'source':function(req,res){RepositoryManager.query({queryString:req.term,objectTypeFilter:objectTypeFilter},function(data){res($.map(data.items,function(item){return{label:parse(template,item),value:item.name,obj:item};}));});},"select":onSelect});}});element.bind("focus",onFocus).bind("blur",onBlur).bind("keydown",onKeyDown).bind("keyup",onKeyup);setPlaceholder();function onSelect(event,ui){if(ui.item){setItem(ui.item.obj);}
finishEditing();}
function onBlur(){finishEditing();}
function onFocus(event,ui){if(!$(event.target).is(':visible')){return;}
changeTargetBackground();if(getValue()===placeholder){setValue('');}}
function onKeyDown(event){if(event.keyCode==13||event.keyCode==27){event.preventDefault();}}
function onKeyup(event){if(resourceItem&&resourceValue!==getValue()){resourceItem=null;resourceValue=null;}
if(!resourceItem){setAttribute(targetAttribute,getValue());}
if((event.keyCode==13||event.keyCode==27)){Selection.getRangeObject().select();finishEditing();}}
function finishEditing(){restoreTargetBackground();if(!targetObject||lastAttributeValue===$(targetObject).attr(targetAttribute)){return;}
if(!resourceItem){RepositoryManager.markObject(targetObject);}
if(getValue()===''){setPlaceholder();}}
function changeTargetBackground(){if(noTargetHighlight){return;}
restoreTargetBackground();var target=$(targetObject);if(target&&target.context&&target.context.style&&target.context.style['background-color']){target.attr('data-original-background-color',target.context.style['background-color']);}
target.css('background-color','#80B5F2');}
function restoreTargetBackground(){if(noTargetHighlight){return;}
var target=$(targetObject);var color=target.attr('data-original-background-color');if(color){target.css('background-color',color);}else{target.css('background-color','');}
target.removeAttr('data-original-background-color');}
function parse(template,item){return template.replace(/\{([^}]+)\}/g,function(_,name){return name in item?item[name]:"";});}
function setPlaceholder(){if(null==placeholder){return;}
element.css('color','#AAA');element.val(placeholder);}
function setTemplate(tmpl){template=tmpl;}
function setObjectTypeFilter(objTypeFilter){objectTypeFilter=objTypeFilter;}
function addListener(eventName,handler){element.bind(eventName,$.proxy(handler,attrField));}
function getValue(){return element.val();}
function setValue(value){element.val(value);element.css('color','black');}
function setItem(item){resourceItem=item;if(item){var v=item[displayField];setValue(v);resourceValue=v;setAttribute(targetAttribute,item[valueField]);RepositoryManager.markObject(targetObject,item);}else{resourceValue=null;}}
function getItem(){return resourceItem;}
function setAttribute(attr,value,regex,reference){if(targetObject){var setAttr=true;if(typeof reference!='undefined'){var regxp=new RegExp(regex);if(!reference.match(regxp)){setAttr=false;}}
if(setAttr){$(targetObject).attr(attr,value);}else{$(targetObject).removeAttr(attr);}}}
function setTargetObject(obj,attr){targetObject=obj;targetAttribute=attr;setItem(null);if(obj&&attr){lastAttributeValue=$(obj).attr(attr);setValue($(targetObject).attr(targetAttribute));}else{setValue('');return;}
RepositoryManager.getObject(obj,function(items){if(items&&items.length>0){setItem(items[0]);}});}
function getTargetObject(){return targetObject;}
function focus(){component.focus();element.focus();}
function foreground(){component.foreground();}
function show(){element.show();}
function hide(){element.hide();}
function getInputId(){return element.attr("id");}
function hasInputElem(){return true;}
function getInputElem(){return element[0];}
var attrField={getInputElem:getInputElem,hasInputElem:hasInputElem,getInputId:getInputId,hide:hide,show:show,foreground:foreground,focus:focus,getTargetObject:getTargetObject,setTargetObject:setTargetObject,setAttribute:setAttribute,getItem:getItem,setItem:setItem,setValue:setValue,getValue:getValue,addListener:addListener,setObjectTypeFilter:setObjectTypeFilter,setTemplate:setTemplate,setPlaceholder:setPlaceholder};return attrField;}
return AttributeField;});define('ui/button',['jquery','ui/component','ui/utils','jqueryui'],function(jQuery,Component,Utils){var Button=Component.extend({init:function(){this._super();this.createButtonElement();Utils.makeButton(this.buttonElement,this).button('widget').tooltip({tooltipClass:'aloha aloha-ui-tooltip',position:{my:'left top',at:'right bottom'}}).click(jQuery.proxy(function(){this.buttonElement.tooltip('close',null,true);this._onClick();},this));},_onClick:function(){this.click();},click:function(){},createButtonElement:function(){var button=Utils.makeButtonElement();if(this['class']){button.addClass(this['class']);}
this.element=this.buttonElement=button;return button;},disable:function(){this.element.button('option','disabled',false);},enable:function(enable_opt){this.element.button('option','disabled',enable_opt===false);}});return Button;});define('ui/toggleButton',['jquery','ui/button','jqueryui'],function(jQuery,Button){var idCounter=0;var ToggleButton=Button.extend({_checked:false,setState:function(toggled){if(this._checked===toggled){return;}
this._checked=toggled;if(toggled){this.element.addClass("aloha-button-active");}else{this.element.removeClass("aloha-button-active");}},getState:function(){return this._checked;},_onClick:function(){this.setState(!this._checked);this.click();}});return ToggleButton;});define('link/nls/i18n',{"root":{"button.addlink.tooltip":"Insert Link","button.removelink.tooltip":"Remove Link","newlink.defaulttext":"New Link","floatingmenu.tab.link":"Link","link.target.self":"Self","link.target.blank":"Blank","link.target.parent":"Parent","link.target.top":"Top","link.target.framename":"Framename","link.target.legend":"Target","link.title.legend":"Title","insertLink":"ctrl+k"},"ca":true,"de":true,"mk":true,"pt-br":true,"ru":true,"uk":true,"zh-hans":true});define('aloha/nls/i18n',{"root":{"plugin.abbr.floatingmenu.tab.abbr":"Abbreviation","floatingmenu.tab.format":"Format","floatingmenu.tab.insert":"Insert","yes":"Yes","no":"No","cancel":"Cancel","repository.no_item_found":"No item found.","repository.loading":"Loading","repository.no_items_found_yet":"No items found yet..."},"ca":true,"de":true,"mk":true,"pt-br":true,"ru":true,"uk":true,"zh-hans":true});define('link/link-plugin',['aloha','aloha/plugin','aloha/ephemera','jquery','ui/port-helper-attribute-field','ui/ui','ui/scopes','ui/surface','ui/button','ui/toggleButton','i18n!link/nls/i18n','i18n!aloha/nls/i18n','aloha/console'],function(Aloha,Plugin,Ephemera,jQuery,AttributeField,Ui,Scopes,Surface,Button,ToggleButton,i18n,i18nCore,console){var GENTICS=window.GENTICS,pluginNamespace='aloha-link',oldValue='',newValue;Ephemera.classes('aloha-link-pointer','aloha-link-text');return Plugin.create('link',{config:['a'],targetregex:'',target:'',cssclassregex:'',cssclass:'',objectTypeFilter:[],onHrefChange:null,ignoreNextSelectionChangedEvent:false,hrefUpdateInt:null,hotKey:{insertLink:i18n.t('insertLink','ctrl+k')},hrefValue:'http://',init:function(){var that=this;if(typeof this.settings.targetregex!='undefined'){this.targetregex=this.settings.targetregex;}
if(typeof this.settings.target!='undefined'){this.target=this.settings.target;}
if(typeof this.settings.cssclassregex!='undefined'){this.cssclassregex=this.settings.cssclassregex;}
if(typeof this.settings.cssclass!='undefined'){this.cssclass=this.settings.cssclass;}
if(typeof this.settings.objectTypeFilter!='undefined'){this.objectTypeFilter=this.settings.objectTypeFilter;}
if(typeof this.settings.onHrefChange!='undefined'){this.onHrefChange=this.settings.onHrefChange;}
if(typeof this.settings.hotKey!='undefined'){jQuery.extend(true,this.hotKey,this.settings.hotKey);}
if(typeof this.settings.hrefValue!='undefined'){this.hrefValue=this.settings.hrefValue;}
this.createButtons();this.subscribeEvents();this.bindInteractions();Aloha.ready(function(){that.initSidebar(Aloha.Sidebar.right);});},nsSel:function(){var stringBuilder=[],prefix=pluginNamespace;jQuery.each(arguments,function(){stringBuilder.push('.'+(this==''?prefix:prefix+'-'+this));});return jQuery.trim(stringBuilder.join(' '));},nsClass:function(){var stringBuilder=[],prefix=pluginNamespace;jQuery.each(arguments,function(){stringBuilder.push(this==''?prefix:prefix+'-'+this);});return jQuery.trim(stringBuilder.join(' '));},initSidebar:function(sidebar){var pl=this;pl.sidebar=sidebar;sidebar.addPanel({id:pl.nsClass('sidebar-panel-target'),title:i18n.t('floatingmenu.tab.link'),content:'',expanded:true,activeOn:'a, link',onInit:function(){var that=this,content=this.setContent('<div class="'+pl.nsClass('target-container')+'"><fieldset><legend>'+i18n.t('link.target.legend')+'</legend><ul><li><input type="radio" name="targetGroup" class="'+pl.nsClass('radioTarget')+'" value="_self" /><span>'+i18n.t('link.target.self')+'</span></li>'+'<li><input type="radio" name="targetGroup" class="'+pl.nsClass('radioTarget')+'" value="_blank" /><span>'+i18n.t('link.target.blank')+'</span></li>'+'<li><input type="radio" name="targetGroup" class="'+pl.nsClass('radioTarget')+'" value="_parent" /><span>'+i18n.t('link.target.parent')+'</span></li>'+'<li><input type="radio" name="targetGroup" class="'+pl.nsClass('radioTarget')+'" value="_top" /><span>'+i18n.t('link.target.top')+'</span></li>'+'<li><input type="radio" name="targetGroup" class="'+pl.nsClass('radioTarget')+'" value="framename" /><span>'+i18n.t('link.target.framename')+'</span></li>'+'<li><input type="text" class="'+pl.nsClass('framename')+'" /></li></ul></fieldset></div>'+'<div class="'+pl.nsClass('title-container')+'" ><fieldset><legend>'+i18n.t('link.title.legend')+'</legend><input type="text" class="'+pl.nsClass('linkTitle')+'" /></fieldset></div>').content;jQuery(pl.nsSel('framename')).live('keyup',function(){jQuery(that.effective).attr('target',jQuery(this).val().replace('\"','&quot;').replace("'","&#39;"));});jQuery(pl.nsSel('radioTarget')).live('change',function(){if(jQuery(this).val()=='framename'){jQuery(pl.nsSel('framename')).slideDown();}else{jQuery(pl.nsSel('framename')).slideUp().val('');jQuery(that.effective).attr('target',jQuery(this).val());}});jQuery(pl.nsSel('linkTitle')).live('keyup',function(){jQuery(that.effective).attr('title',jQuery(this).val().replace('\"','&quot;').replace("'","&#39;"));});},onActivate:function(effective){var that=this;that.effective=effective;if(jQuery(that.effective).attr('target')!=null){var isFramename=true;jQuery(pl.nsSel('framename')).hide().val('');jQuery(pl.nsSel('radioTarget')).each(function(){jQuery(this).removeAttr('checked');if(jQuery(this).val()===jQuery(that.effective).attr('target')){isFramename=false;jQuery(this).attr('checked','checked');}});if(isFramename){jQuery(pl.nsSel('radioTarget[value="framename"]')).attr('checked','checked');jQuery(pl.nsSel('framename')).val(jQuery(that.effective).attr('target')).show();}}else{jQuery(pl.nsSel('radioTarget')).first().attr('checked','checked');jQuery(that.effective).attr('target',jQuery(pl.nsSel('radioTarget')).first().val());}
var that=this;that.effective=effective;jQuery(pl.nsSel('linkTitle')).val(jQuery(that.effective).attr('title'));}});sidebar.show();},subscribeEvents:function(){var that=this,isEnabled={};Aloha.bind('aloha-editable-created',function(event,editable){var config=that.getEditableConfig(editable.obj),enabled=(jQuery.inArray('a',config)!==-1);isEnabled[editable.getId()]=enabled;if(!enabled){return;}
editable.obj.bind('keydown',that.hotKey.insertLink,function(){if(that.findLinkMarkup()){that.hrefField.foreground();that.hrefField.focus();}else{that.insertLink(true);}
return false;});editable.obj.find('a').each(function(){that.addLinkEventHandlers(this);});});Aloha.bind('aloha-editable-activated',function(){if(isEnabled[Aloha.activeEditable.getId()]){that._formatLinkButton.show();that._insertLinkButton.show();}else{that._formatLinkButton.hide();that._insertLinkButton.hide();}});var insideLinkScope=false;Aloha.bind('aloha-selection-changed',function(event,rangeObject){var enteredLinkScope=false;if(Aloha.activeEditable&&isEnabled[Aloha.activeEditable.getId()]){enteredLinkScope=selectionChangeHandler(that,rangeObject);if(enteredLinkScope&&insideLinkScope!==enteredLinkScope){that.hrefField.foreground();}}
insideLinkScope=enteredLinkScope;});var linkPlugin=this;Aloha.bind('aloha-editable-deactivated',function(){if(insideLinkScope){setTimeout(function(){if(!insideLinkScope){linkPlugin.toggleLinkScope(false);}},100);insideLinkScope=false;}});},toggleLinkScope:function(show){if(this._isScopeActive===show&&Aloha.activeEditable&&this._isScopeActive_editableId===Aloha.activeEditable.getId()){return;}
this._isScopeActive=show;this._isScopeActive_editableId=Aloha.activeEditable&&Aloha.activeEditable.getId();if(show){this.hrefField.show();this._insertLinkButton.hide();if(Aloha.activeEditable&&Aloha.activeEditable.obj[0].nodeName==='A'){this._removeLinkButton.hide();}else{this._removeLinkButton.show();}
this._formatLinkButton.setState(true);Scopes.enterScope(this.name,'link');}else{this.hrefField.hide();this._insertLinkButton.show();this._removeLinkButton.hide();this._formatLinkButton.setState(false);Scopes.leaveScope(this.name,'link',true);}},addLinkEventHandlers:function(link){var that=this;jQuery(link).mouseenter(function(e){Aloha.Log.debug(that,'mouse over link.');that.mouseOverLink=link;that.updateMousePointer();});jQuery(link).mouseleave(function(e){Aloha.Log.debug(that,'mouse left link.');that.mouseOverLink=null;that.updateMousePointer();});jQuery(link).click(function(e){if(e.metaKey){Aloha.activeEditable.blur();window.setTimeout(function(){location.href=e.target;},0);e.stopPropagation();return false;}});},createButtons:function(){var that=this;this._formatLinkButton=Ui.adopt("formatLink",ToggleButton,{tooltip:i18n.t("button.addlink.tooltip"),icon:"aloha-icon aloha-icon-link",scope:'Aloha.continuoustext',click:function(){that.formatLink();}});this._insertLinkButton=Ui.adopt("insertLink",Button,{tooltip:i18n.t("button.addlink.tooltip"),icon:"aloha-icon aloha-icon-link",scope:'Aloha.continuoustext',click:function(){that.insertLink(false);}});this.hrefField=AttributeField({name:'editLink',width:320,valueField:'url',cls:'aloha-link-href-field',scope:'Aloha.continuoustext'});this.hrefField.setTemplate('<span><b>{name}</b><br/>{url}</span>');this.hrefField.setObjectTypeFilter(this.objectTypeFilter);this._removeLinkButton=Ui.adopt("removeLink",Button,{tooltip:i18n.t("button.removelink.tooltip"),icon:"aloha-icon aloha-icon-unlink",scope:'Aloha.continuoustext',click:function(){that.removeLink();}});},bindInteractions:function(){var that=this;this.hrefField.addListener('keyup',function(event){if(event.keyCode==27){var curval=that.hrefField.getValue();if(curval[0]=='/'||curval[0]=='#'||curval.match(/^.*\.([a-z]){2,4}$/i)||curval.match(/^([a-z]){3,10}:\/\/.+/i)||curval.match(/^(mailto|tel):.+/i)){}else{var hrefValue=that.hrefField.getValue();that.hrefField.setValue(hrefValue);if(hrefValue==that.hrefValue||hrefValue==''){that.removeLink(false);}}}
that.hrefChange();if(event.keyCode==13){var range=Aloha.Selection.getRangeObject();that.ignoreNextSelectionChangedEvent=true;range.startContainer=range.endContainer;range.startOffset=range.endOffset;range.select();that.ignoreNextSelectionChangedEvent=true;var hrefValue=jQuery(that.hrefField.getInputElem()).attr('value');if(hrefValue==that.hrefValue||hrefValue==''){that.removeLink(false);}
window.setTimeout(function(){Scopes.setScope('Aloha.continuoustext');},100);}else{newValue=jQuery(that.hrefField.getInputElem()).attr('value');if(oldValue!=newValue){oldValue=newValue;}}});jQuery(document).keydown(function(e){Aloha.Log.debug(that,'Meta key down.');that.metaKey=e.metaKey;that.updateMousePointer();}).keyup(function(e){Aloha.Log.debug(that,'Meta key up.');that.metaKey=e.metaKey;that.updateMousePointer();});},updateMousePointer:function(){if(this.metaKey&&this.mouseOverLink){Aloha.Log.debug(this,'set pointer');jQuery(this.mouseOverLink).removeClass('aloha-link-text');jQuery(this.mouseOverLink).addClass('aloha-link-pointer');}else{jQuery(this.mouseOverLink).removeClass('aloha-link-pointer');jQuery(this.mouseOverLink).addClass('aloha-link-text');}},findLinkMarkup:function(range){if(typeof range=='undefined'){range=Aloha.Selection.getRangeObject();}
if(Aloha.activeEditable){var limit=Aloha.activeEditable.obj;if(limit[0]&&limit[0].nodeName==='A'){limit=limit.parent();}
return range.findMarkup(function(){return this.nodeName=='A';},limit);}else{return null;}},formatLink:function(){if(Aloha.activeEditable){if(this.findLinkMarkup(Aloha.Selection.getRangeObject())){this.removeLink();}else{this.insertLink();}}},insertLink:function(extendToWord){var that=this,range=Aloha.Selection.getRangeObject(),linkText,newLink;if(!(range.startContainer&&range.endContainer)){return;}
if(this.findLinkMarkup(range)){return;}
this.hrefField.foreground();if(range.isCollapsed()&&extendToWord!==false){GENTICS.Utils.Dom.extendToWord(range);}
if(range.isCollapsed()){linkText=i18n.t('newlink.defaulttext');newLink=jQuery('<a href="'+that.hrefValue+'" class="aloha-new-link">'+linkText+'</a>');GENTICS.Utils.Dom.insertIntoDOM(newLink,range,jQuery(Aloha.activeEditable.obj));range.startContainer=range.endContainer=newLink.contents().get(0);range.startOffset=0;range.endOffset=linkText.length;}else{newLink=jQuery('<a href="'+that.hrefValue+'" class="aloha-new-link"></a>');GENTICS.Utils.Dom.addMarkup(range,newLink,false);}
Aloha.activeEditable.obj.find('a.aloha-new-link').each(function(i){that.addLinkEventHandlers(this);jQuery(this).removeClass('aloha-new-link');});range.select();this.hrefField.focus();if(this.hrefField.hasInputElem()){jQuery(this.hrefField.getInputElem()).attr('value',that.hrefValue).select();}
this.hrefChange();},removeLink:function(terminateLinkScope){var range=Aloha.Selection.getRangeObject(),foundMarkup=this.findLinkMarkup();this.hrefField.setItem(null);if(foundMarkup){GENTICS.Utils.Dom.removeFromDOM(foundMarkup,range,true);range.startContainer=range.endContainer;range.startOffset=range.endOffset;range.select();if(typeof terminateLinkScope=='undefined'||terminateLinkScope===true){Scopes.setScope('Aloha.continuoustext');}}},hrefChange:function(){var that=this;if(this.target!=''){this.hrefField.setAttribute('target',this.target,this.targetregex,this.hrefField.getValue());}
this.hrefField.setAttribute('class',this.cssclass,this.cssclassregex,this.hrefField.getValue());Aloha.trigger('aloha-link-href-change',{obj:that.hrefField.getTargetObject(),href:that.hrefField.getValue(),item:that.hrefField.getItem()});if(typeof this.onHrefChange=='function'){this.onHrefChange.call(this,this.hrefField.getTargetObject(),this.hrefField.getValue(),this.hrefField.getItem());}}});function selectionChangeHandler(that,rangeObject){var foundMarkup,enteredLinkScope=false;if(!that.ignoreNextSelectionChangedEvent&&Aloha.Selection.isSelectionEditable()&&Aloha.activeEditable!=null){foundMarkup=that.findLinkMarkup(rangeObject);if(foundMarkup){that.toggleLinkScope(true);that.hrefField.setTargetObject(foundMarkup,'href');if(jQuery('#'+that.hrefField.getInputId()).length==0){if(that.hrefUpdateInt!==null){clearInterval(that.hrefUpdateInt);}
that.hrefUpdateInt=setInterval(function(){if(jQuery('#'+that.hrefField.getInputId()).length>0){that.hrefField.setTargetObject(foundMarkup,'href');clearInterval(that.hrefUpdateInt);}},200);}
Aloha.trigger('aloha-link-selected');enteredLinkScope=true;}else{that.toggleLinkScope(false);that.hrefField.setTargetObject(null);Aloha.trigger('aloha-link-unselected');}}else{that.toggleLinkScope(false);}
that.ignoreNextSelectionChangedEvent=false;return enteredLinkScope;}});define('ui/dialog',['jquery','ui/component'],function($,Component){function makeDialogDiv(props){var textOrHtml={};if(props.text){textOrHtml['text']=props.text;}
if(props.html){textOrHtml['html']=props.html;}
return $('<div>',textOrHtml);}
function wrapDialogButtons(buttons){for(var title in buttons){if(buttons.hasOwnProperty(title)){buttons[title]=(function(orgCallback){return function(){orgCallback.apply(this);$(this).dialog('destroy').remove();};})(buttons[title]);}}
return buttons;}
function makeDialogProps(props,defaultTitle){var cls='aloha aloha-dialog';if(props.cls){cls+=' '+props.cls;}
return{'resizable':false,'modal':true,'title':props.title||defaultTitle,'dialogClass':cls,'zIndex':10200};}
return{'confirm':function(props){var buttons=props.buttons||{};buttons['Yes']=buttons['Yes']||props.yes||$.noop;buttons['No']=buttons['No']||props.no||$.noop;if(props.answer){var yes=buttons['Yes'];var no=buttons['No'];buttons['Yes']=function(){yes();props.answer(true);};buttons['No']=function(){no();props.answer(false);};}
var dialog=makeDialogDiv(props).dialog($.extend(makeDialogProps(props,'Confirm'),{'buttons':wrapDialogButtons(buttons)}));return function(){dialog.dialog('destroy').remove();};},'alert':function(props){var dialog=makeDialogDiv(props).dialog($.extend(makeDialogProps(props,'Alert'),{'buttons':wrapDialogButtons({'Dismiss':$.noop})}));return function(){dialog.dialog('destroy').remove();};},'progress':function(props){var progressbar=$("<div>").progressbar({value:null!=props.value?props.value:100});var dialog=makeDialogDiv(props).dialog($.extend(makeDialogProps(props,'Progress'),{open:function(){$(this).append(progressbar);}}));return function(value){if(null!=value){progressbar.progressbar({value:value});}else{dialog.dialog('destroy').remove();}};}};});define('ui/multiSplit',['jquery','ui/component','ui/button','ui/utils'],function($,Component,Button,Utils){var MultiSplit=Component.extend({_activeButton:null,_isOpen:false,init:function(){this._super();var multiSplit=this;var element=this.element=$('<div>',{'class':'aloha-multisplit'});var content=this.contentElement=$('<div>',{'class':'aloha-multisplit-content'}).appendTo(element);var toggle=this.toggleButton=Utils.makeButtonElement({'class':'aloha-multisplit-toggle',click:function(){multiSplit.toggle();}}).button().appendTo(element);this.buttons=[];var buttons=this.getButtons();if(0===buttons.length){element.hide();}
for(var i=0;i<buttons.length;i++){this.addButton(buttons[i]);}
$('body').click(function(event){if(multiSplit._isOpen&&!multiSplit.element.is(event.target)&&0===multiSplit.element.find(event.target).length){multiSplit.close();}});},addButton:function(props){var multiSplit=this;var component=new(Button.extend({tooltip:props.tooltip,icon:props.wide?props.icon:'aloha-large-icon '+props.icon,iconOnly:props.wide?false:true,init:function(){this._super();if(props.init){props.init.call(this);}},click:function(){props.click.apply(multiSplit,arguments);multiSplit.close();}}))();if(!props.wide){component.element.addClass('aloha-large-button');}
multiSplit.buttons[props.name]={settings:props,component:component,element:component.element,visible:true};var fullwidthButtons=this.contentElement.children('.aloha-ui-multisplit-fullwidth');if(!props.wide&&fullwidthButtons.length){fullwidthButtons.before(component.element[0]);}else{this.contentElement.append(component.element[0]);}},setActiveButton:function(name){if(!name){name=null;}
if(null!==this._activeButton){this.buttons[this._activeButton].element.removeClass('aloha-multisplit-active');}
this._activeButton=name;if(null!==name){this.buttons[name].element.addClass('aloha-multisplit-active');}},toggle:function(){this.element.toggleClass('aloha-multisplit-open');this._isOpen=!this._isOpen;},open:function(){this.element.addClass('aloha-multisplit-open');this._isOpen=true;},close:function(){this.element.removeClass('aloha-multisplit-open');this._isOpen=false;},show:function(name){if(!name){name=null;}
if(null!==name&&this.buttons[name]!==undefined){this.buttons[name].element.show();this.buttons[name].visible=true;this.element.show();}},hide:function(name){var button,visible=false;if(!name){name=null;}
if(null!==name&&this.buttons[name]!==undefined){this.buttons[name].element.hide();this.buttons[name].visible=false;for(button in this.buttons){if(this.buttons.hasOwnProperty(button)){if(this.buttons[button].visible){this.element.show();visible=true;break;}}}
if(!visible){this.element.hide();}}}});return MultiSplit;});define('ui/port-helper-multi-split',['aloha/core','jquery','ui/ui','ui/multiSplit'],function(Aloha,jQuery,Ui,MultiSplit){function MultiSplitButton(props){var multiSplit;multiSplit=Ui.adopt(props.name,MultiSplit,{scope:props.scope,getButtons:function(){var buttons=[];jQuery.each(props.items,function(i,item){buttons.push({tooltip:item.tooltip,text:item.text,name:item.name,icon:item.iconClass,click:item.click,init:function(){if(item.cls){this.element.addClass(item.cls);}
if(item.init){item.init.call(this);}},wide:item.wide});});return buttons;}});return{pushItem:function(item){multiSplit.addButton(item);},showItem:function(name){multiSplit.show(name);},hideItem:function(name){multiSplit.hide(name);},setActiveItem:function(name){multiSplit.setActiveButton(name);}};}
return MultiSplitButton;});define('table/nls/i18n',{"root":{"floatingmenu.tab.table":"Table","floatingmenu.tab.tablelayout":"Table Layout","deleterows.confirm":"Do you really want to delete the selected rows?","deletecolumns.confirm":"Do you really want to delete the selected columns?","deletetable.confirm":"Do you really want to delete the table?","Table":"Table","button.createtable.tooltip":"Insert Table","button.addcolleft.tooltip":"Add Column left","button.addcolright.tooltip":"Add Column right","button.delcols.tooltip":"Delete Columns","button.addrowbefore.tooltip":"Add Row before","button.addrowafter.tooltip":"Add Row after","button.delrows.tooltip":"Delete Rows","button.caption.tooltip":"Table caption","empty.caption":"Table caption","button.removeFormat.tooltip":"Remove formatting","button.removeFormat.text":"Remove formatting","button.rowheader.tooltip":"Format row as table header","button.columnheader.tooltip":"Format column as table header","button.mergecells.tooltip":"Merge Cells","button.splitcells.tooltip":"Split Cells","table.label.target":"Summary","table.sidebar.title":"Table","table.mergeCells.notRectangular":"Only a rectangular selection can be merged","table.addColumns.nonConsecutive":"Please select a single column or a consecutive range of columns","table.createTable.nestedTablesNoSupported":"Sorry, nested tables are not supported"},"ca":true,"de":true,"mk":true,"pt-br":true,"ru":true,"uk":true,"zh-hans":true});define('table/table-create-layer',['jquery'],function(jQuery){CreateLayer=function(TablePlugin){this.TablePlugin=TablePlugin;};CreateLayer.prototype.parameters={elemId:'aloha-table-createLayer',className:'aloha-table-createdialog',numX:10,numY:10,layer:undefined,target:undefined};CreateLayer.prototype.config=new Object();CreateLayer.prototype.visible=false;CreateLayer.prototype.show=function(){var layer=this.get('layer');if(layer==null){this.create();}else{this.setPosition(layer);layer.find('td').removeClass('hover');layer.show();}
this.visible=true;};CreateLayer.prototype.create=function(){var that=this;var layer=jQuery('<div></div>');layer.id=this.get('elemId');layer.addClass(this.get('className'));var table=jQuery('<table></table>');table.css('width',(this.get('numX')+6)*15);var tr;var td;for(var i=0;i<this.get('numY');i++){tr=jQuery('<tr></tr>');for(var j=0;j<this.get('numX');j++){td=jQuery('<td>\u00a0</td>');if(i==0&&j==0){td.addClass('hover');}
td.bind('mouseover',{rowId:i,colId:j},function(e){that.handleMouseOver(e,table);});td.bind('click',{rowId:i,colId:j},function(e){var rows=e.data.rowId+1;var cols=e.data.colId+1;that.TablePlugin.createTable(cols,rows);that.hide();});tr.append(td);}
table.append(tr);}
layer.append(table);this.set('layer',layer);this.setPosition();layer.bind('click',function(e){e.stopPropagation();}).mousedown(function(e){e.stopPropagation();});jQuery('body').append(layer).bind('click',function(e){if(that.visible&&!(e.target===that.get('target')[0]||jQuery.contains(that.get('target')[0],e.target))){that.hide();}});};CreateLayer.prototype.handleMouseOver=function(e,table){var rowId=e.data.rowId;var colId=e.data.colId;var innerRows=table.find('tr');for(var n=0;n<=innerRows.length;n++){var innerCells=jQuery(innerRows[n]).find('td');for(var k=0;k<=innerCells.length;k++){if(n<=rowId&&k<=colId){jQuery(innerCells[k]).addClass('hover');}else{jQuery(innerCells[k]).removeClass('hover');}}}};CreateLayer.prototype.setPosition=function(){var targetObj=jQuery(this.get('target'));var pos=targetObj.offset();this.get('layer').css('left',pos.left+'px');this.get('layer').css('top',(pos.top+targetObj.height())+'px');};CreateLayer.prototype.hide=function(){this.get('layer').hide();this.visible=false;};CreateLayer.prototype.get=function(property){if(this.config[property]){return this.config[property];}
if(this.parameters[property]){return this.parameters[property];}
return undefined;};CreateLayer.prototype.set=function(key,value){if(this.config[key]){this.config[key]=value;}else{this.parameters[key]=value;}};return CreateLayer;});define('table/table-plugin-utils',['jquery'],function($){var Utils={'cellIndexToGridColumn':function(rows,rowIdx,colIdx){var gridColumn=null;Utils.walkCells(rows,function(ri,ci,walkedGridColumn,rowspan,colspan){if(ri===rowIdx&&ci===colIdx){gridColumn=walkedGridColumn;return false;}});return gridColumn;},'walkCells':function(rows,callback){var adjust=[];for(var ri=0;ri<rows.length;ri++){var cells=rows[ri].cells;var skip=0;for(var ci=0;ci<cells.length;ci++){var cell=cells[ci];var colspan=Utils.colspan(cell);var rowspan=Utils.rowspan(cell);while(adjust[ci+skip]){adjust[ci+skip]-=1;skip+=1;}
if(false===callback(ri,ci,ci+skip,colspan,rowspan)){return;}
for(var i=0;i<colspan;i++){if(adjust[ci+skip+i]){throw"an impossible case has occurred";}
adjust[ci+skip+i]=rowspan-1;}
skip+=colspan-1;}
for(;ci+skip<adjust.length;skip++){if(adjust[ci+skip]){adjust[ci+skip]-=1;}}}},'makeGrid':function(rows){var grid=[];Utils.walkCells(rows,function(ri,ci,gridCi,colspan,rowspan){var cell=rows[ri].cells[ci];for(var spannedY=0;spannedY<rowspan;spannedY++){grid[ri+spannedY]=grid[ri+spannedY]||[];for(var spannedX=0;spannedX<colspan;spannedX++){grid[ri+spannedY][gridCi+spannedX]={'cell':cell,'colspan':colspan,'rowspan':rowspan,'spannedX':spannedX,'spannedY':spannedY};}}});return grid;},'containsDomCell':function(cellInfo){return 0===cellInfo.spannedX&&0===cellInfo.spannedY;},'leftDomCell':function(grid,ri,gridCi){do{var cellInfo=grid[ri][gridCi];if(0===cellInfo.spannedY){return cellInfo.cell;}
gridCi-=cellInfo.spannedX+1;}while(gridCi>=0);return null;},'splitCell':function(cell,createCell){var $cell=$(cell);var colspan=Utils.colspan(cell);var rowspan=Utils.rowspan(cell);if(1===colspan&&1===rowspan){return;}
var $row=$cell.parent();var $rows=$row.parent().children();var rowIdx=$row.index();var colIdx=$cell.index();var grid=Utils.makeGrid($rows);var gridColumn=Utils.cellIndexToGridColumn($rows,rowIdx,colIdx);for(var i=0;i<rowspan;i++){for(var j=(0===i?1:0);j<colspan;j++){var leftCell=Utils.leftDomCell(grid,rowIdx+i,gridColumn);if(null==leftCell){$rows.eq(rowIdx+i).prepend(createCell());}else{$(leftCell).after(createCell());}}}
$cell.removeAttr('colSpan');$cell.removeAttr('rowSpan');},'rowspan':function(cell){return parseInt($(cell).attr('rowspan'))||1;},'colspan':function(cell){return parseInt($(cell).attr('colspan'))||1;},'walkGrid':function(grid,callback){for(var i=0;i<grid.length;i++){for(var j=0;j<grid[i].length;j++){if(false===callback(grid[i][j],j,i)){return;}}}},'walkGridInsideRect':function(grid,rect,callback){Utils.walkGrid(grid,function(cellInfo,x,y){if(y>=rect.top&&y<rect.bottom&&x>=rect.left&&x<rect.right){return callback(cellInfo,x,y);}});},'leftTrimArray':function(array){for(var i=0;i<array.length;i++){if(null!=array[i]){return array.slice(i,array.length);}}
return[];},'makeContour':function(grid,hasContour){var left=[];var right=[];var top=[];var bottom=[];Utils.walkGrid(grid,function(item,x,y){if(hasContour(item,x,y)){if(null==left[y]||x<left[y]){left[y]=x;}
if(null==right[y]||x>right[y]){right[y]=x;}
if(null==top[x]||y<top[x]){top[x]=y;}
if(null==bottom[x]||y>bottom[x]){bottom[x]=y;}}});left=Utils.leftTrimArray(left);right=Utils.leftTrimArray(right);top=Utils.leftTrimArray(top);bottom=Utils.leftTrimArray(bottom);return{'left':left,'right':right,'top':top,'bottom':bottom};},'indexOfAnyBut':function(array,but){for(var i=0;i<array.length;i++){if(but!==array[i]){return i;}}
return-1;},'isConsecutive':function(array){for(var i=1;i<array.length;i++){if(1!==Math.abs(array[i]-array[i-1])){return false;}}
return true;}};return Utils;});define('table/table-cell',['jquery','table/table-plugin-utils'],function(jQuery,Utils){var TableCell=function(originalTd,tableObj){if(null==originalTd){originalTd='<td>&nbsp;</td>';}
originalTd=jQuery(originalTd).get(0);this.obj=jQuery(originalTd);this.tableObj=tableObj;tableObj.cells.push(this);};TableCell.prototype.tableObj=undefined;TableCell.prototype.obj=undefined;TableCell.prototype.wrapper=undefined;TableCell.prototype.hasFocus=false;TableCell.prototype.activate=function(){this.obj.wrapInner('<div/>');var wrapper=this.obj.children('div').eq(0);wrapper.contentEditable(true);wrapper.addClass('aloha-table-cell-editable');var that=this;wrapper.bind('focus',function(jqEvent){if(jqEvent.currentTarget){jqEvent.currentTarget.indexOf=function(){return-1;};}
that._editableFocus(jqEvent);});wrapper.bind('mousedown',function(jqEvent){if(jqEvent.currentTarget){jqEvent.currentTarget.indexOf=function(){return-1;};}
that._editableMouseDown(jqEvent);that._startCellSelection();});wrapper.bind('blur',function(jqEvent){that._editableBlur(jqEvent);});wrapper.bind('keyup',function(jqEvent){that._editableKeyUp(jqEvent);});wrapper.bind('keydown',function(jqEvent){that._editableKeyDown(jqEvent);});wrapper.bind('mouseover',function(jqEvent){that._selectCellRange();});wrapper.contentEditableSelectionChange(function(event){Aloha.Selection.onChange(wrapper,event);return wrapper;});this.obj.bind('mousedown',function(jqEvent){window.setTimeout(function(){that.wrapper.trigger('focus');},1);that.tableObj.selection.unselectCells();that._startCellSelection();jqEvent.stopPropagation();});if(this.obj.get(0)){this.obj.get(0).onselectstart=function(jqEvent){return false;};}
this.wrapper=this.obj.children();if(this.wrapper.get(0)){this.wrapper.get(0).onselectstart=function(){window.event.cancelBubble=true;};this.wrapper.get(0).ondragstart=function(){return false};}
return this;};TableCell.prototype.deactivate=function(){var wrapper=jQuery(this.obj.children('.aloha-table-cell-editable'));if(wrapper.length){wrapper.parent().append(wrapper.contents());wrapper.remove();this.obj.unbind('click');this.obj.unbind('mousedown');if(jQuery.trim(this.obj.attr('class'))==''){this.obj.removeAttr('class');}}}
TableCell.prototype.toString=function(){return'TableCell';};TableCell.prototype._editableFocus=function(e){if(!this.hasFocus){this.tableObj.focus();this.obj.addClass('aloha-table-cell_active');this.hasFocus=true;this.tableObj.selection.selectionType='cell';}};TableCell.prototype._editableBlur=function(jqEvent){this.hasFocus=false;this.obj.removeClass('aloha-table-cell_active');};TableCell.prototype._virtualX=function(){var $rows=this.tableObj.obj.children().children('tr');var rowIdx=this.obj.parent().index();var colIdx=this.obj.index();return Utils.cellIndexToGridColumn($rows,rowIdx,colIdx);};TableCell.prototype._virtualY=function(){return this.obj.parent('tr').index();};TableCell.prototype._startCellSelection=function(){if(!this.tableObj.selection.cellSelectionMode){this.tableObj.selection.unselectCells();this.tableObj.selection.cellSelectionMode=true;var that=this;jQuery('body').bind('mouseup.cellselection',function(){that._endCellSelection();});this.tableObj.selection.baseCellPosition=[this._virtualY(),this._virtualX()];}};TableCell.prototype._endCellSelection=function(){if(this.tableObj.selection.cellSelectionMode){this.tableObj.selection.cellSelectionMode=false;this.tableObj.selection.baseCellPosition=null;this.tableObj.selection.lastSelectionRange=null;this.tableObj.selection.selectionType='cell';jQuery('body').unbind('mouseup.cellselection');}};TableCell.prototype._getSelectedRect=function(){var right=this._virtualX();var bottom=this._virtualY();var topLeft=this.tableObj.selection.baseCellPosition;var left=topLeft[1];if(left>right){left=right;right=topLeft[1];}
var top=topLeft[0];if(top>bottom){top=bottom;bottom=topLeft[0];}
return{"top":top,"right":right,"bottom":bottom,"left":left};};TableCell.prototype._selectCellRange=function(){if(!this.tableObj.selection.cellSelectionMode){return;}
var rect=this._getSelectedRect();var table=this.tableObj;var $rows=table.obj.children().children('tr');var grid=Utils.makeGrid($rows);table.selection.selectedCells=[];var selectClass=table.get('classCellSelected');Utils.walkGrid(grid,function(cellInfo,j,i){if(Utils.containsDomCell(cellInfo)){if(i>=rect.top&&i<=rect.bottom&&j>=rect.left&&j<=rect.right){jQuery(cellInfo.cell).addClass(selectClass);table.selection.selectedCells.push(cellInfo.cell);}else{jQuery(cellInfo.cell).removeClass(selectClass);}}});table.selection.notifyCellsSelected();};TableCell.prototype._selectAll=function(editableNode){var e=(editableNode.jquery)?editableNode.get(0):editableNode;if(!jQuery.browser.msie){var s=window.getSelection();if(s.setBaseAndExtent){s.setBaseAndExtent(e,0,e,Math.max(0,e.innerText.length-1));}
else{if(window.opera&&e.innerHTML.substring(e.innerHTML.length-4)=='<BR>'){e.innerHTML=e.innerHTML+'&#160;';}
var r=document.createRange();r.selectNodeContents(e);s.removeAllRanges();s.addRange(r);}}
else if(document.getSelection){var s=document.getSelection();var r=document.createRange();r.selectNodeContents(e);s.removeAllRanges();s.addRange(r);}
else if(document.selection){var r=document.body.createTextRange();r.moveToElementText(e);r.select();}};TableCell.prototype._editableMouseDown=function(jqEvent){this.tableObj.selection.unselectCells();if(this.tableObj.hasFocus){jqEvent.stopPropagation();}};TableCell.prototype._editableKeyUp=function(jqEvent){};TableCell.prototype._editableKeyDown=function(jqEvent){var KEYCODE_TAB=9;this._checkForEmptyEvent(jqEvent);if(this.obj[0]===this.tableObj.obj.find('tr:last td:last')[0]){if(KEYCODE_TAB==jqEvent.keyCode&&!jqEvent.altKey&&!jqEvent.shiftKey&&!jqEvent.ctrlKey){this.tableObj.addRow(this.obj.parent().index()+1);this.tableObj.cells[this.tableObj.cells.length-1]._selectAll(this.wrapper.get(0));jqEvent.stopPropagation();return;}}};TableCell.prototype._checkForEmptyEvent=function(jqEvent){var $wrapper=jQuery(this.wrapper),text=$wrapper.text();if($wrapper.children().length>0){return;}
if(text===''){this.wrapper.text('\u00a0');this.wrapper.get(0).blur();this.wrapper.get(0).focus();}};TableCell.getContainer=function(cell){if(jQuery(cell.firstChild).hasClass("aloha-table-cell-editable")){return cell.firstChild;}else{return cell;}};return TableCell;});define('table/table-selection',['aloha','jquery','table/table-plugin-utils','table/table-cell','ui/dialog','i18n!table/nls/i18n'],function(Aloha,$,Utils,TableCell,Dialog,i18n){var TableSelection=function(table){this.table=table;};TableSelection.prototype.selectionType=undefined;TableSelection.prototype.selectedCells=new Array();TableSelection.prototype.selectedColumnIdxs=new Array();TableSelection.prototype.selectedRowIdxs=new Array();TableSelection.prototype.cellSelectionMode=false;TableSelection.prototype.baseCellPosition=null;TableSelection.prototype.lastSelectionRange=null;TableSelection.prototype.selectColumns=function(columnsToSelect){this.unselectCells();var rows=this.table.getRows();rows.shift();var grid=Utils.makeGrid(rows);for(var j=0;j<columnsToSelect.length;j++){if(-1!==$.inArray(columnsToSelect[j],this.selectedColumnIdxs)){continue;}
this.selectedColumnIdxs.push(columnsToSelect[j]);for(var i=0;i<grid.length;i++){var cellInfo=grid[i][columnsToSelect[j]];if(Utils.containsDomCell(cellInfo)){$(cellInfo.cell).addClass(this.table.get('classCellSelected'));this.selectedCells.push(cellInfo.cell);}}}
this.selectionType='column';};TableSelection.prototype.selectRows=function(rowsToSelect){this.unselectCells();var rows=this.table.getRows();rowsToSelect.sort(function(a,b){return a-b;});for(var i=0;i<rowsToSelect.length;i++){if(rows[rowsToSelect[i]]){for(var z=0;z<this.selectedRowIdxs.length;z++){if(rowsToSelect[i]==this.selectedRowIdxs[z]){return;}}
this.selectedRowIdxs.push(rowsToSelect[i]);for(var j=1;j<rows[rowsToSelect[i]].cells.length;j++){this.selectedCells.push(rows[rowsToSelect[i]].cells[j]);$(rows[rowsToSelect[i]].cells[j]).addClass(this.table.get('classCellSelected'));}}}
this.selectionType='row';};TableSelection.prototype.selectAll=function(){var rowIndices=$.map(this.table.getRows(),function(item,i){return i;});rowIndices.shift();this.selectRows(rowIndices);};TableSelection.prototype.notifyCellsSelected=function(){Aloha.trigger('aloha-table-selection-changed');};TableSelection.prototype._notifyCellsUnselected=function(){Aloha.trigger('aloha-table-selection-changed');};TableSelection.prototype.isHeader=function(){if(this.selectedCells.length==0){return false;}
for(var i=0;i<this.selectedCells.length;i++){if(!this.selectedCells[i]||this.selectedCells[i].nodeName.toLowerCase()!='th'){return false;}}
return true;}
TableSelection.prototype.unselectCells=function(){var rows;if(this.cellSelectionMode){return;}
if(this.selectedCells.length>0){rows=this.table.getRows();for(var i=0;i<rows.length;i++){for(var j=1;j<rows[i].cells.length;j++){$(rows[i].cells[j]).removeClass(this.table.get('classCellSelected'));}}
this.selectedCells=new Array();this.selectedColumnIdxs=new Array();this.selectedRowIdxs=new Array();this.selectionType='cell';this._notifyCellsUnselected();}};TableSelection.prototype.selectionIndex=function(cell){for(var i=0;i<this.selectedCells.length;i++){if(this.selectedCells[i]===cell){return i;}}
return-1;};function getRectFromContour(contour){return{'top':contour.top[0],'right':contour.right[0]+1,'bottom':contour.bottom[0]+1,'left':contour.left[0]};}
function isMergeable(grid,contour,isSelected){var mergeable=true;if(-1!==Utils.indexOfAnyBut(contour.top,contour.top[0])||-1!==Utils.indexOfAnyBut(contour.right,contour.right[0])||-1!==Utils.indexOfAnyBut(contour.bottom,contour.bottom[0])||-1!==Utils.indexOfAnyBut(contour.left,contour.left[0])){mergeable=false;}else{var rect=getRectFromContour(contour)
Utils.walkGridInsideRect(grid,rect,function(cellInfo){if(!isSelected(cellInfo)){mergeable=false;return false;}});}
return mergeable;}
TableSelection.prototype.mergeCells=function(){var selectedCells=this.selectedCells;if(0===selectedCells.length){return;}
var isSelected=function(cellInfo){return-1!=$.inArray(cellInfo.cell,selectedCells);};var grid=Utils.makeGrid(this.table.getRows());var contour=Utils.makeContour(grid,isSelected);if(!isMergeable(grid,contour,isSelected)){Dialog.alert({title:i18n.t('Table'),text:i18n.t('table.mergeCells.notRectangular')});return;}
var selectedRect=getRectFromContour(contour);var $firstCell=$(grid[selectedRect.top][selectedRect.left].cell);var $firstContainer=$(TableCell.getContainer($firstCell.get(0)));Utils.walkGridInsideRect(grid,selectedRect,function(cellInfo,x,y){if(x-cellInfo.spannedX===selectedRect.left&&y-cellInfo.spannedY===selectedRect.top){return;}
var cell=cellInfo.cell;var contents=$(TableCell.getContainer(cell)).contents();for(var i=0;i<contents.length;i++){if("string"!==typeof contents[i]||""!==$.trim(contents[i])){$firstContainer.append(" ");$firstContainer.append(contents);break;}}
$(cell).remove();});$firstCell.attr({'rowspan':selectedRect.bottom-selectedRect.top,'colspan':selectedRect.right-selectedRect.left});this.selectedCells=[$firstCell.get(0)];this.cellSelectionMode=false;this.baseCellPosition=null;this.lastSelectionRange=null;this.selectionType='cell';Aloha.trigger('aloha-table-selection-changed');};TableSelection.prototype.splitCells=function(){var selection=this;var cells_to_split=this.selectedCells;if(cells_to_split.length>0){$(cells_to_split).each(function(){Utils.splitCell(this,function(){return selection.table.newActiveCell().obj;});});this.cellSelectionMode=false;this.baseCellPosition=null;this.lastSelectionRange=null;this.selectionType='cell';Aloha.trigger('aloha-table-selection-changed');}};TableSelection.prototype.cellsAreMergeable=function(){var selectedCells=this.selectedCells;if(selectedCells.length<2){return false;}
var isSelected=function(cellInfo){return-1!=$.inArray(cellInfo.cell,selectedCells);};var grid=Utils.makeGrid(this.table.getRows());var contour=Utils.makeContour(grid,isSelected);if(!isMergeable(grid,contour,isSelected)){return false;}else{return true;}};TableSelection.prototype.cellsAreSplitable=function(){var splitable=0;if(this.selectedCells.length>0){$(this.selectedCells).each(function(){var cell=this;var colspan=Utils.colspan(cell);var rowspan=Utils.rowspan(cell);if(colspan>1||rowspan>1){splitable++;}});if(splitable>0){return true;}else{return false;}}else{return false;}};return TableSelection;});define('table/table',['aloha','jquery','ui/scopes','ui/dialog','i18n!table/nls/i18n','table/table-cell','table/table-selection','table/table-plugin-utils'],function(Aloha,jQuery,Scopes,Dialog,i18n,TableCell,TableSelection,Utils){var undefined=void 0;var GENTICS=window.GENTICS;var Table=function(table,tablePlugin){this.obj=jQuery(table);correctTableStructure(this);if(!this.obj.attr('id')){this.obj.attr('id',GENTICS.Utils.guid());}
this.tablePlugin=tablePlugin;this.selection=new TableSelection(this);this.refresh();};jQuery.extend(Table.prototype,{obj:undefined,tableWrapper:undefined,cells:undefined,numRows:undefined,numCols:undefined,isActive:false,hasFocus:false,parentEditable:undefined,mousedown:false,clickedColumnId:-1,clickedRowId:-1,columnsToSelect:[],rowsToSelect:[],fmPluginId:undefined});Table.prototype.refresh=function(){this.numCols=this.countVirtualCols();var rows=this.getRows();this.numRows=rows.length;this.cells=[];for(var i=0;i<rows.length;i++){var row=jQuery(rows[i]);var cols=row.children();for(var j=0;j<cols.length;j++){var col=cols[j];var Cell=this.newCell(col);}}};Table.prototype.countVirtualCols=function(){var $firstRow=this.obj.children().children('tr:first-child').children();return $firstRow.length-$firstRow.filter('.'+this.get('classLeftUpperCorner')).length;};Table.prototype.get=function(property){return this.tablePlugin.get(property);};Table.prototype.set=function(key,value){this.tablePlugin.set(key,value);};function correctTableStructure(tableObj){var table=tableObj.obj,i,row,rows=tableObj.getRows(),rowsNum=rows.length,cols,colsNum,colsCount,maxColsCount=0,cachedColsCounts=[],colsCountDiff,colSpan;for(i=0;i<rowsNum;i++){row=jQuery(rows[i]);cols=row.children('td, th');colsNum=cols.length;colsCount=Utils.cellIndexToGridColumn(rows,i,colsNum-1)+1;colSpan=parseInt(cols.last().attr('colspan'),10);if(colSpan==0){}else if(!isNaN(colSpan)){if(colSpan==1){cols.last().removeAttr('colspan');}
colsCount+=(colSpan-1);}
cachedColsCounts.push(colsCount);if(colsCount>maxColsCount){maxColsCount=colsCount;}}
for(i=0;i<rowsNum;i++){colsCountDiff=maxColsCount-cachedColsCounts[i];if(colsCountDiff>0){jQuery(rows[i]).append((new Array(colsCountDiff+1)).join('<td></td>'));}}};Table.prototype.activate=function(){if(this.isActive){return;}
var that=this,htmlTableWrapper,tableWrapper,eventContainer;this.obj.addClass(this.get('className'));this.obj.contentEditable(false);if(this.obj.attr('id')==''){this.obj.attr('id',GENTICS.Utils.guid());}
this.selection.selectionType=undefined;eventContainer=this.obj.children('tbody');if(eventContainer.length===0){eventContainer=this.obj;}
eventContainer.bind('keydown',function(jqEvent){if(!jqEvent.ctrlKey&&!jqEvent.shiftKey){if(that.selection.selectedCells.length>0&&that.selection.selectedCells[0].length>0){that.selection.selectedCells[0][0].firstChild.focus();}}});eventContainer.bind('mousedown',function(jqEvent){if(!that.hasFocus){that.focus();}
jqEvent.stopPropagation();jqEvent.preventDefault();return false;});tableWrapper=jQuery('<div class="'+this.get('classTableWrapper')+'" data-block-skip-scope="true"></div>');this.obj.wrap(tableWrapper);var parent=this.obj.parent();if(parent.alohaBlock){parent.alohaBlock();}
htmlTableWrapper=this.obj.parents('.'+this.get('classTableWrapper'));htmlTableWrapper.get(0).onresizestart=function(e){return false;};htmlTableWrapper.get(0).oncontrolselect=function(e){return false;};htmlTableWrapper.get(0).ondragstart=function(e){return false;};htmlTableWrapper.get(0).onmovestart=function(e){return false;};this.tableWrapper=this.obj.parents('.'+this.get('classTableWrapper')).get(0);jQuery(this.cells).each(function(){this.activate();});this.attachSelectionColumn();this.attachSelectionRow();this.makeCaptionEditable();this.checkWai();this.isActive=true;Aloha.trigger('aloha-table-activated');};Table.prototype.makeCaptionEditable=function(){var caption=this.obj.find('caption').eq(0);if(caption){this.tablePlugin.makeCaptionEditable(caption);}};Table.prototype.checkWai=function(){var w=this.wai;if(!w){return;}
w.removeClass(this.get('waiGreen'));w.removeClass(this.get('waiRed'));if(jQuery.trim(this.obj[0].summary)!=''){w.addClass(this.get('waiGreen'));}else{w.addClass(this.get('waiRed'));}};Table.prototype.attachSelectionColumn=function(){var emptyCell=jQuery('<td>'),rowIndex,columnToInsert,rowObj,that=this,rows,i;emptyCell.html('\u00a0');that=this;rows=this.obj.context.rows;for(i=0;i<rows.length;i++){rowObj=jQuery(rows[i]);columnToInsert=emptyCell.clone();columnToInsert.addClass(this.get('classSelectionColumn'));columnToInsert.css('width',this.get('selectionArea')+'px');rowObj.prepend(columnToInsert);rowIndex=i+1;this.attachRowSelectionEventsToCell(columnToInsert);}};Table.prototype.attachRowSelectionEventsToCell=function(cell){var that=this;cell.unbind('mousedown');cell.unbind('mouseover');cell.get(0).onselectstart=function(){return false;};cell.bind('mousedown',function(e){return that.rowSelectionMouseDown(e);});cell.bind('mouseover',function(e){if(that.mousedown){return that.rowSelectionMouseOver(e);}});};Table.prototype.rowSelectionMouseDown=function(jqEvent){this.focus();if(this.selection.selectedCells.length==0){this.rowsToSelect=[];}
this.clickedRowId=jqEvent.currentTarget.parentNode.rowIndex;if(jqEvent.metaKey){var arrayIndex=jQuery.inArray(this.clickedRowId,this.rowsToSelect);if(arrayIndex>=0){this.rowsToSelect.splice(arrayIndex,1);}else{this.rowsToSelect.push(this.clickedRowId);}}else if(jqEvent.shiftKey){this.rowsToSelect.sort(function(a,b){return a-b;});var start=this.rowsToSelect[0];var end=this.clickedRowId;if(start>end){start=end;end=this.rowsToSelect[0];}
this.rowsToSelect=[];for(var i=start;i<=end;i++){this.rowsToSelect.push(i);}}else{this.rowsToSelect=[this.clickedRowId];}
this.selectRows();jqEvent.preventDefault();jqEvent.stopPropagation();this.tablePlugin.summary.focus();return false;};Table.prototype.rowSelectionMouseOver=function(jqEvent){var rowIndex=jqEvent.currentTarget.parentNode.rowIndex,indexInArray,start,end,i;if(this.mousedown&&this.clickedRowId>=0){indexInArray=jQuery.inArray(rowIndex,this.rowsToSelect);start=(rowIndex<this.clickedRowId)?rowIndex:this.clickedRowId;end=(rowIndex<this.clickedRowId)?this.clickedRowId:rowIndex;this.rowsToSelect=new Array();for(i=start;i<=end;i++){this.rowsToSelect.push(i);}
this.selectRows();jqEvent.preventDefault();jqEvent.stopPropagation();return false;}};Table.prototype.attachSelectionRow=function(){var that=this;var emptyCell=jQuery('<td>');emptyCell.html('\u00a0');var numColumns=0;for(var i=0;i<this.obj.context.rows.length;i++){var curNumColumns=0;for(var j=0;j<this.obj.context.rows[i].cells.length;j++){var colspan=Utils.colspan(this.obj.context.rows[i].cells[j]);curNumColumns+=colspan;}
if(numColumns<curNumColumns){numColumns=curNumColumns;}}
var selectionRow=jQuery('<tr>');selectionRow.addClass(this.get('classSelectionRow'));selectionRow.css('height',this.get('selectionArea')+'px');for(var i=0;i<numColumns;i++){var columnToInsert=emptyCell.clone();if(i>0){this.attachColumnSelectEventsToCell(columnToInsert);}else{var columnToInsert=jQuery('<td>').clone();columnToInsert.addClass(this.get('classLeftUpperCorner'));var clickHandler=function(e){that.focus();that.selection.selectAll();that.tablePlugin.activeTable.selection.selectionType='cell';that.tablePlugin.updateFloatingMenuScope();that._removeCursorSelection();if(that.tablePlugin.settings.summaryinsidebar){that.tablePlugin.sidebar.open();that.tablePlugin.sidebarPanel.activate(that.obj);that.tablePlugin.sidebar.correctHeight();}
try{that.tablePlugin.summary.focus();e.stopPropagation();e.preventDefault();}catch(e){}
return false;};this.wai=jQuery('<div/>').width(25).height(12).click(clickHandler);columnToInsert.append(this.wai);}
selectionRow.append(columnToInsert);}
jQuery(document).bind('mouseup',function(e){that.columnSelectionMouseUp(e)});this.obj.find('tr:first').before(selectionRow);};Table.prototype.attachColumnSelectEventsToCell=function(cell){var that=this;cell.unbind('mousedown');cell.unbind('mouseover');cell.get(0).onselectstart=function(){return false;};cell.bind('mousedown',function(e){that.columnSelectionMouseDown(e)});cell.bind('mouseover',function(e){that.columnSelectionMouseOver(e)});};Table.prototype.columnSelectionMouseDown=function(jqEvent){this.focus();if(this.selection.selectedCells.length==0){this.columnsToSelect=[];}
this.clickedColumnId=jQuery(jqEvent.currentTarget.parentNode).children().index(jqEvent.currentTarget);if(jqEvent.metaKey){var arrayIndex=jQuery.inArray(this.clickedColumnId,this.columnsToSelect);if(arrayIndex>=0){this.columnsToSelect.splice(arrayIndex,1);}else{this.columnsToSelect.push(this.clickedColumnId);}}else if(jqEvent.shiftKey){this.columnsToSelect.sort(function(a,b){return a-b;});var start=this.columnsToSelect[0];var end=this.clickedColumnId;if(start>end){start=end;end=this.columnsToSelect[0];}
this.columnsToSelect=[];for(var i=start;i<=end;i++){this.columnsToSelect.push(i);}}else{this.columnsToSelect=[this.clickedColumnId];}
this.selectColumns();jqEvent.preventDefault();jqEvent.stopPropagation();return false;};Table.prototype.columnSelectionMouseOver=function(jqEvent){var
colIdx=jqEvent.currentTarget.cellIndex,columnsToSelect=[],start,end;if(this.mouseDownColIdx){start=(colIdx<this.mouseDownColIdx)?colIdx:this.mouseDownColIdx;end=(colIdx<this.mouseDownColIdx)?this.mouseDownColIdx:colIdx;for(var i=start;i<=end;i++){columnsToSelect.push(i);}
this.selectColumns(columnsToSelect);}};Table.prototype.columnSelectionMouseUp=function(jqEvent){this.mouseDownColIdx=false;};Table.prototype.deleteRows=function(){var
rowIDs=[],rowsToDelete={},table=this;if(0===this.selection.selectedCells.length){return;}
for(var i=0;i<this.selection.selectedCells.length;i++){rowsToDelete[this.selection.selectedCells[i].parentNode.rowIndex]=true;}
for(rowId in rowsToDelete){rowIDs.push(rowId);}
var deleteTable=false;if(rowIDs.length==this.numRows){deleteTable=true;}
if(deleteTable){var that=this;Dialog.confirm({title:i18n.t('Table'),text:i18n.t('deletetable.confirm'),yes:function(){that.deleteTable();}});}else{rowIDs.sort(function(a,b){return a-b;});var focusRowId=rowIDs[0];if(focusRowId>(this.numRows-rowIDs.length)){focusRowId--;}
var rows=this.getRows();jQuery.each(rowIDs,function(unused,rowId){var row=rows[rowId];for(var i=0;i<row.cells.length;i++){Utils.splitCell(row.cells[i],function(){return table.newActiveCell().obj;});}});var grid=Utils.makeGrid(rows);jQuery.each(rowIDs,function(unused,rowId){var row=grid[rowId];for(var j=0;j<row.length;){var cellInfo=row[j];var rowspan=Utils.rowspan(cellInfo.cell);if(1<rowspan){jQuery(cellInfo.cell).attr('rowspan',rowspan-1);}
j+=cellInfo.colspan;}
jQuery(rows[rowId]).remove();});this.numRows-=rowIDs.length;window.setTimeout(function(){var lastCell=jQuery(rows[1].cells[focusRowId+1]);lastCell.focus();},5);this.selection.unselectCells();}};Table.prototype.deleteColumns=function(){var
colIDs=[],cellToDelete=[],rows=this.getRows(),that=this,changeColspan=[],cells,cellInfo;var grid=Utils.makeGrid(rows);var selectColWidth=1;if(this.selection.selectedColumnIdxs.length==grid[0].length-selectColWidth){Dialog.confirm({title:i18n.t('Table'),text:i18n.t('deletetable.confirm'),yes:function(){that.deleteTable();}});}else{colIDs.sort(function(a,b){return a-b;});var gridColumns=this.selection.selectedColumnIdxs.sort(function(a,b){return b-a;});for(var i=0;i<gridColumns.length;i++){var gridColumn=gridColumns[i];for(var j=0;j<rows.length;j++){var cellInfo=grid[j][gridColumn];if(!cellInfo){continue;}
if(0===cellInfo.spannedX){if(1<cellInfo.colspan){var nCell=this.newActiveCell().obj;jQuery(cellInfo.cell).after(nCell);nCell.attr('rowspan',cellInfo.rowspan);nCell.attr('colspan',cellInfo.colspan-1);}
jQuery(cellInfo.cell).remove();}else{jQuery(cellInfo.cell).attr('colspan',cellInfo.colspan-1);}
j+=cellInfo.rowspan-1;}
grid=Utils.makeGrid(rows);}
this.numCols-=colIDs.length;window.setTimeout(function(){var lastCell=jQuery(rows[1].cells[1]);lastCell.focus();},5);this.selection.unselectCells();}};Table.prototype.deleteTable=function(){var deleteIndex=-1;for(var i=0;i<this.tablePlugin.TableRegistry.length;i++){if(this.tablePlugin.TableRegistry[i].obj.attr('id')==this.obj.attr('id')){deleteIndex=i;break;}}
if(deleteIndex>=0){this.deactivate();this.selection.selectionType=undefined;this.tablePlugin.TableRegistry.splice(i,1);var newRange=Aloha.Selection.rangeObject;newRange.endContainer=this.obj.get(0).parentNode;newRange.startContainer=newRange.endContainer;newRange.endOffset=GENTICS.Utils.Dom.getIndexInParent(this.obj.get(0));newRange.startOffset=newRange.endOffset;newRange.clearCaches();this.obj.remove();this.parentEditable.obj.focus();newRange.correctRange();newRange.select();}};function rowIndexFromSelection(position,selection){var newRowIndex=-1;var cellOfInterest=null;if('before'===position){cellOfInterest=selection.selectedCells[0];}else if('after'===position){var offset=selection.selectedCells.length-1;cellOfInterest=selection.selectedCells[offset];}
if(cellOfInterest&&cellOfInterest.nodeType==1){newRowIndex=cellOfInterest.parentNode.rowIndex;}
return newRowIndex;}
Table.prototype.addRowBeforeSelection=function(highlightNewRows){var newRowIndex=rowIndexFromSelection('before',this.selection);if(-1!==newRowIndex){this.addRow(newRowIndex);}};Table.prototype.addRowAfterSelection=function(){var newRowIndex=rowIndexFromSelection('after',this.selection);if(-1!==newRowIndex){this.addRow(newRowIndex+1);}};Table.prototype.addRow=function(newRowIndex){var that=this;var rowsToInsert=1;var numCols=this.countVirtualCols();var $rows=this.obj.children().children('tr');for(var j=0;j<rowsToInsert;j++){var insertionRow=jQuery('<tr>');var selectionColumn=jQuery('<td>');selectionColumn.addClass(this.get('classSelectionColumn'));this.attachRowSelectionEventsToCell(selectionColumn);insertionRow.append(selectionColumn);var grid=Utils.makeGrid($rows);var selectColOffset=1;if(newRowIndex>=grid.length){for(var i=selectColOffset;i<grid[0].length;i++){insertionRow.append(this.newActiveCell().obj);}}else{for(var i=selectColOffset;i<grid[newRowIndex].length;){var cellInfo=grid[newRowIndex][i];if(Utils.containsDomCell(cellInfo)){var colspan=cellInfo.colspan;while(colspan--){insertionRow.append(this.newActiveCell().obj);}}else{jQuery(cellInfo.cell).attr('rowspan',cellInfo.rowspan+1);}
i+=cellInfo.colspan;}}
if(newRowIndex>=$rows.length){$rows.eq($rows.length-1).after(insertionRow);}else{$rows.eq(newRowIndex).before(insertionRow);}}
this.numRows+=rowsToInsert;};Table.prototype.addColumnsRight=function(){this.addColumns('right');};Table.prototype.addColumnsLeft=function(){this.addColumns('left');};Table.prototype.addColumns=function(position){var
that=this,emptyCell=jQuery('<td>'),rows=this.getRows(),cell,currentColIdx,columnsToSelect=[],selectedColumnIdxs=this.selection.selectedColumnIdxs;if(0===selectedColumnIdxs.length){return;}
selectedColumnIdxs.sort(function(a,b){return a-b;});if(!Utils.isConsecutive(selectedColumnIdxs)){Dialog.alert({title:i18n.t('Table'),text:i18n.t('table.addColumns.nonConsecutive')});return;}
if('left'===position){currentColIdx=selectedColumnIdxs[0];for(var i=0;i<this.selection.selectedColumnIdxs.length;i++){this.selection.selectedColumnIdxs[i]+=1;}}else{currentColIdx=selectedColumnIdxs[selectedColumnIdxs.length-1];}
var grid=Utils.makeGrid(rows);for(var i=0;i<rows.length;i++){cell=emptyCell.clone();cell.html('\u00a0');if(i==0){this.attachColumnSelectEventsToCell(cell);}else{cellObj=this.newActiveCell(cell.get(0));cell=cellObj.obj;}
var leftCell=Utils.leftDomCell(grid,i,currentColIdx);if(null==leftCell){jQuery(rows[i]).prepend(cell);}else{if('left'===position&&Utils.containsDomCell(grid[i][currentColIdx])){jQuery(leftCell).before(cell);}else{jQuery(leftCell).after(cell);}}
this.numCols++;}};Table.prototype.focus=function(){if(!this.hasFocus){if(!this.parentEditable.isActive){this.parentEditable.obj.focus();}
this.tablePlugin.setFocusedTable(this);}};Table.prototype.focusOut=function(){if(this.hasFocus){this.tablePlugin.setFocusedTable(undefined);this.selection.selectionType=undefined;}};Table.prototype._removeCursorSelection=function(){var selection=Aloha.getSelection();if(!selection||!selection._nativeSelection||selection._nativeSelection._ranges.length==0){return;}
var range=selection.getRangeAt(0);if(null==range.startContainer){return;}
if(0!==jQuery(range.startContainer).closest('table').length){return;}
if(0===this.selection.selectedCells.length){return;}
var container=TableCell.getContainer(this.selection.selectedCells[0]);jQuery(container).focus();}
Table.prototype.selectColumns=function(columns){var columnsToSelect;if(columns){columnsToSelect=columns;}else{columnsToSelect=this.columnsToSelect;}
for(var i=0;i<this.tablePlugin.columnMSItems.length;i++){this.tablePlugin.columnMSButton.showItem(this.tablePlugin.columnMSItems[i].name);}
Scopes.setScope(this.tablePlugin.name+'.column');this.tablePlugin._columnheaderButton.setState(this.selection.isHeader());var rows=this.getRows();this.tablePlugin.columnMSButton.setActiveItem();for(var k=0;k<this.tablePlugin.columnConfig.length;k++){if(jQuery(rows[0].cells[0]).hasClass(this.tablePlugin.columnConfig[k].cssClass)){this.tablePlugin.columnMSButton.setActiveItem(this.tablePlugin.columnConfig[k].name);k=this.tablePlugin.columnConfig.length;}}
this.obj.find('div.aloha-ui-table-cell-editable').blur();this.selection.selectColumns(columnsToSelect);this.selection.notifyCellsSelected();this._removeCursorSelection();};Table.prototype.selectRows=function(){for(var i=0;i<this.tablePlugin.rowMSItems.length;i++){this.tablePlugin.rowMSButton.showItem(this.tablePlugin.rowMSItems[i].name);}
for(var i=0;i<this.rowsToSelect.length;i++){var rowId=this.rowsToSelect[i];var rowCells=jQuery(this.getRows()[rowId].cells).toArray();if(i==0){for(var j=0;j<rowCells.length;j++){this.tablePlugin.rowMSButton.setActiveItem();for(var k=0;k<this.tablePlugin.rowConfig.length;k++){if(jQuery(rowCells[j]).hasClass(this.tablePlugin.rowConfig[k].cssClass)){this.tablePlugin.rowMSButton.setActiveItem(this.tablePlugin.rowConfig[k].name);k=this.tablePlugin.rowConfig.length;}}}}}
Scopes.setScope(this.tablePlugin.name+'.row');this.selection.selectRows(this.rowsToSelect);this.tablePlugin._rowheaderButton.setState(this.selection.isHeader());this.obj.find('div.aloha-ui-table-cell-editable').blur();this.selection.notifyCellsSelected();this._removeCursorSelection();};Table.prototype.deactivate=function(){var parent=this.obj.parent();if(parent.mahaloBlock){parent.mahaloBlock();}
this.obj.removeClass(this.get('className'));if(jQuery.trim(this.obj.attr('class'))==''){this.obj.removeAttr('class');}
this.obj.removeAttr('contenteditable');if(this.obj.parents('.'+this.get('classTableWrapper')).length){this.obj.unwrap();}
this.obj.find('tr.'+this.get('classSelectionRow')+':first').remove();var that=this;jQuery.each(this.obj.context.rows,function(){jQuery(this).children('td.'+that.get('classSelectionColumn')).remove();});this.obj.find('td, th').removeClass(this.get('classCellSelected'));this.obj.find('td, th').removeClass('aloha-table-cell_active');this.obj.unbind();this.obj.children('tbody').unbind();for(var i=0;i<this.cells.length;i++){var Cell=this.cells[i];Cell.deactivate();}
this.obj.find('caption div').each(function(){jQuery(this).contents().unwrap();});this.isActive=false;};Table.prototype.toString=function(){return'Table';};Table.prototype.newCell=function(domElement){return new TableCell(domElement,this);};Table.prototype.newActiveCell=function(domElement){var cell=new TableCell(domElement,this);cell.activate();return cell;};Table.prototype.getRows=function(){var rows=this.obj.get(0).rows;return jQuery.makeArray(rows);};return Table;});define('table/table-plugin',['aloha','jquery','aloha/plugin','aloha/pluginmanager','ui/ui','ui/scopes','ui/button','ui/toggleButton','ui/dialog','ui/port-helper-attribute-field','ui/port-helper-multi-split','i18n!table/nls/i18n','i18n!aloha/nls/i18n','table/table-create-layer','table/table','table/table-plugin-utils'],function(Aloha,jQuery,Plugin,PluginManager,Ui,Scopes,Button,ToggleButton,Dialog,AttributeField,MultiSplitButton,i18n,i18nCore,CreateLayer,Table,Utils){var GENTICS=window.GENTICS;var TablePlugin=new Plugin('table');TablePlugin.createLayer=undefined;TablePlugin.config=['table'];TablePlugin.TableRegistry=new Array();TablePlugin.activeTable=undefined;TablePlugin.parameters={className:'aloha-table',classSelectionRow:'aloha-table-selectcolumn',classSelectionColumn:'aloha-table-selectrow',classLeftUpperCorner:'aloha-table-leftuppercorner',classTableWrapper:'aloha-table-wrapper',classCellSelected:'aloha-cell-selected',waiRed:'aloha-wai-red',waiGreen:'aloha-wai-green',selectionArea:10};TablePlugin.checkConfig=function(c){if(typeof c=='object'&&c.length){var newC=[];for(var i=0;i<c.length;i++){if(c[i]){newC.push({name:c[i].name,text:c[i].text?c[i].text:c[i].name,tooltip:c[i].tooltip?c[i].tooltip:c[i].text,iconClass:c[i].iconClass?c[i].iconClass:'aloha-icon-'+c[i].name,cssClass:c[i].cssClass?c[i].cssClass:c[i].name});}}
c=newC;}else{c=[];}
return c;};TablePlugin.init=function(){var that=this,isEnabled={};this.tableConfig=this.checkConfig(this.tableConfig||this.settings.tableConfig);this.columnConfig=this.checkConfig(this.columnConfig||this.settings.columnConfig);this.rowConfig=this.checkConfig(this.rowConfig||this.settings.rowConfig);this.cellConfig=this.checkConfig(this.cellConfig||this.settings.cellConfig);this.createLayer=new CreateLayer(this);Aloha.bind('aloha-editable-created',function(event,editable){var config=that.getEditableConfig(editable.obj);isEnabled[editable.getId()]=(-1!==jQuery.inArray('table',config));editable.obj.bind('mousedown',function(jqEvent){TablePlugin.setFocusedTable(undefined);});editable.obj.find('table').each(function(){if(that.isEditableTable(this)&&!TablePlugin.isWithinTable(this)){var table=new Table(this,TablePlugin);table.parentEditable=editable;TablePlugin.TableRegistry.push(table);}
TablePlugin.checkForNestedTables(editable.obj);});});this.initTableButtons();Aloha.bind('aloha-table-selection-changed',function(){if(typeof TablePlugin.activeTable!=='undefined'&&TablePlugin.activeTable.selection){TablePlugin.updateFloatingMenuScope();if(TablePlugin.activeTable.selection.cellsAreSplitable()){that._splitcellsButton.enable(true);that._splitcellsRowButton.enable(true);that._splitcellsColumnButton.enable(true);}else{that._splitcellsButton.enable(false);that._splitcellsRowButton.enable(false);that._splitcellsColumnButton.enable(false);}
if(TablePlugin.activeTable.selection.cellsAreMergeable()){that._mergecellsButton.enable(true);that._mergecellsRowButton.enable(true);that._mergecellsColumnButton.enable(true);}else{that._mergecellsButton.enable(false);that._mergecellsRowButton.enable(false);that._mergecellsColumnButton.enable(false);}}});Aloha.bind('aloha-selection-changed',function(event,rangeObject){if(!rangeObject.startContainer||!Aloha.activeEditable){return;}
if(isEnabled[Aloha.activeEditable.getId()]&&Aloha.Selection.mayInsertTag('table')){that._createTableButton.show();}else{that._createTableButton.hide();}
if(!that.activeTable){return;}
var table=rangeObject.findMarkup(function(){return this.nodeName==='TABLE';},Aloha.activeEditable.obj);if(table){TablePlugin.updateFloatingMenuScope();TablePlugin.setActiveCellStyle();}else{that.activeTable.selection.cellSelectionMode=false;that.activeTable.selection.baseCellPosition=null;that.activeTable.selection.lastSelectionRange=null;that.activeTable.focusOut();}});Aloha.bind('aloha-editable-activated',function(event,props){that._splitcellsButton.enable(false);that._mergecellsButton.enable(false);that._splitcellsRowButton.enable(false);that._mergecellsRowButton.enable(false);that._splitcellsColumnButton.enable(false);that._mergecellsColumnButton.enable(false);props.editable.obj.find('table').each(function(){var tr=TablePlugin.TableRegistry;for(var i=0;i<tr.length;i++){if(tr[i].obj.attr('id')==jQuery(this).attr('id')){tr[i].activate();return true;}}
if(that.isEditableTable(this)&&!TablePlugin.isWithinTable(this)){var table=new Table(this,TablePlugin);table.parentEditable=props.editable;table.activate();TablePlugin.TableRegistry.push(table);}
TablePlugin.checkForNestedTables(props.editable.obj);});});Aloha.bind('aloha-editable-deactivated',function(event,properties){if(TablePlugin.activeTable){TablePlugin.activeTable.selection.unselectCells();}
TablePlugin.setFocusedTable(undefined);var tr=TablePlugin.TableRegistry;for(var i=0;i<tr.length;i++){tr[i].deactivate();}});Aloha.bind('aloha-smart-content-changed',function(event){if(Aloha.activeEditable){Aloha.activeEditable.obj.find('table').each(function(){if(TablePlugin.indexOfTableInRegistry(this)==-1&&!TablePlugin.isWithinTable(this)){this.id=GENTICS.Utils.guid();var table=new Table(this,TablePlugin);table.parentEditable=Aloha.activeEditable;TablePlugin.TableRegistry.push(table);table.activate();}
TablePlugin.checkForNestedTables(Aloha.activeEditable.obj);});}});if(this.settings.summaryinsidebar){Aloha.ready(function(){that.initSidebar(Aloha.Sidebar.right.show());});}};var tableNamespace='aloha-table';function nsSel(){var stringBuilder=[],prefix=tableNamespace;jQuery.each(arguments,function(){stringBuilder.push('.'+(this==''?prefix:prefix+'-'+this));});return jQuery.trim(stringBuilder.join(' '));};function nsClass(){var stringBuilder=[],prefix=tableNamespace;jQuery.each(arguments,function(){stringBuilder.push(this==''?prefix:prefix+'-'+this);});return jQuery.trim(stringBuilder.join(' '));};TablePlugin.initSidebar=function(sidebar){var pl=this;pl.sidebar=sidebar;pl.sidebarPanel=sidebar.addPanel({id:nsClass('sidebar-panel'),title:i18n.t('table.sidebar.title'),content:'',expanded:true,activeOn:'table',onInit:function(){var that=this,content=this.setContent('<label class="'+nsClass('label')+'" for="'+nsClass('textarea')+'" >'+i18n.t('table.label.target')+'</label>'+'<textarea id="'+nsClass('textarea')+'" class="'+nsClass('textarea')+'" />').content;jQuery(nsSel('textarea')).live('keyup',function(){jQuery(that.effective).attr('summary',jQuery(nsSel('textarea')).val());var waiDiv=jQuery('div[class*="wai"]','table#'+jQuery(that.effective).attr('id'));waiDiv.removeClass(pl.get('waiGreen'));waiDiv.removeClass(pl.get('waiRed'));if(jQuery(nsSel('textarea')).val().trim()!=''){waiDiv.addClass(pl.get('waiGreen'));}else{waiDiv.addClass(pl.get('waiRed'));}});},onActivate:function(effective){var that=this;that.effective=effective;jQuery(nsSel('textarea')).val(jQuery(that.effective).attr('summary'));}});sidebar.show();};TablePlugin.isEditableTable=function(table){return GENTICS.Utils.Dom.isEditable(table);};TablePlugin.indexOfTableInRegistry=function(table){var registry=this.TableRegistry;for(var i=0;i<registry.length;i++){if(registry[i].obj[0].id==table.id){return i;}}
return-1;};TablePlugin.getTableFromRegistry=function(table){var i=this.indexOfTableInRegistry(table);if(i>-1){return this.TableRegistry[i];}
return null;};TablePlugin.isSelectionInTable=function(){var range=Aloha.Selection.getRangeObject();var container=jQuery(range.commonAncestorContainer);if(container.length==0){return false;}
if(container.parents('.aloha-editable table').length){return true;}
return false;};TablePlugin.preventNestedTables=function(){if(this.isSelectionInTable()){Dialog.alert({title:i18n.t('Table'),text:i18n.t('table.createTable.nestedTablesNoSupported')});return true;}
return false;};TablePlugin.isWithinTable=function(elem){return(jQuery(elem).parents('.aloha-editable table').length>0);};TablePlugin.checkForNestedTables=function(editable){if(editable.find('table table').length){}else{}};TablePlugin.initMergeSplitCellsBtns=function(){this._mergecellsButton=Ui.adopt("mergecells",Button,{tooltip:i18n.t("button.mergecells.tooltip"),icon:"aloha-icon aloha-icon-mergecells",scope:this.name+'.cell',click:function(){if(TablePlugin.activeTable){TablePlugin.activeTable.selection.mergeCells();}}});this._splitcellsButton=Ui.adopt("splitcells",Button,{tooltip:i18n.t("button.splitcells.tooltip"),icon:"aloha-icon aloha-icon-splitcells",scope:this.name+'.cell',click:function(){if(TablePlugin.activeTable){TablePlugin.activeTable.selection.splitCells();}}});this._mergecellsRowButton=Ui.adopt("mergecellsRow",Button,{tooltip:i18n.t("button.mergecells.tooltip"),icon:"aloha-icon aloha-icon-mergecells",scope:this.name+'.row',click:function(){if(TablePlugin.activeTable){TablePlugin.activeTable.selection.mergeCells();}}});this._splitcellsRowButton=Ui.adopt("splitcellsRow",Button,{tooltip:i18n.t("button.splitcells.tooltip"),icon:"aloha-icon aloha-icon-splitcells",scope:this.name+'.row',click:function(){if(TablePlugin.activeTable){TablePlugin.activeTable.selection.splitCells();}}});this._mergecellsColumnButton=Ui.adopt("mergecellsColumn",Button,{tooltip:i18n.t("button.mergecells.tooltip"),icon:"aloha-icon aloha-icon-mergecells",scope:this.name+'.column',click:function(){if(TablePlugin.activeTable){TablePlugin.activeTable.selection.mergeCells();}}});this._splitcellsColumnButton=Ui.adopt("splitcellsColumn",Button,{tooltip:i18n.t("button.splitcells.tooltip"),icon:"aloha-icon aloha-icon-splitcells",scope:this.name+'.column',click:function(){if(TablePlugin.activeTable){TablePlugin.activeTable.selection.splitCells();}}});};TablePlugin.initRowsBtns=function(){var that=this;this._addrowbeforeButton=Ui.adopt("addrowbefore",Button,{tooltip:i18n.t("button.addrowbefore.tooltip"),icon:"aloha-icon aloha-icon-addrowbefore",scope:this.name+'.row',click:function(){if(that.activeTable){that.activeTable.addRowBeforeSelection();}}});this._addrowafterButton=Ui.adopt("addrowafter",Button,{tooltip:i18n.t("button.addrowafter.tooltip"),icon:"aloha-icon aloha-icon-addrowafter",scope:this.name+'.row',click:function(){if(that.activeTable){that.activeTable.addRowAfterSelection();}}});this._deleterowsButton=Ui.adopt("deleterows",Button,{tooltip:i18n.t("button.delrows.tooltip"),icon:"aloha-icon aloha-icon-deleterows",scope:this.name+'.row',click:function(){if(that.activeTable){var aTable=that.activeTable;Dialog.confirm({title:i18n.t('Table'),text:i18n.t('deleterows.confirm'),yes:function(){aTable.deleteRows();}});}}});this._rowheaderButton=Ui.adopt("rowheader",ToggleButton,{tooltip:i18n.t("button.rowheader.tooltip"),icon:"aloha-icon aloha-icon-rowheader",scope:this.name+'.row',click:function(){if(that.activeTable){var selectedRowIdxs=that.activeTable.selection.selectedRowIdxs,cell,isHeader=that.activeTable.selection.isHeader(),allHeaders=true;for(var j=0;j<that.activeTable.selection.selectedCells.length;j++){cell=that.activeTable.selection.selectedCells[j];if(!isHeader){allHeaders=false;break;}}
for(var j=0;j<that.activeTable.selection.selectedCells.length;j++){cell=that.activeTable.selection.selectedCells[j];if(allHeaders){cell=Aloha.Markup.transformDomObject(cell,'td').removeAttr('scope').get(0);}else{cell=Aloha.Markup.transformDomObject(cell,'th').attr('scope','row').get(0);}
jQuery(that.activeTable.selection.selectedCells[j]).bind('mousedown',function(jqEvent){var wrapper=jQuery(this).children('div').eq(0);window.setTimeout(function(){wrapper.trigger('focus');},1);});}
that.activeTable.refresh();that.activeTable.selection.unselectCells();that.activeTable.selection.selectRows(selectedRowIdxs);}}});this.rowMSItems=[];jQuery.each(this.rowConfig,function(j,itemConf){that.rowMSItems.push({name:itemConf.name,text:i18n.t(itemConf.text),tooltip:i18n.t(itemConf.tooltip),iconClass:'aloha-icon aloha-row-layout '+itemConf.iconClass,click:function(){if(that.activeTable){var sc=that.activeTable.selection.selectedCells;for(var i=0;i<sc.length;i++){if(jQuery(sc[i]).attr('class').indexOf(itemConf.cssClass)>-1){jQuery(sc[i]).removeClass(itemConf.cssClass);}else{jQuery(sc[i]).addClass(itemConf.cssClass);for(var f=0;f<that.rowConfig.length;f++){if(that.rowConfig[f].cssClass!=itemConf.cssClass){jQuery(sc[i]).removeClass(that.rowConfig[f].cssClass);}}}}
that.activeTable.selectRows();}}});});if(this.rowMSItems.length>0){this.rowMSItems.push({name:'removeFormat',text:i18n.t('button.removeFormat.text'),tooltip:i18n.t('button.removeFormat.tooltip'),'cls':'aloha-ui-multisplit-fullwidth',wide:true,click:function(){if(that.activeTable){var sc=that.activeTable.selection.selectedCells;for(var i=0;i<sc.length;i++){for(var f=0;f<that.rowConfig.length;f++){jQuery(sc[i]).removeClass(that.rowConfig[f].cssClass);}}
that.activeTable.selectRows();}}});}
this.rowMSButton=MultiSplitButton({items:this.rowMSItems,name:'formatRow',hideIfEmpty:true,scope:this.name+'.row'});};TablePlugin.initColumnBtns=function(){var that=this;this._addcolumnleftButton=Ui.adopt("addcolumnleft",Button,{tooltip:i18n.t("button.addcolleft.tooltip"),icon:"aloha-icon aloha-icon-addcolumnleft",scope:this.name+'.column',click:function(){if(that.activeTable){that.activeTable.addColumnsLeft();}}});this._addcolumnrightButton=Ui.adopt("addcolumnright",Button,{tooltip:i18n.t("button.addcolright.tooltip"),icon:"aloha-icon aloha-icon-addcolumnright",scope:this.name+'.column',click:function(){if(that.activeTable){that.activeTable.addColumnsRight();}}});this._deletecolumnsButton=Ui.adopt("deletecolumns",Button,{tooltip:i18n.t("button.delcols.tooltip"),icon:"aloha-icon aloha-icon-deletecolumns",scope:this.name+'.column',click:function(){if(that.activeTable){var aTable=that.activeTable;Dialog.confirm({title:i18n.t('Table'),text:i18n.t('deletecolumns.confirm'),yes:function(){aTable.deleteColumns();}});}}});this._columnheaderButton=Ui.adopt("columnheader",ToggleButton,{tooltip:i18n.t("button.columnheader.tooltip"),icon:"aloha-icon aloha-icon-columnheader",scope:this.name+'.column',click:function(){if(that.activeTable){var
selectedColumnIdxs=that.activeTable.selection.selectedColumnIdxs,cell,isHeader=that.activeTable.selection.isHeader(),allHeaders=true;for(var j=0;j<that.activeTable.selection.selectedCells.length;j++){cell=that.activeTable.selection.selectedCells[j];if(!isHeader){allHeaders=false;break;}}
for(var j=0;j<that.activeTable.selection.selectedCells.length;j++){cell=that.activeTable.selection.selectedCells[j];if(allHeaders){cell=Aloha.Markup.transformDomObject(cell,'td').removeAttr('scope').get(0);}else{cell=Aloha.Markup.transformDomObject(cell,'th').attr('scope','row').get(0);}
jQuery(that.activeTable.selection.selectedCells[j]).bind('mousedown',function(jqEvent){var wrapper=jQuery(this).children('div').eq(0);window.setTimeout(function(){wrapper.trigger('focus');},1);});}
that.activeTable.refresh();that.activeTable.selection.unselectCells();that.activeTable.selection.selectColumns(selectedColumnIdxs);}}});this.columnMSItems=[];jQuery.each(this.columnConfig,function(j,itemConf){var item={name:itemConf.name,text:i18n.t(itemConf.text),tooltip:i18n.t(itemConf.tooltip),iconClass:'aloha-icon aloha-column-layout '+itemConf.iconClass,click:function(x,y,z){if(that.activeTable){var sc=that.activeTable.selection.selectedCells;for(var i=0;i<sc.length;i++){if(jQuery(sc[i]).attr('class').indexOf(itemConf.cssClass)>-1){jQuery(sc[i]).removeClass(itemConf.cssClass);}else{jQuery(sc[i]).addClass(itemConf.cssClass);for(var f=0;f<that.columnConfig.length;f++){if(that.columnConfig[f].cssClass!=itemConf.cssClass){jQuery(sc[i]).removeClass(that.columnConfig[f].cssClass);}}}}
that.activeTable.selectColumns();}}};that.columnMSItems.push(item);});if(this.columnMSItems.length>0){this.columnMSItems.push({name:'removeFormat',text:i18n.t('button.removeFormat.text'),tooltip:i18n.t('button.removeFormat.tooltip'),'cls':'aloha-ui-multisplit-fullwidth',wide:true,click:function(){if(that.activeTable){var sc=that.activeTable.selection.selectedCells;for(var i=0;i<sc.length;i++){for(var f=0;f<that.columnConfig.length;f++){jQuery(sc[i]).removeClass(that.columnConfig[f].cssClass);}}
that.activeTable.selectColumns();}}});}
this.columnMSButton=MultiSplitButton({items:this.columnMSItems,name:'formatColumn',hideIfEmpty:true,scope:this.name+'.column'});};TablePlugin.initCellBtns=function(){var that=this;this.cellMSItems=[];jQuery.each(this.cellConfig,function(j,itemConf){var item={name:itemConf.name,text:i18n.t(itemConf.text),tooltip:i18n.t(itemConf.tooltip),iconClass:'aloha-icon aloha-column-layout '+itemConf.iconClass,click:function(x,y,z){if(that.activeTable){var sc=that.selectedOrActiveCells();for(var i=0;i<sc.length;i++){if(jQuery(sc[i]).attr('class').indexOf(itemConf.cssClass)>-1){jQuery(sc[i]).removeClass(itemConf.cssClass);}else{jQuery(sc[i]).addClass(itemConf.cssClass);for(var f=0;f<that.cellConfig.length;f++){if(that.cellConfig[f].cssClass!=itemConf.cssClass){jQuery(sc[i]).removeClass(that.cellConfig[f].cssClass);}}}}
that.setActiveCellStyle();}}};that.cellMSItems.push(item);});if(this.cellMSItems.length>0){this.cellMSItems.push({name:'removeFormat',text:i18n.t('button.removeFormat.text'),tooltip:i18n.t('button.removeFormat.tooltip'),'cls':'aloha-ui-multisplit-fullwidth',wide:true,click:function(){if(that.activeTable){var sc=that.selectedOrActiveCells();for(var i=0;i<sc.length;i++){for(var f=0;f<that.cellConfig.length;f++){jQuery(sc[i]).removeClass(that.cellConfig[f].cssClass);}}
that.setActiveCellStyle();}}});}
this.cellMSButton=MultiSplitButton({items:this.cellMSItems,name:'formatCell',hideIfEmpty:true,scope:this.name+'.cell'});};TablePlugin.initTableButtons=function(){var that=this;Scopes.createScope(this.name+'.row','Aloha.continuoustext');Scopes.createScope(this.name+'.column','Aloha.continuoustext');Scopes.createScope(this.name+'.cell','Aloha.continuoustext');this._createTableButton=Ui.adopt("createTable",Button,{tooltip:i18n.t("button.createtable.tooltip"),icon:"aloha-icon aloha-icon-createTable",scope:'Aloha.continuoustext',click:function(){TablePlugin.createDialog(this.element);}});this.initColumnBtns();this.initRowsBtns();this.initCellBtns();this.initMergeSplitCellsBtns();this.tableMSItems=[];var tableConfig=this.tableConfig;jQuery.each(tableConfig,function(j,itemConf){that.tableMSItems.push({name:itemConf.name,text:i18n.t(itemConf.text),tooltip:i18n.t(itemConf.tooltip),iconClass:'aloha-icon aloha-table-layout '+itemConf.iconClass,click:function(){if(that.activeTable){for(var f=0;f<tableConfig.length;f++){that.activeTable.obj.removeClass(tableConfig[f].cssClass);}
that.activeTable.obj.addClass(itemConf.cssClass);}}});});if(this.tableMSItems.length>0){this.tableMSItems.push({name:'removeFormat',text:i18n.t('button.removeFormat.text'),tooltip:i18n.t('button.removeFormat.tooltip'),'cls':'aloha-ui-multisplit-fullwidth',wide:true,click:function(){if(that.activeTable){for(var f=0;f<tableConfig.length;f++){that.activeTable.obj.removeClass(that.tableConfig[f].cssClass);}}}});}
this.tableMSButton=MultiSplitButton({items:this.tableMSItems,name:'formatTable',hideIfEmpty:true,scope:this.name+'.cell'});this._tableCaptionButton=Ui.adopt("tableCaption",ToggleButton,{tooltip:i18n.t("button.caption.tooltip"),icon:"aloha-icon aloha-icon-table-caption",scope:this.name+'.cell',click:function(){if(that.activeTable){if(that.activeTable.obj.children("caption").is('caption')){that.activeTable.obj.children("caption").remove();}else{var captionText=i18n.t('empty.caption');var c=jQuery('<caption></caption>');that.activeTable.obj.prepend(c);that.makeCaptionEditable(c,captionText);var cDiv=c.find('div').eq(0);var captionContent=cDiv.contents().eq(0);if(captionContent.length>0){var newRange=new GENTICS.Utils.RangeObject();newRange.startContainer=newRange.endContainer=captionContent.get(0);newRange.startOffset=0;newRange.endOffset=captionContent.text().length;that.activeTable.obj.find('div.aloha-table-cell-editable').blur();cDiv.focus();newRange.select();Aloha.Selection.updateSelection();}}}}});this.summary=AttributeField({width:275,name:'tableSummary',noTargetHighlight:true,scope:this.name+'.cell'});this.summary.addListener('keyup',function(event){if(that.activeTable){that.activeTable.checkWai();}});};TablePlugin.makeCaptionEditable=function(caption,captionText){var that=this;var cSpan=caption.children('div');if(cSpan.length===0){cSpan=jQuery('<div></div>');jQuery(cSpan).addClass('aloha-ui');jQuery(cSpan).addClass('aloha-editable-caption');if(caption.contents().length>0){cSpan.append(caption.contents());caption.append(cSpan);}else{if(captionText){cSpan.text(captionText);}
caption.append(cSpan);}}else if(cSpan.length>1){caption.children('div:not(:first-child)').each(function(){$this=jQuery(this);cSpan.eq(0).append($this.contents());$this.remove();});cSpan=cSpan.eq(0);}
cSpan.contentEditable(true);};TablePlugin.createDialog=function(callingElement){this.createLayer.set('target',callingElement);this.createLayer.show();};TablePlugin.createTable=function(cols,rows){if(this.preventNestedTables()){return;}
if(Aloha.activeEditable&&typeof Aloha.activeEditable.obj!=='undefined'){var table=document.createElement('table');var tableId=table.id=GENTICS.Utils.guid();var tbody=document.createElement('tbody');for(var i=0;i<rows;i++){var tr=document.createElement('tr');for(var j=0;j<cols;j++){var text=document.createTextNode('\u00a0');var td=document.createElement('td');td.appendChild(text);tr.appendChild(td);}
tbody.appendChild(tr);}
table.appendChild(tbody);prepareRangeContainersForInsertion(Aloha.Selection.getRangeObject(),table);GENTICS.Utils.Dom.insertIntoDOM(jQuery(table),Aloha.Selection.getRangeObject(),Aloha.activeEditable.obj);cleanupAfterInsertion();var tableReloadedFromDOM=document.getElementById(tableId);if(!TablePlugin.isWithinTable(tableReloadedFromDOM)){var tableObj=new Table(tableReloadedFromDOM,TablePlugin);tableObj.parentEditable=Aloha.activeEditable;tableObj.activate();if(jQuery.browser.msie){window.setTimeout(function(){tableObj.cells[0].wrapper.get(0).focus();},20);}else{tableObj.cells[0].wrapper.get(0).focus();}
TablePlugin.TableRegistry.push(tableObj);}
TablePlugin.checkForNestedTables(Aloha.activeEditable.obj);tableObj.focus();TablePlugin.activeTable.selection.selectionType='cell';TablePlugin.updateFloatingMenuScope();}else{this.error('There is no active Editable where the table can be\
    inserted!');}};TablePlugin.setFocusedTable=function(focusTable){var that=this;if(null==focusTable&&null!=this.activeTable){this.activeTable.selection.unselectCells();}
for(var i=0;i<TablePlugin.TableRegistry.length;i++){TablePlugin.TableRegistry[i].hasFocus=false;}
if(typeof focusTable!='undefined'){this.summary.setTargetObject(focusTable.obj,'summary');if(focusTable.obj.children("caption").is('caption')){this._tableCaptionButton.setState(true);var c=focusTable.obj.children("caption");that.makeCaptionEditable(c);}
focusTable.hasFocus=true;}
TablePlugin.activeTable=focusTable;for(var i=0;i<this.tableMSItems.length;i++){this.tableMSButton.showItem(this.tableMSItems[i].name);}
this.tableMSButton.setActiveItem();if(this.activeTable){for(var i=0;i<this.tableConfig.length;i++){if(this.activeTable.obj.hasClass(this.tableConfig[i].cssClass)){this.tableMSButton.setActiveItem(this.tableConfig[i].name);}}}};TablePlugin.error=function(msg){Aloha.Log.error(this,msg);};TablePlugin.debug=function(msg){Aloha.Log.debug(this,msg);};TablePlugin.info=function(msg){Aloha.Log.info(this,msg);};TablePlugin.log=function(msg){Aloha.log('log',this,msg);};TablePlugin.get=function(property){if(this.config[property]){return this.config[property];}
if(this.parameters[property]){return this.parameters[property];}
return undefined;};TablePlugin.set=function(key,value){if(this.config[key]){this.config[key]=value;}else{this.parameters[key]=value;}};TablePlugin.makeClean=function(obj){var that=this;obj.find('table').each(function(){if(that.getTableFromRegistry(this)){(new Table(this,that)).deactivate();jQuery(this).attr('id',null);}});};TablePlugin.toString=function(){return this.prefix;};TablePlugin.updateFloatingMenuScope=function(){if(null!=TablePlugin.activeTable&&null!=TablePlugin.activeTable.selection.selectionType){Scopes.setScope(TablePlugin.name+'.'+TablePlugin.activeTable.selection.selectionType);}};TablePlugin.setActiveCellStyle=function(){var that=this;this.cellMSButton.setActiveItem();var selectedCells=that.selectedOrActiveCells();jQuery(selectedCells).each(function(){for(var k=0;k<that.cellConfig.length;k++){if(jQuery(this).hasClass(that.cellConfig[k].cssClass)){that.cellMSButton.setActiveItem(that.cellConfig[k].name);k=that.cellConfig.length;}}});};TablePlugin.selectedOrActiveCells=function(){var that=this;var sc=this.activeTable.selection.selectedCells;if(!sc||sc.length<1){var activeCell=function(){var range=Aloha.Selection.getRangeObject();if(Aloha.activeEditable){return range.findMarkup(function(){return this.nodeName.toLowerCase()==='td';},Aloha.activeEditable.obj);}else{return null;}}
var active_cell=activeCell();return(active_cell?[active_cell]:[]);}else{return sc;}};PluginManager.register(TablePlugin);function prepareRangeContainersForInsertion(range,table){var eNode=range.endContainer,sNode=range.startContainer,eNodeLength=(eNode.nodeType==3)?eNode.length:eNode.childNodes.length;if(sNode.nodeType==3&&sNode.parentNode.tagName=='P'&&sNode.parentNode.childNodes.length==1&&/^(\s|%A0)$/.test(escape(sNode.data))){sNode.data='';range.startOffset=0;if(eNode==sNode){range.endOffset=0;}}
if(!GENTICS.Utils.Dom.allowsNesting(sNode.nodeType==3?sNode.parentNode:sNode,table)){if(range.startOffset==0){jQuery(sNode.nodeType==3?sNode.parentNode:sNode).addClass('aloha-table-cleanme');}
if(range.endOffset==eNodeLength){jQuery(eNode.nodeType==3?eNode.parentNode:eNode).addClass('aloha-table-cleanme');}}};function cleanupAfterInsertion(){var dirty=jQuery('.aloha-table-cleanme').removeClass('aloha-table-cleanme');for(var i=0;i<dirty.length;i++){if(jQuery.trim(jQuery(dirty[i]).html())==''&&!GENTICS.Utils.Dom.isEditingHost(dirty[i])){jQuery(dirty[i]).remove();}}};return TablePlugin;});define('format/nls/i18n',{"root":{"button.strong.tooltip":"Strong","button.em.tooltip":"Emphasize","button.b.tooltip":"Bold","button.i.tooltip":"Italic","button.u.tooltip":"Underline","button.cite.tooltip":"Cite","button.q.tooltip":"Tooltip","button.code.tooltip":"Code","button.abbr.tooltip":"Abbreviation","button.del.tooltip":"Strikethrough","button.s.tooltip":"Strikethrough","button.sub.tooltip":"Subscript","button.sup.tooltip":"Superscript","button.p.tooltip":"Paragraph","button.h1.tooltip":"Heading 1","button.h2.tooltip":"Heading 2","button.h3.tooltip":"Heading 3","button.h4.tooltip":"Heading 4","button.h5.tooltip":"Heading 5","button.h6.tooltip":"Heading 6","button.pre.tooltip":"Pre formated text","button.title.tooltip":"Title","button.removeFormat.tooltip":"Remove formatting","button.removeFormat.text":"Remove formatting","GENTICS_button_p":"GENTICS_button_p","GENTICS_button_h1":"GENTICS_button_h1","GENTICS_button_h2":"GENTICS_button_h2","GENTICS_button_h3":"GENTICS_button_h3","GENTICS_button_h4":"GENTICS_button_h4","GENTICS_button_h5":"GENTICS_button_h5","GENTICS_button_h6":"GENTICS_button_h6","GENTICS_button_pre":"GENTICS_button_pre","GENTICS_button_title":"GENTICS_button_title","formatBold":"Ctrl+b","formatItalic":"Ctrl+i","formatUnderline":"Ctrl+u","formatParagraph":"Alt+Ctrl+0","formatH1":"Alt+Ctrl+1","formatH2":"Alt+Ctrl+2","formatH3":"Alt+Ctrl+3","formatH4":"Alt+Ctrl+4","formatH5":"Alt+Ctrl+5","formatH6":"Alt+Ctrl+6","formatPre":"Alt+Ctrl+P","formatDel":"Ctrl+\\","formatSub":"Ctrl+,","formatSup":"Ctrl+.","floatingmenu.tab.format":"Format","format.class.legend":"CSS class","format.class.none":"none"},"ca":true,"de":true,"mk":true,"pt-br":true,"ru":true,"uk":true,"zh-hans":true});define('format/format-plugin',['aloha','aloha/plugin','jquery','ui/ui','ui/toggleButton','ui/port-helper-multi-split','PubSub','i18n!format/nls/i18n','i18n!aloha/nls/i18n','aloha/selection'],function(Aloha,Plugin,jQuery,Ui,ToggleButton,MultiSplitButton,PubSub,i18n,i18nCore){var GENTICS=window.GENTICS,pluginNamespace='aloha-format',commandsByElement={'b':'bold','strong':'bold','i':'italic','em':'italic','del':'strikethrough','sub':'subscript','sup':'superscript','u':'underline','s':'strikethrough'},componentNameByElement={'strong':'strong','em':'emphasis','s':'strikethrough2'},textLevelSemantics={'u':true,'em':true,'strong':true,'b':true,'i':true,'cite':true,'q':true,'code':true,'abbr':true,'del':true,'s':true,'sub':true,'sup':true},blockLevelSemantics={'p':true,'h1':true,'h2':true,'h3':true,'h4':true,'h5':true,'h6':true,'pre':true};function onSelectionChanged(formatPlugin,rangeObject){var
statusWasSet=false,effectiveMarkup,foundMultiSplit,i,j,multiSplitItem;jQuery.each(formatPlugin.buttons,function(index,button){statusWasSet=false;for(i=0;i<rangeObject.markupEffectiveAtStart.length;i++){effectiveMarkup=rangeObject.markupEffectiveAtStart[i];if(Aloha.Selection.standardTextLevelSemanticsComparator(effectiveMarkup,button.markup)){button.handle.setState(true);statusWasSet=true;}}
if(!statusWasSet){button.handle.setState(false);}});if(formatPlugin.multiSplitItems.length>0){foundMultiSplit=false;for(i=0;i<rangeObject.markupEffectiveAtStart.length&&!foundMultiSplit;i++){effectiveMarkup=rangeObject.markupEffectiveAtStart[i];for(j=0;j<formatPlugin.multiSplitItems.length&&!foundMultiSplit;j++){multiSplitItem=formatPlugin.multiSplitItems[j];if(!multiSplitItem.markup){continue;}
if(Aloha.Selection.standardTextLevelSemanticsComparator(effectiveMarkup,multiSplitItem.markup)){formatPlugin.multiSplitButton.setActiveItem(multiSplitItem.name);foundMultiSplit=true;}}}
if(!foundMultiSplit){formatPlugin.multiSplitButton.setActiveItem(null);}}}
return Plugin.create('format',{config:['b','i','sub','sup','p','h1','h2','h3','h4','h5','h6','pre','removeFormat'],availableButtons:['u','strong','del','em','b','i','s','sub','sup','p','h1','h2','h3','h4','h5','h6','pre','removeFormat'],hotKey:{formatBold:'ctrl+b',formatItalic:'ctrl+i',formatParagraph:'alt+ctrl+0',formatH1:'alt+ctrl+1',formatH2:'alt+ctrl+2',formatH3:'alt+ctrl+3',formatH4:'alt+ctrl+4',formatH5:'alt+ctrl+5',formatH6:'alt+ctrl+6',formatPre:'ctrl+p',formatDel:'ctrl+d',formatSub:'alt+shift+s',formatSup:'ctrl+shift+s'},init:function(){var me=this;if(typeof this.settings.hotKey!=='undefined'){jQuery.extend(true,this.hotKey,this.settings.hotKey);}
this.initButtons();Aloha.ready(function(){me.initSidebar(Aloha.Sidebar.right);});Aloha.bind('aloha-editable-activated',function(e,params){me.applyButtonConfig(params.editable.obj);params.editable.obj.bind('keydown.aloha.format',me.hotKey.formatBold,function(){me.addMarkup('b');return false;});params.editable.obj.bind('keydown.aloha.format',me.hotKey.formatItalic,function(){me.addMarkup('i');return false;});params.editable.obj.bind('keydown.aloha.format',me.hotKey.formatParagraph,function(){me.changeMarkup('p');return false;});params.editable.obj.bind('keydown.aloha.format',me.hotKey.formatH1,function(){me.changeMarkup('h1');return false;});params.editable.obj.bind('keydown.aloha.format',me.hotKey.formatH2,function(){me.changeMarkup('h2');return false;});params.editable.obj.bind('keydown.aloha.format',me.hotKey.formatH3,function(){me.changeMarkup('h3');return false;});params.editable.obj.bind('keydown.aloha.format',me.hotKey.formatH4,function(){me.changeMarkup('h4');return false;});params.editable.obj.bind('keydown.aloha.format',me.hotKey.formatH5,function(){me.changeMarkup('h5');return false;});params.editable.obj.bind('keydown.aloha.format',me.hotKey.formatH6,function(){me.changeMarkup('h6');return false;});params.editable.obj.bind('keydown.aloha.format',me.hotKey.formatPre,function(){me.changeMarkup('pre');return false;});params.editable.obj.bind('keydown.aloha.format',me.hotKey.formatDel,function(){me.addMarkup('del');return false;});params.editable.obj.bind('keydown.aloha.format',me.hotKey.formatSub,function(){me.addMarkup('sub');return false;});params.editable.obj.bind('keydown.aloha.format',me.hotKey.formatSup,function(){me.addMarkup('sup');return false;});});Aloha.bind('aloha-editable-deactivated',function(e,params){params.editable.obj.unbind('keydown.aloha.format');});},applyButtonConfig:function(obj){var config=this.getEditableConfig(obj),button,i,len;if(typeof config==='object'){var config_old=[];jQuery.each(config,function(j,button){if(!(typeof j==='number'&&typeof button==='string')){config_old.push(j);}});if(config_old.length>0){config=config_old;}}
this.formatOptions=config;for(button in this.buttons){if(this.buttons.hasOwnProperty(button)){if(jQuery.inArray(button,config)!==-1){this.buttons[button].handle.show();}else{this.buttons[button].handle.hide();}}}
len=this.multiSplitItems.length;for(i=0;i<len;i++){if(jQuery.inArray(this.multiSplitItems[i].name,config)!==-1){this.multiSplitButton.showItem(this.multiSplitItems[i].name);}else{this.multiSplitButton.hideItem(this.multiSplitItems[i].name);}}},initButtons:function(){var
scope='Aloha.continuoustext',that=this;this.buttons={};this.multiSplitItems=[];jQuery.each(this.availableButtons,function(j,button){var button_config=false;if(typeof j!=='number'&&typeof button!=='string'){button_config=button;button=j;}
if(textLevelSemantics[button]){var command=commandsByElement[button];var componentName=command;if(componentNameByElement.hasOwnProperty(button)){componentName=componentNameByElement[button];}
var component=Ui.adopt(componentName,ToggleButton,{tooltip:i18n.t('button.'+button+'.tooltip'),icon:'aloha-icon aloha-icon-'+componentName,scope:scope,click:function(){var selectedCells=jQuery('.aloha-cell-selected');if(selectedCells.length>0){var cellMarkupCounter=0;selectedCells.each(function(){var cellContent=jQuery(this).find('div'),cellMarkup=cellContent.find(button);if(cellMarkup.length>0){cellMarkup.contents().unwrap();cellMarkupCounter++;}
cellContent.contents().wrap('<'+button+'></'+button+'>');});if(cellMarkupCounter===selectedCells.length){selectedCells.find(button).contents().unwrap();}
return false;}
that.addMarkup(button);return false;}});that.buttons[button]={handle:component,'markup':jQuery('<'+button+'>',{'class':button_config||''})};}else if(blockLevelSemantics[button]){that.multiSplitItems.push({'name':button,'tooltip':i18n.t('button.'+button+'.tooltip'),'iconClass':'aloha-icon '+i18n.t('aloha-large-icon-'+button),'markup':jQuery('<'+button+'>'),'click':function(){var selectedCells=jQuery('.aloha-cell-selected');if(selectedCells.length>0){var cellMarkupCounter=0;selectedCells.each(function(){var cellContent=jQuery(this).find('div'),cellMarkup=cellContent.find(button);if(cellMarkup.length>0){cellMarkup.contents().unwrap();cellMarkupCounter++;}
cellContent.contents().wrap('<'+button+'></'+button+'>');});if(cellMarkupCounter===selectedCells.length){selectedCells.find(button).contents().unwrap();}
return false;}
that.changeMarkup(button);if(Aloha.activeEditable&&jQuery.browser.mozilla){Aloha.activeEditable.obj.focus();}
if(Aloha.activeEditable){Aloha.trigger('aloha-format-block');}}});}else if('removeFormat'===button){that.multiSplitItems.push({name:button,text:i18n.t('button.'+button+'.text'),tooltip:i18n.t('button.'+button+'.tooltip'),wide:true,'cls':'aloha-ui-multisplit-fullwidth',click:function(){that.removeFormat();}});}else{Aloha.log('warn',this,'Button "'+button+'" is not defined');}});this.multiSplitButton=MultiSplitButton({name:'formatBlock',items:this.multiSplitItems,hideIfEmpty:true,scope:scope});PubSub.sub('aloha.selection.context-change',function(message){onSelectionChanged(that,message.range);});},initSidebar:function(sidebar){var pl=this;pl.sidebar=sidebar;sidebar.addPanel({id:pl.nsClass('sidebar-panel-class'),title:i18n.t('floatingmenu.tab.format'),content:'',expanded:true,activeOn:this.formatOptions||false,onInit:function(){},onActivate:function(effective){var that=this;that.effective=effective;if(!effective[0]){return;}
that.format=effective[0].nodeName.toLowerCase();var dom=jQuery('<div>').attr('class',pl.nsClass('target-container'));var fieldset=jQuery('<fieldset>');fieldset.append(jQuery('<legend>'+that.format+' '+i18n.t('format.class.legend')).append(jQuery('<select>')));dom.append(fieldset);var html='<div class="'+pl.nsClass('target-container')+'"><fieldset><legend>'+i18n.t('format.class.legend')+'</legend><select name="targetGroup" class="'+pl.nsClass('radioTarget')+'">'+'<option value="">'+i18n.t('format.class.none')+'</option>';if(pl.config[that.format]&&pl.config[that.format]['class']){jQuery.each(pl.config[that.format]['class'],function(i,v){html+='<option value="'+i+'" >'+v+'</option>';});}
html+='</select></fieldset></div>';var that=this,content=this.setContent(html).content;jQuery(pl.nsSel('framename')).live('keyup',function(){jQuery(that.effective).attr('target',jQuery(this).val().replace('\"','&quot;').replace("'","&#39;"));});var that=this;that.effective=effective;jQuery(pl.nsSel('linkTitle')).val(jQuery(that.effective).attr('title'));}});sidebar.show();},nsClass:function(){var stringBuilder=[],prefix=pluginNamespace;jQuery.each(arguments,function(){stringBuilder.push(this==''?prefix:prefix+'-'+this);});return jQuery.trim(stringBuilder.join(' '));},nsSel:function(){var stringBuilder=[],prefix=pluginNamespace;jQuery.each(arguments,function(){stringBuilder.push('.'+(this==''?prefix:prefix+'-'+this));});return jQuery.trim(stringBuilder.join(' '));},addMarkup:function(button){var
markup=jQuery('<'+button+'>'),rangeObject=Aloha.Selection.rangeObject,foundMarkup;if(typeof button==="undefined"||button==""){return false;}
foundMarkup=rangeObject.findMarkup(function(){return this.nodeName===markup[0].nodeName;},Aloha.activeEditable.obj);if(foundMarkup){if(rangeObject.isCollapsed()){GENTICS.Utils.Dom.removeFromDOM(foundMarkup,rangeObject,true);}else{GENTICS.Utils.Dom.removeMarkup(rangeObject,markup,Aloha.activeEditable.obj);}}else{if(rangeObject.isCollapsed()){GENTICS.Utils.Dom.extendToWord(rangeObject);}
GENTICS.Utils.Dom.addMarkup(rangeObject,markup);}
rangeObject.select();onSelectionChanged(this,Aloha.Selection.getRangeObject());return false;},changeMarkup:function(button){Aloha.Selection.changeMarkupOnSelection(jQuery('<'+button+'>'));},removeFormat:function(){var formats=['u','strong','em','b','i','q','del','s','code','sub','sup','p','h1','h2','h3','h4','h5','h6','pre','quote','blockquote'],rangeObject=Aloha.Selection.rangeObject,i;if(this.settings.removeFormats){formats=this.settings.removeFormats;}
if(rangeObject.isCollapsed()){return;}
for(i=0;i<formats.length;i++){GENTICS.Utils.Dom.removeMarkup(rangeObject,jQuery('<'+formats[i]+'>'),Aloha.activeEditable.obj);}
rangeObject.select();},toString:function(){return'format';}});});define('list/nls/i18n',{"root":{"button.createulist.tooltip":"Insert Unordered List","button.createolist.tooltip":"Insert Ordered List","button.indentlist.tooltip":"Indent List","button.outdentlist.tooltip":"Outdent List","floatingmenu.tab.list":"Lists"},"ca":true,"de":true,"mk":true,"pt-br":true,"ru":true,"uk":true,"zh-hans":true});define('list/list-plugin',['aloha','jquery','aloha/plugin','ui/ui','ui/scopes','ui/button','ui/toggleButton','i18n!list/nls/i18n','i18n!aloha/nls/i18n','aloha/engine','PubSub'],function(Aloha,jQuery,Plugin,Ui,Scopes,Button,ToggleButton,i18n,i18nCore,Engine,PubSub){var GENTICS=window.GENTICS;function transformExistingListAndSubLists(domToTransform,transformTo){jQuery(domToTransform).find(domToTransform.nodeName).each(function(){if(isListInSelection(this)){Aloha.Markup.transformDomObject(this,transformTo,Aloha.Selection.rangeObject);}});Aloha.Markup.transformDomObject(domToTransform,transformTo,Aloha.Selection.rangeObject);}
function isListInSelection(needle){var selectionTree=Aloha.Selection.getSelectionTree();return checkSelectionTreeEntryForElement(selectionTree,needle);}
function checkSelectionTreeEntryForElement(treeElementArray,needle){var found=false;jQuery.each(treeElementArray,function(index,element){if((element.domobj===needle&&element.selection!=="none")||checkSelectionTreeEntryForElement(element.children,needle)){found=true;}});return found;}
var ListPlugin=Plugin.create('list',{config:['ul','ol'],transformableElements:{'p':true,'h1':true,'h2':true,'h3':true,'h4':true,'h5':true,'h6':true,'ul':true,'ol':true},init:function(){var that=this;this._orderedListButton=Ui.adopt("orderedList",ToggleButton,{tooltip:i18n.t("button.createolist.tooltip"),icon:"aloha-icon aloha-icon-orderedlist",scope:'Aloha.continuoustext',click:function(){that.transformList(true);}});this._unorderedListButton=Ui.adopt("unorderedList",ToggleButton,{tooltip:i18n.t("button.createulist.tooltip"),icon:"aloha-icon aloha-icon-unorderedlist",scope:'Aloha.continuoustext',click:function(){that.transformList(false);}});this._indentListButton=Ui.adopt("indentList",Button,{tooltip:i18n.t('button.indentlist.tooltip'),icon:'aloha-icon aloha-icon-indent',scope:'Aloha.continuoustext',click:function(){that.indentList();}});this._outdentListButton=Ui.adopt("outdentList",Button,{tooltip:i18n.t('button.outdentlist.tooltip'),icon:'aloha-icon aloha-icon-outdent',scope:'Aloha.continuoustext',click:function(){that.outdentList();}});Scopes.createScope('Aloha.List','Aloha.continuoustext');PubSub.sub('aloha.selection.context-change',function(message){var i,effectiveMarkup,rangeObject=message.range;that._outdentListButton.show(false);that._indentListButton.show(false);that._unorderedListButton.setState(false);that._orderedListButton.setState(false);for(i=0;i<rangeObject.markupEffectiveAtStart.length;i++){effectiveMarkup=rangeObject.markupEffectiveAtStart[i];if(Aloha.Selection.standardTagNameComparator(effectiveMarkup,jQuery('<ul></ul>'))){that._unorderedListButton.setState(true);that._outdentListButton.show(true);that._indentListButton.show(true);break;}
if(Aloha.Selection.standardTagNameComparator(effectiveMarkup,jQuery('<ol></ol>'))){that._orderedListButton.setState(true);that._outdentListButton.show(true);that._indentListButton.show(true);break;}}
if(Aloha.activeEditable){that.applyButtonConfig(Aloha.activeEditable.obj);}});Aloha.Markup.addKeyHandler(9,function(event){return that.processTab(event);});},applyButtonConfig:function(obj){var config=this.getEditableConfig(obj);if(Aloha.Selection.rangeObject.unmodifiableMarkupAtStart[0]){if(jQuery.inArray('ul',config)!=-1&&Aloha.Selection.canTag1WrapTag2(Aloha.Selection.rangeObject.unmodifiableMarkupAtStart[0].nodeName,"ul")!=-1){this._unorderedListButton.show(true);}else{this._unorderedListButton.show(false);}
if(jQuery.inArray('ol',config)!=-1&&Aloha.Selection.canTag1WrapTag2(Aloha.Selection.rangeObject.unmodifiableMarkupAtStart[0].nodeName,"ol")!=-1){this._orderedListButton.show(true);}else{this._orderedListButton.show(false);}}},processTab:function(event){if(event.keyCode===9){if(event.shiftKey){return this.outdentList();}else{return this.indentList();}}
return true;},getStartingDomObjectToTransform:function(){var rangeObject=Aloha.Selection.rangeObject,i,effectiveMarkup;for(i=0;i<rangeObject.markupEffectiveAtStart.length;i++){effectiveMarkup=rangeObject.markupEffectiveAtStart[i];if(this.transformableElements[effectiveMarkup.nodeName.toLowerCase()]){return effectiveMarkup;}}
return false;},getNearestSelectedListItem:function(){var rangeObject=Aloha.Selection.rangeObject,i,effectiveMarkup;for(i=0;i<rangeObject.markupEffectiveAtStart.length;i++){effectiveMarkup=rangeObject.markupEffectiveAtStart[i];if(GENTICS.Utils.Dom.isListElement(effectiveMarkup)){return effectiveMarkup;}}
return false;},transformList:function(ordered){var domToTransform=this.getStartingDomObjectToTransform(),lastLi,i,jqNewLi,jqList,selectedSiblings,jqParentList,newPara,jqToTransform,nodeName;this._outdentListButton.show(true);this._indentListButton.show(true);if(!domToTransform){Aloha.Selection.changeMarkupOnSelection(jQuery('<p></p>'));domToTransform=this.getStartingDomObjectToTransform();if(!domToTransform){if(Aloha.Selection.rangeObject.startContainer.contentEditable){jqList=ordered?jQuery('<ol></ol>'):jQuery('<ul></ul>');jqNewLi=jQuery('<li></li>');jqList.append(jqNewLi);var li=jqNewLi.get(0);var editable=Aloha.getActiveEditable().obj;li.appendChild(document.createTextNode(""));editable.append(jqList);editable.focus();var range=Aloha.createRange();var selection=Aloha.getSelection();range.setStart(li.firstChild,0);range.setEnd(li.firstChild,0);selection.removeAllRanges();selection.addRange(range);Aloha.Selection.updateSelection();return;}else{Aloha.Log.error(this,'Could not transform selection into a list');return;}}}
nodeName=domToTransform.nodeName.toLowerCase();if(nodeName=='ul'&&!ordered){jqList=jQuery(domToTransform);jqParentList=jqList.parent();if(jqParentList.length>0&&GENTICS.Utils.Dom.isListElement(jqParentList.get(0))){if(jqParentList.get(0).nodeName.toLowerCase()==='li'){jqParentList.after(jqList.children());jqList.remove();}else{jqList.children().unwrap();}}else{jqToTransform=jQuery(domToTransform);jQuery.each(jqToTransform.children('li'),function(index,li){newPara=Aloha.Markup.transformDomObject(li,'p',Aloha.Selection.rangeObject);newPara.after(newPara.children('ol,ul'));Engine.ensureContainerEditable(newPara.get(0));});jqToTransform.children().unwrap();}}else if(nodeName=='ul'&&ordered){transformExistingListAndSubLists(domToTransform,'ol');this.mergeAdjacentLists(jQuery(domToTransform));}else if(nodeName=='ol'&&!ordered){transformExistingListAndSubLists(domToTransform,'ul');this.mergeAdjacentLists(jQuery(domToTransform));}else if(nodeName=='ol'&&ordered){jqList=jQuery(domToTransform);jqParentList=jqList.parent();if(jqParentList.length>0&&GENTICS.Utils.Dom.isListElement(jqParentList.get(0))){if(jqParentList.get(0).nodeName.toLowerCase()==='li'){jqParentList.after(jqList.children());jqList.remove();}else{jqList.children().unwrap();}}else{jqToTransform=jQuery(domToTransform);jQuery.each(jqToTransform.children('li'),function(index,li){newPara=Aloha.Markup.transformDomObject(li,'p',Aloha.Selection.rangeObject);newPara.after(newPara.children('ol,ul'));Engine.ensureContainerEditable(newPara.get(0));});jqToTransform.children().unwrap();}}else{selectedSiblings=Aloha.Selection.rangeObject.getSelectedSiblings(domToTransform);jqList=ordered?jQuery('<ol></ol>'):jQuery('<ul></ul>');jqNewLi=jQuery('<li></li>');jqList.append(jqNewLi);jQuery(domToTransform).contents().appendTo(jqNewLi);jQuery(domToTransform).replaceWith(jqList);if(Aloha.Selection.rangeObject.startContainer==domToTransform){Aloha.Selection.rangeObject.startContainer=jqNewLi.get(0);}
if(Aloha.Selection.rangeObject.endContainer==domToTransform){Aloha.Selection.rangeObject.endContainer=jqNewLi.get(0);}
var lastAppendedLi=jqNewLi;if(selectedSiblings){lastLi=false;for(i=0;i<selectedSiblings.length;++i){if(GENTICS.Utils.Dom.isBlockLevelElement(selectedSiblings[i])){if(lastLi){lastLi=false;}
jqNewLi=Aloha.Markup.transformDomObject(selectedSiblings[i],'li',Aloha.Selection.rangeObject);jqList.append(jqNewLi);lastAppendedLi=jqNewLi;}else{if(selectedSiblings[i].nodeType==3&&jQuery.trim(selectedSiblings[i].data).length===0){continue;}
if(!lastLi){lastLi=jQuery('<li></li>');jqList.append(lastLi);lastAppendedLi=lastLi;}
lastLi.append(selectedSiblings[i]);}}}
this.mergeAdjacentLists(jqList);var li=lastAppendedLi.get(0);if(GENTICS.Utils.Dom.isEmpty(li)){var range=Aloha.createRange();var selection=Aloha.getSelection();li.appendChild(document.createTextNode(""));range.selectNodeContents(li.lastChild);selection.removeAllRanges();selection.addRange(range);Aloha.Selection.updateSelection();}}
this.refreshSelection();},indentList:function(){var listItem=this.getNearestSelectedListItem(),i,jqNewList,selectedSiblings,jqOldList,jqItemBefore;if(listItem){jqItemBefore=jQuery(listItem).prev('li');if(jqItemBefore.length===0){return false;}
jqOldList=jQuery(listItem).parent();selectedSiblings=Aloha.Selection.rangeObject.getSelectedSiblings(listItem);jqNewList=jQuery(listItem).parent().clone(false).empty();jqNewList.append(listItem);jqItemBefore.append(jqNewList);if(selectedSiblings){for(i=0;i<selectedSiblings.length;++i){jqNewList.append(jQuery(selectedSiblings[i]));}}
this.mergeAdjacentLists(jqNewList,true);this.refreshSelection();return false;}
return true;},outdentList:function(){var
listItem=this.getNearestSelectedListItem(),i,jqNewPostList,jqListItem,jqList,jqParentList,wrappingLi,selectedSiblings,lastSelected;if(listItem){jqListItem=jQuery(listItem);jqList=jqListItem.parent();jqParentList=jqList.parents('ul,ol');wrappingLi=jqList.parent('li');if(jqParentList.length>0&&GENTICS.Utils.Dom.isListElement(jqParentList.get(0))){selectedSiblings=Aloha.Selection.rangeObject.getSelectedSiblings(listItem);if(selectedSiblings&&selectedSiblings.length>0){lastSelected=jQuery(selectedSiblings[selectedSiblings.length-1]);}else{lastSelected=jqListItem;}
if(lastSelected.nextAll('li').length>0){jqNewPostList=jqList.clone(false).empty();jqNewPostList.append(lastSelected.nextAll());lastSelected.append(jqNewPostList);}
if(wrappingLi.length>0){wrappingLi.after(jqListItem);}else{jqList.before(jqListItem);}
if(selectedSiblings&&selectedSiblings.length>0){for(i=selectedSiblings.length-1;i>=0;--i){jqListItem.after(jQuery(selectedSiblings[i]));}}
if(jqList.contents('li').length===0){jqList.remove();}
if(wrappingLi.length>0&&wrappingLi.contents().length===0){wrappingLi.remove();}
this.refreshSelection();}
return false;}
return true;},refreshSelection:function(){Aloha.Selection.rangeObject.update();Aloha.Selection.rangeObject.select();Aloha.Selection.updateSelection();},mergeAdjacentLists:function(jqList,allTypes){var firstList=jqList.get(0),jqNextList;while(firstList.previousSibling&&firstList.previousSibling.nodeType===1&&this.isMergable(firstList.previousSibling,firstList,allTypes)){firstList=firstList.previousSibling;}
jqList=jQuery(firstList);while(firstList.nextSibling&&((firstList.nextSibling.nodeType===1&&this.isMergable(firstList.nextSibling,firstList,allTypes))||(firstList.nextSibling.nodeType===3&&jQuery.trim(firstList.nextSibling.data).length===0))){jqNextList=jQuery(firstList.nextSibling);if(firstList.nextSibling.nodeType==1){jqNextList.contents().appendTo(jqList);}
jqNextList.remove();}},isMergable:function(toCheck,mergeInto,allTypes){if(allTypes){return toCheck.nodeName.toLowerCase()=='ul'||toCheck.nodeName.toLowerCase()=='ol';}else{return toCheck.nodeName==mergeInto.nodeName;}}});Engine.commands['insertorderedlist']={action:function(value,range){ListPlugin.transformList(true);if(range&&Aloha.Selection.rangeObject){range.startContainer=Aloha.Selection.rangeObject.startContainer;range.startOffset=Aloha.Selection.rangeObject.startOffset;range.endContainer=Aloha.Selection.rangeObject.endContainer;range.endOffset=Aloha.Selection.rangeObject.endOffset;}},indeterm:function(){},state:function(){for(i=0;i<rangeObject.markupEffectiveAtStart.length;i++){effectiveMarkup=rangeObject.markupEffectiveAtStart[i];if(Aloha.Selection.standardTagNameComparator(effectiveMarkup,jQuery('<ul></ul>'))){return false;}
if(Aloha.Selection.standardTagNameComparator(effectiveMarkup,jQuery('<ol></ol>'))){return true;}}
return false;}};Engine.commands['insertunorderedlist']={action:function(value,range){ListPlugin.transformList(false);if(range&&Aloha.Selection.rangeObject){range.startContainer=Aloha.Selection.rangeObject.startContainer;range.startOffset=Aloha.Selection.rangeObject.startOffset;range.endContainer=Aloha.Selection.rangeObject.endContainer;range.endOffset=Aloha.Selection.rangeObject.endOffset;}},indeterm:function(){},state:function(){for(i=0;i<rangeObject.markupEffectiveAtStart.length;i++){effectiveMarkup=rangeObject.markupEffectiveAtStart[i];if(Aloha.Selection.standardTagNameComparator(effectiveMarkup,jQuery('<ul></ul>'))){return true;}
if(Aloha.Selection.standardTagNameComparator(effectiveMarkup,jQuery('<ol></ol>'))){return false;}}
return false;}};Engine.commands['indent']={action:function(value,range){ListPlugin.indentList();if(range&&Aloha.Selection.rangeObject){range.startContainer=Aloha.Selection.rangeObject.startContainer;range.startOffset=Aloha.Selection.rangeObject.startOffset;range.endContainer=Aloha.Selection.rangeObject.endContainer;range.endOffset=Aloha.Selection.rangeObject.endOffset;}},indeterm:function(){},state:function(){return false;}};Engine.commands['outdent']={action:function(value,range){ListPlugin.outdentList();if(range&&Aloha.Selection.rangeObject){range.startContainer=Aloha.Selection.rangeObject.startContainer;range.startOffset=Aloha.Selection.rangeObject.startOffset;range.endContainer=Aloha.Selection.rangeObject.endContainer;range.endOffset=Aloha.Selection.rangeObject.endOffset;}},indeterm:function(){},state:function(){return false;}};function deleteWorkaroundHandler(event){if(8!=event.keyCode&&46!=event.keyCode){return false;}
var rangeObj=Aloha.getSelection().getRangeAt(0);var startContainer=rangeObj.startContainer;var $nestedList=jQuery(startContainer).closest('ul, ol');if(!$nestedList.length){return false;}
var $parentList=$nestedList.parent().closest('ul, ol');if(!$parentList.length){return false;}
var ranges=Aloha.getSelection().getAllRanges();var actionPerformed=false;$parentList.each(function(){actionPerformed=actionPerformed||fixListNesting(jQuery(this));});if(actionPerformed){Aloha.getSelection().setRanges(ranges);for(var i=0;i<ranges.length;i++){ranges[i].detach();}}
return actionPerformed;}
function fixListNesting($list){var actionPerformed=false;$list.children('ul, ol').each(function(){Aloha.Log.debug("performing list-nesting cleanup");if(!jQuery(this).prev('li').append(this).length){jQuery(this).parent().prepend(document.createElement('li')).append(this);}
actionPerformed=true;});return actionPerformed;}
return ListPlugin;});define('image/nls/i18n',{"root":{"size.natural":"Original size","button.addimg.tooltip":"add image ref","floatingmenu.tab.img":"Image","floatingmenu.tab.formatting":"Formatting","floatingmenu.tab.resize":"Resize","floatingmenu.tab.crop":"Crop","button.uploadimg.tooltip":"Upload img","button.uploadimg.label":"Upload","button.img.align.left.tooltip":"Left align","button.img.align.right.tooltip":"Right Align","button.img.align.none.tooltip":"No alignment","field.img.title.label":"Title","field.img.title.tooltip":"Title","field.img.label":"URL","field.img.tooltip":"Source","border ":"Add Border to Image","padding.increase ":"Increase Padding","padding.decrease ":"Decrease Padding","size.increase ":"Increase Size","size.decrease ":"Decrease Size","Resize":"Resize","Crop":"Crop","Reset":"Reset","Accept":"Accept","Cancel":"Cancel","height":"Height","width":"Width","button.toggle.tooltip":"Toggle keep aspect ratio","field.img.src.label":"Source","field.img.src.tooltip":"Source"},"ca":true,"de":true,"mk":true,"pt-br":true,"ru":true,"uk":true,"zh-hans":true});define('image/image-floatingMenu',['jquery','util/class','i18n!image/nls/i18n','i18n!aloha/nls/i18n','ui/ui','ui/scopes','ui/button','ui/toggleButton','ui/port-helper-attribute-field'],function(jQuery,Class,i18n,i18nCore,Ui,Scopes,Button,ToggleButton,AttributeField){var $=jQuery;var GENTICS=window.GENTICS;var Aloha=window.Aloha;return Class.extend({_constructor:function(){},init:function(plugin){plugin.floatingMenuControl=this;this.plugin=plugin;Scopes.createScope(plugin.name,'Aloha.empty');this._addUIInsertButton();this._addUIMetaButtons();this._addUIResetButton();this._addUIAlignButtons();this._addUIMarginButtons();this._addUICropButtons();this._addUIResizeButtons();this._addUIAspectRatioToggleButton();},_addUIAspectRatioToggleButton:function(){var plugin=this.plugin;this._imageCnrRatioButton=Ui.adopt("imageCnrRatio",ToggleButton,{tooltip:i18n.t('button.toggle.tooltip'),icon:'aloha-icon-cnr-ratio',scope:plugin.name,click:function(){plugin.toggleKeepAspectRatio();}});if(plugin.settings.fixedAspectRatio!==false){this._imageCnrRatioButton.setState(true);plugin.keepAspectRatio=true;}},_addUIResetButton:function(){var plugin=this.plugin;this._imageCnrResetButton=Ui.adopt("imageCnrReset",Button,{tooltip:i18n.t('Reset'),icon:'aloha-icon-cnr-reset',scope:plugin.name,click:function(){plugin.reset();}});},_addUIInsertButton:function(){var plugin=this.plugin;this._insertImageButton=Ui.adopt("insertImage",Button,{tooltip:i18n.t('button.addimg.tooltip'),icon:'aloha-button aloha-image-insert',scope:'Aloha.continuoustext',click:function(){plugin.insertImg();}});},_addUIMetaButtons:function(){var plugin=this.plugin;this.imgSrcField=AttributeField({label:i18n.t('field.img.src.label'),labelClass:'aloha-image-input-label',tooltip:i18n.t('field.img.src.tooltip'),name:'imageSource',scope:plugin.name});this.imgSrcField.setTemplate('<span><b>{name}</b><br/>{url}</span>');this.imgSrcField.setObjectTypeFilter(plugin.objectTypeFilter);this.imgTitleField=AttributeField({label:i18n.t('field.img.title.label'),labelClass:'aloha-image-input-label',tooltip:i18n.t('field.img.title.tooltip'),name:'imageTitle',scope:plugin.name});this.imgTitleField.setObjectTypeFilter();},_addUIAlignButtons:function(){var plugin=this.plugin;this._imageAlignLeftButton=Ui.adopt("imageAlignLeft",Button,{tooltip:i18n.t('button.img.align.left.tooltip'),icon:'aloha-img aloha-image-align-left',scope:plugin.name,click:function(){var el=jQuery(plugin.getPluginFocus());el.add(el.parent()).css('float','left');}});this._imageAlignRightButton=Ui.adopt("imageAlignRight",Button,{tooltip:i18n.t('button.img.align.right.tooltip'),icon:'aloha-img aloha-image-align-right',scope:plugin.name,click:function(){var el=jQuery(plugin.getPluginFocus());el.add(el.parent()).css('float','right');}});this._imageAlignNoneButton=Ui.adopt("imageAlignNone",Button,{tooltip:i18n.t('button.img.align.none.tooltip'),icon:'aloha-img aloha-image-align-none',scope:plugin.name,click:function(){var el=jQuery(plugin.getPluginFocus());el.add(el.parent()).css({'float':'none',display:'inline-block'});}});},_addUIMarginButtons:function(){var plugin=this.plugin;this._imageIncPaddingButton=Ui.adopt("imageIncPadding",Button,{tooltip:i18n.t('padding.increase'),icon:'aloha-img aloha-image-padding-increase',scope:plugin.name,click:function(){jQuery(plugin.getPluginFocus()).increase('padding');}});this._imageDecPaddingButton=Ui.adopt("imageDecPadding",Button,{tooltip:i18n.t('padding.decrease'),icon:'aloha-img aloha-image-padding-decrease',scope:plugin.name,click:function(){jQuery(plugin.getPluginFocus()).decrease('padding');}});},_addUICropButtons:function(){var plugin=this.plugin;Scopes.createScope('Aloha.img',['Aloha.global']);this._imageCropButton=Ui.adopt("imageCropButton",ToggleButton,{tooltip:i18n.t('Crop'),icon:'aloha-icon-cnr-crop',scope:plugin.name,click:function(){if(this.getState()){plugin.crop();}else{plugin.endCrop();}}});},_addUIResizeButtons:function(){var plugin=this.plugin;this.imgResizeHeightField=AttributeField({label:i18n.t('height'),labelClass:'aloha-image-input-label',name:"imageResizeHeight",width:50,scope:plugin.name});this.imgResizeHeightField.maxValue=plugin.settings.maxHeight;this.imgResizeHeightField.minValue=plugin.settings.minHeight;this.imgResizeWidthField=AttributeField({label:i18n.t('width'),labelClass:'aloha-image-input-label',name:"imageResizeWidth",width:50,scope:plugin.name});this.imgResizeWidthField.maxValue=plugin.settings.maxWidth;this.imgResizeWidthField.minValue=plugin.settings.minWidth;},setScope:function(){Scopes.setScope(this.plugin.name);},doLayout:function(){}});});define('image/vendor/jcrop/jquery.jcrop.min',["jquery"],function(jQuery){(function($){$.Jcrop=function(obj,opt)
{var obj=obj,opt=opt;if(typeof(obj)!=='object')obj=$(obj)[0];if(typeof(opt)!=='object')opt={};if(!('trackDocument'in opt))
{opt.trackDocument=$.browser.msie?false:true;if($.browser.msie&&$.browser.version.split('.')[0]=='8')
opt.trackDocument=true;}
if(!('keySupport'in opt))
opt.keySupport=$.browser.msie?false:true;var defaults={trackDocument:false,baseClass:'jcrop',addClass:null,bgColor:'black',bgOpacity:.6,borderOpacity:.4,handleOpacity:.5,handlePad:5,handleSize:9,handleOffset:5,edgeMargin:14,aspectRatio:0,keySupport:true,cornerHandles:true,sideHandles:true,drawBorders:true,dragEdges:true,boxWidth:0,boxHeight:0,boundary:8,animationDelay:20,swingSpeed:3,allowSelect:true,allowMove:true,allowResize:true,minSelect:[0,0],maxSize:[0,0],minSize:[0,0],onChange:function(){},onSelect:function(){}};var options=defaults;setOptions(opt);var $origimg=$(obj);var $img=$origimg.clone().removeAttr('id').css({position:'absolute'});$img.width($origimg.width());$img.height($origimg.height());$origimg.after($img).hide();presize($img,options.boxWidth,options.boxHeight);var boundx=$img.width(),boundy=$img.height(),$div=$('<div />').width(boundx).height(boundy).addClass(cssClass('holder')).css({position:'relative',backgroundColor:options.bgColor}).insertAfter($origimg).append($img);;if(options.addClass)$div.addClass(options.addClass);var $img2=$('<img />').attr('src',$img.attr('src')).css('position','absolute').width(boundx).height(boundy);var $img_holder=$('<div />').width(pct(100)).height(pct(100)).css({zIndex:310,position:'absolute',overflow:'hidden'}).append($img2);var $hdl_holder=$('<div />').width(pct(100)).height(pct(100)).css('zIndex',320);var $sel=$('<div />').css({position:'absolute',zIndex:300}).insertBefore($img).append($img_holder,$hdl_holder);var bound=options.boundary;var $trk=newTracker().width(boundx+(bound*2)).height(boundy+(bound*2)).css({position:'absolute',top:px(-bound),left:px(-bound),zIndex:290}).mousedown(newSelection);var xlimit,ylimit,xmin,ymin;var xscale,yscale,enabled=true;var docOffset=getPos($img),btndown,lastcurs,dimmed,animating,shift_down;var Coords=function()
{var x1=0,y1=0,x2=0,y2=0,ox,oy;function setPressed(pos)
{var pos=rebound(pos);x2=x1=pos[0];y2=y1=pos[1];};function setCurrent(pos)
{var pos=rebound(pos);ox=pos[0]-x2;oy=pos[1]-y2;x2=pos[0];y2=pos[1];};function getOffset()
{return[ox,oy];};function moveOffset(offset)
{var ox=offset[0],oy=offset[1];if(0>x1+ox)ox-=ox+x1;if(0>y1+oy)oy-=oy+y1;if(boundy<y2+oy)oy+=boundy-(y2+oy);if(boundx<x2+ox)ox+=boundx-(x2+ox);x1+=ox;x2+=ox;y1+=oy;y2+=oy;};function getCorner(ord)
{var c=getFixed();switch(ord)
{case'ne':return[c.x2,c.y];case'nw':return[c.x,c.y];case'se':return[c.x2,c.y2];case'sw':return[c.x,c.y2];}};function getFixed()
{if(!options.aspectRatio)return getRect();var aspect=options.aspectRatio,min_x=options.minSize[0]/xscale,min_y=options.minSize[1]/yscale,max_x=options.maxSize[0]/xscale,max_y=options.maxSize[1]/yscale,rw=x2-x1,rh=y2-y1,rwa=Math.abs(rw),rha=Math.abs(rh),real_ratio=rwa/rha,xx,yy;if(max_x==0){max_x=boundx*10}
if(max_y==0){max_y=boundy*10}
if(real_ratio<aspect)
{yy=y2;w=rha*aspect;xx=rw<0?x1-w:w+x1;if(xx<0)
{xx=0;h=Math.abs((xx-x1)/aspect);yy=rh<0?y1-h:h+y1;}
else if(xx>boundx)
{xx=boundx;h=Math.abs((xx-x1)/aspect);yy=rh<0?y1-h:h+y1;}}
else
{xx=x2;h=rwa/aspect;yy=rh<0?y1-h:y1+h;if(yy<0)
{yy=0;w=Math.abs((yy-y1)*aspect);xx=rw<0?x1-w:w+x1;}
else if(yy>boundy)
{yy=boundy;w=Math.abs(yy-y1)*aspect;xx=rw<0?x1-w:w+x1;}}
if(xx>x1){if(xx-x1<min_x){xx=x1+min_x;}else if(xx-x1>max_x){xx=x1+max_x;}
if(yy>y1){yy=y1+(xx-x1)/aspect;}else{yy=y1-(xx-x1)/aspect;}}else if(xx<x1){if(x1-xx<min_x){xx=x1-min_x}else if(x1-xx>max_x){xx=x1-max_x;}
if(yy>y1){yy=y1+(x1-xx)/aspect;}else{yy=y1-(x1-xx)/aspect;}}
if(xx<0){x1-=xx;xx=0;}else if(xx>boundx){x1-=xx-boundx;xx=boundx;}
if(yy<0){y1-=yy;yy=0;}else if(yy>boundy){y1-=yy-boundy;yy=boundy;}
return last=makeObj(flipCoords(x1,y1,xx,yy));};function rebound(p)
{if(p[0]<0)p[0]=0;if(p[1]<0)p[1]=0;if(p[0]>boundx)p[0]=boundx;if(p[1]>boundy)p[1]=boundy;return[p[0],p[1]];};function flipCoords(x1,y1,x2,y2)
{var xa=x1,xb=x2,ya=y1,yb=y2;if(x2<x1)
{xa=x2;xb=x1;}
if(y2<y1)
{ya=y2;yb=y1;}
return[Math.round(xa),Math.round(ya),Math.round(xb),Math.round(yb)];};function getRect()
{var xsize=x2-x1;var ysize=y2-y1;if(xlimit&&(Math.abs(xsize)>xlimit))
x2=(xsize>0)?(x1+xlimit):(x1-xlimit);if(ylimit&&(Math.abs(ysize)>ylimit))
y2=(ysize>0)?(y1+ylimit):(y1-ylimit);if(ymin&&(Math.abs(ysize)<ymin))
y2=(ysize>0)?(y1+ymin):(y1-ymin);if(xmin&&(Math.abs(xsize)<xmin))
x2=(xsize>0)?(x1+xmin):(x1-xmin);if(x1<0){x2-=x1;x1-=x1;}
if(y1<0){y2-=y1;y1-=y1;}
if(x2<0){x1-=x2;x2-=x2;}
if(y2<0){y1-=y2;y2-=y2;}
if(x2>boundx){var delta=x2-boundx;x1-=delta;x2-=delta;}
if(y2>boundy){var delta=y2-boundy;y1-=delta;y2-=delta;}
if(x1>boundx){var delta=x1-boundy;y2-=delta;y1-=delta;}
if(y1>boundy){var delta=y1-boundy;y2-=delta;y1-=delta;}
return makeObj(flipCoords(x1,y1,x2,y2));};function makeObj(a)
{return{x:a[0],y:a[1],x2:a[2],y2:a[3],w:a[2]-a[0],h:a[3]-a[1]};};return{flipCoords:flipCoords,setPressed:setPressed,setCurrent:setCurrent,getOffset:getOffset,moveOffset:moveOffset,getCorner:getCorner,getFixed:getFixed};}();var Selection=function()
{var start,end,dragmode,awake,hdep=370;var borders={};var handle={};var seehandles=false;var hhs=options.handleOffset;if(options.drawBorders){borders={top:insertBorder('hline').css('top',$.browser.msie?px(-1):px(0)),bottom:insertBorder('hline'),left:insertBorder('vline'),right:insertBorder('vline')};}
if(options.dragEdges){handle.t=insertDragbar('n');handle.b=insertDragbar('s');handle.r=insertDragbar('e');handle.l=insertDragbar('w');}
options.sideHandles&&createHandles(['n','s','e','w']);options.cornerHandles&&createHandles(['sw','nw','ne','se']);function insertBorder(type)
{var jq=$('<div />').css({position:'absolute',opacity:options.borderOpacity}).addClass(cssClass(type));$img_holder.append(jq);return jq;};function dragDiv(ord,zi)
{var jq=$('<div />').mousedown(createDragger(ord)).css({cursor:ord+'-resize',position:'absolute',zIndex:zi});$hdl_holder.append(jq);return jq;};function insertHandle(ord)
{return dragDiv(ord,hdep++).css({top:px(-hhs+1),left:px(-hhs+1),opacity:options.handleOpacity}).addClass(cssClass('handle'));};function insertDragbar(ord)
{var s=options.handleSize,o=hhs,h=s,w=s,t=o,l=o;switch(ord)
{case'n':case's':w=pct(100);break;case'e':case'w':h=pct(100);break;}
return dragDiv(ord,hdep++).width(w).height(h).css({top:px(-t+1),left:px(-l+1)});};function createHandles(li)
{for(i in li)handle[li[i]]=insertHandle(li[i]);};function moveHandles(c)
{var midvert=Math.round((c.h/2)-hhs),midhoriz=Math.round((c.w/2)-hhs),north=west=-hhs+1,east=c.w-hhs,south=c.h-hhs,x,y;'e'in handle&&handle.e.css({top:px(midvert),left:px(east)})&&handle.w.css({top:px(midvert)})&&handle.s.css({top:px(south),left:px(midhoriz)})&&handle.n.css({left:px(midhoriz)});'ne'in handle&&handle.ne.css({left:px(east)})&&handle.se.css({top:px(south),left:px(east)})&&handle.sw.css({top:px(south)});'b'in handle&&handle.b.css({top:px(south)})&&handle.r.css({left:px(east)});};function moveto(x,y)
{$img2.css({top:px(-y),left:px(-x)});$sel.css({top:px(y),left:px(x)});};function resize(w,h)
{$sel.width(w).height(h);};function refresh()
{var c=Coords.getFixed();Coords.setPressed([c.x,c.y]);Coords.setCurrent([c.x2,c.y2]);updateVisible();};function updateVisible()
{if(awake)return update();};function update()
{var c=Coords.getFixed();resize(c.w,c.h);moveto(c.x,c.y);options.drawBorders&&borders['right'].css({left:px(c.w-1)})&&borders['bottom'].css({top:px(c.h-1)});seehandles&&moveHandles(c);awake||show();options.onChange(unscale(c));};function show()
{$sel.show();$img.css('opacity',options.bgOpacity);awake=true;};function release()
{disableHandles();$sel.hide();$img.css('opacity',1);awake=false;};function showHandles()
{if(seehandles)
{moveHandles(Coords.getFixed());$hdl_holder.show();}};function enableHandles()
{seehandles=true;if(options.allowResize)
{moveHandles(Coords.getFixed());$hdl_holder.show();return true;}};function disableHandles()
{seehandles=false;$hdl_holder.hide();};function animMode(v)
{(animating=v)?disableHandles():enableHandles();};function done()
{animMode(false);refresh();};var $track=newTracker().mousedown(createDragger('move')).css({cursor:'move',position:'absolute',zIndex:360})
$img_holder.append($track);disableHandles();return{updateVisible:updateVisible,update:update,release:release,refresh:refresh,setCursor:function(cursor){$track.css('cursor',cursor);},enableHandles:enableHandles,enableOnly:function(){seehandles=true;},showHandles:showHandles,disableHandles:disableHandles,animMode:animMode,done:done};}();var Tracker=function()
{var onMove=function(){},onDone=function(){},trackDoc=options.trackDocument;if(!trackDoc)
{$trk.mousemove(trackMove).mouseup(trackUp).mouseout(trackUp);}
function toFront()
{$trk.css({zIndex:450});if(trackDoc)
{$(document).mousemove(trackMove).mouseup(trackUp);}}
function toBack()
{$trk.css({zIndex:290});if(trackDoc)
{$(document).unbind('mousemove',trackMove).unbind('mouseup',trackUp);}}
function trackMove(e)
{onMove(mouseAbs(e));};function trackUp(e)
{e.preventDefault();e.stopPropagation();if(btndown)
{btndown=false;onDone(mouseAbs(e));options.onSelect(unscale(Coords.getFixed()));toBack();onMove=function(){};onDone=function(){};}
return false;};function activateHandlers(move,done)
{btndown=true;onMove=move;onDone=done;toFront();return false;};function setCursor(t){$trk.css('cursor',t);};$img.before($trk);return{activateHandlers:activateHandlers,setCursor:setCursor};}();var KeyManager=function()
{var $keymgr=$('<input type="radio" />').css({position:'absolute',left:'-30px'}).keypress(parseKey).blur(onBlur),$keywrap=$('<div />').css({position:'absolute',overflow:'hidden'}).append($keymgr);function watchKeys()
{if(options.keySupport)
{$keymgr.show();$keymgr.focus();}};function onBlur(e)
{$keymgr.hide();};function doNudge(e,x,y)
{if(options.allowMove){Coords.moveOffset([x,y]);Selection.updateVisible();};e.preventDefault();e.stopPropagation();};function parseKey(e)
{if(e.ctrlKey)return true;shift_down=e.shiftKey?true:false;var nudge=shift_down?10:1;switch(e.keyCode)
{case 37:doNudge(e,-nudge,0);break;case 39:doNudge(e,nudge,0);break;case 38:doNudge(e,0,-nudge);break;case 40:doNudge(e,0,nudge);break;case 27:Selection.release();break;case 9:return true;}
return nothing(e);};if(options.keySupport)$keywrap.insertBefore($img);return{watchKeys:watchKeys};}();function px(n){return''+parseInt(n)+'px';};function pct(n){return''+parseInt(n)+'%';};function cssClass(cl){return options.baseClass+'-'+cl;};function getPos(obj)
{var pos=$(obj).offset();return[pos.left,pos.top];};function mouseAbs(e)
{return[(e.pageX-docOffset[0]),(e.pageY-docOffset[1])];};function myCursor(type)
{if(type!=lastcurs)
{Tracker.setCursor(type);lastcurs=type;}};function startDragMode(mode,pos)
{docOffset=getPos($img);Tracker.setCursor(mode=='move'?mode:mode+'-resize');if(mode=='move')
return Tracker.activateHandlers(createMover(pos),doneSelect);var fc=Coords.getFixed();var opp=oppLockCorner(mode);var opc=Coords.getCorner(oppLockCorner(opp));Coords.setPressed(Coords.getCorner(opp));Coords.setCurrent(opc);Tracker.activateHandlers(dragmodeHandler(mode,fc),doneSelect);};function dragmodeHandler(mode,f)
{return function(pos){if(!options.aspectRatio)switch(mode)
{case'e':pos[1]=f.y2;break;case'w':pos[1]=f.y2;break;case'n':pos[0]=f.x2;break;case's':pos[0]=f.x2;break;}
else switch(mode)
{case'e':pos[1]=f.y+1;break;case'w':pos[1]=f.y+1;break;case'n':pos[0]=f.x+1;break;case's':pos[0]=f.x+1;break;}
Coords.setCurrent(pos);Selection.update();};};function createMover(pos)
{var lloc=pos;KeyManager.watchKeys();return function(pos)
{Coords.moveOffset([pos[0]-lloc[0],pos[1]-lloc[1]]);lloc=pos;Selection.update();};};function oppLockCorner(ord)
{switch(ord)
{case'n':return'sw';case's':return'nw';case'e':return'nw';case'w':return'ne';case'ne':return'sw';case'nw':return'se';case'se':return'nw';case'sw':return'ne';};};function createDragger(ord)
{return function(e){if(options.disabled)return false;if((ord=='move')&&!options.allowMove)return false;btndown=true;startDragMode(ord,mouseAbs(e));e.stopPropagation();e.preventDefault();return false;};};function presize($obj,w,h)
{var nw=$obj.width(),nh=$obj.height();if((nw>w)&&w>0)
{nw=w;nh=(w/$obj.width())*$obj.height();}
if((nh>h)&&h>0)
{nh=h;nw=(h/$obj.height())*$obj.width();}
xscale=$obj.width()/nw;yscale=$obj.height()/nh;$obj.width(nw).height(nh);};function unscale(c)
{return{x:parseInt(c.x*xscale),y:parseInt(c.y*yscale),x2:parseInt(c.x2*xscale),y2:parseInt(c.y2*yscale),w:parseInt(c.w*xscale),h:parseInt(c.h*yscale)};};function doneSelect(pos)
{var c=Coords.getFixed();if(c.w>options.minSelect[0]&&c.h>options.minSelect[1])
{Selection.enableHandles();Selection.done();}
else
{Selection.release();}
Tracker.setCursor(options.allowSelect?'crosshair':'default');};function newSelection(e)
{if(options.disabled)return false;if(!options.allowSelect)return false;btndown=true;docOffset=getPos($img);Selection.disableHandles();myCursor('crosshair');var pos=mouseAbs(e);Coords.setPressed(pos);Tracker.activateHandlers(selectDrag,doneSelect);KeyManager.watchKeys();Selection.update();e.stopPropagation();e.preventDefault();return false;};function selectDrag(pos)
{Coords.setCurrent(pos);Selection.update();};function newTracker()
{var trk=$('<div></div>').addClass(cssClass('tracker'));$.browser.msie&&trk.css({opacity:0,backgroundColor:'white'});return trk;};function animateTo(a)
{var x1=a[0]/xscale,y1=a[1]/yscale,x2=a[2]/xscale,y2=a[3]/yscale;if(animating)return;var animto=Coords.flipCoords(x1,y1,x2,y2);var c=Coords.getFixed();var animat=initcr=[c.x,c.y,c.x2,c.y2];var interv=options.animationDelay;var x=animat[0];var y=animat[1];var x2=animat[2];var y2=animat[3];var ix1=animto[0]-initcr[0];var iy1=animto[1]-initcr[1];var ix2=animto[2]-initcr[2];var iy2=animto[3]-initcr[3];var pcent=0;var velocity=options.swingSpeed;Selection.animMode(true);var animator=function()
{return function()
{pcent+=(100-pcent)/velocity;animat[0]=x+((pcent/100)*ix1);animat[1]=y+((pcent/100)*iy1);animat[2]=x2+((pcent/100)*ix2);animat[3]=y2+((pcent/100)*iy2);if(pcent<100)animateStart();else Selection.done();if(pcent>=99.8)pcent=100;setSelectRaw(animat);};}();function animateStart()
{window.setTimeout(animator,interv);};animateStart();};function setSelect(rect)
{setSelectRaw([rect[0]/xscale,rect[1]/yscale,rect[2]/xscale,rect[3]/yscale]);};function setSelectRaw(l)
{Coords.setPressed([l[0],l[1]]);Coords.setCurrent([l[2],l[3]]);Selection.update();};function setOptions(opt)
{if(typeof(opt)!='object')opt={};options=$.extend(options,opt);if(typeof(options.onChange)!=='function')
options.onChange=function(){};if(typeof(options.onSelect)!=='function')
options.onSelect=function(){};};function tellSelect()
{return unscale(Coords.getFixed());};function tellScaled()
{return Coords.getFixed();};function setOptionsNew(opt)
{setOptions(opt);interfaceUpdate();};function disableCrop()
{options.disabled=true;Selection.disableHandles();Selection.setCursor('default');Tracker.setCursor('default');};function enableCrop()
{options.disabled=false;interfaceUpdate();};function cancelCrop()
{Selection.done();Tracker.activateHandlers(null,null);};function destroy()
{$div.remove();$origimg.show();};function interfaceUpdate(alt)
{options.allowResize?alt?Selection.enableOnly():Selection.enableHandles():Selection.disableHandles();Tracker.setCursor(options.allowSelect?'crosshair':'default');Selection.setCursor(options.allowMove?'move':'default');$div.css('backgroundColor',options.bgColor);if('setSelect'in options){setSelect(opt.setSelect);Selection.done();delete(options.setSelect);}
if('trueSize'in options){xscale=options.trueSize[0]/boundx;yscale=options.trueSize[1]/boundy;}
xlimit=options.maxSize[0]||0;ylimit=options.maxSize[1]||0;xmin=options.minSize[0]||0;ymin=options.minSize[1]||0;if('outerImage'in options)
{$img.attr('src',options.outerImage);delete(options.outerImage);}
Selection.refresh();};$hdl_holder.hide();interfaceUpdate(true);var api={animateTo:animateTo,setSelect:setSelect,setOptions:setOptionsNew,tellSelect:tellSelect,tellScaled:tellScaled,disable:disableCrop,enable:enableCrop,cancel:cancelCrop,focus:KeyManager.watchKeys,getBounds:function(){return[boundx*xscale,boundy*yscale];},getWidgetSize:function(){return[boundx,boundy];},release:Selection.release,destroy:destroy};$origimg.data('Jcrop',api);return api;};$.fn.Jcrop=function(options)
{function attachWhenDone(from)
{var loadsrc=options.useImg||from.src;var img=new Image();img.onload=function(){$.Jcrop(from,options);};img.src=loadsrc;};if(typeof(options)!=='object')options={};this.each(function()
{if($(this).data('Jcrop'))
{if(options=='api')return $(this).data('Jcrop');else $(this).data('Jcrop').setOptions(options);}
else attachWhenDone(this);});return this;};})(jQuery);});define('image/vendor/mousewheel/mousewheel',['jquery'],function(jQuery){(function($){var types=['DOMMouseScroll','mousewheel'];if($.event.fixHooks){for(var i=types.length;i;){$.event.fixHooks[types[--i]]=$.event.mouseHooks;}}
$.event.special.mousewheel={setup:function(){if(this.addEventListener){for(var i=types.length;i;){this.addEventListener(types[--i],handler,false);}}else{this.onmousewheel=handler;}},teardown:function(){if(this.removeEventListener){for(var i=types.length;i;){this.removeEventListener(types[--i],handler,false);}}else{this.onmousewheel=null;}}};$.fn.extend({mousewheel:function(fn){return fn?this.bind("mousewheel",fn):this.trigger("mousewheel");},unmousewheel:function(fn){return this.unbind("mousewheel",fn);}});function handler(event){var orgEvent=event||window.event,args=[].slice.call(arguments,1),delta=0,returnValue=true,deltaX=0,deltaY=0;event=$.event.fix(orgEvent);event.type="mousewheel";if(orgEvent.wheelDelta){delta=orgEvent.wheelDelta/120;}
if(orgEvent.detail){delta=-orgEvent.detail/3;}
deltaY=delta;if(orgEvent.axis!==undefined&&orgEvent.axis===orgEvent.HORIZONTAL_AXIS){deltaY=0;deltaX=-1*delta;}
if(orgEvent.wheelDeltaY!==undefined){deltaY=orgEvent.wheelDeltaY/120;}
if(orgEvent.wheelDeltaX!==undefined){deltaX=-1*orgEvent.wheelDeltaX/120;}
args.unshift(event,delta,deltaX,deltaY);return($.event.dispatch||$.event.handle).apply(this,args);}})(jQuery);});define('image/image-plugin',['jquery','aloha/plugin','image/image-floatingMenu','i18n!aloha/nls/i18n','i18n!image/nls/i18n','jqueryui','image/vendor/jcrop/jquery.jcrop.min','image/vendor/mousewheel/mousewheel'],function AlohaImagePlugin(aQuery,Plugin,ImageFloatingMenu,i18nCore,i18n){var jQuery=aQuery;var $=aQuery;var GENTICS=window.GENTICS;var Aloha=window.Aloha;String.prototype.toInteger=String.prototype.toInteger||function(){return parseInt(String(this).replace(/px$/,'')||0,10);};String.prototype.toFloat=String.prototype.toInteger||function(){return parseFloat(String(this).replace(/px$/,'')||0,10);};Number.prototype.toInteger=Number.prototype.toInteger||String.prototype.toInteger;Number.prototype.toFloat=Number.prototype.toFloat||String.prototype.toFloat;jQuery.extend(true,jQuery.fn,{increase:jQuery.fn.increase||function(attr){var obj=jQuery(this),value,newValue;if(!obj.length){return obj;}
value=obj.css(attr).toFloat();newValue=Math.round((value||1)*1.2);if(value===newValue){newValue++;}
obj.css(attr,newValue);return obj;},decrease:jQuery.fn.decrease||function(attr){var obj=jQuery(this),value,newValue;if(!obj.length){return obj;}
value=obj.css(attr).toFloat();newValue=Math.round((value||0)*0.8);if(value===newValue&&newValue>0){newValue--;}
obj.css(attr,newValue);return obj;}});return Plugin.create('image',{defaultSettings:{'maxWidth':1600,'minWidth':3,'maxHeight':1200,'minHeight':3,'autoCorrectManualInput':true,'fixedAspectRatio':false,'autoResize':false,ui:{meta:true,crop:true,resizable:true},handles:'ne, se, sw, nw',onCropped:function($image,props){Aloha.Log.info('Default onCropped invoked',$image,props);},onReset:function($image){Aloha.Log.info('Default onReset invoked',$image);return false;},onResize:function($image){Aloha.Log.info('Default onResize invoked',$image);},onResized:function($image){Aloha.Log.info('Default onResized invoked',$image);}},_onCropped:function($image,props){$('#'+this.ui.imgResizeHeightField.getInputId()).val($image.height());$('#'+this.ui.imgResizeWidthField.getInputId()).val($image.width());$('body').trigger('aloha-image-cropped',[$image,props]);this.onCropped($image,props);},_onReset:function($image){$('#'+this.ui.imgResizeHeightField.getInputId()).val($image.height());$('#'+this.ui.imgResizeWidthField.getInputId()).val($image.width());$('body').trigger('aloha-image-reset',$image);return this.onReset($image);},_onResize:function($image){$('#'+this.ui.imgResizeHeightField.getInputId()).val($image.height());$('#'+this.ui.imgResizeWidthField.getInputId()).val($image.width());$('body').trigger('aloha-image-resize',$image);this.onResize($image);},_onResized:function($image){$('#'+this.ui.imgResizeHeightField.getInputId()).val($image.height());$('#'+this.ui.imgResizeWidthField.getInputId()).val($image.width());$('body').trigger('aloha-image-resized',$image);this.onResized($image);},imageObj:null,jcAPI:null,keepAspectRatio:false,startAspectRatio:false,restoreProps:[],objectTypeFilter:[],init:function(){var plugin=this;var imagePluginUrl=Aloha.getPluginUrl('image');if(typeof this.settings.objectTypeFilter!='undefined'){this.objectTypeFilter=this.settings.objectTypeFilter;}
plugin.startAspectRatio=plugin.settings.fixedAspectRatio;plugin.config=plugin.defaultSettings;plugin.settings=jQuery.extend(true,plugin.defaultSettings,plugin.settings);plugin.initializeUI();plugin.bindInteractions();plugin.subscribeEvents();},initializeUI:function(){var that=this;this.ui=new ImageFloatingMenu();this.ui.init(this);},bindInteractions:function(){var plugin=this;if(plugin.settings.ui.resizable){try{document.execCommand('enableObjectResizing',false,false);}catch(e){Aloha.Log.info(e,'Could not disable enableObjectResizing');}}
if(plugin.settings.ui.meta){plugin.ui.imgSrcField.addListener('keyup',function(event){plugin.srcChange();});plugin.ui.imgSrcField.addListener('blur',function(event){var img=jQuery(plugin.ui.imgSrcField.getTargetObject());if(img.attr('src')===''){img.remove();}});}
if(plugin.settings.onCropped&&typeof plugin.settings.onCropped==="function"){plugin.onCropped=plugin.settings.onCropped;}
if(plugin.settings.onReset&&typeof plugin.settings.onReset==="function"){plugin.onReset=plugin.settings.onReset;}
if(plugin.settings.onResized&&typeof plugin.settings.onResized==="function"){plugin.onResized=plugin.settings.onResized;}
if(plugin.settings.onResize&&typeof plugin.settings.onResize==="function"){plugin.onResize=this.settings.onResize;}},subscribeEvents:function(){var plugin=this;var config=this.settings;jQuery('img').filter(config.globalselector).unbind();jQuery('img').filter(config.globalselector).click(function(event){plugin.clickImage(event);});Aloha.bind('aloha-drop-files-in-editable',function(event,data){var img,len=data.filesObjs.length,fileObj,config;while(--len>=0){fileObj=data.filesObjs[len];if(fileObj.file.type.match(/image\//)){config=plugin.getEditableConfig(data.editable);img=jQuery('<img/>');img.css({"max-width":that.maxWidth,"max-height":that.maxHeight});img.attr('id',fileObj.id);if(typeof fileObj.src==='undefined'){img.attr('src',fileObj.data);}else{img.attr('src',fileObj.src);}
GENTICS.Utils.Dom.insertIntoDOM(img,data.range,jQuery(Aloha.activeEditable.obj));}}});Aloha.bind('aloha-selection-changed',function(event,rangeObject,originalEvent){var config,foundMarkup;if(originalEvent&&originalEvent.target){if(plugin.settings.ui.resizable&&!jQuery(originalEvent.target).hasClass('ui-resizable-handle')){plugin.endResize();plugin.imageObj=null;Aloha.trigger('aloha-image-unselected');}}
if(Aloha.activeEditable!==null){foundMarkup=plugin.findImgMarkup(rangeObject);config=plugin.getEditableConfig(Aloha.activeEditable.obj);if(typeof config!=='undefined'){plugin.ui._insertImageButton.show();}else{plugin.ui._insertImageButton.hide();return;}
if(foundMarkup){plugin.ui._insertImageButton.show();plugin.ui.setScope();if(plugin.settings.ui.meta){plugin.ui.imgSrcField.setTargetObject(foundMarkup,'src');plugin.ui.imgTitleField.setTargetObject(foundMarkup,'title');}
plugin.ui.imgSrcField.foreground();plugin.ui.imgSrcField.focus();}else{if(plugin.settings.ui.meta){plugin.ui.imgSrcField.setTargetObject(null);}}
plugin.ui.doLayout();}});Aloha.bind('aloha-editable-created',function(event,editable){try{document.execCommand('enableObjectResizing',false,false);}catch(e){Aloha.Log.info(e,'Could not disable enableObjectResizing');}
editable.obj.delegate('img','mouseup',function(event){plugin.clickImage(event);event.stopPropagation();});});plugin._subscribeToResizeFieldEvents();},autoResize:function(){var that=this;var width=that.imageObj.width();var height=that.imageObj.height();var resize=false;if(width<that.settings.minWidth||width>that.settings.maxWidth||height<that.settings.minHeight||height>that.settings.maxHeight){resize=true;}
if(resize&&width>=height){that._setNormalizedFieldValues('width');that.setSizeByFieldValue();return true;}else if(resize&&width<height){that._setNormalizedFieldValues('height');that.setSizeByFieldValue();return true;}else{return false;}},toggleKeepAspectRatio:function(){this.keepAspectRatio=!this.keepAspectRatio;this.endResize();if(!this.keepAspectRatio){this.startAspectRatio=false;}else{if(typeof this.settings.fixedAspectRatio!=='number'){var currentRatio=this.imageObj.width()/this.imageObj.height();this.startAspectRatio=currentRatio;}else{this.startAspectRatio=this.settings.fixedAspectRatio;}}
this.startResize();},_subscribeToResizeFieldEvents:function(){var plugin=this;function updateField($field,delta,maxValue,minValue){if(typeof minValue==='undefined'){minValue=0;}
if(typeof maxValue==='undefined'){maxValue=8000;}
var oldValue=parseInt($field.val(),10);if(isNaN(oldValue)){$field.css('background-color','red');return false;}
var newValue=oldValue+delta;if(delta>=0&&newValue>maxValue){if(plugin.settings.autoCorrectManualInput){$field.val(maxValue);return true;}else{$field.css('background-color','red');return false;}}else if(delta<=0&&newValue<minValue){if(plugin.settings.autoCorrectManualInput){$field.val(minValue);return true;}else{$field.css('background-color','red');return false;}}else{$field.css('background-color','');}
$field.val(oldValue+delta);return true;};function handleKeyUpEventOnField(e){var minValue=e.data.minValue;var maxValue=e.data.maxValue;var fieldName=e.data.fieldName;if(e.keyCode===8||e.keyCode===46){if($(this).val()>=minValue){if(typeof plugin.jcAPI!=='undefined'&&plugin.jcAPI!==null){plugin.setCropAreaByFieldValue();}else{plugin._setNormalizedFieldValues(fieldName);plugin.setSizeByFieldValue();}}}else if(e.keyCode<=57&&e.keyCode>=48||e.keyCode<=105&&e.keyCode>=96){if($(this).val()>=minValue){if(typeof plugin.jcAPI!=='undefined'&&plugin.jcAPI!==null){plugin.setCropAreaByFieldValue();}else{plugin._setNormalizedFieldValues(fieldName);plugin.setSizeByFieldValue();}}}else{var delta=0;if(e.keyCode===38||e.keyCode===107){delta=+1;}else if(e.keyCode===40||e.keyCode===109){delta=-1;}
if(e.shiftKey||e.metaKey||e.ctrlKey){delta=delta*10;}
if(updateField($(this),delta,maxValue,minValue)){if(typeof plugin.jcAPI!=='undefined'&&plugin.jcAPI!==null){plugin.setCropAreaByFieldValue();}else{plugin._setNormalizedFieldValues(fieldName);plugin.setSizeByFieldValue();}}}
e.preventDefault();return false;}
function handleMouseWheelEventOnField(e,delta){var minValue=e.data.minValue;var maxValue=e.data.maxValue;var fieldName=e.data.fieldName;if(e.shiftKey||e.metaKey||e.ctrlKey){delta=delta*10;}
if(updateField($(this),delta,maxValue,minValue)){if(typeof plugin.jcAPI!=='undefined'&&plugin.jcAPI!==null){plugin.setCropAreaByFieldValue();}else{plugin._setNormalizedFieldValues(fieldName);plugin.setSizeByFieldValue();}}
return false;}
var $heightField=$('#'+plugin.ui.imgResizeHeightField.getInputId());var heightEventData={fieldName:'height',maxValue:plugin.ui.imgResizeHeightField.maxValue,minValue:plugin.ui.imgResizeHeightField.minValue};$heightField.live('keyup',heightEventData,handleKeyUpEventOnField);$heightField.live('mousewheel',heightEventData,handleMouseWheelEventOnField);var $widthField=$('#'+plugin.ui.imgResizeWidthField.getInputId());var widthEventData={fieldName:'width',maxValue:plugin.ui.imgResizeWidthField.maxValue,minValue:plugin.ui.imgResizeWidthField.minValue};$widthField.live('keyup',widthEventData,handleKeyUpEventOnField);$widthField.live('mousewheel',widthEventData,handleMouseWheelEventOnField);},_setNormalizedFieldValues:function(primaryFieldName){var plugin=this;var widthField=jQuery("#"+plugin.ui.imgResizeWidthField.getInputId());var heightField=jQuery("#"+plugin.ui.imgResizeHeightField.getInputId());var width=widthField.val();var height=heightField.val();var size=plugin._normalizeSize(width,height,primaryFieldName);widthField.val(size.width);heightField.val(size.height);},setSize:function(width,height){var plugin=this;plugin.imageObj.width(width);plugin.imageObj.height(height);var $wrapper=plugin.imageObj.closest('.Aloha_Image_Resize');$wrapper.height(height);$wrapper.width(width);plugin._onResize(plugin.imageObj);plugin._onResized(plugin.imageObj);},clickImage:function(e){var plugin=this;plugin.endResize();plugin.imageObj=jQuery(e.target);var currentImage=plugin.imageObj;if(currentImage.hasClass('aloha-ui')){return;}
plugin.ui.setScope();var editable=currentImage.closest('.aloha-editable');this.restoreProps.push({obj:e.srcElement,src:plugin.imageObj.attr('src'),width:plugin.imageObj.width(),height:plugin.imageObj.height()});$('#'+plugin.ui.imgResizeHeightField.getInputId()).val(plugin.imageObj.height());$('#'+plugin.ui.imgResizeWidthField.getInputId()).val(plugin.imageObj.width());if(plugin.settings.ui.meta){plugin.ui.imgSrcField.setTargetObject(plugin.imageObj,'src');plugin.ui.imgTitleField.setTargetObject(plugin.imageObj,'title');}
Aloha.Selection.preventSelectionChanged();try{plugin.ui.imgSrcField.focus();}catch(e){}
if(plugin.settings.ui.resizable){plugin.startResize();}
if(plugin.settings.autoResize){plugin.autoResize();}
Aloha.Selection.preventSelectionChangedFlag=false;Aloha.trigger('aloha-image-selected');},findImgMarkup:function(range){var plugin=this;var config=this.config;var result,targetObj;if(typeof range==='undefined'){range=Aloha.Selection.getRangeObject();}
targetObj=jQuery(range.startContainer);try{if(Aloha.activeEditable){if((typeof range.startContainer!=='undefined'&&typeof range.startContainer.childNodes!=='undefined'&&typeof range.startOffset!=='undefined'&&typeof range.startContainer.childNodes[range.startOffset]!=='undefined'&&range.startContainer.childNodes[range.startOffset].nodeName.toLowerCase()==='img'&&range.startOffset+1===range.endOffset)||(targetObj.hasClass('Aloha_Image_Resize')))
{result=targetObj.find('img')[0];if(!result.css){result.css='';}
if(!result.title){result.title='';}
if(!result.src){result.src='';}
return result;}
else{return null;}}}catch(e){Aloha.Log.debug(e,"Error finding img markup.");}
return null;},getPluginFocus:function(){return this.imageObj;},_normalizeSize:function(width,height,primarySize){var that=this;width=parseInt(width);height=parseInt(height);function handleHeight(callHandleWidth){if(height>that.settings.maxHeight){var eventProps={'org':height,'new':that.settings.maxHeight};$('body').trigger('aloha-image-resize-outofbounds',["height","max",eventProps]);height=that.settings.maxHeight;}else if(height<that.settings.minHeight){var eventProps={'org':height,'new':that.settings.minHeight};$('body').trigger('aloha-image-resize-outofbounds',["height","min",eventProps]);height=that.settings.minHeight;}
if(that.keepAspectRatio){width=height*aspectRatio;if(callHandleWidth){handleWidth(false);}}}
function handleWidth(callHandleHeight){if(width>that.settings.maxWidth){var eventProps={'org':width,'new':that.settings.maxWidth};$('body').trigger('aloha-image-resize-outofbounds',["width","max",eventProps]);width=that.settings.maxWidth;}else if(width<that.settings.minWidth){var eventProps={'org':width,'new':that.settings.minWidth};$('body').trigger('aloha-image-resize-outofbounds',["width","min",eventProps]);width=that.settings.minWidth;}
if(that.keepAspectRatio){height=width/aspectRatio;if(callHandleHeight){handleHeight(false);}}}
var aspectRatio=1.33333;if(that.keepAspectRatio){aspectRatio=width/height;}
if(typeof that.startAspectRatio==='number'){aspectRatio=that.startAspectRatio;}
if(primarySize=='width'){handleWidth(true);}
if(primarySize=='height'){handleHeight(true);}
return{'width':Math.floor(width),'height':Math.floor(height)};},setSizeByFieldValue:function(){var plugin=this;var width=$('#'+plugin.ui.imgResizeWidthField.getInputId()).val();var height=$('#'+plugin.ui.imgResizeHeightField.getInputId()).val();plugin.setSize(width,height);},setCropAreaByFieldValue:function(){var plugin=this;var currentCropArea=plugin.jcAPI.tellSelect();var width=$('#'+plugin.ui.imgResizeWidthField.getInputId()).val();width=parseInt(width,10);var height=$('#'+plugin.ui.imgResizeHeightField.getInputId()).val();height=parseInt(height,10);var selection=[currentCropArea['x'],currentCropArea['y'],currentCropArea['x']+width,currentCropArea['y']+height];plugin.jcAPI.setSelect(selection);},insertImg:function(){var range=Aloha.Selection.getRangeObject(),config=this.getEditableConfig(Aloha.activeEditable.obj),imagePluginUrl=Aloha.getPluginUrl('image'),imagestyle,imagetag,newImg;if(range.isCollapsed()){imagestyle="max-width: "+config.maxWidth+"; max-height: "+config.maxHeight;imagetag='<img style="'+imagestyle+'" src="'+imagePluginUrl+'/img/blank.jpg" title="" />';newImg=jQuery(imagetag);GENTICS.Utils.Dom.insertIntoDOM(newImg,range,jQuery(Aloha.activeEditable.obj));}else{Aloha.Log.error('img cannot markup a selection');}},srcChange:function(){this.imageObj.attr('src',this.ui.imgSrcField.getValue());},positionCropButtons:function(){var jt=jQuery('.jcrop-tracker:first'),off=jt.offset(),jtt=off.top,jtl=off.left,jth=jt.height(),jtw=jt.width();var oldLeft=0,oldTop=0;var btns=jQuery('#aloha-CropNResize-btns');if(jtt===0&&jtl===0){btns.hide();}
jtt=parseInt(jtt+jth+3,10);jtl=parseInt(jtl+(jtw/2)-(btns.width()/2)+10,10);if(oldLeft!=jtl||oldTop!=jtt){btns.offset({top:jtt,left:jtl});}
oldLeft=jtl;oldTop=jtt;},initCropButtons:function(){var that=this,btns;jQuery('body').append('<div id="aloha-CropNResize-btns" display="none">'+'<button class="cnr-crop-apply" title="'+i18n.t('Accept')+'"></button>'+'<button class="cnr-crop-cancel" title="'+i18n.t('Cancel')+'"></button>'+'</div>');btns=jQuery('#aloha-CropNResize-btns');btns.find('.cnr-crop-apply').click(function(){that.acceptCrop();});btns.find('.cnr-crop-cancel').click(function(){that.endCrop();});this.interval=setInterval(function(){that.positionCropButtons();},10);},destroyCropButtons:function(){jQuery('#aloha-CropNResize-btns').remove();clearInterval(this.interval);},_disableSelection:function(el){el.find('*').attr('unselectable','on').css({'-moz-user-select':'none','-webkit-user-select':'none','user-select':'none'});},crop:function(){var plugin=this;var config=this.config;plugin.initCropButtons();if(plugin.settings.ui.resizable){plugin.endResize();}
plugin.jcAPI=jQuery.Jcrop(plugin.imageObj,{onSelect:function(){plugin._onCropSelect();window.setTimeout(function(){plugin.ui.setScope();},10);}});plugin._disableSelection($('.jcrop-holder'));plugin._disableSelection($('#imageContainer'));plugin._disableSelection($('#aloha-CropNResize-btns'));$('body').trigger('aloha-image-crop-start',[plugin.imageObj]);},_onCropSelect:function(){var plugin=this;jQuery('#aloha-CropNResize-btns').fadeIn('slow');jQuery('.jcrop-handle').mousedown(function(){jQuery('#aloha-CropNResize-btns').hide();});jQuery('.jcrop-tracker').mousedown(function(){jQuery('#aloha-CropNResize-btns').hide();});if(typeof plugin.jcAPI!=='undefined'&&plugin.jcAPI!==null){plugin.positionCropButtons();var currentCropArea=plugin.jcAPI.tellSelect();var widthField=jQuery("#"+plugin.ui.imgResizeWidthField.getInputId()).val(currentCropArea['w']);var heightField=jQuery("#"+plugin.ui.imgResizeHeightField.getInputId()).val(currentCropArea['h']);}},endCrop:function(){if(this.jcAPI){this.jcAPI.destroy();this.jcAPI=null;}
this.destroyCropButtons();this.ui._imageCropButton.setState(false);if(this.settings.ui.resizable){this.startResize();}
if(this.keepAspectRatio){var currentRatio=this.imageObj.width()/this.imageObj.height();this.startAspectRatio=currentRatio;}
$('body').trigger('aloha-image-crop-stop',[this.imageObj]);},acceptCrop:function(){this._onCropped(this.imageObj,this.jcAPI.tellSelect());this.endCrop();},startResize:function(){var plugin=this;var currentImageObj=this.imageObj;currentImageObj=this.imageObj.css({height:this.imageObj.height(),width:this.imageObj.width(),position:'relative','max-height':'','max-width':''});currentImageObj.resizable({maxHeight:plugin.settings.maxHeight,minHeight:plugin.settings.minHeight,maxWidth:plugin.settings.maxWidth,minWidth:plugin.settings.minWidth,aspectRatio:plugin.startAspectRatio,handles:plugin.settings.handles,grid:plugin.settings.grid,resize:function(event,ui){plugin._onResize(plugin.imageObj);},stop:function(event,ui){plugin._onResized(plugin.imageObj);if(this.enableCrop){window.setTimeout(function(){plugin.ui.setScope();that.done(event);},10);}}});currentImageObj.css('display','inline-block');jQuery('.ui-wrapper').attr('contentEditable',false).addClass('aloha-image-box-active Aloha_Image_Resize aloha').css({position:'relative',display:'inline-block','float':plugin.imageObj.css('float')}).bind('resizestart',function(e){e.preventDefault();}).bind('mouseup',function(e){e.originalEvent.stopSelectionUpdate=true;});},endResize:function(){if(this.imageObj){var editable=this.imageObj.closest('.aloha-editable');}
if(this.imageObj&&this.imageObj.is(":ui-resizable")){this.imageObj.resizable('destroy').css({top:0,left:0});}},resetSize:function(){var plugin=this,img=new Image();img.onload=function(){var myimage=plugin.getPluginFocus();if(plugin.settings.ui.resizable){plugin.endResize();}
jQuery(myimage).add(myimage.parent()).css({'width':img.width+'px','height':img.height+'px','max-width':'','max-height':''});if(plugin.settings.ui.resizable){plugin.resize();}};img.src=plugin.getPluginFocus().attr('src');},reset:function(){if(this.settings.ui.crop){this.endCrop();}
if(this.settings.ui.resizable){this.endResize();}
if(this._onReset(this.imageObj)){return;}
for(var i=0;i<this.restoreProps.length;i++){if(this.imageObj.get(0)===this.restoreProps[i].obj){this.imageObj.attr('src',this.restoreProps[i].src);this.imageObj.width(this.restoreProps[i].width);this.imageObj.height(this.restoreProps[i].height);return;}}}});});define('highlighteditables/highlighteditables-plugin',['aloha','jquery','aloha/plugin'],function(Aloha,jQuery,Plugin){var
GENTICS=window.GENTICS;return Plugin.create('highlighteditables',{config:['highlight'],init:function(){var that=this,config;GENTICS.Utils.Position.addMouseMoveCallback(function(){var i,editable;for(i=0;i<Aloha.editables.length;i++){editable=Aloha.editables[i];config=that.getEditableConfig(editable.obj);if(!Aloha.activeEditable&&!editable.isDisabled()&&config=='highlight'){editable.obj.addClass('aloha-editable-highlight');}}});GENTICS.Utils.Position.addMouseStopCallback(function(){that.fade();});Aloha.bind("aloha-editable-activated",function(jEvent,aEvent){that.fade();});},fade:function(){var
i,editable,animateEnd=function(){jQuery(this).css('outline','');};for(i=0;i<Aloha.editables.length;i++){editable=Aloha.editables[i].obj;if(editable.hasClass('aloha-editable-highlight')){editable.css('outline',editable.css('outlineColor')+' '+editable.css('outlineStyle')+' 5px').removeClass('aloha-editable-highlight').animate({outlineWidth:'0px'},300,'swing',animateEnd);}}}});});define('dom-to-xhtml/dom-to-xhtml',['jquery','util/dom2','util/misc','util/browser','aloha/ephemera','aloha/console'],function($,Dom,Misc,Browser,Ephemera,console){var emptyElements={"area":true,"base":true,"basefont":true,"br":true,"col":true,"frame":true,"hr":true,"img":true,"input":true,"isindex":true,"link":true,"meta":true,"param":true,"embed":true};var booleanAttrs={"checked":true,"compact":true,"declare":true,"defer":true,"disabled":true,"ismap":true,"multiple":true,"nohref":true,"noresize":true,"noshade":true,"nowrap":true,"readonly":true,"selected":true};var isUnrecognizedMap={"DIV":false,"SPAN":false,"UL":false,"OL":false,"LI":false,"TABLE":false,"TR":false,"TD":false,"TH":false,"I":false,"B":false,"EM":false,"STRONG":false,"A":false,"P":false};function encodePcdata(str){return str.replace(/&/g,'&amp;').replace(/</g,'&lt;');}
function encodeDqAttrValue(str){return encodePcdata(str).replace(/"/g,'&quot;');}
function makeAttrString(element,ephemera){var attrs=Dom.attrs(element);var str="";var i,len;if(Browser.ie7){for(var bool in booleanAttrs){if(booleanAttrs.hasOwnProperty(bool)&&element[bool]){for(i=0,len=attrs.length;i<len;i++){if(bool===attrs[i][0].toLowerCase()){attrs.splice(i,1);break;}}
attrs.push([bool,bool]);}}}
for(i=0,len=attrs.length;i<len;i++){var attr=attrs[i];var name=attr[0].toLowerCase();var value=attr[1];if(ephemera&&Ephemera.isAttrEphemeral(element,name,ephemera.attrMap||{},ephemera.attrRxs||{})){continue;}
var isBool=booleanAttrs[name];if(!isBool&&""===value){continue;}
str+=" "+name+'="'+encodeDqAttrValue((isBool?name:value))+'"';}
return str;}
function isUnrecognized(element){var name=element.nodeName;var unrecognized=isUnrecognizedMap[name];if(null!=unrecognized){return unrecognized;}
var closingName="/"+element.nodeName;var sibling=element.nextSibling;unrecognized=false;while(null!=sibling){if(closingName==sibling.nodeName){unrecognized=true;break;}
sibling=sibling.nextSibling;}
isUnrecognizedMap[name]=unrecognized;return unrecognized;}
function serializeChildren(element,child,unrecognized,ephemera,xhtml){while(null!=child){if(1===child.nodeType&&unrecognized&&"/"+element.nodeName==child.nodeName){child=child.nextSibling;break;}else if(1===child.nodeType&&isUnrecognized(child)){child=serializeElement(child,child.nextSibling,true,ephemera,xhtml);}else{serialize(child,ephemera,xhtml);child=child.nextSibling;}}
return child;}
function serializeElement(element,child,unrecognized,ephemera,xhtml){var elementName=element.nodeName.toLowerCase();if(element.scopeName&&'HTML'!=element.scopeName&&-1===elementName.indexOf(':')){elementName=element.scopeName.toLowerCase()+':'+elementName;}
if(!unrecognized&&null==child&&emptyElements[elementName]){xhtml.push('<'+elementName+makeAttrString(element,ephemera)+'/>');}else{xhtml.push('<'+elementName+makeAttrString(element,ephemera)+'>');child=serializeChildren(element,child,unrecognized,ephemera,xhtml);xhtml.push('</'+elementName+'>');}
return child;}
function serialize(node,ephemera,xhtml){var nodeType=node.nodeType;if(1===nodeType){serializeElement(node,node.firstChild,isUnrecognized(node),ephemera,xhtml);}else if(3===node.nodeType){xhtml.push(encodePcdata(node.nodeValue));}else if(8===node.nodeType){xhtml.push('<'+'!--'+node.nodeValue+'-->');}else{console.warn('Unknown node type encountered during serialization, ignoring it:'
+' type='+node.nodeType
+' name='+node.nodeName
+' value='+node.nodeValue);}}
return{contentsToXhtml:function(element,ephemera){var xhtml=[];serializeChildren(element,element.firstChild,false,ephemera,xhtml);return xhtml.join("");},nodeToXhtml:function(node,ephemera){var xhtml=[];serialize(node,ephemera,xhtml);return xhtml.join("");}};});define('dom-to-xhtml/dom-to-xhtml-plugin',['aloha','jquery','aloha/plugin','aloha/ephemera','dom-to-xhtml/dom-to-xhtml'],function(Aloha,$,Plugin,Ephemera,domToXhtml){return Plugin.create('dom-to-xhtml',{init:function(){var that=this;Aloha.Editable.setContentSerializer(function(editableElement){if(!that.settings.editables&&!that.settings.config){return domToXhtml.contentsToXhtml(editableElement);}
if(that.settings.editables&&that.settings.editables['#'+$(editableElement).attr('id')]=='dom-to-xhtml'){return domToXhtml.contentsToXhtml(editableElement,Ephemera.ephemera());}else if(that.settings.config&&that.settings.config=='dom-to-xhtml'&&!that.settings.editables['#'+$(editableElement).attr('id')]){return domToXhtml.contentsToXhtml(editableElement,Ephemera.ephemera());}else{return $(editableElement).html();}});}});});define('contenthandler/wordcontenthandler',['aloha','jquery','aloha/contenthandlermanager'],function(Aloha,jQuery,ContentHandlerManager){var WordContentHandler=ContentHandlerManager.createHandler({handleContent:function(content){if(typeof content==='string'){content=jQuery('<div>'+content+'</div>');}else if(content instanceof jQuery){content=jQuery('<div>').append(content);}
if(this.detectWordContent(content)){this.transformWordContent(content);}
return content.html();},detectWordContent:function(content){var wordDetected=false;content.find('*').each(function(){var style=jQuery(this).attr('style'),clazz;if(style){if(style.toLowerCase().indexOf('mso')>=0){wordDetected=true;return false;}}
clazz=jQuery(this).attr('class');if(clazz){if(clazz.toLowerCase().indexOf('mso')>=0){wordDetected=true;return false;}}});return wordDetected;},isOrderedList:function(listSpan){if(listSpan.css('fontFamily')=='Wingdings'||listSpan.css('fontFamily')=='Symbol'){return false;}
return listSpan.text().match(/^([0-9]{1,3}\.)|([0-9]{1,3}\)|([a-zA-Z]{1,5}\.)|([a-zA-Z]{1,5}\)))$/)?true:false;},transformListsFromWord:function(content){var that=this,negateDetectionFilter,detectionFilter,spans,paragraphs,bulletClass,listElementClass;listElementClass='aloha-list-element';bulletClass='aloha-list-bullet';detectionFilter='p.MsoListParagraphCxSpFirst,p.MsoListParagraphCxSpMiddle,p.MsoListParagraphCxSpLast,p.MsoListParagraph,p span';paragraphs=content.find(detectionFilter);paragraphs.each(function(){var jqElem=jQuery(this),fontFamily=jqElem.css('font-family')||'',msoList=jqElem.css('mso-list')||'',style=jqElem.attr('style')||'';if(jqElem.hasClass('MsoListParagraphCxSpFirst')||jqElem.hasClass('MsoListParagraph')){jqElem.addClass(listElementClass);}else if(fontFamily.indexOf('Symbol')>=0){jqElem.closest('p').addClass(listElementClass);}else if(fontFamily.indexOf('Wingdings')>=0){jqElem.closest('p').addClass(listElementClass);}else if(msoList!==''){jqElem.closest('p').addClass(listElementClass);}else if(style.indexOf('mso-list')>=0){jqElem.closest('p').addClass(listElementClass);}});detectionFilter='p span span span';spans=content.find(detectionFilter);spans.each(function(){var jqElem=jQuery(this),innerText=jQuery.trim(jqElem.text()).replace(/&nbsp;/g,''),outerText;if(innerText.length===0){outerText=jQuery.trim(jqElem.parent().parent().text()).replace(/&nbsp;/g,'');if(outerText.match(/^([0-9]{1,3}\.)|([0-9]{1,3}\))|([a-zA-Z]{1,5}\.)|([a-zA-Z]{1,5}\))|(.)$/)){jqElem.closest('p').addClass(listElementClass);jqElem.parent().parent().addClass(bulletClass);}}});detectionFilter='p.'+listElementClass;negateDetectionFilter=':not('+detectionFilter+', font)';paragraphs=content.find(detectionFilter);if(paragraphs.length>0){paragraphs.each(function(){var jqElem=jQuery(this),jqNewLi,jqList,ordered,firstSpan,following,lists,margin,nestLevel;jqElem.removeClass(listElementClass);jqElem.find('font').each(function(){jQuery(this).contents().unwrap();});nestLevel=[];margin=parseFloat(jqElem.css('marginLeft'));if(isNaN(margin)){margin=0;}
lists=[];following=jqElem.nextUntil(negateDetectionFilter);firstSpan=jQuery(jqElem.find('span.'+bulletClass));if(firstSpan.length===0){firstSpan=jqElem.find('span').eq(0);}
ordered=that.isOrderedList(firstSpan);firstSpan.remove();jqList=jQuery(ordered?'<ol></ol>':'<ul></ul>');lists.push(jqList);jqNewLi=jQuery('<li></li>');jqList.append(jqNewLi);jqElem.contents().appendTo(jqNewLi);jqElem.replaceWith(jqList);following.each(function(){var jqElem=jQuery(this),newMargin,jqNewList;if(jqElem.is('font')){return;}
jqElem.find('font').each(function(){jQuery(this).contents().unwrap();});newMargin=parseFloat(jqElem.css('marginLeft'));if(isNaN(newMargin)){newMargin=0;}
firstSpan=jQuery(jqElem.find('span.'+bulletClass));if(firstSpan.length===0){firstSpan=jqElem.find('span').eq(0);}
ordered=that.isOrderedList(firstSpan);firstSpan.remove();if(newMargin>margin){jqNewList=jQuery(ordered?'<ol></ol>':'<ul></ul>');jqList.children(':last').append(jqNewList);jqList=jqNewList;lists.push(jqList);nestLevel.push(newMargin);margin=newMargin;}else if(newMargin<margin&&nestLevel.length>0){while(nestLevel.length>0&&nestLevel[nestLevel.length-1]>newMargin){nestLevel.pop();lists.pop();}
jqList=lists[lists.length-1];margin=newMargin;}
jqNewLi=jQuery('<li></li>');jqList.append(jqNewLi);jqElem.contents().appendTo(jqNewLi);jqElem.remove();});});}},transformTitles:function(content){content.find('p.MsoTitle').each(function(){Aloha.Markup.transformDomObject(jQuery(this),'h1');});content.find('p.MsoSubtitle').each(function(){Aloha.Markup.transformDomObject(jQuery(this),'h2');});},cleanHtml:function(content){content.find('*').filter(function(){return jQuery.trim(jQuery(this).text())==''&&!jQuery(this).is("td");}).contents().unwrap();content.find('span').contents().unwrap();content.find('a').each(function(){if(jQuery(this).attr('href')&&jQuery.trim(jQuery(this).attr('href')).match(/^#(.*)$/)){jQuery(this).contents().unwrap();}});content.find('div').contents().unwrap();content.find('*').filter(function(){return jQuery.trim(jQuery(this).text())==''&&!jQuery(this).is("td");}).remove();},removeParagraphNumbering:function(content){var detectionFilter='h1,h2,h3,h4,h5,h6',paragraphs=content.find(detectionFilter);if(paragraphs.length>0){paragraphs.each(function(){var jqElem=jQuery(this),spans=jqElem.find('span'),links=jqElem.find('a');spans.each(function(){if(jQuery.trim(jQuery(this).text()).match(/^([\.\(]?[\d\D][\.\(]?){1,4}$/)){jQuery(this).remove();}})
links.each(function(){if(typeof jQuery(this).attr('href')==='undefined'){jQuery(this).contents().unwrap();}});});}},transformToc:function(content){var detectionFilter='[class*=MsoToc]',paragraphs=content.find(detectionFilter);paragraphs.each(function(){var jqElem=jQuery(this),spans=jqElem.find('span'),links=jqElem.find('a');spans.each(function(){if(jQuery(this).attr('style')&&jQuery(this).attr('style').search('mso-hide')>-1){jQuery(this).remove();}
jQuery(this).contents().unwrap();});links.each(function(){jQuery(this).contents().unwrap();});});},transformWordContent:function(content){this.transformToc(content);this.removeParagraphNumbering(content);this.transformListsFromWord(content);this.transformTitles(content);this.cleanHtml(content);}});return WordContentHandler;});define('contenthandler/genericcontenthandler',['aloha','jquery','aloha/contenthandlermanager'],function(Aloha,jQuery,ContentHandlerManager){var
GENTICS=window.GENTICS;var GenericContentHandler=ContentHandlerManager.createHandler({handleContent:function(content){if(null==content){return;}
if(typeof content==='string'){content=jQuery('<div>'+content+'</div>');}else if(content instanceof jQuery){content=jQuery('<div>').append(content);}
if(content.find('.aloha-block').length>0){return content.html();}
this.cleanLists(content);this.transformTables(content);this.removeComments(content);this.unwrapTags(content);this.removeStyles(content);this.removeNamespacedElements(content);var transformFormattingsEnabled=true;if(Aloha.settings&&Aloha.settings.contentHandler&&Aloha.settings.contentHandler.handler&&Aloha.settings.contentHandler.handler.generic&&typeof Aloha.settings.contentHandler.handler.generic.transformFormattings!=='undefinded'&&!Aloha.settings.contentHandler.handler.generic.transformFormattings){transformFormattingsEnabled=false;}
if(transformFormattingsEnabled===true){this.transformFormattings(content);}
return content.html();},cleanLists:function(content){content.find('ul,ol').each(function(){var $list=jQuery(this);$list.contents(':not(li,ul,ol)').each(function(){jQuery(this).remove();});});},transformTables:function(content){content.find('table').each(function(){jQuery(this).removeAttr('border').removeAttr('cellspacing').removeAttr('cellpadding');});content.find('td').each(function(){jQuery(this).removeAttr('width').removeAttr('height').removeAttr('valign');if(this.innerHTML.replace(/[\s\xA0]+/g,'')==='<p><br></p>'){this.innerHTML='&nbsp;';}
if(jQuery(this).find('p').length===1){jQuery(this).find('p').contents().unwrap();}});content.find('tr').each(function(){jQuery(this).removeAttr('width').removeAttr('height').removeAttr('valign');});content.find('colgroup').remove();},transformFormattings:function(content){content.find('strong,em,s,u,strike').each(function(){if(this.nodeName==='STRONG'){Aloha.Markup.transformDomObject(jQuery(this),'b');}else if(this.nodeName==='EM'){Aloha.Markup.transformDomObject(jQuery(this),'i');}else if(this.nodeName==='S'||this.nodeName=='STRIKE'){Aloha.Markup.transformDomObject(jQuery(this),'del');}else if(this.nodeName==='U'){jQuery(this).contents().unwrap();}});},transformLinks:function(content){content.find('a').each(function(){if(typeof jQuery(this).attr('href')==='undefined'){jQuery(this).contents().unwrap();}});},removeComments:function(content){var that=this;content.contents().each(function(){if(this.nodeType===8){jQuery(this).remove();}else{that.removeComments(jQuery(this));}});},unwrapTags:function(content){var that=this;content.find('span,font,div').not('.aloha-wai-lang').each(function(){if(this.nodeName=='DIV'){if(this.innerHTML==='<br>'){jQuery(this).contents().unwrap();}else{jQuery(Aloha.Markup.transformDomObject(jQuery(this),'p').append('<br>')).contents().unwrap();}}else{jQuery(this).contents().unwrap();}});},removeStyles:function(content){var that=this;content.children('style').filter(function(){return this.contentEditable!=='false';}).remove();content.children().filter(function(){return this.contentEditable!=='false';}).each(function(){jQuery(this).removeAttr('style').removeClass();that.removeStyles(jQuery(this));});},removeNamespacedElements:function(content){content.find('*').each(function(){var nsPrefix=this.prefix?this.prefix:(this.scopeName?this.scopeName:undefined);if((nsPrefix&&nsPrefix!=='HTML')||this.nodeName.indexOf(':')>=0){var $this=jQuery(this),$contents=$this.contents();if($contents.length){$contents.unwrap();}else{$this.remove();}}});}});return GenericContentHandler;});define('contenthandler/oembedcontenthandler',['aloha','jquery','aloha/contenthandlermanager'],function(Aloha,jQuery,ContentHandlerManager){var
GENTICS=window.GENTICS,escape=window.escape,providers,getOEmbedProvider,getNormalizedParams,OEmbedProvider;jQuery.fn.oembed=function(url,options,embedAction){settings=jQuery.extend(true,jQuery.fn.oembed.defaults,options);initializeProviders();return this.each(function(){var container=jQuery(this),resourceURL=(url!=null)?url:container.attr("href"),provider;if(embedAction){settings.onEmbed=embedAction;}else{settings.onEmbed=function(oembedData){jQuery.fn.oembed.insertCode(this,settings.embedMethod,oembedData);};}
if(resourceURL!=null){provider=jQuery.fn.oembed.getOEmbedProvider(resourceURL);if(provider!=null){provider.params=getNormalizedParams(settings[provider.name])||{};provider.maxWidth=settings.maxWidth;provider.maxHeight=settings.maxHeight;embedCode(container,resourceURL,provider);}else{settings.onProviderNotFound.call(container,resourceURL);}}
return container;});};var settings,activeProviders=[];jQuery.fn.oembed.defaults={maxWidth:null,maxHeight:null,embedMethod:"replace",defaultOEmbedProvider:"oohembed",allowedProviders:null,disallowedProviders:null,customProviders:null,defaultProvider:null,greedy:true,onProviderNotFound:function(){},beforeEmbed:function(){},afterEmbed:function(){},onEmbed:function(){},onError:function(){},ajaxOptions:{}};jQuery.fn.oembed.embedCode=false;function getRequestUrl(provider,externalUrl){var url=provider.apiendpoint,qs="",callbackparameter=provider.callbackparameter||"callback",i;if(url.indexOf("?")<=0)
url=url+"?";else
url=url+"&";if(provider.maxWidth!=null&&provider.params["maxwidth"]==null)
provider.params["maxwidth"]=provider.maxWidth;if(provider.maxHeight!=null&&provider.params["maxheight"]==null)
provider.params["maxheight"]=provider.maxHeight;for(i in provider.params){if(i==provider.callbackparameter)
continue;if(provider.params[i]!=null)
qs+="&"+escape(i)+"="+provider.params[i];}
url+="format=json&url="+escape(externalUrl)+
qs+"&"+callbackparameter+"=?";return url;};function embedCode(container,externalUrl,embedProvider){var requestUrl=getRequestUrl(embedProvider,externalUrl),ajaxopts=jQuery.extend({url:requestUrl,type:'get',dataType:'json',success:function(data){var oembedData=jQuery.extend({},data);switch(oembedData.type){case"photo":oembedData.code=jQuery.fn.oembed.getPhotoCode(externalUrl,oembedData);break;case"video":oembedData.code=jQuery.fn.oembed.getVideoCode(externalUrl,oembedData);break;case"rich":oembedData.code=jQuery.fn.oembed.getRichCode(externalUrl,oembedData);break;default:oembedData.code=jQuery.fn.oembed.getGenericCode(externalUrl,oembedData);break;}
settings.beforeEmbed.call(container,oembedData);settings.onEmbed.call(container,oembedData);settings.afterEmbed.call(container,oembedData);},error:settings.onError.call(container,externalUrl,embedProvider)},settings.ajaxOptions||{});jQuery.ajax(ajaxopts);};function initializeProviders(){activeProviders=[];var defaultProvider,restrictedProviders=[],i,provider;if(!isNullOrEmpty(settings.allowedProviders)){for(i=0;i<jQuery.fn.oembed.providers.length;i++){if(jQuery.inArray(jQuery.fn.oembed.providers[i].name,settings.allowedProviders)>=0)
activeProviders.push(jQuery.fn.oembed.providers[i]);}
settings.greedy=false;}else{activeProviders=jQuery.fn.oembed.providers;}
if(!isNullOrEmpty(settings.disallowedProviders)){for(i=0;i<activeProviders.length;i++){if(jQuery.inArray(activeProviders[i].name,settings.disallowedProviders)<0)
restrictedProviders.push(activeProviders[i]);}
activeProviders=restrictedProviders;settings.greedy=false;}
if(!isNullOrEmpty(settings.customProviders)){jQuery.each(settings.customProviders,function(n,customProvider){if(customProvider instanceof jQuery.fn.oembed.OEmbedProvider){activeProviders.push(provider);}else{provider=new jQuery.fn.oembed.OEmbedProvider();if(provider.fromJSON(customProvider))
activeProviders.push(provider);}});}
defaultProvider=getDefaultOEmbedProvider(settings.defaultOEmbedProvider);if(settings.greedy==true){activeProviders.push(defaultProvider);}
for(i=0;i<activeProviders.length;i++){if(activeProviders[i].apiendpoint==null)
activeProviders[i].apiendpoint=defaultProvider.apiendpoint;}}
function getDefaultOEmbedProvider(defaultOEmbedProvider){var url="http://oohembed.com/oohembed/";if(defaultOEmbedProvider=="embed.ly")
url="http://api.embed.ly/v1/api/oembed?";return new jQuery.fn.oembed.OEmbedProvider(defaultOEmbedProvider,null,null,url,"callback");}
function getNormalizedParams(params){if(params==null)
return null;var key,normalizedParams={};for(key in params){if(key!=null)
normalizedParams[key.toLowerCase()]=params[key];}
return normalizedParams;}
function isNullOrEmpty(object){if(typeof object=="undefined")
return true;if(object==null)
return true;if(jQuery.isArray(object)&&object.length==0)
return true;return false;}
jQuery.fn.oembed.insertCode=function(container,embedMethod,oembedData){if(oembedData==null)
return;jQuery.fn.oembed.embedCode=oembedData.code;switch(embedMethod){case"auto":if(container.attr("href")!=null){jQuery.fn.oembed.insertCode(container,"append",oembedData);}
else{jQuery.fn.oembed.insertCode(container,"replace",oembedData);};break;case"replace":container.replaceWith(oembedData.code);break;case"fill":container.html(oembedData.code);break;case"append":var oembedContainer=container.next();if(oembedContainer==null||!oembedContainer.hasClass("oembed-container")){oembedContainer=container.after('<div class="oembed-container"></div>').next(".oembed-container");if(oembedData!=null&&oembedData.provider_name!=null)
oembedContainer.toggleClass("oembed-container-"+oembedData.provider_name);}
oembedContainer.html(oembedData.code);break;}};jQuery.fn.oembed.getInsertCode=function(container,embedMethod,oembedData){if(oembedData==null)
return;return oembedData.code;};jQuery.fn.oembed.getPhotoCode=function(url,oembedData){var code,alt=oembedData.title?oembedData.title:'';alt+=oembedData.author_name?' - '+oembedData.author_name:'';alt+=oembedData.provider_name?' - '+oembedData.provider_name:'';code='<div><a href="'+url+'" target=\'_blank\'><img src="'+oembedData.url+'" alt="'+alt+'"/></a></div>';if(oembedData.html)
code+="<div>"+oembedData.html+"</div>";return code;};jQuery.fn.oembed.getVideoCode=function(url,oembedData){var code=oembedData.html;return code;};jQuery.fn.oembed.getRichCode=function(url,oembedData){var code=oembedData.html;return code;};jQuery.fn.oembed.getGenericCode=function(url,oembedData){var title=(oembedData.title!=null)?oembedData.title:url,code='<a href="'+url+'">'+title+'</a>';if(oembedData.html)
code+="<div>"+oembedData.html+"</div>";return code;};jQuery.fn.oembed.isProviderAvailable=function(url){var provider=getOEmbedProvider(url);return(provider!=null);};jQuery.fn.oembed.getOEmbedProvider=function(url){for(var i=0;i<activeProviders.length;i++){if(activeProviders[i].matches(url))
return activeProviders[i];}
return null;};jQuery.fn.oembed.OEmbedProvider=function(name,type,urlschemesarray,apiendpoint,callbackparameter){this.name=name;this.type=type;this.urlschemes=getUrlSchemes(urlschemesarray);this.apiendpoint=apiendpoint;this.callbackparameter=callbackparameter;this.maxWidth=500;this.maxHeight=400;var i,property,regExp;this.matches=function(externalUrl){for(i=0;i<this.urlschemes.length;i++){regExp=new RegExp(this.urlschemes[i],"i");if(externalUrl.match(regExp)!=null)
return true;}
return false;};this.fromJSON=function(json){for(property in json){if(property!="urlschemes")
this[property]=json[property];else
this[property]=getUrlSchemes(json[property]);}
return true;};function getUrlSchemes(urls){if(isNullOrEmpty(urls))
return["."];if(jQuery.isArray(urls))
return urls;return urls.split(";");}};jQuery.fn.oembed.providers=[new jQuery.fn.oembed.OEmbedProvider("youtube","video",["youtube\\.com/watch.+v=[\\w-]+&?"]),new jQuery.fn.oembed.OEmbedProvider("flickr","photo",["flickr\\.com/photos/[-.\\w@]+/\\d+/?"],"http://flickr.com/services/oembed","jsoncallback"),new jQuery.fn.oembed.OEmbedProvider("viddler","video",["viddler\.com"]),new jQuery.fn.oembed.OEmbedProvider("blip","video",["blip\\.tv/.+"],"http://blip.tv/oembed/"),new jQuery.fn.oembed.OEmbedProvider("hulu","video",["hulu\\.com/watch/.*"],"http://www.hulu.com/api/oembed.json"),new jQuery.fn.oembed.OEmbedProvider("vimeo","video",["http:\/\/www\.vimeo\.com\/groups\/.*\/videos\/.*","http:\/\/www\.vimeo\.com\/.*","http:\/\/vimeo\.com\/groups\/.*\/videos\/.*","http:\/\/vimeo\.com\/.*"],"http://vimeo.com/api/oembed.json"),new jQuery.fn.oembed.OEmbedProvider("dailymotion","video",["dailymotion\\.com/.+"]),new jQuery.fn.oembed.OEmbedProvider("scribd","rich",["scribd\\.com/.+"]),new jQuery.fn.oembed.OEmbedProvider("slideshare","rich",["slideshare\.net"],"http://www.slideshare.net/api/oembed/1"),new jQuery.fn.oembed.OEmbedProvider("photobucket","photo",["photobucket\\.com/(albums|groups)/.*"],"http://photobucket.com/oembed/")];var OEmbedContentHandler=ContentHandlerManager.createHandler({handleContent:function(content){if(typeof content==='string'){content=jQuery('<div>'+content+'</div>').get(0);}else if(content instanceof jQuery){content=jQuery('<div>').append(content).get(0);}
content=jQuery(content).oembed(jQuery(content).text(),{embedMethod:"replace"});var returnval=setTimeout(function(){content=jQuery.fn.oembed.embedCode;return jQuery('<div>').append(content).html();},500);},replaceoEmbedContent:function(content){}});return OEmbedContentHandler;});function Sanitize(){var i,e,options;options=arguments[0]||{};this.jQuery=arguments[1]||{};this.config={}
this.config.elements=options.elements?options.elements:[];this.config.attributes=options.attributes?options.attributes:{};this.config.attributes[Sanitize.ALL]=this.config.attributes[Sanitize.ALL]?this.config.attributes[Sanitize.ALL]:[];this.config.allow_comments=options.allow_comments?options.allow_comments:false;this.allowed_elements={};this.config.protocols=options.protocols?options.protocols:{};this.config.add_attributes=options.add_attributes?options.add_attributes:{};this.dom=options.dom?options.dom:document;for(i=0;i<this.config.elements.length;i++){this.allowed_elements[this.config.elements[i]]=true;}
this.config.remove_element_contents={};this.config.remove_all_contents=false;if(options.remove_contents){if(options.remove_contents instanceof Array){for(i=0;i<options.remove_contents.length;i++){this.config.remove_element_contents[options.remove_contents[i]]=true;}}
else{this.config.remove_all_contents=true;}}
this.transformers=options.transformers?options.transformers:[];this.filters=options.filters?options.filters:[];}
Sanitize.REGEX_PROTOCOL=/^([A-Za-z0-9\+\-\.\&\;\*\s]*?)(?:\:|&*0*58|&*x0*3a)/i
Sanitize.RELATIVE='__relative__';Sanitize.prototype.clean_node=function(container){var fragment=this.dom.createDocumentFragment();this.current_element=fragment;this.whitelist_nodes=[];function _array_index(needle,haystack){var i;for(i=0;i<haystack.length;i++){if(haystack[i]==needle)
return i;}
return-1;}
function _merge_arrays_uniq(){var result=[];var uniq_hash={}
var i,j;for(i=0;i<arguments.length;i++){if(!arguments[i]||!arguments[i].length)
continue;for(j=0;j<arguments[i].length;j++){if(uniq_hash[arguments[i][j]])
continue;uniq_hash[arguments[i][j]]=true;result.push(arguments[i][j]);}}
return result;}
function _clean(elem){var clone;for(var i=0;i<this.filters.length;i++){if(!this.filters[i](elem)){clone=elem.cloneNode(true);this.current_element.appendChild(clone);return;}}
switch(elem.nodeType){case 1:_clean_element.call(this,elem)
break;case 3:var clone=elem.cloneNode(false);this.current_element.appendChild(clone);break;case 5:var clone=elem.cloneNode(false);this.current_element.appendChild(clone);break;case 8:if(this.config.allow_comments){var clone=elem.cloneNode(false);this.current_element.appendChild(clone);}
default:}}
function _clean_element(elem){var i,j,clone,parent_element,name,allowed_attributes,attr,attr_name,attr_node,protocols,del,attr_ok;var transform=_transform_element.call(this,elem);var jQuery=this.jQuery;var isIE7=jQuery.browser.msie&&jQuery.browser.version==="7.0";elem=transform.node;name=elem.nodeName.toLowerCase();parent_element=this.current_element;if(this.allowed_elements[name]||transform.whitelist){this.current_element=this.dom.createElement(elem.nodeName);parent_element.appendChild(this.current_element);allowed_attributes=_merge_arrays_uniq(this.config.attributes[name],this.config.attributes['__ALL__'],transform.attr_whitelist);for(i=0;i<allowed_attributes.length;i++){attr_name=allowed_attributes[i];attr=elem.attributes[attr_name];if(attr){attr_ok=true;if(this.config.protocols[name]&&this.config.protocols[name][attr_name]){protocols=this.config.protocols[name][attr_name];del=attr.nodeValue.toLowerCase().match(Sanitize.REGEX_PROTOCOL);if(del){attr_ok=(_array_index(del[1],protocols)!=-1);}
else{attr_ok=(_array_index(Sanitize.RELATIVE,protocols)!=-1);}}
if(attr_ok){if(!isIE7||(isIE7&&"style"!==attr_name)){attr_node=document.createAttribute(attr_name);attr_node.value=attr.nodeValue;this.current_element.setAttributeNode(attr_node);}}}}
if(this.config.add_attributes[name]){for(attr_name in this.config.add_attributes[name]){if(!isIE7||(isIE7&&"style"!==attr_name)){attr_node=document.createAttribute(attr_name);attr_node.value=this.config.add_attributes[name][attr_name];this.current_element.setAttributeNode(attr_node);}}}}
else if(_array_index(elem,this.whitelist_nodes)!=-1){this.current_element=elem.cloneNode(true);while(this.current_element.childNodes.length>0){this.current_element.removeChild(this.current_element.firstChild);}
parent_element.appendChild(this.current_element);}
if(!this.config.remove_all_contents&&!this.config.remove_element_contents[name]){for(i=0;i<elem.childNodes.length;i++){_clean.call(this,elem.childNodes[i]);}}
if(this.current_element.normalize){this.current_element.normalize();}
this.current_element=parent_element;}
function _transform_element(node){var output={attr_whitelist:[],node:node,whitelist:false}
var i,j,transform;for(i=0;i<this.transformers.length;i++){transform=this.transformers[i]({allowed_elements:this.allowed_elements,config:this.config,node:node,node_name:node.nodeName.toLowerCase(),whitelist_nodes:this.whitelist_nodes,dom:this.dom});if(transform==null)
continue;else if(typeof transform=='object'){if(transform.whitelist_nodes&&transform.whitelist_nodes instanceof Array){for(j=0;j<transform.whitelist_nodes.length;j++){if(_array_index(transform.whitelist_nodes[j],this.whitelist_nodes)==-1){this.whitelist_nodes.push(transform.whitelist_nodes[j]);}}}
output.whitelist=transform.whitelist?true:false;if(transform.attr_whitelist){output.attr_whitelist=_merge_arrays_uniq(output.attr_whitelist,transform.attr_whitelist);}
output.node=transform.node?transform.node:output.node;}
else{throw new Error("transformer output must be an object or null");}}
return output;}
for(i=0;i<container.childNodes.length;i++){_clean.call(this,container.childNodes[i]);}
if(fragment.normalize){fragment.normalize();}
return fragment;};define("vendor/sanitize",function(){});define('contenthandler/sanitizecontenthandler',['aloha/core','jquery','aloha/contenthandlermanager','aloha/plugin','aloha/console','vendor/sanitize'],function(Aloha,jQuery,ContentHandlerManager,Plugin,console){var sanitize;if(!Aloha.defaults.sanitize){Aloha.defaults.sanitize={}}
Aloha.defaults.sanitize.restricted={elements:['b','em','i','strong','u','del','p','span','div','br']}
Aloha.defaults.sanitize.basic={elements:['a','abbr','b','blockquote','br','cite','code','dd','del','dl','dt','em','i','li','ol','p','pre','q','small','strike','strong','sub','sup','u','ul'],attributes:{'a':['href'],'blockquote':['cite'],'q':['cite'],'abbr':['title']},protocols:{'a':{'href':['ftp','http','https','mailto','__relative__']},'blockquote':{'cite':['http','https','__relative__']},'q':{'cite':['http','https','__relative__']}}}
Aloha.defaults.sanitize.relaxed={elements:['a','abbr','b','blockquote','br','caption','cite','code','col','colgroup','dd','del','dl','dt','em','h1','h2','h3','h4','h5','h6','i','img','li','ol','p','pre','q','small','strike','strong','sub','sup','table','tbody','td','tfoot','th','thead','tr','u','ul','span','hr','object','div'],attributes:{'a':['href','title','id','class','target','data-gentics-aloha-repository','data-gentics-aloha-object-id'],'div':['id','class','style'],'abbr':['title'],'blockquote':['cite'],'br':['class'],'col':['span','width'],'colgroup':['span','width'],'img':['align','alt','height','src','title','width','class','data-caption','data-align','data-width','data-original-image'],'ol':['start','type'],'p':['class','style','id'],'q':['cite'],'table':['summary','width'],'td':['abbr','axis','colspan','rowspan','width'],'th':['abbr','axis','colspan','rowspan','scope','width'],'ul':['type'],'span':['class','style','lang','xml:lang','role']},protocols:{'a':{'href':['ftp','http','https','mailto','__relative__']},'blockquote':{'cite':['http','https','__relative__']},'img':{'src':['http','https','__relative__']},'q':{'cite':['http','https','__relative__']}}}
function initSanitize(configAllows){var
filter=['restricted','basic','relaxed'],config=Aloha.defaults.supports;if(Aloha.settings.contentHandler.sanitize&&jQuery.inArray(Aloha.settings.contentHandler.sanitize,filter)>-1){config=Aloha.defaults.sanitize[Aloha.settings.contentHandler.sanitize];}else{config=Aloha.defaults.sanitize.relaxed;}
if(Aloha.settings.contentHandler.allows){config=Aloha.settings.contentHandler.allows;}
if(configAllows){config=configAllows;}
config.filters=[function(elem){return elem.contentEditable!="false";}];sanitize=new Sanitize(config,jQuery);}
var SanitizeContentHandler=ContentHandlerManager.createHandler({handleContent:function(content){var sanitizeConfig,contentHandlerConfig;if(Aloha.activeEditable&&Aloha.settings.contentHandler&&Aloha.settings.contentHandler.handler&&Aloha.settings.contentHandler.handler.sanitize){if(Aloha.settings.contentHandler.handler.sanitize){contentHandlerConfig=Aloha.settings.contentHandler.handler.sanitize;}
var containerId=contentHandlerConfig['#'+Aloha.activeEditable.getId()];if(typeof containerId!=='undefined'){sanitizeConfig=contentHandlerConfig;}else{var containerClasses=Aloha.activeEditable.obj.attr('class').split(' ');for(var i=0;i<containerClasses.length;i++){if(typeof contentHandlerConfig['.'+containerClasses[i]]!=='undefined'){sanitizeConfig=contentHandlerConfig['.'+containerClasses[i]];}}}}
if(typeof sanitize==='undefined'||typeof sanitizeConfig!=='undefined'){initSanitize(sanitizeConfig);}
if(typeof content==='string'){content=jQuery('<div>'+content+'</div>').get(0);}else if(content instanceof jQuery){content=jQuery('<div>').append(content).get(0);}
return jQuery('<div>').append(sanitize.clean_node(content)).html();}});return SanitizeContentHandler;});define('contenthandler/blockelementcontenthandler',['aloha','jquery','aloha/contenthandlermanager'],function(Aloha,jQuery,ContentHandlerManager){var IS_BLOCK={h1:true,h2:true,h3:true,h4:true,h5:true,h6:true,p:true,pre:true,blockquote:true,H1:true,H2:true,H3:true,H4:true,H5:true,H6:true,P:true,PRE:true,BLOCKQUOTE:true};var IS_BR={br:true,BR:true};var needsEndBr=function(block){return(IS_BLOCK[block.nodeName]&&!(block.lastChild&&IS_BR[block.lastChild.nodeName]));};var prepareEditing=function(index,element){var $element=jQuery(element);$element.filter('h1:empty,h2:empty,h3:empty,h4:empty,h5:empty,h6:empty,'
+'p:empty,pre:empty,blockquote:empty').remove();if(!jQuery.browser.msie){$element.filter('li').each(function(){if(needsEndBr(this)){jQuery(this).append('<br/>');}});}else{$element.filter('br.aloha-end-br').remove();}
$element.children(':not(.aloha-block)').each(prepareEditing);};var prepareEditingIE7=function(index,element){var $element=jQuery(element);$element.filter('h1:empty,h2:empty,h3:empty,h4:empty,h5:empty,h6:empty,'
+'p:empty,pre:empty,blockquote:empty').append('\u200b');$element.children(':not(.aloha-block)').each(prepareEditingIE7);};var propBlockElements=function(index,element){var $element=jQuery(element);if($element.filter('p,h1,h2,h3,h4,h5,h6,pre,blockquote').length>0){if(needsEndBr(element)){jQuery(element).append('<br/>');}}
$element.children(':not(.aloha-block)').each(propBlockElements);};var BlockElementContentHandler=ContentHandlerManager.createHandler({handleContent:function(content,options){if(typeof content==='string'){content=jQuery('<div>'+content+'</div>');}else if(content instanceof jQuery){content=jQuery('<div>').append(content);}
options=options||{};if(options.command==='initEditable'){content.children(':not(.aloha-block)').each(prepareEditing);if(jQuery.browser.msie&&jQuery.browser.version<=7){content.children(':not(.aloha-block)').each(prepareEditingIE7);}}else if(options.command==='getContents'){content.children(':not(.aloha-block)').each(propBlockElements);content.find('li>br:last').remove();}
return content.html();}});return BlockElementContentHandler;});define('contenthandler/contenthandler-plugin',['aloha','aloha/plugin','jquery','aloha/contenthandlermanager','contenthandler/wordcontenthandler','contenthandler/genericcontenthandler','contenthandler/oembedcontenthandler','contenthandler/sanitizecontenthandler','contenthandler/blockelementcontenthandler'],function(Aloha,Plugin,jQuery,ContentHandlerManager,WordContentHandler,GenericContentHandler,OembedContentHandler,SanitizeContentHandler,BlockelementContentHandler){var ContentHandlerPlugin=Plugin.create('contenthandler',{settings:{},dependencies:[],init:function(){var contentHandlers={'word':WordContentHandler,'generic':GenericContentHandler,'sanitize':SanitizeContentHandler,'blockelement':BlockelementContentHandler},handlerName;for(handlerName in contentHandlers){if(contentHandlers.hasOwnProperty(handlerName)){ContentHandlerManager.register(handlerName,contentHandlers[handlerName]);}}}});return ContentHandlerPlugin;});define('characterpicker/nls/i18n',{"root":{"button.addcharacter.tooltip":"pick special characters"},"ca":true,"de":true,"mk":true,"pt-br":true,"ru":true,"uk":true,"zh-hans":true});define('characterpicker/characterpicker-plugin',['aloha','jquery','aloha/plugin','ui/ui','ui/button','i18n!characterpicker/nls/i18n','i18n!aloha/nls/i18n'],function(Aloha,jQuery,Plugin,Ui,Button,i18n,i18nCore){var GENTICS=window.GENTICS;var overlayByConfig={};var _savedRange;function CharacterOverlay(onSelectCallback){var self=this;self.$node=jQuery('<table class="aloha-character-picker-overlay" unselectable="on" role="dialog"><tbody></tbody></table>');self.$node.mousedown(function(e){return false;});self.onSelectCallback=onSelectCallback;self.$tbody=self.$node.find('tbody');self.$node.appendTo(jQuery('body'));self._initHideOnDocumentClick();self._initHideOnEsc();self._initCursorFocus(onSelectCallback);self._initEvents();}
CharacterOverlay.prototype={show:function(insertButton){var self=this;self.$node.css(jQuery(insertButton).offset());self.$node.show();self.$node.find('.focused').removeClass('focused');jQuery(self.$node.find('td')[0]).addClass('focused');self._overlayActive=true;},hide:function(){this.$node.hide();this._overlayActive=false;},setCharacters:function(characters){this._createCharacterButtons(characters);},_initHideOnDocumentClick:function(){var self=this;self.$node.click(function(e){e.stopPropagation();});var buttonSelector='.aloha-icon-characterpicker';jQuery('body').click(function(e){if(!self._overlayActive){return;}
if(e.target!==self.$node[0]&&!jQuery(e.target).is(buttonSelector)&&!jQuery(e.target).find(buttonSelector).length){self.hide();}});},_initHideOnEsc:function(){var self=this;jQuery(document).keyup(function(e){var overlayVisibleAndEscapeKeyPressed=(self.$node.css('display')==='table')&&(e.keyCode===27);if(overlayVisibleAndEscapeKeyPressed){self.hide();}});},_initCursorFocus:function(onSelectCallback){var self=this;var $current,$next,$prev,$nextRow,$prevRow;var movements={13:function select(){$current=self.$node.find('.focused');self.hide();onSelectCallback($current.text());},37:function left(){$current=self.$node.find('.focused');$prev=$current.prev().addClass('focused');if($prev.length>0){$current.removeClass('focused');}},38:function up(){$current=self.$node.find('.focused');$prevRow=$current.parent().prev();if($prevRow.length>0){$prev=jQuery($prevRow.children()[$current.index()]).addClass('focused');if($prev.length>0){$current.removeClass('focused');}}},39:function right(){$current=self.$node.find('.focused');$next=$current.next().addClass('focused');if($next.length>0){$current.removeClass('focused');}},40:function down(){$current=self.$node.find('.focused');$nextRow=$current.parent().next();if($nextRow.length>0){$next=jQuery($nextRow.children()[$current.index()]).addClass('focused');if($next.length>0){$current.removeClass('focused');}}}};jQuery(document).keydown(function(e){e.stopPropagation();var isOverlayVisible=self.$node.css('display')==='table';if(isOverlayVisible){var moveCommand=movements[e.keyCode];if(moveCommand){moveCommand();return false;}}});},_initEvents:function(){var self=this;Aloha.bind('aloha-editable-deactivated',function(event,rangeObject){self.hide();});},_createCharacterButtons:function(characters){var self=this;var textarea=document.createElement('textarea');textarea.innerHTML=characters;characters=textarea.value;var characterList=jQuery.grep(characters.split(' '),function filterOutEmptyOnces(e){return e!=='';});var charTable=['<tr>'];var i=0;var chr;while((chr=characterList[i])){if(0!==i&&((i%15)===0)){charTable.push('</tr><tr>');}
charTable.push('<td unselectable="on">'+chr+'</td>');i++;}
charTable.push('</tr>');self.$tbody.empty().append(charTable.join(''));self.$node.delegate('td','mouseover',function(){jQuery(this).addClass('mouseover');}).delegate('td','mouseout',function(){jQuery(this).removeClass('mouseover');}).delegate('td','click',function(e){self.$node.hide();var character=jQuery(this).text();self.onSelectCallback(character);});}};return Plugin.create('characterpicker',{_constructor:function(){this._super('characterpicker');},config:'&#38; &#34; &#162; &#8364; &#163; &#165; &#169; &#174; &#8482; &#8240; &#181; &#183; &#8226; &#8230; &#8242; &#8243; &#167; &#182; &#223; &#8249; &#8250; &#171; &#187; &#8216; &#8217; &#8220; &#8221; &#8218; &#8222; &#60; &#62; &#8804; &#8805; &#8211; &#8212; &#175; &#8254; &#164; &#166; &#168; &#161; &#191; &#710; &#732; &#176; &#8722; &#177; &#247; &#8260; &#215; &#185; &#178; &#179; &#188; &#189; &#190; &#402; &#8747; &#8721; &#8734; &#8730; &#8764; &#8773; &#8776; &#8800; &#8801; &#8712; &#8713; &#8715; &#8719; &#8743; &#8744; &#172; &#8745; &#8746; &#8706; &#8704; &#8707; &#8709; &#8711; &#8727; &#8733; &#8736; &#180; &#184; &#170; &#186; &#8224; &#8225; &#192; &#193; &#194; &#195; &#196; &#197; &#198; &#199; &#200; &#201; &#202; &#203; &#204; &#205; &#206; &#207; &#208; &#209; &#210; &#211; &#212; &#213; &#214; &#216; &#338; &#352; &#217; &#218; &#219; &#220; &#221; &#376; &#222; &#224; &#225; &#226; &#227; &#228; &#229; &#230; &#231; &#232; &#233; &#234; &#235; &#236; &#237; &#238; &#239; &#240; &#241; &#242; &#243; &#244; &#245; &#246; &#248; &#339; &#353; &#249; &#250; &#251; &#252; &#253; &#254; &#255; &#913; &#914; &#915; &#916; &#917; &#918; &#919; &#920; &#921; &#922; &#923; &#924; &#925; &#926; &#927; &#928; &#929; &#931; &#932; &#933; &#934; &#935; &#936; &#937; &#945; &#946; &#947; &#948; &#949; &#950; &#951; &#952; &#953; &#954; &#955; &#956; &#957; &#958; &#959; &#960; &#961; &#962; &#963; &#964; &#965; &#966; &#967; &#968; &#969; &#8501; &#982; &#8476; &#977; &#978; &#8472; &#8465; &#8592; &#8593; &#8594; &#8595; &#8596; &#8629; &#8656; &#8657; &#8658; &#8659; &#8660; &#8756; &#8834; &#8835; &#8836; &#8838; &#8839; &#8853; &#8855; &#8869; &#8901; &#8968; &#8969; &#8970; &#8971; &#9001; &#9002; &#9674; &#9824; &#9827; &#9829; &#9830;',init:function(){var self=this;if(typeof Aloha.settings.plugins!='undefined'&&typeof Aloha.settings.plugins.characterpicker!='undefined'){self.settings=Aloha.settings.plugins.characterpicker;}
this._characterPickerButton=Ui.adopt("characterPicker",Button,{tooltip:i18n.t('button.addcharacter.tooltip'),icon:"aloha-icon-characterpicker",scope:'Aloha.continuoustext',click:function(){if(false!==self.characterOverlay){_savedRange=Aloha.Selection.rangeObject;self.characterOverlay.show(this.element);}}});setTimeout(function(){initCache(0);},100);function initCache(i){if(i<Aloha.editables.length){self.getOverlayForEditable(Aloha.editables[i]);setTimeout(function(){initCache(i+1);},100);}}
Aloha.bind('aloha-editable-activated',function(event,data){self.characterOverlay=self.getOverlayForEditable(data.editable);if(self.characterOverlay){self._characterPickerButton.show();}else{self._characterPickerButton.hide();}});},getOverlayForEditable:function(editable){var that=this;var config=this.getEditableConfig(editable.obj),overlay;if(!config){return false;}
if(jQuery.isArray(config)){config=config.join(' ');}
overlay=overlayByConfig[config];if(!overlay){overlay=new CharacterOverlay(onCharacterSelect);overlay.setCharacters(config);overlayByConfig[config]=overlay;}
return overlay;}});function onCharacterSelect(character){if(Aloha.activeEditable){_savedRange.select();Aloha.execCommand('insertHTML',false,character);}}});define('commands/inserthtml',['aloha/core','jquery','aloha/command','aloha/selection','util/dom','aloha/contenthandlermanager','aloha/console'],function(Aloha,jQuery,command,selection,dom,ContentHandlerManager,console){command.register('inserthtml',{action:function(value,range){var
$editable=jQuery(dom.getEditingHostOf(range.startContainer)),cac=range.commonAncestorContainer,i,selectedRange,domNodes=[];function pasteElement(object){var $object=jQuery(object),contents;if(!dom.insertIntoDOM($object,range,$editable,false)){contents=$object.contents();if(dom.isBlockLevelElement(object)||dom.isListElement(object)){pasteElement(jQuery('<br/>').get(0));}
for(i=contents.length-1;i>=0;--i){pasteElement(contents[i]);}}};value=ContentHandlerManager.handleContent(value,{contenthandler:Aloha.settings.contentHandler.insertHtml});if(typeof value==='string'){value=jQuery('<div>'+value+'</div>');}else if(value instanceof jQuery){value=jQuery('<div>').append(value);}else{throw"INVALID_VALUE_ERR";}
domNodes=value.contents();dom.removeRange(range);for(i=domNodes.length-1;i>=0;--i){pasteElement(domNodes[i]);}
if(domNodes.length>0){range=dom.setCursorAfter(domNodes.get(domNodes.length-1));}else{range.select();}
dom.doCleanup({merge:true,removeempty:true},range,cac);try{range.select();}catch(e){console.warn('Error:',e);}}});});define('commands/commands-plugin',['aloha/command','./inserthtml'],function(command,commands){});define('block/blockmanager',['aloha','jquery','ui/scopes','aloha/observable','aloha/registry','util/class','util/strings','util/maps'],function(Aloha,jQuery,Scopes,Observable,Registry,Class,Strings,Maps){var
GENTICS=window.GENTICS;var BlockManager=new(Class.extend(Observable,{defaults:{'aloha-block-type':'DefaultBlock'},blockTypes:null,blocks:null,_highlightedBlocks:null,_activeBlock:null,_dragdropEnabled:true,_constructor:function(){Scopes.createScope('Aloha.Block');this.blockTypes=new Registry();this.blocks=new Registry();this._highlightedBlocks={};},registerEventHandlers:function(){var that=this;this._registerEventHandlersForDeactivatingAlohaBlock();this._registerEventHandlersForDeterminingCurrentlyActiveBlock();this._registerEventHandlersForBlockDeletion();this._registerEventHandlersForCutCopyPaste();Aloha.bind('aloha-selection-changed',function(evt,selection,originalEvent){if(selection&&jQuery(selection.getCommonAncestorContainer()).parents('.aloha-block').length>0){return;}
that._deactivateHighlightedBlocks();});},_registerEventHandlersForDeactivatingAlohaBlock:function(){var that=this;jQuery(document).bind('click',function(event){if(Maps.isEmpty(that._highlightedBlocks)){return;}
if(jQuery(event.target).closest('.aloha-ui,.aloha-block-do-not-deactivate,.aloha-block').length>0){return;}
that._deactivateHighlightedBlocks();});},_registerEventHandlersForDeterminingCurrentlyActiveBlock:function(){var that=this;this.bind('block-selection-change',function(highlightedBlocks){if(highlightedBlocks.length>0){that._activeBlock=highlightedBlocks[0];}else{that._activeBlock=null;}});},_registerEventHandlersForBlockDeletion:function(){var that=this;Aloha.bind('aloha-command-will-execute',function(e,data){var commandId=data.commandId;var onlyBlockSelected=(Aloha.getSelection().getRangeCount()===0)||(Aloha.getSelection().getRangeCount()===1&&Aloha.getSelection().getRangeAt(0).endContainer===Aloha.getSelection().getRangeAt(0).startContainer&&Aloha.getSelection().getRangeAt(0).endContainer===jQuery('body')[0])||(Aloha.getSelection().getRangeCount()===1&&Aloha.getSelection().getRangeAt(0).endContainer===Aloha.getSelection().getRangeAt(0).startContainer&&Aloha.getSelection().getRangeAt(0).startOffset+1===Aloha.getSelection().getRangeAt(0).endOffset);if(that._activeBlock&&(commandId==='delete'||commandId==='forwarddelete')&&onlyBlockSelected){data.preventDefault=true;that._activeBlock.destroy();}else if(!that._activeBlock&&(commandId==='delete'||commandId==='forwarddelete')&&Aloha.getSelection().getRangeCount()===1&&Aloha.getSelection().getRangeAt(0).collapsed===false){var traverseSelectionTree;traverseSelectionTree=function(selectionTree){var el;for(var i=0,l=selectionTree.length;i<l;i++){el=selectionTree[i];if(el.domobj.nodeType===1){var $el=jQuery(el.domobj);if(el.selection==='full'&&$el.is('.aloha-block')){$el.remove();}else{traverseSelectionTree(el.children);}}}};traverseSelectionTree(Aloha.Selection.getSelectionTree());}});jQuery(window.document).keydown(function(e){if(typeof e.srcElement!=='undefined'&&typeof e.srcElement.form!=='undefined'){return true;}
if(that._activeBlock&&(e.which===46||e.which===8)&&that._activeBlock._isInsideNestedEditable===false){if(jQuery.browser.msie&&parseInt(jQuery.browser.version,10)<=8&&that._activeBlock.$element.parents('.aloha-editable,.aloha-block').first().hasClass('aloha-editable')){that._activeBlock.destroy();e.preventDefault();return false;}else if(that._activeBlock.shouldDestroy()){that._activeBlock.destroy();e.preventDefault();return false;}}});},_registerEventHandlersForCutCopyPaste:function(){var that=this,currentlyCopying=false,currentlyCutting=false,selectionBeforeCopying=null;jQuery(window.document).keydown(function(e){if(that._activeBlock&&(e.ctrlKey||e.metaKey)&&e.which===67){currentlyCopying=true;that._activeBlock.$element.attr('data-aloha-block-copy-only-block','true');GENTICS.Utils.Dom.selectDomNode(that._activeBlock.$element[0]);}
if(that._activeBlock&&(e.ctrlKey||e.metaKey)&&e.which===88){currentlyCutting=true;that._activeBlock.$element.attr('data-aloha-block-copy-only-block','true');GENTICS.Utils.Dom.selectDomNode(that._activeBlock.$element[0]);}});jQuery(window.document).keyup(function(e){if(!currentlyCutting&&currentlyCopying&&(e.which===67||e.which===18||e.which===91)){currentlyCopying=false;that._activeBlock.$element.removeAttr('data-aloha-block-copy-only-block');if(selectionBeforeCopying){selectionBeforeCopying=null;}}
if(currentlyCutting&&(e.which===67||e.which===18||e.which===88)){currentlyCutting=false;}});},initializeBlockLevelDragDrop:function(){var that=this;jQuery.each(Aloha.editables,function(i,editable){editable.obj.data("block-dragdrop",that._dragdropEnabled);that.createBlockLevelSortableForEditableOrBlockCollection(editable.obj);});Aloha.bind('aloha-editable-created',function(e,editable){editable.obj.data("block-dragdrop",that._dragdropEnabled);that.createBlockLevelSortableForEditableOrBlockCollection(editable.obj);});},createBlockLevelSortableForEditableOrBlockCollection:function($editableOrBlockCollection){var that=this;if(!$editableOrBlockCollection.hasClass('aloha-block-blocklevel-sortable')){$editableOrBlockCollection.addClass("aloha-block-blocklevel-sortable").sortable({revert:100,handle:".aloha-block-draghandle-blocklevel",connectWith:".aloha-block-blocklevel-sortable.aloha-block-dropzone",disabled:!that._dragdropEnabled,start:function(event,ui){ui.item.data("block-sort-allowed",(ui.item.parents(".aloha-block-dropzone").length>0));},change:function(event,ui){ui.item.data("block-sort-allowed",(ui.placeholder.parents(".aloha-block-dropzone").length>0));},stop:function(event,ui){if(!ui.item.data("block-sort-allowed")){jQuery(this).sortable("cancel");}
ui.item.removeData("block-sort-allowed");}});$editableOrBlockCollection.get(0).ondragstart=function(e,ui){if(!ui||!ui.helper||!ui.helper.is('.aloha-block')){return false;}};}},setDragDropState:function(state){this._dragdropEnabled=state;},getDragDropState:function(){return this._dragdropEnabled;},registerBlockType:function(identifier,blockType){Scopes.createScope('Aloha.Block.'+identifier,'Aloha.Block');this.blockTypes.register(identifier,blockType);},_blockify:function(element,instanceDefaults){var that=this,$element=jQuery(element),BlockPlugin=Aloha.require('block/block-plugin'),tagName=$element[0].tagName.toLowerCase(),attributes,block;if(jQuery.inArray(tagName,BlockPlugin.settings.rootTags)===-1){Aloha.Log.error('block/blockmanager','Blocks can only be created from ['+
BlockPlugin.settings.rootTags.join(', ')+'] element. You passed '+tagName+'.');return;}
attributes=this.getConfig($element,instanceDefaults);if(!this.blockTypes.has(attributes['aloha-block-type'])){Aloha.Log.error('block/blockmanager','Block Type '+attributes['aloha-block-type']+' not found!');return;}
block=new(this.blockTypes.get(attributes['aloha-block-type']))($element,attributes);block.$element.addClass('aloha-block-'+attributes['aloha-block-type']);this.blocks.register(block.getId(),block);},_unblockify:function(element){var block=this.getBlock(element);if(block){block.unblock();}},getConfig:function(blockElement,instanceDefaults){var clone=blockElement.clone(true);var dataCamelCase=clone.data();var data={};clone.removeData();for(var key in dataCamelCase){if(dataCamelCase.hasOwnProperty(key)){data[Strings.camelCaseToDashes(key)]=dataCamelCase[key];}}
return jQuery.extend({},this.defaults,instanceDefaults,data);},getBlock:function(idOrDomNode){var id,domNode;if(typeof idOrDomNode==='object'){domNode=jQuery(idOrDomNode);if(domNode.hasClass('aloha-block-inner')){domNode=domNode.parent();}
id=domNode.attr('id');}else{id=idOrDomNode;}
return this.blocks.get(id);},_unregisterBlock:function(blockOrBlockId){var id;if(typeof blockOrBlockId==='object'){id=blockOrBlockId.getId();}else{id=blockOrBlockId;}
this.blocks.unregister(id);},_deactivateHighlightedBlocks:function(){jQuery.each(jQuery.extend({},this._highlightedBlocks),function(id){var block=BlockManager.getBlock(id);if(block){block.deactivate();}});},_getHighlightedBlocks:function(){var _highlightedBlocks={};jQuery.each(this.blocks.getEntries(),function(blockId,block){if(block.isActive()){_highlightedBlocks[blockId]=block;}});return _highlightedBlocks;},_setHighlighted:function(block){this._highlightedBlocks[block.id]=true;},_setUnhighlighted:function(block){delete this._highlightedBlocks[block.id];}}))();Aloha.Block=Aloha.Block||{};Aloha.Block.BlockManager=BlockManager;return BlockManager;});define('block/editormanager',['aloha/registry'],function(Registry){return new(Registry.extend({createEditor:function(definition){if(!this.has(definition.type)){throw'Editor for type "'+definition.type+'" not found.';}
var Editor=this.get(definition.type);return new Editor(definition);}}))();});define('block/sidebarattributeeditor',['jquery','block/blockmanager','aloha/sidebar','block/editormanager','util/class'],function(jQuery,BlockManager,Sidebar,EditorManager,Class){return new(Class.extend({_sidebar:null,init:function(){this._sidebar=Sidebar.right.show();BlockManager.bind('block-selection-change',this._onBlockSelectionChange,this);},_onBlockSelectionChange:function(selectedBlocks){var that=this;if(!this._sidebar){return;}
jQuery.each(selectedBlocks,function(){var schema=this.getSchema(),block=this,editors=[];if(!schema){return;}
that._sidebar.addPanel({title:block.getTitle(),expanded:true,onInit:function(){var $form=jQuery('<form />');$form.submit(function(){return false;});jQuery.each(schema,function(attributeName,definition){var editor=EditorManager.createEditor(definition);editor.bind('change',function(value){block.attr(attributeName,value);});block.bind('change',function(){editor.setValue(block.attr(attributeName));})
$form.append(editor.render());editor.setValue(block.attr(attributeName));editors.push(editor);});this.setContent($form);},deactivate:function(){jQuery.each(editors,function(index,editor){editor._deactivate();});this.isActive=false;this.effectiveElement=null;}});});}}))();});define('block/block',['aloha','jquery','block/blockmanager','aloha/observable','ui/scopes','util/class','PubSub'],function(Aloha,jQuery,BlockManager,Observable,Scopes,Class,PubSub){var GENTICS=window.GENTICS;var AbstractBlock=Class.extend(Observable,{title:null,id:null,$element:null,_currentlyRendering:false,_initialized:false,_isInsideNestedEditable:false,_constructor:function($element,attributes){var that=this;this.$element=$element;if($element.attr('id')){this.id=$element.attr('id');}else{this.id=GENTICS.Utils.guid();$element.attr('id',this.id);}
$element.contentEditable(false);$element.addClass('aloha-block');if(this.isDraggable()){$element.find('img').attr('draggable','false');$element.find('a').attr('draggable','false');}
jQuery.each(attributes,function(k,v){that._setAttribute(k,v);});this._onElementClickHandler=function(event){if(jQuery(event.target).closest('.aloha-block').get(0)===that.$element.get(0)){that._fixScrollPositionBugsInIE();that.activate(event.target,event);}};this._connectThisBlockToDomElement($element,function(){PubSub.pub('aloha.block.initialized',{block:that});});this._initialized=true;},_onElementClickHandler:null,_preventSelectionChangedEventHandler:function($event){if(('dblclick'!==$event.type)&&!jQuery($event.target).is('.aloha-editable')){Aloha.Selection.preventSelectionChanged();}},_connectThisBlockToDomElement:function(newElement,callback){var that=this;var $newElement=jQuery(newElement);this._disconnectFromDomElement();this.$element=$newElement;this.$element.bind('click',this._onElementClickHandler);this.$element.bind('mousedown',this._preventSelectionChangedEventHandler);this.$element.bind('focus',this._preventSelectionChangedEventHandler);this.$element.bind('dblclick',this._preventSelectionChangedEventHandler);this.init(this.$element,function(){window.setTimeout(function(){that._postProcessElementIfNeeded();if(callback){callback();}},5);});},_disconnectFromDomElement:function(){if(this.$element){this.$element.unbind('click',this._onElementClickHandler);this.$element.unbind('mousedown',this._preventSelectionChangedEventHandler);this.$element.unbind('focus',this._preventSelectionChangedEventHandler);this.$element.unbind('dblclick',this._preventSelectionChangedEventHandler);}},_fixScrollPositionBugsInIE:function(){var scrollPositionBefore=jQuery(window).scrollTop();window.setTimeout(function(){if(jQuery(window).scrollTop()!==scrollPositionBefore){jQuery(window).scrollTop(scrollPositionBefore);}},10);},init:function($element,postProcessFn){postProcessFn();},shouldDestroy:function(){var $closest=this.$element.parent().closest('.aloha-block,.aloha-editable,.aloha-block-collection');if($closest.hasClass('aloha-block-collection')&&this.$element[0].tagName.toLowerCase()==='div'){return true;}else{return $closest.hasClass('aloha-editable');}},destroy:function(force){if(!this.shouldDestroy()&&force!==true)return;var that=this;var newRange=new GENTICS.Utils.RangeObject();newRange.startContainer=newRange.endContainer=this.$element.parent()[0];newRange.startOffset=newRange.endOffset=GENTICS.Utils.Dom.getIndexInParent(this.$element[0]);BlockManager.trigger('block-delete',this);this.free();var isInlineElement=this.$element[0].tagName.toLowerCase()==='span';this.$element.fadeOut('fast',function(){that.$element.remove();BlockManager.trigger('block-selection-change',[]);window.setTimeout(function(){if(isInlineElement){newRange.select();}},5);});},unblock:function(){this.deactivate();this._disconnectFromDomElement();this.$element.removeClass('aloha-block');this.$element.children('.aloha-block-handle').remove();this.free();},free:function(){BlockManager._unregisterBlock(this);this.unbindAll();},getId:function(){return this.id;},getSchema:function(){return null;},getTitle:function(){return this.title;},isDraggable:function(){if(this.$element[0].tagName.toLowerCase()==='div'&&this.$element.parents('.aloha-editable,.aloha-block,.aloha-block-collection').first().hasClass('aloha-block-collection')){return true;}
return this.$element.parents('.aloha-editable,.aloha-block').first().hasClass('aloha-editable');},activate:function(eventTarget,event){var highlightedBlocks=[];jQuery.each(BlockManager._getHighlightedBlocks(),function(){this.deactivate();});if(this.$element.attr('data-block-skip-scope')!=='true'){Scopes.setScope('Aloha.Block.'+this.attr('aloha-block-type'));}
this.$element.addClass('aloha-block-active');this._highlight();highlightedBlocks.push(this);this.$element.parents('.aloha-block').each(function(){var block=BlockManager.getBlock(this);if(block){block._highlight();highlightedBlocks.push(block);}});if(jQuery(eventTarget).closest('.aloha-editable,.aloha-block,.aloha-table-cell-editable').first().hasClass('aloha-block')){this._isInsideNestedEditable=false;Aloha.getSelection().removeAllRanges();}else{this._isInsideNestedEditable=true;if(event){Aloha.Selection.updateSelection(event);}}
BlockManager.trigger('block-activate',highlightedBlocks);BlockManager.trigger('block-selection-change',highlightedBlocks);},deactivate:function(){var that=this;var deactivatedBlocks=[this];this._unhighlight();this.$element.parents('.aloha-block').each(function(){deactivatedBlocks.push(this);that._unhighlight();});this.$element.removeClass('aloha-block-active');BlockManager.trigger('block-deactivate',deactivatedBlocks);BlockManager.trigger('block-selection-change',[]);},isActive:function(){return this.$element.hasClass('aloha-block-active');},_highlight:function(){this.$element.addClass('aloha-block-highlighted');BlockManager._setHighlighted(this);},_unhighlight:function(){this.$element.removeClass('aloha-block-highlighted');BlockManager._setUnhighlighted(this);},_update:function(){var that=this;if(this._currentlyRendering)return;if(!this._initialized)return;this._currentlyRendering=true;this.update(this.$element,function(){that._postProcessElementIfNeeded();});this._currentlyRendering=false;},update:function($element,postProcessFn){postProcessFn();},_postProcessElementIfNeeded:function(){this.createEditablesIfNeeded();this._checkThatNestedBlocksAreStillConsistent();this._makeNestedBlockCollectionsSortable();this.renderBlockHandlesIfNeeded();if(this.isDraggable()&&this.$element[0].tagName.toLowerCase()==='span'){this._setupDragDropForInlineElements();this._disableUglyInternetExplorerDragHandles();}else if(this.isDraggable()&&this.$element[0].tagName.toLowerCase()==='div'){this._setupDragDropForBlockElements();this._disableUglyInternetExplorerDragHandles();}
this._hideDragHandlesIfDragDropDisabled();this._attachDropzoneHighlightEvents();},_checkThatNestedBlocksAreStillConsistent:function(){this.$element.find('.aloha-block').each(function(){var block=BlockManager.getBlock(this);if(block&&block.$element[0]!==this){block._connectThisBlockToDomElement(this);}});},_makeNestedBlockCollectionsSortable:function(){var that=this;this.$element.find('.aloha-block-collection').each(function(){var $blockCollection=jQuery(this);if($blockCollection.closest('.aloha-block').get(0)===that.$element.get(0)){BlockManager.createBlockLevelSortableForEditableOrBlockCollection($blockCollection);}})},_disableUglyInternetExplorerDragHandles:function(){if(jQuery.browser.msie){this.$element.get(0).onresizestart=function(e){return false;};this.$element.get(0).oncontrolselect=function(e){return false;};this.$element.get(0).onmovestart=function(e){return false;};}},_hideDragHandlesIfDragDropDisabled:function(){if(!this._dd_isDragdropEnabled()){this.$element.find('.aloha-block-draghandle').each(function(){var $draghandle=jQuery(this);if(!isDragdropEnabledForElement($draghandle)){$draghandle.removeClass('aloha-block-draghandle');}});}},_attachDropzoneHighlightEvents:function(){var that=this;this.$element.delegate(".aloha-block-draghandle","mousedown",function(){var dropzones=that.$element.parents(".aloha-editable").first().data("block-dropzones")||[];jQuery.each(dropzones,function(i,editable_selector){var editables=jQuery(editable_selector);jQuery(editables).each(function(){if(jQuery(this).data("block-dragdrop")){jQuery(this).addClass("aloha-block-dropzone");}});});jQuery(document).one("mouseup.aloha-block-dropzone",function(e){var dropzones=that.$element.parents(".aloha-editable").first().data("block-dropzones")||[];jQuery.each(dropzones,function(i,editable_selector){jQuery(editable_selector).removeClass("aloha-block-dropzone");});});});},_setupDragDropForInlineElements:function(){var that=this;var lastHoveredCharacter=null;var blockDroppedProperly=false;var $currentDraggable=null;var $createdDroppables=null;var dropFn=function(){if(lastHoveredCharacter){var $dropReferenceNode=jQuery(lastHoveredCharacter);if($dropReferenceNode.is('.aloha-block-dropInlineElementIntoEmptyBlock')){$dropReferenceNode.children().remove();$dropReferenceNode.append($currentDraggable);}else if($dropReferenceNode.is('.aloha-block-droppable-right')){$dropReferenceNode.html($dropReferenceNode.html()+' ');$dropReferenceNode.after($currentDraggable);}else{if($dropReferenceNode.prev('[data-i]').length>0){$dropReferenceNode.prev('[data-i]').html($dropReferenceNode.prev('[data-i]').html()+' ');}
$dropReferenceNode.html(' '+$dropReferenceNode.html());$dropReferenceNode.before($currentDraggable);}
$currentDraggable.removeClass('ui-draggable').css({'left':0,'top':0});that._fixScrollPositionBugsInIE();}
jQuery('.aloha-block-dropInlineElementIntoEmptyBlock').removeClass('aloha-block-dropInlineElementIntoEmptyBlock');$createdDroppables.droppable("destroy");$createdDroppables=null;blockDroppedProperly=true;};var editablesWhichNeedToBeCleaned=[];this.$element.draggable({handle:'.aloha-block-draghandle',scope:'aloha-block-inlinedragdrop',disabled:!this._dd_isDragdropEnabled(),revert:function(){return(lastHoveredCharacter===null||!blockDroppedProperly);},revertDuration:250,stop:function(){if(jQuery.browser.msie&&7===parseInt(jQuery.browser.version,10)){dropFn();}
jQuery.each(editablesWhichNeedToBeCleaned,function(){that._dd_traverseDomTreeAndRemoveSpans(this);});$currentDraggable=null;editablesWhichNeedToBeCleaned=[];},start:function(){blockDroppedProperly=false;editablesWhichNeedToBeCleaned=[];jQuery('.aloha-editable').children('p:empty').html('&nbsp;');var droppableCfg={tolerance:'pointer',addClasses:false,scope:'aloha-block-inlinedragdrop',over:function(event,ui){if(jQuery.inArray(this,editablesWhichNeedToBeCleaned)===-1){editablesWhichNeedToBeCleaned.push(this);}
var hasOnlyProppingBr=(1===jQuery(this).contents().length&&1===jQuery(this).children('br').length);$currentDraggable=ui.draggable;if(jQuery(this).is(':empty')||hasOnlyProppingBr||jQuery(this).html()==='&nbsp;'){jQuery(this).addClass('aloha-block-dropInlineElementIntoEmptyBlock');lastHoveredCharacter=this;return;}
that._dd_traverseDomTreeAndWrapCharactersWithSpans(this);jQuery('span[data-i]',this).droppable({tolerance:'pointer',addClasses:false,scope:'aloha-block-inlinedragdrop',over:function(){if(lastHoveredCharacter){jQuery(lastHoveredCharacter).removeClass('aloha-block-droppable');}
lastHoveredCharacter=this;jQuery(this).addClass('aloha-block-droppable');},out:function(){jQuery(this).removeClass('aloha-block-droppable');if(lastHoveredCharacter===this){lastHoveredCharacter=null;}}});jQuery.ui.ddmanager.prepareOffsets(ui.draggable.data('draggable'),event);},out:function(){jQuery(this).removeClass('aloha-block-dropInlineElementIntoEmptyBlock');},drop:function(){if(!(jQuery.browser.msie&&7===parseInt(jQuery.browser.version,10))){dropFn();}}};$createdDroppables=jQuery(".aloha-editable.aloha-block-dropzone").children(":not(.aloha-block)");$createdDroppables.droppable(droppableCfg);jQuery('.aloha-table-cell-editable').droppable(droppableCfg);}});},_dd_traverseDomTreeAndWrapCharactersWithSpans:function(el){var child;for(var i=0,l=el.childNodes.length;i<l;i++){child=el.childNodes[i];if(child.nodeType===1){if(!~child.className.indexOf('aloha-block')&&child.attributes['data-i']===undefined){this._dd_traverseDomTreeAndWrapCharactersWithSpans(child);}else if(child.attributes['data-i']){return;}}else if(child.nodeType===3){var numberOfSpansInserted=this._dd_insertSpans(child);i+=numberOfSpansInserted;l+=numberOfSpansInserted;}}},_dd_splitText:function(text){var textParts=text.split(/(?=\b)/);var cleanedTextParts=[];var isWhitespace=false;for(var i=0,l=textParts.length;i<l;i++){if(!/[^\t\n\r ]/.test(textParts[i])){isWhitespace=true;}else{if(isWhitespace){cleanedTextParts.push(' '+textParts[i]);isWhitespace=false;}else{cleanedTextParts.push(textParts[i]);}}}
if(isWhitespace){cleanedTextParts[cleanedTextParts.length-1]+=' ';}
return cleanedTextParts;},_dd_insertSpans:function(el){var text=el.nodeValue;if(!/[^\t\n\r ]/.test(text)){return 0;}
var newNodes=document.createDocumentFragment();var splitText=this._dd_splitText(text);var l=splitText.length;var x,word,leftWordPartLength,t;var numberOfSpansInserted=0;for(var i=0;i<l;i++){word=splitText[i];if(word.length===0)continue;leftWordPartLength=Math.floor(word.length/2);var browserMajorVersion=parseInt(jQuery.browser.version,10);if(jQuery.browser.msie&&(7===browserMajorVersion||8===browserMajorVersion)){leftWordPartLength=0;}
if(leftWordPartLength>0){x=document.createElement('span');x.appendChild(document.createTextNode(word.substr(0,leftWordPartLength)));x.setAttribute('data-i',i);newNodes.appendChild(x);numberOfSpansInserted++;}
x=document.createElement('span');t=word.substr(leftWordPartLength);x.appendChild(document.createTextNode(t));x.setAttribute('data-i',i);x.setAttribute('class','aloha-block-droppable-right');newNodes.appendChild(x);numberOfSpansInserted++;}
el.parentNode.replaceChild(newNodes,el);return numberOfSpansInserted-1;},_dd_traverseDomTreeAndRemoveSpans:function(el){var nodesToDelete=[],convertBack;convertBack=function(el){var currentlyTraversingExpandedText=false,currentText,lastNode;var child;for(var i=0,l=el.childNodes.length;i<l;i++){child=el.childNodes[i];if(child.nodeType===1){if(child.attributes['data-i']!==undefined){if(!currentlyTraversingExpandedText){currentlyTraversingExpandedText=true;currentText='';lastNode=undefined;}
if(currentlyTraversingExpandedText){currentText+=child.firstChild.nodeValue;if(lastNode){nodesToDelete.push(lastNode);}
lastNode=child;}}else{if(currentlyTraversingExpandedText){currentlyTraversingExpandedText=false;lastNode.parentNode.replaceChild(document.createTextNode(currentText),lastNode);}
if(!~child.className.indexOf('aloha-block')){convertBack(child);}}}}
if(currentlyTraversingExpandedText){lastNode.parentNode.replaceChild(document.createTextNode(currentText),lastNode);}};convertBack(el);for(var i=0,l=nodesToDelete.length;i<l;i++){nodesToDelete[i].parentNode.removeChild(nodesToDelete[i]);}},_dd_isDragdropEnabled:function(){return isDragdropEnabledForElement(this.$element.parent());},_setupDragDropForBlockElements:function(){this.$element.find('.aloha-block-draghandle').addClass('aloha-block-draghandle-blocklevel');},createEditablesIfNeeded:function(){this.$element.find('.aloha-editable').aloha();},renderBlockHandlesIfNeeded:function(){if(this.isDraggable()){if(this.$element.children('.aloha-block-draghandle').length===0){this.$element.prepend('<span class="aloha-block-handle aloha-block-draghandle"></span>');}}},attr:function(attributeNameOrObject,attributeValue,suppressEvents){var that=this,attributeChanged=false;if(arguments.length>=2){if(attributeNameOrObject.substr(0,12)==='aloha-block-'){Aloha.Log.error('block/block','It is not allowed to set internal block attributes (starting with aloha-block-) through Block.attr() (You tried to set '+attributeNameOrObject+')');return;}
if(this._getAttribute(attributeNameOrObject)!==attributeValue){attributeChanged=true;}
this._setAttribute(attributeNameOrObject,attributeValue);}else if(typeof attributeNameOrObject==='object'){jQuery.each(attributeNameOrObject,function(key,value){if(key.substr(0,12)==='aloha-block-'){Aloha.Log.error('block/block','It is not allowed to set internal block attributes (starting with aloha-block-) through Block.attr() (You tried to set '+key+')');return;}
if(that._getAttribute(key)!==value){attributeChanged=true;}
that._setAttribute(key,value);});}else if(typeof attributeNameOrObject==='string'){return this._getAttribute(attributeNameOrObject);}else{return this._getAttributes();}
if(attributeChanged&&!suppressEvents){this._update();this.trigger('change');Aloha.activeEditable.smartContentChange({type:'block-change'});}
return null;},_setAttribute:function(name,value){this.$element.attr('data-'+name.toLowerCase(),value);},_getAttribute:function(name){return this.$element.attr('data-'+name.toLowerCase());},_getAttributes:function(){var attributes={};jQuery.each(this.$element[0].attributes,function(i,attribute){if(attribute.name.substr(0,5)==='data-'){attributes[attribute.name.substr(5).toLowerCase()]=attribute.value;}});return attributes;}});var DefaultBlock=AbstractBlock.extend({update:function($element,postProcessFn){postProcessFn();}});var DebugBlock=AbstractBlock.extend({title:'Debugging',init:function($element,postProcessFn){this.update($element,postProcessFn);},update:function($element,postProcessFn){$element.css({display:'block'});var renderedAttributes='<table class="debug-block">';jQuery.each(this.attr(),function(k,v){renderedAttributes+='<tr><th>'+k+'</th><td>'+v+'</td></tr>';});renderedAttributes+='</table>';$element.html(renderedAttributes);postProcessFn();}});var EmptyBlock=AbstractBlock.extend({title:'EmptyBlock',init:function(){},activate:function(){},deactivate:function(){},renderBlockHandlesIfNeeded:function(){}});function isDragdropEnabledForElement($element){var editable=$element.closest(".aloha-editable");if(editable.length){return!!editable.data("block-dragdrop");}else{return true;}}
return{AbstractBlock:AbstractBlock,DefaultBlock:DefaultBlock,DebugBlock:DebugBlock,EmptyBlock:EmptyBlock};});define('block/blockcontenthandler',['jquery','aloha/contenthandlermanager','block/blockmanager'],function(jQuery,ContentHandlerManager,BlockManager){var BlockContentHandler=ContentHandlerManager.createHandler({handleContent:function(content){if(typeof content==='string'){content=jQuery('<div>'+content+'</div>');}else if(content instanceof jQuery){content=jQuery('<div>').append(content);}
if(content.find('.aloha-block[data-aloha-block-copy-only-block="true"]').length>0){content.find('.aloha-block:not([id])').remove();content.find('.aloha-block + span:empty').remove();content.find('div:empty').remove();content.find('br.Apple-interchange-newline').remove();content.find('.aloha-block').prev('br').remove();content.find('div > br:only-child').parent().remove();}
content.find('.aloha-block').each(function(){var oldBlock=jQuery(this);var elementAttributes={};var blockAttributes={};jQuery.each(oldBlock[0].attributes,function(k,v){if(v.nodeName==='id')return;if(v.nodeName.match(/^data-/)){blockAttributes[v.nodeName.substr(5)]=v.nodeValue;}else{elementAttributes[v.nodeName]=v.nodeValue;}});var newBlockId=GENTICS.Utils.guid();var newBlock=jQuery('<'+this.tagName+'/>').attr(elementAttributes).attr('id',newBlockId).removeClass('aloha-block-active').removeClass('aloha-block').html(oldBlock.html());oldBlock.replaceWith(newBlock);window.setTimeout(function(){BlockManager._blockify(jQuery('#'+newBlockId),blockAttributes);},50);});return content.html();}});return BlockContentHandler;});define('block/editor',['jquery','aloha/observable','util/class'],function(jQuery,Observable,Class){var AbstractEditor=Class.extend(Observable,{schema:null,_constructor:function(schema){this.schema=schema;},render:function(){},getValue:function(){},setValue:function(value){},destroy:function(){},_deactivate:function(){this.trigger('change',this.getValue());this.destroy();}});var AbstractFormElementEditor=AbstractEditor.extend({formInputElementDefinition:null,_$formInputElement:null,render:function(){var $wrapper=jQuery('<div class="aloha-block-editor" />');var guid=GENTICS.Utils.guid();$wrapper.append(this.renderLabel().attr('id',guid));$wrapper.append(this.renderFormElement().attr('id',guid));return $wrapper;},renderLabel:function(){var element=jQuery('<label />');element.html(this.schema.label);return element;},renderFormElement:function(){var that=this;this._$formInputElement=jQuery(this.formInputElementDefinition);this.afterRenderFormElement(this._$formInputElement);this._$formInputElement.change(function(){that.trigger('change',that.getValue());});return this._$formInputElement;},afterRenderFormElement:function($formElement){},getValue:function(){return this._$formInputElement.val();},setValue:function(value){this._$formInputElement.val(value);},destroy:function(){this._$formInputElement.remove();}});var StringEditor=AbstractFormElementEditor.extend({formInputElementDefinition:'<input type="text" />'});var NumberEditor=AbstractFormElementEditor.extend({formInputElementDefinition:'<input type="range" />',afterRenderFormElement:function($formElement){if(!this.schema.range)return;if(this.schema.range.min){$formElement.attr('min',this.schema.range.min);}
if(this.schema.range.max){$formElement.attr('max',this.schema.range.max);}
if(this.schema.range.step){$formElement.attr('step',this.schema.range.step);}}});var UrlEditor=AbstractFormElementEditor.extend({formInputElementDefinition:'<input type="url" />'});var EmailEditor=AbstractFormElementEditor.extend({formInputElementDefinition:'<input type="email" />'});var SelectEditor=AbstractFormElementEditor.extend({formInputElementDefinition:'<select />',afterRenderFormElement:function($formElement){jQuery.each(this.schema.values,function(){var el=this;$formElement.append(jQuery('<option />').attr('value',el.key).html(el.label));});}});var ButtonEditor=AbstractFormElementEditor.extend({formInputElementDefinition:'<button />',afterRenderFormElement:function($formElement){var that=this;$formElement.html(this.schema.buttonLabel);$formElement.click(function(){that.schema.callback();})}});return{AbstractEditor:AbstractEditor,AbstractFormElementEditor:AbstractFormElementEditor,StringEditor:StringEditor,NumberEditor:NumberEditor,UrlEditor:UrlEditor,EmailEditor:EmailEditor,SelectEditor:SelectEditor,ButtonEditor:ButtonEditor}});define('block/nls/i18n',{"root":{"button.toggledragdrop.tooltip":"Toggle Drag & Drop"},"ca":true,"de":true,"mk":true,"pt-br":true,"ru":true,"uk":true,"zh-hans":true});define('block/block-plugin',['aloha','aloha/plugin','jquery','aloha/contenthandlermanager','block/blockmanager','block/sidebarattributeeditor','block/block','block/editormanager','block/blockcontenthandler','block/editor','ui/ui','ui/toggleButton','i18n!block/nls/i18n','i18n!aloha/nls/i18n','jqueryui'],function(Aloha,Plugin,jQuery,ContentHandlerManager,BlockManager,SidebarAttributeEditor,block,EditorManager,BlockContentHandler,editor,Ui,ToggleButton,i18n,i18nCore){var defaultRootTags=['div','span'];var BlockPlugin=Plugin.create('block',{config:[],settings:{},init:function(){var that=this;if(!this.settings.rootTags){this.settings.rootTags=defaultRootTags;}
BlockManager.registerBlockType('DebugBlock',block.DebugBlock);BlockManager.registerBlockType('DefaultBlock',block.DefaultBlock);BlockManager.registerBlockType('EmptyBlock',block.EmptyBlock);EditorManager.register('string',editor.StringEditor);EditorManager.register('number',editor.NumberEditor);EditorManager.register('url',editor.UrlEditor);EditorManager.register('email',editor.EmailEditor);EditorManager.register('select',editor.SelectEditor);EditorManager.register('button',editor.ButtonEditor);ContentHandlerManager.register('block',BlockContentHandler);BlockManager.setDragDropState(that.isDragDropEnabled());BlockManager.registerEventHandlers();BlockManager.initializeBlockLevelDragDrop();Aloha.bind('aloha-ready',function(){that._createBlocks();if(that.settings['sidebarAttributeEditor']!==false){SidebarAttributeEditor.init();}});this.createButtons();Aloha.bind('aloha-editable-created',function(e,editable){that.setDropzones(editable.obj);});Aloha.bind('aloha-editable-activated',function(e,params){that.applyButtonConfig(params.editable);});},applyButtonConfig:function(editable){if(this._isDragdropToggleEnabled(editable)){this._toggleDragDropButton.show();this._toggleDragDropButton.setState(this._getDragdropState(editable));}else{this._toggleDragDropButton.hide();}},_isDragdropToggleEnabled:function(editable){var config=this.getEditableConfig(editable.obj);var toggleDragdropConfigured=function(){return(config[0]==="toggleDragdrop")||config.toggleDragdrop==true||config.toggleDragdrop=='true'||config.toggleDragdrop==1||config.toggleDragdrop=='1'};var toggleGloballyOrPerEditable=((this.settings&&this.settings.config&&this.settings.config.toggleDragdropGlobal)||toggleDragdropConfigured());return toggleGloballyOrPerEditable&&this.isDragDropEnabled();},_getDragdropState:function(editable){return((this.settings&&this.settings.config&&this.settings.config.toggleDragdropGlobal)?BlockManager.getDragDropState():editable.obj.data("block-dragdrop"));},_toggleDragdropState:function(editable){if(this.settings&&this.settings.config&&this.settings.config.toggleDragdropGlobal){var dragdropState=!BlockManager.getDragDropState();BlockManager.setDragDropState(dragdropState);for(var i=0;i<Aloha.editables.length;i++){var editable=Aloha.editables[i];this._setDragDropStateForEditable(editable.obj,dragdropState);}}else{var toggleState=!editable.obj.data("block-dragdrop");this._setDragDropStateForEditable(editable.obj,toggleState);}},createButtons:function(){var that=this;this._toggleDragDropButton=Ui.adopt("toggleDragDrop",ToggleButton,{tooltip:i18n.t('button.toggledragdrop.tooltip'),icon:'aloha-icon aloha-icon-toggledragdrop',scope:'Aloha.continuoustext',click:function(){that._toggleDragdropState(Aloha.activeEditable);}});},setDropzones:function(editable){var that=this;var config=that.getEditableConfig(editable);var dropzones=(config&&config.dropzones)||that.settings.dropzones;if(dropzones){editable.data('block-dropzones',dropzones);}else{editable.data('block-dropzones',[".aloha-editable"]);}},isDragDropEnabled:function(){if(this.settings&&typeof this.settings.dragdrop!=="undefined"){return(this.settings.dragdrop===true||this.settings.dragdrop==='true'||this.settings.dragdrop===1||this.settings.dragdrop==='1');}else{return true;}},_createBlocks:function(){if(!this.settings.defaults){this.settings.defaults={};}
jQuery.each(this.settings.defaults,function(selector,instanceDefaults){jQuery(selector).alohaBlock(instanceDefaults);});},_setDragDropStateForEditable:function($editable,state){$editable.data("block-dragdrop",state);if($editable.hasClass("ui-sortable")){$editable.sortable("option","disabled",!state);}
$editable.find(".aloha-block.ui-draggable").each(function(){jQuery(this).draggable("option","disabled",!state);});$editable.find(".aloha-block-handle").each(function(){if(state){jQuery(this).addClass("aloha-block-draghandle");}else{jQuery(this).removeClass("aloha-block-draghandle");}});}});jQuery.fn.alohaBlock=function(instanceDefaults){instanceDefaults=instanceDefaults||{};jQuery(this).each(function(index,element){BlockManager._blockify(element,instanceDefaults);});return jQuery(this);};jQuery.fn.mahaloBlock=function(){jQuery(this).each(function(index,element){BlockManager._unblockify(element);});};return BlockPlugin;});define('align/nls/i18n',{"root":{"button.alignright.tooltip":"Align to the right","button.alignleft.tooltip":"Align to the left","button.aligncenter.tooltip":"Center","button.alignjustify.tooltip":"Justify","button.aligntop.tooltip":"Align to the top","button.alignmiddle.tooltip":"Align to the middle","button.alignbottom.tooltip":"Align to the bottom"},"ca":true,"de":true,"mk":true,"pt-br":true,"ru":true,"uk":true,"zh-hans":true});define('align/align-plugin',['aloha','aloha/plugin','ui/ui','ui/toggleButton','i18n!align/nls/i18n','i18n!aloha/nls/i18n','jquery','PubSub'],function(Aloha,Plugin,Ui,ToggleButton,i18n,i18nCore,jQuery,PubSub){var GENTICS=window.GENTICS;return Plugin.create('align',{_constructor:function(){this._super('align');},config:{alignment:['right','left','center','justify','top','middle','bottom']},alignment:'',verticalAlignment:'',lastAlignment:'',lastVerticalAlignment:'',init:function(){this.createButtons();var that=this;Aloha.bind('aloha-editable-activated',function(e,params){that.applyButtonConfig(params.editable.obj);});PubSub.sub('aloha.selection.context-change',function(message){var rangeObject=message.range;if(Aloha.activeEditable){that.buttonPressed(rangeObject);}});},buttonPressed:function(rangeObject){this.horizontalButtonPressed(rangeObject);this.verticalButtonPressed(rangeObject);},horizontalButtonPressed:function(rangeObject){var that=this;this.lastAlignment=this.alignment;this.alignment='';rangeObject.findMarkup(function(){if(this.style.textAlign!==""){that.alignment=this.style.textAlign;return true;}
that.alignment=jQuery(this).css('text-align');},Aloha.activeEditable.obj);if(this.alignment!=this.lastAlignment){this._alignRightButton.setState(false);this._alignLeftButton.setState(false);this._alignCenterButton.setState(false);this._alignJustifyButton.setState(false);switch(this.alignment){case'right':this._alignRightButton.setState(true);break;case'center':this._alignCenterButton.setState(true);break;case'justify':this._alignJustifyButton.setState(true);break;default:this._alignLeftButton.setState(true);this.alignment='left';break;}}},verticalButtonPressed:function(rangeObject){var that=this;this.lastVerticalAlignment=this.verticalAlignment;this.verticalAlignment='';rangeObject.findMarkup(function(){if(this.style.verticalAlign!==""){that.verticalAlignment=this.style.verticalAlign;return true;}
that.verticalAlignment=jQuery(this).css('vertical-align');},Aloha.activeEditable.obj);if(this.verticalAlignment!=this.lastVerticalAlignment){this._alignTopButton.setState(false);this._alignMiddleButton.setState(false);this._alignBottomButton.setState(false);switch(this.verticalAlignment){case'top':this._alignTopButton.setState(true);break;case'middle':this._alignMiddleButton.setState(true);break;case'bottom':this._alignBottomButton.setState(true);break;default:this._alignTopButton.setState(true);this.verticalAlignment='top';break;}}},applyButtonConfig:function(obj){var config=this.getEditableConfig(obj);if(config&&config.alignment&&!this.settings.alignment){config=config;}else if(config[0]&&config[0].alignment){config=config[0];}else if(this.settings.alignment){config.alignment=this.settings.alignment;}
if(typeof config.alignment==='undefined'){config=this.config;}
if(jQuery.inArray('right',config.alignment)!=-1){this._alignRightButton.show(true);}else{this._alignRightButton.show(false);}
if(jQuery.inArray('left',config.alignment)!=-1){this._alignLeftButton.show(true);}else{this._alignLeftButton.show(false);}
if(jQuery.inArray('center',config.alignment)!=-1){this._alignCenterButton.show(true);}else{this._alignCenterButton.show(false);}
if(jQuery.inArray('justify',config.alignment)!=-1){this._alignJustifyButton.show(true);}else{this._alignJustifyButton.show(false);}
if(jQuery.inArray('top',config.alignment)!=-1){this._alignTopButton.show(true);}else{this._alignTopButton.show(false);}
if(jQuery.inArray('middle',config.alignment)!=-1){this._alignMiddleButton.show(true);}else{this._alignMiddleButton.show(false);}
if(jQuery.inArray('bottom',config.alignment)!=-1){this._alignBottomButton.show(true);}else{this._alignBottomButton.show(false);}},createButtons:function(){var that=this;this._alignLeftButton=Ui.adopt("alignLeft",ToggleButton,{tooltip:i18n.t('button.alignleft.tooltip'),icon:'aloha-icon aloha-icon-align aloha-icon-align-left',scope:'Aloha.continuoustext',click:function(){that.align('left');}});this._alignCenterButton=Ui.adopt("alignCenter",ToggleButton,{tooltip:i18n.t('button.aligncenter.tooltip'),icon:'aloha-icon aloha-icon-align aloha-icon-align-center',scope:'Aloha.continuoustext',click:function(){that.align('center');}});this._alignRightButton=Ui.adopt("alignRight",ToggleButton,{tooltip:i18n.t('button.alignright.tooltip'),icon:'aloha-icon aloha-icon-align aloha-icon-align-right',scope:'Aloha.continuoustext',click:function(){that.align('right');}});this._alignJustifyButton=Ui.adopt("alignJustify",ToggleButton,{tooltip:i18n.t('button.alignjustify.tooltip'),icon:'aloha-icon aloha-icon-align aloha-icon-align-justify',scope:'Aloha.continuoustext',click:function(){that.align('justify');}});this._alignTopButton=Ui.adopt("alignTop",ToggleButton,{tooltip:i18n.t('button.aligntop.tooltip'),icon:'aloha-icon aloha-icon-align aloha-icon-align-top',scope:'table.cell',click:function(){that.verticalAlign('top');}});this._alignMiddleButton=Ui.adopt("alignMiddle",ToggleButton,{tooltip:i18n.t('button.alignmiddle.tooltip'),icon:'aloha-icon aloha-icon-align aloha-icon-align-middle',scope:'table.cell',click:function(){that.verticalAlign('middle');}});this._alignBottomButton=Ui.adopt("alignBottom",ToggleButton,{tooltip:i18n.t('button.alignbottom.tooltip'),icon:'aloha-icon aloha-icon-align aloha-icon-align-bottom',scope:'table.cell',click:function(){that.verticalAlign('bottom');}});},verticalAlign:function(tempAlignment){var that=this;var range=Aloha.Selection.getRangeObject();this.lastVerticalAlignment=this.verticalAlignment;this.verticalAlignment=tempAlignment;var selectedCells=this.getSelectedCells(range);if(selectedCells){that.toggleAlign(selectedCells,'vertical-align');}
if(this.verticalAlignment!=this.lastVerticalAlignment){switch(this.lastVerticalAlignment){case'top':this._alignTopButton.setState(false);break;case'middle':this._alignMiddleButton.setState(false);break;case'bottom':this._alignBottomButton.setState(false);break;}}
range.select();},align:function(tempAlignment){var that=this;var range=Aloha.Selection.getRangeObject();this.lastAlignment=this.alignment;this.alignment=tempAlignment;var rangeParent=range.getCommonAncestorContainer();var selectedCells=this.getSelectedCells(range);if(selectedCells){that.toggleAlign(selectedCells);}else if(!GENTICS.Utils.Dom.isEditingHost(rangeParent)){that.toggleAlign(rangeParent);}else{var alignableElements=[];jQuery.each(Aloha.Selection.getRangeObject().getSelectionTree(),function(){if(this.selection!=='none'&&this.domobj.nodeType!==3){alignableElements.push(this.domobj);}});that.toggleAlign(alignableElements);}
if(this.alignment!=this.lastAlignment){switch(this.lastAlignment){case'right':this._alignRightButton.setState(false);break;case'left':this._alignLeftButton.setState(false);break;case'center':this._alignCenterButton.setState(false);break;case'justify':this._alignJustifyButton.setState(false);break;}}
range.select();},getSelectedCells:function(range){var selectedCell;var activeTable=range.findMarkup(function(){if(jQuery(this).is('td,th')){selectedCell=this;}
return jQuery(this).is('table.aloha-table');},Aloha.activeEditable.obj);var selectedCells=jQuery(activeTable).find('.aloha-cell-selected');return(selectedCells.length?selectedCells:selectedCell);},toggleAlign:function(domObj,property){var that=this;property=property||'text-align';var newAlignment=(property==='vertical-align')?that.verticalAlignment:that.alignment;var shouldRemoveAlignment=true;jQuery(domObj).each(function(){var currentAlignment=jQuery(this).css(property);if(currentAlignment!=newAlignment){shouldRemoveAlignment=false;return false;}});jQuery(domObj).each(function(){var currentAlignment=jQuery(this).css(property);if((currentAlignment==newAlignment)&&shouldRemoveAlignment){jQuery(this).css(property,'');}else{jQuery(this).css(property,newAlignment);}});}});});define('abbr/nls/i18n',{"root":{"floatingmenu.tab.abbr":"Abbreviation","button.addabbr.tooltip":"insert abbreviation","button.abbr.tooltip":"format as abbreviation","newabbr.defaulttext":"Abbr"},"ca":true,"de":true,"mk":true,"pt-br":true,"ru":true,"uk":true,"zh-hans":true});define('abbr/abbr-plugin',['aloha','jquery','aloha/plugin','ui/ui','ui/toggleButton','ui/button','ui/scopes','ui/port-helper-attribute-field','i18n!abbr/nls/i18n','i18n!aloha/nls/i18n'],function(Aloha,jQuery,Plugin,Ui,ToggleButton,Button,Scopes,AttributeField,i18n,i18nCore){var GENTICS=window.GENTICS;return Plugin.create('abbr',{config:['abbr'],init:function(){this.createButtons();this.subscribeEvents();this.bindInteractions();},createButtons:function(){var me=this;this._formatAbbrButton=Ui.adopt("formatAbbr",ToggleButton,{tooltip:i18n.t("button.abbr.tooltip"),icon:"aloha-icon aloha-icon-abbr",scope:'Aloha.continuoustext',click:function(){me.formatAbbr();}});this._insertAbbrButton=Ui.adopt("insertAbbr",Button,{tooltip:i18n.t('button.addabbr.tooltip'),icon:'aloha-icon aloha-icon-abbr',scope:'Aloha.continuoustext',click:function(){me.insertAbbr(false);}});Scopes.createScope('abbr','Aloha.continuoustext');this.abbrField=AttributeField({width:320,name:'abbrText',scope:'abbr'});this.remAbbrButton=Ui.adopt("removeAbbr",Button,{tooltip:i18n.t('button.remabbr.tooltip'),icon:'aloha-icon aloha-icon-abbr-rem',scope:'abbr',click:function(){me.removeAbbr();}});},bindInteractions:function(){var me=this;this.abbrField.addListener('blur',function(obj,event){if(this.getValue()==''){me.removeAbbr();}});for(var i=0;i<Aloha.editables.length;i++){Aloha.editables[i].obj.keydown(function(e){if(e.metaKey&&e.which==71){if(me.findAbbrMarkup()){me.abbrField.foreground();me.abbrField.focus();}else{me.insertAbbr();}
e.stopPropagation();e.preventDefault();return false;}});}},subscribeEvents:function(){var me=this;var editableConfig={};Aloha.bind('aloha-editable-activated',function(){if(!Aloha.activeEditable||!Aloha.activeEditable.obj){return;}
var config=me.getEditableConfig(Aloha.activeEditable.obj);editableConfig[Aloha.activeEditable.getId()]=jQuery.inArray('abbr',config)!==-1;});Aloha.bind('aloha-editable-destroyed',function(){if(Aloha.activeEditable&&Aloha.activeEditable.obj){delete editableConfig[Aloha.activeEditable.getId()];}
delete editableConfig[Aloha.activeEditable.getId()];});Aloha.bind('aloha-selection-changed',function(event,range){if(!Aloha.activeEditable){return;}
if(editableConfig[Aloha.activeEditable.getId()]){me._formatAbbrButton.show();me._insertAbbrButton.show();}else{me._formatAbbrButton.hide();me._insertAbbrButton.hide();return;}
var foundMarkup=me.findAbbrMarkup(range);if(foundMarkup){me._insertAbbrButton.hide();me._formatAbbrButton.setState(true);Scopes.setScope('abbr');me.abbrField.setTargetObject(foundMarkup,'title');}else{me._formatAbbrButton.setState(false);me.abbrField.setTargetObject(null);}});},findAbbrMarkup:function(range){if(typeof range=='undefined'){var range=Aloha.Selection.getRangeObject();}
if(Aloha.activeEditable){return range.findMarkup(function(){return this.nodeName.toLowerCase()=='abbr';},Aloha.activeEditable.obj);}else{return null;}},formatAbbr:function(){var range=Aloha.Selection.getRangeObject();if(Aloha.activeEditable){if(this.findAbbrMarkup(range)){this.removeAbbr();}else{this.insertAbbr();}}},insertAbbr:function(extendToWord){var range=Aloha.Selection.getRangeObject();if(this.findAbbrMarkup(range)){return;}
if(range.isCollapsed()&&extendToWord!=false){GENTICS.Utils.Dom.extendToWord(range);}
if(range.isCollapsed()){var abbrText=i18n.t('newabbr.defaulttext');var newAbbr=jQuery('<abbr title="">'+abbrText+'</abbr>');GENTICS.Utils.Dom.insertIntoDOM(newAbbr,range,jQuery(Aloha.activeEditable.obj));range.startContainer=range.endContainer=newAbbr.contents().get(0);range.startOffset=0;range.endOffset=abbrText.length;}else{var newAbbr=jQuery('<abbr title=""></abbr>');GENTICS.Utils.Dom.addMarkup(range,newAbbr,false);}
range.select();this.abbrField.foreground();this.abbrField.focus();},removeAbbr:function(){var range=Aloha.Selection.getRangeObject();var foundMarkup=this.findAbbrMarkup();if(foundMarkup){GENTICS.Utils.Dom.removeFromDOM(foundMarkup,range,true);range.select();}},makeClean:function(obj){},toString:function(){return'abbr';}});});define('horizontalruler/nls/i18n',{"root":{"button.addhr.tooltip":"Add a horizontal ruler"},"ca":true,"de":true,"mk":true,"pt-br":true,"ru":true,"uk":true,"zh-hans":true});define('horizontalruler/horizontalruler-plugin',['aloha','jquery','aloha/plugin','ui/ui','ui/button','i18n!horizontalruler/nls/i18n','i18n!aloha/nls/i18n'],function(Aloha,jQuery,Plugin,Ui,Button,i18n,i18nCore){var GENTICS=window.GENTICS;return Plugin.create('horizontalruler',{_constructor:function(){this._super('horizontalruler');},config:['hr'],init:function(){var that=this;this._insertHorizontalRuleButton=Ui.adopt("insertHorizontalRule",Button,{tooltip:i18n.t('button.addhr.tooltip'),iconOnly:true,icon:'aloha-icon-horizontalruler',scope:'Aloha.continuoustext',click:function(){that.insertHR();}});Aloha.bind('aloha-editable-activated',function(event,rangeObject){if(Aloha.activeEditable){that.cfg=that.getEditableConfig(Aloha.activeEditable.obj);if(jQuery.inArray('hr',that.cfg)!=-1){that._insertHorizontalRuleButton.show(true);}else{that._insertHorizontalRuleButton.show(false);return;}}});},insertHR:function(character){var self=this;var range=Aloha.Selection.getRangeObject();if(Aloha.activeEditable){var hr=jQuery('<hr>');GENTICS.Utils.Dom.insertIntoDOM(hr,range,jQuery(Aloha.activeEditable.obj),true);range.select();}}});});define('paste/paste-plugin',['aloha/core','aloha/plugin','jquery','aloha/command','aloha/console'],function(Aloha,Plugin,jQuery,Commands,console){var GENTICS=window.GENTICS,$window=jQuery(window),pasteRange=null,pasteEditable=null;var $pasteDiv=jQuery('<div id="pasteContainer" '+'style="position:absolute; clip:rect(0px, 0px, 0px, 0px); '+'width: 1px; height: 1px;"></div>').contentEditable(true);function redirectPaste(){pasteRange=Aloha.getSelection().getRangeAt(0);pasteEditable=Aloha.activeEditable;$pasteDiv.css({top:$window.scrollTop(),left:$window.scrollLeft()-200});$pasteDiv.contents().remove();if(pasteEditable){pasteEditable.obj.blur();}
Aloha.getSelection().removeAllRanges();var newRange=Aloha.createRange();newRange.setStart($pasteDiv.get(0),0);newRange.setEnd($pasteDiv.get(0),0);Aloha.getSelection().addRange(newRange);$pasteDiv.focus();};function getPastedContent(){var that=this,pasteDivContents;if(pasteRange&&pasteEditable){pasteEditable.obj.focus();Aloha.getSelection().removeAllRanges();var newRange=Aloha.createRange();newRange.setStart(pasteRange.startContainer,pasteRange.startOffset);newRange.setEnd(pasteRange.endContainer,pasteRange.endOffset);Aloha.getSelection().addRange(newRange);pasteDivContents=$pasteDiv.html();if(jQuery.browser.msie&&/^&nbsp;/.test(pasteDivContents)){pasteDivContents=pasteDivContents.substring(6);}
var startContainer=pasteRange.startContainer;if(startContainer.nodeType==3&&startContainer.parentNode.nodeName=='P'&&startContainer.parentNode.childNodes.length==1&&/^(\s|%A0)$/.test(escape(startContainer.data))){startContainer.data='';pasteRange.startOffset=0;if(pasteRange.endContainer==startContainer){pasteRange.endOffset=0;}}
if(Aloha.queryCommandSupported('insertHTML')){Aloha.execCommand('insertHTML',false,pasteDivContents);}else{console.error('Common.Paste','Command "insertHTML" not '+'available. Enable the plugin "common/commands".');}}
pasteRange=void 0;pasteEditable=void 0;$pasteDiv.contents().remove();};return Plugin.create('paste',{settings:{},init:function(){var that=this;jQuery('body').append($pasteDiv);Aloha.bind('aloha-editable-created',function(event,editable){if(jQuery.browser.msie){if(that.settings.noclipboardaccess||true){editable.obj.bind('beforepaste',function(event){redirectPaste();event.stopPropagation();});}else{editable.obj.bind('paste',function(event){redirectPaste();var range=document.selection.createRange();range.execCommand('paste');getPastedContent();event.metaKey=void 0;Aloha.activeEditable.smartContentChange(event);event.stopPropagation();return false;});}}else{editable.obj.bind('paste',function(event){redirectPaste();window.setTimeout(function(){getPastedContent();Aloha.activeEditable.smartContentChange(event);},10);event.stopPropagation();});}});if(jQuery.browser.msie&&(that.settings.noclipboardaccess||true)){$pasteDiv.bind('paste',function(event){window.setTimeout(function(){getPastedContent();Aloha.activeEditable.smartContentChange(event);},10);event.stopPropagation();});}},register:function(pasteHandler){console.deprecated('Plugins.Paste','register() for '+'pasteHandler is deprecated. Use the ContentHandler Plugin '+'instead.');}});});define('toc/nls/i18n',{"root":{"button.addtoc.tooltip":"Table of contents"},"ca":true,"de":true,"mk":true,"pt-br":true,"ru":true,"uk":true,"zh-hans":true});define('toc/toc-plugin',['aloha','aloha/plugin','jquery','ui/ui','ui/button','i18n!toc/nls/i18n','i18n!aloha/nls/i18n','aloha/console'],function(Aloha,Plugin,jQuery,Ui,Button,i18n,i18nCore,console){var GENTICS=window.GENTICS,namespace='toc',$containers=null,allTocs=[];function last(a){return a[a.length-1];}
function head(a){return a[0];}
function tail(a){return a.slice(1);}
function indexOf(a,item){return detect(a,function(cmp){return cmp===item;});}
function detect(a,f){for(var i=0;i<a.length;i++){if(f(a[i])){return a[i];}}
return null;}
function map(a,f){var result=[];for(var i=0;i<a.length;i++){result.push(f(a[i]));}
return result;}
function each(a,f){map(a,f);}
return Plugin.create(namespace,{minEntries:0,updateInterval:5000,config:['toc'],init:function(){var that=this;if(typeof this.settings.minEntries==='undefined'){this.settings.minEntries=this.minEntries;}
if(typeof this.settings.updateInterval==='undefined'){this.settings.updateInterval=this.updateInterval;}
Aloha.bind('aloha-editable-activated',function(event,rangeObject){if(Aloha.activeEditable){that.cfg=that.getEditableConfig(Aloha.activeEditable.obj);if(jQuery.inArray('toc',that.cfg)!=-1){that._insertTocButton.show(true);}else{that._insertTocButton.show(false);return;}}});this.initButtons();jQuery(document).ready(function(){that.spawn();});},initButtons:function(){var that=this;this._insertTocButton=Ui.adopt("insertToc",Button,{tooltip:i18n.t('button.addtoc.tooltip'),icon:'aloha-icon aloha-icon-orderedlist',scope:'Aloha.continuoustext',click:function(){that.insertAtSelection($containers);}});},register:function($c){$containers=$c;},insertAtSelection:function($containers){$containers=$containers||editableContainers();var id=generateId('toc');var $tocElement=jQuery("<ol class='toc_root'></ol>").attr('id',id).attr('contentEditable','false');var range=Aloha.Selection.getRangeObject();var tocEditable=Aloha.activeEditable;var $tocContainer=jQuery(document.getElementById(tocEditable.getId()));GENTICS.Utils.Dom.insertIntoDOM($tocElement,range,$tocContainer);this.create(id).register($containers).update().tickTock();},spawn:function($ctx,$containers){$ctx=$ctx||jQuery('body');$containers=$containers||editableContainers();$ctx.find('ol.toc_root').each(function(){var id=jQuery(this).attr('id');if(!id){id=generateId('toc');jQuery(this).attr('id',id);}
that.create(id).register($containers).tickTock();});},create:function(id){allTocs.push(this);return{'id':id,'$containers':jQuery(),'settings':this.settings,root:function(){return jQuery(document.getElementById(this.id));},register:function($containers){var self=this;self.$containers=self.$containers.add($containers);self.$containers.filter(function(){return!jQuery(this).data(namespace+'.'+self.id+'.listening');}).each(function(){var $container=jQuery(this);$container.data(namespace+'.'+self.id+'.listening',true);$container.bind('blur',function(){self.cleanupIds($container.get(0));self.update($container);});});return self;},tickTock:function(interval){var self=this;interval=interval||this.settings.updateInterval;if(!interval){return;}
window.setInterval(function(){self.register(editableContainers());self.update();},interval);return self;},cleanupIds:function(ctx){var ids=[],that=this;this.headings(this.$containers).each(function(){var id=jQuery(this).attr('id');if((id&&-1!=jQuery.inArray(id,ids))||(ctx&&(jQuery.contains(ctx,this)||ctx===this)))
{jQuery(this).attr('id',generateId(this));}
ids.push(id);});return this;},update:function($ctx){var self=this;$ctx=$ctx||self.$containers;var outline=this.outline(self.$containers);var ancestors=[self.root()];var prevSiblings=[];last(ancestors).empty();(function descend(outline){var prevSiblings=[];each(outline,function(node){var $section=head(node);var $entry=self.linkSection($section,ancestors,prevSiblings);ancestors.push($entry);descend(tail(node));ancestors.pop();prevSiblings.push($entry);});})(tail(outline));var minEntries=self.root().attr('data-TOC-minEntries')||this.settings.minEntries;if(self.root().find('li').length>=minEntries){self.root().show();}else{self.root().hide();}
return this;},linkSection:function($section,ancestors,prevSiblings){var linkId=$section.eq(0).attr('id');if(!linkId){linkId=generateId($section.get(0));$section.eq(0).attr('id',linkId);}
var $root=this.root();var $entry=anchorFromLinkId($root,linkId);if(!$entry.length){$entry=jQuery('<li><a/></li>');}
$entry.find('a').attr('href','#'+linkId).text($section.eq(0).text());if(last(prevSiblings)){last(prevSiblings).after($entry);}
else{if(last(ancestors).get(0)==$root.get(0)){$root.append($entry);}
else{var $subToc=jQuery('<ol/>').append($entry);last(ancestors).append($subToc);}}
return $entry;},outline:function(ctx){var rootNode=[jQuery()];var potentialParents=[rootNode];this.headings(ctx).each(function(){var $heading=jQuery(this);var nodeName=this.nodeName.toLowerCase();var hLevels=['h6','h5','h4','h3','h2','h1'];var currLevel=jQuery.inArray(nodeName,hLevels);var higherEq=hLevels.slice(currLevel).join(',');var $section=$heading.nextUntil(higherEq).andSelf();var node=[$section];var parent=detect(potentialParents,function(parent){var parentSection=parent[0];return!parentSection.length||detect(parentSection,function(sectionElem){return $heading.get(0)===sectionElem||jQuery.contains(sectionElem,$heading.get(0));});});parent.push(node);potentialParents.splice(0,indexOf(potentialParents,parent),node);});return rootNode;},headings:function($ctx){return $ctx.find(':header').add($ctx.filter(':header'));}}}});function editableContainers(){return jQuery(map(Aloha.editables,function(editable){return document.getElementById(editable.getId());}));}
function anchorFromLinkId($ctx,linkId){return linkId?$ctx.find('a[href $= "#'+linkId+'"]'):jQuery();}
function linkIdFromAnchor($anchor){var href=$anchor.attr('href');return href?href.match(/#(.*?)$/)[1]:null;}
function generateId(elemOrText){var validId;if(typeof elemOrText=="object"){validId=jQuery(elemOrText).text().replace(/[^a-zA-Z-]+/g,'-').replace(/^[^a-zA-Z]+/,'');}else if(elemOrText){validId=elemOrText;}
for(var uniquifier=0;;uniquifier++){var uniqueId=validId;if(uniquifier){uniqueId+='-'+uniquifier;}
var conflict=document.getElementById(uniqueId);if(!conflict||(typeof elemOrText=="object"&&conflict===elemOrText))
{return uniqueId;}}}});define('cite/nls/i18n',{"root":{"cite.button.add.quote":"Format selection as quote","cite.button.add.blockquote":"Format selection as blockquote"},"ca":true,"de":true,"mk":true,"pt-br":true,"ru":true,"uk":true,"zh-hans":true});define('cite/cite-plugin',['aloha','jquery','aloha/plugin','ui/ui','ui/toggleButton','format/format-plugin','util/dom','PubSub','i18n!cite/nls/i18n','i18n!aloha/nls/i18n'],function(Aloha,jQuery,Plugin,Ui,ToggleButton,Format,domUtils,PubSub,i18n,i18nCore){var $=jQuery,ns='aloha-cite',uid=(new Date()).getTime();var nsClasses={quote:nsClass('quote'),blockquote:nsClass('blockquote'),'panel-label':nsClass('panel-label'),'panel-field':nsClass('panel-field'),'panel-btns':nsClass('panel-btns'),'link-field':nsClass('link-field'),'note-field':nsClass('note-field'),references:nsClass('references')};function supplant(str,obj){return str.replace(/\{([a-z0-9\-\_]+)\}/ig,function(str,p1,offset,s){var replacement=obj[p1]||str;return(typeof replacement==='function')?replacement():replacement;});}
function renderTemplate(str){return(typeof str==='string')?supplant(str,nsClasses):str;}
function nsSel(){var strBldr=[],prx=ns;jQuery.each(arguments,function(){strBldr.push('.'+(''===this?prx:prx+'-'+this));});return jQuery.trim(strBldr.join(' '));}
function nsClass(){var strBldr=[],prx=ns;jQuery.each(arguments,function(){strBldr.push(''===this?prx:prx+'-'+this);});return jQuery.trim(strBldr.join(' '));}
function hex2rgb(hex){hex=hex.replace('#','').split('');if(3===hex.length){hex[5]=hex[4]=hex[2];hex[3]=hex[2]=hex[1];hex[1]=hex[0];}
var rgb=[];var i;for(i=0;i<3;++i){rgb[i]=parseInt('0x'+hex[i*2]+hex[i*2+1],16);}
return rgb;}
return Plugin.create('cite',{citations:[],referenceContainer:null,settings:null,sidebar:null,config:['quote','blockquote'],init:function(){var that=this;if(Aloha.settings&&Aloha.settings.plugins&&Aloha.settings.plugins.cite){var referenceContainer=jQuery(Aloha.settings.plugins.cite.referenceContainer);if(referenceContainer.length){that.referenceContainer=referenceContainer;}
if(typeof Aloha.settings.plugins.cite!=='undefined'){that.settings=Aloha.settings.plugins.cite;}
if(typeof that.settings.sidebar==='undefined'){that.settings.sidebar={};}
if(typeof that.settings.sidebar.open==='undefined'){that.settings.sidebar.open=true;}
if(typeof that.settings.sidebar.open==='string'){that.settings.sidebar.open=that.settings.sidebar.open.toLowerCase();if(that.settings.sidebar.open==='false'||that.settings.sidebar.open==='0'){that.settings.sidebar.open=false;}else{that.settings.sidebar.open=true;}}}
this._quoteButton=Ui.adopt('quote',ToggleButton,{tooltip:i18n.t('cite.button.add.quote'),icon:nsClass('button','inline-button'),scope:'Aloha.continuoustext',click:function(){that.addInlineQuote();}});Format.multiSplitButton.pushItem({name:'blockquote',tooltip:i18n.t('cite.button.add.blockquote'),icon:nsClass('button','block-button'),click:function(){that.addBlockQuote();}});var citePlugin=this;Aloha.ready(function(ev){citePlugin.sidebar=Aloha.Sidebar.right.show();citePlugin.sidebar.addPanel({id:nsClass('sidebar-panel'),title:'Citation',content:'',expanded:true,activeOn:'q, blockquote',onInit:function(){var that=this;var additionalReferenceContainer='';if(citePlugin.referenceContainer){additionalReferenceContainer='<div class="{panel-label}">Note:</div> '+'<div class="{panel-field} {note-field}" '+'style="margin: 5px;">'+'<textarea></textarea></div>';}
var content=this.setContent(renderTemplate('<div class="{panel-label}">Link:</div>'+'<div class="{panel-field} {link-field}" '+'style="margin: 5px;"><input type="text" /></div>'+
additionalReferenceContainer)).content;content.find('input, textarea').bind('keypress change',function(){citePlugin.addCiteDetails(that.content.attr('data-cite-id'),that.content.find(nsSel('link-field input')).val(),that.content.find(nsSel('note-field textarea')).val());});},onActivate:function(effective){var activeUid=effective.attr('data-cite-id');if(!activeUid){activeUid=++uid;var classes=[nsClass('wrapper')].join(' ');effective.addClass(classes);effective.attr('data-cite-id',activeUid);}
var index=that.getIndexOfCitation(activeUid);if(-1===index){index=that.citations.push({uid:activeUid,link:null,notes:null})-1;}
this.content.attr('data-cite-id',activeUid);this.content.find(nsSel('link-field input')).val(effective.attr('cite'));this.content.find(nsSel('note-field textarea')).val(that.citations[index].note);}});});Aloha.bind('aloha-editable-activated',function(event,params){var config=that.getEditableConfig(params.editable.obj);if(!config){return;}
if(jQuery.inArray('quote',config)!==-1){that._quoteButton.show(true);}else{that._quoteButton.show(false);}
if(jQuery.inArray('blockquote',config)!==-1){Format.multiSplitButton.showItem('blockquote');}else{Format.multiSplitButton.hideItem('blockquote');}});PubSub.sub('aloha.selection.context-change',function(message){var rangeObject=message.range;var buttons=jQuery('button.aloha-cite-button');var statusWasSet=false;var nodeName;var effective=rangeObject.markupEffectiveAtStart;var i=effective.length;while(i){nodeName=effective[--i].nodeName;if(nodeName==='Q'||nodeName==='BLOCKQUOTE'){statusWasSet=true;break;}}
buttons.filter('.aloha-cite-block-button').removeClass('aloha-cite-pressed');that._quoteButton.setState(false);if(statusWasSet){if('Q'===nodeName){that._quoteButton.setState(true);}else{buttons.filter('.aloha-cite-block-button').addClass('aloha-cite-pressed');}
return false;}
var config=[];if(Aloha.activeEditable){config=that.getEditableConfig(Aloha.activeEditable.obj);}
if(jQuery.inArray('quote',config)!=-1){that._quoteButton.show(true);}else{that._quoteButton.show(false);}
if(jQuery.inArray('blockquote',config)!=-1){Format.multiSplitButton.showItem('blockquote');}else{Format.multiSplitButton.hideItem('blockquote');}});},getIndexOfCitation:function(uid){var c=this.citations;var max=c.length;var min=0;var mid;var cuid;while(min<max){mid=(min+max)>>1;cuid=c[mid].uid;if(cuid==uid){return mid;}
if(cuid>uid){max=mid;}else if(cuid<uid){min=mid+1;}}
return-1;},addBlockQuote:function(){var classes=[nsClass('wrapper'),nsClass(++uid)].join(' ');var markup=jQuery(supplant('<blockquote class="{classes}" data-cite-id="{uid}"></blockquote>',{uid:uid,classes:classes}));if(Aloha.activeEditable){jQuery(Aloha.activeEditable.obj[0]).click();}
Aloha.Selection.changeMarkupOnSelection(markup);if(this.referenceContainer){this.addCiteToReferences(uid);}
if(this.sidebar&&this.settings&&this.settings.sidebar&&this.settings.sidebar.open){this.sidebar.open();}},addInlineQuote:function(){var classes=[nsClass('wrapper'),nsClass(++uid)].join(' ');var markup=jQuery(supplant('<q class="{classes}" data-cite-id="{uid}"></q>',{uid:uid,classes:classes}));var rangeObject=Aloha.Selection.rangeObject;var foundMarkup;if(Aloha.activeEditable){jQuery(Aloha.activeEditable.obj[0]).click();}
foundMarkup=rangeObject.findMarkup(function(){if(this.nodeName&&markup.length&&(typeof this.nodeName==='string')&&(typeof markup[0].nodeName==='string')){return this.nodeName.toLowerCase()===markup[0].nodeName.toLowerCase();}
return false;},Aloha.activeEditable.obj);if(foundMarkup){if(rangeObject.isCollapsed()){domUtils.removeFromDOM(foundMarkup,rangeObject,true);}else{domUtils.removeMarkup(rangeObject,markup,Aloha.activeEditable.obj);}}else{if(rangeObject.isCollapsed()){domUtils.extendToWord(rangeObject);}
domUtils.addMarkup(rangeObject,markup);}
rangeObject.select();if(this.referenceContainer){this.addCiteToReferences(uid);}
if(this.sidebar&&this.settings&&this.settings.sidebar&&this.settings.sidebar.open){this.sidebar.open();}
return false;},addCiteToReferences:function(uid){var index=this.getIndexOfCitation(uid);if(-1===index){return;}
var wrapper=jQuery('.aloha-editable-active '+nsSel(uid));var note='cite-note-'+uid;var ref='cite-ref-'+uid;wrapper.append(supplant('<sup id="{ref}" contenteditable="false"><a href="#{note}">[{count}]</a></sup>',{ref:ref,note:note,count:index+1}));if(0===this.referenceContainer.find('ol.references').length){this.referenceContainer.append('<h2>References</h2>').append('<ol class="references"></ol>');}
this.referenceContainer.find('ol.references').append(supplant('<li id="{note}"><a href="#{ref}">^</a> &nbsp; <span></span></li>',{ref:ref,note:note}));},addCiteDetails:function(uid,link,note){this.citations[this.getIndexOfCitation(uid)]={uid:uid,link:link,note:note};if(link){var el=jQuery(nsSel(uid)).attr('cite',link);}
if(this.referenceContainer){jQuery('li#cite-note-'+uid+' span').html(supplant(link?'<a class="external" target="_blank" href="{url}">{url}</a>':'',{url:link})+(note?'. '+note:''));}},toString:function(){return'aloha-citiation-plugin';},makeClean:function(obj){obj.find('q, blockquote').each(function(){if(jQuery.trim(jQuery(this).attr('class'))===''){jQuery(this).removeAttr('class');}
if(!this.referenceContainer){jQuery(this).removeClass('aloha-cite-'+jQuery(this).attr('data-cite-id'));if(jQuery(this).attr('data-cite-id')!=null){jQuery(this).removeAttr('data-cite-id');}}
jQuery(this).removeClass('aloha-cite-wrapper');});}});});define('flag-icons/flag-icons-plugin',[],function(){'use strict'
return{path:Aloha.getPluginUrl('flag-icons')};});define('numerated-headers/nls/i18n',{"root":{"headerids.label.target":"Target","headerids.button.reset":"Reset","headerids.button.set":"Set"},"ca":true,"de":true,"mk":true,"pt-br":true,"ru":true,"uk":true,"zh-hans":true});define('numerated-headers/numerated-headers-plugin',['aloha/core','jquery','aloha/plugin','ui/ui','ui/toggleButton','i18n!numerated-headers/nls/i18n','i18n!aloha/nls/i18n'],function(Aloha,$,Plugin,Ui,ToggleButton,i18n,i18nCore){var editableConfigurations={};Aloha.bind('aloha-editable-destroyed',function(event,editable){delete editableConfigurations[editable.getId()];});return Plugin.create('numerated-headers',{config:{numeratedactive:true,headingselector:'h1, h2, h3, h4, h5, h6',trailingdot:false},init:function(){var that=this;this._formatNumeratedHeadersButton=Ui.adopt('formatNumeratedHeaders',ToggleButton,{tooltip:i18n.t('button.numeratedHeaders.tooltip'),icon:'aloha-icon aloha-icon-numerated-headers',scope:'Aloha.continuoustext',click:function(){var buttonPressed=that._formatNumeratedHeadersButton.getState();if(!buttonPressed){that.removeNumerations();}else{that.createNumeratedHeaders();}}});Aloha.bind('aloha-smart-content-changed',function(event){that.cleanNumerations();if(that.showNumbers()){that.createNumeratedHeaders();}});Aloha.bind('aloha-format-block',function(){that.cleanNumerations();if(that.showNumbers()){that.createNumeratedHeaders();}});Aloha.bind('aloha-editable-activated',function(event){if(that.isNumeratingOn()){that._formatNumeratedHeadersButton.show();that.initForEditable(Aloha.activeEditable.obj);}else{that._formatNumeratedHeadersButton.hide();}});},initForEditable:function($editable){var flag=$editable.attr('aloha-numerated-headers');if(flag!=='true'&&flag!=='false'){flag=(true===this.getCurrentConfig().numeratedactive)?'true':'false';$editable.attr('aloha-numerated-headers',flag);}
if(flag==='true'){this.createNumeratedHeaders();this._formatNumeratedHeadersButton.setState(true);}else{this._formatNumeratedHeadersButton.setState(false);}},getCurrentConfig:function(){var config=this.getEditableConfig(Aloha.activeEditable.obj);if(config.numeratedactive===true||config.numeratedactive==='true'||config.numeratedactive==='1'){config.numeratedactive=true;}else{config.numeratedactive=false;}
if(typeof config.headingselector!=='string'){config.headingselector='h1, h2, h3, h4, h5, h6';}
config.headingselector=$.trim(config.headingselector);if(config.trailingdot===true||config.trailingdot==='true'||config.trailingdot==='1'){config.trailingdot=true;}else{config.trailingdot=false;}
return config;},isNumeratingOn:function(){return this.getCurrentConfig().headingselector!=='';},showNumbers:function(){return(Aloha.activeEditable&&this.isNumeratingOn()&&(Aloha.activeEditable.obj.attr('aloha-numerated-headers')==='true'));},cleanNumerations:function(){var that=this;var active_editable_obj=this.getBaseElement();if(!active_editable_obj){return;}
this._saveRemoveAnnotations($(active_editable_obj).find('span[role=annotation]'));},_saveRemoveAnnotations:function(annotationcollection){var that=this;var range=Aloha.Selection.getRangeObject();var rangemod=false;annotationcollection.each(function(){if(range.startContainer===this||$.inArray(this,$(range.startContainer).parents())>-1){range.startContainer=that._prevNode(this);range.startOffset=0;rangemod=true;}
if(range.startContainer===this.parentNode&&range.startOffset>=$(this).index()&&range.startOffset>0){range.startOffset--;rangemod=true;}
if(range.endContainer===this||$.inArray(this,$(range.endContainer).parents())>-1){range.endContainer=that._prevNode(this);range.endOffset=0;rangemod=true;}
if(range.endContainer===this.parentNode&&range.endOffset>=$(this).index()&&range.endOffset>0){range.endOffset--;rangemod=true;}
$(this).remove();});if(rangemod===true){range.update();range.select();}},_prependAnnotation:function(annotationcontent,prependElem){var range=Aloha.Selection.getRangeObject();var rangemod=false;if(range.startContainer===prependElem){range.startOffset++;rangemod=true;}
if(range.endContainer===prependElem){range.endOffset++;rangemod=true;}
$(prependElem).prepend('<span role="annotation">'+
annotationcontent+'</span>');if(rangemod===true){range.update();range.select();}},_prevNode:function(node){var prev=node.previousSibling;if(!prev){return node.parentNode;}
while(prev.lastChild){prev=prev.lastChild;}
return prev;},removeNumerations:function(){$(Aloha.activeEditable.obj).attr('aloha-numerated-headers','false');this.cleanNumerations();},getBaseElement:function(){if(typeof this.baseobjectSelector!=='undefined'){return($(this.baseobjectSelector).length>0)?$(this.baseobjectSelector):null;}
return Aloha.activeEditable?Aloha.activeEditable.obj:null;},hasNote:function(obj){if(!obj||$(obj).length<=0){return false;}
return $(obj).find('span[role=annotation]').length>0;},hasContent:function(obj){if(!obj||0===$(obj).length){return false;}
var $objCleaned=$(obj).clone().find('span[role=annotation]').remove().end();return $.trim($objCleaned.text()).length>0;},createNumeratedHeaders:function(){var active_editable_obj=this.getBaseElement();if(!active_editable_obj){return;}
var config=this.getCurrentConfig();var headingselector=config.headingselector;var headers=active_editable_obj.find(headingselector);Aloha.activeEditable.obj.attr('aloha-numerated-headers','true');if(typeof headers==='undefined'||headers.length===0){return;}
var base_rank=7;var that=this;headers.each(function(){if(that.hasContent(this)){var current_rank=parseInt(this.nodeName.substr(1),10);if(current_rank<base_rank){base_rank=current_rank;}}});if(base_rank>6){return;}
var prev_rank=null,current_annotation=[],annotation_pos=0,i;for(i=0;i<(6-base_rank)+1;i++){current_annotation[i]=0;}
headers.each(function(){if(that.hasContent(this)){var current_rank=parseInt(this.nodeName.substr(1),10);if(prev_rank===null&&current_rank!==base_rank){that._saveRemoveAnnotations($(this).find('span[role=annotation]'));return;}else if(prev_rank===null){current_annotation[annotation_pos]++;}else if(current_rank>prev_rank){current_annotation[++annotation_pos]++;}else if(current_rank===prev_rank){current_annotation[annotation_pos]++;}else if(current_rank<prev_rank){var current_pos=current_rank-base_rank;var j;for(j=annotation_pos;j>(current_pos);j--){current_annotation[j]=0;}
annotation_pos=current_pos;current_annotation[annotation_pos]++;}
prev_rank=current_rank;var annotation_result='',i;if(config.trailingdot===true){annotation_result='';for(i=0;i<current_annotation.length;i++){if(current_annotation[i]!==0){annotation_result+=(current_annotation[i]+'.');}}}else{annotation_result=current_annotation[0];for(i=1;i<current_annotation.length;i++){if(current_annotation[i]!==0){annotation_result+=('.'+current_annotation[i]);}}}
annotation_result+='&nbsp;';if(that.hasNote(this)){$(this).find('span[role=annotation]').html(annotation_result);}else{that._prependAnnotation(annotation_result,this);}}else{if(that.hasNote(this)){that._saveRemoveAnnotations($(this).find('span[role=annotation]'));}}});}});});define('formatlesspaste/formatlesshandler',['aloha','jquery','aloha/contenthandlermanager'],function(Aloha,jQuery,ContentHandlerManager){var
GENTICS=window.GENTICS;var FormatlessPasteHandler=ContentHandlerManager.createHandler({enabled:false,handleContent:function(content){if(typeof content==='string'){content=jQuery('<div>'+content+'</div>');}else if(content instanceof jQuery){content=jQuery('<div>').append(content);}
if(content.find('.aloha-block').length>0){return;};if(this.enabled){this.removeFormatting(content);}
return content.html();},removeFormatting:function(jqPasteDiv){var formatting_elements=this.strippedElements;jqPasteDiv.find(formatting_elements.join(",")).each(function(){jQuery(this).contents().unwrap();});}});return FormatlessPasteHandler;});define('formatlesspaste/nls/i18n',{"root":{"button.formatlessPaste.tooltip":"Toggle Formatless Pasting"},"ca":true,"de":true,"mk":true,"pt-br":true,"ru":true,"uk":true,"zh-hans":true});define('formatlesspaste/formatlesspaste-plugin',['aloha/core','aloha/plugin','jquery','ui/ui','ui/toggleButton','formatlesspaste/formatlesshandler','aloha/contenthandlermanager','i18n!formatlesspaste/nls/i18n','i18n!aloha/nls/i18n'],function(Aloha,Plugin,jQuery,Ui,ToggleButton,FormatlessPasteHandler,ContentHandlerManager,i18n,i18nCore){return Plugin.create('formatlesspaste',{formatlessPasteOption:false,button:true,strippedElements:["a","em","strong","small","s","cite","q","dfn","abbr","time","code","var","samp","kbd","sub","sup","i","b","u","mark","ruby","rt","rp","bdi","bdo","ins","del"],init:function(){var that=this;if(typeof this.settings.formatlessPasteOption!=='undefined'){this.formatlessPasteOption=this.settings.formatlessPasteOption;}
if(typeof this.settings.strippedElements!=='undefined'){this.strippedElements=this.settings.strippedElements;}
if(this.settings.config){if(this.settings.config.formatlessPasteOption){this.formatlessPasteOption=this.settings.config.formatlessPasteOption;}
if(this.settings.config.strippedElements){this.strippedElements=this.settings.config.strippedElements;}
if(this.settings.config.button===false){this.button=false;}}
this.registerFormatlessPasteHandler();var formatlessPasteHandlerLastState;Aloha.bind('aloha-editable-activated',function(event,params){var config=that.getEditableConfig(params.editable.obj);if(!config){return;}
if(typeof config.button==='string'){config.button=config.button.toLowerCase();if(config.button==='false'||config.button==='0'){config.button=false;}else{config.button=true;}}
if(typeof config.formatlessPasteOption==='string'){config.formatlessPasteOption=config.formatlessPasteOption.toLowerCase();if(config.formatlessPasteOption==='false'||config.formatlessPasteOption==='0'){config.formatlessPasteOption=false;}else{config.formatlessPasteOption=true;}}
if(config.strippedElements){FormatlessPasteHandler.strippedElements=config.strippedElements;}
if(config.formatlessPasteOption===true){that._toggleFormatlessPasteButton.setState(true);FormatlessPasteHandler.enabled=true;}else if(config.formatlessPasteOption===false){that._toggleFormatlessPasteButton.setState(false);FormatlessPasteHandler.enabled=false;}
if(config.button===false){that._toggleFormatlessPasteButton.show(false);}else{that._toggleFormatlessPasteButton.show(true);}});},registerFormatlessPasteHandler:function(){ContentHandlerManager.register('formatless',FormatlessPasteHandler);FormatlessPasteHandler.strippedElements=this.strippedElements;this._toggleFormatlessPasteButton=Ui.adopt('toggleFormatlessPaste',ToggleButton,{tooltip:i18n.t('button.formatlessPaste.tooltip'),icon:'aloha-icon aloha-icon-formatless-paste',scope:'Aloha.continuoustext',click:function(){FormatlessPasteHandler.enabled=!FormatlessPasteHandler.enabled;}});if(this.formatlessPasteOption===true){this._toggleFormatlessPasteButton.setState(true);FormatlessPasteHandler.enabled=true;}
if(this.button===false){this._toggleFormatlessPasteButton.show(false);}}});});(function(){var initializing=false,fnTest=/xyz/.test(function(){xyz;})?/\b_super\b/:/.*/;this.Class=function(){};Class.extend=function(){var _super=this.prototype;initializing=true;var prototype=new this();initializing=false;for(var i=0;i<arguments.length;i++){var prop=arguments[i];for(var name in prop){prototype[name]=typeof prop[name]=="function"&&typeof _super[name]=="function"&&fnTest.test(prop[name])?(function(name,fn){return function(){var tmp=this._super;this._super=_super[name];var ret=fn.apply(this,arguments);this._super=tmp;return ret;};})(name,prop[name]):prop[name];}}
function Class(){if(!initializing&&this.init)
this.init.apply(this,arguments);}
Class.prototype=prototype;Class.constructor=Class;Class.extend=arguments.callee;return Class;};})();if(typeof define==='function'){define('Class',[],function(){return Class;});};define('jstree',['jquery'],function(jQuery){var $=jQuery;(function(){if(jQuery&&jQuery.jstree){return;}
var is_ie6=false,is_ie7=false,is_ff2=false;(function($){$.vakata={};$.vakata.css={get_css:function(rule_name,delete_flag,sheet){rule_name=rule_name.toLowerCase();var css_rules=sheet.cssRules||sheet.rules,j=0;do{if(css_rules.length&&j>css_rules.length+5){return false;}
if(css_rules[j].selectorText&&css_rules[j].selectorText.toLowerCase()==rule_name){if(delete_flag===true){if(sheet.removeRule){sheet.removeRule(j);}
if(sheet.deleteRule){sheet.deleteRule(j);}
return true;}
else{return css_rules[j];}}}
while(css_rules[++j]);return false;},add_css:function(rule_name,sheet){if($.jstree.css.get_css(rule_name,false,sheet)){return false;}
if(sheet.insertRule){sheet.insertRule(rule_name+' { }',0);}else{sheet.addRule(rule_name,null,0);}
return $.vakata.css.get_css(rule_name);},remove_css:function(rule_name,sheet){return $.vakata.css.get_css(rule_name,true,sheet);},add_sheet:function(opts){var tmp=false,is_new=true;if(opts.str){if(opts.title){tmp=$("style[id='"+opts.title+"-stylesheet']")[0];}
if(tmp){is_new=false;}
else{tmp=document.createElement("style");tmp.setAttribute('type',"text/css");if(opts.title){tmp.setAttribute("id",opts.title+"-stylesheet");}}
if(tmp.styleSheet){if(is_new){document.getElementsByTagName("head")[0].appendChild(tmp);tmp.styleSheet.cssText=opts.str;}
else{tmp.styleSheet.cssText=tmp.styleSheet.cssText+" "+opts.str;}}
else{tmp.appendChild(document.createTextNode(opts.str));document.getElementsByTagName("head")[0].appendChild(tmp);}
return tmp.sheet||tmp.styleSheet;}
if(opts.url){if(document.createStyleSheet){try{tmp=document.createStyleSheet(opts.url);}catch(e){}}
else{tmp=document.createElement('link');tmp.rel='stylesheet';tmp.type='text/css';tmp.media="all";tmp.href=opts.url;document.getElementsByTagName("head")[0].appendChild(tmp);return tmp.styleSheet;}}}};var instances=[],focused_instance=-1,plugins={},prepared_move={};$.fn.jstree=function(settings){var isMethodCall=(typeof settings=='string'),args=Array.prototype.slice.call(arguments,1),returnValue=this;if(isMethodCall){if(settings.substring(0,1)=='_'){return returnValue;}
this.each(function(){var instance=instances[$.data(this,"jstree-instance-id")],methodValue=(instance&&$.isFunction(instance[settings]))?instance[settings].apply(instance,args):instance;if(typeof methodValue!=="undefined"&&(settings.indexOf("is_")===0||(methodValue!==true&&methodValue!==false))){returnValue=methodValue;return false;}});}
else{this.each(function(){var instance_id=$.data(this,"jstree-instance-id"),a=[],b=settings?$.extend({},true,settings):{},c=$(this),s=false,t=[];a=a.concat(args);if(c.data("jstree")){a.push(c.data("jstree"));}
b=a.length?$.extend.apply(null,[true,b].concat(a)):b;if(typeof instance_id!=="undefined"&&instances[instance_id]){instances[instance_id].destroy();}
instance_id=parseInt(instances.push({}),10)-1;$.data(this,"jstree-instance-id",instance_id);b.plugins=$.isArray(b.plugins)?b.plugins:$.jstree.defaults.plugins.slice();b.plugins.unshift("core");b.plugins=b.plugins.sort().join(",,").replace(/(,|^)([^,]+)(,,\2)+(,|$)/g,"$1$2$4").replace(/,,+/g,",").replace(/,$/,"").split(",");s=$.extend(true,{},$.jstree.defaults,b);s.plugins=b.plugins;$.each(plugins,function(i,val){if($.inArray(i,s.plugins)===-1){s[i]=null;delete s[i];}
else{t.push(i);}});s.plugins=t;instances[instance_id]=new $.jstree._instance(instance_id,$(this).addClass("jstree jstree-"+instance_id),s);$.each(instances[instance_id]._get_settings().plugins,function(i,val){instances[instance_id].data[val]={};});$.each(instances[instance_id]._get_settings().plugins,function(i,val){if(plugins[val]){plugins[val].__init.apply(instances[instance_id]);}});setTimeout(function(){instances[instance_id].init();},0);});}
return returnValue;};$.jstree={defaults:{plugins:[]},_focused:function(){return instances[focused_instance]||null;},_reference:function(needle){if(instances[needle]){return instances[needle];}
var o=$(needle);if(!o.length&&typeof needle==="string"){o=$("#"+needle);}
if(!o.length){return null;}
return instances[o.closest(".jstree").data("jstree-instance-id")]||null;},_instance:function(index,container,settings){this.data={core:{}};this.get_settings=function(){return $.extend(true,{},settings);};this._get_settings=function(){return settings;};this.get_index=function(){return index;};this.get_container=function(){return container;};this.get_container_ul=function(){return container.children("ul:eq(0)");};this._set_settings=function(s){settings=$.extend(true,{},settings,s);};},_fn:{},plugin:function(pname,pdata){pdata=$.extend({},{__init:$.noop,__destroy:$.noop,_fn:{},defaults:false},pdata);plugins[pname]=pdata;$.jstree.defaults[pname]=pdata.defaults;$.each(pdata._fn,function(i,val){val.plugin=pname;val.old=$.jstree._fn[i];$.jstree._fn[i]=function(){var rslt,func=val,args=Array.prototype.slice.call(arguments),evnt=new $.Event("before.jstree"),rlbk=false;if(this.data.core.locked===true&&i!=="unlock"&&i!=="is_locked"){return;}
do{if(func&&func.plugin&&$.inArray(func.plugin,this._get_settings().plugins)!==-1){break;}
func=func.old;}while(func);if(!func){return;}
if(i.indexOf("_")===0){rslt=func.apply(this,args);}
else{rslt=this.get_container().triggerHandler(evnt,{"func":i,"inst":this,"args":args,"plugin":func.plugin});if(rslt===false){return;}
if(typeof rslt!=="undefined"){args=rslt;}
rslt=func.apply($.extend({},this,{__callback:function(data){this.get_container().triggerHandler(i+'.jstree',{"inst":this,"args":args,"rslt":data,"rlbk":rlbk});},__rollback:function(){rlbk=this.get_rollback();return rlbk;},__call_old:function(replace_arguments){return func.old.apply(this,(replace_arguments?Array.prototype.slice.call(arguments,1):args));}}),args);}
return rslt;};$.jstree._fn[i].old=val.old;$.jstree._fn[i].plugin=pname;});},rollback:function(rb){if(rb){if(!$.isArray(rb)){rb=[rb];}
$.each(rb,function(i,val){instances[val.i].set_rollback(val.h,val.d);});}}};$.jstree._fn=$.jstree._instance.prototype={};$(function(){var u=navigator.userAgent.toLowerCase(),v=(u.match(/.+?(?:rv|it|ra|ie)[\/: ]([\d.]+)/)||[0,'0'])[1],css_string=''+'.jstree ul, .jstree li { display:block; margin:0 0 0 0; padding:0 0 0 0; list-style-type:none; } '+'.jstree li { display:block; min-height:18px; line-height:18px; white-space:nowrap; margin-left:18px; min-width:18px; } '+'.jstree-rtl li { margin-left:0; margin-right:18px; } '+'.jstree > ul > li { margin-left:0px; } '+'.jstree-rtl > ul > li { margin-right:0px; } '+'.jstree ins { display:inline-block; text-decoration:none; width:18px; height:18px; margin:0 0 0 0; padding:0; } '+'.jstree a { display:inline-block; line-height:16px; height:16px; color:black; white-space:nowrap; text-decoration:none; padding:1px 2px; margin:0; } '+'.jstree a:focus { outline: none; } '+'.jstree a > ins { height:16px; width:16px; } '+'.jstree a > .jstree-icon { margin-right:3px; } '+'.jstree-rtl a > .jstree-icon { margin-left:3px; margin-right:0; } '+'li.jstree-open > ul { display:block; } '+'li.jstree-closed > ul { display:none; } ';if(/msie/.test(u)&&parseInt(v,10)==6){is_ie6=true;try{document.execCommand("BackgroundImageCache",false,true);}catch(err){}
css_string+=''+'.jstree li { height:18px; margin-left:0; margin-right:0; } '+'.jstree li li { margin-left:18px; } '+'.jstree-rtl li li { margin-left:0px; margin-right:18px; } '+'li.jstree-open ul { display:block; } '+'li.jstree-closed ul { display:none !important; } '+'.jstree li a { display:inline; border-width:0 !important; padding:0px 2px !important; } '+'.jstree li a ins { height:16px; width:16px; margin-right:3px; } '+'.jstree-rtl li a ins { margin-right:0px; margin-left:3px; } ';}
if(/msie/.test(u)&&parseInt(v,10)==7){is_ie7=true;css_string+='.jstree li a { border-width:0 !important; padding:0px 2px !important; } ';}
if(!/compatible/.test(u)&&/mozilla/.test(u)&&parseFloat(v,10)<1.9){is_ff2=true;css_string+=''+'.jstree ins { display:-moz-inline-box; } '+'.jstree li { line-height:12px; } '+'.jstree a { display:-moz-inline-box; } '+'.jstree .jstree-no-icons .jstree-checkbox { display:-moz-inline-stack !important; } ';}
$.vakata.css.add_sheet({str:css_string,title:"jstree"});});$.jstree.plugin("core",{__init:function(){this.data.core.locked=false;this.data.core.to_open=this.get_settings().core.initially_open;this.data.core.to_load=this.get_settings().core.initially_load;},defaults:{html_titles:false,animation:500,initially_open:[],initially_load:[],open_parents:true,notify_plugins:true,rtl:false,load_open:false,strings:{loading:"Loading ...",new_node:"New node",multiple_selection:"Multiple selection"}},_fn:{init:function(){this.set_focus();if(this._get_settings().core.rtl){this.get_container().addClass("jstree-rtl").css("direction","rtl");}
this.get_container().html("<ul><li class='jstree-last jstree-leaf'><ins>&#160;</ins><a class='jstree-loading' href='#'><ins class='jstree-icon'>&#160;</ins>"+this._get_string("loading")+"</a></li></ul>");this.data.core.li_height=this.get_container_ul().find("li.jstree-closed, li.jstree-leaf").eq(0).height()||18;this.get_container().delegate("li > ins","click.jstree",$.proxy(function(event){var trgt=$(event.target);if(trgt.is("ins")&&event.pageY-trgt.offset().top<this.data.core.li_height){this.toggle_node(trgt);}},this)).bind("mousedown.jstree",$.proxy(function(){this.set_focus();},this)).bind("dblclick.jstree",function(event){var sel;if(document.selection&&document.selection.empty){document.selection.empty();}
else{if(window.getSelection){sel=window.getSelection();try{sel.removeAllRanges();sel.collapse();}catch(err){}}}});if(this._get_settings().core.notify_plugins){this.get_container().bind("load_node.jstree",$.proxy(function(e,data){var o=this._get_node(data.rslt.obj),t=this;if(o===-1){o=this.get_container_ul();}
if(!o.length){return;}
o.find("li").each(function(){var th=$(this);if(th.data("jstree")){$.each(th.data("jstree"),function(plugin,values){if(t.data[plugin]&&$.isFunction(t["_"+plugin+"_notify"])){t["_"+plugin+"_notify"].call(t,th,values);}});}});},this));}
if(this._get_settings().core.load_open){this.get_container().bind("load_node.jstree",$.proxy(function(e,data){var o=this._get_node(data.rslt.obj),t=this;if(o===-1){o=this.get_container_ul();}
if(!o.length){return;}
o.find("li.jstree-open:not(:has(ul))").each(function(){t.load_node(this,$.noop,$.noop);});},this));}
this.__callback();this.load_node(-1,function(){this.loaded();this.reload_nodes();});},destroy:function(){var i,n=this.get_index(),s=this._get_settings(),_this=this;$.each(s.plugins,function(i,val){try{plugins[val].__destroy.apply(_this);}catch(err){}});this.__callback();if(this.is_focused()){for(i in instances){if(instances.hasOwnProperty(i)&&i!=n){instances[i].set_focus();break;}}}
if(n===focused_instance){focused_instance=-1;}
this.get_container().unbind(".jstree").undelegate(".jstree").removeData("jstree-instance-id").find("[class^='jstree']").andSelf().attr("class",function(){return this.className.replace(/jstree[^ ]*|$/ig,'');});$(document).unbind(".jstree-"+n).undelegate(".jstree-"+n);instances[n]=null;delete instances[n];},_core_notify:function(n,data){if(data.opened){this.open_node(n,false,true);}},lock:function(){this.data.core.locked=true;this.get_container().children("ul").addClass("jstree-locked").css("opacity","0.7");this.__callback({});},unlock:function(){this.data.core.locked=false;this.get_container().children("ul").removeClass("jstree-locked").css("opacity","1");this.__callback({});},is_locked:function(){return this.data.core.locked;},save_opened:function(){var _this=this;this.data.core.to_open=[];this.get_container_ul().find("li.jstree-open").each(function(){if(this.id){_this.data.core.to_open.push("#"+this.id.toString().replace(/^#/,"").replace(/\\\//g,"/").replace(/\//g,"\\\/").replace(/\\\./g,".").replace(/\./g,"\\.").replace(/\:/g,"\\:"));}});this.__callback(_this.data.core.to_open);},save_loaded:function(){},reload_nodes:function(is_callback){var _this=this,done=true,current=[],remaining=[];if(!is_callback){this.data.core.reopen=false;this.data.core.refreshing=true;this.data.core.to_open=$.map($.makeArray(this.data.core.to_open),function(n){return"#"+n.toString().replace(/^#/,"").replace(/\\\//g,"/").replace(/\//g,"\\\/").replace(/\\\./g,".").replace(/\./g,"\\.").replace(/\:/g,"\\:");});this.data.core.to_load=$.map($.makeArray(this.data.core.to_load),function(n){return"#"+n.toString().replace(/^#/,"").replace(/\\\//g,"/").replace(/\//g,"\\\/").replace(/\\\./g,".").replace(/\./g,"\\.").replace(/\:/g,"\\:");});if(this.data.core.to_open.length){this.data.core.to_load=this.data.core.to_load.concat(this.data.core.to_open);}}
if(this.data.core.to_load.length){$.each(this.data.core.to_load,function(i,val){if(val=="#"){return true;}
if($(val).length){current.push(val);}
else{remaining.push(val);}});if(current.length){this.data.core.to_load=remaining;$.each(current,function(i,val){if(!_this._is_loaded(val)){_this.load_node(val,function(){_this.reload_nodes(true);},function(){_this.reload_nodes(true);});done=false;}});}}
if(this.data.core.to_open.length){$.each(this.data.core.to_open,function(i,val){_this.open_node(val,false,true);});}
if(done){if(this.data.core.reopen){clearTimeout(this.data.core.reopen);}
this.data.core.reopen=setTimeout(function(){_this.__callback({},_this);},50);this.data.core.refreshing=false;this.reopen();}},reopen:function(){var _this=this;if(this.data.core.to_open.length){$.each(this.data.core.to_open,function(i,val){_this.open_node(val,false,true);});}
this.__callback({});},refresh:function(obj){var _this=this;this.save_opened();if(!obj){obj=-1;}
obj=this._get_node(obj);if(!obj){obj=-1;}
if(obj!==-1){obj.children("UL").remove();}
else{this.get_container_ul().empty();}
this.load_node(obj,function(){_this.__callback({"obj":obj});_this.reload_nodes();});},loaded:function(){this.__callback();},set_focus:function(){if(this.is_focused()){return;}
var f=$.jstree._focused();if(f){f.unset_focus();}
this.get_container().addClass("jstree-focused");focused_instance=this.get_index();this.__callback();},is_focused:function(){return focused_instance==this.get_index();},unset_focus:function(){if(this.is_focused()){this.get_container().removeClass("jstree-focused");focused_instance=-1;}
this.__callback();},_get_node:function(obj){var $obj=$(obj,this.get_container());if($obj.is(".jstree")||obj==-1){return-1;}
$obj=$obj.closest("li",this.get_container());return $obj.length?$obj:false;},_get_next:function(obj,strict){obj=this._get_node(obj);if(obj===-1){return this.get_container().find("> ul > li:first-child");}
if(!obj.length){return false;}
if(strict){return(obj.nextAll("li").size()>0)?obj.nextAll("li:eq(0)"):false;}
if(obj.hasClass("jstree-open")){return obj.find("li:eq(0)");}
else if(obj.nextAll("li").size()>0){return obj.nextAll("li:eq(0)");}
else{return obj.parentsUntil(".jstree","li").next("li").eq(0);}},_get_prev:function(obj,strict){obj=this._get_node(obj);if(obj===-1){return this.get_container().find("> ul > li:last-child");}
if(!obj.length){return false;}
if(strict){return(obj.prevAll("li").length>0)?obj.prevAll("li:eq(0)"):false;}
if(obj.prev("li").length){obj=obj.prev("li").eq(0);while(obj.hasClass("jstree-open")){obj=obj.children("ul:eq(0)").children("li:last");}
return obj;}
else{var o=obj.parentsUntil(".jstree","li:eq(0)");return o.length?o:false;}},_get_parent:function(obj){obj=this._get_node(obj);if(obj==-1||!obj.length){return false;}
var o=obj.parentsUntil(".jstree","li:eq(0)");return o.length?o:-1;},_get_children:function(obj){obj=this._get_node(obj);if(obj===-1){return this.get_container().children("ul:eq(0)").children("li");}
if(!obj.length){return false;}
return obj.children("ul:eq(0)").children("li");},get_path:function(obj,id_mode){var p=[],_this=this;obj=this._get_node(obj);if(obj===-1||!obj||!obj.length){return false;}
obj.parentsUntil(".jstree","li").each(function(){p.push(id_mode?this.id:_this.get_text(this));});p.reverse();p.push(id_mode?obj.attr("id"):this.get_text(obj));return p;},_get_string:function(key){return this._get_settings().core.strings[key]||key;},is_open:function(obj){obj=this._get_node(obj);return obj&&obj!==-1&&obj.hasClass("jstree-open");},is_closed:function(obj){obj=this._get_node(obj);return obj&&obj!==-1&&obj.hasClass("jstree-closed");},is_leaf:function(obj){obj=this._get_node(obj);return obj&&obj!==-1&&obj.hasClass("jstree-leaf");},correct_state:function(obj){obj=this._get_node(obj);if(!obj||obj===-1){return false;}
obj.removeClass("jstree-closed jstree-open").addClass("jstree-leaf").children("ul").remove();this.__callback({"obj":obj});},open_node:function(obj,callback,skip_animation){obj=this._get_node(obj);if(!obj.length){return false;}
if(!obj.hasClass("jstree-closed")){if(callback){callback.call();}return false;}
var s=skip_animation||is_ie6?0:this._get_settings().core.animation,t=this;if(!this._is_loaded(obj)){obj.children("a").addClass("jstree-loading");this.load_node(obj,function(){t.open_node(obj,callback,skip_animation);},callback);}
else{if(this._get_settings().core.open_parents){obj.parentsUntil(".jstree",".jstree-closed").each(function(){t.open_node(this,false,true);});}
if(s){obj.children("ul").css("display","none");}
obj.removeClass("jstree-closed").addClass("jstree-open").children("a").removeClass("jstree-loading");if(s){obj.children("ul").stop(true,true).slideDown(s,function(){this.style.display="";t.after_open(obj);});}
else{t.after_open(obj);}
this.__callback({"obj":obj});if(callback){callback.call();}}},after_open:function(obj){this.__callback({"obj":obj});},close_node:function(obj,skip_animation){obj=this._get_node(obj);var s=skip_animation||is_ie6?0:this._get_settings().core.animation,t=this;if(!obj.length||!obj.hasClass("jstree-open")){return false;}
if(s){obj.children("ul").attr("style","display:block !important");}
obj.removeClass("jstree-open").addClass("jstree-closed");if(s){obj.children("ul").stop(true,true).slideUp(s,function(){this.style.display="";t.after_close(obj);});}
else{t.after_close(obj);}
this.__callback({"obj":obj});},after_close:function(obj){this.__callback({"obj":obj});},toggle_node:function(obj){obj=this._get_node(obj);if(obj.hasClass("jstree-closed")){return this.open_node(obj);}
if(obj.hasClass("jstree-open")){return this.close_node(obj);}},open_all:function(obj,do_animation,original_obj){obj=obj?this._get_node(obj):-1;if(!obj||obj===-1){obj=this.get_container_ul();}
if(original_obj){obj=obj.find("li.jstree-closed");}
else{original_obj=obj;if(obj.is(".jstree-closed")){obj=obj.find("li.jstree-closed").andSelf();}
else{obj=obj.find("li.jstree-closed");}}
var _this=this;obj.each(function(){var __this=this;if(!_this._is_loaded(this)){_this.open_node(this,function(){_this.open_all(__this,do_animation,original_obj);},!do_animation);}
else{_this.open_node(this,false,!do_animation);}});if(original_obj.find('li.jstree-closed').length===0){this.__callback({"obj":original_obj});}},close_all:function(obj,do_animation){var _this=this;obj=obj?this._get_node(obj):this.get_container();if(!obj||obj===-1){obj=this.get_container_ul();}
obj.find("li.jstree-open").andSelf().each(function(){_this.close_node(this,!do_animation);});this.__callback({"obj":obj});},clean_node:function(obj){obj=obj&&obj!=-1?$(obj):this.get_container_ul();obj=obj.is("li")?obj.find("li").andSelf():obj.find("li");obj.removeClass("jstree-last").filter("li:last-child").addClass("jstree-last").end().filter(":has(li)").not(".jstree-open").removeClass("jstree-leaf").addClass("jstree-closed");obj.not(".jstree-open, .jstree-closed").addClass("jstree-leaf").children("ul").remove();this.__callback({"obj":obj});},get_rollback:function(){this.__callback();return{i:this.get_index(),h:this.get_container().children("ul").clone(true),d:this.data};},set_rollback:function(html,data){this.get_container().empty().append(html);this.data=data;this.__callback();},load_node:function(obj,s_call,e_call){this.__callback({"obj":obj});},_is_loaded:function(obj){return true;},create_node:function(obj,position,js,callback,is_loaded){obj=this._get_node(obj);position=typeof position==="undefined"?"last":position;var d=$("<li />"),s=this._get_settings().core,tmp;if(obj!==-1&&!obj.length){return false;}
if(!is_loaded&&!this._is_loaded(obj)){this.load_node(obj,function(){this.create_node(obj,position,js,callback,true);});return false;}
this.__rollback();if(typeof js==="string"){js={"data":js};}
if(!js){js={};}
if(js.attr){d.attr(js.attr);}
if(js.metadata){d.data(js.metadata);}
if(js.state){d.addClass("jstree-"+js.state);}
if(!js.data){js.data=this._get_string("new_node");}
if(!$.isArray(js.data)){tmp=js.data;js.data=[];js.data.push(tmp);}
$.each(js.data,function(i,m){tmp=$("<a />");if($.isFunction(m)){m=m.call(this,js);}
if(typeof m=="string"){tmp.attr('href','#')[s.html_titles?"html":"text"](m);}
else{if(!m.attr){m.attr={};}
if(!m.attr.href){m.attr.href='#';}
tmp.attr(m.attr)[s.html_titles?"html":"text"](m.title);if(m.language){tmp.addClass(m.language);}}
tmp.prepend("<ins class='jstree-icon'>&#160;</ins>");if(m.icon){if(m.icon.indexOf("/")===-1){tmp.children("ins").addClass(m.icon);}
else{tmp.children("ins").css("background","url('"+m.icon+"') center center no-repeat");}}
d.append(tmp);});d.prepend("<ins class='jstree-icon'>&#160;</ins>");if(obj===-1){obj=this.get_container();if(position==="before"){position="first";}
if(position==="after"){position="last";}}
switch(position){case"before":obj.before(d);tmp=this._get_parent(obj);break;case"after":obj.after(d);tmp=this._get_parent(obj);break;case"inside":case"first":if(!obj.children("ul").length){obj.append("<ul />");}
obj.children("ul").prepend(d);tmp=obj;break;case"last":if(!obj.children("ul").length){obj.append("<ul />");}
obj.children("ul").append(d);tmp=obj;break;default:if(!obj.children("ul").length){obj.append("<ul />");}
if(!position){position=0;}
tmp=obj.children("ul").children("li").eq(position);if(tmp.length){tmp.before(d);}
else{obj.children("ul").append(d);}
tmp=obj;break;}
if(tmp===-1||tmp.get(0)===this.get_container().get(0)){tmp=-1;}
this.clean_node(tmp);this.__callback({"obj":d,"parent":tmp});if(callback){callback.call(this,d);}
return d;},get_text:function(obj){obj=this._get_node(obj);if(!obj.length){return false;}
var s=this._get_settings().core.html_titles;obj=obj.children("a:eq(0)");if(s){obj=obj.clone();obj.children("INS").remove();return obj.html();}
else{obj=obj.contents().filter(function(){return this.nodeType==3;})[0];return obj.nodeValue;}},set_text:function(obj,val){obj=this._get_node(obj);if(!obj.length){return false;}
obj=obj.children("a:eq(0)");if(this._get_settings().core.html_titles){var tmp=obj.children("INS").clone();obj.html(val).prepend(tmp);this.__callback({"obj":obj,"name":val});return true;}
else{obj=obj.contents().filter(function(){return this.nodeType==3;})[0];this.__callback({"obj":obj,"name":val});return(obj.nodeValue=val);}},rename_node:function(obj,val){obj=this._get_node(obj);this.__rollback();if(obj&&obj.length&&this.set_text.apply(this,Array.prototype.slice.call(arguments))){this.__callback({"obj":obj,"name":val});}},delete_node:function(obj){obj=this._get_node(obj);if(!obj.length){return false;}
this.__rollback();var p=this._get_parent(obj),prev=$([]),t=this;obj.each(function(){prev=prev.add(t._get_prev(this));});obj=obj.detach();if(p!==-1&&p.find("> ul > li").length===0){p.removeClass("jstree-open jstree-closed").addClass("jstree-leaf");}
this.clean_node(p);this.__callback({"obj":obj,"prev":prev,"parent":p});return obj;},prepare_move:function(o,r,pos,cb,is_cb){var p={};p.ot=$.jstree._reference(o)||this;p.o=p.ot._get_node(o);p.r=r===-1?-1:this._get_node(r);p.p=(typeof pos==="undefined"||pos===false)?"last":pos;if(!is_cb&&prepared_move.o&&prepared_move.o[0]===p.o[0]&&prepared_move.r[0]===p.r[0]&&prepared_move.p===p.p){this.__callback(prepared_move);if(cb){cb.call(this,prepared_move);}
return;}
p.ot=$.jstree._reference(p.o)||this;p.rt=$.jstree._reference(p.r)||this;if(p.r===-1||!p.r){p.cr=-1;switch(p.p){case"first":case"before":case"inside":p.cp=0;break;case"after":case"last":p.cp=p.rt.get_container().find(" > ul > li").length;break;default:p.cp=p.p;break;}}
else{if(!/^(before|after)$/.test(p.p)&&!this._is_loaded(p.r)){return this.load_node(p.r,function(){this.prepare_move(o,r,pos,cb,true);});}
switch(p.p){case"before":p.cp=p.r.index();p.cr=p.rt._get_parent(p.r);break;case"after":p.cp=p.r.index()+1;p.cr=p.rt._get_parent(p.r);break;case"inside":case"first":p.cp=0;p.cr=p.r;break;case"last":p.cp=p.r.find(" > ul > li").length;p.cr=p.r;break;default:p.cp=p.p;p.cr=p.r;break;}}
p.np=p.cr==-1?p.rt.get_container():p.cr;p.op=p.ot._get_parent(p.o);p.cop=p.o.index();if(p.op===-1){p.op=p.ot?p.ot.get_container():this.get_container();}
if(!/^(before|after)$/.test(p.p)&&p.op&&p.np&&p.op[0]===p.np[0]&&p.o.index()<p.cp){p.cp++;}
p.or=p.np.find(" > ul > li:nth-child("+(p.cp+1)+")");prepared_move=p;this.__callback(prepared_move);if(cb){cb.call(this,prepared_move);}},check_move:function(){var obj=prepared_move,ret=true,r=obj.r===-1?this.get_container():obj.r;if(!obj||!obj.o||obj.or[0]===obj.o[0]){return false;}
if(obj.op&&obj.np&&obj.op[0]===obj.np[0]&&obj.cp-1===obj.o.index()){return false;}
obj.o.each(function(){if(r.parentsUntil(".jstree","li").andSelf().index(this)!==-1){ret=false;return false;}});return ret;},move_node:function(obj,ref,position,is_copy,is_prepared,skip_check){if(!is_prepared){return this.prepare_move(obj,ref,position,function(p){this.move_node(p,false,false,is_copy,true,skip_check);});}
if(is_copy){prepared_move.cy=true;}
if(!skip_check&&!this.check_move()){return false;}
this.__rollback();var o=false;if(is_copy){o=obj.o.clone(true);o.find("*[id]").andSelf().each(function(){if(this.id){this.id="copy_"+this.id;}});}
else{o=obj.o;}
if(obj.or.length){obj.or.before(o);}
else{if(!obj.np.children("ul").length){$("<ul />").appendTo(obj.np);}
obj.np.children("ul:eq(0)").append(o);}
try{obj.ot.clean_node(obj.op);obj.rt.clean_node(obj.np);if(!obj.op.find("> ul > li").length){obj.op.removeClass("jstree-open jstree-closed").addClass("jstree-leaf").children("ul").remove();}}catch(e){}
if(is_copy){prepared_move.cy=true;prepared_move.oc=o;}
this.__callback(prepared_move);return prepared_move;},_get_move:function(){return prepared_move;}}});})(jQuery);(function($){var scrollbar_width,e1,e2;$(function(){if(/msie/.test(navigator.userAgent.toLowerCase())){e1=$('<textarea cols="10" rows="2"></textarea>').css({position:'absolute',top:-1000,left:0}).appendTo('body');e2=$('<textarea cols="10" rows="2" style="overflow: hidden;"></textarea>').css({position:'absolute',top:-1000,left:0}).appendTo('body');scrollbar_width=e1.width()-e2.width();e1.add(e2).remove();}
else{e1=$('<div />').css({width:100,height:100,overflow:'auto',position:'absolute',top:-1000,left:0}).prependTo('body').append('<div />').find('div').css({width:'100%',height:200});scrollbar_width=100-e1.width();e1.parent().remove();}});$.jstree.plugin("ui",{__init:function(){this.data.ui.selected=$();this.data.ui.last_selected=false;this.data.ui.hovered=null;this.data.ui.to_select=this.get_settings().ui.initially_select;this.get_container().delegate("a","click.jstree",$.proxy(function(event){event.preventDefault();event.currentTarget.blur();if(!$(event.currentTarget).hasClass("jstree-loading")){this.select_node(event.currentTarget,true,event);}},this)).delegate("a","mouseenter.jstree",$.proxy(function(event){if(!$(event.currentTarget).hasClass("jstree-loading")){this.hover_node(event.target);}},this)).delegate("a","mouseleave.jstree",$.proxy(function(event){if(!$(event.currentTarget).hasClass("jstree-loading")){this.dehover_node(event.target);}},this)).bind("reopen.jstree",$.proxy(function(){this.reselect();},this)).bind("get_rollback.jstree",$.proxy(function(){this.dehover_node();this.save_selected();},this)).bind("set_rollback.jstree",$.proxy(function(){this.reselect();},this)).bind("close_node.jstree",$.proxy(function(event,data){var s=this._get_settings().ui,obj=this._get_node(data.rslt.obj),clk=(obj&&obj.length)?obj.children("ul").find("a.jstree-clicked"):$(),_this=this;if(s.selected_parent_close===false||!clk.length){return;}
clk.each(function(){_this.deselect_node(this);if(s.selected_parent_close==="select_parent"){_this.select_node(obj);}});},this)).bind("delete_node.jstree",$.proxy(function(event,data){var s=this._get_settings().ui.select_prev_on_delete,obj=this._get_node(data.rslt.obj),clk=(obj&&obj.length)?obj.find("a.jstree-clicked"):[],_this=this;clk.each(function(){_this.deselect_node(this);});if(s&&clk.length){data.rslt.prev.each(function(){if(this.parentNode){_this.select_node(this);return false;}});}},this)).bind("move_node.jstree",$.proxy(function(event,data){if(data.rslt.cy){data.rslt.oc.find("a.jstree-clicked").removeClass("jstree-clicked");}},this));},defaults:{select_limit:-1,select_multiple_modifier:"ctrl",select_range_modifier:"shift",selected_parent_close:"select_parent",selected_parent_open:true,select_prev_on_delete:true,disable_selecting_children:false,initially_select:[]},_fn:{_get_node:function(obj,allow_multiple){if(typeof obj==="undefined"||obj===null){return allow_multiple?this.data.ui.selected:this.data.ui.last_selected;}
var $obj=$(obj,this.get_container());if($obj.is(".jstree")||obj==-1){return-1;}
$obj=$obj.closest("li",this.get_container());return $obj.length?$obj:false;},_ui_notify:function(n,data){if(data.selected){this.select_node(n,false);}},save_selected:function(){var _this=this;this.data.ui.to_select=[];this.data.ui.selected.each(function(){if(this.id){_this.data.ui.to_select.push("#"+this.id.toString().replace(/^#/,"").replace(/\\\//g,"/").replace(/\//g,"\\\/").replace(/\\\./g,".").replace(/\./g,"\\.").replace(/\:/g,"\\:"));}});this.__callback(this.data.ui.to_select);},reselect:function(){var _this=this,s=this.data.ui.to_select;s=$.map($.makeArray(s),function(n){return"#"+n.toString().replace(/^#/,"").replace(/\\\//g,"/").replace(/\//g,"\\\/").replace(/\\\./g,".").replace(/\./g,"\\.").replace(/\:/g,"\\:");});$.each(s,function(i,val){if(val&&val!=="#"){_this.select_node(val);}});this.data.ui.selected=this.data.ui.selected.filter(function(){return this.parentNode;});this.__callback();},refresh:function(obj){this.save_selected();return this.__call_old();},hover_node:function(obj){obj=this._get_node(obj);if(!obj.length){return false;}
if(!obj.hasClass("jstree-hovered")){this.dehover_node();}
this.data.ui.hovered=obj.children("a").addClass("jstree-hovered").parent();this._fix_scroll(obj);this.__callback({"obj":obj});},dehover_node:function(){var obj=this.data.ui.hovered,p;if(!obj||!obj.length){return false;}
p=obj.children("a").removeClass("jstree-hovered").parent();if(this.data.ui.hovered[0]===p[0]){this.data.ui.hovered=null;}
this.__callback({"obj":obj});},select_node:function(obj,check,e){obj=this._get_node(obj);if(obj==-1||!obj||!obj.length){return false;}
var s=this._get_settings().ui,is_multiple=(s.select_multiple_modifier=="on"||(s.select_multiple_modifier!==false&&e&&e[s.select_multiple_modifier+"Key"])),is_range=(s.select_range_modifier!==false&&e&&e[s.select_range_modifier+"Key"]&&this.data.ui.last_selected&&this.data.ui.last_selected[0]!==obj[0]&&this.data.ui.last_selected.parent()[0]===obj.parent()[0]),is_selected=this.is_selected(obj),proceed=true,t=this;if(check){if(s.disable_selecting_children&&is_multiple&&((obj.parentsUntil(".jstree","li").children("a.jstree-clicked").length)||(obj.children("ul").find("a.jstree-clicked:eq(0)").length))){return false;}
proceed=false;switch(!0){case(is_range):this.data.ui.last_selected.addClass("jstree-last-selected");obj=obj[obj.index()<this.data.ui.last_selected.index()?"nextUntil":"prevUntil"](".jstree-last-selected").andSelf();if(s.select_limit==-1||obj.length<s.select_limit){this.data.ui.last_selected.removeClass("jstree-last-selected");this.data.ui.selected.each(function(){if(this!==t.data.ui.last_selected[0]){t.deselect_node(this);}});is_selected=false;proceed=true;}
else{proceed=false;}
break;case(is_selected&&!is_multiple):this.deselect_all();is_selected=false;proceed=true;break;case(!is_selected&&!is_multiple):if(s.select_limit==-1||s.select_limit>0){this.deselect_all();proceed=true;}
break;case(is_selected&&is_multiple):this.deselect_node(obj);break;case(!is_selected&&is_multiple):if(s.select_limit==-1||this.data.ui.selected.length+1<=s.select_limit){proceed=true;}
break;}}
if(proceed&&!is_selected){if(!is_range){this.data.ui.last_selected=obj;}
obj.children("a").addClass("jstree-clicked");if(s.selected_parent_open){obj.parents(".jstree-closed").each(function(){t.open_node(this,false,true);});}
this.data.ui.selected=this.data.ui.selected.add(obj);this._fix_scroll(obj.eq(0));this.__callback({"obj":obj,"e":e});}},_fix_scroll:function(obj){var c=this.get_container()[0],t;if(c.scrollHeight>c.offsetHeight){obj=this._get_node(obj);if(!obj||obj===-1||!obj.length||!obj.is(":visible")){return;}
t=obj.offset().top-this.get_container().offset().top;if(t<0){c.scrollTop=c.scrollTop+t-1;}
if(t+this.data.core.li_height+(c.scrollWidth>c.offsetWidth?scrollbar_width:0)>c.offsetHeight){c.scrollTop=c.scrollTop+(t-c.offsetHeight+this.data.core.li_height+1+(c.scrollWidth>c.offsetWidth?scrollbar_width:0));}}},deselect_node:function(obj){obj=this._get_node(obj);if(!obj.length){return false;}
if(this.is_selected(obj)){obj.children("a").removeClass("jstree-clicked");this.data.ui.selected=this.data.ui.selected.not(obj);if(this.data.ui.last_selected.get(0)===obj.get(0)){this.data.ui.last_selected=this.data.ui.selected.eq(0);}
this.__callback({"obj":obj});}},toggle_select:function(obj){obj=this._get_node(obj);if(!obj.length){return false;}
if(this.is_selected(obj)){this.deselect_node(obj);}
else{this.select_node(obj);}},is_selected:function(obj){return this.data.ui.selected.index(this._get_node(obj))>=0;},get_selected:function(context){return context?$(context).find("a.jstree-clicked").parent():this.data.ui.selected;},deselect_all:function(context){var ret=context?$(context).find("a.jstree-clicked").parent():this.get_container().find("a.jstree-clicked").parent();ret.children("a.jstree-clicked").removeClass("jstree-clicked");this.data.ui.selected=$([]);this.data.ui.last_selected=false;this.__callback({"obj":ret});}}});$.jstree.defaults.plugins.push("ui");})(jQuery);(function($){$.jstree.plugin("crrm",{__init:function(){this.get_container().bind("move_node.jstree",$.proxy(function(e,data){if(this._get_settings().crrm.move.open_onmove){var t=this;data.rslt.np.parentsUntil(".jstree").andSelf().filter(".jstree-closed").each(function(){t.open_node(this,false,true);});}},this));},defaults:{input_width_limit:200,move:{always_copy:false,open_onmove:true,default_position:"last",check_move:function(m){return true;}}},_fn:{_show_input:function(obj,callback){obj=this._get_node(obj);var rtl=this._get_settings().core.rtl,w=this._get_settings().crrm.input_width_limit,w1=obj.children("ins").width(),w2=obj.find("> a:visible > ins").width()*obj.find("> a:visible > ins").length,t=this.get_text(obj),h1=$("<div />",{css:{"position":"absolute","top":"-200px","left":(rtl?"0px":"-1000px"),"visibility":"hidden"}}).appendTo("body"),h2=obj.css("position","relative").append($("<input />",{"value":t,"class":"jstree-rename-input","css":{"padding":"0","border":"1px solid silver","position":"absolute","left":(rtl?"auto":(w1+w2+4)+"px"),"right":(rtl?(w1+w2+4)+"px":"auto"),"top":"0px","height":(this.data.core.li_height-2)+"px","lineHeight":(this.data.core.li_height-2)+"px","width":"150px"},"blur":$.proxy(function(){var i=obj.children(".jstree-rename-input"),v=i.val();if(v===""){v=t;}
h1.remove();i.remove();this.set_text(obj,t);this.rename_node(obj,v);callback.call(this,obj,v,t);obj.css("position","");},this),"keyup":function(event){var key=event.keyCode||event.which;if(key==27){this.value=t;this.blur();return;}
else if(key==13){this.blur();return;}
else{h2.width(Math.min(h1.text("pW"+this.value).width(),w));}},"keypress":function(event){var key=event.keyCode||event.which;if(key==13){return false;}}})).children(".jstree-rename-input");this.set_text(obj,"");h1.css({fontFamily:h2.css('fontFamily')||'',fontSize:h2.css('fontSize')||'',fontWeight:h2.css('fontWeight')||'',fontStyle:h2.css('fontStyle')||'',fontStretch:h2.css('fontStretch')||'',fontVariant:h2.css('fontVariant')||'',letterSpacing:h2.css('letterSpacing')||'',wordSpacing:h2.css('wordSpacing')||''});h2.width(Math.min(h1.text("pW"+h2[0].value).width(),w))[0].select();},rename:function(obj){obj=this._get_node(obj);this.__rollback();var f=this.__callback;this._show_input(obj,function(obj,new_name,old_name){f.call(this,{"obj":obj,"new_name":new_name,"old_name":old_name});});},create:function(obj,position,js,callback,skip_rename){var t,_this=this;obj=this._get_node(obj);if(!obj){obj=-1;}
this.__rollback();t=this.create_node(obj,position,js,function(t){var p=this._get_parent(t),pos=$(t).index();if(callback){callback.call(this,t);}
if(p.length&&p.hasClass("jstree-closed")){this.open_node(p,false,true);}
if(!skip_rename){this._show_input(t,function(obj,new_name,old_name){_this.__callback({"obj":obj,"name":new_name,"parent":p,"position":pos});});}
else{_this.__callback({"obj":t,"name":this.get_text(t),"parent":p,"position":pos});}});return t;},remove:function(obj){obj=this._get_node(obj,true);var p=this._get_parent(obj),prev=this._get_prev(obj);this.__rollback();obj=this.delete_node(obj);if(obj!==false){this.__callback({"obj":obj,"prev":prev,"parent":p});}},check_move:function(){if(!this.__call_old()){return false;}
var s=this._get_settings().crrm.move;if(!s.check_move.call(this,this._get_move())){return false;}
return true;},move_node:function(obj,ref,position,is_copy,is_prepared,skip_check){var s=this._get_settings().crrm.move;if(!is_prepared){if(typeof position==="undefined"){position=s.default_position;}
if(position==="inside"&&!s.default_position.match(/^(before|after)$/)){position=s.default_position;}
return this.__call_old(true,obj,ref,position,is_copy,false,skip_check);}
if(s.always_copy===true||(s.always_copy==="multitree"&&obj.rt.get_index()!==obj.ot.get_index())){is_copy=true;}
this.__call_old(true,obj,ref,position,is_copy,true,skip_check);},cut:function(obj){obj=this._get_node(obj,true);if(!obj||!obj.length){return false;}
this.data.crrm.cp_nodes=false;this.data.crrm.ct_nodes=obj;this.__callback({"obj":obj});},copy:function(obj){obj=this._get_node(obj,true);if(!obj||!obj.length){return false;}
this.data.crrm.ct_nodes=false;this.data.crrm.cp_nodes=obj;this.__callback({"obj":obj});},paste:function(obj){obj=this._get_node(obj);if(!obj||!obj.length){return false;}
var nodes=this.data.crrm.ct_nodes?this.data.crrm.ct_nodes:this.data.crrm.cp_nodes;if(!this.data.crrm.ct_nodes&&!this.data.crrm.cp_nodes){return false;}
if(this.data.crrm.ct_nodes){this.move_node(this.data.crrm.ct_nodes,obj);this.data.crrm.ct_nodes=false;}
if(this.data.crrm.cp_nodes){this.move_node(this.data.crrm.cp_nodes,obj,false,true);}
this.__callback({"obj":obj,"nodes":nodes});}}});})(jQuery);(function($){var themes_loaded=[];$.jstree._themes=false;$.jstree.plugin("themes",{__init:function(){this.get_container().bind("init.jstree",$.proxy(function(){var s=this._get_settings().themes;this.data.themes.dots=s.dots;this.data.themes.icons=s.icons;this.set_theme(s.theme,s.url);},this)).bind("loaded.jstree",$.proxy(function(){if(!this.data.themes.dots){this.hide_dots();}
else{this.show_dots();}
if(!this.data.themes.icons){this.hide_icons();}
else{this.show_icons();}},this));},defaults:{theme:"default",url:false,dots:true,icons:true},_fn:{set_theme:function(theme_name,theme_url){if(!theme_name){return false;}
if(!theme_url){theme_url=$.jstree._themes+theme_name+'/style.css';}
if($.inArray(theme_url,themes_loaded)==-1){$.vakata.css.add_sheet({"url":theme_url});themes_loaded.push(theme_url);}
if(this.data.themes.theme!=theme_name){this.get_container().removeClass('jstree-'+this.data.themes.theme);this.data.themes.theme=theme_name;}
this.get_container().addClass('jstree-'+theme_name);if(!this.data.themes.dots){this.hide_dots();}
else{this.show_dots();}
if(!this.data.themes.icons){this.hide_icons();}
else{this.show_icons();}
this.__callback();},get_theme:function(){return this.data.themes.theme;},show_dots:function(){this.data.themes.dots=true;this.get_container().children("ul").removeClass("jstree-no-dots");},hide_dots:function(){this.data.themes.dots=false;this.get_container().children("ul").addClass("jstree-no-dots");},toggle_dots:function(){if(this.data.themes.dots){this.hide_dots();}else{this.show_dots();}},show_icons:function(){this.data.themes.icons=true;this.get_container().children("ul").removeClass("jstree-no-icons");},hide_icons:function(){this.data.themes.icons=false;this.get_container().children("ul").addClass("jstree-no-icons");},toggle_icons:function(){if(this.data.themes.icons){this.hide_icons();}else{this.show_icons();}}}});$(function(){if($.jstree._themes===false){$("script").each(function(){if(this.src.toString().match(/jquery\.jstree[^\/]*?\.js(\?.*)?$/)){$.jstree._themes=this.src.toString().replace(/jquery\.jstree[^\/]*?\.js(\?.*)?$/,"")+'themes/';return false;}});}
if($.jstree._themes===false){$.jstree._themes="themes/";}});$.jstree.defaults.plugins.push("themes");})(jQuery);(function($){var bound=[];function exec(i,event){var f=$.jstree._focused(),tmp;if(f&&f.data&&f.data.hotkeys&&f.data.hotkeys.enabled){tmp=f._get_settings().hotkeys[i];if(tmp){return tmp.call(f,event);}}}
$.jstree.plugin("hotkeys",{__init:function(){if(typeof $.hotkeys==="undefined"){throw"jsTree hotkeys: jQuery hotkeys plugin not included.";}
if(!this.data.ui){throw"jsTree hotkeys: jsTree UI plugin not included.";}
$.each(this._get_settings().hotkeys,function(i,v){if(v!==false&&$.inArray(i,bound)==-1){$(document).bind("keydown",i,function(event){return exec(i,event);});bound.push(i);}});this.get_container().bind("lock.jstree",$.proxy(function(){if(this.data.hotkeys.enabled){this.data.hotkeys.enabled=false;this.data.hotkeys.revert=true;}},this)).bind("unlock.jstree",$.proxy(function(){if(this.data.hotkeys.revert){this.data.hotkeys.enabled=true;}},this));this.enable_hotkeys();},defaults:{"up":function(){var o=this.data.ui.hovered||this.data.ui.last_selected||-1;this.hover_node(this._get_prev(o));return false;},"ctrl+up":function(){var o=this.data.ui.hovered||this.data.ui.last_selected||-1;this.hover_node(this._get_prev(o));return false;},"shift+up":function(){var o=this.data.ui.hovered||this.data.ui.last_selected||-1;this.hover_node(this._get_prev(o));return false;},"down":function(){var o=this.data.ui.hovered||this.data.ui.last_selected||-1;this.hover_node(this._get_next(o));return false;},"ctrl+down":function(){var o=this.data.ui.hovered||this.data.ui.last_selected||-1;this.hover_node(this._get_next(o));return false;},"shift+down":function(){var o=this.data.ui.hovered||this.data.ui.last_selected||-1;this.hover_node(this._get_next(o));return false;},"left":function(){var o=this.data.ui.hovered||this.data.ui.last_selected;if(o){if(o.hasClass("jstree-open")){this.close_node(o);}
else{this.hover_node(this._get_prev(o));}}
return false;},"ctrl+left":function(){var o=this.data.ui.hovered||this.data.ui.last_selected;if(o){if(o.hasClass("jstree-open")){this.close_node(o);}
else{this.hover_node(this._get_prev(o));}}
return false;},"shift+left":function(){var o=this.data.ui.hovered||this.data.ui.last_selected;if(o){if(o.hasClass("jstree-open")){this.close_node(o);}
else{this.hover_node(this._get_prev(o));}}
return false;},"right":function(){var o=this.data.ui.hovered||this.data.ui.last_selected;if(o&&o.length){if(o.hasClass("jstree-closed")){this.open_node(o);}
else{this.hover_node(this._get_next(o));}}
return false;},"ctrl+right":function(){var o=this.data.ui.hovered||this.data.ui.last_selected;if(o&&o.length){if(o.hasClass("jstree-closed")){this.open_node(o);}
else{this.hover_node(this._get_next(o));}}
return false;},"shift+right":function(){var o=this.data.ui.hovered||this.data.ui.last_selected;if(o&&o.length){if(o.hasClass("jstree-closed")){this.open_node(o);}
else{this.hover_node(this._get_next(o));}}
return false;},"space":function(){if(this.data.ui.hovered){this.data.ui.hovered.children("a:eq(0)").click();}
return false;},"ctrl+space":function(event){event.type="click";if(this.data.ui.hovered){this.data.ui.hovered.children("a:eq(0)").trigger(event);}
return false;},"shift+space":function(event){event.type="click";if(this.data.ui.hovered){this.data.ui.hovered.children("a:eq(0)").trigger(event);}
return false;},"f2":function(){this.rename(this.data.ui.hovered||this.data.ui.last_selected);},"del":function(){this.remove(this.data.ui.hovered||this._get_node(null));}},_fn:{enable_hotkeys:function(){this.data.hotkeys.enabled=true;},disable_hotkeys:function(){this.data.hotkeys.enabled=false;}}});})(jQuery);(function($){$.jstree.plugin("json_data",{__init:function(){var s=this._get_settings().json_data;if(s.progressive_unload){this.get_container().bind("after_close.jstree",function(e,data){data.rslt.obj.children("ul").remove();});}},defaults:{data:false,ajax:false,correct_state:true,progressive_render:false,progressive_unload:false},_fn:{load_node:function(obj,s_call,e_call){var _this=this;this.load_node_json(obj,function(){_this.__callback({"obj":_this._get_node(obj)});s_call.call(this);},e_call);},_is_loaded:function(obj){var s=this._get_settings().json_data;obj=this._get_node(obj);return obj==-1||!obj||(!s.ajax&&!s.progressive_render&&!$.isFunction(s.data))||obj.is(".jstree-open, .jstree-leaf")||obj.children("ul").children("li").length>0;},refresh:function(obj){obj=this._get_node(obj);var s=this._get_settings().json_data;if(obj&&obj!==-1&&s.progressive_unload&&($.isFunction(s.data)||!!s.ajax)){obj.removeData("jstree-children");}
return this.__call_old();},load_node_json:function(obj,s_call,e_call){var s=this.get_settings().json_data,d,error_func=function(){},success_func=function(){};obj=this._get_node(obj);if(obj&&obj!==-1&&(s.progressive_render||s.progressive_unload)&&!obj.is(".jstree-open, .jstree-leaf")&&obj.children("ul").children("li").length===0&&obj.data("jstree-children")){d=this._parse_json(obj.data("jstree-children"),obj);if(d){obj.append(d);if(!s.progressive_unload){obj.removeData("jstree-children");}}
this.clean_node(obj);if(s_call){s_call.call(this);}
return;}
if(obj&&obj!==-1){if(obj.data("jstree-is-loading")){return;}
else{obj.data("jstree-is-loading",true);}}
switch(!0){case(!s.data&&!s.ajax):throw"Neither data nor ajax settings supplied.";case($.isFunction(s.data)):s.data.call(this,obj,$.proxy(function(d){d=this._parse_json(d,obj);if(!d){if(obj===-1||!obj){if(s.correct_state){this.get_container().children("ul").empty();}}
else{obj.children("a.jstree-loading").removeClass("jstree-loading");obj.removeData("jstree-is-loading");if(s.correct_state){this.correct_state(obj);}}
if(e_call){e_call.call(this);}}
else{if(obj===-1||!obj){this.get_container().children("ul").empty().append(d.children());}
else{obj.append(d).children("a.jstree-loading").removeClass("jstree-loading");obj.removeData("jstree-is-loading");}
this.clean_node(obj);if(s_call){s_call.call(this);}}},this));break;case(!!s.data&&!s.ajax)||(!!s.data&&!!s.ajax&&(!obj||obj===-1)):if(!obj||obj==-1){d=this._parse_json(s.data,obj);if(d){this.get_container().children("ul").empty().append(d.children());this.clean_node();}
else{if(s.correct_state){this.get_container().children("ul").empty();}}}
if(s_call){s_call.call(this);}
break;case(!s.data&&!!s.ajax)||(!!s.data&&!!s.ajax&&obj&&obj!==-1):error_func=function(x,t,e){var ef=this.get_settings().json_data.ajax.error;if(ef){ef.call(this,x,t,e);}
if(obj!=-1&&obj.length){obj.children("a.jstree-loading").removeClass("jstree-loading");obj.removeData("jstree-is-loading");if(t==="success"&&s.correct_state){this.correct_state(obj);}}
else{if(t==="success"&&s.correct_state){this.get_container().children("ul").empty();}}
if(e_call){e_call.call(this);}};success_func=function(d,t,x){var sf=this.get_settings().json_data.ajax.success;if(sf){d=sf.call(this,d,t,x)||d;}
if(d===""||(d&&d.toString&&d.toString().replace(/^[\s\n]+$/,"")==="")||(!$.isArray(d)&&!$.isPlainObject(d))){return error_func.call(this,x,t,"");}
d=this._parse_json(d,obj);if(d){if(obj===-1||!obj){this.get_container().children("ul").empty().append(d.children());}
else{obj.append(d).children("a.jstree-loading").removeClass("jstree-loading");obj.removeData("jstree-is-loading");}
this.clean_node(obj);if(s_call){s_call.call(this);}}
else{if(obj===-1||!obj){if(s.correct_state){this.get_container().children("ul").empty();if(s_call){s_call.call(this);}}}
else{obj.children("a.jstree-loading").removeClass("jstree-loading");obj.removeData("jstree-is-loading");if(s.correct_state){this.correct_state(obj);if(s_call){s_call.call(this);}}}}};s.ajax.context=this;s.ajax.error=error_func;s.ajax.success=success_func;if(!s.ajax.dataType){s.ajax.dataType="json";}
if($.isFunction(s.ajax.url)){s.ajax.url=s.ajax.url.call(this,obj);}
if($.isFunction(s.ajax.data)){s.ajax.data=s.ajax.data.call(this,obj);}
$.ajax(s.ajax);break;}},_parse_json:function(js,obj,is_callback){var d=false,p=this._get_settings(),s=p.json_data,t=p.core.html_titles,tmp,i,j,ul1,ul2;if(!js){return d;}
if(s.progressive_unload&&obj&&obj!==-1){obj.data("jstree-children",d);}
if($.isArray(js)){d=$();if(!js.length){return false;}
for(i=0,j=js.length;i<j;i++){tmp=this._parse_json(js[i],obj,true);if(tmp.length){d=d.add(tmp);}}}
else{if(typeof js=="string"){js={data:js};}
if(!js.data&&js.data!==""){return d;}
d=$("<li />");if(js.attr){d.attr(js.attr);}
if(js.metadata){d.data(js.metadata);}
if(js.state){d.addClass("jstree-"+js.state);}
if(!$.isArray(js.data)){tmp=js.data;js.data=[];js.data.push(tmp);}
$.each(js.data,function(i,m){tmp=$("<a />");if($.isFunction(m)){m=m.call(this,js);}
if(typeof m=="string"){tmp.attr('href','#')[t?"html":"text"](m);}
else{if(!m.attr){m.attr={};}
if(!m.attr.href){m.attr.href='#';}
tmp.attr(m.attr)[t?"html":"text"](m.title);if(m.language){tmp.addClass(m.language);}}
tmp.prepend("<ins class='jstree-icon'>&#160;</ins>");if(!m.icon&&js.icon){m.icon=js.icon;}
if(m.icon){if(m.icon.indexOf("/")===-1){tmp.children("ins").addClass(m.icon);}
else{tmp.children("ins").css("background","url('"+m.icon+"') center center no-repeat");}}
d.append(tmp);});d.prepend("<ins class='jstree-icon'>&#160;</ins>");if(js.children){if(s.progressive_render&&js.state!=="open"){d.addClass("jstree-closed").data("jstree-children",js.children);}
else{if(s.progressive_unload){d.data("jstree-children",js.children);}
if($.isArray(js.children)&&js.children.length){tmp=this._parse_json(js.children,obj,true);if(tmp.length){ul2=$("<ul />");ul2.append(tmp);d.append(ul2);}}}}}
if(!is_callback){ul1=$("<ul />");ul1.append(d);d=ul1;}
return d;},get_json:function(obj,li_attr,a_attr,is_callback){var result=[],s=this._get_settings(),_this=this,tmp1,tmp2,li,a,t,lang;obj=this._get_node(obj);if(!obj||obj===-1){obj=this.get_container().find("> ul > li");}
li_attr=$.isArray(li_attr)?li_attr:["id","class"];if(!is_callback&&this.data.types){li_attr.push(s.types.type_attr);}
a_attr=$.isArray(a_attr)?a_attr:[];obj.each(function(){li=$(this);tmp1={data:[]};if(li_attr.length){tmp1.attr={};}
$.each(li_attr,function(i,v){tmp2=li.attr(v);if(tmp2&&tmp2.length&&tmp2.replace(/jstree[^ ]*/ig,'').length){tmp1.attr[v]=(" "+tmp2).replace(/ jstree[^ ]*/ig,'').replace(/\s+$/ig," ").replace(/^ /,"").replace(/ $/,"");}});if(li.hasClass("jstree-open")){tmp1.state="open";}
if(li.hasClass("jstree-closed")){tmp1.state="closed";}
if(li.data()){tmp1.metadata=li.data();}
a=li.children("a");a.each(function(){t=$(this);if(a_attr.length||$.inArray("languages",s.plugins)!==-1||t.children("ins").get(0).style.backgroundImage.length||(t.children("ins").get(0).className&&t.children("ins").get(0).className.replace(/jstree[^ ]*|$/ig,'').length)){lang=false;if($.inArray("languages",s.plugins)!==-1&&$.isArray(s.languages)&&s.languages.length){$.each(s.languages,function(l,lv){if(t.hasClass(lv)){lang=lv;return false;}});}
tmp2={attr:{},title:_this.get_text(t,lang)};$.each(a_attr,function(k,z){tmp2.attr[z]=(" "+(t.attr(z)||"")).replace(/ jstree[^ ]*/ig,'').replace(/\s+$/ig," ").replace(/^ /,"").replace(/ $/,"");});if($.inArray("languages",s.plugins)!==-1&&$.isArray(s.languages)&&s.languages.length){$.each(s.languages,function(k,z){if(t.hasClass(z)){tmp2.language=z;return true;}});}
if(t.children("ins").get(0).className.replace(/jstree[^ ]*|$/ig,'').replace(/^\s+$/ig,"").length){tmp2.icon=t.children("ins").get(0).className.replace(/jstree[^ ]*|$/ig,'').replace(/\s+$/ig," ").replace(/^ /,"").replace(/ $/,"");}
if(t.children("ins").get(0).style.backgroundImage.length){tmp2.icon=t.children("ins").get(0).style.backgroundImage.replace("url(","").replace(")","");}}
else{tmp2=_this.get_text(t);}
if(a.length>1){tmp1.data.push(tmp2);}
else{tmp1.data=tmp2;}});li=li.find("> ul > li");if(li.length){tmp1.children=_this.get_json(li,li_attr,a_attr,true);}
result.push(tmp1);});return result;}}});})(jQuery);(function($){$.jstree.plugin("languages",{__init:function(){this._load_css();},defaults:[],_fn:{set_lang:function(i){var langs=this._get_settings().languages,st=false,selector=".jstree-"+this.get_index()+' a';if(!$.isArray(langs)||langs.length===0){return false;}
if($.inArray(i,langs)==-1){if(!!langs[i]){i=langs[i];}
else{return false;}}
if(i==this.data.languages.current_language){return true;}
st=$.vakata.css.get_css(selector+"."+this.data.languages.current_language,false,this.data.languages.language_css);if(st!==false){st.style.display="none";}
st=$.vakata.css.get_css(selector+"."+i,false,this.data.languages.language_css);if(st!==false){st.style.display="";}
this.data.languages.current_language=i;this.__callback(i);return true;},get_lang:function(){return this.data.languages.current_language;},_get_string:function(key,lang){var langs=this._get_settings().languages,s=this._get_settings().core.strings;if($.isArray(langs)&&langs.length){lang=(lang&&$.inArray(lang,langs)!=-1)?lang:this.data.languages.current_language;}
if(s[lang]&&s[lang][key]){return s[lang][key];}
if(s[key]){return s[key];}
return key;},get_text:function(obj,lang){obj=this._get_node(obj)||this.data.ui.last_selected;if(!obj.size()){return false;}
var langs=this._get_settings().languages,s=this._get_settings().core.html_titles;if($.isArray(langs)&&langs.length){lang=(lang&&$.inArray(lang,langs)!=-1)?lang:this.data.languages.current_language;obj=obj.children("a."+lang);}
else{obj=obj.children("a:eq(0)");}
if(s){obj=obj.clone();obj.children("INS").remove();return obj.html();}
else{obj=obj.contents().filter(function(){return this.nodeType==3;})[0];return obj.nodeValue;}},set_text:function(obj,val,lang){obj=this._get_node(obj)||this.data.ui.last_selected;if(!obj.size()){return false;}
var langs=this._get_settings().languages,s=this._get_settings().core.html_titles,tmp;if($.isArray(langs)&&langs.length){lang=(lang&&$.inArray(lang,langs)!=-1)?lang:this.data.languages.current_language;obj=obj.children("a."+lang);}
else{obj=obj.children("a:eq(0)");}
if(s){tmp=obj.children("INS").clone();obj.html(val).prepend(tmp);this.__callback({"obj":obj,"name":val,"lang":lang});return true;}
else{obj=obj.contents().filter(function(){return this.nodeType==3;})[0];this.__callback({"obj":obj,"name":val,"lang":lang});return(obj.nodeValue=val);}},_load_css:function(){var langs=this._get_settings().languages,str="/* languages css */",selector=".jstree-"+this.get_index()+' a',ln;if($.isArray(langs)&&langs.length){this.data.languages.current_language=langs[0];for(ln=0;ln<langs.length;ln++){str+=selector+"."+langs[ln]+" {";if(langs[ln]!=this.data.languages.current_language){str+=" display:none; ";}
str+=" } ";}
this.data.languages.language_css=$.vakata.css.add_sheet({'str':str,'title':"jstree-languages"});}},create_node:function(obj,position,js,callback){var t=this.__call_old(true,obj,position,js,function(t){var langs=this._get_settings().languages,a=t.children("a"),ln;if($.isArray(langs)&&langs.length){for(ln=0;ln<langs.length;ln++){if(!a.is("."+langs[ln])){t.append(a.eq(0).clone().removeClass(langs.join(" ")).addClass(langs[ln]));}}
a.not("."+langs.join(", .")).remove();}
if(callback){callback.call(this,t);}});return t;}}});})(jQuery);(function($){$.jstree.plugin("cookies",{__init:function(){if(typeof $.cookie==="undefined"){throw"jsTree cookie: jQuery cookie plugin not included.";}
var s=this._get_settings().cookies,tmp;if(!!s.save_loaded){tmp=$.cookie(s.save_loaded);if(tmp&&tmp.length){this.data.core.to_load=tmp.split(",");}}
if(!!s.save_opened){tmp=$.cookie(s.save_opened);if(tmp&&tmp.length){this.data.core.to_open=tmp.split(",");}}
if(!!s.save_selected){tmp=$.cookie(s.save_selected);if(tmp&&tmp.length&&this.data.ui){this.data.ui.to_select=tmp.split(",");}}
this.get_container().one((this.data.ui?"reselect":"reopen")+".jstree",$.proxy(function(){this.get_container().bind("open_node.jstree close_node.jstree select_node.jstree deselect_node.jstree",$.proxy(function(e){if(this._get_settings().cookies.auto_save){this.save_cookie((e.handleObj.namespace+e.handleObj.type).replace("jstree",""));}},this));},this));},defaults:{save_loaded:"jstree_load",save_opened:"jstree_open",save_selected:"jstree_select",auto_save:true,cookie_options:{}},_fn:{save_cookie:function(c){if(this.data.core.refreshing){return;}
var s=this._get_settings().cookies;if(!c){if(s.save_loaded){this.save_loaded();$.cookie(s.save_loaded,this.data.core.to_load.join(","),s.cookie_options);}
if(s.save_opened){this.save_opened();$.cookie(s.save_opened,this.data.core.to_open.join(","),s.cookie_options);}
if(s.save_selected&&this.data.ui){this.save_selected();$.cookie(s.save_selected,this.data.ui.to_select.join(","),s.cookie_options);}
return;}
switch(c){case"open_node":case"close_node":if(!!s.save_opened){this.save_opened();$.cookie(s.save_opened,this.data.core.to_open.join(","),s.cookie_options);}
if(!!s.save_loaded){this.save_loaded();$.cookie(s.save_loaded,this.data.core.to_load.join(","),s.cookie_options);}
break;case"select_node":case"deselect_node":if(!!s.save_selected&&this.data.ui){this.save_selected();$.cookie(s.save_selected,this.data.ui.to_select.join(","),s.cookie_options);}
break;}}}});})(jQuery);(function($){$.jstree.plugin("sort",{__init:function(){this.get_container().bind("load_node.jstree",$.proxy(function(e,data){var obj=this._get_node(data.rslt.obj);obj=obj===-1?this.get_container().children("ul"):obj.children("ul");this.sort(obj);},this)).bind("rename_node.jstree create_node.jstree create.jstree",$.proxy(function(e,data){this.sort(data.rslt.obj.parent());},this)).bind("move_node.jstree",$.proxy(function(e,data){var m=data.rslt.np==-1?this.get_container():data.rslt.np;this.sort(m.children("ul"));},this));},defaults:function(a,b){return this.get_text(a)>this.get_text(b)?1:-1;},_fn:{sort:function(obj){var s=this._get_settings().sort,t=this;obj.append($.makeArray(obj.children("li")).sort($.proxy(s,t)));obj.find("> li > ul").each(function(){t.sort($(this));});this.clean_node(obj);}}});})(jQuery);(function($){var o=false,r=false,m=false,ml=false,sli=false,sti=false,dir1=false,dir2=false,last_pos=false;$.vakata.dnd={is_down:false,is_drag:false,helper:false,scroll_spd:10,init_x:0,init_y:0,threshold:5,helper_left:5,helper_top:10,user_data:{},drag_start:function(e,data,html){if($.vakata.dnd.is_drag){$.vakata.drag_stop({});}
try{e.currentTarget.unselectable="on";e.currentTarget.onselectstart=function(){return false;};if(e.currentTarget.style){e.currentTarget.style.MozUserSelect="none";}}catch(err){}
$.vakata.dnd.init_x=e.pageX;$.vakata.dnd.init_y=e.pageY;$.vakata.dnd.user_data=data;$.vakata.dnd.is_down=true;$.vakata.dnd.helper=$("<div id='vakata-dragged' />").html(html);$(document).bind("mousemove",$.vakata.dnd.drag);$(document).bind("mouseup",$.vakata.dnd.drag_stop);return false;},drag:function(e){if(!$.vakata.dnd.is_down){return;}
if(!$.vakata.dnd.is_drag){if(Math.abs(e.pageX-$.vakata.dnd.init_x)>5||Math.abs(e.pageY-$.vakata.dnd.init_y)>5){$.vakata.dnd.helper.appendTo("body");$.vakata.dnd.is_drag=true;$(document).triggerHandler("drag_start.vakata",{"event":e,"data":$.vakata.dnd.user_data});}
else{return;}}
if(e.type==="mousemove"){var d=$(document),t=d.scrollTop(),l=d.scrollLeft();if(e.pageY-t<20){if(sti&&dir1==="down"){clearInterval(sti);sti=false;}
if(!sti){dir1="up";sti=setInterval(function(){$(document).scrollTop($(document).scrollTop()-$.vakata.dnd.scroll_spd);},150);}}
else{if(sti&&dir1==="up"){clearInterval(sti);sti=false;}}
if($(window).height()-(e.pageY-t)<20){if(sti&&dir1==="up"){clearInterval(sti);sti=false;}
if(!sti){dir1="down";sti=setInterval(function(){$(document).scrollTop($(document).scrollTop()+$.vakata.dnd.scroll_spd);},150);}}
else{if(sti&&dir1==="down"){clearInterval(sti);sti=false;}}
if(e.pageX-l<20){if(sli&&dir2==="right"){clearInterval(sli);sli=false;}
if(!sli){dir2="left";sli=setInterval(function(){$(document).scrollLeft($(document).scrollLeft()-$.vakata.dnd.scroll_spd);},150);}}
else{if(sli&&dir2==="left"){clearInterval(sli);sli=false;}}
if($(window).width()-(e.pageX-l)<20){if(sli&&dir2==="left"){clearInterval(sli);sli=false;}
if(!sli){dir2="right";sli=setInterval(function(){$(document).scrollLeft($(document).scrollLeft()+$.vakata.dnd.scroll_spd);},150);}}
else{if(sli&&dir2==="right"){clearInterval(sli);sli=false;}}}
$.vakata.dnd.helper.css({left:(e.pageX+$.vakata.dnd.helper_left)+"px",top:(e.pageY+$.vakata.dnd.helper_top)+"px"});$(document).triggerHandler("drag.vakata",{"event":e,"data":$.vakata.dnd.user_data});},drag_stop:function(e){if(sli){clearInterval(sli);}
if(sti){clearInterval(sti);}
$(document).unbind("mousemove",$.vakata.dnd.drag);$(document).unbind("mouseup",$.vakata.dnd.drag_stop);$(document).triggerHandler("drag_stop.vakata",{"event":e,"data":$.vakata.dnd.user_data});$.vakata.dnd.helper.remove();$.vakata.dnd.init_x=0;$.vakata.dnd.init_y=0;$.vakata.dnd.user_data={};$.vakata.dnd.is_down=false;$.vakata.dnd.is_drag=false;}};$(function(){var css_string='#vakata-dragged { display:block; margin:0 0 0 0; padding:4px 4px 4px 24px; position:absolute; top:-2000px; line-height:16px; z-index:10000; } ';$.vakata.css.add_sheet({str:css_string,title:"vakata"});});$.jstree.plugin("dnd",{__init:function(){this.data.dnd={active:false,after:false,inside:false,before:false,off:false,prepared:false,w:0,to1:false,to2:false,cof:false,cw:false,ch:false,i1:false,i2:false,mto:false};this.get_container().bind("mouseenter.jstree",$.proxy(function(e){if($.vakata.dnd.is_drag&&$.vakata.dnd.user_data.jstree){if(this.data.themes){m.attr("class","jstree-"+this.data.themes.theme);if(ml){ml.attr("class","jstree-"+this.data.themes.theme);}
$.vakata.dnd.helper.attr("class","jstree-dnd-helper jstree-"+this.data.themes.theme);}
if(e.currentTarget===e.target&&$.vakata.dnd.user_data.obj&&$($.vakata.dnd.user_data.obj).length&&$($.vakata.dnd.user_data.obj).parents(".jstree:eq(0)")[0]!==e.target){var tr=$.jstree._reference(e.target),dc;if(tr.data.dnd.foreign){dc=tr._get_settings().dnd.drag_check.call(this,{"o":o,"r":tr.get_container(),is_root:true});if(dc===true||dc.inside===true||dc.before===true||dc.after===true){$.vakata.dnd.helper.children("ins").attr("class","jstree-ok");}}
else{tr.prepare_move(o,tr.get_container(),"last");if(tr.check_move()){$.vakata.dnd.helper.children("ins").attr("class","jstree-ok");}}}}},this)).bind("mouseup.jstree",$.proxy(function(e){if($.vakata.dnd.is_drag&&$.vakata.dnd.user_data.jstree&&e.currentTarget===e.target&&$.vakata.dnd.user_data.obj&&$($.vakata.dnd.user_data.obj).length&&$($.vakata.dnd.user_data.obj).parents(".jstree:eq(0)")[0]!==e.target){var tr=$.jstree._reference(e.currentTarget),dc;if(tr.data.dnd.foreign){dc=tr._get_settings().dnd.drag_check.call(this,{"o":o,"r":tr.get_container(),is_root:true});if(dc===true||dc.inside===true||dc.before===true||dc.after===true){tr._get_settings().dnd.drag_finish.call(this,{"o":o,"r":tr.get_container(),is_root:true});}}
else{tr.move_node(o,tr.get_container(),"last",e[tr._get_settings().dnd.copy_modifier+"Key"]);}}},this)).bind("mouseleave.jstree",$.proxy(function(e){if(e.relatedTarget&&e.relatedTarget.id&&e.relatedTarget.id==="jstree-marker-line"){return false;}
if($.vakata.dnd.is_drag&&$.vakata.dnd.user_data.jstree){if(this.data.dnd.i1){clearInterval(this.data.dnd.i1);}
if(this.data.dnd.i2){clearInterval(this.data.dnd.i2);}
if(this.data.dnd.to1){clearTimeout(this.data.dnd.to1);}
if(this.data.dnd.to2){clearTimeout(this.data.dnd.to2);}
if($.vakata.dnd.helper.children("ins").hasClass("jstree-ok")){$.vakata.dnd.helper.children("ins").attr("class","jstree-invalid");}}},this)).bind("mousemove.jstree",$.proxy(function(e){if($.vakata.dnd.is_drag&&$.vakata.dnd.user_data.jstree){var cnt=this.get_container()[0];if(e.pageX+24>this.data.dnd.cof.left+this.data.dnd.cw){if(this.data.dnd.i1){clearInterval(this.data.dnd.i1);}
this.data.dnd.i1=setInterval($.proxy(function(){this.scrollLeft+=$.vakata.dnd.scroll_spd;},cnt),100);}
else if(e.pageX-24<this.data.dnd.cof.left){if(this.data.dnd.i1){clearInterval(this.data.dnd.i1);}
this.data.dnd.i1=setInterval($.proxy(function(){this.scrollLeft-=$.vakata.dnd.scroll_spd;},cnt),100);}
else{if(this.data.dnd.i1){clearInterval(this.data.dnd.i1);}}
if(e.pageY+24>this.data.dnd.cof.top+this.data.dnd.ch){if(this.data.dnd.i2){clearInterval(this.data.dnd.i2);}
this.data.dnd.i2=setInterval($.proxy(function(){this.scrollTop+=$.vakata.dnd.scroll_spd;},cnt),100);}
else if(e.pageY-24<this.data.dnd.cof.top){if(this.data.dnd.i2){clearInterval(this.data.dnd.i2);}
this.data.dnd.i2=setInterval($.proxy(function(){this.scrollTop-=$.vakata.dnd.scroll_spd;},cnt),100);}
else{if(this.data.dnd.i2){clearInterval(this.data.dnd.i2);}}}},this)).bind("scroll.jstree",$.proxy(function(e){if($.vakata.dnd.is_drag&&$.vakata.dnd.user_data.jstree&&m&&ml){m.hide();ml.hide();}},this)).delegate("a","mousedown.jstree",$.proxy(function(e){if(e.which===1){this.start_drag(e.currentTarget,e);return false;}},this)).delegate("a","mouseenter.jstree",$.proxy(function(e){if($.vakata.dnd.is_drag&&$.vakata.dnd.user_data.jstree){this.dnd_enter(e.currentTarget);}},this)).delegate("a","mousemove.jstree",$.proxy(function(e){if($.vakata.dnd.is_drag&&$.vakata.dnd.user_data.jstree){if(!r||!r.length||r.children("a")[0]!==e.currentTarget){this.dnd_enter(e.currentTarget);}
if(typeof this.data.dnd.off.top==="undefined"){this.data.dnd.off=$(e.target).offset();}
this.data.dnd.w=(e.pageY-(this.data.dnd.off.top||0))%this.data.core.li_height;if(this.data.dnd.w<0){this.data.dnd.w+=this.data.core.li_height;}
this.dnd_show();}},this)).delegate("a","mouseleave.jstree",$.proxy(function(e){if($.vakata.dnd.is_drag&&$.vakata.dnd.user_data.jstree){if(e.relatedTarget&&e.relatedTarget.id&&e.relatedTarget.id==="jstree-marker-line"){return false;}
if(m){m.hide();}
if(ml){ml.hide();}
this.data.dnd.mto=setTimeout((function(t){return function(){t.dnd_leave(e);};})(this),0);}},this)).delegate("a","mouseup.jstree",$.proxy(function(e){if($.vakata.dnd.is_drag&&$.vakata.dnd.user_data.jstree){this.dnd_finish(e);}},this));$(document).bind("drag_stop.vakata",$.proxy(function(){if(this.data.dnd.to1){clearTimeout(this.data.dnd.to1);}
if(this.data.dnd.to2){clearTimeout(this.data.dnd.to2);}
if(this.data.dnd.i1){clearInterval(this.data.dnd.i1);}
if(this.data.dnd.i2){clearInterval(this.data.dnd.i2);}
this.data.dnd.after=false;this.data.dnd.before=false;this.data.dnd.inside=false;this.data.dnd.off=false;this.data.dnd.prepared=false;this.data.dnd.w=false;this.data.dnd.to1=false;this.data.dnd.to2=false;this.data.dnd.i1=false;this.data.dnd.i2=false;this.data.dnd.active=false;this.data.dnd.foreign=false;if(m){m.css({"top":"-2000px"});}
if(ml){ml.css({"top":"-2000px"});}},this)).bind("drag_start.vakata",$.proxy(function(e,data){if(data.data.jstree){var et=$(data.event.target);if(et.closest(".jstree").hasClass("jstree-"+this.get_index())){this.dnd_enter(et);}}},this));var s=this._get_settings().dnd;if(s.drag_target){$(document).delegate(s.drag_target,"mousedown.jstree-"+this.get_index(),$.proxy(function(e){o=e.target;$.vakata.dnd.drag_start(e,{jstree:true,obj:e.target},"<ins class='jstree-icon'></ins>"+$(e.target).text());if(this.data.themes){if(m){m.attr("class","jstree-"+this.data.themes.theme);}
if(ml){ml.attr("class","jstree-"+this.data.themes.theme);}
$.vakata.dnd.helper.attr("class","jstree-dnd-helper jstree-"+this.data.themes.theme);}
$.vakata.dnd.helper.children("ins").attr("class","jstree-invalid");var cnt=this.get_container();this.data.dnd.cof=cnt.offset();this.data.dnd.cw=parseInt(cnt.width(),10);this.data.dnd.ch=parseInt(cnt.height(),10);this.data.dnd.foreign=true;e.preventDefault();},this));}
if(s.drop_target){$(document).delegate(s.drop_target,"mouseenter.jstree-"+this.get_index(),$.proxy(function(e){if(this.data.dnd.active&&this._get_settings().dnd.drop_check.call(this,{"o":o,"r":$(e.target),"e":e})){$.vakata.dnd.helper.children("ins").attr("class","jstree-ok");}},this)).delegate(s.drop_target,"mouseleave.jstree-"+this.get_index(),$.proxy(function(e){if(this.data.dnd.active){$.vakata.dnd.helper.children("ins").attr("class","jstree-invalid");}},this)).delegate(s.drop_target,"mouseup.jstree-"+this.get_index(),$.proxy(function(e){if(this.data.dnd.active&&$.vakata.dnd.helper.children("ins").hasClass("jstree-ok")){this._get_settings().dnd.drop_finish.call(this,{"o":o,"r":$(e.target),"e":e});}},this));}},defaults:{copy_modifier:"ctrl",check_timeout:100,open_timeout:500,drop_target:".jstree-drop",drop_check:function(data){return true;},drop_finish:$.noop,drag_target:".jstree-draggable",drag_finish:$.noop,drag_check:function(data){return{after:false,before:false,inside:true};}},_fn:{dnd_prepare:function(){if(!r||!r.length){return;}
this.data.dnd.off=r.offset();if(this._get_settings().core.rtl){this.data.dnd.off.right=this.data.dnd.off.left+r.width();}
if(this.data.dnd.foreign){var a=this._get_settings().dnd.drag_check.call(this,{"o":o,"r":r});this.data.dnd.after=a.after;this.data.dnd.before=a.before;this.data.dnd.inside=a.inside;this.data.dnd.prepared=true;return this.dnd_show();}
this.prepare_move(o,r,"before");this.data.dnd.before=this.check_move();this.prepare_move(o,r,"after");this.data.dnd.after=this.check_move();if(this._is_loaded(r)){this.prepare_move(o,r,"inside");this.data.dnd.inside=this.check_move();}
else{this.data.dnd.inside=false;}
this.data.dnd.prepared=true;return this.dnd_show();},dnd_show:function(){if(!this.data.dnd.prepared){return;}
var o=["before","inside","after"],r=false,rtl=this._get_settings().core.rtl,pos;if(this.data.dnd.w<this.data.core.li_height/3){o=["before","inside","after"];}
else if(this.data.dnd.w<=this.data.core.li_height*2/3){o=this.data.dnd.w<this.data.core.li_height/2?["inside","before","after"]:["inside","after","before"];}
else{o=["after","inside","before"];}
$.each(o,$.proxy(function(i,val){if(this.data.dnd[val]){$.vakata.dnd.helper.children("ins").attr("class","jstree-ok");r=val;return false;}},this));if(r===false){$.vakata.dnd.helper.children("ins").attr("class","jstree-invalid");}
pos=rtl?(this.data.dnd.off.right-18):(this.data.dnd.off.left+10);switch(r){case"before":m.css({"left":pos+"px","top":(this.data.dnd.off.top-6)+"px"}).show();if(ml){ml.css({"left":(pos+8)+"px","top":(this.data.dnd.off.top-1)+"px"}).show();}
break;case"after":m.css({"left":pos+"px","top":(this.data.dnd.off.top+this.data.core.li_height-6)+"px"}).show();if(ml){ml.css({"left":(pos+8)+"px","top":(this.data.dnd.off.top+this.data.core.li_height-1)+"px"}).show();}
break;case"inside":m.css({"left":pos+(rtl?-4:4)+"px","top":(this.data.dnd.off.top+this.data.core.li_height/2-5)+"px"}).show();if(ml){ml.hide();}
break;default:m.hide();if(ml){ml.hide();}
break;}
last_pos=r;return r;},dnd_open:function(){this.data.dnd.to2=false;this.open_node(r,$.proxy(this.dnd_prepare,this),true);},dnd_finish:function(e){if(this.data.dnd.foreign){if(this.data.dnd.after||this.data.dnd.before||this.data.dnd.inside){this._get_settings().dnd.drag_finish.call(this,{"o":o,"r":r,"p":last_pos});}}
else{this.dnd_prepare();this.move_node(o,r,last_pos,e[this._get_settings().dnd.copy_modifier+"Key"]);}
o=false;r=false;m.hide();if(ml){ml.hide();}},dnd_enter:function(obj){if(this.data.dnd.mto){clearTimeout(this.data.dnd.mto);this.data.dnd.mto=false;}
var s=this._get_settings().dnd;this.data.dnd.prepared=false;r=this._get_node(obj);if(s.check_timeout){if(this.data.dnd.to1){clearTimeout(this.data.dnd.to1);}
this.data.dnd.to1=setTimeout($.proxy(this.dnd_prepare,this),s.check_timeout);}
else{this.dnd_prepare();}
if(s.open_timeout){if(this.data.dnd.to2){clearTimeout(this.data.dnd.to2);}
if(r&&r.length&&r.hasClass("jstree-closed")){this.data.dnd.to2=setTimeout($.proxy(this.dnd_open,this),s.open_timeout);}}
else{if(r&&r.length&&r.hasClass("jstree-closed")){this.dnd_open();}}},dnd_leave:function(e){this.data.dnd.after=false;this.data.dnd.before=false;this.data.dnd.inside=false;$.vakata.dnd.helper.children("ins").attr("class","jstree-invalid");m.hide();if(ml){ml.hide();}
if(r&&r[0]===e.target.parentNode){if(this.data.dnd.to1){clearTimeout(this.data.dnd.to1);this.data.dnd.to1=false;}
if(this.data.dnd.to2){clearTimeout(this.data.dnd.to2);this.data.dnd.to2=false;}}},start_drag:function(obj,e){o=this._get_node(obj);if(this.data.ui&&this.is_selected(o)){o=this._get_node(null,true);}
var dt=o.length>1?this._get_string("multiple_selection"):this.get_text(o),cnt=this.get_container();if(!this._get_settings().core.html_titles){dt=dt.replace(/</ig,"&lt;").replace(/>/ig,"&gt;");}
$.vakata.dnd.drag_start(e,{jstree:true,obj:o},"<ins class='jstree-icon'></ins>"+dt);if(this.data.themes){if(m){m.attr("class","jstree-"+this.data.themes.theme);}
if(ml){ml.attr("class","jstree-"+this.data.themes.theme);}
$.vakata.dnd.helper.attr("class","jstree-dnd-helper jstree-"+this.data.themes.theme);}
this.data.dnd.cof=cnt.offset();this.data.dnd.cw=parseInt(cnt.width(),10);this.data.dnd.ch=parseInt(cnt.height(),10);this.data.dnd.active=true;}}});$(function(){var css_string=''+'#vakata-dragged ins { display:block; text-decoration:none; width:16px; height:16px; margin:0 0 0 0; padding:0; position:absolute; top:4px; left:4px; '+' -moz-border-radius:4px; border-radius:4px; -webkit-border-radius:4px; '+'} '+'#vakata-dragged .jstree-ok { background:green; } '+'#vakata-dragged .jstree-invalid { background:red; } '+'#jstree-marker { padding:0; margin:0; font-size:12px; overflow:hidden; height:12px; width:8px; position:absolute; top:-30px; z-index:10001; background-repeat:no-repeat; display:none; background-color:transparent; text-shadow:1px 1px 1px white; color:black; line-height:10px; } '+'#jstree-marker-line { padding:0; margin:0; line-height:0%; font-size:1px; overflow:hidden; height:1px; width:100px; position:absolute; top:-30px; z-index:10000; background-repeat:no-repeat; display:none; background-color:#456c43; '+' cursor:pointer; border:1px solid #eeeeee; border-left:0; -moz-box-shadow: 0px 0px 2px #666; -webkit-box-shadow: 0px 0px 2px #666; box-shadow: 0px 0px 2px #666; '+' -moz-border-radius:1px; border-radius:1px; -webkit-border-radius:1px; '+'}'+'';$.vakata.css.add_sheet({str:css_string,title:"jstree"});m=$("<div />").attr({id:"jstree-marker"}).hide().html("&raquo;").bind("mouseleave mouseenter",function(e){m.hide();ml.hide();e.preventDefault();e.stopImmediatePropagation();return false;}).appendTo("body");ml=$("<div />").attr({id:"jstree-marker-line"}).hide().bind("mouseup",function(e){if(r&&r.length){r.children("a").trigger(e);e.preventDefault();e.stopImmediatePropagation();return false;}}).bind("mouseleave",function(e){var rt=$(e.relatedTarget);if(rt.is(".jstree")||rt.closest(".jstree").length===0){if(r&&r.length){r.children("a").trigger(e);m.hide();ml.hide();e.preventDefault();e.stopImmediatePropagation();return false;}}}).appendTo("body");$(document).bind("drag_start.vakata",function(e,data){if(data.data.jstree){m.show();if(ml){ml.show();}}});$(document).bind("drag_stop.vakata",function(e,data){if(data.data.jstree){m.hide();if(ml){ml.hide();}}});});})(jQuery);(function($){$.jstree.plugin("checkbox",{__init:function(){this.data.checkbox.noui=this._get_settings().checkbox.override_ui;if(this.data.ui&&this.data.checkbox.noui){this.select_node=this.deselect_node=this.deselect_all=$.noop;this.get_selected=this.get_checked;}
this.get_container().bind("open_node.jstree create_node.jstree clean_node.jstree refresh.jstree",$.proxy(function(e,data){this._prepare_checkboxes(data.rslt.obj);},this)).bind("loaded.jstree",$.proxy(function(e){this._prepare_checkboxes();},this)).delegate((this.data.ui&&this.data.checkbox.noui?"a":"ins.jstree-checkbox"),"click.jstree",$.proxy(function(e){e.preventDefault();if(this._get_node(e.target).hasClass("jstree-checked")){this.uncheck_node(e.target);}
else{this.check_node(e.target);}
if(this.data.ui&&this.data.checkbox.noui){this.save_selected();if(this.data.cookies){this.save_cookie("select_node");}}
else{e.stopImmediatePropagation();return false;}},this));},defaults:{override_ui:false,two_state:false,real_checkboxes:false,checked_parent_open:true,real_checkboxes_names:function(n){return[("check_"+(n[0].id||Math.ceil(Math.random()*10000))),1];}},__destroy:function(){this.get_container().find("input.jstree-real-checkbox").removeClass("jstree-real-checkbox").end().find("ins.jstree-checkbox").remove();},_fn:{_checkbox_notify:function(n,data){if(data.checked){this.check_node(n,false);}},_prepare_checkboxes:function(obj){obj=!obj||obj==-1?this.get_container().find("> ul > li"):this._get_node(obj);if(obj===false){return;}
var c,_this=this,t,ts=this._get_settings().checkbox.two_state,rc=this._get_settings().checkbox.real_checkboxes,rcn=this._get_settings().checkbox.real_checkboxes_names;obj.each(function(){t=$(this);c=t.is("li")&&(t.hasClass("jstree-checked")||(rc&&t.children(":checked").length))?"jstree-checked":"jstree-unchecked";t.find("li").andSelf().each(function(){var $t=$(this),nm;$t.children("a"+(_this.data.languages?"":":eq(0)")).not(":has(.jstree-checkbox)").prepend("<ins class='jstree-checkbox'>&#160;</ins>").parent().not(".jstree-checked, .jstree-unchecked").addClass(ts?"jstree-unchecked":c);if(rc){if(!$t.children(":checkbox").length){nm=rcn.call(_this,$t);$t.prepend("<input type='checkbox' class='jstree-real-checkbox' id='"+nm[0]+"' name='"+nm[0]+"' value='"+nm[1]+"' />");}
else{$t.children(":checkbox").addClass("jstree-real-checkbox");}
if(c==="jstree-checked"){$t.children(":checkbox").attr("checked","checked");}}
if(c==="jstree-checked"&&!ts){$t.find("li").addClass("jstree-checked");}});});if(!ts){if(obj.length===1&&obj.is("li")){this._repair_state(obj);}
if(obj.is("li")){obj.each(function(){_this._repair_state(this);});}
else{obj.find("> ul > li").each(function(){_this._repair_state(this);});}
obj.find(".jstree-checked").parent().parent().each(function(){_this._repair_state(this);});}},change_state:function(obj,state){obj=this._get_node(obj);var coll=false,rc=this._get_settings().checkbox.real_checkboxes;if(!obj||obj===-1){return false;}
state=(state===false||state===true)?state:obj.hasClass("jstree-checked");if(this._get_settings().checkbox.two_state){if(state){obj.removeClass("jstree-checked").addClass("jstree-unchecked");if(rc){obj.children(":checkbox").removeAttr("checked");}}
else{obj.removeClass("jstree-unchecked").addClass("jstree-checked");if(rc){obj.children(":checkbox").attr("checked","checked");}}}
else{if(state){coll=obj.find("li").andSelf();if(!coll.filter(".jstree-checked, .jstree-undetermined").length){return false;}
coll.removeClass("jstree-checked jstree-undetermined").addClass("jstree-unchecked");if(rc){coll.children(":checkbox").removeAttr("checked");}}
else{coll=obj.find("li").andSelf();if(!coll.filter(".jstree-unchecked, .jstree-undetermined").length){return false;}
coll.removeClass("jstree-unchecked jstree-undetermined").addClass("jstree-checked");if(rc){coll.children(":checkbox").attr("checked","checked");}
if(this.data.ui){this.data.ui.last_selected=obj;}
this.data.checkbox.last_selected=obj;}
obj.parentsUntil(".jstree","li").each(function(){var $this=$(this);if(state){if($this.children("ul").children("li.jstree-checked, li.jstree-undetermined").length){$this.parentsUntil(".jstree","li").andSelf().removeClass("jstree-checked jstree-unchecked").addClass("jstree-undetermined");if(rc){$this.parentsUntil(".jstree","li").andSelf().children(":checkbox").removeAttr("checked");}
return false;}
else{$this.removeClass("jstree-checked jstree-undetermined").addClass("jstree-unchecked");if(rc){$this.children(":checkbox").removeAttr("checked");}}}
else{if($this.children("ul").children("li.jstree-unchecked, li.jstree-undetermined").length){$this.parentsUntil(".jstree","li").andSelf().removeClass("jstree-checked jstree-unchecked").addClass("jstree-undetermined");if(rc){$this.parentsUntil(".jstree","li").andSelf().children(":checkbox").removeAttr("checked");}
return false;}
else{$this.removeClass("jstree-unchecked jstree-undetermined").addClass("jstree-checked");if(rc){$this.children(":checkbox").attr("checked","checked");}}}});}
if(this.data.ui&&this.data.checkbox.noui){this.data.ui.selected=this.get_checked();}
this.__callback(obj);return true;},check_node:function(obj){if(this.change_state(obj,false)){obj=this._get_node(obj);if(this._get_settings().checkbox.checked_parent_open){var t=this;obj.parents(".jstree-closed").each(function(){t.open_node(this,false,true);});}
this.__callback({"obj":obj});}},uncheck_node:function(obj){if(this.change_state(obj,true)){this.__callback({"obj":this._get_node(obj)});}},check_all:function(){var _this=this,coll=this._get_settings().checkbox.two_state?this.get_container_ul().find("li"):this.get_container_ul().children("li");coll.each(function(){_this.change_state(this,false);});this.__callback();},uncheck_all:function(){var _this=this,coll=this._get_settings().checkbox.two_state?this.get_container_ul().find("li"):this.get_container_ul().children("li");coll.each(function(){_this.change_state(this,true);});this.__callback();},is_checked:function(obj){obj=this._get_node(obj);return obj.length?obj.is(".jstree-checked"):false;},get_checked:function(obj,get_all){obj=!obj||obj===-1?this.get_container():this._get_node(obj);return get_all||this._get_settings().checkbox.two_state?obj.find(".jstree-checked"):obj.find("> ul > .jstree-checked, .jstree-undetermined > ul > .jstree-checked");},get_unchecked:function(obj,get_all){obj=!obj||obj===-1?this.get_container():this._get_node(obj);return get_all||this._get_settings().checkbox.two_state?obj.find(".jstree-unchecked"):obj.find("> ul > .jstree-unchecked, .jstree-undetermined > ul > .jstree-unchecked");},show_checkboxes:function(){this.get_container().children("ul").removeClass("jstree-no-checkboxes");},hide_checkboxes:function(){this.get_container().children("ul").addClass("jstree-no-checkboxes");},_repair_state:function(obj){obj=this._get_node(obj);if(!obj.length){return;}
var rc=this._get_settings().checkbox.real_checkboxes,a=obj.find("> ul > .jstree-checked").length,b=obj.find("> ul > .jstree-undetermined").length,c=obj.find("> ul > li").length;if(c===0){if(obj.hasClass("jstree-undetermined")){this.change_state(obj,false);}}
else if(a===0&&b===0){this.change_state(obj,true);}
else if(a===c){this.change_state(obj,false);}
else{obj.parentsUntil(".jstree","li").andSelf().removeClass("jstree-checked jstree-unchecked").addClass("jstree-undetermined");if(rc){obj.parentsUntil(".jstree","li").andSelf().children(":checkbox").removeAttr("checked");}}},reselect:function(){if(this.data.ui&&this.data.checkbox.noui){var _this=this,s=this.data.ui.to_select;s=$.map($.makeArray(s),function(n){return"#"+n.toString().replace(/^#/,"").replace(/\\\//g,"/").replace(/\//g,"\\\/").replace(/\\\./g,".").replace(/\./g,"\\.").replace(/\:/g,"\\:");});this.deselect_all();$.each(s,function(i,val){_this.check_node(val);});this.__callback();}
else{this.__call_old();}},save_loaded:function(){var _this=this;this.data.core.to_load=[];this.get_container_ul().find("li.jstree-closed.jstree-undetermined").each(function(){if(this.id){_this.data.core.to_load.push("#"+this.id);}});}}});$(function(){var css_string='.jstree .jstree-real-checkbox { display:none; } ';$.vakata.css.add_sheet({str:css_string,title:"jstree"});});})(jQuery);(function($){$.vakata.xslt=function(xml,xsl,callback){var rs="",xm,xs,processor,support;if(document.recalc){xm=document.createElement('xml');xs=document.createElement('xml');xm.innerHTML=xml;xs.innerHTML=xsl;$("body").append(xm).append(xs);setTimeout((function(xm,xs,callback){return function(){callback.call(null,xm.transformNode(xs.XMLDocument));setTimeout((function(xm,xs){return function(){$(xm).remove();$(xs).remove();};})(xm,xs),200);};})(xm,xs,callback),100);return true;}
if(typeof window.DOMParser!=="undefined"&&typeof window.XMLHttpRequest!=="undefined"&&typeof window.XSLTProcessor==="undefined"){xml=new DOMParser().parseFromString(xml,"text/xml");xsl=new DOMParser().parseFromString(xsl,"text/xml");}
if(typeof window.DOMParser!=="undefined"&&typeof window.XMLHttpRequest!=="undefined"&&typeof window.XSLTProcessor!=="undefined"){processor=new XSLTProcessor();support=$.isFunction(processor.transformDocument)?(typeof window.XMLSerializer!=="undefined"):true;if(!support){return false;}
xml=new DOMParser().parseFromString(xml,"text/xml");xsl=new DOMParser().parseFromString(xsl,"text/xml");if($.isFunction(processor.transformDocument)){rs=document.implementation.createDocument("","",null);processor.transformDocument(xml,xsl,rs,null);callback.call(null,new XMLSerializer().serializeToString(rs));return true;}
else{processor.importStylesheet(xsl);rs=processor.transformToFragment(xml,document);callback.call(null,$("<div />").append(rs).html());return true;}}
return false;};var xsl={'nest':'<'+'?xml version="1.0" encoding="utf-8" ?>'+'<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform" >'+'<xsl:output method="html" encoding="utf-8" omit-xml-declaration="yes" standalone="no" indent="no" media-type="text/html" />'+'<xsl:template match="/">'+' <xsl:call-template name="nodes">'+'  <xsl:with-param name="node" select="/root" />'+' </xsl:call-template>'+'</xsl:template>'+'<xsl:template name="nodes">'+' <xsl:param name="node" />'+' <ul>'+' <xsl:for-each select="$node/item">'+'  <xsl:variable name="children" select="count(./item) &gt; 0" />'+'  <li>'+'   <xsl:attribute name="class">'+'    <xsl:if test="position() = last()">jstree-last </xsl:if>'+'    <xsl:choose>'+'     <xsl:when test="@state = \'open\'">jstree-open </xsl:when>'+'     <xsl:when test="$children or @hasChildren or @state = \'closed\'">jstree-closed </xsl:when>'+'     <xsl:otherwise>jstree-leaf </xsl:otherwise>'+'    </xsl:choose>'+'    <xsl:value-of select="@class" />'+'   </xsl:attribute>'+'   <xsl:for-each select="@*">'+'    <xsl:if test="name() != \'class\' and name() != \'state\' and name() != \'hasChildren\'">'+'     <xsl:attribute name="{name()}"><xsl:value-of select="." /></xsl:attribute>'+'    </xsl:if>'+'   </xsl:for-each>'+' <ins class="jstree-icon"><xsl:text>&#xa0;</xsl:text></ins>'+'   <xsl:for-each select="content/name">'+'    <a>'+'    <xsl:attribute name="href">'+'     <xsl:choose>'+'     <xsl:when test="@href"><xsl:value-of select="@href" /></xsl:when>'+'     <xsl:otherwise>#</xsl:otherwise>'+'     </xsl:choose>'+'    </xsl:attribute>'+'    <xsl:attribute name="class"><xsl:value-of select="@lang" /> <xsl:value-of select="@class" /></xsl:attribute>'+'    <xsl:attribute name="style"><xsl:value-of select="@style" /></xsl:attribute>'+'    <xsl:for-each select="@*">'+'     <xsl:if test="name() != \'style\' and name() != \'class\' and name() != \'href\'">'+'      <xsl:attribute name="{name()}"><xsl:value-of select="." /></xsl:attribute>'+'     </xsl:if>'+'    </xsl:for-each>'+'     <ins>'+'      <xsl:attribute name="class">jstree-icon '+'       <xsl:if test="string-length(attribute::icon) > 0 and not(contains(@icon,\'/\'))"><xsl:value-of select="@icon" /></xsl:if>'+'      </xsl:attribute>'+'      <xsl:if test="string-length(attribute::icon) > 0 and contains(@icon,\'/\')"><xsl:attribute name="style">background:url(<xsl:value-of select="@icon" />) center center no-repeat;</xsl:attribute></xsl:if>'+'      <xsl:text>&#xa0;</xsl:text>'+'     </ins>'+'     <xsl:copy-of select="./child::node()" />'+'    </a>'+'   </xsl:for-each>'+'   <xsl:if test="$children or @hasChildren"><xsl:call-template name="nodes"><xsl:with-param name="node" select="current()" /></xsl:call-template></xsl:if>'+'  </li>'+' </xsl:for-each>'+' </ul>'+'</xsl:template>'+'</xsl:stylesheet>','flat':'<'+'?xml version="1.0" encoding="utf-8" ?>'+'<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform" >'+'<xsl:output method="html" encoding="utf-8" omit-xml-declaration="yes" standalone="no" indent="no" media-type="text/xml" />'+'<xsl:template match="/">'+' <ul>'+' <xsl:for-each select="//item[not(@parent_id) or @parent_id=0 or not(@parent_id = //item/@id)]">'+'  <xsl:call-template name="nodes">'+'   <xsl:with-param name="node" select="." />'+'   <xsl:with-param name="is_last" select="number(position() = last())" />'+'  </xsl:call-template>'+' </xsl:for-each>'+' </ul>'+'</xsl:template>'+'<xsl:template name="nodes">'+' <xsl:param name="node" />'+' <xsl:param name="is_last" />'+' <xsl:variable name="children" select="count(//item[@parent_id=$node/attribute::id]) &gt; 0" />'+' <li>'+' <xsl:attribute name="class">'+'  <xsl:if test="$is_last = true()">jstree-last </xsl:if>'+'  <xsl:choose>'+'   <xsl:when test="@state = \'open\'">jstree-open </xsl:when>'+'   <xsl:when test="$children or @hasChildren or @state = \'closed\'">jstree-closed </xsl:when>'+'   <xsl:otherwise>jstree-leaf </xsl:otherwise>'+'  </xsl:choose>'+'  <xsl:value-of select="@class" />'+' </xsl:attribute>'+' <xsl:for-each select="@*">'+'  <xsl:if test="name() != \'parent_id\' and name() != \'hasChildren\' and name() != \'class\' and name() != \'state\'">'+'  <xsl:attribute name="{name()}"><xsl:value-of select="." /></xsl:attribute>'+'  </xsl:if>'+' </xsl:for-each>'+' <ins class="jstree-icon"><xsl:text>&#xa0;</xsl:text></ins>'+' <xsl:for-each select="content/name">'+'  <a>'+'  <xsl:attribute name="href">'+'   <xsl:choose>'+'   <xsl:when test="@href"><xsl:value-of select="@href" /></xsl:when>'+'   <xsl:otherwise>#</xsl:otherwise>'+'   </xsl:choose>'+'  </xsl:attribute>'+'  <xsl:attribute name="class"><xsl:value-of select="@lang" /> <xsl:value-of select="@class" /></xsl:attribute>'+'  <xsl:attribute name="style"><xsl:value-of select="@style" /></xsl:attribute>'+'  <xsl:for-each select="@*">'+'   <xsl:if test="name() != \'style\' and name() != \'class\' and name() != \'href\'">'+'    <xsl:attribute name="{name()}"><xsl:value-of select="." /></xsl:attribute>'+'   </xsl:if>'+'  </xsl:for-each>'+'   <ins>'+'    <xsl:attribute name="class">jstree-icon '+'     <xsl:if test="string-length(attribute::icon) > 0 and not(contains(@icon,\'/\'))"><xsl:value-of select="@icon" /></xsl:if>'+'    </xsl:attribute>'+'    <xsl:if test="string-length(attribute::icon) > 0 and contains(@icon,\'/\')"><xsl:attribute name="style">background:url(<xsl:value-of select="@icon" />) center center no-repeat;</xsl:attribute></xsl:if>'+'    <xsl:text>&#xa0;</xsl:text>'+'   </ins>'+'   <xsl:copy-of select="./child::node()" />'+'  </a>'+' </xsl:for-each>'+' <xsl:if test="$children">'+'  <ul>'+'  <xsl:for-each select="//item[@parent_id=$node/attribute::id]">'+'   <xsl:call-template name="nodes">'+'    <xsl:with-param name="node" select="." />'+'    <xsl:with-param name="is_last" select="number(position() = last())" />'+'   </xsl:call-template>'+'  </xsl:for-each>'+'  </ul>'+' </xsl:if>'+' </li>'+'</xsl:template>'+'</xsl:stylesheet>'},escape_xml=function(string){return string.toString().replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;').replace(/'/g,'&apos;');};$.jstree.plugin("xml_data",{defaults:{data:false,ajax:false,xsl:"flat",clean_node:false,correct_state:true,get_skip_empty:false,get_include_preamble:true},_fn:{load_node:function(obj,s_call,e_call){var _this=this;this.load_node_xml(obj,function(){_this.__callback({"obj":_this._get_node(obj)});s_call.call(this);},e_call);},_is_loaded:function(obj){var s=this._get_settings().xml_data;obj=this._get_node(obj);return obj==-1||!obj||(!s.ajax&&!$.isFunction(s.data))||obj.is(".jstree-open, .jstree-leaf")||obj.children("ul").children("li").size()>0;},load_node_xml:function(obj,s_call,e_call){var s=this.get_settings().xml_data,error_func=function(){},success_func=function(){};obj=this._get_node(obj);if(obj&&obj!==-1){if(obj.data("jstree-is-loading")){return;}
else{obj.data("jstree-is-loading",true);}}
switch(!0){case(!s.data&&!s.ajax):throw"Neither data nor ajax settings supplied.";case($.isFunction(s.data)):s.data.call(this,obj,$.proxy(function(d){this.parse_xml(d,$.proxy(function(d){if(d){d=d.replace(/ ?xmlns="[^"]*"/ig,"");if(d.length>10){d=$(d);if(obj===-1||!obj){this.get_container().children("ul").empty().append(d.children());}
else{obj.children("a.jstree-loading").removeClass("jstree-loading");obj.append(d);obj.removeData("jstree-is-loading");}
if(s.clean_node){this.clean_node(obj);}
if(s_call){s_call.call(this);}}
else{if(obj&&obj!==-1){obj.children("a.jstree-loading").removeClass("jstree-loading");obj.removeData("jstree-is-loading");if(s.correct_state){this.correct_state(obj);if(s_call){s_call.call(this);}}}
else{if(s.correct_state){this.get_container().children("ul").empty();if(s_call){s_call.call(this);}}}}}},this));},this));break;case(!!s.data&&!s.ajax)||(!!s.data&&!!s.ajax&&(!obj||obj===-1)):if(!obj||obj==-1){this.parse_xml(s.data,$.proxy(function(d){if(d){d=d.replace(/ ?xmlns="[^"]*"/ig,"");if(d.length>10){d=$(d);this.get_container().children("ul").empty().append(d.children());if(s.clean_node){this.clean_node(obj);}
if(s_call){s_call.call(this);}}}
else{if(s.correct_state){this.get_container().children("ul").empty();if(s_call){s_call.call(this);}}}},this));}
break;case(!s.data&&!!s.ajax)||(!!s.data&&!!s.ajax&&obj&&obj!==-1):error_func=function(x,t,e){var ef=this.get_settings().xml_data.ajax.error;if(ef){ef.call(this,x,t,e);}
if(obj!==-1&&obj.length){obj.children("a.jstree-loading").removeClass("jstree-loading");obj.removeData("jstree-is-loading");if(t==="success"&&s.correct_state){this.correct_state(obj);}}
else{if(t==="success"&&s.correct_state){this.get_container().children("ul").empty();}}
if(e_call){e_call.call(this);}};success_func=function(d,t,x){d=x.responseText;var sf=this.get_settings().xml_data.ajax.success;if(sf){d=sf.call(this,d,t,x)||d;}
if(d===""||(d&&d.toString&&d.toString().replace(/^[\s\n]+$/,"")==="")){return error_func.call(this,x,t,"");}
this.parse_xml(d,$.proxy(function(d){if(d){d=d.replace(/ ?xmlns="[^"]*"/ig,"");if(d.length>10){d=$(d);if(obj===-1||!obj){this.get_container().children("ul").empty().append(d.children());}
else{obj.children("a.jstree-loading").removeClass("jstree-loading");obj.append(d);obj.removeData("jstree-is-loading");}
if(s.clean_node){this.clean_node(obj);}
if(s_call){s_call.call(this);}}
else{if(obj&&obj!==-1){obj.children("a.jstree-loading").removeClass("jstree-loading");obj.removeData("jstree-is-loading");if(s.correct_state){this.correct_state(obj);if(s_call){s_call.call(this);}}}
else{if(s.correct_state){this.get_container().children("ul").empty();if(s_call){s_call.call(this);}}}}}},this));};s.ajax.context=this;s.ajax.error=error_func;s.ajax.success=success_func;if(!s.ajax.dataType){s.ajax.dataType="xml";}
if($.isFunction(s.ajax.url)){s.ajax.url=s.ajax.url.call(this,obj);}
if($.isFunction(s.ajax.data)){s.ajax.data=s.ajax.data.call(this,obj);}
$.ajax(s.ajax);break;}},parse_xml:function(xml,callback){var s=this._get_settings().xml_data;$.vakata.xslt(xml,xsl[s.xsl],callback);},get_xml:function(tp,obj,li_attr,a_attr,is_callback){var result="",s=this._get_settings(),_this=this,tmp1,tmp2,li,a,lang;if(!tp){tp="flat";}
if(!is_callback){is_callback=0;}
obj=this._get_node(obj);if(!obj||obj===-1){obj=this.get_container().find("> ul > li");}
li_attr=$.isArray(li_attr)?li_attr:["id","class"];if(!is_callback&&this.data.types&&$.inArray(s.types.type_attr,li_attr)===-1){li_attr.push(s.types.type_attr);}
a_attr=$.isArray(a_attr)?a_attr:[];if(!is_callback){if(s.xml_data.get_include_preamble){result+='<'+'?xml version="1.0" encoding="UTF-8"?'+'>';}
result+="<root>";}
obj.each(function(){result+="<item";li=$(this);$.each(li_attr,function(i,v){var t=li.attr(v);if(!s.xml_data.get_skip_empty||typeof t!=="undefined"){result+=" "+v+"=\""+escape_xml((" "+(t||"")).replace(/ jstree[^ ]*/ig,'').replace(/\s+$/ig," ").replace(/^ /,"").replace(/ $/,""))+"\"";}});if(li.hasClass("jstree-open")){result+=" state=\"open\"";}
if(li.hasClass("jstree-closed")){result+=" state=\"closed\"";}
if(tp==="flat"){result+=" parent_id=\""+escape_xml(is_callback)+"\"";}
result+=">";result+="<content>";a=li.children("a");a.each(function(){tmp1=$(this);lang=false;result+="<name";if($.inArray("languages",s.plugins)!==-1){$.each(s.languages,function(k,z){if(tmp1.hasClass(z)){result+=" lang=\""+escape_xml(z)+"\"";lang=z;return false;}});}
if(a_attr.length){$.each(a_attr,function(k,z){var t=tmp1.attr(z);if(!s.xml_data.get_skip_empty||typeof t!=="undefined"){result+=" "+z+"=\""+escape_xml((" "+t||"").replace(/ jstree[^ ]*/ig,'').replace(/\s+$/ig," ").replace(/^ /,"").replace(/ $/,""))+"\"";}});}
if(tmp1.children("ins").get(0).className.replace(/jstree[^ ]*|$/ig,'').replace(/^\s+$/ig,"").length){result+=' icon="'+escape_xml(tmp1.children("ins").get(0).className.replace(/jstree[^ ]*|$/ig,'').replace(/\s+$/ig," ").replace(/^ /,"").replace(/ $/,""))+'"';}
if(tmp1.children("ins").get(0).style.backgroundImage.length){result+=' icon="'+escape_xml(tmp1.children("ins").get(0).style.backgroundImage.replace("url(","").replace(")","").replace(/'/ig,"").replace(/"/ig,""))+'"';}
result+=">";result+="<![CDATA["+_this.get_text(tmp1,lang)+"]]>";result+="</name>";});result+="</content>";tmp2=li[0].id||true;li=li.find("> ul > li");if(li.length){tmp2=_this.get_xml(tp,li,li_attr,a_attr,tmp2);}
else{tmp2="";}
if(tp=="nest"){result+=tmp2;}
result+="</item>";if(tp=="flat"){result+=tmp2;}});if(!is_callback){result+="</root>";}
return result;}}});})(jQuery);(function($){$.expr[':'].jstree_contains=function(a,i,m){return(a.textContent||a.innerText||"").toLowerCase().indexOf(m[3].toLowerCase())>=0;};$.expr[':'].jstree_title_contains=function(a,i,m){return(a.getAttribute("title")||"").toLowerCase().indexOf(m[3].toLowerCase())>=0;};$.jstree.plugin("search",{__init:function(){this.data.search.str="";this.data.search.result=$();if(this._get_settings().search.show_only_matches){this.get_container().bind("search.jstree",function(e,data){$(this).children("ul").find("li").hide().removeClass("jstree-last");data.rslt.nodes.parentsUntil(".jstree").andSelf().show().filter("ul").each(function(){$(this).children("li:visible").eq(-1).addClass("jstree-last");});}).bind("clear_search.jstree",function(){$(this).children("ul").find("li").css("display","").end().end().jstree("clean_node",-1);});}},defaults:{ajax:false,search_method:"jstree_contains",show_only_matches:false},_fn:{search:function(str,skip_async){if($.trim(str)===""){this.clear_search();return;}
var s=this.get_settings().search,t=this,error_func=function(){},success_func=function(){};this.data.search.str=str;if(!skip_async&&s.ajax!==false&&this.get_container_ul().find("li.jstree-closed:not(:has(ul)):eq(0)").length>0){this.search.supress_callback=true;error_func=function(){};success_func=function(d,t,x){var sf=this.get_settings().search.ajax.success;if(sf){d=sf.call(this,d,t,x)||d;}
this.data.search.to_open=d;this._search_open();};s.ajax.context=this;s.ajax.error=error_func;s.ajax.success=success_func;if($.isFunction(s.ajax.url)){s.ajax.url=s.ajax.url.call(this,str);}
if($.isFunction(s.ajax.data)){s.ajax.data=s.ajax.data.call(this,str);}
if(!s.ajax.data){s.ajax.data={"search_string":str};}
if(!s.ajax.dataType||/^json/.exec(s.ajax.dataType)){s.ajax.dataType="json";}
$.ajax(s.ajax);return;}
if(this.data.search.result.length){this.clear_search();}
this.data.search.result=this.get_container().find("a"+(this.data.languages?"."+this.get_lang():"")+":"+(s.search_method)+"("+this.data.search.str+")");this.data.search.result.addClass("jstree-search").parent().parents(".jstree-closed").each(function(){t.open_node(this,false,true);});this.__callback({nodes:this.data.search.result,str:str});},clear_search:function(str){this.data.search.result.removeClass("jstree-search");this.__callback(this.data.search.result);this.data.search.result=$();},_search_open:function(is_callback){var _this=this,done=true,current=[],remaining=[];if(this.data.search.to_open.length){$.each(this.data.search.to_open,function(i,val){if(val=="#"){return true;}
if($(val).length&&$(val).is(".jstree-closed")){current.push(val);}
else{remaining.push(val);}});if(current.length){this.data.search.to_open=remaining;$.each(current,function(i,val){_this.open_node(val,function(){_this._search_open(true);});});done=false;}}
if(done){this.search(this.data.search.str,true);}}}});})(jQuery);(function($){$.vakata.context={hide_on_mouseleave:false,cnt:$("<div id='vakata-contextmenu' />"),vis:false,tgt:false,par:false,func:false,data:false,rtl:false,show:function(s,t,x,y,d,p,rtl){$.vakata.context.rtl=!!rtl;var html=$.vakata.context.parse(s),h,w;if(!html){return;}
$.vakata.context.vis=true;$.vakata.context.tgt=t;$.vakata.context.par=p||t||null;$.vakata.context.data=d||null;$.vakata.context.cnt.html(html).css({"visibility":"hidden","display":"block","left":0,"top":0});if($.vakata.context.hide_on_mouseleave){$.vakata.context.cnt.one("mouseleave",function(e){$.vakata.context.hide();});}
h=$.vakata.context.cnt.height();w=$.vakata.context.cnt.width();if(x+w>$(document).width()){x=$(document).width()-(w+5);$.vakata.context.cnt.find("li > ul").addClass("right");}
if(y+h>$(document).height()){y=y-(h+t[0].offsetHeight);$.vakata.context.cnt.find("li > ul").addClass("bottom");}
$.vakata.context.cnt.css({"left":x,"top":y}).find("li:has(ul)").bind("mouseenter",function(e){var w=$(document).width(),h=$(document).height(),ul=$(this).children("ul").show();if(w!==$(document).width()){ul.toggleClass("right");}
if(h!==$(document).height()){ul.toggleClass("bottom");}}).bind("mouseleave",function(e){$(this).children("ul").hide();}).end().css({"visibility":"visible"}).show();$(document).triggerHandler("context_show.vakata");},hide:function(){$.vakata.context.vis=false;$.vakata.context.cnt.attr("class","").css({"visibility":"hidden"});$(document).triggerHandler("context_hide.vakata");},parse:function(s,is_callback){if(!s){return false;}
var str="",tmp=false,was_sep=true;if(!is_callback){$.vakata.context.func={};}
str+="<ul>";$.each(s,function(i,val){if(!val){return true;}
$.vakata.context.func[i]=val.action;if(!was_sep&&val.separator_before){str+="<li class='vakata-separator vakata-separator-before'></li>";}
was_sep=false;str+="<li class='"+(val._class||"")+(val._disabled?" jstree-contextmenu-disabled ":"")+"'><ins ";if(val.icon&&val.icon.indexOf("/")===-1){str+=" class='"+val.icon+"' ";}
if(val.icon&&val.icon.indexOf("/")!==-1){str+=" style='background:url("+val.icon+") center center no-repeat;' ";}
str+=">&#160;</ins><a href='#' rel='"+i+"'>";if(val.submenu){str+="<span style='float:"+($.vakata.context.rtl?"left":"right")+";'>&raquo;</span>";}
str+=val.label+"</a>";if(val.submenu){tmp=$.vakata.context.parse(val.submenu,true);if(tmp){str+=tmp;}}
str+="</li>";if(val.separator_after){str+="<li class='vakata-separator vakata-separator-after'></li>";was_sep=true;}});str=str.replace(/<li class\='vakata-separator vakata-separator-after'\><\/li\>$/,"");str+="</ul>";$(document).triggerHandler("context_parse.vakata");return str.length>10?str:false;},exec:function(i){if($.isFunction($.vakata.context.func[i])){$.vakata.context.func[i].call($.vakata.context.data,$.vakata.context.par);return true;}
else{return false;}}};$(function(){var css_string=''+'#vakata-contextmenu { display:block; visibility:hidden; left:0; top:-200px; position:absolute; margin:0; padding:0; min-width:180px; background:#ebebeb; border:1px solid silver; z-index:10000; *width:180px; } '+'#vakata-contextmenu ul { min-width:180px; *width:180px; } '+'#vakata-contextmenu ul, #vakata-contextmenu li { margin:0; padding:0; list-style-type:none; display:block; } '+'#vakata-contextmenu li { line-height:20px; min-height:20px; position:relative; padding:0px; } '+'#vakata-contextmenu li a { padding:1px 6px; line-height:17px; display:block; text-decoration:none; margin:1px 1px 0 1px; } '+'#vakata-contextmenu li ins { float:left; width:16px; height:16px; text-decoration:none; margin-right:2px; } '+'#vakata-contextmenu li a:hover, #vakata-contextmenu li.vakata-hover > a { background:gray; color:white; } '+'#vakata-contextmenu li ul { display:none; position:absolute; top:-2px; left:100%; background:#ebebeb; border:1px solid gray; } '+'#vakata-contextmenu .right { right:100%; left:auto; } '+'#vakata-contextmenu .bottom { bottom:-1px; top:auto; } '+'#vakata-contextmenu li.vakata-separator { min-height:0; height:1px; line-height:1px; font-size:1px; overflow:hidden; margin:0 2px; background:silver; /* border-top:1px solid #fefefe; */ padding:0; } ';$.vakata.css.add_sheet({str:css_string,title:"vakata"});$.vakata.context.cnt.delegate("a","click",function(e){e.preventDefault();}).delegate("a","mouseup",function(e){if(!$(this).parent().hasClass("jstree-contextmenu-disabled")&&$.vakata.context.exec($(this).attr("rel"))){$.vakata.context.hide();}
else{$(this).blur();}}).delegate("a","mouseover",function(){$.vakata.context.cnt.find(".vakata-hover").removeClass("vakata-hover");}).appendTo("body");$(document).bind("mousedown",function(e){if($.vakata.context.vis&&!$.contains($.vakata.context.cnt[0],e.target)){$.vakata.context.hide();}});if(typeof $.hotkeys!=="undefined"){$(document).bind("keydown","up",function(e){if($.vakata.context.vis){var o=$.vakata.context.cnt.find("ul:visible").last().children(".vakata-hover").removeClass("vakata-hover").prevAll("li:not(.vakata-separator)").first();if(!o.length){o=$.vakata.context.cnt.find("ul:visible").last().children("li:not(.vakata-separator)").last();}
o.addClass("vakata-hover");e.stopImmediatePropagation();e.preventDefault();}}).bind("keydown","down",function(e){if($.vakata.context.vis){var o=$.vakata.context.cnt.find("ul:visible").last().children(".vakata-hover").removeClass("vakata-hover").nextAll("li:not(.vakata-separator)").first();if(!o.length){o=$.vakata.context.cnt.find("ul:visible").last().children("li:not(.vakata-separator)").first();}
o.addClass("vakata-hover");e.stopImmediatePropagation();e.preventDefault();}}).bind("keydown","right",function(e){if($.vakata.context.vis){$.vakata.context.cnt.find(".vakata-hover").children("ul").show().children("li:not(.vakata-separator)").removeClass("vakata-hover").first().addClass("vakata-hover");e.stopImmediatePropagation();e.preventDefault();}}).bind("keydown","left",function(e){if($.vakata.context.vis){$.vakata.context.cnt.find(".vakata-hover").children("ul").hide().children(".vakata-separator").removeClass("vakata-hover");e.stopImmediatePropagation();e.preventDefault();}}).bind("keydown","esc",function(e){$.vakata.context.hide();e.preventDefault();}).bind("keydown","space",function(e){$.vakata.context.cnt.find(".vakata-hover").last().children("a").click();e.preventDefault();});}});$.jstree.plugin("contextmenu",{__init:function(){this.get_container().delegate("a","contextmenu.jstree",$.proxy(function(e){e.preventDefault();if(!$(e.currentTarget).hasClass("jstree-loading")){this.show_contextmenu(e.currentTarget,e.pageX,e.pageY);}},this)).delegate("a","click.jstree",$.proxy(function(e){if(this.data.contextmenu){$.vakata.context.hide();}},this)).bind("destroy.jstree",$.proxy(function(){if(this.data.contextmenu){$.vakata.context.hide();}},this));$(document).bind("context_hide.vakata",$.proxy(function(){this.data.contextmenu=false;},this));},defaults:{select_node:false,show_at_node:true,items:{"create":{"separator_before":false,"separator_after":true,"label":"Create","action":function(obj){this.create(obj);}},"rename":{"separator_before":false,"separator_after":false,"label":"Rename","action":function(obj){this.rename(obj);}},"remove":{"separator_before":false,"icon":false,"separator_after":false,"label":"Delete","action":function(obj){if(this.is_selected(obj)){this.remove();}else{this.remove(obj);}}},"ccp":{"separator_before":true,"icon":false,"separator_after":false,"label":"Edit","action":false,"submenu":{"cut":{"separator_before":false,"separator_after":false,"label":"Cut","action":function(obj){this.cut(obj);}},"copy":{"separator_before":false,"icon":false,"separator_after":false,"label":"Copy","action":function(obj){this.copy(obj);}},"paste":{"separator_before":false,"icon":false,"separator_after":false,"label":"Paste","action":function(obj){this.paste(obj);}}}}}},_fn:{show_contextmenu:function(obj,x,y){obj=this._get_node(obj);var s=this.get_settings().contextmenu,a=obj.children("a:visible:eq(0)"),o=false,i=false;if(s.select_node&&this.data.ui&&!this.is_selected(obj)){this.deselect_all();this.select_node(obj,true);}
if(s.show_at_node||typeof x==="undefined"||typeof y==="undefined"){o=a.offset();x=o.left;y=o.top+this.data.core.li_height;}
i=obj.data("jstree")&&obj.data("jstree").contextmenu?obj.data("jstree").contextmenu:s.items;if($.isFunction(i)){i=i.call(this,obj);}
this.data.contextmenu=true;$.vakata.context.show(i,a,x,y,this,obj,this._get_settings().core.rtl);if(this.data.themes){$.vakata.context.cnt.attr("class","jstree-"+this.data.themes.theme+"-context");}}}});})(jQuery);(function($){$.jstree.plugin("types",{__init:function(){var s=this._get_settings().types;this.data.types.attach_to=[];this.get_container().bind("init.jstree",$.proxy(function(){var types=s.types,attr=s.type_attr,icons_css="",_this=this;$.each(types,function(i,tp){$.each(tp,function(k,v){if(!/^(max_depth|max_children|icon|valid_children)$/.test(k)){_this.data.types.attach_to.push(k);}});if(!tp.icon){return true;}
if(tp.icon.image||tp.icon.position){if(i=="default"){icons_css+='.jstree-'+_this.get_index()+' a > .jstree-icon { ';}
else{icons_css+='.jstree-'+_this.get_index()+' li['+attr+'="'+i+'"] > a > .jstree-icon { ';}
if(tp.icon.image){icons_css+=' background-image:url('+tp.icon.image+'); ';}
if(tp.icon.position){icons_css+=' background-position:'+tp.icon.position+'; ';}
else{icons_css+=' background-position:0 0; ';}
icons_css+='} ';}});if(icons_css!==""){$.vakata.css.add_sheet({'str':icons_css,title:"jstree-types"});}},this)).bind("before.jstree",$.proxy(function(e,data){var s,t,o=this._get_settings().types.use_data?this._get_node(data.args[0]):false,d=o&&o!==-1&&o.length?o.data("jstree"):false;if(d&&d.types&&d.types[data.func]===false){e.stopImmediatePropagation();return false;}
if($.inArray(data.func,this.data.types.attach_to)!==-1){if(!data.args[0]||(!data.args[0].tagName&&!data.args[0].jquery)){return;}
s=this._get_settings().types.types;t=this._get_type(data.args[0]);if(((s[t]&&typeof s[t][data.func]!=="undefined")||(s["default"]&&typeof s["default"][data.func]!=="undefined"))&&this._check(data.func,data.args[0])===false){e.stopImmediatePropagation();return false;}}},this));if(is_ie6){this.get_container().bind("load_node.jstree set_type.jstree",$.proxy(function(e,data){var r=data&&data.rslt&&data.rslt.obj&&data.rslt.obj!==-1?this._get_node(data.rslt.obj).parent():this.get_container_ul(),c=false,s=this._get_settings().types;$.each(s.types,function(i,tp){if(tp.icon&&(tp.icon.image||tp.icon.position)){c=i==="default"?r.find("li > a > .jstree-icon"):r.find("li["+s.type_attr+"='"+i+"'] > a > .jstree-icon");if(tp.icon.image){c.css("backgroundImage","url("+tp.icon.image+")");}
c.css("backgroundPosition",tp.icon.position||"0 0");}});},this));}},defaults:{max_children:-1,max_depth:-1,valid_children:"all",use_data:false,type_attr:"rel",types:{"default":{"max_children":-1,"max_depth":-1,"valid_children":"all"}}},_fn:{_types_notify:function(n,data){if(data.type&&this._get_settings().types.use_data){this.set_type(data.type,n);}},_get_type:function(obj){obj=this._get_node(obj);return(!obj||!obj.length)?false:obj.attr(this._get_settings().types.type_attr)||"default";},set_type:function(str,obj){obj=this._get_node(obj);var ret=(!obj.length||!str)?false:obj.attr(this._get_settings().types.type_attr,str);if(ret){this.__callback({obj:obj,type:str});}
return ret;},_check:function(rule,obj,opts){obj=this._get_node(obj);var v=false,t=this._get_type(obj),d=0,_this=this,s=this._get_settings().types,data=false;if(obj===-1){if(!!s[rule]){v=s[rule];}
else{return;}}
else{if(t===false){return;}
data=s.use_data?obj.data("jstree"):false;if(data&&data.types&&typeof data.types[rule]!=="undefined"){v=data.types[rule];}
else if(!!s.types[t]&&typeof s.types[t][rule]!=="undefined"){v=s.types[t][rule];}
else if(!!s.types["default"]&&typeof s.types["default"][rule]!=="undefined"){v=s.types["default"][rule];}}
if($.isFunction(v)){v=v.call(this,obj);}
if(rule==="max_depth"&&obj!==-1&&opts!==false&&s.max_depth!==-2&&v!==0){obj.children("a:eq(0)").parentsUntil(".jstree","li").each(function(i){if(s.max_depth!==-1&&s.max_depth-(i+1)<=0){v=0;return false;}
d=(i===0)?v:_this._check(rule,this,false);if(d!==-1&&d-(i+1)<=0){v=0;return false;}
if(d>=0&&(d-(i+1)<v||v<0)){v=d-(i+1);}
if(s.max_depth>=0&&(s.max_depth-(i+1)<v||v<0)){v=s.max_depth-(i+1);}});}
return v;},check_move:function(){if(!this.__call_old()){return false;}
var m=this._get_move(),s=m.rt._get_settings().types,mc=m.rt._check("max_children",m.cr),md=m.rt._check("max_depth",m.cr),vc=m.rt._check("valid_children",m.cr),ch=0,d=1,t;if(vc==="none"){return false;}
if($.isArray(vc)&&m.ot&&m.ot._get_type){m.o.each(function(){if($.inArray(m.ot._get_type(this),vc)===-1){d=false;return false;}});if(d===false){return false;}}
if(s.max_children!==-2&&mc!==-1){ch=m.cr===-1?this.get_container().find("> ul > li").not(m.o).length:m.cr.find("> ul > li").not(m.o).length;if(ch+m.o.length>mc){return false;}}
if(s.max_depth!==-2&&md!==-1){d=0;if(md===0){return false;}
if(typeof m.o.d==="undefined"){t=m.o;while(t.length>0){t=t.find("> ul > li");d++;}
m.o.d=d;}
if(md-m.o.d<0){return false;}}
return true;},create_node:function(obj,position,js,callback,is_loaded,skip_check){if(!skip_check&&(is_loaded||this._is_loaded(obj))){var p=(typeof position=="string"&&position.match(/^before|after$/i)&&obj!==-1)?this._get_parent(obj):this._get_node(obj),s=this._get_settings().types,mc=this._check("max_children",p),md=this._check("max_depth",p),vc=this._check("valid_children",p),ch;if(typeof js==="string"){js={data:js};}
if(!js){js={};}
if(vc==="none"){return false;}
if($.isArray(vc)){if(!js.attr||!js.attr[s.type_attr]){if(!js.attr){js.attr={};}
js.attr[s.type_attr]=vc[0];}
else{if($.inArray(js.attr[s.type_attr],vc)===-1){return false;}}}
if(s.max_children!==-2&&mc!==-1){ch=p===-1?this.get_container().find("> ul > li").length:p.find("> ul > li").length;if(ch+1>mc){return false;}}
if(s.max_depth!==-2&&md!==-1&&(md-1)<0){return false;}}
return this.__call_old(true,obj,position,js,callback,is_loaded,skip_check);}}});})(jQuery);(function($){$.jstree.plugin("html_data",{__init:function(){this.data.html_data.original_container_html=this.get_container().find(" > ul > li").clone(true);this.data.html_data.original_container_html.find("li").andSelf().contents().filter(function(){return this.nodeType==3;}).remove();},defaults:{data:false,ajax:false,correct_state:true},_fn:{load_node:function(obj,s_call,e_call){var _this=this;this.load_node_html(obj,function(){_this.__callback({"obj":_this._get_node(obj)});s_call.call(this);},e_call);},_is_loaded:function(obj){obj=this._get_node(obj);return obj==-1||!obj||(!this._get_settings().html_data.ajax&&!$.isFunction(this._get_settings().html_data.data))||obj.is(".jstree-open, .jstree-leaf")||obj.children("ul").children("li").size()>0;},load_node_html:function(obj,s_call,e_call){var d,s=this.get_settings().html_data,error_func=function(){},success_func=function(){};obj=this._get_node(obj);if(obj&&obj!==-1){if(obj.data("jstree-is-loading")){return;}
else{obj.data("jstree-is-loading",true);}}
switch(!0){case($.isFunction(s.data)):s.data.call(this,obj,$.proxy(function(d){if(d&&d!==""&&d.toString&&d.toString().replace(/^[\s\n]+$/,"")!==""){d=$(d);if(!d.is("ul")){d=$("<ul />").append(d);}
if(obj==-1||!obj){this.get_container().children("ul").empty().append(d.children()).find("li, a").filter(function(){return!this.firstChild||!this.firstChild.tagName||this.firstChild.tagName!=="INS";}).prepend("<ins class='jstree-icon'>&#160;</ins>").end().filter("a").children("ins:first-child").not(".jstree-icon").addClass("jstree-icon");}
else{obj.children("a.jstree-loading").removeClass("jstree-loading");obj.append(d).children("ul").find("li, a").filter(function(){return!this.firstChild||!this.firstChild.tagName||this.firstChild.tagName!=="INS";}).prepend("<ins class='jstree-icon'>&#160;</ins>").end().filter("a").children("ins:first-child").not(".jstree-icon").addClass("jstree-icon");obj.removeData("jstree-is-loading");}
this.clean_node(obj);if(s_call){s_call.call(this);}}
else{if(obj&&obj!==-1){obj.children("a.jstree-loading").removeClass("jstree-loading");obj.removeData("jstree-is-loading");if(s.correct_state){this.correct_state(obj);if(s_call){s_call.call(this);}}}
else{if(s.correct_state){this.get_container().children("ul").empty();if(s_call){s_call.call(this);}}}}},this));break;case(!s.data&&!s.ajax):if(!obj||obj==-1){this.get_container().children("ul").empty().append(this.data.html_data.original_container_html).find("li, a").filter(function(){return!this.firstChild||!this.firstChild.tagName||this.firstChild.tagName!=="INS";}).prepend("<ins class='jstree-icon'>&#160;</ins>").end().filter("a").children("ins:first-child").not(".jstree-icon").addClass("jstree-icon");this.clean_node();}
if(s_call){s_call.call(this);}
break;case(!!s.data&&!s.ajax)||(!!s.data&&!!s.ajax&&(!obj||obj===-1)):if(!obj||obj==-1){d=$(s.data);if(!d.is("ul")){d=$("<ul />").append(d);}
this.get_container().children("ul").empty().append(d.children()).find("li, a").filter(function(){return!this.firstChild||!this.firstChild.tagName||this.firstChild.tagName!=="INS";}).prepend("<ins class='jstree-icon'>&#160;</ins>").end().filter("a").children("ins:first-child").not(".jstree-icon").addClass("jstree-icon");this.clean_node();}
if(s_call){s_call.call(this);}
break;case(!s.data&&!!s.ajax)||(!!s.data&&!!s.ajax&&obj&&obj!==-1):obj=this._get_node(obj);error_func=function(x,t,e){var ef=this.get_settings().html_data.ajax.error;if(ef){ef.call(this,x,t,e);}
if(obj!=-1&&obj.length){obj.children("a.jstree-loading").removeClass("jstree-loading");obj.removeData("jstree-is-loading");if(t==="success"&&s.correct_state){this.correct_state(obj);}}
else{if(t==="success"&&s.correct_state){this.get_container().children("ul").empty();}}
if(e_call){e_call.call(this);}};success_func=function(d,t,x){var sf=this.get_settings().html_data.ajax.success;if(sf){d=sf.call(this,d,t,x)||d;}
if(d===""||(d&&d.toString&&d.toString().replace(/^[\s\n]+$/,"")==="")){return error_func.call(this,x,t,"");}
if(d){d=$(d);if(!d.is("ul")){d=$("<ul />").append(d);}
if(obj==-1||!obj){this.get_container().children("ul").empty().append(d.children()).find("li, a").filter(function(){return!this.firstChild||!this.firstChild.tagName||this.firstChild.tagName!=="INS";}).prepend("<ins class='jstree-icon'>&#160;</ins>").end().filter("a").children("ins:first-child").not(".jstree-icon").addClass("jstree-icon");}
else{obj.children("a.jstree-loading").removeClass("jstree-loading");obj.append(d).children("ul").find("li, a").filter(function(){return!this.firstChild||!this.firstChild.tagName||this.firstChild.tagName!=="INS";}).prepend("<ins class='jstree-icon'>&#160;</ins>").end().filter("a").children("ins:first-child").not(".jstree-icon").addClass("jstree-icon");obj.removeData("jstree-is-loading");}
this.clean_node(obj);if(s_call){s_call.call(this);}}
else{if(obj&&obj!==-1){obj.children("a.jstree-loading").removeClass("jstree-loading");obj.removeData("jstree-is-loading");if(s.correct_state){this.correct_state(obj);if(s_call){s_call.call(this);}}}
else{if(s.correct_state){this.get_container().children("ul").empty();if(s_call){s_call.call(this);}}}}};s.ajax.context=this;s.ajax.error=error_func;s.ajax.success=success_func;if(!s.ajax.dataType){s.ajax.dataType="html";}
if($.isFunction(s.ajax.url)){s.ajax.url=s.ajax.url.call(this,obj);}
if($.isFunction(s.ajax.data)){s.ajax.data=s.ajax.data.call(this,obj);}
$.ajax(s.ajax);break;}}}});$.jstree.defaults.plugins.push("html_data");})(jQuery);(function($){$.jstree.plugin("themeroller",{__init:function(){var s=this._get_settings().themeroller;this.get_container().addClass("ui-widget-content").addClass("jstree-themeroller").delegate("a","mouseenter.jstree",function(e){if(!$(e.currentTarget).hasClass("jstree-loading")){$(this).addClass(s.item_h);}}).delegate("a","mouseleave.jstree",function(){$(this).removeClass(s.item_h);}).bind("init.jstree",$.proxy(function(e,data){data.inst.get_container().find("> ul > li > .jstree-loading > ins").addClass("ui-icon-refresh");this._themeroller(data.inst.get_container().find("> ul > li"));},this)).bind("open_node.jstree create_node.jstree",$.proxy(function(e,data){this._themeroller(data.rslt.obj);},this)).bind("loaded.jstree refresh.jstree",$.proxy(function(e){this._themeroller();},this)).bind("close_node.jstree",$.proxy(function(e,data){this._themeroller(data.rslt.obj);},this)).bind("delete_node.jstree",$.proxy(function(e,data){this._themeroller(data.rslt.parent);},this)).bind("correct_state.jstree",$.proxy(function(e,data){data.rslt.obj.children("ins.jstree-icon").removeClass(s.opened+" "+s.closed+" ui-icon").end().find("> a > ins.ui-icon").filter(function(){return this.className.toString().replace(s.item_clsd,"").replace(s.item_open,"").replace(s.item_leaf,"").indexOf("ui-icon-")===-1;}).removeClass(s.item_open+" "+s.item_clsd).addClass(s.item_leaf||"jstree-no-icon");},this)).bind("select_node.jstree",$.proxy(function(e,data){data.rslt.obj.children("a").addClass(s.item_a);},this)).bind("deselect_node.jstree deselect_all.jstree",$.proxy(function(e,data){this.get_container().find("a."+s.item_a).removeClass(s.item_a).end().find("a.jstree-clicked").addClass(s.item_a);},this)).bind("dehover_node.jstree",$.proxy(function(e,data){data.rslt.obj.children("a").removeClass(s.item_h);},this)).bind("hover_node.jstree",$.proxy(function(e,data){this.get_container().find("a."+s.item_h).not(data.rslt.obj).removeClass(s.item_h);data.rslt.obj.children("a").addClass(s.item_h);},this)).bind("move_node.jstree",$.proxy(function(e,data){this._themeroller(data.rslt.o);this._themeroller(data.rslt.op);},this));},__destroy:function(){var s=this._get_settings().themeroller,c=["ui-icon"];$.each(s,function(i,v){v=v.split(" ");if(v.length){c=c.concat(v);}});this.get_container().removeClass("ui-widget-content").find("."+c.join(", .")).removeClass(c.join(" "));},_fn:{_themeroller:function(obj){var s=this._get_settings().themeroller;obj=!obj||obj==-1?this.get_container_ul():this._get_node(obj).parent();obj.find("li.jstree-closed").children("ins.jstree-icon").removeClass(s.opened).addClass("ui-icon "+s.closed).end().children("a").addClass(s.item).children("ins.jstree-icon").addClass("ui-icon").filter(function(){return this.className.toString().replace(s.item_clsd,"").replace(s.item_open,"").replace(s.item_leaf,"").indexOf("ui-icon-")===-1;}).removeClass(s.item_leaf+" "+s.item_open).addClass(s.item_clsd||"jstree-no-icon").end().end().end().end().find("li.jstree-open").children("ins.jstree-icon").removeClass(s.closed).addClass("ui-icon "+s.opened).end().children("a").addClass(s.item).children("ins.jstree-icon").addClass("ui-icon").filter(function(){return this.className.toString().replace(s.item_clsd,"").replace(s.item_open,"").replace(s.item_leaf,"").indexOf("ui-icon-")===-1;}).removeClass(s.item_leaf+" "+s.item_clsd).addClass(s.item_open||"jstree-no-icon").end().end().end().end().find("li.jstree-leaf").children("ins.jstree-icon").removeClass(s.closed+" ui-icon "+s.opened).end().children("a").addClass(s.item).children("ins.jstree-icon").addClass("ui-icon").filter(function(){return this.className.toString().replace(s.item_clsd,"").replace(s.item_open,"").replace(s.item_leaf,"").indexOf("ui-icon-")===-1;}).removeClass(s.item_clsd+" "+s.item_open).addClass(s.item_leaf||"jstree-no-icon");}},defaults:{"opened":"ui-icon-triangle-1-se","closed":"ui-icon-triangle-1-e","item":"ui-state-default","item_h":"ui-state-hover","item_a":"ui-state-active","item_open":"ui-icon-folder-open","item_clsd":"ui-icon-folder-collapsed","item_leaf":"ui-icon-document"}});$(function(){var css_string=''+'.jstree-themeroller .ui-icon { overflow:visible; } '+'.jstree-themeroller a { padding:0 2px; } '+'.jstree-themeroller .jstree-no-icon { display:none; }';$.vakata.css.add_sheet({str:css_string,title:"jstree"});});})(jQuery);(function($){$.jstree.plugin("unique",{__init:function(){this.get_container().bind("before.jstree",$.proxy(function(e,data){var nms=[],res=true,p,t;if(data.func=="move_node"){if(data.args[4]===true){if(data.args[0].o&&data.args[0].o.length){data.args[0].o.children("a").each(function(){nms.push($(this).text().replace(/^\s+/g,""));});res=this._check_unique(nms,data.args[0].np.find("> ul > li").not(data.args[0].o),"move_node");}}}
if(data.func=="create_node"){if(data.args[4]||this._is_loaded(data.args[0])){p=this._get_node(data.args[0]);if(data.args[1]&&(data.args[1]==="before"||data.args[1]==="after")){p=this._get_parent(data.args[0]);if(!p||p===-1){p=this.get_container();}}
if(typeof data.args[2]==="string"){nms.push(data.args[2]);}
else if(!data.args[2]||!data.args[2].data){nms.push(this._get_string("new_node"));}
else{nms.push(data.args[2].data);}
res=this._check_unique(nms,p.find("> ul > li"),"create_node");}}
if(data.func=="rename_node"){nms.push(data.args[1]);t=this._get_node(data.args[0]);p=this._get_parent(t);if(!p||p===-1){p=this.get_container();}
res=this._check_unique(nms,p.find("> ul > li").not(t),"rename_node");}
if(!res){e.stopPropagation();return false;}},this));},defaults:{error_callback:$.noop},_fn:{_check_unique:function(nms,p,func){var cnms=[];p.children("a").each(function(){cnms.push($(this).text().replace(/^\s+/g,""));});if(!cnms.length||!nms.length){return true;}
cnms=cnms.sort().join(",,").replace(/(,|^)([^,]+)(,,\2)+(,|$)/g,"$1$2$4").replace(/,,+/g,",").replace(/,$/,"").split(",");if((cnms.length+nms.length)!=cnms.concat(nms).sort().join(",,").replace(/(,|^)([^,]+)(,,\2)+(,|$)/g,"$1$2$4").replace(/,,+/g,",").replace(/,$/,"").split(",").length){this._get_settings().unique.error_callback.call(null,nms,p,func);return false;}
return true;},check_move:function(){if(!this.__call_old()){return false;}
var p=this._get_move(),nms=[];if(p.o&&p.o.length){p.o.children("a").each(function(){nms.push($(this).text().replace(/^\s+/g,""));});return this._check_unique(nms,p.np.find("> ul > li").not(p.o),"check_move");}
return true;}}});})(jQuery);(function($){$.jstree.plugin("wholerow",{__init:function(){if(!this.data.ui){throw"jsTree wholerow: jsTree UI plugin not included.";}
this.data.wholerow.html=false;this.data.wholerow.to=false;this.get_container().bind("init.jstree",$.proxy(function(e,data){this._get_settings().core.animation=0;},this)).bind("open_node.jstree create_node.jstree clean_node.jstree loaded.jstree",$.proxy(function(e,data){this._prepare_wholerow_span(data&&data.rslt&&data.rslt.obj?data.rslt.obj:-1);},this)).bind("search.jstree clear_search.jstree reopen.jstree after_open.jstree after_close.jstree create_node.jstree delete_node.jstree clean_node.jstree",$.proxy(function(e,data){if(this.data.to){clearTimeout(this.data.to);}
this.data.to=setTimeout((function(t,o){return function(){t._prepare_wholerow_ul(o);};})(this,data&&data.rslt&&data.rslt.obj?data.rslt.obj:-1),0);},this)).bind("deselect_all.jstree",$.proxy(function(e,data){this.get_container().find(" > .jstree-wholerow .jstree-clicked").removeClass("jstree-clicked "+(this.data.themeroller?this._get_settings().themeroller.item_a:""));},this)).bind("select_node.jstree deselect_node.jstree ",$.proxy(function(e,data){data.rslt.obj.each(function(){var ref=data.inst.get_container().find(" > .jstree-wholerow li:visible:eq("+(parseInt((($(this).offset().top-data.inst.get_container().offset().top+data.inst.get_container()[0].scrollTop)/data.inst.data.core.li_height),10))+")");ref.children("a").attr("class",data.rslt.obj.children("a").attr("class"));});},this)).bind("hover_node.jstree dehover_node.jstree",$.proxy(function(e,data){this.get_container().find(" > .jstree-wholerow .jstree-hovered").removeClass("jstree-hovered "+(this.data.themeroller?this._get_settings().themeroller.item_h:""));if(e.type==="hover_node"){var ref=this.get_container().find(" > .jstree-wholerow li:visible:eq("+(parseInt(((data.rslt.obj.offset().top-this.get_container().offset().top+this.get_container()[0].scrollTop)/this.data.core.li_height),10))+")");ref.children("a").attr("class",data.rslt.obj.children(".jstree-hovered").attr("class"));}},this)).delegate(".jstree-wholerow-span, ins.jstree-icon, li","click.jstree",function(e){var n=$(e.currentTarget);if(e.target.tagName==="A"||(e.target.tagName==="INS"&&n.closest("li").is(".jstree-open, .jstree-closed"))){return;}
n.closest("li").children("a:visible:eq(0)").click();e.stopImmediatePropagation();}).delegate("li","mouseover.jstree",$.proxy(function(e){e.stopImmediatePropagation();if($(e.currentTarget).children(".jstree-hovered, .jstree-clicked").length){return false;}
this.hover_node(e.currentTarget);return false;},this)).delegate("li","mouseleave.jstree",$.proxy(function(e){if($(e.currentTarget).children("a").hasClass("jstree-hovered").length){return;}
this.dehover_node(e.currentTarget);},this));if(is_ie7||is_ie6){$.vakata.css.add_sheet({str:".jstree-"+this.get_index()+" { position:relative; } ",title:"jstree"});}},defaults:{},__destroy:function(){this.get_container().children(".jstree-wholerow").remove();this.get_container().find(".jstree-wholerow-span").remove();},_fn:{_prepare_wholerow_span:function(obj){obj=!obj||obj==-1?this.get_container().find("> ul > li"):this._get_node(obj);if(obj===false){return;}
obj.each(function(){$(this).find("li").andSelf().each(function(){var $t=$(this);if($t.children(".jstree-wholerow-span").length){return true;}
$t.prepend("<span class='jstree-wholerow-span' style='width:"+($t.parentsUntil(".jstree","li").length*18)+"px;'>&#160;</span>");});});},_prepare_wholerow_ul:function(){var o=this.get_container().children("ul").eq(0),h=o.html();o.addClass("jstree-wholerow-real");if(this.data.wholerow.last_html!==h){this.data.wholerow.last_html=h;this.get_container().children(".jstree-wholerow").remove();this.get_container().append(o.clone().removeClass("jstree-wholerow-real").wrapAll("<div class='jstree-wholerow' />").parent().width(o.parent()[0].scrollWidth).css("top",(o.height()+(is_ie7?5:0))* -1).find("li[id]").each(function(){this.removeAttribute("id");}).end());}}}});$(function(){var css_string=''+'.jstree .jstree-wholerow-real { position:relative; z-index:1; } '+'.jstree .jstree-wholerow-real li { cursor:pointer; } '+'.jstree .jstree-wholerow-real a { border-left-color:transparent !important; border-right-color:transparent !important; } '+'.jstree .jstree-wholerow { position:relative; z-index:0; height:0; } '+'.jstree .jstree-wholerow ul, .jstree .jstree-wholerow li { width:100%; } '+'.jstree .jstree-wholerow, .jstree .jstree-wholerow ul, .jstree .jstree-wholerow li, .jstree .jstree-wholerow a { margin:0 !important; padding:0 !important; } '+'.jstree .jstree-wholerow, .jstree .jstree-wholerow ul, .jstree .jstree-wholerow li { background:transparent !important; }'+'.jstree .jstree-wholerow ins, .jstree .jstree-wholerow span, .jstree .jstree-wholerow input { display:none !important; }'+'.jstree .jstree-wholerow a, .jstree .jstree-wholerow a:hover { text-indent:-9999px; !important; width:100%; padding:0 !important; border-right-width:0px !important; border-left-width:0px !important; } '+'.jstree .jstree-wholerow-span { position:absolute; left:0; margin:0px; padding:0; height:18px; border-width:0; padding:0; z-index:0; }';if(is_ff2){css_string+=''+'.jstree .jstree-wholerow a { display:block; height:18px; margin:0; padding:0; border:0; } '+'.jstree .jstree-wholerow-real a { border-color:transparent !important; } ';}
if(is_ie7||is_ie6){css_string+=''+'.jstree .jstree-wholerow, .jstree .jstree-wholerow li, .jstree .jstree-wholerow ul, .jstree .jstree-wholerow a { margin:0; padding:0; line-height:18px; } '+'.jstree .jstree-wholerow a { display:block; height:18px; line-height:18px; overflow:hidden; } ';}
$.vakata.css.add_sheet({str:css_string,title:"jstree"});});})(jQuery);(function($){var nodeInterface=["getChildren","getChildrenCount","getAttr","getName","getProps"],validateInterface=function(obj,inter){var valid=true;obj=obj||{};inter=[].concat(inter);$.each(inter,function(i,v){if(!$.isFunction(obj[v])){valid=false;return false;}});return valid;};$.jstree.plugin("model",{__init:function(){if(!this.data.json_data){throw"jsTree model: jsTree json_data plugin not included.";}
this._get_settings().json_data.data=function(n,b){var obj=(n==-1)?this._get_settings().model.object:n.data("jstree_model");if(!validateInterface(obj,nodeInterface)){return b.call(null,false);}
if(this._get_settings().model.async){obj.getChildren($.proxy(function(data){this.model_done(data,b);},this));}
else{this.model_done(obj.getChildren(),b);}};},defaults:{object:false,id_prefix:false,async:false},_fn:{model_done:function(data,callback){var ret=[],s=this._get_settings(),_this=this;if(!$.isArray(data)){data=[data];}
$.each(data,function(i,nd){var r=nd.getProps()||{};r.attr=nd.getAttr()||{};if(nd.getChildrenCount()){r.state="closed";}
r.data=nd.getName();if(!$.isArray(r.data)){r.data=[r.data];}
if(_this.data.types&&$.isFunction(nd.getType)){r.attr[s.types.type_attr]=nd.getType();}
if(r.attr.id&&s.model.id_prefix){r.attr.id=s.model.id_prefix+r.attr.id;}
if(!r.metadata){r.metadata={};}
r.metadata.jstree_model=nd;ret.push(r);});callback.call(null,ret);}}});})(jQuery);})();});;define('jqgrid',['jquery','jqgrid-locale-'+(window&&window.__DEPS__&&window.__DEPS__.lang||'en'),'jqueryui'],function(jQuery){var $=jQuery;(function(b){b.jgrid=b.jgrid||{};b.extend(b.jgrid,{htmlDecode:function(f){if(f&&(f=="&nbsp;"||f=="&#160;"||f.length==1&&f.charCodeAt(0)==160))return"";return!f?f:String(f).replace(/&amp;/g,"&").replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&quot;/g,'"')},htmlEncode:function(f){return!f?f:String(f).replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/\"/g,"&quot;")},format:function(f){var j=b.makeArray(arguments).slice(1);if(f===undefined)f="";return f.replace(/\{(\d+)\}/g,function(h,c){return j[c]})},getCellIndex:function(f){f=b(f);if(f.is("tr"))return-1;f=(!f.is("td")&&!f.is("th")?f.closest("td,th"):f)[0];if(b.browser.msie)return b.inArray(f,f.parentNode.cells);return f.cellIndex},stripHtml:function(f){f+="";var j=/<("[^"]*"|'[^']*'|[^'">])*>/gi;if(f)return(f=f.replace(j,""))&&f!=="&nbsp;"&&f!=="&#160;"?f.replace(/\"/g,"'"):"";else return f},stringToDoc:function(f){var j;if(typeof f!=="string")return f;try{j=(new DOMParser).parseFromString(f,"text/xml")}catch(h){j=new ActiveXObject("Microsoft.XMLDOM");j.async=false;j.loadXML(f)}return j&&j.documentElement&&j.documentElement.tagName!="parsererror"?j:null},parse:function(f){if(f.substr(0,9)=="while(1);")f=f.substr(9);if(f.substr(0,2)=="/*")f=f.substr(2,f.length-4);f||(f="{}");return b.jgrid.useJSON===true&&typeof JSON==="object"&&typeof JSON.parse==="function"?JSON.parse(f):eval("("+f+")")},parseDate:function(f,j){var h={m:1,d:1,y:1970,h:0,i:0,s:0},c,g,k;c=/[\\\/:_;.,\t\T\s-]/;if(j&&j!==null&&j!==undefined){j=b.trim(j);j=j.split(c);f=f.split(c);var l=b.jgrid.formatter.date.monthNames,a=b.jgrid.formatter.date.AmPm,r=function(v,z){if(v===0){if(z==12)z=0}else if(z!=12)z+=12;return z};c=0;for(g=f.length;c<g;c++){if(f[c]=="M"){k=b.inArray(j[c],l);if(k!==-1&&k<12)j[c]=k+1}if(f[c]=="F"){k=b.inArray(j[c],l);if(k!==-1&&k>11)j[c]=k+1-12}if(f[c]=="a"){k=b.inArray(j[c],a);if(k!==-1&&k<2&&j[c]==a[k]){j[c]=k;h.h=r(j[c],h.h)}}if(f[c]=="A"){k=b.inArray(j[c],a);if(k!==-1&&k>1&&j[c]==a[k]){j[c]=k-2;h.h=r(j[c],h.h)}}if(j[c]!==undefined)h[f[c].toLowerCase()]=parseInt(j[c],10)}h.m=parseInt(h.m,10)-1;c=h.y;if(c>=70&&c<=99)h.y=1900+h.y;else if(c>=0&&c<=69)h.y=2E3+h.y}return new Date(h.y,h.m,h.d,h.h,h.i,h.s,0)},jqID:function(f){f+="";return f.replace(/([\.\:\[\]])/g,"\\$1")},guid:1,uidPref:"jqg",randId:function(f){return(f?f:b.jgrid.uidPref)+b.jgrid.guid++},getAccessor:function(f,j){var h,c,g=[],k;if(typeof j==="function")return j(f);h=f[j];if(h===undefined)try{if(typeof j==="string")g=j.split(".");if(k=g.length)for(h=f;h&&k--;){c=g.shift();h=h[c]}}catch(l){}return h},ajaxOptions:{},from:function(f){return new function(j,h){if(typeof j=="string")j=b.data(j);var c=this,g=j,k=true,l=false,a=h,r=/[\$,%]/g,v=null,z=null,E=false,P="",K=[],O=true;if(typeof j=="object"&&j.push){if(j.length>0)O=typeof j[0]!="object"?false:true}else throw"data provides is not an array";this._hasData=function(){return g===null?false:g.length===0?false:true};this._getStr=function(m){var o=[];l&&o.push("jQuery.trim(");o.push("String("+m+")");l&&o.push(")");k||o.push(".toLowerCase()");return o.join("")};this._strComp=function(m){return typeof m=="string"?".toString()":""};this._group=function(m,o){return{field:m.toString(),unique:o,items:[]}};this._toStr=function(m){if(l)m=b.trim(m);k||(m=m.toLowerCase());return m=m.toString().replace(/\\/g,"\\\\").replace(/\"/g,'\\"')};this._funcLoop=function(m){var o=[];b.each(g,function(q,B){o.push(m(B))});return o};this._append=function(m){if(a===null)a="";else a+=P===""?" && ":P;if(E)a+="!";a+="("+m+")";E=false;P=""};this._setCommand=function(m,o){v=m;z=o};this._resetNegate=function(){E=false};this._repeatCommand=function(m,o){if(v===null)return c;if(m!==null&&o!==null)return v(m,o);if(z===null)return v(m);if(!O)return v(m);return v(z,m)};this._equals=function(m,o){return c._compare(m,o,1)===0};this._compare=function(m,o,q){if(q===undefined)q=1;if(m===undefined)m=null;if(o===undefined)o=null;if(m===null&&o===null)return 0;if(m===null&&o!==null)return 1;if(m!==null&&o===null)return-1;if(!k&&typeof m!=="number"&&typeof o!=="number"){m=String(m).toLowerCase();o=String(o).toLowerCase()}if(m<o)return-q;if(m>o)return q;return 0};this._performSort=function(){if(K.length!==0)g=c._doSort(g,0)};this._doSort=function(m,o){var q=K[o].by,B=K[o].dir,T=K[o].type,J=K[o].datefmt;if(o==K.length-1)return c._getOrder(m,q,B,T,J);o++;q=c._getGroup(m,q,B,T,J);B=[];for(T=0;T<q.length;T++){J=c._doSort(q[T].items,o);for(var D=0;D<J.length;D++)B.push(J[D])}return B};this._getOrder=function(m,o,q,B,T){var J=[],D=[],W=q=="a"?1:-1,U,ga;if(B===undefined)B="text";ga=B=="float"||B=="number"||B=="currency"||B=="numeric"?function(S){S=parseFloat(String(S).replace(r,""));return isNaN(S)?0:S}:B=="int"||B=="integer"?function(S){return S?parseFloat(String(S).replace(r,"")):0}:B=="date"||B=="datetime"?function(S){return b.jgrid.parseDate(T,S).getTime()}:b.isFunction(B)?B:function(S){S||(S="");return b.trim(String(S).toUpperCase())};b.each(m,function(S,aa){U=o!==""?b.jgrid.getAccessor(aa,o):aa;if(U===undefined)U="";U=ga(U,aa);D.push({vSort:U,index:S})});D.sort(function(S,aa){S=S.vSort;aa=aa.vSort;return c._compare(S,aa,W)});B=0;for(var ca=m.length;B<ca;){q=D[B].index;J.push(m[q]);B++}return J};this._getGroup=function(m,o,q,B,T){var J=[],D=null,W=null,U;b.each(c._getOrder(m,o,q,B,T),function(ga,ca){U=b.jgrid.getAccessor(ca,o);if(U===undefined)U="";if(!c._equals(W,U)){W=U;D!==null&&J.push(D);D=c._group(o,U)}D.items.push(ca)});D!==null&&J.push(D);return J};this.ignoreCase=function(){k=false;return c};this.useCase=function(){k=true;return c};this.trim=function(){l=true;return c};this.noTrim=function(){l=false;return c};this.execute=function(){var m=a,o=[];if(m===null)return c;b.each(g,function(){eval(m)&&o.push(this)});g=o;return c};this.data=function(){return g};this.select=function(m){c._performSort();if(!c._hasData())return[];c.execute();if(b.isFunction(m)){var o=[];b.each(g,function(q,B){o.push(m(B))});return o}return g};this.hasMatch=function(){if(!c._hasData())return false;c.execute();return g.length>0};this.andNot=function(m,o,q){E=!E;return c.and(m,o,q)};this.orNot=function(m,o,q){E=!E;return c.or(m,o,q)};this.not=function(m,o,q){return c.andNot(m,o,q)};this.and=function(m,o,q){P=" && ";if(m===undefined)return c;return c._repeatCommand(m,o,q)};this.or=function(m,o,q){P=" || ";if(m===undefined)return c;return c._repeatCommand(m,o,q)};this.isNot=function(m){E=!E;return c.is(m)};this.is=function(m){c._append("this."+m);c._resetNegate();return c};this._compareValues=function(m,o,q,B,T){var J;J=O?"jQuery.jgrid.getAccessor(this,'"+
o+"')":"this";if(q===undefined)q=null;var D=q,W=T.stype===undefined?"text":T.stype;if(q!==null)switch(W){case"int":case"integer":D=isNaN(Number(D))||D===""?"0":D;J="parseInt("+J+",10)";D="parseInt("+D+",10)";break;case"float":case"number":case"numeric":D=String(D).replace(r,"");D=isNaN(Number(D))||D===""?"0":D;J="parseFloat("+J+")";D="parseFloat("+D+")";break;case"date":case"datetime":D=String(b.jgrid.parseDate(T.newfmt||"Y-m-d",D).getTime());J='jQuery.jgrid.parseDate("'+T.srcfmt+'",'+J+").getTime()";break;default:J=c._getStr(J);D=c._getStr('"'+c._toStr(D)+'"')}c._append(J+" "+B+" "+D);c._setCommand(m,o);c._resetNegate();return c};this.equals=function(m,o,q){return c._compareValues(c.equals,m,o,"==",q)};this.notEquals=function(m,o,q){return c._compareValues(c.equals,m,o,"!==",q)};this.isNull=function(m,o,q){return c._compareValues(c.equals,m,null,"===",q)};this.greater=function(m,o,q){return c._compareValues(c.greater,m,o,">",q)};this.less=function(m,o,q){return c._compareValues(c.less,m,o,"<",q)};this.greaterOrEquals=function(m,o,q){return c._compareValues(c.greaterOrEquals,m,o,">=",q)};this.lessOrEquals=function(m,o,q){return c._compareValues(c.lessOrEquals,m,o,"<=",q)};this.startsWith=function(m,o){var q=o===undefined||o===null?m:o;q=l?b.trim(q.toString()).length:q.toString().length;if(O)c._append(c._getStr("jQuery.jgrid.getAccessor(this,'"+m+"')")+".substr(0,"+q+") == "+c._getStr('"'+c._toStr(o)+'"'));else{q=l?b.trim(o.toString()).length:o.toString().length;c._append(c._getStr("this")+".substr(0,"+q+") == "+c._getStr('"'+c._toStr(m)+'"'))}c._setCommand(c.startsWith,m);c._resetNegate();return c};this.endsWith=function(m,o){var q=o===undefined||o===null?m:o;q=l?b.trim(q.toString()).length:q.toString().length;O?c._append(c._getStr("jQuery.jgrid.getAccessor(this,'"+m+"')")+".substr("+c._getStr("jQuery.jgrid.getAccessor(this,'"+m+"')")+".length-"+q+","+q+') == "'+c._toStr(o)+'"'):c._append(c._getStr("this")+".substr("+c._getStr("this")+'.length-"'+c._toStr(m)+'".length,"'+c._toStr(m)+'".length) == "'+c._toStr(m)+'"');c._setCommand(c.endsWith,m);c._resetNegate();return c};this.contains=function(m,o){O?c._append(c._getStr("jQuery.jgrid.getAccessor(this,'"+m+"')")+'.indexOf("'+c._toStr(o)+'",0) > -1'):c._append(c._getStr("this")+'.indexOf("'+c._toStr(m)+'",0) > -1');c._setCommand(c.contains,m);c._resetNegate();return c};this.groupBy=function(m,o,q,B){if(!c._hasData())return null;return c._getGroup(g,m,o,q,B)};this.orderBy=function(m,o,q,B){o=o===undefined||o===null?"a":b.trim(o.toString().toLowerCase());if(q===null||q===undefined)q="text";if(B===null||B===undefined)B="Y-m-d";if(o=="desc"||o=="descending")o="d";if(o=="asc"||o=="ascending")o="a";K.push({by:m,dir:o,type:q,datefmt:B});return c};return c}(f,null)},extend:function(f){b.extend(b.fn.jqGrid,f);this.no_legacy_api||b.fn.extend(f)}});b.fn.jqGrid=function(f){if(typeof f=="string"){var j=b.jgrid.getAccessor(b.fn.jqGrid,f);if(!j)throw"jqGrid - No such method: "+f;var h=b.makeArray(arguments).slice(1);return j.apply(this,h)}return this.each(function(){if(!this.grid){var c=b.extend(true,{url:"",height:150,page:1,rowNum:20,rowTotal:null,records:0,pager:"",pgbuttons:true,pginput:true,colModel:[],rowList:[],colNames:[],sortorder:"asc",sortname:"",datatype:"xml",mtype:"GET",altRows:false,selarrrow:[],savedRow:[],shrinkToFit:true,xmlReader:{},jsonReader:{},subGrid:false,subGridModel:[],reccount:0,lastpage:0,lastsort:0,selrow:null,beforeSelectRow:null,onSelectRow:null,onSortCol:null,ondblClickRow:null,onRightClickRow:null,onPaging:null,onSelectAll:null,loadComplete:null,gridComplete:null,loadError:null,loadBeforeSend:null,afterInsertRow:null,beforeRequest:null,onHeaderClick:null,viewrecords:false,loadonce:false,multiselect:false,multikey:false,editurl:null,search:false,caption:"",hidegrid:true,hiddengrid:false,postData:{},userData:{},treeGrid:false,treeGridModel:"nested",treeReader:{},treeANode:-1,ExpandColumn:null,tree_root_level:0,prmNames:{page:"page",rows:"rows",sort:"sidx",order:"sord",search:"_search",nd:"nd",id:"id",oper:"oper",editoper:"edit",addoper:"add",deloper:"del",subgridid:"id",npage:null,totalrows:"totalrows"},forceFit:false,gridstate:"visible",cellEdit:false,cellsubmit:"remote",nv:0,loadui:"enable",toolbar:[false,""],scroll:false,multiboxonly:false,deselectAfterSort:true,scrollrows:false,autowidth:false,scrollOffset:18,cellLayout:5,subGridWidth:20,multiselectWidth:20,gridview:false,rownumWidth:25,rownumbers:false,pagerpos:"center",recordpos:"right",footerrow:false,userDataOnFooter:false,hoverrows:true,altclass:"ui-priority-secondary",viewsortcols:[false,"vertical",true],resizeclass:"",autoencode:false,remapColumns:[],ajaxGridOptions:{},direction:"ltr",toppager:false,headertitles:false,scrollTimeout:40,data:[],_index:{},grouping:false,groupingView:{groupField:[],groupOrder:[],groupText:[],groupColumnShow:[],groupSummary:[],showSummaryOnHide:false,sortitems:[],sortnames:[],groupDataSorted:false,summary:[],summaryval:[],plusicon:"ui-icon-circlesmall-plus",minusicon:"ui-icon-circlesmall-minus"},ignoreCase:false,cmTemplate:{}},b.jgrid.defaults,f||{}),g={headers:[],cols:[],footers:[],dragStart:function(e,d,i){this.resizing={idx:e,startX:d.clientX,sOL:i[0]};this.hDiv.style.cursor="col-resize";this.curGbox=b("#rs_m"+b.jgrid.jqID(c.id),"#gbox_"+b.jgrid.jqID(c.id));this.curGbox.css({display:"block",left:i[0],top:i[1],height:i[2]});b.isFunction(c.resizeStart)&&c.resizeStart.call(this,d,e);document.onselectstart=function(){return false}},dragMove:function(e){if(this.resizing){var d=e.clientX-this.resizing.startX;e=this.headers[this.resizing.idx];var i=c.direction==="ltr"?e.width+d:e.width-d,n;if(i>33){this.curGbox.css({left:this.resizing.sOL+d});if(c.forceFit===true){n=this.headers[this.resizing.idx+c.nv];d=c.direction==="ltr"?n.width-d:n.width+d;if(d>33){e.newWidth=i;n.newWidth=d}}else{this.newWidth=c.direction==="ltr"?c.tblwidth+d:c.tblwidth-d;e.newWidth=i}}}},dragEnd:function(){this.hDiv.style.cursor="default";if(this.resizing){var e=this.resizing.idx,d=this.headers[e].newWidth||this.headers[e].width;d=parseInt(d,10);this.resizing=false;b("#rs_m"+
b.jgrid.jqID(c.id)).css("display","none");c.colModel[e].width=d;this.headers[e].width=d;this.headers[e].el.style.width=d+"px";this.cols[e].style.width=d+"px";if(this.footers.length>0)this.footers[e].style.width=d+"px";if(c.forceFit===true){d=this.headers[e+c.nv].newWidth||this.headers[e+c.nv].width;this.headers[e+c.nv].width=d;this.headers[e+c.nv].el.style.width=d+"px";this.cols[e+c.nv].style.width=d+"px";if(this.footers.length>0)this.footers[e+c.nv].style.width=d+"px";c.colModel[e+c.nv].width=d}else{c.tblwidth=this.newWidth||c.tblwidth;b("table:first",this.bDiv).css("width",c.tblwidth+"px");b("table:first",this.hDiv).css("width",c.tblwidth+"px");this.hDiv.scrollLeft=this.bDiv.scrollLeft;if(c.footerrow){b("table:first",this.sDiv).css("width",c.tblwidth+"px");this.sDiv.scrollLeft=this.bDiv.scrollLeft}}b.isFunction(c.resizeStop)&&c.resizeStop.call(this,d,e)}this.curGbox=null;document.onselectstart=function(){return true}},populateVisible:function(){g.timer&&clearTimeout(g.timer);g.timer=null;var e=b(g.bDiv).height();if(e){var d=b("table:first",g.bDiv),i,n;if(d[0].rows.length)try{n=(i=d[0].rows[1])?b(i).outerHeight()||g.prevRowHeight:g.prevRowHeight}catch(p){n=g.prevRowHeight}if(n){g.prevRowHeight=n;var A=c.rowNum;i=g.scrollTop=g.bDiv.scrollTop;var s=Math.round(d.position().top)-i,F=s+d.height();n*=A;var t,y,x;if(F<e&&s<=0&&(c.lastpage===undefined||parseInt((F+i+n-1)/n,10)<=c.lastpage)){y=parseInt((e-F+n-1)/n,10);if(F>=0||y<2||c.scroll===true){t=Math.round((F+i)/n)+1;s=-1}else s=1}if(s>0){t=parseInt(i/n,10)+1;y=parseInt((i+e)/n,10)+2-t;x=true}if(y)if(!(c.lastpage&&t>c.lastpage||c.lastpage==1||t===c.page&&t===c.lastpage))if(g.hDiv.loading)g.timer=setTimeout(g.populateVisible,c.scrollTimeout);else{c.page=t;if(x){g.selectionPreserver(d[0]);g.emptyRows(g.bDiv,false,false)}g.populate(y)}}}},scrollGrid:function(e){if(c.scroll){var d=g.bDiv.scrollTop;if(g.scrollTop===undefined)g.scrollTop=0;if(d!=g.scrollTop){g.scrollTop=d;g.timer&&clearTimeout(g.timer);g.timer=setTimeout(g.populateVisible,c.scrollTimeout)}}g.hDiv.scrollLeft=g.bDiv.scrollLeft;if(c.footerrow)g.sDiv.scrollLeft=g.bDiv.scrollLeft;e.stopPropagation()},selectionPreserver:function(e){var d=e.p,i=d.selrow,n=d.selarrrow?b.makeArray(d.selarrrow):null,p=e.grid.bDiv.scrollLeft,A=d.gridComplete;d.gridComplete=function(){d.selrow=null;d.selarrrow=[];if(d.multiselect&&n&&n.length>0)for(var s=0;s<n.length;s++)n[s]!=i&&b(e).jqGrid("setSelection",n[s],false);i&&b(e).jqGrid("setSelection",i,false);e.grid.bDiv.scrollLeft=p;d.gridComplete=A;d.gridComplete&&A()}}};if(this.tagName!="TABLE")alert("Element is not a table");else{b(this).empty().attr("tabindex","1");this.p=c;var k,l,a;if(this.p.colNames.length===0)for(k=0;k<this.p.colModel.length;k++)this.p.colNames[k]=this.p.colModel[k].label||this.p.colModel[k].name;if(this.p.colNames.length!==this.p.colModel.length)alert(b.jgrid.errors.model);else{var r=b("<div class='ui-jqgrid-view'></div>"),v,z=b.browser.msie?true:false,E=b.browser.webkit||b.browser.safari?true:false;a=this;a.p.direction=b.trim(a.p.direction.toLowerCase());if(b.inArray(a.p.direction,["ltr","rtl"])==-1)a.p.direction="ltr";l=a.p.direction;b(r).insertBefore(this);b(this).appendTo(r).removeClass("scroll");var P=b("<div class='ui-jqgrid ui-widget ui-widget-content ui-corner-all'></div>");b(P).insertBefore(r).attr({id:"gbox_"+this.id,dir:l});b(r).appendTo(P).attr("id","gview_"+this.id);v=z&&b.browser.version<=6?'<iframe style="display:block;position:absolute;z-index:-1;filter:Alpha(Opacity=\'0\');" src="javascript:false;"></iframe>':"";b("<div class='ui-widget-overlay jqgrid-overlay' id='lui_"+
this.id+"'></div>").append(v).insertBefore(r);b("<div class='loading ui-state-default ui-state-active' id='load_"+this.id+"'>"+this.p.loadtext+"</div>").insertBefore(r);b(this).attr({cellspacing:"0",cellpadding:"0",border:"0",role:"grid","aria-multiselectable":!!this.p.multiselect,"aria-labelledby":"gbox_"+this.id});var K=function(e,d){e=parseInt(e,10);return isNaN(e)?d?d:0:e},O=function(e,d,i,n,p,A){var s=a.p.colModel[e],F=s.align,t='style="',y=s.classes,x=s.name,w=[];if(F)t+="text-align:"+F+";";if(s.hidden===true)t+="display:none;";if(d===0)t+="width: "+g.headers[e].width+"px;";else if(s.cellattr&&b.isFunction(s.cellattr))if((e=s.cellattr.call(a,p,i,n,s,A))&&typeof e==="string"){e=e.replace(/style/i,"style").replace(/title/i,"title");if(e.indexOf("title")>-1)s.title=false;if(e.indexOf("class")>-1)y=undefined;w=e.split("style");if(w.length===2){w[1]=b.trim(w[1].replace("=",""));if(w[1].indexOf("'")===0||w[1].indexOf('"')===0)w[1]=w[1].substring(1);t+=w[1].replace(/'/gi,'"')}else t+='"'}if(!w.length){w[0]="";t+='"'}t+=(y!==undefined?' class="'+y+'"':"")+(s.title&&i?' title="'+b.jgrid.stripHtml(i)+'"':"");t+=' aria-describedby="'+a.p.id+"_"+x+'"';return t+w[0]},m=function(e){return e===undefined||e===null||e===""?"&#160;":a.p.autoencode?b.jgrid.htmlEncode(e):e+""},o=function(e,d,i,n,p){var A=a.p.colModel[i];if(typeof A.formatter!=="undefined"){e={rowId:e,colModel:A,gid:a.p.id,pos:i};d=b.isFunction(A.formatter)?A.formatter.call(a,d,e,n,p):b.fmatter?b.fn.fmatter(A.formatter,d,e,n,p):m(d)}else d=m(d);return d},q=function(e,d,i,n,p){d=o(e,d,i,p,"add");return'<td role="gridcell" '+O(i,n,d,p,e,true)+">"+d+"</td>"},B=function(e,d,i){var n='<input role="checkbox" type="checkbox" id="jqg_'+a.p.id+"_"+e+'" class="cbox" name="jqg_'+a.p.id+"_"+e+'"/>';return'<td role="gridcell" '+O(d,i,"",null,e,true)+">"+n+"</td>"},T=function(e,d,i,n){i=(parseInt(i,10)-1)*parseInt(n,10)+1+d;return'<td role="gridcell" class="ui-state-default jqgrid-rownum" '+O(e,d,i,null,d,true)+">"+i+"</td>"},J=function(e){var d,i=[],n=0,p;for(p=0;p<a.p.colModel.length;p++){d=a.p.colModel[p];if(d.name!=="cb"&&d.name!=="subgrid"&&d.name!=="rn"){i[n]=e=="local"?d.name:e=="xml"?d.xmlmap||d.name:d.jsonmap||d.name;n++}}return i},D=function(e){var d=a.p.remapColumns;if(!d||!d.length)d=b.map(a.p.colModel,function(i,n){return n});if(e)d=b.map(d,function(i){return i<e?null:i-e});return d},W=function(e,d,i){if(a.p.deepempty)b("#"+b.jgrid.jqID(a.p.id)+" tbody:first tr:gt(0)").remove();else{var n=b("#"+b.jgrid.jqID(a.p.id)+" tbody:first tr:first")[0];b("#"+b.jgrid.jqID(a.p.id)+" tbody:first").empty().append(n)}if(d&&a.p.scroll){b(">div:first",e).css({height:"auto"}).children("div:first").css({height:0,display:"none"});e.scrollTop=0}if(i===true)if(a.p.treeGrid===true){a.p.data=[];a.p._index={}}},U=function(){var e=a.p.data.length,d,i,n;d=a.p.rownumbers===true?1:0;i=a.p.multiselect===true?1:0;n=a.p.subGrid===true?1:0;d=a.p.keyIndex===false||a.p.loadonce===true?a.p.localReader.id:a.p.colModel[a.p.keyIndex+i+n+d].name;for(i=0;i<e;i++){n=b.jgrid.getAccessor(a.p.data[i],d);a.p._index[n]=i}},ga=function(e,d,i,n,p){var A=new Date,s=a.p.datatype!="local"&&a.p.loadonce||a.p.datatype=="xmlstring",F=a.p.datatype=="local"?"local":"xml";if(s){a.p.data=[];a.p._index={};a.p.localReader.id="_id_"}a.p.reccount=0;if(b.isXMLDoc(e)){if(a.p.treeANode===-1&&!a.p.scroll){W(d,false,true);i=1}else i=i>1?i:1;var t,y,x=0,w,G=0,Q=0,M=0,L,N=[],Y,I={},u,C,H=[],ha=a.p.altRows===true?" "+a.p.altclass:"";a.p.xmlReader.repeatitems||(N=J(F));L=a.p.keyIndex===false?a.p.xmlReader.id:a.p.keyIndex;if(N.length>0&&!isNaN(L)){if(a.p.remapColumns&&a.p.remapColumns.length)L=b.inArray(L,a.p.remapColumns);L=N[L]}F=(L+"").indexOf("[")===-1?N.length?function(ea,$){return b(L,ea).text()||$}:function(ea,$){return b(a.p.xmlReader.cell,ea).eq(L).text()||$}:function(ea,$){return ea.getAttribute(L.replace(/[\[\]]/g,""))||$};a.p.userData={};b(a.p.xmlReader.page,e).each(function(){a.p.page=this.textContent||this.text||0});b(a.p.xmlReader.total,e).each(function(){a.p.lastpage=this.textContent||this.text;if(a.p.lastpage===undefined)a.p.lastpage=1});b(a.p.xmlReader.records,e).each(function(){a.p.records=this.textContent||this.text||0});b(a.p.xmlReader.userdata,e).each(function(){a.p.userData[this.getAttribute("name")]=this.textContent||this.text});(e=b(a.p.xmlReader.root+" "+a.p.xmlReader.row,e))||(e=[]);var V=e.length,Z=0,ia={},fa;if(e&&V){fa=parseInt(a.p.rowNum,10);var ra=a.p.scroll?b.jgrid.randId():1;if(p)fa*=p+1;p=b.isFunction(a.p.afterInsertRow);var oa="";if(a.p.grouping&&a.p.groupingView.groupCollapse===true)oa=' style="display:none;"';for(;Z<V;){u=e[Z];C=F(u,ra+Z);t=i===0?0:i+1;t=(t+Z)%2==1?ha:"";H.push("<tr"+oa+' id="'+C+'" tabindex="-1" role="row" class ="ui-widget-content jqgrow ui-row-'+a.p.direction+""+t+'">');if(a.p.rownumbers===true){H.push(T(0,Z,a.p.page,a.p.rowNum));M=1}if(a.p.multiselect===true){H.push(B(C,M,Z));G=1}if(a.p.subGrid===true){H.push(b(a).jqGrid("addSubGridCell",G+M,Z+i));Q=1}if(a.p.xmlReader.repeatitems){Y||(Y=D(G+Q+M));var Ba=b(a.p.xmlReader.cell,u);b.each(Y,function(ea){var $=Ba[this];if(!$)return false;w=$.textContent||$.text;I[a.p.colModel[ea+G+Q+M].name]=w;H.push(q(C,w,ea+G+Q+M,Z+i,u))})}else for(t=0;t<N.length;t++){w=b(N[t],u).text();I[a.p.colModel[t+G+Q+M].name]=w;H.push(q(C,w,t+G+Q+M,Z+i,u))}H.push("</tr>");if(a.p.grouping){t=a.p.groupingView.groupField.length;for(var xa=[],ya=0;ya<t;ya++)xa.push(I[a.p.groupingView.groupField[ya]]);ia=b(a).jqGrid("groupingPrepare",H,xa,ia,I);H=[]}if(s||a.p.treeGrid===true){I._id_=C;a.p.data.push(I);a.p._index[C]=a.p.data.length-1}if(a.p.gridview===false){b("tbody:first",d).append(H.join(""));p&&a.p.afterInsertRow.call(a,C,I,u);H=[]}I={};x++;Z++;if(x==fa)break}}if(a.p.gridview===true){y=a.p.treeANode>-1?a.p.treeANode:0;if(a.p.grouping){b(a).jqGrid("groupingRender",ia,a.p.colModel.length);ia=null}else a.p.treeGrid===true&&y>0?b(a.rows[y]).after(H.join("")):b("tbody:first",d).append(H.join(""))}if(a.p.subGrid===true)try{b(a).jqGrid("addSubGrid",G+M)}catch(Ha){}a.p.totaltime=new Date-A;if(x>0)if(a.p.records===0)a.p.records=V;H=null;if(a.p.treeGrid===true)try{b(a).jqGrid("setTreeNode",y+1,x+y+1)}catch(Ia){}if(!a.p.treeGrid&&!a.p.scroll)a.grid.bDiv.scrollTop=0;a.p.reccount=x;a.p.treeANode=-1;a.p.userDataOnFooter&&b(a).jqGrid("footerData","set",a.p.userData,true);if(s){a.p.records=V;a.p.lastpage=Math.ceil(V/fa)}n||a.updatepager(false,true);if(s)for(;x<V;){u=e[x];C=F(u,x);if(a.p.xmlReader.repeatitems){Y||(Y=D(G+Q+M));var Ea=b(a.p.xmlReader.cell,u);b.each(Y,function(ea){var $=Ea[this];if(!$)return false;w=$.textContent||$.text;I[a.p.colModel[ea+G+
Q+M].name]=w})}else for(t=0;t<N.length;t++){w=b(N[t],u).text();I[a.p.colModel[t+G+Q+M].name]=w}I._id_=C;a.p.data.push(I);a.p._index[C]=a.p.data.length-1;I={};x++}}},ca=function(e,d,i,n,p){var A=new Date;if(e){if(a.p.treeANode===-1&&!a.p.scroll){W(d,false,true);i=1}else i=i>1?i:1;var s,F=a.p.datatype!="local"&&a.p.loadonce||a.p.datatype=="jsonstring";if(F){a.p.data=[];a.p._index={};a.p.localReader.id="_id_"}a.p.reccount=0;if(a.p.datatype=="local"){d=a.p.localReader;s="local"}else{d=a.p.jsonReader;s="json"}var t=0,y,x,w=[],G,Q=0,M=0,L=0,N,Y,I={},u,C,H=[],ha=a.p.altRows===true?" "+a.p.altclass:"";a.p.page=b.jgrid.getAccessor(e,d.page)||0;N=b.jgrid.getAccessor(e,d.total);a.p.lastpage=N===undefined?1:N;a.p.records=b.jgrid.getAccessor(e,d.records)||0;a.p.userData=b.jgrid.getAccessor(e,d.userdata)||{};d.repeatitems||(G=w=J(s));s=a.p.keyIndex===false?d.id:a.p.keyIndex;if(w.length>0&&!isNaN(s)){if(a.p.remapColumns&&a.p.remapColumns.length)s=b.inArray(s,a.p.remapColumns);s=w[s]}(Y=b.jgrid.getAccessor(e,d.root))||(Y=[]);N=Y.length;e=0;var V=parseInt(a.p.rowNum,10),Z=a.p.scroll?b.jgrid.randId():1;if(p)V*=p+1;var ia=b.isFunction(a.p.afterInsertRow),fa={},ra="";if(a.p.grouping&&a.p.groupingView.groupCollapse===true)ra=' style="display:none;"';for(;e<N;){p=Y[e];C=b.jgrid.getAccessor(p,s);if(C===undefined){C=Z+e;if(w.length===0)if(d.cell)C=b.jgrid.getAccessor(p,d.cell)[s]||C}y=i===1?0:i;y=(y+e)%2==1?ha:"";H.push("<tr"+ra+' id="'+C+'" tabindex="-1" role="row" class= "ui-widget-content jqgrow ui-row-'+
a.p.direction+""+y+'">');if(a.p.rownumbers===true){H.push(T(0,e,a.p.page,a.p.rowNum));L=1}if(a.p.multiselect){H.push(B(C,L,e));Q=1}if(a.p.subGrid){H.push(b(a).jqGrid("addSubGridCell",Q+L,e+i));M=1}if(d.repeatitems){if(d.cell)p=b.jgrid.getAccessor(p,d.cell);G||(G=D(Q+M+L))}for(x=0;x<G.length;x++){y=b.jgrid.getAccessor(p,G[x]);H.push(q(C,y,x+Q+M+L,e+i,p));I[a.p.colModel[x+Q+M+L].name]=y}H.push("</tr>");if(a.p.grouping){y=a.p.groupingView.groupField.length;x=[];for(var oa=0;oa<y;oa++)x.push(I[a.p.groupingView.groupField[oa]]);fa=b(a).jqGrid("groupingPrepare",H,x,fa,I);H=[]}if(F||a.p.treeGrid===true){I._id_=C;a.p.data.push(I);a.p._index[C]=a.p.data.length-1}if(a.p.gridview===false){b("#"+b.jgrid.jqID(a.p.id)+" tbody:first").append(H.join(""));ia&&a.p.afterInsertRow.call(a,C,I,p);H=[]}I={};t++;e++;if(t==V)break}if(a.p.gridview===true){u=a.p.treeANode>-1?a.p.treeANode:0;if(a.p.grouping)b(a).jqGrid("groupingRender",fa,a.p.colModel.length);else a.p.treeGrid===true&&u>0?b(a.rows[u]).after(H.join("")):b("#"+b.jgrid.jqID(a.p.id)+" tbody:first").append(H.join(""))}if(a.p.subGrid===true)try{b(a).jqGrid("addSubGrid",Q+L)}catch(Ba){}a.p.totaltime=new Date-A;if(t>0)if(a.p.records===0)a.p.records=N;if(a.p.treeGrid===true)try{b(a).jqGrid("setTreeNode",u+1,t+u+1)}catch(xa){}if(!a.p.treeGrid&&!a.p.scroll)a.grid.bDiv.scrollTop=0;a.p.reccount=t;a.p.treeANode=-1;a.p.userDataOnFooter&&b(a).jqGrid("footerData","set",a.p.userData,true);if(F){a.p.records=N;a.p.lastpage=Math.ceil(N/V)}n||a.updatepager(false,true);if(F)for(;t<N&&Y[t];){p=Y[t];C=b.jgrid.getAccessor(p,s);if(C===undefined){C=Z+t;if(w.length===0)if(d.cell)C=b.jgrid.getAccessor(p,d.cell)[s]||C}if(p){if(d.repeatitems){if(d.cell)p=b.jgrid.getAccessor(p,d.cell);G||(G=D(Q+M+L))}for(x=0;x<G.length;x++){y=b.jgrid.getAccessor(p,G[x]);I[a.p.colModel[x+Q+M+L].name]=y}I._id_=C;a.p.data.push(I);a.p._index[C]=a.p.data.length-1;I={}}t++}}},S=function(){function e(u){var C=0,H,ha,V;if(u.groups!==undefined)for(H=0;H<u.groups.length;H++){try{e(u.groups[H])}catch(Z){alert(Z)}C++}if(u.rules!==undefined){if(C>0){var ia=w.select();w=b.jgrid.from(ia)}try{for(H=0;H<u.rules.length;H++){V=u.rules[H];ha=u.groupOp.toString().toUpperCase();if(x[V.op]&&V.field){if(C>0&&ha&&ha==="OR")w=w.or();w=x[V.op](w,ha)(V.field,V.data,n[V.field])}C++}}catch(fa){alert(fa)}}}var d,i=false,n={},p=[],A=[],s,F,t;if(b.isArray(a.p.data)){var y=a.p.grouping?a.p.groupingView:false;b.each(a.p.colModel,function(){F=this.sorttype||"text";if(F=="date"||F=="datetime"){if(this.formatter&&typeof this.formatter==="string"&&this.formatter=="date"){s=this.formatoptions&&this.formatoptions.srcformat?this.formatoptions.srcformat:b.jgrid.formatter.date.srcformat;t=this.formatoptions&&this.formatoptions.newformat?this.formatoptions.newformat:b.jgrid.formatter.date.newformat}else s=t=this.datefmt||"Y-m-d";n[this.name]={stype:F,srcfmt:s,newfmt:t}}else n[this.name]={stype:F,srcfmt:"",newfmt:""};if(a.p.grouping&&this.name==y.groupField[0]){var u=this.name;if(typeof this.index!="undefined")u=this.index;p[0]=n[u];A.push(u)}if(!i&&(this.index==a.p.sortname||this.name==a.p.sortname)){d=this.name;i=true}});if(a.p.treeGrid)b(a).jqGrid("SortTree",d,a.p.sortorder,n[d].stype,n[d].srcfmt);else{var x={eq:function(u){return u.equals},ne:function(u){return u.notEquals},lt:function(u){return u.less},le:function(u){return u.lessOrEquals},gt:function(u){return u.greater},ge:function(u){return u.greaterOrEquals},cn:function(u){return u.contains},nc:function(u,C){return C==="OR"?u.orNot().contains:u.andNot().contains},bw:function(u){return u.startsWith},bn:function(u,C){return C==="OR"?u.orNot().startsWith:u.andNot().startsWith},en:function(u,C){return C==="OR"?u.orNot().endsWith:u.andNot().endsWith},ew:function(u){return u.endsWith},ni:function(u,C){return C==="OR"?u.orNot().equals:u.andNot().equals},"in":function(u){return u.equals},nu:function(u){return u.isNull},nn:function(u,C){return C==="OR"?u.orNot().isNull:u.andNot().isNull}},w=b.jgrid.from(a.p.data);if(a.p.ignoreCase)w=w.ignoreCase();if(a.p.search===true){var G=a.p.postData.filters;if(G){if(typeof G=="string")G=b.jgrid.parse(G);e(G)}else try{w=x[a.p.postData.searchOper](w)(a.p.postData.searchField,a.p.postData.searchString,n[a.p.postData.searchField])}catch(Q){}}if(a.p.grouping){w.orderBy(A,y.groupOrder[0],p[0].stype,p[0].srcfmt);y.groupDataSorted=true}if(d&&a.p.sortorder&&i)a.p.sortorder.toUpperCase()=="DESC"?w.orderBy(a.p.sortname,"d",n[d].stype,n[d].srcfmt):w.orderBy(a.p.sortname,"a",n[d].stype,n[d].srcfmt);G=w.select();var M=parseInt(a.p.rowNum,10),L=G.length,N=parseInt(a.p.page,10),Y=Math.ceil(L/M),I={};G=G.slice((N-1)*M,N*M);n=w=null;I[a.p.localReader.total]=Y;I[a.p.localReader.page]=N;I[a.p.localReader.records]=L;I[a.p.localReader.root]=G;G=null;return I}}},aa=function(){a.grid.hDiv.loading=true;if(!a.p.hiddengrid)switch(a.p.loadui){case"enable":b("#load_"+b.jgrid.jqID(a.p.id)).show();break;case"block":b("#lui_"+b.jgrid.jqID(a.p.id)).show();b("#load_"+b.jgrid.jqID(a.p.id)).show()}},pa=function(){a.grid.hDiv.loading=false;switch(a.p.loadui){case"enable":b("#load_"+b.jgrid.jqID(a.p.id)).hide();break;case"block":b("#lui_"+b.jgrid.jqID(a.p.id)).hide();b("#load_"+b.jgrid.jqID(a.p.id)).hide()}},ja=function(e){if(!a.grid.hDiv.loading){var d=a.p.scroll&&e===false,i={},n,p=a.p.prmNames;if(a.p.page<=0)a.p.page=1;if(p.search!==null)i[p.search]=a.p.search;if(p.nd!==null)i[p.nd]=(new Date).getTime();if(p.rows!==null)i[p.rows]=a.p.rowNum;if(p.page!==null)i[p.page]=a.p.page;if(p.sort!==null)i[p.sort]=a.p.sortname;if(p.order!==null)i[p.order]=a.p.sortorder;if(a.p.rowTotal!==null&&p.totalrows!==null)i[p.totalrows]=a.p.rowTotal;var A=a.p.loadComplete,s=b.isFunction(A);s||(A=null);var F=0;e=e||1;if(e>1)if(p.npage!==null){i[p.npage]=e;F=e-1;e=1}else A=function(y){a.p.page++;a.grid.hDiv.loading=false;s&&a.p.loadComplete.call(a,y);ja(e-1)};else p.npage!==null&&delete a.p.postData[p.npage];if(a.p.grouping){b(a).jqGrid("groupingSetup");if(a.p.groupingView.groupDataSorted===true)i[p.sort]=a.p.groupingView.groupField[0]+" "+a.p.groupingView.groupOrder[0]+", "+i[p.sort]}b.extend(a.p.postData,i);var t=!a.p.scroll?1:a.rows.length-
1;if(b.isFunction(a.p.datatype))a.p.datatype.call(a,a.p.postData,"load_"+a.p.id);else{b.isFunction(a.p.beforeRequest)&&a.p.beforeRequest.call(a);n=a.p.datatype.toLowerCase();switch(n){case"json":case"jsonp":case"xml":case"script":b.ajax(b.extend({url:a.p.url,type:a.p.mtype,dataType:n,data:b.isFunction(a.p.serializeGridData)?a.p.serializeGridData.call(a,a.p.postData):a.p.postData,success:function(y){n==="xml"?ga(y,a.grid.bDiv,t,e>1,F):ca(y,a.grid.bDiv,t,e>1,F);A&&A.call(a,y);d&&a.grid.populateVisible();if(a.p.loadonce||a.p.treeGrid)a.p.datatype="local";pa()},error:function(y,x,w){b.isFunction(a.p.loadError)&&a.p.loadError.call(a,y,x,w);pa()},beforeSend:function(y){aa();b.isFunction(a.p.loadBeforeSend)&&a.p.loadBeforeSend.call(a,y)}},b.jgrid.ajaxOptions,a.p.ajaxGridOptions));break;case"xmlstring":aa();i=b.jgrid.stringToDoc(a.p.datastr);ga(i,a.grid.bDiv);s&&a.p.loadComplete.call(a,i);a.p.datatype="local";a.p.datastr=null;pa();break;case"jsonstring":aa();i=typeof a.p.datastr=="string"?b.jgrid.parse(a.p.datastr):a.p.datastr;ca(i,a.grid.bDiv);s&&a.p.loadComplete.call(a,i);a.p.datatype="local";a.p.datastr=null;pa();break;case"local":case"clientside":aa();a.p.datatype="local";i=S();ca(i,a.grid.bDiv,t,e>1,F);A&&A.call(a,i);d&&a.grid.populateVisible();pa()}}}};v=function(e,d){var i="",n="<table cellspacing='0' cellpadding='0' border='0' style='table-layout:auto;' class='ui-pg-table'><tbody><tr>",p="",A,s,F,t,y=function(x){var w;if(b.isFunction(a.p.onPaging))w=a.p.onPaging.call(a,x);a.p.selrow=null;if(a.p.multiselect){a.p.selarrrow=[];b("#cb_"+b.jgrid.jqID(a.p.id),a.grid.hDiv).attr("checked",false)}a.p.savedRow=[];if(w=="stop")return false;return true};e=e.substr(1);A="pg_"+e;s=e+"_left";F=e+"_center";t=e+"_right";b("#"+b.jgrid.jqID(e)).append("<div id='"+A+"' class='ui-pager-control' role='group'><table cellspacing='0' cellpadding='0' border='0' class='ui-pg-table' style='width:100%;table-layout:fixed;height:100%;' role='row'><tbody><tr><td id='"+s+"' align='left'></td><td id='"+F+"' align='center' style='white-space:pre;'></td><td id='"+
t+"' align='right'></td></tr></tbody></table></div>").attr("dir","ltr");if(a.p.rowList.length>0){p="<td dir='"+l+"'>";p+="<select class='ui-pg-selbox' role='listbox'>";for(s=0;s<a.p.rowList.length;s++)p+='<option role="option" value="'+a.p.rowList[s]+'"'+(a.p.rowNum==a.p.rowList[s]?' selected="selected"':"")+">"+a.p.rowList[s]+"</option>";p+="</select></td>"}if(l=="rtl")n+=p;if(a.p.pginput===true)i="<td dir='"+l+"'>"+b.jgrid.format(a.p.pgtext||"","<input class='ui-pg-input' type='text' size='2' maxlength='7' value='0' role='textbox'/>","<span id='sp_1'></span>")+"</td>";if(a.p.pgbuttons===true){s=["first"+d,"prev"+d,"next"+d,"last"+d];l=="rtl"&&s.reverse();n+="<td id='"+s[0]+"' class='ui-pg-button ui-corner-all'><span class='ui-icon ui-icon-seek-first'></span></td>";n+="<td id='"+s[1]+"' class='ui-pg-button ui-corner-all'><span class='ui-icon ui-icon-seek-prev'></span></td>";n+=i!==""?"<td class='ui-pg-button ui-state-disabled' style='width:4px;'><span class='ui-separator'></span></td>"+i+"<td class='ui-pg-button ui-state-disabled' style='width:4px;'><span class='ui-separator'></span></td>":"";n+="<td id='"+s[2]+"' class='ui-pg-button ui-corner-all'><span class='ui-icon ui-icon-seek-next'></span></td>";n+="<td id='"+s[3]+"' class='ui-pg-button ui-corner-all'><span class='ui-icon ui-icon-seek-end'></span></td>"}else if(i!=="")n+=i;if(l=="ltr")n+=p;n+="</tr></tbody></table>";a.p.viewrecords===true&&b("td#"+e+"_"+a.p.recordpos,"#"+A).append("<div dir='"+l+"' style='text-align:"+a.p.recordpos+"' class='ui-paging-info'></div>");b("td#"+e+"_"+a.p.pagerpos,"#"+A).append(n);p=b(".ui-jqgrid").css("font-size")||"11px";b(document.body).append("<div id='testpg' class='ui-jqgrid ui-widget ui-widget-content' style='font-size:"+p+";visibility:hidden;' ></div>");n=b(n).clone().appendTo("#testpg").width();b("#testpg").remove();if(n>0){if(i!=="")n+=50;b("td#"+e+"_"+a.p.pagerpos,"#"+A).width(n)}a.p._nvtd=[];a.p._nvtd[0]=n?Math.floor((a.p.width-n)/2):Math.floor(a.p.width/3);a.p._nvtd[1]=0;n=null;b(".ui-pg-selbox","#"+A).bind("change",function(){a.p.page=Math.round(a.p.rowNum*(a.p.page-1)/this.value-0.5)+1;a.p.rowNum=this.value;if(d)b(".ui-pg-selbox",a.p.pager).val(this.value);else a.p.toppager&&b(".ui-pg-selbox",a.p.toppager).val(this.value);if(!y("records"))return false;ja();return false});if(a.p.pgbuttons===true){b(".ui-pg-button","#"+A).hover(function(){if(b(this).hasClass("ui-state-disabled"))this.style.cursor="default";else{b(this).addClass("ui-state-hover");this.style.cursor="pointer"}},function(){if(!b(this).hasClass("ui-state-disabled")){b(this).removeClass("ui-state-hover");this.style.cursor="default"}});b("#first"+d+", #prev"+d+", #next"+d+", #last"+d,"#"+e).click(function(){var x=K(a.p.page,1),w=K(a.p.lastpage,1),G=false,Q=true,M=true,L=true,N=true;if(w===0||w===1)N=L=M=Q=false;else if(w>1&&x>=1)if(x===1)M=Q=false;else{if(!(x>1&&x<w))if(x===w)N=L=false}else if(w>1&&x===0){N=L=false;x=w-1}if(this.id==="first"+d&&Q){a.p.page=1;G=true}if(this.id==="prev"+d&&M){a.p.page=x-1;G=true}if(this.id==="next"+d&&L){a.p.page=x+1;G=true}if(this.id==="last"+d&&N){a.p.page=w;G=true}if(G){if(!y(this.id))return false;ja()}return false})}a.p.pginput===true&&b("input.ui-pg-input","#"+A).keypress(function(x){if((x.charCode?x.charCode:x.keyCode?x.keyCode:0)==13){a.p.page=b(this).val()>0?b(this).val():a.p.page;if(!y("user"))return false;ja();return false}return this})};var Ca=function(e,d,i,n){if(a.p.colModel[d].sortable)if(!(a.p.savedRow.length>0)){if(!i){if(a.p.lastsort==d)if(a.p.sortorder=="asc")a.p.sortorder="desc";else{if(a.p.sortorder=="desc")a.p.sortorder="asc"}else a.p.sortorder=a.p.colModel[d].firstsortorder||"asc";a.p.page=1}if(n)if(a.p.lastsort==d&&a.p.sortorder==n&&!i)return;else a.p.sortorder=n;i=b("thead:first",a.grid.hDiv).get(0);b("tr th:eq("+a.p.lastsort+") span.ui-grid-ico-sort",i).addClass("ui-state-disabled");b("tr th:eq("+a.p.lastsort+")",i).attr("aria-selected","false");b("tr th:eq("+d+") span.ui-icon-"+a.p.sortorder,i).removeClass("ui-state-disabled");b("tr th:eq("+d+")",i).attr("aria-selected","true");if(!a.p.viewsortcols[0])if(a.p.lastsort!=d){b("tr th:eq("+a.p.lastsort+") span.s-ico",i).hide();b("tr th:eq("+d+") span.s-ico",i).show()}e=e.substring(5);a.p.sortname=a.p.colModel[d].index||e;i=a.p.sortorder;if(b.isFunction(a.p.onSortCol))if(a.p.onSortCol.call(a,e,d,i)=="stop"){a.p.lastsort=d;return}if(a.p.datatype=="local")a.p.deselectAfterSort&&b(a).jqGrid("resetSelection");else{a.p.selrow=null;a.p.multiselect&&b("#cb_"+b.jgrid.jqID(a.p.id),a.grid.hDiv).attr("checked",false);a.p.selarrrow=[];a.p.savedRow=[]}if(a.p.scroll){i=a.grid.bDiv.scrollLeft;W(a.grid.bDiv,true,false);a.grid.hDiv.scrollLeft=i}a.p.subGrid&&a.p.datatype=="local"&&b("td.sgexpanded","#"+b.jgrid.jqID(a.p.id)).each(function(){b(this).trigger("click")});ja();a.p.lastsort=d;if(a.p.sortname!=e&&d)a.p.lastsort=d}},Fa=function(e){var d,i={},n=E?0:a.p.cellLayout;for(d=i[0]=i[1]=i[2]=0;d<=e;d++)if(a.p.colModel[d].hidden===false)i[0]+=a.p.colModel[d].width+n;if(a.p.direction=="rtl")i[0]=a.p.width-i[0];i[0]-=a.grid.bDiv.scrollLeft;if(b(a.grid.cDiv).is(":visible"))i[1]+=b(a.grid.cDiv).height()+parseInt(b(a.grid.cDiv).css("padding-top"),10)+parseInt(b(a.grid.cDiv).css("padding-bottom"),10);if(a.p.toolbar[0]===true&&(a.p.toolbar[1]=="top"||a.p.toolbar[1]=="both"))i[1]+=b(a.grid.uDiv).height()+parseInt(b(a.grid.uDiv).css("border-top-width"),10)+parseInt(b(a.grid.uDiv).css("border-bottom-width"),10);if(a.p.toppager)i[1]+=b(a.grid.topDiv).height()+parseInt(b(a.grid.topDiv).css("border-bottom-width"),10);i[2]+=b(a.grid.bDiv).height()+b(a.grid.hDiv).height();return i};this.p.id=this.id;if(b.inArray(a.p.multikey,["shiftKey","altKey","ctrlKey"])==-1)a.p.multikey=false;a.p.keyIndex=false;for(k=0;k<a.p.colModel.length;k++){a.p.colModel[k]=b.extend(true,{},a.p.cmTemplate,a.p.colModel[k].template||{},a.p.colModel[k]);if(a.p.keyIndex===false&&a.p.colModel[k].key===true)a.p.keyIndex=k}a.p.sortorder=a.p.sortorder.toLowerCase();if(a.p.grouping===true){a.p.scroll=false;a.p.rownumbers=false;a.p.subGrid=false;a.p.treeGrid=false;a.p.gridview=true}if(this.p.treeGrid===true){try{b(this).jqGrid("setTreeGrid")}catch(Ja){}if(a.p.datatype!="local")a.p.localReader={id:"_id_"}}if(this.p.subGrid)try{b(a).jqGrid("setSubGrid")}catch(Ka){}if(this.p.multiselect){this.p.colNames.unshift("<input role='checkbox' id='cb_"+this.p.id+"' class='cbox' type='checkbox'/>");this.p.colModel.unshift({name:"cb",width:E?a.p.multiselectWidth+a.p.cellLayout:a.p.multiselectWidth,sortable:false,resizable:false,hidedlg:true,search:false,align:"center",fixed:true})}if(this.p.rownumbers){this.p.colNames.unshift("");this.p.colModel.unshift({name:"rn",width:a.p.rownumWidth,sortable:false,resizable:false,hidedlg:true,search:false,align:"center",fixed:true})}a.p.xmlReader=b.extend(true,{root:"rows",row:"row",page:"rows>page",total:"rows>total",records:"rows>records",repeatitems:true,cell:"cell",id:"[id]",userdata:"userdata",subgrid:{root:"rows",row:"row",repeatitems:true,cell:"cell"}},a.p.xmlReader);a.p.jsonReader=b.extend(true,{root:"rows",page:"page",total:"total",records:"records",repeatitems:true,cell:"cell",id:"id",userdata:"userdata",subgrid:{root:"rows",repeatitems:true,cell:"cell"}},a.p.jsonReader);a.p.localReader=b.extend(true,{root:"rows",page:"page",total:"total",records:"records",repeatitems:false,cell:"cell",id:"id",userdata:"userdata",subgrid:{root:"rows",repeatitems:true,cell:"cell"}},a.p.localReader);if(a.p.scroll){a.p.pgbuttons=false;a.p.pginput=false;a.p.rowList=[]}a.p.data.length&&U();var ba="<thead><tr class='ui-jqgrid-labels' role='rowheader'>",Da,ma,sa,qa,ta,X,R,na;ma=na="";if(a.p.shrinkToFit===true&&a.p.forceFit===true)for(k=a.p.colModel.length-1;k>=0;k--)if(!a.p.colModel[k].hidden){a.p.colModel[k].resizable=false;break}if(a.p.viewsortcols[1]=="horizontal"){na=" ui-i-asc";ma=" ui-i-desc"}Da=z?"class='ui-th-div-ie'":"";na="<span class='s-ico' style='display:none'><span sort='asc' class='ui-grid-ico-sort ui-icon-asc"+na+" ui-state-disabled ui-icon ui-icon-triangle-1-n ui-sort-"+l+"'></span>";na+="<span sort='desc' class='ui-grid-ico-sort ui-icon-desc"+ma+" ui-state-disabled ui-icon ui-icon-triangle-1-s ui-sort-"+l+"'></span></span>";for(k=0;k<this.p.colNames.length;k++){ma=a.p.headertitles?' title="'+b.jgrid.stripHtml(a.p.colNames[k])+'"':"";ba+="<th id='"+a.p.id+"_"+a.p.colModel[k].name+"' role='columnheader' class='ui-state-default ui-th-column ui-th-"+l+"'"+ma+">";ma=a.p.colModel[k].index||a.p.colModel[k].name;ba+="<div id='jqgh_"+a.p.colModel[k].name+"' "+Da+">"+a.p.colNames[k];a.p.colModel[k].width=a.p.colModel[k].width?parseInt(a.p.colModel[k].width,10):150;if(typeof a.p.colModel[k].title!=="boolean")a.p.colModel[k].title=true;if(ma==a.p.sortname)a.p.lastsort=k;ba+=na+"</div></th>"}ba+="</tr></thead>";na=null;b(this).append(ba);b("thead tr:first th",this).hover(function(){b(this).addClass("ui-state-hover")},function(){b(this).removeClass("ui-state-hover")});if(this.p.multiselect){var za=[],ua;b("#cb_"+b.jgrid.jqID(a.p.id),this).bind("click",function(){a.p.selarrrow=[];if(this.checked){b(a.rows).each(function(e){if(e>0)if(!b(this).hasClass("subgrid")&&!b(this).hasClass("jqgroup")&&!b(this).hasClass("ui-state-disabled")){b("#jqg_"+b.jgrid.jqID(a.p.id)+"_"+b.jgrid.jqID(this.id)).attr("checked","checked");b(this).addClass("ui-state-highlight").attr("aria-selected","true");a.p.selarrrow.push(this.id);a.p.selrow=this.id}});ua=true;za=[]}else{b(a.rows).each(function(e){if(e>0)if(!b(this).hasClass("subgrid")&&!b(this).hasClass("ui-state-disabled")){b("#jqg_"+b.jgrid.jqID(a.p.id)+"_"+b.jgrid.jqID(this.id)).removeAttr("checked");b(this).removeClass("ui-state-highlight").attr("aria-selected","false");za.push(this.id)}});a.p.selrow=null;ua=false}if(b.isFunction(a.p.onSelectAll))a.p.onSelectAll.call(a,ua?a.p.selarrrow:za,ua)})}if(a.p.autowidth===true){ba=b(P).innerWidth();a.p.width=ba>0?ba:"nw"}(function(){var e=0,d=E?0:a.p.cellLayout,i=0,n,p=a.p.scrollOffset,A,s=false,F,t=0,y=0,x;b.each(a.p.colModel,function(){if(typeof this.hidden==="undefined")this.hidden=false;this.widthOrg=A=K(this.width,0);if(this.hidden===false){e+=A+d;if(this.fixed)t+=A+d;else i++;y++}});if(isNaN(a.p.width))a.p.width=g.width=e;else g.width=a.p.width;a.p.tblwidth=e;if(a.p.shrinkToFit===false&&a.p.forceFit===true)a.p.forceFit=false;if(a.p.shrinkToFit===true&&i>0){F=g.width-d*i-t;if(!isNaN(a.p.height)){F-=p;s=true}e=0;b.each(a.p.colModel,function(w){if(this.hidden===false&&!this.fixed){this.width=A=Math.round(F*this.width/(a.p.tblwidth-d*i-t));e+=A;n=w}});x=0;if(s){if(g.width-t-(e+d*i)!==p)x=g.width-t-(e+d*i)-p}else if(!s&&Math.abs(g.width-t-(e+d*i))!==1)x=g.width-t-(e+d*i);a.p.colModel[n].width+=x;a.p.tblwidth=e+x+d*i+t;if(a.p.tblwidth>a.p.width){a.p.colModel[n].width-=a.p.tblwidth-parseInt(a.p.width,10);a.p.tblwidth=a.p.width}}})();b(P).css("width",g.width+"px").append("<div class='ui-jqgrid-resize-mark' id='rs_m"+
a.p.id+"'>&#160;</div>");b(r).css("width",g.width+"px");ba=b("thead:first",a).get(0);var va="";if(a.p.footerrow)va+="<table role='grid' style='width:"+a.p.tblwidth+"px' class='ui-jqgrid-ftable' cellspacing='0' cellpadding='0' border='0'><tbody><tr role='row' class='ui-widget-content footrow footrow-"+l+"'>";r=b("tr:first",ba);var wa="<tr class='jqgfirstrow' role='row' style='height:auto'>";a.p.disableClick=false;b("th",r).each(function(e){sa=a.p.colModel[e].width;if(typeof a.p.colModel[e].resizable==="undefined")a.p.colModel[e].resizable=true;if(a.p.colModel[e].resizable){qa=document.createElement("span");b(qa).html("&#160;").addClass("ui-jqgrid-resize ui-jqgrid-resize-"+l);b.browser.opera||b(qa).css("cursor","col-resize");b(this).addClass(a.p.resizeclass)}else qa="";b(this).css("width",sa+"px").prepend(qa);var d="";if(a.p.colModel[e].hidden){b(this).css("display","none");d="display:none;"}wa+="<td role='gridcell' style='height:0px;width:"+sa+"px;"+d+"'></td>";g.headers[e]={width:sa,el:this};ta=a.p.colModel[e].sortable;if(typeof ta!=="boolean")ta=a.p.colModel[e].sortable=true;d=a.p.colModel[e].name;d=="cb"||d=="subgrid"||d=="rn"||a.p.viewsortcols[2]&&b("div",this).addClass("ui-jqgrid-sortable");if(ta)if(a.p.viewsortcols[0]){b("div span.s-ico",this).show();e==a.p.lastsort&&b("div span.ui-icon-"+a.p.sortorder,this).removeClass("ui-state-disabled")}else if(e==a.p.lastsort){b("div span.s-ico",this).show();b("div span.ui-icon-"+a.p.sortorder,this).removeClass("ui-state-disabled")}if(a.p.footerrow)va+="<td role='gridcell' "+O(e,0,"",null,"",false)+">&#160;</td>"}).mousedown(function(e){if(b(e.target).closest("th>span.ui-jqgrid-resize").length==1){var d=b.jgrid.getCellIndex(this);if(a.p.forceFit===true){var i=a.p,n=d,p;for(p=d+1;p<a.p.colModel.length;p++)if(a.p.colModel[p].hidden!==true){n=p;break}i.nv=n-d}g.dragStart(d,e,Fa(d));return false}}).click(function(e){if(a.p.disableClick)return a.p.disableClick=false;var d="th>div.ui-jqgrid-sortable",i,n;a.p.viewsortcols[2]||(d="th>div>span>span.ui-grid-ico-sort");e=b(e.target).closest(d);if(e.length==1){d=b.jgrid.getCellIndex(this);if(!a.p.viewsortcols[2]){i=true;n=e.attr("sort")}Ca(b("div",this)[0].id,d,i,n);return false}});if(a.p.sortable&&b.fn.sortable)try{b(a).jqGrid("sortableColumns",r)}catch(La){}if(a.p.footerrow)va+="</tr></tbody></table>";wa+="</tr>";this.appendChild(document.createElement("tbody"));b(this).addClass("ui-jqgrid-btable").append(wa);wa=null;r=b("<table class='ui-jqgrid-htable' style='width:"+a.p.tblwidth+"px' role='grid' aria-labelledby='gbox_"+
this.id+"' cellspacing='0' cellpadding='0' border='0'></table>").append(ba);var da=a.p.caption&&a.p.hiddengrid===true?true:false;k=b("<div class='ui-jqgrid-hbox"+(l=="rtl"?"-rtl":"")+"'></div>");ba=null;g.hDiv=document.createElement("div");b(g.hDiv).css({width:g.width+"px"}).addClass("ui-state-default ui-jqgrid-hdiv").append(k);b(k).append(r);r=null;da&&b(g.hDiv).hide();if(a.p.pager){if(typeof a.p.pager=="string"){if(a.p.pager.substr(0,1)!="#")a.p.pager="#"+a.p.pager}else a.p.pager="#"+b(a.p.pager).attr("id");b(a.p.pager).css({width:g.width+"px"}).appendTo(P).addClass("ui-state-default ui-jqgrid-pager ui-corner-bottom");da&&b(a.p.pager).hide();v(a.p.pager,"")}a.p.cellEdit===false&&a.p.hoverrows===true&&b(a).bind("mouseover",function(e){R=b(e.target).closest("tr.jqgrow");b(R).attr("class")!=="subgrid"&&b(R).addClass("ui-state-hover");return false}).bind("mouseout",function(e){R=b(e.target).closest("tr.jqgrow");b(R).removeClass("ui-state-hover");return false});var ka,la;b(a).before(g.hDiv).click(function(e){X=e.target;R=b(X,a.rows).closest("tr.jqgrow");if(b(R).length===0||R[0].className.indexOf("ui-state-disabled")>-1)return this;var d=b(X).hasClass("cbox"),i=true;if(b.isFunction(a.p.beforeSelectRow))i=a.p.beforeSelectRow.call(a,R[0].id,e);if(X.tagName=="A"||(X.tagName=="INPUT"||X.tagName=="TEXTAREA"||X.tagName=="OPTION"||X.tagName=="SELECT")&&!d)return this;if(i===true){if(a.p.cellEdit===true)if(a.p.multiselect&&d)b(a).jqGrid("setSelection",R[0].id,true);else{ka=R[0].rowIndex;la=b.jgrid.getCellIndex(X);try{b(a).jqGrid("editCell",ka,la,true)}catch(n){}}else if(a.p.multikey)if(e[a.p.multikey])b(a).jqGrid("setSelection",R[0].id,true);else{if(a.p.multiselect&&d){d=b("[id^=jqg_"+b.jgrid.jqID(a.p.id)+"_]").attr("checked");b("[id^=jqg_"+b.jgrid.jqID(a.p.id)+"_]").attr("checked",!d)}}else{if(a.p.multiselect&&a.p.multiboxonly)if(!d){b(a.p.selarrrow).each(function(p,A){var s=a.rows.namedItem(A);b(s).removeClass("ui-state-highlight");b("#jqg_"+b.jgrid.jqID(a.p.id)+"_"+b.jgrid.jqID(A)).attr("checked",false)});a.p.selarrrow=[];b("#cb_"+b.jgrid.jqID(a.p.id),a.grid.hDiv).attr("checked",false)}b(a).jqGrid("setSelection",R[0].id,true)}if(b.isFunction(a.p.onCellSelect)){ka=R[0].id;la=b.jgrid.getCellIndex(X);a.p.onCellSelect.call(a,ka,la,b(X).html(),e)}e.stopPropagation()}else return this}).bind("reloadGrid",function(e,d){if(a.p.treeGrid===true)a.p.datatype=a.p.treedatatype;d&&d.current&&a.grid.selectionPreserver(a);if(a.p.datatype=="local"){b(a).jqGrid("resetSelection");a.p.data.length&&U()}else if(!a.p.treeGrid){a.p.selrow=null;if(a.p.multiselect){a.p.selarrrow=[];b("#cb_"+b.jgrid.jqID(a.p.id),a.grid.hDiv).attr("checked",false)}a.p.savedRow=[]}a.p.scroll&&W(a.grid.bDiv,true,false);if(d&&d.page){var i=d.page;if(i>a.p.lastpage)i=a.p.lastpage;if(i<1)i=1;a.p.page=i;a.grid.bDiv.scrollTop=a.grid.prevRowHeight?(i-1)*a.grid.prevRowHeight*a.p.rowNum:0}if(a.grid.prevRowHeight&&a.p.scroll){delete a.p.lastpage;a.grid.populateVisible()}else a.grid.populate();return false});b.isFunction(this.p.ondblClickRow)&&b(this).dblclick(function(e){X=e.target;R=b(X,a.rows).closest("tr.jqgrow");if(b(R).length===0)return false;ka=R[0].rowIndex;la=b.jgrid.getCellIndex(X);a.p.ondblClickRow.call(a,b(R).attr("id"),ka,la,e);return false});b.isFunction(this.p.onRightClickRow)&&b(this).bind("contextmenu",function(e){X=e.target;R=b(X,a.rows).closest("tr.jqgrow");if(b(R).length===0)return false;a.p.multiselect||b(a).jqGrid("setSelection",R[0].id,true);ka=R[0].rowIndex;la=b.jgrid.getCellIndex(X);a.p.onRightClickRow.call(a,b(R).attr("id"),ka,la,e);return false});g.bDiv=document.createElement("div");if(z)if(String(a.p.height).toLowerCase()==="auto")a.p.height="100%";b(g.bDiv).append(b('<div style="position:relative;'+(z&&b.browser.version<8?"height:0.01%;":"")+'"></div>').append("<div></div>").append(this)).addClass("ui-jqgrid-bdiv").css({height:a.p.height+(isNaN(a.p.height)?"":"px"),width:g.width+"px"}).scroll(g.scrollGrid);b("table:first",g.bDiv).css({width:a.p.tblwidth+"px"});if(z){b("tbody",this).size()==2&&b("tbody:gt(0)",this).remove();a.p.multikey&&b(g.bDiv).bind("selectstart",function(){return false})}else a.p.multikey&&b(g.bDiv).bind("mousedown",function(){return false});da&&b(g.bDiv).hide();g.cDiv=document.createElement("div");var Aa=a.p.hidegrid===true?b("<a role='link' href='javascript:void(0)'/>").addClass("ui-jqgrid-titlebar-close HeaderButton").hover(function(){Aa.addClass("ui-state-hover")},function(){Aa.removeClass("ui-state-hover")}).append("<span class='ui-icon ui-icon-circle-triangle-n'></span>").css(l=="rtl"?"left":"right","0px"):"";b(g.cDiv).append(Aa).append("<span class='ui-jqgrid-title"+(l=="rtl"?"-rtl":"")+"'>"+a.p.caption+"</span>").addClass("ui-jqgrid-titlebar ui-widget-header ui-corner-top ui-helper-clearfix");b(g.cDiv).insertBefore(g.hDiv);if(a.p.toolbar[0]){g.uDiv=document.createElement("div");if(a.p.toolbar[1]=="top")b(g.uDiv).insertBefore(g.hDiv);else a.p.toolbar[1]=="bottom"&&b(g.uDiv).insertAfter(g.hDiv);if(a.p.toolbar[1]=="both"){g.ubDiv=document.createElement("div");b(g.uDiv).insertBefore(g.hDiv).addClass("ui-userdata ui-state-default").attr("id","t_"+this.id);b(g.ubDiv).insertAfter(g.hDiv).addClass("ui-userdata ui-state-default").attr("id","tb_"+this.id);da&&b(g.ubDiv).hide()}else b(g.uDiv).width(g.width).addClass("ui-userdata ui-state-default").attr("id","t_"+this.id);da&&b(g.uDiv).hide()}if(a.p.toppager){a.p.toppager=b.jgrid.jqID(a.p.id)+"_toppager";g.topDiv=b("<div id='"+a.p.toppager+"'></div>")[0];a.p.toppager="#"+a.p.toppager;b(g.topDiv).insertBefore(g.hDiv).addClass("ui-state-default ui-jqgrid-toppager").width(g.width);v(a.p.toppager,"_t")}if(a.p.footerrow){g.sDiv=b("<div class='ui-jqgrid-sdiv'></div>")[0];k=b("<div class='ui-jqgrid-hbox"+(l=="rtl"?"-rtl":"")+"'></div>");b(g.sDiv).append(k).insertAfter(g.hDiv).width(g.width);b(k).append(va);g.footers=b(".ui-jqgrid-ftable",g.sDiv)[0].rows[0].cells;if(a.p.rownumbers)g.footers[0].className="ui-state-default jqgrid-rownum";da&&b(g.sDiv).hide()}k=null;if(a.p.caption){var Ga=a.p.datatype;if(a.p.hidegrid===true){b(".ui-jqgrid-titlebar-close",g.cDiv).click(function(e){var d=b.isFunction(a.p.onHeaderClick),i=".ui-jqgrid-bdiv, .ui-jqgrid-hdiv, .ui-jqgrid-pager, .ui-jqgrid-sdiv",n,p=this;if(a.p.toolbar[0]===true){if(a.p.toolbar[1]=="both")i+=", #"+b(g.ubDiv).attr("id");i+=", #"+b(g.uDiv).attr("id")}n=b(i,"#gview_"+b.jgrid.jqID(a.p.id)).length;if(a.p.gridstate=="visible")b(i,"#gbox_"+b.jgrid.jqID(a.p.id)).slideUp("fast",function(){n--;if(n===0){b("span",p).removeClass("ui-icon-circle-triangle-n").addClass("ui-icon-circle-triangle-s");a.p.gridstate="hidden";b("#gbox_"+b.jgrid.jqID(a.p.id)).hasClass("ui-resizable")&&b(".ui-resizable-handle","#gbox_"+b.jgrid.jqID(a.p.id)).hide();if(d)da||a.p.onHeaderClick.call(a,a.p.gridstate,e)}});else a.p.gridstate=="hidden"&&b(i,"#gbox_"+b.jgrid.jqID(a.p.id)).slideDown("fast",function(){n--;if(n===0){b("span",p).removeClass("ui-icon-circle-triangle-s").addClass("ui-icon-circle-triangle-n");if(da){a.p.datatype=Ga;ja();da=false}a.p.gridstate="visible";b("#gbox_"+b.jgrid.jqID(a.p.id)).hasClass("ui-resizable")&&b(".ui-resizable-handle","#gbox_"+b.jgrid.jqID(a.p.id)).show();if(d)da||a.p.onHeaderClick.call(a,a.p.gridstate,e)}});return false});if(da){a.p.datatype="local";b(".ui-jqgrid-titlebar-close",g.cDiv).trigger("click")}}}else b(g.cDiv).hide();b(g.hDiv).after(g.bDiv).mousemove(function(e){if(g.resizing){g.dragMove(e);return false}});b(".ui-jqgrid-labels",g.hDiv).bind("selectstart",function(){return false});b(document).mouseup(function(){if(g.resizing){g.dragEnd();return false}return true});a.formatCol=O;a.sortData=Ca;a.updatepager=function(e,d){var i,n,p,A,s,F,t,y="";p=parseInt(a.p.page,10)-1;if(p<0)p=0;p*=parseInt(a.p.rowNum,10);s=p+a.p.reccount;if(a.p.scroll){i=b("tbody:first > tr:gt(0)",a.grid.bDiv);p=s-i.length;a.p.reccount=i.length;if(n=i.outerHeight()||a.grid.prevRowHeight){i=p*n;n*=parseInt(a.p.records,10);b(">div:first",a.grid.bDiv).css({height:n}).children("div:first").css({height:i,display:i?"":"none"})}a.grid.bDiv.scrollLeft=a.grid.hDiv.scrollLeft}y=a.p.pager?a.p.pager:"";y+=a.p.toppager?y?","+a.p.toppager:a.p.toppager:"";if(y){t=b.jgrid.formatter.integer||{};i=K(a.p.page);n=K(a.p.lastpage);b(".selbox",y).attr("disabled",false);if(a.p.pginput===true){b(".ui-pg-input",y).val(a.p.page);b("#sp_1",y).html(b.fmatter?b.fmatter.util.NumberFormat(a.p.lastpage,t):a.p.lastpage)}if(a.p.viewrecords)if(a.p.reccount===0)b(".ui-paging-info",y).html(a.p.emptyrecords);else{A=p+1;F=a.p.records;if(b.fmatter){A=b.fmatter.util.NumberFormat(A,t);s=b.fmatter.util.NumberFormat(s,t);F=b.fmatter.util.NumberFormat(F,t)}b(".ui-paging-info",y).html(b.jgrid.format(a.p.recordtext,A,s,F))}if(a.p.pgbuttons===true){if(i<=0)i=n=0;if(i==1||i===0){b("#first, #prev",a.p.pager).addClass("ui-state-disabled").removeClass("ui-state-hover");a.p.toppager&&b("#first_t, #prev_t",a.p.toppager).addClass("ui-state-disabled").removeClass("ui-state-hover")}else{b("#first, #prev",a.p.pager).removeClass("ui-state-disabled");a.p.toppager&&b("#first_t, #prev_t",a.p.toppager).removeClass("ui-state-disabled")}if(i==n||i===0){b("#next, #last",a.p.pager).addClass("ui-state-disabled").removeClass("ui-state-hover");a.p.toppager&&b("#next_t, #last_t",a.p.toppager).addClass("ui-state-disabled").removeClass("ui-state-hover")}else{b("#next, #last",a.p.pager).removeClass("ui-state-disabled");a.p.toppager&&b("#next_t, #last_t",a.p.toppager).removeClass("ui-state-disabled")}}}e===true&&a.p.rownumbers===true&&b("td.jqgrid-rownum",a.rows).each(function(x){b(this).html(p+1+x)});d&&a.p.jqgdnd&&b(a).jqGrid("gridDnD","updateDnD");b.isFunction(a.p.gridComplete)&&a.p.gridComplete.call(a)};a.refreshIndex=U;a.formatter=function(e,d,i,n,p){return o(e,d,i,n,p)};b.extend(g,{populate:ja,emptyRows:W});this.grid=g;a.addXmlData=function(e){ga(e,a.grid.bDiv)};a.addJSONData=function(e){ca(e,a.grid.bDiv)};this.grid.cols=this.rows[0].cells;ja();a.p.hiddengrid=false;b(window).unload(function(){a=null})}}}})};b.jgrid.extend({getGridParam:function(f){var j=this[0];if(j&&j.grid)return f?typeof j.p[f]!="undefined"?j.p[f]:null:j.p},setGridParam:function(f){return this.each(function(){this.grid&&typeof f==="object"&&b.extend(true,this.p,f)})},getDataIDs:function(){var f=[],j=0,h,c=0;this.each(function(){if((h=this.rows.length)&&h>0)for(;j<h;){if(b(this.rows[j]).hasClass("jqgrow")){f[c]=this.rows[j].id;c++}j++}});return f},setSelection:function(f,j){return this.each(function(){function h(a){var r=b(c.grid.bDiv)[0].clientHeight,v=b(c.grid.bDiv)[0].scrollTop,z=c.rows[a].offsetTop;a=c.rows[a].clientHeight;if(z+a>=r+v)b(c.grid.bDiv)[0].scrollTop=z-(r+v)+a+v;else if(z<r+v)if(z<v)b(c.grid.bDiv)[0].scrollTop=z}var c=this,g,k,l;if(f!==undefined){j=j===false?false:true;k=c.rows.namedItem(f+"");if(!(!k||k.className.indexOf("ui-state-disabled")>-1)){if(c.p.scrollrows===true){g=c.rows.namedItem(f).rowIndex;g>=0&&h(g)}if(c.p.multiselect){c.p.selrow=k.id;l=b.inArray(c.p.selrow,c.p.selarrrow);if(l===-1){k.className!=="ui-subgrid"&&b(k).addClass("ui-state-highlight").attr("aria-selected","true");g=true;b("#jqg_"+b.jgrid.jqID(c.p.id)+"_"+b.jgrid.jqID(c.p.selrow)).attr("checked",g);c.p.selarrrow.push(c.p.selrow)}else{k.className!=="ui-subgrid"&&b(k).removeClass("ui-state-highlight").attr("aria-selected","false");g=false;b("#jqg_"+b.jgrid.jqID(c.p.id)+"_"+b.jgrid.jqID(c.p.selrow)).attr("checked",g);c.p.selarrrow.splice(l,1);l=c.p.selarrrow[0];c.p.selrow=l===undefined?null:l}c.p.onSelectRow&&j&&c.p.onSelectRow.call(c,k.id,g)}else if(k.className!=="ui-subgrid"){if(c.p.selrow!=k.id){b(c.rows.namedItem(c.p.selrow)).removeClass("ui-state-highlight").attr({"aria-selected":"false",tabindex:"-1"});b(k).addClass("ui-state-highlight").attr({"aria-selected":true,tabindex:"0"});g=true}else g=false;c.p.selrow=k.id;c.p.onSelectRow&&j&&c.p.onSelectRow.call(c,k.id,g)}}}})},resetSelection:function(f){return this.each(function(){var j=this,h,c;if(typeof f!=="undefined"){c=f===j.p.selrow?j.p.selrow:f;b("#"+b.jgrid.jqID(j.p.id)+" tbody:first tr#"+b.jgrid.jqID(c)).removeClass("ui-state-highlight").attr("aria-selected","false");if(j.p.multiselect){b("#jqg_"+b.jgrid.jqID(j.p.id)+"_"+b.jgrid.jqID(c)).attr("checked",false);b("#cb_"+b.jgrid.jqID(j.p.id)).attr("checked",false)}c=null}else if(j.p.multiselect){b(j.p.selarrrow).each(function(g,k){h=j.rows.namedItem(k);b(h).removeClass("ui-state-highlight").attr("aria-selected","false");b("#jqg_"+b.jgrid.jqID(j.p.id)+"_"+b.jgrid.jqID(k)).attr("checked",false)});b("#cb_"+b.jgrid.jqID(j.p.id)).attr("checked",false);j.p.selarrrow=[]}else if(j.p.selrow){b("#"+b.jgrid.jqID(j.p.id)+" tbody:first tr#"+b.jgrid.jqID(j.p.selrow)).removeClass("ui-state-highlight").attr("aria-selected","false");j.p.selrow=null}j.p.savedRow=[]})},getRowData:function(f){var j={},h,c=false,g,k=0;this.each(function(){var l=this,a,r;if(typeof f=="undefined"){c=true;h=[];g=l.rows.length}else{r=l.rows.namedItem(f);if(!r)return j;g=2}for(;k<g;){if(c)r=l.rows[k];if(b(r).hasClass("jqgrow")){b("td",r).each(function(v){a=l.p.colModel[v].name;if(a!=="cb"&&a!=="subgrid"&&a!=="rn")if(l.p.treeGrid===true&&a==l.p.ExpandColumn)j[a]=b.jgrid.htmlDecode(b("span:first",this).html());else try{j[a]=b.unformat(this,{rowId:r.id,colModel:l.p.colModel[v]},v)}catch(z){j[a]=b.jgrid.htmlDecode(b(this).html())}});if(c){h.push(j);j={}}}k++}});return h?h:j},delRowData:function(f){var j=false,h,c;this.each(function(){if(h=this.rows.namedItem(f)){b(h).remove();this.p.records--;this.p.reccount--;this.updatepager(true,false);j=true;if(this.p.multiselect){c=b.inArray(f,this.p.selarrrow);c!=-1&&this.p.selarrrow.splice(c,1)}if(f==this.p.selrow)this.p.selrow=null}else return false;if(this.p.datatype=="local"){var g=this.p._index[f];if(typeof g!="undefined"){this.p.data.splice(g,1);this.refreshIndex()}}if(this.p.altRows===true&&j){var k=this.p.altclass;b(this.rows).each(function(l){l%2==1?b(this).addClass(k):b(this).removeClass(k)})}});return j},setRowData:function(f,j,h){var c,g=true,k;this.each(function(){if(!this.grid)return false;var l=this,a,r,v=typeof h,z={};r=l.rows.namedItem(f);if(!r)return false;if(j)try{b(this.p.colModel).each(function(O){c=this.name;if(j[c]!==undefined){z[c]=this.formatter&&typeof this.formatter==="string"&&this.formatter=="date"?b.unformat.date(j[c],this):j[c];a=l.formatter(f,j[c],O,j,"edit");k=this.title?{title:b.jgrid.stripHtml(a)}:{};l.p.treeGrid===true&&c==l.p.ExpandColumn?b("td:eq("+O+") > span:first",r).html(a).attr(k):b("td:eq("+O+")",r).html(a).attr(k)}});if(l.p.datatype=="local"){var E=l.p._index[f];if(l.p.treeGrid)for(var P in l.p.treeReader)z.hasOwnProperty(l.p.treeReader[P])&&delete z[l.p.treeReader[P]];if(typeof E!="undefined")l.p.data[E]=b.extend(true,l.p.data[E],z);z=null}}catch(K){g=false}if(g)if(v==="string")b(r).addClass(h);else v==="object"&&b(r).css(h)});return g},addRowData:function(f,j,h,c){h||(h="last");var g=false,k,l,a,r,v,z,E,P,K="",O,m,o,q,B;if(j){if(b.isArray(j)){O=true;h="last";m=f}else{j=[j];O=false}this.each(function(){var T=j.length;v=this.p.rownumbers===true?1:0;a=this.p.multiselect===true?1:0;r=this.p.subGrid===true?1:0;if(!O)if(typeof f!="undefined")f+="";else{f=b.jgrid.randId();if(this.p.keyIndex!==false){m=this.p.colModel[this.p.keyIndex+a+r+v].name;if(typeof j[0][m]!="undefined")f=j[0][m]}}o=this.p.altclass;for(var J=0,D="",W={},U=b.isFunction(this.p.afterInsertRow)?true:false;J<T;){q=j[J];l="";if(O){try{f=q[m]}catch(ga){f=b.jgrid.randId()}D=this.p.altRows===true?(this.rows.length-1)%2===0?o:"":""}if(v){K=this.formatCol(0,1,"",null,f,true);l+='<td role="gridcell" aria-describedby="'+this.p.id+'_rn" class="ui-state-default jqgrid-rownum" '+K+">0</td>"}if(a){P='<input role="checkbox" type="checkbox" id="jqg_'+this.p.id+"_"+f+'" class="cbox"/>';K=this.formatCol(v,1,"",null,f,true);l+='<td role="gridcell" aria-describedby="'+this.p.id+'_cb" '+K+">"+P+"</td>"}if(r)l+=b(this).jqGrid("addSubGridCell",a+v,1);for(E=a+r+v;E<this.p.colModel.length;E++){B=this.p.colModel[E];k=B.name;W[k]=B.formatter&&typeof B.formatter==="string"&&B.formatter=="date"?b.unformat.date(q[k],B):q[k];P=this.formatter(f,b.jgrid.getAccessor(q,k),E,q,"edit");K=this.formatCol(E,1,P,f,q,true);l+='<td role="gridcell" aria-describedby="'+this.p.id+"_"+k+'" '+K+">"+P+"</td>"}l='<tr id="'+f+'" role="row" tabindex="-1" class="ui-widget-content jqgrow ui-row-'+this.p.direction+" "+D+'">'+l+"</tr>";if(this.p.subGrid===true){l=b(l)[0];b(this).jqGrid("addSubGrid",l,a+v)}if(this.rows.length===0)b("table:first",this.grid.bDiv).append(l);else switch(h){case"last":b(this.rows[this.rows.length-1]).after(l);break;case"first":b(this.rows[0]).after(l);break;case"after":if(z=this.rows.namedItem(c))b(this.rows[z.rowIndex+1]).hasClass("ui-subgrid")?b(this.rows[z.rowIndex+1]).after(l):b(z).after(l);break;case"before":if(z=this.rows.namedItem(c)){b(z).before(l);z=z.rowIndex}}this.p.records++;this.p.reccount++;U&&this.p.afterInsertRow.call(this,f,q,q);J++;if(this.p.datatype=="local"){W[this.p.localReader.id]=f;this.p._index[f]=this.p.data.length;this.p.data.push(W);W={}}}if(this.p.altRows===true&&!O)if(h=="last")(this.rows.length-1)%2==1&&b(this.rows[this.rows.length-1]).addClass(o);else b(this.rows).each(function(ca){ca%2==1?b(this).addClass(o):b(this).removeClass(o)});this.updatepager(true,true);g=true})}return g},footerData:function(f,j,h){function c(r){for(var v in r)if(r.hasOwnProperty(v))return false;return true}var g,k=false,l={},a;if(typeof f=="undefined")f="get";if(typeof h!="boolean")h=true;f=f.toLowerCase();this.each(function(){var r=this,v;if(!r.grid||!r.p.footerrow)return false;if(f=="set")if(c(j))return false;k=true;b(this.p.colModel).each(function(z){g=this.name;if(f=="set"){if(j[g]!==undefined){v=h?r.formatter("",j[g],z,j,"edit"):j[g];a=this.title?{title:b.jgrid.stripHtml(v)}:{};b("tr.footrow td:eq("+z+")",r.grid.sDiv).html(v).attr(a);k=true}}else if(f=="get")l[g]=b("tr.footrow td:eq("+z+")",r.grid.sDiv).html()})});return f=="get"?l:k},showHideCol:function(f,j){return this.each(function(){var h=this,c=false,g=b.browser.webkit||b.browser.safari?0:h.p.cellLayout,k;if(h.grid){if(typeof f==="string")f=[f];j=j!="none"?"":"none";var l=j===""?true:false;b(this.p.colModel).each(function(a){if(b.inArray(this.name,f)!==-1&&this.hidden===l){b("tr",h.grid.hDiv).each(function(){b(this).children("th:eq("+a+")").css("display",j)});b(h.rows).each(function(){b(this).children("td:eq("+a+")").css("display",j)});h.p.footerrow&&b(h.grid.sDiv).children("td:eq("+a+")").css("display",j);k=this.widthOrg?this.widthOrg:parseInt(this.width,10);if(j==="none")h.p.tblwidth-=k+g;else h.p.tblwidth+=k+g;this.hidden=!l;c=true}});if(c===true)if(h.grid.width!==h.p.tblwidth)b(h).jqGrid("setGridWidth",h.p.shrinkToFit===true?h.grid.width:h.p.tblwidth,true)}})},hideCol:function(f){return this.each(function(){b(this).jqGrid("showHideCol",f,"none")})},showCol:function(f){return this.each(function(){b(this).jqGrid("showHideCol",f,"")})},remapColumns:function(f,j,h){function c(l){var a;a=l.length?b.makeArray(l):b.extend({},l);b.each(f,function(r){l[r]=a[this]})}function g(l,a){b(">tr"+(a||""),l).each(function(){var r=this,v=b.makeArray(r.cells);b.each(f,function(){var z=v[this];z&&r.appendChild(z)})})}var k=this.get(0);c(k.p.colModel);c(k.p.colNames);c(k.grid.headers);g(b("thead:first",k.grid.hDiv),h&&":not(.ui-jqgrid-labels)");j&&g(b("#"+b.jgrid.jqID(k.p.id)+" tbody:first"),".jqgfirstrow, tr.jqgrow, tr.jqfoot");k.p.footerrow&&g(b("tbody:first",k.grid.sDiv));if(k.p.remapColumns)if(k.p.remapColumns.length)c(k.p.remapColumns);else k.p.remapColumns=b.makeArray(f);k.p.lastsort=b.inArray(k.p.lastsort,f);if(k.p.treeGrid)k.p.expColInd=b.inArray(k.p.expColInd,f)},setGridWidth:function(f,j){return this.each(function(){if(this.grid){var h=this,c,g=0,k=b.browser.webkit||b.browser.safari?0:h.p.cellLayout,l,a=0,r=false,v=h.p.scrollOffset,z,E=0,P=0,K;if(typeof j!="boolean")j=h.p.shrinkToFit;if(!isNaN(f)){f=parseInt(f,10);h.grid.width=h.p.width=f;b("#gbox_"+b.jgrid.jqID(h.p.id)).css("width",f+"px");b("#gview_"+b.jgrid.jqID(h.p.id)).css("width",f+"px");b(h.grid.bDiv).css("width",f+"px");b(h.grid.hDiv).css("width",f+"px");h.p.pager&&b(h.p.pager).css("width",f+"px");h.p.toppager&&b(h.p.toppager).css("width",f+"px");if(h.p.toolbar[0]===true){b(h.grid.uDiv).css("width",f+"px");h.p.toolbar[1]=="both"&&b(h.grid.ubDiv).css("width",f+"px")}h.p.footerrow&&b(h.grid.sDiv).css("width",f+"px");if(j===false&&h.p.forceFit===true)h.p.forceFit=false;if(j===true){b.each(h.p.colModel,function(){if(this.hidden===false){c=this.widthOrg?this.widthOrg:parseInt(this.width,10);g+=c+k;if(this.fixed)E+=c+k;else a++;P++}});if(a!==0){h.p.tblwidth=g;z=f-k*a-E;if(!isNaN(h.p.height))if(b(h.grid.bDiv)[0].clientHeight<b(h.grid.bDiv)[0].scrollHeight||h.rows.length===1){r=true;z-=v}g=0;var O=h.grid.cols.length>0;b.each(h.p.colModel,function(m){if(this.hidden===false&&!this.fixed){c=this.widthOrg?this.widthOrg:parseInt(this.width,10);c=Math.round(z*c/(h.p.tblwidth-k*a-E));if(!(c<0)){this.width=c;g+=c;h.grid.headers[m].width=c;h.grid.headers[m].el.style.width=c+"px";if(h.p.footerrow)h.grid.footers[m].style.width=c+"px";if(O)h.grid.cols[m].style.width=c+"px";l=m}}});K=0;if(r){if(f-E-(g+k*a)!==v)K=f-E-(g+k*a)-v}else if(Math.abs(f-E-(g+k*a))!==1)K=f-E-(g+k*a);h.p.colModel[l].width+=K;h.p.tblwidth=g+K+k*a+E;if(h.p.tblwidth>f){r=h.p.tblwidth-parseInt(f,10);h.p.tblwidth=f;c=h.p.colModel[l].width-=r}else c=h.p.colModel[l].width;h.grid.headers[l].width=c;h.grid.headers[l].el.style.width=c+"px";if(O)h.grid.cols[l].style.width=c+"px";b("table:first",h.grid.bDiv).css("width",h.p.tblwidth+"px");b("table:first",h.grid.hDiv).css("width",h.p.tblwidth+"px");h.grid.hDiv.scrollLeft=h.grid.bDiv.scrollLeft;if(h.p.footerrow){h.grid.footers[l].style.width=c+"px";b("table:first",h.grid.sDiv).css("width",h.p.tblwidth+"px")}}}}}})},setGridHeight:function(f){return this.each(function(){if(this.grid){b(this.grid.bDiv).css({height:f+(isNaN(f)?"":"px")});this.p.height=f;this.p.scroll&&this.grid.populateVisible()}})},setCaption:function(f){return this.each(function(){this.p.caption=f;b("span.ui-jqgrid-title",this.grid.cDiv).html(f);b(this.grid.cDiv).show()})},setLabel:function(f,j,h,c){return this.each(function(){var g=-1;if(this.grid){if(isNaN(f))b(this.p.colModel).each(function(a){if(this.name==f){g=a;return false}});else g=parseInt(f,10);if(g>=0){var k=b("tr.ui-jqgrid-labels th:eq("+g+")",this.grid.hDiv);if(j){var l=b(".s-ico",k);b("[id^=jqgh_]",k).empty().html(j).append(l);this.p.colNames[g]=j}if(h)typeof h==="string"?b(k).addClass(h):b(k).css(h);typeof c==="object"&&b(k).attr(c)}}})},setCell:function(f,j,h,c,g,k){return this.each(function(){var l=-1,a,r;if(this.grid){if(isNaN(j))b(this.p.colModel).each(function(z){if(this.name==j){l=z;return false}});else l=parseInt(j,10);if(l>=0)if(a=this.rows.namedItem(f)){var v=b("td:eq("+l+")",a);if(h!==""||k===true){a=this.formatter(f,h,l,a,"edit");r=this.p.colModel[l].title?{title:b.jgrid.stripHtml(a)}:{};this.p.treeGrid&&b(".tree-wrap",b(v)).length>0?b("span",b(v)).html(a).attr(r):b(v).html(a).attr(r);if(this.p.datatype=="local"){a=this.p.colModel[l];h=a.formatter&&typeof a.formatter==="string"&&a.formatter=="date"?b.unformat.date(h,a):h;r=this.p._index[f];if(typeof r!="undefined")this.p.data[r][a.name]=h}}if(typeof c==="string")b(v).addClass(c);else c&&b(v).css(c);typeof g==="object"&&b(v).attr(g)}}})},getCell:function(f,j){var h=false;this.each(function(){var c=-1;if(this.grid){if(isNaN(j))b(this.p.colModel).each(function(l){if(this.name===j){c=l;return false}});else c=parseInt(j,10);if(c>=0){var g=this.rows.namedItem(f);if(g)try{h=b.unformat(b("td:eq("+
c+")",g),{rowId:g.id,colModel:this.p.colModel[c]},c)}catch(k){h=b.jgrid.htmlDecode(b("td:eq("+c+")",g).html())}}}});return h},getCol:function(f,j,h){var c=[],g,k=0,l=0,a=0,r;j=typeof j!="boolean"?false:j;if(typeof h=="undefined")h=false;this.each(function(){var v=-1;if(this.grid){if(isNaN(f))b(this.p.colModel).each(function(K){if(this.name===f){v=K;return false}});else v=parseInt(f,10);if(v>=0){var z=this.rows.length,E=0;if(z&&z>0){for(;E<z;){if(b(this.rows[E]).hasClass("jqgrow")){try{g=b.unformat(b(this.rows[E].cells[v]),{rowId:this.rows[E].id,colModel:this.p.colModel[v]},v)}catch(P){g=b.jgrid.htmlDecode(this.rows[E].cells[v].innerHTML)}if(h){r=parseFloat(g);k+=r;l=Math.min(l,r);a=Math.max(l,r)}else j?c.push({id:this.rows[E].id,value:g}):c.push(g)}E++}if(h)switch(h.toLowerCase()){case"sum":c=k;break;case"avg":c=k/z;break;case"count":c=z;break;case"min":c=l;break;case"max":c=a}}}}});return c},clearGridData:function(f){return this.each(function(){if(this.grid){if(typeof f!="boolean")f=false;if(this.p.deepempty)b("#"+
b.jgrid.jqID(this.p.id)+" tbody:first tr:gt(0)").remove();else{var j=b("#"+b.jgrid.jqID(this.p.id)+" tbody:first tr:first")[0];b("#"+b.jgrid.jqID(this.p.id)+" tbody:first").empty().append(j)}this.p.footerrow&&f&&b(".ui-jqgrid-ftable td",this.grid.sDiv).html("&#160;");this.p.selrow=null;this.p.selarrrow=[];this.p.savedRow=[];this.p.records=0;this.p.page=1;this.p.lastpage=0;this.p.reccount=0;this.p.data=[];this.p_index={};this.updatepager(true,false)}})},getInd:function(f,j){var h=false,c;this.each(function(){if(c=this.rows.namedItem(f))h=j===true?c:c.rowIndex});return h},bindKeys:function(f){var j=b.extend({onEnter:null,onSpace:null,onLeftKey:null,onRightKey:null,scrollingRows:true},f||{});return this.each(function(){var h=this;b("body").is("[role]")||b("body").attr("role","application");h.p.scrollrows=j.scrollingRows;b(h).keydown(function(c){var g=b(h).find("tr[tabindex=0]")[0],k,l,a,r=h.p.treeReader.expanded_field;if(g){a=h.p._index[g.id];if(c.keyCode===37||c.keyCode===38||c.keyCode===39||c.keyCode===40){if(c.keyCode===38){l=g.previousSibling;k="";if(l)if(b(l).is(":hidden"))for(;l;){l=l.previousSibling;if(!b(l).is(":hidden")&&b(l).hasClass("jqgrow")){k=l.id;break}}else k=l.id;b(h).jqGrid("setSelection",k)}if(c.keyCode===40){l=g.nextSibling;k="";if(l)if(b(l).is(":hidden"))for(;l;){l=l.nextSibling;if(!b(l).is(":hidden")&&b(l).hasClass("jqgrow")){k=l.id;break}}else k=l.id;b(h).jqGrid("setSelection",k)}if(c.keyCode===37){h.p.treeGrid&&h.p.data[a][r]&&b(g).find("div.treeclick").trigger("click");b.isFunction(j.onLeftKey)&&j.onLeftKey.call(h,h.p.selrow)}if(c.keyCode===39){h.p.treeGrid&&!h.p.data[a][r]&&b(g).find("div.treeclick").trigger("click");b.isFunction(j.onRightKey)&&j.onRightKey.call(h,h.p.selrow)}return false}else if(c.keyCode===13){b.isFunction(j.onEnter)&&j.onEnter.call(h,h.p.selrow);return false}else if(c.keyCode===32){b.isFunction(j.onSpace)&&j.onSpace.call(h,h.p.selrow);return false}}})})},unbindKeys:function(){return this.each(function(){b(this).unbind("keydown")})},getLocalRow:function(f){var j=false,h;this.each(function(){if(typeof f!=="undefined"){h=this.p._index[f];if(h>=0)j=this.p.data[h]}});return j}})})(jQuery);(function(b){b.fmatter={};b.extend(b.fmatter,{isBoolean:function(a){return typeof a==="boolean"},isObject:function(a){return a&&(typeof a==="object"||b.isFunction(a))||false},isString:function(a){return typeof a==="string"},isNumber:function(a){return typeof a==="number"&&isFinite(a)},isNull:function(a){return a===null},isUndefined:function(a){return typeof a==="undefined"},isValue:function(a){return this.isObject(a)||this.isString(a)||this.isNumber(a)||this.isBoolean(a)},isEmpty:function(a){if(!this.isString(a)&&this.isValue(a))return false;else if(!this.isValue(a))return true;a=b.trim(a).replace(/\&nbsp\;/ig,"").replace(/\&#160\;/ig,"");return a===""}});b.fn.fmatter=function(a,c,d,e,f){var g=c;d=b.extend({},b.jgrid.formatter,d);if(b.fn.fmatter[a])g=b.fn.fmatter[a](c,d,e,f);return g};b.fmatter.util={NumberFormat:function(a,c){b.fmatter.isNumber(a)||(a*=1);if(b.fmatter.isNumber(a)){var d=a<0,e=a+"",f=c.decimalSeparator?c.decimalSeparator:".",g;if(b.fmatter.isNumber(c.decimalPlaces)){var h=c.decimalPlaces;e=Math.pow(10,h);e=Math.round(a*e)/e+"";g=e.lastIndexOf(".");if(h>0){if(g<0){e+=f;g=e.length-1}else if(f!==".")e=e.replace(".",f);for(;e.length-1-g<h;)e+="0"}}if(c.thousandsSeparator){h=c.thousandsSeparator;g=e.lastIndexOf(f);g=g>-1?g:e.length;f=e.substring(g);for(var i=-1,j=g;j>0;j--){i++;if(i%3===0&&j!==g&&(!d||j>1))f=h+f;f=e.charAt(j-1)+f}e=f}e=c.prefix?c.prefix+e:e;return e=c.suffix?e+c.suffix:e}else return a},DateFormat:function(a,c,d,e){var f=/^\/Date\((([-+])?[0-9]+)(([-+])([0-9]{2})([0-9]{2}))?\)\/$/,g=typeof c==="string"?c.match(f):null;f=function(m,r){m=String(m);for(r=parseInt(r,10)||2;m.length<r;)m="0"+m;return m};var h={m:1,d:1,y:1970,h:0,i:0,s:0,u:0},i=0,j,k=["i18n"];k.i18n={dayNames:e.dayNames,monthNames:e.monthNames};if(a in e.masks)a=e.masks[a];if(c.constructor===Number){if(String(a).toLowerCase()=="u")c*=1E3;i=new Date(c)}else if(c.constructor===Date)i=c;else if(g!==null){i=new Date(parseInt(g[1],10));if(g[3]){a=Number(g[5])*60+Number(g[6]);a*=g[4]=="-"?1:-1;a-=i.getTimezoneOffset();i.setTime(Number(Number(i)+a*6E4))}}else{c=String(c).split(/[\\\/:_;.,\t\T\s-]/);a=a.split(/[\\\/:_;.,\t\T\s-]/);g=0;for(j=a.length;g<j;g++){if(a[g]=="M"){i=b.inArray(c[g],k.i18n.monthNames);if(i!==-1&&i<12)c[g]=i+1}if(a[g]=="F"){i=b.inArray(c[g],k.i18n.monthNames);if(i!==-1&&i>11)c[g]=i+1-12}if(c[g])h[a[g].toLowerCase()]=parseInt(c[g],10)}if(h.f)h.m=h.f;if(h.m===0&&h.y===0&&h.d===0)return"&#160;";h.m=parseInt(h.m,10)-1;i=h.y;if(i>=70&&i<=99)h.y=1900+h.y;else if(i>=0&&i<=69)h.y=2E3+h.y;i=new Date(h.y,h.m,h.d,h.h,h.i,h.s,h.u)}if(d in e.masks)d=e.masks[d];else d||(d="Y-m-d");a=i.getHours();c=i.getMinutes();h=i.getDate();g=i.getMonth()+1;j=i.getTimezoneOffset();var l=i.getSeconds(),o=i.getMilliseconds(),n=i.getDay(),p=i.getFullYear(),q=(n+6)%7+1,s=(new Date(p,g-1,h)-new Date(p,0,1))/864E5,t={d:f(h),D:k.i18n.dayNames[n],j:h,l:k.i18n.dayNames[n+7],N:q,S:e.S(h),w:n,z:s,W:q<5?Math.floor((s+q-1)/7)+1:Math.floor((s+q-1)/7)||(((new Date(p-1,0,1)).getDay()+6)%7<4?53:52),F:k.i18n.monthNames[g-1+12],m:f(g),M:k.i18n.monthNames[g-1],n:g,t:"?",L:"?",o:"?",Y:p,y:String(p).substring(2),a:a<12?e.AmPm[0]:e.AmPm[1],A:a<12?e.AmPm[2]:e.AmPm[3],B:"?",g:a%12||12,G:a,h:f(a%12||12),H:f(a),i:f(c),s:f(l),u:o,e:"?",I:"?",O:(j>0?"-":"+")+f(Math.floor(Math.abs(j)/60)*100+Math.abs(j)%60,4),P:"?",T:(String(i).match(/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d{4})?)\b/g)||[""]).pop().replace(/[^-+\dA-Z]/g,""),Z:"?",c:"?",r:"?",U:Math.floor(i/1E3)};return d.replace(/\\.|[dDjlNSwzWFmMntLoYyaABgGhHisueIOPTZcrU]/g,function(m){return m in t?t[m]:m.substring(1)})}};b.fn.fmatter.defaultFormat=function(a,c){return b.fmatter.isValue(a)&&a!==""?a:c.defaultValue?c.defaultValue:"&#160;"};b.fn.fmatter.email=function(a,c){return b.fmatter.isEmpty(a)?b.fn.fmatter.defaultFormat(a,c):'<a href="mailto:'+a+'">'+a+"</a>"};b.fn.fmatter.checkbox=function(a,c){var d=b.extend({},c.checkbox),e;b.fmatter.isUndefined(c.colModel.formatoptions)||(d=b.extend({},d,c.colModel.formatoptions));e=d.disabled===true?'disabled="disabled"':"";if(b.fmatter.isEmpty(a)||b.fmatter.isUndefined(a))a=b.fn.fmatter.defaultFormat(a,d);a+="";a=a.toLowerCase();return'<input type="checkbox" '+(a.search(/(false|0|no|off)/i)<0?" checked='checked' ":"")+' value="'+a+'" offval="no" '+e+"/>"};b.fn.fmatter.link=function(a,c){var d={target:c.target},e="";b.fmatter.isUndefined(c.colModel.formatoptions)||(d=b.extend({},d,c.colModel.formatoptions));if(d.target)e="target="+d.target;return b.fmatter.isEmpty(a)?b.fn.fmatter.defaultFormat(a,c):"<a "+e+' href="'+a+'">'+a+"</a>"};b.fn.fmatter.showlink=function(a,c){var d={baseLinkUrl:c.baseLinkUrl,showAction:c.showAction,addParam:c.addParam||"",target:c.target,idName:c.idName},e="";b.fmatter.isUndefined(c.colModel.formatoptions)||(d=b.extend({},d,c.colModel.formatoptions));if(d.target)e="target="+d.target;d=d.baseLinkUrl+d.showAction+"?"+d.idName+"="+c.rowId+d.addParam;return b.fmatter.isString(a)||b.fmatter.isNumber(a)?"<a "+e+' href="'+d+'">'+a+"</a>":b.fn.fmatter.defaultFormat(a,c)};b.fn.fmatter.integer=function(a,c){var d=b.extend({},c.integer);b.fmatter.isUndefined(c.colModel.formatoptions)||(d=b.extend({},d,c.colModel.formatoptions));if(b.fmatter.isEmpty(a))return d.defaultValue;return b.fmatter.util.NumberFormat(a,d)};b.fn.fmatter.number=function(a,c){var d=b.extend({},c.number);b.fmatter.isUndefined(c.colModel.formatoptions)||(d=b.extend({},d,c.colModel.formatoptions));if(b.fmatter.isEmpty(a))return d.defaultValue;return b.fmatter.util.NumberFormat(a,d)};b.fn.fmatter.currency=function(a,c){var d=b.extend({},c.currency);b.fmatter.isUndefined(c.colModel.formatoptions)||(d=b.extend({},d,c.colModel.formatoptions));if(b.fmatter.isEmpty(a))return d.defaultValue;return b.fmatter.util.NumberFormat(a,d)};b.fn.fmatter.date=function(a,c,d,e){d=b.extend({},c.date);b.fmatter.isUndefined(c.colModel.formatoptions)||(d=b.extend({},d,c.colModel.formatoptions));return!d.reformatAfterEdit&&e=="edit"?b.fn.fmatter.defaultFormat(a,c):b.fmatter.isEmpty(a)?b.fn.fmatter.defaultFormat(a,c):b.fmatter.util.DateFormat(d.srcformat,a,d.newformat,d)};b.fn.fmatter.select=function(a,c){a+="";var d=false,e=[];if(b.fmatter.isUndefined(c.colModel.formatoptions)){if(!b.fmatter.isUndefined(c.colModel.editoptions))d=c.colModel.editoptions.value}else d=c.colModel.formatoptions.value;if(d){var f=c.colModel.editoptions.multiple===true?true:false,g=[],h;if(f){g=a.split(",");g=b.map(g,function(l){return b.trim(l)})}if(b.fmatter.isString(d))for(var i=d.split(";"),j=0,k=0;k<i.length;k++){h=i[k].split(":");if(h.length>2)h[1]=jQuery.map(h,function(l,o){if(o>0)return l}).join(":");if(f){if(jQuery.inArray(h[0],g)>-1){e[j]=h[1];j++}}else if(b.trim(h[0])==b.trim(a)){e[0]=h[1];break}}else if(b.fmatter.isObject(d))if(f)e=jQuery.map(g,function(l){return d[l]});else e[0]=d[a]||""}a=e.join(", ");return a===""?b.fn.fmatter.defaultFormat(a,c):a};b.fn.fmatter.rowactions=function(a,c,d,e){var f={keys:false,editbutton:true,delbutton:true,onEdit:null,onSuccess:null,afterSave:null,onError:null,afterRestore:null,extraparam:{oper:"edit"},url:null,delOptions:{}};e=b("#"+c)[0].p.colModel[e];b.fmatter.isUndefined(e.formatoptions)||(f=b.extend(f,e.formatoptions));e=function(h){f.afterSave&&f.afterSave(h);b("tr#"+a+" div.ui-inline-edit, tr#"+a+" div.ui-inline-del","#"+c).show();b("tr#"+a+" div.ui-inline-save, tr#"+a+" div.ui-inline-cancel","#"+c).hide()};var g=function(h){f.afterRestore&&f.afterRestore(h);b("tr#"+a+" div.ui-inline-edit, tr#"+a+" div.ui-inline-del","#"+c).show();b("tr#"+a+" div.ui-inline-save, tr#"+a+" div.ui-inline-cancel","#"+c).hide()};switch(d){case"edit":b("#"+
c).jqGrid("editRow",a,f.keys,f.onEdit,f.onSuccess,f.url,f.extraparam,e,f.onError,g);b("tr#"+a+" div.ui-inline-edit, tr#"+a+" div.ui-inline-del","#"+c).hide();b("tr#"+a+" div.ui-inline-save, tr#"+a+" div.ui-inline-cancel","#"+c).show();break;case"save":if(b("#"+c).jqGrid("saveRow",a,f.onSuccess,f.url,f.extraparam,e,f.onError,g)){b("tr#"+a+" div.ui-inline-edit, tr#"+a+" div.ui-inline-del","#"+c).show();b("tr#"+a+" div.ui-inline-save, tr#"+a+" div.ui-inline-cancel","#"+c).hide()}break;case"cancel":b("#"+
c).jqGrid("restoreRow",a,g);b("tr#"+a+" div.ui-inline-edit, tr#"+a+" div.ui-inline-del","#"+c).show();b("tr#"+a+" div.ui-inline-save, tr#"+a+" div.ui-inline-cancel","#"+c).hide();break;case"del":b("#"+c).jqGrid("delGridRow",a,f.delOptions)}};b.fn.fmatter.actions=function(a,c){var d={keys:false,editbutton:true,delbutton:true};b.fmatter.isUndefined(c.colModel.formatoptions)||(d=b.extend(d,c.colModel.formatoptions));var e=c.rowId,f="",g;if(typeof e=="undefined"||b.fmatter.isEmpty(e))return"";if(d.editbutton){g="onclick=$.fn.fmatter.rowactions('"+e+"','"+c.gid+"','edit',"+c.pos+");";f=f+"<div style='margin-left:8px;'><div title='"+b.jgrid.nav.edittitle+"' style='float:left;cursor:pointer;' class='ui-pg-div ui-inline-edit' "+g+"><span class='ui-icon ui-icon-pencil'></span></div>"}if(d.delbutton){g="onclick=$.fn.fmatter.rowactions('"+e+"','"+c.gid+"','del',"+c.pos+");";f=f+"<div title='"+b.jgrid.nav.deltitle+"' style='float:left;margin-left:5px;' class='ui-pg-div ui-inline-del' "+g+"><span class='ui-icon ui-icon-trash'></span></div>"}g="onclick=$.fn.fmatter.rowactions('"+e+"','"+c.gid+"','save',"+c.pos+");";f=f+"<div title='"+b.jgrid.edit.bSubmit+"' style='float:left;display:none' class='ui-pg-div ui-inline-save'><span class='ui-icon ui-icon-disk' "+g+"></span></div>";g="onclick=$.fn.fmatter.rowactions('"+e+"','"+c.gid+"','cancel',"+c.pos+");";return f=f+"<div title='"+b.jgrid.edit.bCancel+"' style='float:left;display:none;margin-left:5px;' class='ui-pg-div ui-inline-cancel'><span class='ui-icon ui-icon-cancel' "+g+"></span></div></div>"};b.unformat=function(a,c,d,e){var f,g=c.colModel.formatter,h=c.colModel.formatoptions||{},i=/([\.\*\_\'\(\)\{\}\+\?\\])/g,j=c.colModel.unformat||b.fn.fmatter[g]&&b.fn.fmatter[g].unformat;if(typeof j!=="undefined"&&b.isFunction(j))f=j(b(a).text(),c,a);else if(!b.fmatter.isUndefined(g)&&b.fmatter.isString(g)){f=b.jgrid.formatter||{};switch(g){case"integer":h=b.extend({},f.integer,h);c=h.thousandsSeparator.replace(i,"\\$1");f=b(a).text().replace(RegExp(c,"g"),"");break;case"number":h=b.extend({},f.number,h);c=h.thousandsSeparator.replace(i,"\\$1");f=b(a).text().replace(RegExp(c,"g"),"").replace(h.decimalSeparator,".");break;case"currency":h=b.extend({},f.currency,h);c=h.thousandsSeparator.replace(i,"\\$1");f=b(a).text().replace(RegExp(c,"g"),"").replace(h.decimalSeparator,".").replace(h.prefix,"").replace(h.suffix,"");break;case"checkbox":h=c.colModel.editoptions?c.colModel.editoptions.value.split(":"):["Yes","No"];f=b("input",a).attr("checked")?h[0]:h[1];break;case"select":f=b.unformat.select(a,c,d,e);break;case"actions":return"";default:f=b(a).text()}}return f?f:e===true?b(a).text():b.jgrid.htmlDecode(b(a).html())};b.unformat.select=function(a,c,d,e){d=[];a=b(a).text();if(e===true)return a;c=b.extend({},c.colModel.editoptions);if(c.value){var f=c.value;c=c.multiple===true?true:false;e=[];var g;if(c){e=a.split(",");e=b.map(e,function(k){return b.trim(k)})}if(b.fmatter.isString(f))for(var h=f.split(";"),i=0,j=0;j<h.length;j++){g=h[j].split(":");if(g.length>2)g[1]=jQuery.map(g,function(k,l){if(l>0)return k}).join(":");if(c){if(jQuery.inArray(g[1],e)>-1){d[i]=g[0];i++}}else if(b.trim(g[1])==b.trim(a)){d[0]=g[0];break}}else if(b.fmatter.isObject(f)||b.isArray(f)){c||(e[0]=a);d=jQuery.map(e,function(k){var l;b.each(f,function(o,n){if(n==k){l=o;return false}});if(typeof l!="undefined")return l})}return d.join(", ")}else return a||""};b.unformat.date=function(a,c){var d=b.jgrid.formatter.date||{};b.fmatter.isUndefined(c.formatoptions)||(d=b.extend({},d,c.formatoptions));return b.fmatter.isEmpty(a)?b.fn.fmatter.defaultFormat(a,c):b.fmatter.util.DateFormat(d.newformat,a,d.srcformat,d)}})(jQuery);(function(a){a.jgrid.extend({getColProp:function(c){var h={},b=this[0];if(!b.grid)return false;b=b.p.colModel;for(var i=0;i<b.length;i++)if(b[i].name==c){h=b[i];break}return h},setColProp:function(c,h){return this.each(function(){if(this.grid)if(h)for(var b=this.p.colModel,i=0;i<b.length;i++)if(b[i].name==c){a.extend(this.p.colModel[i],h);break}})},sortGrid:function(c,h,b){return this.each(function(){var i=-1;if(this.grid){if(!c)c=this.p.sortname;for(var o=0;o<this.p.colModel.length;o++)if(this.p.colModel[o].index==c||this.p.colModel[o].name==c){i=o;break}if(i!=-1){o=this.p.colModel[i].sortable;if(typeof o!=="boolean")o=true;if(typeof h!=="boolean")h=false;o&&this.sortData("jqgh_"+c,i,h,b)}}})},GridDestroy:function(){return this.each(function(){if(this.grid){this.p.pager&&a(this.p.pager).remove();var c=this.id;try{a("#gbox_"+c).remove()}catch(h){}}})},GridUnload:function(){return this.each(function(){if(this.grid){var c={id:a(this).attr("id"),cl:a(this).attr("class")};this.p.pager&&a(this.p.pager).empty().removeClass("ui-state-default ui-jqgrid-pager corner-bottom");var h=document.createElement("table");a(h).attr({id:c.id});h.className=c.cl;c=this.id;a(h).removeClass("ui-jqgrid-btable");if(a(this.p.pager).parents("#gbox_"+c).length===1){a(h).insertBefore("#gbox_"+c).show();a(this.p.pager).insertBefore("#gbox_"+c)}else a(h).insertBefore("#gbox_"+c).show();a("#gbox_"+c).remove()}})},setGridState:function(c){return this.each(function(){if(this.grid)if(c=="hidden"){a(".ui-jqgrid-bdiv, .ui-jqgrid-hdiv","#gview_"+this.p.id).slideUp("fast");this.p.pager&&a(this.p.pager).slideUp("fast");this.p.toppager&&a(this.p.toppager).slideUp("fast");if(this.p.toolbar[0]===true){this.p.toolbar[1]=="both"&&a(this.grid.ubDiv).slideUp("fast");a(this.grid.uDiv).slideUp("fast")}this.p.footerrow&&a(".ui-jqgrid-sdiv","#gbox_"+this.p.id).slideUp("fast");a(".ui-jqgrid-titlebar-close span",this.grid.cDiv).removeClass("ui-icon-circle-triangle-n").addClass("ui-icon-circle-triangle-s");this.p.gridstate="hidden"}else if(c=="visible"){a(".ui-jqgrid-hdiv, .ui-jqgrid-bdiv","#gview_"+this.p.id).slideDown("fast");this.p.pager&&a(this.p.pager).slideDown("fast");this.p.toppager&&a(this.p.toppager).slideDown("fast");if(this.p.toolbar[0]===true){this.p.toolbar[1]=="both"&&a(this.grid.ubDiv).slideDown("fast");a(this.grid.uDiv).slideDown("fast")}this.p.footerrow&&a(".ui-jqgrid-sdiv","#gbox_"+this.p.id).slideDown("fast");a(".ui-jqgrid-titlebar-close span",this.grid.cDiv).removeClass("ui-icon-circle-triangle-s").addClass("ui-icon-circle-triangle-n");this.p.gridstate="visible"}})},filterToolbar:function(c){c=a.extend({autosearch:true,searchOnEnter:true,beforeSearch:null,afterSearch:null,beforeClear:null,afterClear:null,searchurl:"",stringResult:false,groupOp:"AND",defaultSearch:"bw"},c||{});return this.each(function(){function h(e,f){var j=a(e);j[0]&&jQuery.each(f,function(){this.data!==undefined?j.bind(this.type,this.data,this.fn):j.bind(this.type,this.fn)})}var b=this;if(!this.ftoolbar){var i=function(){var e={},f=0,j,d,g={},k;a.each(b.p.colModel,function(){d=this.index||this.name;switch(this.stype){case"select":k=this.searchoptions&&this.searchoptions.sopt?this.searchoptions.sopt[0]:"eq";if(j=a("#gs_"+a.jgrid.jqID(d),b.grid.hDiv).val()){e[d]=j;g[d]=k;f++}else try{delete b.p.postData[d]}catch(p){}break;case"text":k=this.searchoptions&&this.searchoptions.sopt?this.searchoptions.sopt[0]:c.defaultSearch;if(j=a("#gs_"+a.jgrid.jqID(d),b.grid.hDiv).val()){e[d]=j;g[d]=k;f++}else try{delete b.p.postData[d]}catch(s){}}});var n=f>0?true:false;if(c.stringResult===true||b.p.datatype=="local"){var m='{"groupOp":"'+c.groupOp+'","rules":[',q=0;a.each(e,function(p,s){if(q>0)m+=",";m+='{"field":"'+p+'",';m+='"op":"'+g[p]+'",';s+="";m+='"data":"'+s.replace(/\\/g,"\\\\").replace(/\"/g,'\\"')+'"}';q++});m+="]}";a.extend(b.p.postData,{filters:m});a.each(["searchField","searchString","searchOper"],function(p,s){b.p.postData.hasOwnProperty(s)&&delete b.p.postData[s]})}else a.extend(b.p.postData,e);var l;if(b.p.searchurl){l=b.p.url;a(b).jqGrid("setGridParam",{url:b.p.searchurl})}var r=false;if(a.isFunction(c.beforeSearch))r=c.beforeSearch.call(b);r||a(b).jqGrid("setGridParam",{search:n}).trigger("reloadGrid",[{page:1}]);l&&a(b).jqGrid("setGridParam",{url:l});a.isFunction(c.afterSearch)&&c.afterSearch()},o=a("<tr class='ui-search-toolbar' role='rowheader'></tr>"),t;a.each(b.p.colModel,function(){var e=this,f,j,d,g;j=a("<th role='columnheader' class='ui-state-default ui-th-column ui-th-"+b.p.direction+"'></th>");f=a("<div style='width:100%;position:relative;height:100%;padding-right:0.3em;'></div>");this.hidden===true&&a(j).css("display","none");this.search=this.search===false?false:true;if(typeof this.stype=="undefined")this.stype="text";d=a.extend({},this.searchoptions||{});if(this.search)switch(this.stype){case"select":if(g=this.surl||d.dataUrl)a.ajax(a.extend({url:g,dataType:"html",complete:function(l){if(d.buildSelect!==undefined)(l=d.buildSelect(l))&&a(f).append(l);else a(f).append(l.responseText);d.defaultValue&&a("select",f).val(d.defaultValue);a("select",f).attr({name:e.index||e.name,id:"gs_"+e.name});d.attr&&a("select",f).attr(d.attr);a("select",f).css({width:"100%"});d.dataInit!==undefined&&d.dataInit(a("select",f)[0]);d.dataEvents!==undefined&&h(a("select",f)[0],d.dataEvents);c.autosearch===true&&a("select",f).change(function(){i();return false});l=null}},a.jgrid.ajaxOptions,b.p.ajaxSelectOptions||{}));else{var k;if(e.searchoptions&&e.searchoptions.value)k=e.searchoptions.value;else if(e.editoptions&&e.editoptions.value)k=e.editoptions.value;if(k){g=document.createElement("select");g.style.width="100%";a(g).attr({name:e.index||e.name,id:"gs_"+e.name});var n,m;if(typeof k==="string"){k=k.split(";");for(var q=0;q<k.length;q++){n=k[q].split(":");m=document.createElement("option");m.value=n[0];m.innerHTML=n[1];g.appendChild(m)}}else if(typeof k==="object")for(n in k)if(k.hasOwnProperty(n)){m=document.createElement("option");m.value=n;m.innerHTML=k[n];g.appendChild(m)}d.defaultValue&&a(g).val(d.defaultValue);d.attr&&a(g).attr(d.attr);d.dataInit!==undefined&&d.dataInit(g);d.dataEvents!==undefined&&h(g,d.dataEvents);a(f).append(g);c.autosearch===true&&a(g).change(function(){i();return false})}}break;case"text":g=d.defaultValue?d.defaultValue:"";a(f).append("<input type='text' style='width:95%;padding:0px;' name='"+(e.index||e.name)+"' id='gs_"+e.name+"' value='"+g+"'/>");d.attr&&a("input",f).attr(d.attr);d.dataInit!==undefined&&d.dataInit(a("input",f)[0]);d.dataEvents!==undefined&&h(a("input",f)[0],d.dataEvents);if(c.autosearch===true)c.searchOnEnter?a("input",f).keypress(function(l){if((l.charCode?l.charCode:l.keyCode?l.keyCode:0)==13){i();return false}return this}):a("input",f).keydown(function(l){switch(l.which){case 13:return false;case 9:case 16:case 37:case 38:case 39:case 40:case 27:break;default:t&&clearTimeout(t);t=setTimeout(function(){i()},500)}})}a(j).append(f);a(o).append(j)});a("table thead",b.grid.hDiv).append(o);this.ftoolbar=true;this.triggerToolbar=i;this.clearToolbar=function(e){var f={},j,d=0,g;e=typeof e!="boolean"?true:e;a.each(b.p.colModel,function(){j=this.searchoptions&&this.searchoptions.defaultValue?this.searchoptions.defaultValue:"";g=this.index||this.name;switch(this.stype){case"select":var r;a("#gs_"+a.jgrid.jqID(g)+" option",b.grid.hDiv).each(function(u){if(u===0)this.selected=true;if(a(this).text()==j){this.selected=true;r=a(this).val();return false}});if(r){f[g]=r;d++}else try{delete b.p.postData[g]}catch(p){}break;case"text":a("#gs_"+a.jgrid.jqID(g),b.grid.hDiv).val(j);if(j){f[g]=j;d++}else try{delete b.p.postData[g]}catch(s){}}});var k=d>0?true:false;if(c.stringResult===true||b.p.datatype=="local"){var n='{"groupOp":"'+c.groupOp+'","rules":[',m=0;a.each(f,function(r,p){if(m>0)n+=",";n+='{"field":"'+r+'",';n+='"op":"eq",';p+="";n+='"data":"'+p.replace(/\\/g,"\\\\").replace(/\"/g,'\\"')+'"}';m++});n+="]}";a.extend(b.p.postData,{filters:n});a.each(["searchField","searchString","searchOper"],function(r,p){b.p.postData.hasOwnProperty(p)&&delete b.p.postData[p]})}else a.extend(b.p.postData,f);var q;if(b.p.searchurl){q=b.p.url;a(b).jqGrid("setGridParam",{url:b.p.searchurl})}var l=false;if(a.isFunction(c.beforeClear))l=c.beforeClear.call(b);l||e&&a(b).jqGrid("setGridParam",{search:k}).trigger("reloadGrid",[{page:1}]);q&&a(b).jqGrid("setGridParam",{url:q});a.isFunction(c.afterClear)&&c.afterClear()};this.toggleToolbar=function(){var e=a("tr.ui-search-toolbar",b.grid.hDiv);e.css("display")=="none"?e.show():e.hide()}}})}})})(jQuery);(function(a){a.extend(a.jgrid,{showModal:function(b){b.w.show()},closeModal:function(b){b.w.hide().attr("aria-hidden","true");b.o&&b.o.remove()},hideModal:function(b,c){c=a.extend({jqm:true,gb:""},c||{});if(c.onClose){var d=c.onClose(b);if(typeof d=="boolean"&&!d)return}if(a.fn.jqm&&c.jqm===true)a(b).attr("aria-hidden","true").jqmHide();else{if(c.gb!=="")try{a(".jqgrid-overlay:first",c.gb).hide()}catch(f){}a(b).hide().attr("aria-hidden","true")}},findPos:function(b){var c=0,d=0;if(b.offsetParent){do{c+=b.offsetLeft;d+=b.offsetTop}while(b=b.offsetParent)}return[c,d]},createModal:function(b,c,d,f,g,h,j){var e=document.createElement("div"),k,m=this;j=a.extend({},j||{});k=a(d.gbox).attr("dir")=="rtl"?true:false;e.className="ui-widget ui-widget-content ui-corner-all ui-jqdialog";e.id=b.themodal;var i=document.createElement("div");i.className="ui-jqdialog-titlebar ui-widget-header ui-corner-all ui-helper-clearfix";i.id=b.modalhead;a(i).append("<span class='ui-jqdialog-title'>"+d.caption+"</span>");var q=a("<a href='javascript:void(0)' class='ui-jqdialog-titlebar-close ui-corner-all'></a>").hover(function(){q.addClass("ui-state-hover")},function(){q.removeClass("ui-state-hover")}).append("<span class='ui-icon ui-icon-closethick'></span>");a(i).append(q);if(k){e.dir="rtl";a(".ui-jqdialog-title",i).css("float","right");a(".ui-jqdialog-titlebar-close",i).css("left","0.3em")}else{e.dir="ltr";a(".ui-jqdialog-title",i).css("float","left");a(".ui-jqdialog-titlebar-close",i).css("right","0.3em")}var l=document.createElement("div");a(l).addClass("ui-jqdialog-content ui-widget-content").attr("id",b.modalcontent);a(l).append(c);e.appendChild(l);a(e).prepend(i);if(h===true)a("body").append(e);else typeof h=="string"?a(h).append(e):a(e).insertBefore(f);a(e).css(j);if(typeof d.jqModal==="undefined")d.jqModal=true;c={};if(a.fn.jqm&&d.jqModal===true){if(d.left===0&&d.top===0&&d.overlay){j=[];j=this.findPos(g);d.left=j[0]+4;d.top=j[1]+4}c.top=d.top+"px";c.left=d.left}else if(d.left!==0||d.top!==0){c.left=d.left;c.top=d.top+"px"}a("a.ui-jqdialog-titlebar-close",i).click(function(){var p=a("#"+b.themodal).data("onClose")||d.onClose,o=a("#"+b.themodal).data("gbox")||d.gbox;m.hideModal("#"+b.themodal,{gb:o,jqm:d.jqModal,onClose:p});return false});if(d.width===0||!d.width)d.width=300;if(d.height===0||!d.height)d.height=200;if(!d.zIndex){f=a(f).parents("*[role=dialog]").filter(":first").css("z-index");d.zIndex=f?parseInt(f,10)+1:950}f=0;if(k&&c.left&&!h){f=a(d.gbox).width()-(!isNaN(d.width)?parseInt(d.width,10):0)-8;c.left=parseInt(c.left,10)+parseInt(f,10)}if(c.left)c.left+="px";a(e).css(a.extend({width:isNaN(d.width)?"auto":d.width+"px",height:isNaN(d.height)?"auto":d.height+"px",zIndex:d.zIndex,overflow:"hidden"},c)).attr({tabIndex:"-1",role:"dialog","aria-labelledby":b.modalhead,"aria-hidden":"true"});if(typeof d.drag=="undefined")d.drag=true;if(typeof d.resize=="undefined")d.resize=true;if(d.drag){a(i).css("cursor","move");if(a.fn.jqDrag)a(e).jqDrag(i);else try{a(e).draggable({handle:a("#"+i.id)})}catch(n){}}if(d.resize)if(a.fn.jqResize){a(e).append("<div class='jqResize ui-resizable-handle ui-resizable-se ui-icon ui-icon-gripsmall-diagonal-se ui-icon-grip-diagonal-se'></div>");a("#"+b.themodal).jqResize(".jqResize",b.scrollelm?"#"+b.scrollelm:false)}else try{a(e).resizable({handles:"se, sw",alsoResize:b.scrollelm?"#"+b.scrollelm:false})}catch(r){}d.closeOnEscape===true&&a(e).keydown(function(p){if(p.which==27){p=a("#"+b.themodal).data("onClose")||d.onClose;m.hideModal(this,{gb:d.gbox,jqm:d.jqModal,onClose:p})}})},viewModal:function(b,c){c=a.extend({toTop:true,overlay:10,modal:false,onShow:this.showModal,onHide:this.closeModal,gbox:"",jqm:true,jqM:true},c||{});if(a.fn.jqm&&c.jqm===true)c.jqM?a(b).attr("aria-hidden","false").jqm(c).jqmShow():a(b).attr("aria-hidden","false").jqmShow();else{if(c.gbox!==""){a(".jqgrid-overlay:first",c.gbox).show();a(b).data("gbox",c.gbox)}a(b).show().attr("aria-hidden","false");try{a(":input:visible",b)[0].focus()}catch(d){}}},info_dialog:function(b,c,d,f){var g={width:290,height:"auto",dataheight:"auto",drag:true,resize:false,caption:"<b>"+b+"</b>",left:250,top:170,zIndex:1E3,jqModal:true,modal:false,closeOnEscape:true,align:"center",buttonalign:"center",buttons:[]};a.extend(g,f||{});var h=g.jqModal,j=this;if(a.fn.jqm&&!h)h=false;b="";if(g.buttons.length>0)for(f=0;f<g.buttons.length;f++){if(typeof g.buttons[f].id=="undefined")g.buttons[f].id="info_button_"+f;b+="<a href='javascript:void(0)' id='"+g.buttons[f].id+"' class='fm-button ui-state-default ui-corner-all'>"+g.buttons[f].text+"</a>"}f=isNaN(g.dataheight)?g.dataheight:g.dataheight+"px";var e="<div id='info_id'>";e+="<div id='infocnt' style='margin:0px;padding-bottom:1em;width:100%;overflow:auto;position:relative;height:"+
f+";"+("text-align:"+g.align+";")+"'>"+c+"</div>";e+=d?"<div class='ui-widget-content ui-helper-clearfix' style='text-align:"+g.buttonalign+";padding-bottom:0.8em;padding-top:0.5em;background-image: none;border-width: 1px 0 0 0;'><a href='javascript:void(0)' id='closedialog' class='fm-button ui-state-default ui-corner-all'>"+d+"</a>"+b+"</div>":b!==""?"<div class='ui-widget-content ui-helper-clearfix' style='text-align:"+g.buttonalign+";padding-bottom:0.8em;padding-top:0.5em;background-image: none;border-width: 1px 0 0 0;'>"+
b+"</div>":"";e+="</div>";try{a("#info_dialog").attr("aria-hidden")=="false"&&this.hideModal("#info_dialog",{jqm:h});a("#info_dialog").remove()}catch(k){}this.createModal({themodal:"info_dialog",modalhead:"info_head",modalcontent:"info_content",scrollelm:"infocnt"},e,g,"","",true);b&&a.each(g.buttons,function(i){a("#"+this.id,"#info_id").bind("click",function(){g.buttons[i].onClick.call(a("#info_dialog"));return false})});a("#closedialog","#info_id").click(function(){j.hideModal("#info_dialog",{jqm:h});return false});a(".fm-button","#info_dialog").hover(function(){a(this).addClass("ui-state-hover")},function(){a(this).removeClass("ui-state-hover")});a.isFunction(g.beforeOpen)&&g.beforeOpen();this.viewModal("#info_dialog",{onHide:function(i){i.w.hide().remove();i.o&&i.o.remove()},modal:g.modal,jqm:h});a.isFunction(g.afterOpen)&&g.afterOpen();try{a("#info_dialog").focus()}catch(m){}},createEl:function(b,c,d,f,g){function h(l,n){a.isFunction(n.dataInit)&&n.dataInit(l);n.dataEvents&&a.each(n.dataEvents,function(){this.data!==undefined?a(l).bind(this.type,this.data,this.fn):a(l).bind(this.type,this.fn)});return n}function j(l,n){var r=["dataInit","dataEvents","dataUrl","buildSelect","sopt","searchhidden","defaultValue","attr"];a.each(n,function(p,o){a.inArray(p,r)===-1&&a(l).attr(p,o)});n.hasOwnProperty("id")||a(l).attr("id",a.jgrid.randId())}var e="";switch(b){case"textarea":e=document.createElement("textarea");if(f)c.cols||a(e).css({width:"98%"});else if(!c.cols)c.cols=20;if(!c.rows)c.rows=2;if(d=="&nbsp;"||d=="&#160;"||d.length==1&&d.charCodeAt(0)==160)d="";e.value=d;j(e,c);c=h(e,c);a(e).attr({role:"textbox",multiline:"true"});break;case"checkbox":e=document.createElement("input");e.type="checkbox";if(c.value){b=c.value.split(":");if(d===b[0]){e.checked=true;e.defaultChecked=true}e.value=b[0];a(e).attr("offval",b[1])}else{b=d.toLowerCase();if(b.search(/(false|0|no|off|undefined)/i)<0&&b!==""){e.checked=true;e.defaultChecked=true;e.value=d}else e.value="on";a(e).attr("offval","off")}j(e,c);c=h(e,c);a(e).attr("role","checkbox");break;case"select":e=document.createElement("select");e.setAttribute("role","select");f=[];if(c.multiple===true){b=true;e.multiple="multiple";a(e).attr("aria-multiselectable","true")}else b=false;if(typeof c.dataUrl!="undefined")a.ajax(a.extend({url:c.dataUrl,type:"GET",dataType:"html",context:{elem:e,options:c,vl:d},success:function(l){var n=[],r=this.elem,p=this.vl,o=a.extend({},this.options),s=o.multiple===true;if(typeof o.buildSelect!="undefined")l=o.buildSelect(l);if(l=a(l).html()){a(r).append(l);j(r,o);o=h(r,o);if(typeof o.size==="undefined")o.size=s?3:1;if(s){n=p.split(",");n=a.map(n,function(t){return a.trim(t)})}else n[0]=a.trim(p);setTimeout(function(){a("option",r).each(function(){a(this).attr("role","option");if(a.inArray(a.trim(a(this).text()),n)>-1||a.inArray(a.trim(a(this).val()),n)>-1)this.selected="selected"})},0)}}},g||{}));else if(c.value){var k;if(b){f=d.split(",");f=a.map(f,function(l){return a.trim(l)});if(typeof c.size==="undefined")c.size=3}else c.size=1;if(typeof c.value==="function")c.value=c.value();var m,i;if(typeof c.value==="string"){m=c.value.split(";");for(k=0;k<m.length;k++){i=m[k].split(":");if(i.length>2)i[1]=a.map(i,function(l,n){if(n>0)return l}).join(":");g=document.createElement("option");g.setAttribute("role","option");g.value=i[0];g.innerHTML=i[1];if(!b&&(a.trim(i[0])==a.trim(d)||a.trim(i[1])==a.trim(d)))g.selected="selected";if(b&&(a.inArray(a.trim(i[1]),f)>-1||a.inArray(a.trim(i[0]),f)>-1))g.selected="selected";e.appendChild(g)}}else if(typeof c.value==="object"){m=c.value;for(k in m)if(m.hasOwnProperty(k)){g=document.createElement("option");g.setAttribute("role","option");g.value=k;g.innerHTML=m[k];if(!b&&(a.trim(k)==a.trim(d)||a.trim(m[k])==a.trim(d)))g.selected="selected";if(b&&(a.inArray(a.trim(m[k]),f)>-1||a.inArray(a.trim(k),f)>-1))g.selected="selected";e.appendChild(g)}}j(e,c);c=h(e,c)}break;case"text":case"password":case"button":k=b=="button"?"button":"textbox";e=document.createElement("input");e.type=b;e.value=d;j(e,c);c=h(e,c);if(b!="button")if(f)c.size||a(e).css({width:"98%"});else if(!c.size)c.size=20;a(e).attr("role",k);break;case"image":case"file":e=document.createElement("input");e.type=b;j(e,c);c=h(e,c);break;case"custom":e=document.createElement("span");try{if(a.isFunction(c.custom_element))if(m=c.custom_element.call(this,d,c)){m=a(m).addClass("customelement").attr({id:c.id,name:c.name});a(e).empty().append(m)}else throw"e2";else throw"e1";}catch(q){q=="e1"&&this.info_dialog(a.jgrid.errors.errcap,"function 'custom_element' "+a.jgrid.edit.msg.nodefined,a.jgrid.edit.bClose);q=="e2"?this.info_dialog(a.jgrid.errors.errcap,"function 'custom_element' "+a.jgrid.edit.msg.novalue,a.jgrid.edit.bClose):this.info_dialog(a.jgrid.errors.errcap,typeof q==="string"?q:q.message,a.jgrid.edit.bClose)}}return e},checkDate:function(b,c){var d={},f;b=b.toLowerCase();f=b.indexOf("/")!=-1?"/":b.indexOf("-")!=-1?"-":b.indexOf(".")!=-1?".":"/";b=b.split(f);c=c.split(f);if(c.length!=3)return false;f=-1;for(var g,h=-1,j=-1,e=0;e<b.length;e++){g=isNaN(c[e])?0:parseInt(c[e],10);d[b[e]]=g;g=b[e];if(g.indexOf("y")!=-1)f=e;if(g.indexOf("m")!=-1)j=e;if(g.indexOf("d")!=-1)h=e}g=b[f]=="y"||b[f]=="yyyy"?4:b[f]=="yy"?2:-1;e=function(m){for(var i=1;i<=m;i++){this[i]=31;if(i==4||i==6||i==9||i==11)this[i]=30;if(i==2)this[i]=29}return this}(12);var k;if(f===-1)return false;else{k=d[b[f]].toString();if(g==2&&k.length==1)g=1;if(k.length!=g||d[b[f]]===0&&c[f]!="00")return false}if(j===-1)return false;else{k=d[b[j]].toString();if(k.length<1||d[b[j]]<1||d[b[j]]>12)return false}if(h===-1)return false;else{k=d[b[h]].toString();if(k.length<1||d[b[h]]<1||d[b[h]]>31||d[b[j]]==2&&d[b[h]]>(d[b[f]]%4===0&&(d[b[f]]%100!==0||d[b[f]]%400===0)?29:28)||d[b[h]]>e[d[b[j]]])return false}return true},isEmpty:function(b){return b.match(/^\s+$/)||b===""?true:false},checkTime:function(b){var c=/^(\d{1,2}):(\d{2})([ap]m)?$/;if(!this.isEmpty(b))if(b=b.match(c)){if(b[3]){if(b[1]<1||b[1]>12)return false}else if(b[1]>23)return false;if(b[2]>59)return false}else return false;return true},checkValues:function(b,c,d,f,g){var h,j;if(typeof f==="undefined")if(typeof c=="string"){f=0;for(g=d.p.colModel.length;f<g;f++)if(d.p.colModel[f].name==c){h=d.p.colModel[f].editrules;c=f;try{j=d.p.colModel[f].formoptions.label}catch(e){}break}}else{if(c>=0)h=d.p.colModel[c].editrules}else{h=f;j=g===undefined?"_":g}if(h){j||(j=d.p.colNames[c]);if(h.required===true)if(this.isEmpty(b))return[false,j+": "+a.jgrid.edit.msg.required,""];f=h.required===false?false:true;if(h.number===true)if(!(f===false&&this.isEmpty(b)))if(isNaN(b))return[false,j+": "+a.jgrid.edit.msg.number,""];if(typeof h.minValue!="undefined"&&!isNaN(h.minValue))if(parseFloat(b)<parseFloat(h.minValue))return[false,j+": "+a.jgrid.edit.msg.minValue+" "+h.minValue,""];if(typeof h.maxValue!="undefined"&&!isNaN(h.maxValue))if(parseFloat(b)>parseFloat(h.maxValue))return[false,j+": "+a.jgrid.edit.msg.maxValue+" "+h.maxValue,""];if(h.email===true)if(!(f===false&&this.isEmpty(b))){g=/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?$/i;if(!g.test(b))return[false,j+": "+a.jgrid.edit.msg.email,""]}if(h.integer===true)if(!(f===false&&this.isEmpty(b))){if(isNaN(b))return[false,j+": "+a.jgrid.edit.msg.integer,""];if(b%1!==0||b.indexOf(".")!=-1)return[false,j+": "+a.jgrid.edit.msg.integer,""]}if(h.date===true)if(!(f===false&&this.isEmpty(b))){c=d.p.colModel[c].formatoptions&&d.p.colModel[c].formatoptions.newformat?d.p.colModel[c].formatoptions.newformat:d.p.colModel[c].datefmt||"Y-m-d";if(!this.checkDate(c,b))return[false,j+": "+a.jgrid.edit.msg.date+" - "+c,""]}if(h.time===true)if(!(f===false&&this.isEmpty(b)))if(!this.checkTime(b))return[false,j+": "+a.jgrid.edit.msg.date+" - hh:mm (am/pm)",""];if(h.url===true)if(!(f===false&&this.isEmpty(b))){g=/^(((https?)|(ftp)):\/\/([\-\w]+\.)+\w{2,3}(\/[%\-\w]+(\.\w{2,})?)*(([\w\-\.\?\\\/+@&#;`~=%!]*)(\.\w{2,})?)*\/?)/i;if(!g.test(b))return[false,j+": "+a.jgrid.edit.msg.url,""]}if(h.custom===true)if(!(f===false&&this.isEmpty(b)))if(a.isFunction(h.custom_func)){b=h.custom_func.call(d,b,j);return a.isArray(b)?b:[false,a.jgrid.edit.msg.customarray,""]}else return[false,a.jgrid.edit.msg.customfcheck,""]}return[true,"",""]}})})(jQuery);(function(a){var c=null;a.jgrid.extend({searchGrid:function(d){d=a.extend({recreateFilter:false,drag:true,sField:"searchField",sValue:"searchString",sOper:"searchOper",sFilter:"filters",loadDefaults:true,beforeShowSearch:null,afterShowSearch:null,onInitializeSearch:null,closeAfterSearch:false,closeAfterReset:false,closeOnEscape:false,multipleSearch:false,multipleGroup:false,top:0,left:0,jqModal:true,modal:false,resize:false,width:450,height:"auto",dataheight:"auto",showQuery:false,errorcheck:true,sopt:null,stringResult:undefined,onClose:null,onSearch:null,onReset:null,toTop:true,overlay:10,columns:[],tmplNames:null,tmplFilters:null,tmplLabel:" Template: ",showOnLoad:false,layer:null},a.jgrid.search,d||{});return this.each(function(){function b(){if(a.isFunction(d.beforeShowSearch)){C=d.beforeShowSearch(a("#"+q));if(typeof C==="undefined")C=true}if(C){a.jgrid.viewModal("#"+z.themodal,{gbox:"#gbox_"+q,jqm:d.jqModal,modal:d.modal,overlay:d.overlay,toTop:d.toTop});a.isFunction(d.afterShowSearch)&&d.afterShowSearch(a("#"+q))}}var l=this;if(l.grid){var q="fbox_"+l.p.id,C=true,z={themodal:"searchmod"+q,modalhead:"searchhd"+q,modalcontent:"searchcnt"+q,scrollelm:q},D=l.p.postData[d.sFilter];if(typeof D==="string")D=a.jgrid.parse(D);d.recreateFilter===true&&a("#"+z.themodal).remove();if(a("#"+z.themodal).html()!==null)b();else{var w=a("<span><div id='"+q+"' class='searchFilter' style='overflow:auto'></div></span>").insertBefore("#gview_"+l.p.id);if(a.isFunction(d.onInitializeSearch))d.onInitializeSearch(a("#"+
q));var n=a.extend([],l.p.colModel),s="<a href='javascript:void(0)' id='"+q+"_search' class='fm-button ui-state-default ui-corner-all fm-button-icon-right ui-reset'><span class='ui-icon ui-icon-search'></span>"+d.Find+"</a>",t="<a href='javascript:void(0)' id='"+q+"_reset' class='fm-button ui-state-default ui-corner-all fm-button-icon-left ui-search'><span class='ui-icon ui-icon-arrowreturnthick-1-w'></span>"+d.Reset+"</a>",p="",e="",u,o=false;if(d.showQuery)p="<a href='javascript:void(0)' id='"+
q+"_query' class='fm-button ui-state-default ui-corner-all fm-button-icon-left'><span class='ui-icon ui-icon-comment'></span>Query</a>";if(d.columns.length)n=d.columns;else a.each(n,function(f,j){if(!j.label)j.label=l.p.colNames[f];if(!o){var G=typeof j.search==="undefined"?true:j.search,L=j.hidden===true;if(j.searchoptions&&j.searchoptions.searchhidden===true&&G||G&&!L){o=true;u=j.index||j.name}}});if(!D&&u||d.multipleSearch===false)D={groupOp:"AND",rules:[{field:u,op:"eq",data:""}]};o=false;if(d.tmplNames&&d.tmplNames.length){o=true;e=d.tmplLabel;e+="<select class='ui-template'>";e+="<option value='default'>Default</option>";a.each(d.tmplNames,function(f,j){e+="<option value='"+f+"'>"+j+"</option>"});e+="</select>"}s="<table class='EditTable' style='border:0px none;margin-top:5px' id='"+q+"_2'><tbody><tr><td colspan='2'><hr class='ui-widget-content' style='margin:1px'/></td></tr><tr><td class='EditButton' style='text-align:left'>"+t+e+"</td><td class='EditButton'>"+p+s+"</td></tr></tbody></table>";a("#"+q).jqFilter({columns:n,filter:d.loadDefaults?D:null,showQuery:d.showQuery,errorcheck:d.errorcheck,sopt:d.sopt,groupButton:d.multipleGroup,_gridsopt:a.jgrid.search.odata,onChange:function(){this.p.showQuery&&a(".query",this).html(this.toUserFriendlyString())}});w.append(s);o&&d.tmplFilters&&d.tmplFilters.length&&a(".ui-template",w).bind("change",function(){var f=a(this).val();f=="default"?a("#"+q).jqFilter("addFilter",D):a("#"+q).jqFilter("addFilter",d.tmplFilters[parseInt(f,10)]);return false});if(d.multipleSearch===false){a(".add-rule","#"+q).hide();a(".delete-rule","#"+q).hide()}if(a.isFunction(d.onInitializeSearch))d.onInitializeSearch(a("#"+q));d.layer?a.jgrid.createModal(z,w,d,"#gview_"+l.p.id,a("#gbox_"+l.p.id)[0],"#"+d.layer,{position:"relative"}):a.jgrid.createModal(z,w,d,"#gview_"+l.p.id,a("#gbox_"+l.p.id)[0]);p&&a("#"+q+"_query").bind("click",function(){a(".queryresult",w).toggle();return false});if(d.stringResult===undefined)d.stringResult=d.multipleSearch;a("#"+q+"_search").bind("click",function(){var f=a("#"+q),j={},G,L=f.jqFilter("filterData");if(d.errorcheck){f[0].hideError();d.showQuery||f.jqFilter("toSQLString");if(f[0].p.error){f[0].showError();return false}}if(d.stringResult){try{G=xmlJsonClass.toJson(L,"","",false)}catch(I){try{G=JSON.stringify(L)}catch(T){}}if(typeof G==="string"){j[d.sFilter]=G;a.each([d.sField,d.sValue,d.sOper],function(){j[this]=""})}}else if(d.multipleSearch){j[d.sFilter]=L;a.each([d.sField,d.sValue,d.sOper],function(){j[this]=""})}else{j[d.sField]=L.rules[0].field;j[d.sValue]=L.rules[0].data;j[d.sOper]=L.rules[0].op;j[d.sFilter]=""}l.p.search=true;a.extend(l.p.postData,j);if(a.isFunction(d.onSearch))d.onSearch();a(l).trigger("reloadGrid",[{page:1}]);d.closeAfterSearch&&a.jgrid.hideModal("#"+z.themodal,{gb:"#gbox_"+l.p.id,jqm:d.jqModal,onClose:d.onClose});return false});a("#"+q+"_reset").bind("click",function(){var f={},j=a("#"+q);l.p.search=false;if(d.multipleSearch===false)f[d.sField]=f[d.sValue]=f[d.sOper]="";else f[d.sFilter]="";j[0].resetFilter();o&&a(".ui-template",w).val("default");a.extend(l.p.postData,f);if(a.isFunction(d.onReset))d.onReset();a(l).trigger("reloadGrid",[{page:1}]);return false});b();a(".fm-button:not(.ui-state-disabled)",w).hover(function(){a(this).addClass("ui-state-hover")},function(){a(this).removeClass("ui-state-hover")})}}})},editGridRow:function(d,b){c=b=a.extend({top:0,left:0,width:300,height:"auto",dataheight:"auto",modal:false,overlay:10,drag:true,resize:true,url:null,mtype:"POST",clearAfterAdd:true,closeAfterEdit:false,reloadAfterSubmit:true,onInitializeForm:null,beforeInitData:null,beforeShowForm:null,afterShowForm:null,beforeSubmit:null,afterSubmit:null,onclickSubmit:null,afterComplete:null,onclickPgButtons:null,afterclickPgButtons:null,editData:{},recreateForm:false,jqModal:true,closeOnEscape:false,addedrow:"first",topinfo:"",bottominfo:"",saveicon:[],closeicon:[],savekey:[false,13],navkeys:[false,38,40],checkOnSubmit:false,checkOnUpdate:false,_savedData:{},processing:false,onClose:null,ajaxEditOptions:{},serializeEditData:null,viewPagerButtons:true},a.jgrid.edit,b||{});return this.each(function(){function l(){a(".FormElement","#"+f).each(function(){var g=a(".customelement",this);if(g.length){var k=a(g[0]).attr("name");a.each(e.p.colModel,function(){if(this.name===k&&this.editoptions&&a.isFunction(this.editoptions.custom_value)){try{h[k]=this.editoptions.custom_value(a("#"+a.jgrid.jqID(k),"#"+f),"get");if(h[k]===undefined)throw"e1";}catch(r){r==="e1"?a.jgrid.info_dialog(jQuery.jgrid.errors.errcap,"function 'custom_value' "+
a.jgrid.edit.msg.novalue,jQuery.jgrid.edit.bClose):a.jgrid.info_dialog(jQuery.jgrid.errors.errcap,r.message,jQuery.jgrid.edit.bClose)}return true}})}else{switch(a(this).get(0).type){case"checkbox":if(a(this).attr("checked"))h[this.name]=a(this).val();else{g=a(this).attr("offval");h[this.name]=g}break;case"select-one":h[this.name]=a("option:selected",this).val();P[this.name]=a("option:selected",this).text();break;case"select-multiple":h[this.name]=a(this).val();h[this.name]=h[this.name]?h[this.name].join(","):"";var v=[];a("option:selected",this).each(function(r,E){v[r]=a(E).text()});P[this.name]=v.join(",");break;case"password":case"text":case"textarea":case"button":h[this.name]=a(this).val()}if(e.p.autoencode)h[this.name]=a.jgrid.htmlEncode(h[this.name])}});return true}function q(g,k,v,r){var E,A,y,K=0,B,N,F,S=[],M=false,aa="",R;for(R=1;R<=r;R++)aa+="<td class='CaptionTD'>&#160;</td><td class='DataTD'>&#160;</td>";if(g!="_empty")M=a(k).jqGrid("getInd",g);a(k.p.colModel).each(function(U){E=this.name;N=(A=this.editrules&&this.editrules.edithidden===true?false:this.hidden===true?true:false)?"style='display:none'":"";if(E!=="cb"&&E!=="subgrid"&&this.editable===true&&E!=="rn"){if(M===false)B="";else if(E==k.p.ExpandColumn&&k.p.treeGrid===true)B=a("td:eq("+U+")",k.rows[M]).text();else try{B=a.unformat(a("td:eq("+U+")",k.rows[M]),{rowId:g,colModel:this},U)}catch(fa){B=a("td:eq("+U+")",k.rows[M]).text()}var Y=a.extend({},this.editoptions||{},{id:E,name:E}),Z=a.extend({},{elmprefix:"",elmsuffix:"",rowabove:false,rowcontent:""},this.formoptions||{}),ea=parseInt(Z.rowpos,10)||K+1,ga=parseInt((parseInt(Z.colpos,10)||1)*2,10);if(g=="_empty"&&Y.defaultValue)B=a.isFunction(Y.defaultValue)?Y.defaultValue():Y.defaultValue;if(!this.edittype)this.edittype="text";if(e.p.autoencode)B=a.jgrid.htmlDecode(B);F=a.jgrid.createEl(this.edittype,Y,B,false,a.extend({},a.jgrid.ajaxOptions,k.p.ajaxSelectOptions||{}));if(B===""&&this.edittype=="checkbox")B=a(F).attr("offval");if(B===""&&this.edittype=="select")B=a("option:eq(0)",F).text();if(c.checkOnSubmit||c.checkOnUpdate)c._savedData[E]=B;a(F).addClass("FormElement");if(this.edittype=="text"||this.edittype=="textarea")a(F).addClass("ui-widget-content ui-corner-all");y=a(v).find("tr[rowpos="+ea+"]");if(Z.rowabove){Y=a("<tr><td class='contentinfo' colspan='"+r*2+"'>"+Z.rowcontent+"</td></tr>");a(v).append(Y);Y[0].rp=ea}if(y.length===0){y=a("<tr "+N+" rowpos='"+ea+"'></tr>").addClass("FormData").attr("id","tr_"+E);a(y).append(aa);a(v).append(y);y[0].rp=ea}a("td:eq("+(ga-
2)+")",y[0]).html(typeof Z.label==="undefined"?k.p.colNames[U]:Z.label);a("td:eq("+(ga-1)+")",y[0]).append(Z.elmprefix).append(F).append(Z.elmsuffix);S[K]=U;K++}});if(K>0){R=a("<tr class='FormData' style='display:none'><td class='CaptionTD'></td><td colspan='"+(r*2-1)+"' class='DataTD'><input class='FormElement' id='id_g' type='text' name='"+k.p.id+"_id' value='"+g+"'/></td></tr>");R[0].rp=K+999;a(v).append(R);if(c.checkOnSubmit||c.checkOnUpdate)c._savedData[k.p.id+"_id"]=g}return S}function C(g,k,v){var r,E=0,A,y,K,B,N;if(c.checkOnSubmit||c.checkOnUpdate){c._savedData={};c._savedData[k.p.id+"_id"]=g}var F=k.p.colModel;if(g=="_empty"){a(F).each(function(){r=this.name;K=a.extend({},this.editoptions||{});if((y=a("#"+a.jgrid.jqID(r),"#"+v))&&y[0]!==null){B="";if(K.defaultValue){B=a.isFunction(K.defaultValue)?K.defaultValue():K.defaultValue;if(y[0].type=="checkbox"){N=B.toLowerCase();if(N.search(/(false|0|no|off|undefined)/i)<0&&N!==""){y[0].checked=true;y[0].defaultChecked=true;y[0].value=B}else y.attr({checked:"",defaultChecked:""})}else y.val(B)}else if(y[0].type=="checkbox"){y[0].checked=false;y[0].defaultChecked=false;B=a(y).attr("offval")}else if(y[0].type&&y[0].type.substr(0,6)=="select")y[0].selectedIndex=0;else y.val(B);if(c.checkOnSubmit===true||c.checkOnUpdate)c._savedData[r]=B}});a("#id_g","#"+v).val(g)}else{var S=a(k).jqGrid("getInd",g,true);if(S){a("td",S).each(function(M){r=F[M].name;if(r!=="cb"&&r!=="subgrid"&&r!=="rn"&&F[M].editable===true){if(r==k.p.ExpandColumn&&k.p.treeGrid===true)A=a(this).text();else try{A=a.unformat(a(this),{rowId:g,colModel:F[M]},M)}catch(aa){A=a(this).text()}if(e.p.autoencode)A=a.jgrid.htmlDecode(A);if(c.checkOnSubmit===true||c.checkOnUpdate)c._savedData[r]=A;r=a.jgrid.jqID(r);switch(F[M].edittype){case"password":case"text":case"button":case"image":a("#"+r,"#"+v).val(A);break;case"textarea":if(A=="&nbsp;"||A=="&#160;"||A.length==1&&A.charCodeAt(0)==160)A="";a("#"+r,"#"+v).val(A);break;case"select":var R=A.split(",");R=a.map(R,function(fa){return a.trim(fa)});a("#"+
r+" option","#"+v).each(function(){this.selected=!F[M].editoptions.multiple&&(R[0]==a.trim(a(this).text())||R[0]==a.trim(a(this).val()))?true:F[M].editoptions.multiple?a.inArray(a.trim(a(this).text()),R)>-1||a.inArray(a.trim(a(this).val()),R)>-1?true:false:false});break;case"checkbox":A+="";if(F[M].editoptions&&F[M].editoptions.value)if(F[M].editoptions.value.split(":")[0]==A){a("#"+r,"#"+v).attr("checked",true);a("#"+r,"#"+v).attr("defaultChecked",true)}else{a("#"+r,"#"+v).attr("checked",false);a("#"+r,"#"+v).attr("defaultChecked","")}else{A=A.toLowerCase();if(A.search(/(false|0|no|off|undefined)/i)<0&&A!==""){a("#"+r,"#"+v).attr("checked",true);a("#"+r,"#"+v).attr("defaultChecked",true)}else{a("#"+r,"#"+v).attr("checked",false);a("#"+r,"#"+v).attr("defaultChecked","")}}break;case"custom":try{if(F[M].editoptions&&a.isFunction(F[M].editoptions.custom_value))F[M].editoptions.custom_value(a("#"+r,"#"+v),"set",A);else throw"e1";}catch(U){U=="e1"?a.jgrid.info_dialog(jQuery.jgrid.errors.errcap,"function 'custom_value' "+a.jgrid.edit.msg.nodefined,jQuery.jgrid.edit.bClose):a.jgrid.info_dialog(jQuery.jgrid.errors.errcap,U.message,jQuery.jgrid.edit.bClose)}}E++}});E>0&&a("#id_g","#"+f).val(g)}}}function z(){var g,k=[true,"",""],v={},r=e.p.prmNames,E,A,y,K;if(a.isFunction(c.beforeCheckValues)){var B=c.beforeCheckValues(h,a("#"+o),h[e.p.id+"_id"]=="_empty"?r.addoper:r.editoper);if(B&&typeof B==="object")h=B}for(y in h)if(h.hasOwnProperty(y)){k=a.jgrid.checkValues(h[y],y,e);if(k[0]===false)break}if(k[0]){if(a.isFunction(c.onclickSubmit))v=c.onclickSubmit(c,h)||{};if(a.isFunction(c.beforeSubmit))k=c.beforeSubmit(h,a("#"+o))}if(k[0]&&!c.processing){c.processing=true;a("#sData","#"+f+"_2").addClass("ui-state-active");A=r.oper;E=r.id;h[A]=a.trim(h[e.p.id+"_id"])=="_empty"?r.addoper:r.editoper;if(h[A]!=r.addoper)h[E]=h[e.p.id+"_id"];else if(h[E]===undefined)h[E]=h[e.p.id+"_id"];delete h[e.p.id+"_id"];h=a.extend(h,c.editData,v);if(e.p.treeGrid===true){if(h[A]==r.addoper){K=a(e).jqGrid("getGridParam","selrow");h[e.p.treeGridModel=="adjacency"?e.p.treeReader.parent_id_field:"parent_id"]=K}for(i in e.p.treeReader){v=e.p.treeReader[i];if(h.hasOwnProperty(v))h[A]==r.addoper&&i==="parent_id_field"||delete h[v]}}v=a.extend({url:c.url?c.url:a(e).jqGrid("getGridParam","editurl"),type:c.mtype,data:a.isFunction(c.serializeEditData)?c.serializeEditData(h):h,complete:function(N,F){if(F!="success"){k[0]=false;k[1]=a.isFunction(c.errorTextFormat)?c.errorTextFormat(N):F+" Status: '"+N.statusText+"'. Error code: "+N.status}else if(a.isFunction(c.afterSubmit))k=c.afterSubmit(N,h);if(k[0]===false){a("#FormError>td","#"+f).html(k[1]);a("#FormError","#"+f).show()}else{a.each(e.p.colModel,function(){if(P[this.name]&&this.formatter&&this.formatter=="select")try{delete P[this.name]}catch(aa){}});h=a.extend(h,P);e.p.autoencode&&a.each(h,function(aa,R){h[aa]=a.jgrid.htmlDecode(R)});c.reloadAfterSubmit=c.reloadAfterSubmit&&e.p.datatype!="local";if(h[A]==r.addoper){k[2]||(k[2]=a.jgrid.randId());h[E]=k[2];if(c.closeAfterAdd){if(c.reloadAfterSubmit)a(e).trigger("reloadGrid");else if(e.p.treeGrid===true)a(e).jqGrid("addChildNode",k[2],K,h);else{a(e).jqGrid("addRowData",k[2],h,b.addedrow);a(e).jqGrid("setSelection",k[2])}a.jgrid.hideModal("#"+j.themodal,{gb:"#gbox_"+u,jqm:b.jqModal,onClose:c.onClose})}else if(c.clearAfterAdd){if(c.reloadAfterSubmit)a(e).trigger("reloadGrid");else e.p.treeGrid===true?a(e).jqGrid("addChildNode",k[2],K,h):a(e).jqGrid("addRowData",k[2],h,b.addedrow);C("_empty",e,o)}else if(c.reloadAfterSubmit)a(e).trigger("reloadGrid");else e.p.treeGrid===true?a(e).jqGrid("addChildNode",k[2],K,h):a(e).jqGrid("addRowData",k[2],h,b.addedrow)}else{if(c.reloadAfterSubmit){a(e).trigger("reloadGrid");c.closeAfterEdit||setTimeout(function(){a(e).jqGrid("setSelection",h[E])},1E3)}else e.p.treeGrid===true?a(e).jqGrid("setTreeRow",h[E],h):a(e).jqGrid("setRowData",h[E],h);c.closeAfterEdit&&a.jgrid.hideModal("#"+j.themodal,{gb:"#gbox_"+u,jqm:b.jqModal,onClose:c.onClose})}if(a.isFunction(c.afterComplete)){g=N;setTimeout(function(){c.afterComplete(g,h,a("#"+o));g=null},500)}if(c.checkOnSubmit||c.checkOnUpdate){a("#"+o).data("disabled",false);if(c._savedData[e.p.id+"_id"]!="_empty")for(var S in c._savedData)if(h[S])c._savedData[S]=h[S]}}c.processing=false;a("#sData","#"+f+"_2").removeClass("ui-state-active");try{a(":input:visible","#"+o)[0].focus()}catch(M){}}},a.jgrid.ajaxOptions,c.ajaxEditOptions);if(!v.url&&!c.useDataProxy)if(a.isFunction(e.p.dataProxy))c.useDataProxy=true;else{k[0]=false;k[1]+=" "+a.jgrid.errors.nourl}if(k[0])c.useDataProxy?e.p.dataProxy.call(e,v,"set_"+e.p.id):a.ajax(v)}if(k[0]===false){a("#FormError>td","#"+f).html(k[1]);a("#FormError","#"+f).show()}}function D(g,k){var v=false,r;for(r in g)if(g[r]!=k[r]){v=true;break}return v}function w(){a.each(e.p.colModel,function(g,k){if(k.editoptions&&k.editoptions.NullIfEmpty===true)if(h.hasOwnProperty(k.name)&&h[k.name]=="")h[k.name]="null"})}function n(){var g=true;a("#FormError","#"+f).hide();if(c.checkOnUpdate){h={};P={};l();O=a.extend({},h,P);if(V=D(O,c._savedData)){a("#"+o).data("disabled",true);a(".confirm","#"+j.themodal).show();g=false}else w()}return g}function s(){if(d!=="_empty"&&typeof e.p.savedRow!=="undefined"&&e.p.savedRow.length>0&&a.isFunction(a.fn.jqGrid.restoreRow))for(var g=0;g<e.p.savedRow.length;g++)if(e.p.savedRow[g].id==d){a(e).jqGrid("restoreRow",d);break}}function t(g,k){g===0?a("#pData","#"+f+"_2").addClass("ui-state-disabled"):a("#pData","#"+f+"_2").removeClass("ui-state-disabled");g==k?a("#nData","#"+f+"_2").addClass("ui-state-disabled"):a("#nData","#"+f+"_2").removeClass("ui-state-disabled")}
function p(){var g=a(e).jqGrid("getDataIDs"),k=a("#id_g","#"+f).val();return[a.inArray(k,g),g]}var e=this;if(e.grid&&d){var u=e.p.id,o="FrmGrid_"+u,f="TblGrid_"+u,j={themodal:"editmod"+u,modalhead:"edithd"+u,modalcontent:"editcnt"+u,scrollelm:o},G=a.isFunction(c.beforeShowForm)?c.beforeShowForm:false,L=a.isFunction(c.afterShowForm)?c.afterShowForm:false,I=a.isFunction(c.beforeInitData)?c.beforeInitData:false,T=a.isFunction(c.onInitializeForm)?c.onInitializeForm:false,H=true,m=1,x=0,h,P,O,V;if(d==="new"){d="_empty";b.caption=c.addCaption}else b.caption=c.editCaption;b.recreateForm===true&&a("#"+j.themodal).html()!==null&&a("#"+j.themodal).remove();var Q=true;if(b.checkOnUpdate&&b.jqModal&&!b.modal)Q=false;if(a("#"+j.themodal).html()!==null){if(I){H=I(a("#"+o));if(typeof H=="undefined")H=true}if(H===false)return;s();a(".ui-jqdialog-title","#"+j.modalhead).html(b.caption);a("#FormError","#"+f).hide();if(c.topinfo){a(".topinfo","#"+f+"_2").html(c.topinfo);a(".tinfo","#"+f+"_2").show()}else a(".tinfo","#"+f+"_2").hide();if(c.bottominfo){a(".bottominfo","#"+f+"_2").html(c.bottominfo);a(".binfo","#"+f+"_2").show()}else a(".binfo","#"+f+"_2").hide();C(d,e,o);d=="_empty"||!c.viewPagerButtons?a("#pData, #nData","#"+f+"_2").hide():a("#pData, #nData","#"+f+"_2").show();if(c.processing===true){c.processing=false;a("#sData","#"+f+"_2").removeClass("ui-state-active")}if(a("#"+o).data("disabled")===true){a(".confirm","#"+j.themodal).hide();a("#"+o).data("disabled",false)}G&&G(a("#"+o));a("#"+j.themodal).data("onClose",c.onClose);a.jgrid.viewModal("#"+j.themodal,{gbox:"#gbox_"+u,jqm:b.jqModal,jqM:false,overlay:b.overlay,modal:b.modal});Q||a(".jqmOverlay").click(function(){if(!n())return false;a.jgrid.hideModal("#"+j.themodal,{gb:"#gbox_"+u,jqm:b.jqModal,onClose:c.onClose});return false});L&&L(a("#"+o))}else{var J=isNaN(b.dataheight)?b.dataheight:b.dataheight+"px";J=a("<form name='FormPost' id='"+o+"' class='FormGrid' onSubmit='return false;' style='width:100%;overflow:auto;position:relative;height:"+J+";'></form>").data("disabled",false);var W=a("<table id='"+f+"' class='EditTable' cellspacing='0' cellpadding='0' border='0'><tbody></tbody></table>");if(I){H=I(a("#"+o));if(typeof H=="undefined")H=true}if(H===false)return;s();a(e.p.colModel).each(function(){var g=this.formoptions;m=Math.max(m,g?g.colpos||0:0);x=Math.max(x,g?g.rowpos||0:0)});a(J).append(W);I=a("<tr id='FormError' style='display:none'><td class='ui-state-error' colspan='"+m*2+"'></td></tr>");I[0].rp=0;a(W).append(I);I=a("<tr style='display:none' class='tinfo'><td class='topinfo' colspan='"+
m*2+"'>"+c.topinfo+"</td></tr>");I[0].rp=0;a(W).append(I);H=(I=e.p.direction=="rtl"?true:false)?"nData":"pData";var X=I?"pData":"nData";q(d,e,W,m);H="<a href='javascript:void(0)' id='"+H+"' class='fm-button ui-state-default ui-corner-left'><span class='ui-icon ui-icon-triangle-1-w'></span></div>";X="<a href='javascript:void(0)' id='"+X+"' class='fm-button ui-state-default ui-corner-right'><span class='ui-icon ui-icon-triangle-1-e'></span></div>";var ba="<a href='javascript:void(0)' id='sData' class='fm-button ui-state-default ui-corner-all'>"+
b.bSubmit+"</a>",$="<a href='javascript:void(0)' id='cData' class='fm-button ui-state-default ui-corner-all'>"+b.bCancel+"</a>";H="<table border='0' cellspacing='0' cellpadding='0' class='EditTable' id='"+f+"_2'><tbody><tr><td colspan='2'><hr class='ui-widget-content' style='margin:1px'/></td></tr><tr id='Act_Buttons'><td class='navButton'>"+(I?X+H:H+X)+"</td><td class='EditButton'>"+ba+$+"</td></tr>";H+="<tr style='display:none' class='binfo'><td class='bottominfo' colspan='2'>"+c.bottominfo+"</td></tr>";H+="</tbody></table>";if(x>0){var ca=[];a.each(a(W)[0].rows,function(g,k){ca[g]=k});ca.sort(function(g,k){if(g.rp>k.rp)return 1;if(g.rp<k.rp)return-1;return 0});a.each(ca,function(g,k){a("tbody",W).append(k)})}b.gbox="#gbox_"+u;var da=false;if(b.closeOnEscape===true){b.closeOnEscape=false;da=true}J=a("<span></span>").append(J).append(H);a.jgrid.createModal(j,J,b,"#gview_"+e.p.id,a("#gbox_"+e.p.id)[0]);if(I){a("#pData, #nData","#"+f+"_2").css("float","right");a(".EditButton","#"+f+"_2").css("text-align","left")}c.topinfo&&a(".tinfo","#"+f+"_2").show();c.bottominfo&&a(".binfo","#"+f+"_2").show();H=J=null;a("#"+j.themodal).keydown(function(g){var k=g.target;if(a("#"+o).data("disabled")===true)return false;if(c.savekey[0]===true&&g.which==c.savekey[1])if(k.tagName!="TEXTAREA"){a("#sData","#"+f+"_2").trigger("click");return false}if(g.which===27){if(!n())return false;da&&a.jgrid.hideModal(this,{gb:b.gbox,jqm:b.jqModal,onClose:c.onClose});return false}if(c.navkeys[0]===true){if(a("#id_g","#"+f).val()=="_empty")return true;if(g.which==c.navkeys[1]){a("#pData","#"+f+"_2").trigger("click");return false}if(g.which==c.navkeys[2]){a("#nData","#"+f+"_2").trigger("click");return false}}});if(b.checkOnUpdate){a("a.ui-jqdialog-titlebar-close span","#"+j.themodal).removeClass("jqmClose");a("a.ui-jqdialog-titlebar-close","#"+j.themodal).unbind("click").click(function(){if(!n())return false;a.jgrid.hideModal("#"+j.themodal,{gb:"#gbox_"+u,jqm:b.jqModal,onClose:c.onClose});return false})}b.saveicon=a.extend([true,"left","ui-icon-disk"],b.saveicon);b.closeicon=a.extend([true,"left","ui-icon-close"],b.closeicon);if(b.saveicon[0]===true)a("#sData","#"+f+"_2").addClass(b.saveicon[1]=="right"?"fm-button-icon-right":"fm-button-icon-left").append("<span class='ui-icon "+b.saveicon[2]+"'></span>");if(b.closeicon[0]===true)a("#cData","#"+f+"_2").addClass(b.closeicon[1]=="right"?"fm-button-icon-right":"fm-button-icon-left").append("<span class='ui-icon "+b.closeicon[2]+"'></span>");if(c.checkOnSubmit||c.checkOnUpdate){ba="<a href='javascript:void(0)' id='sNew' class='fm-button ui-state-default ui-corner-all' style='z-index:1002'>"+b.bYes+"</a>";X="<a href='javascript:void(0)' id='nNew' class='fm-button ui-state-default ui-corner-all' style='z-index:1002'>"+b.bNo+"</a>";$="<a href='javascript:void(0)' id='cNew' class='fm-button ui-state-default ui-corner-all' style='z-index:1002'>"+b.bExit+"</a>";J=b.zIndex||999;J++;a("<div class='ui-widget-overlay jqgrid-overlay confirm' style='z-index:"+J+";display:none;'>&#160;"+
(a.browser.msie&&a.browser.version==6?'<iframe style="display:block;position:absolute;z-index:-1;filter:Alpha(Opacity=\'0\');" src="javascript:false;"></iframe>':"")+"</div><div class='confirm ui-widget-content ui-jqconfirm' style='z-index:"+(J+1)+"'>"+b.saveData+"<br/><br/>"+ba+X+$+"</div>").insertAfter("#"+o);a("#sNew","#"+j.themodal).click(function(){z();a("#"+o).data("disabled",false);a(".confirm","#"+j.themodal).hide();return false});a("#nNew","#"+j.themodal).click(function(){a(".confirm","#"+
j.themodal).hide();a("#"+o).data("disabled",false);setTimeout(function(){a(":input","#"+o)[0].focus()},0);return false});a("#cNew","#"+j.themodal).click(function(){a(".confirm","#"+j.themodal).hide();a("#"+o).data("disabled",false);a.jgrid.hideModal("#"+j.themodal,{gb:"#gbox_"+u,jqm:b.jqModal,onClose:c.onClose});return false})}T&&T(a("#"+o));d=="_empty"||!c.viewPagerButtons?a("#pData,#nData","#"+f+"_2").hide():a("#pData,#nData","#"+f+"_2").show();G&&G(a("#"+o));a("#"+j.themodal).data("onClose",c.onClose);a.jgrid.viewModal("#"+j.themodal,{gbox:"#gbox_"+u,jqm:b.jqModal,overlay:b.overlay,modal:b.modal});Q||a(".jqmOverlay").click(function(){if(!n())return false;a.jgrid.hideModal("#"+j.themodal,{gb:"#gbox_"+u,jqm:b.jqModal,onClose:c.onClose});return false});L&&L(a("#"+o));a(".fm-button","#"+j.themodal).hover(function(){a(this).addClass("ui-state-hover")},function(){a(this).removeClass("ui-state-hover")});a("#sData","#"+f+"_2").click(function(){h={};P={};a("#FormError","#"+f).hide();l();w();if(h[e.p.id+"_id"]=="_empty")z();else if(b.checkOnSubmit===true){O=a.extend({},h,P);if(V=D(O,c._savedData)){a("#"+o).data("disabled",true);a(".confirm","#"+j.themodal).show()}else z()}else z();return false});a("#cData","#"+f+"_2").click(function(){if(!n())return false;a.jgrid.hideModal("#"+j.themodal,{gb:"#gbox_"+u,jqm:b.jqModal,onClose:c.onClose});return false});a("#nData","#"+f+"_2").click(function(){if(!n())return false;a("#FormError","#"+f).hide();var g=p();g[0]=parseInt(g[0],10);if(g[0]!=-1&&g[1][g[0]+1]){if(a.isFunction(b.onclickPgButtons))b.onclickPgButtons("next",a("#"+o),g[1][g[0]]);C(g[1][g[0]+1],e,o);a(e).jqGrid("setSelection",g[1][g[0]+1]);a.isFunction(b.afterclickPgButtons)&&b.afterclickPgButtons("next",a("#"+o),g[1][g[0]+1]);t(g[0]+1,g[1].length-1)}return false});a("#pData","#"+f+"_2").click(function(){if(!n())return false;a("#FormError","#"+f).hide();var g=p();if(g[0]!=-1&&g[1][g[0]-1]){if(a.isFunction(b.onclickPgButtons))b.onclickPgButtons("prev",a("#"+o),g[1][g[0]]);C(g[1][g[0]-1],e,o);a(e).jqGrid("setSelection",g[1][g[0]-1]);a.isFunction(b.afterclickPgButtons)&&b.afterclickPgButtons("prev",a("#"+o),g[1][g[0]-1]);t(g[0]-1,g[1].length-1)}return false})}G=p();t(G[0],G[1].length-1)}})},viewGridRow:function(d,b){b=a.extend({top:0,left:0,width:0,height:"auto",dataheight:"auto",modal:false,overlay:10,drag:true,resize:true,jqModal:true,closeOnEscape:false,labelswidth:"30%",closeicon:[],navkeys:[false,38,40],onClose:null,beforeShowForm:null,beforeInitData:null,viewPagerButtons:true},a.jgrid.view,b||{});return this.each(function(){function l(){if(b.closeOnEscape===true||b.navkeys[0]===true)setTimeout(function(){a(".ui-jqdialog-titlebar-close","#"+p.modalhead).focus()},0)}function q(m,x,h,P){for(var O,V,Q,J=0,W,X,ba=[],$=false,ca="<td class='CaptionTD form-view-label ui-widget-content' width='"+b.labelswidth+"'>&#160;</td><td class='DataTD form-view-data ui-helper-reset ui-widget-content'>&#160;</td>",da="",g=["integer","number","currency"],k=0,v=0,r,E,A,y=1;y<=P;y++)da+=y==1?ca:"<td class='CaptionTD form-view-label ui-widget-content'>&#160;</td><td class='DataTD form-view-data ui-widget-content'>&#160;</td>";a(x.p.colModel).each(function(){V=this.editrules&&this.editrules.edithidden===true?false:this.hidden===true?true:false;if(!V&&this.align==="right")if(this.formatter&&a.inArray(this.formatter,g)!==-1)k=Math.max(k,parseInt(this.width,10));else v=Math.max(v,parseInt(this.width,10))});r=k!==0?k:v!==0?v:0;$=a(x).jqGrid("getInd",m);a(x.p.colModel).each(function(K){O=this.name;E=false;X=(V=this.editrules&&this.editrules.edithidden===true?false:this.hidden===true?true:false)?"style='display:none'":"";A=typeof this.viewable!="boolean"?true:this.viewable;if(O!=="cb"&&O!=="subgrid"&&O!=="rn"&&A){W=$===false?"":O==x.p.ExpandColumn&&x.p.treeGrid===true?a("td:eq("+K+")",x.rows[$]).text():a("td:eq("+K+")",x.rows[$]).html();E=this.align==="right"&&r!==0?true:false;a.extend({},this.editoptions||{},{id:O,name:O});var B=a.extend({},{rowabove:false,rowcontent:""},this.formoptions||{}),N=parseInt(B.rowpos,10)||J+1,F=parseInt((parseInt(B.colpos,10)||1)*2,10);if(B.rowabove){var S=a("<tr><td class='contentinfo' colspan='"+P*2+"'>"+
B.rowcontent+"</td></tr>");a(h).append(S);S[0].rp=N}Q=a(h).find("tr[rowpos="+N+"]");if(Q.length===0){Q=a("<tr "+X+" rowpos='"+N+"'></tr>").addClass("FormData").attr("id","trv_"+O);a(Q).append(da);a(h).append(Q);Q[0].rp=N}a("td:eq("+(F-2)+")",Q[0]).html("<b>"+(typeof B.label==="undefined"?x.p.colNames[K]:B.label)+"</b>");a("td:eq("+(F-1)+")",Q[0]).append("<span>"+W+"</span>").attr("id","v_"+O);E&&a("td:eq("+(F-1)+") span",Q[0]).css({"text-align":"right",width:r+"px"});ba[J]=K;J++}});if(J>0){m=a("<tr class='FormData' style='display:none'><td class='CaptionTD'></td><td colspan='"+
(P*2-1)+"' class='DataTD'><input class='FormElement' id='id_g' type='text' name='id' value='"+m+"'/></td></tr>");m[0].rp=J+99;a(h).append(m)}return ba}function C(m,x){var h,P,O=0,V,Q;if(Q=a(x).jqGrid("getInd",m,true)){a("td",Q).each(function(J){h=x.p.colModel[J].name;P=x.p.colModel[J].editrules&&x.p.colModel[J].editrules.edithidden===true?false:x.p.colModel[J].hidden===true?true:false;if(h!=="cb"&&h!=="subgrid"&&h!=="rn"){V=h==x.p.ExpandColumn&&x.p.treeGrid===true?a(this).text():a(this).html();a.extend({},x.p.colModel[J].editoptions||{});h=a.jgrid.jqID("v_"+h);a("#"+h+" span","#"+t).html(V);P&&a("#"+h,"#"+t).parents("tr:first").hide();O++}});O>0&&a("#id_g","#"+t).val(m)}}function z(m,x){m===0?a("#pData","#"+t+"_2").addClass("ui-state-disabled"):a("#pData","#"+t+"_2").removeClass("ui-state-disabled");m==x?a("#nData","#"+t+"_2").addClass("ui-state-disabled"):a("#nData","#"+t+"_2").removeClass("ui-state-disabled")}function D(){var m=a(w).jqGrid("getDataIDs"),x=a("#id_g","#"+t).val();return[a.inArray(x,m),m]}var w=this;if(w.grid&&d){if(!b.imgpath)b.imgpath=w.p.imgpath;var n=w.p.id,s="ViewGrid_"+n,t="ViewTbl_"+n,p={themodal:"viewmod"+n,modalhead:"viewhd"+n,modalcontent:"viewcnt"+n,scrollelm:s},e=a.isFunction(b.beforeInitData)?b.beforeInitData:false,u=true,o=1,f=0;if(a("#"+p.themodal).html()!==null){if(e){u=e(a("#"+s));if(typeof u=="undefined")u=true}if(u===false)return;a(".ui-jqdialog-title","#"+p.modalhead).html(b.caption);a("#FormError","#"+t).hide();C(d,w);a.isFunction(b.beforeShowForm)&&b.beforeShowForm(a("#"+
s));a.jgrid.viewModal("#"+p.themodal,{gbox:"#gbox_"+n,jqm:b.jqModal,jqM:false,overlay:b.overlay,modal:b.modal});l()}else{var j=isNaN(b.dataheight)?b.dataheight:b.dataheight+"px";j=a("<form name='FormPost' id='"+s+"' class='FormGrid' style='width:100%;overflow:auto;position:relative;height:"+j+";'></form>");var G=a("<table id='"+t+"' class='EditTable' cellspacing='1' cellpadding='2' border='0' style='table-layout:fixed'><tbody></tbody></table>");if(e){u=e(a("#"+s));if(typeof u=="undefined")u=true}if(u===false)return;a(w.p.colModel).each(function(){var m=this.formoptions;o=Math.max(o,m?m.colpos||0:0);f=Math.max(f,m?m.rowpos||0:0)});a(j).append(G);q(d,w,G,o);e=w.p.direction=="rtl"?true:false;u="<a href='javascript:void(0)' id='"+(e?"nData":"pData")+"' class='fm-button ui-state-default ui-corner-left'><span class='ui-icon ui-icon-triangle-1-w'></span></a>";var L="<a href='javascript:void(0)' id='"+(e?"pData":"nData")+"' class='fm-button ui-state-default ui-corner-right'><span class='ui-icon ui-icon-triangle-1-e'></span></a>",I="<a href='javascript:void(0)' id='cData' class='fm-button ui-state-default ui-corner-all'>"+b.bClose+"</a>";if(f>0){var T=[];a.each(a(G)[0].rows,function(m,x){T[m]=x});T.sort(function(m,x){if(m.rp>x.rp)return 1;if(m.rp<x.rp)return-1;return 0});a.each(T,function(m,x){a("tbody",G).append(x)})}b.gbox="#gbox_"+n;var H=false;if(b.closeOnEscape===true){b.closeOnEscape=false;H=true}j=a("<span></span>").append(j).append("<table border='0' class='EditTable' id='"+t+"_2'><tbody><tr id='Act_Buttons'><td class='navButton' width='"+
b.labelswidth+"'>"+(e?L+u:u+L)+"</td><td class='EditButton'>"+I+"</td></tr></tbody></table>");a.jgrid.createModal(p,j,b,"#gview_"+w.p.id,a("#gview_"+w.p.id)[0]);if(e){a("#pData, #nData","#"+t+"_2").css("float","right");a(".EditButton","#"+t+"_2").css("text-align","left")}b.viewPagerButtons||a("#pData, #nData","#"+t+"_2").hide();j=null;a("#"+p.themodal).keydown(function(m){if(m.which===27){H&&a.jgrid.hideModal(this,{gb:b.gbox,jqm:b.jqModal,onClose:b.onClose});return false}if(b.navkeys[0]===true){if(m.which===b.navkeys[1]){a("#pData","#"+t+"_2").trigger("click");return false}if(m.which===b.navkeys[2]){a("#nData","#"+t+"_2").trigger("click");return false}}});b.closeicon=a.extend([true,"left","ui-icon-close"],b.closeicon);if(b.closeicon[0]===true)a("#cData","#"+t+"_2").addClass(b.closeicon[1]=="right"?"fm-button-icon-right":"fm-button-icon-left").append("<span class='ui-icon "+b.closeicon[2]+"'></span>");a.isFunction(b.beforeShowForm)&&b.beforeShowForm(a("#"+s));a.jgrid.viewModal("#"+p.themodal,{gbox:"#gbox_"+
n,jqm:b.jqModal,modal:b.modal});a(".fm-button:not(.ui-state-disabled)","#"+t+"_2").hover(function(){a(this).addClass("ui-state-hover")},function(){a(this).removeClass("ui-state-hover")});l();a("#cData","#"+t+"_2").click(function(){a.jgrid.hideModal("#"+p.themodal,{gb:"#gbox_"+n,jqm:b.jqModal,onClose:b.onClose});return false});a("#nData","#"+t+"_2").click(function(){a("#FormError","#"+t).hide();var m=D();m[0]=parseInt(m[0],10);if(m[0]!=-1&&m[1][m[0]+1]){if(a.isFunction(b.onclickPgButtons))b.onclickPgButtons("next",a("#"+s),m[1][m[0]]);C(m[1][m[0]+1],w);a(w).jqGrid("setSelection",m[1][m[0]+1]);a.isFunction(b.afterclickPgButtons)&&b.afterclickPgButtons("next",a("#"+s),m[1][m[0]+1]);z(m[0]+1,m[1].length-1)}l();return false});a("#pData","#"+t+"_2").click(function(){a("#FormError","#"+t).hide();var m=D();if(m[0]!=-1&&m[1][m[0]-1]){if(a.isFunction(b.onclickPgButtons))b.onclickPgButtons("prev",a("#"+s),m[1][m[0]]);C(m[1][m[0]-1],w);a(w).jqGrid("setSelection",m[1][m[0]-1]);a.isFunction(b.afterclickPgButtons)&&b.afterclickPgButtons("prev",a("#"+s),m[1][m[0]-1]);z(m[0]-1,m[1].length-1)}l();return false})}j=D();z(j[0],j[1].length-1)}})},delGridRow:function(d,b){c=b=a.extend({top:0,left:0,width:240,height:"auto",dataheight:"auto",modal:false,overlay:10,drag:true,resize:true,url:"",mtype:"POST",reloadAfterSubmit:true,beforeShowForm:null,beforeInitData:null,afterShowForm:null,beforeSubmit:null,onclickSubmit:null,afterSubmit:null,jqModal:true,closeOnEscape:false,delData:{},delicon:[],cancelicon:[],onClose:null,ajaxDelOptions:{},processing:false,serializeDelData:null,useDataProxy:false},a.jgrid.del,b||{});return this.each(function(){var l=this;if(l.grid)if(d){var q=typeof b.beforeShowForm==="function"?true:false,C=typeof b.afterShowForm==="function"?true:false,z=a.isFunction(b.beforeInitData)?b.beforeInitData:false,D=l.p.id,w={},n=true,s="DelTbl_"+D,t,p,e,u,o={themodal:"delmod"+D,modalhead:"delhd"+D,modalcontent:"delcnt"+D,scrollelm:s};if(jQuery.isArray(d))d=d.join();if(a("#"+o.themodal).html()!==null){if(z){n=z(a("#"+s));if(typeof n=="undefined")n=true}if(n===false)return;a("#DelData>td","#"+s).text(d);a("#DelError","#"+s).hide();if(c.processing===true){c.processing=false;a("#dData","#"+s).removeClass("ui-state-active")}q&&b.beforeShowForm(a("#"+s));a.jgrid.viewModal("#"+o.themodal,{gbox:"#gbox_"+D,jqm:b.jqModal,jqM:false,overlay:b.overlay,modal:b.modal})}else{var f=isNaN(b.dataheight)?b.dataheight:b.dataheight+"px";f="<div id='"+s+"' class='formdata' style='width:100%;overflow:auto;position:relative;height:"+f+";'>";f+="<table class='DelTable'><tbody>";f+="<tr id='DelError' style='display:none'><td class='ui-state-error'></td></tr>";f+="<tr id='DelData' style='display:none'><td >"+d+"</td></tr>";f+='<tr><td class="delmsg" style="white-space:pre;">'+b.msg+"</td></tr><tr><td >&#160;</td></tr>";f+="</tbody></table></div>";f+="<table cellspacing='0' cellpadding='0' border='0' class='EditTable' id='"+s+"_2'><tbody><tr><td><hr class='ui-widget-content' style='margin:1px'/></td></tr></tr><tr><td class='DelButton EditButton'>"+("<a href='javascript:void(0)' id='dData' class='fm-button ui-state-default ui-corner-all'>"+
b.bSubmit+"</a>")+"&#160;"+("<a href='javascript:void(0)' id='eData' class='fm-button ui-state-default ui-corner-all'>"+b.bCancel+"</a>")+"</td></tr></tbody></table>";b.gbox="#gbox_"+D;a.jgrid.createModal(o,f,b,"#gview_"+l.p.id,a("#gview_"+l.p.id)[0]);if(z){n=z(a("#"+s));if(typeof n=="undefined")n=true}if(n===false)return;a(".fm-button","#"+s+"_2").hover(function(){a(this).addClass("ui-state-hover")},function(){a(this).removeClass("ui-state-hover")});b.delicon=a.extend([true,"left","ui-icon-scissors"],b.delicon);b.cancelicon=a.extend([true,"left","ui-icon-cancel"],b.cancelicon);if(b.delicon[0]===true)a("#dData","#"+s+"_2").addClass(b.delicon[1]=="right"?"fm-button-icon-right":"fm-button-icon-left").append("<span class='ui-icon "+b.delicon[2]+"'></span>");if(b.cancelicon[0]===true)a("#eData","#"+s+"_2").addClass(b.cancelicon[1]=="right"?"fm-button-icon-right":"fm-button-icon-left").append("<span class='ui-icon "+b.cancelicon[2]+"'></span>");a("#dData","#"+s+"_2").click(function(){var j=[true,""];w={};var G=a("#DelData>td","#"+s).text();if(typeof b.onclickSubmit==="function")w=b.onclickSubmit(c,G)||{};if(typeof b.beforeSubmit==="function")j=b.beforeSubmit(G);if(j[0]&&!c.processing){c.processing=true;a(this).addClass("ui-state-active");e=l.p.prmNames;t=a.extend({},c.delData,w);u=e.oper;t[u]=e.deloper;p=e.id;t[p]=G;var L=a.extend({url:c.url?c.url:a(l).jqGrid("getGridParam","editurl"),type:b.mtype,data:a.isFunction(b.serializeDelData)?b.serializeDelData(t):t,complete:function(I,T){if(T!="success"){j[0]=false;j[1]=a.isFunction(c.errorTextFormat)?c.errorTextFormat(I):T+" Status: '"+I.statusText+"'. Error code: "+I.status}else if(typeof c.afterSubmit==="function")j=c.afterSubmit(I,t);if(j[0]===false){a("#DelError>td","#"+s).html(j[1]);a("#DelError","#"+s).show()}else{if(c.reloadAfterSubmit&&l.p.datatype!="local")a(l).trigger("reloadGrid");else{var H=[];H=G.split(",");if(l.p.treeGrid===true)try{a(l).jqGrid("delTreeNode",H[0])}catch(m){}else for(var x=0;x<H.length;x++)a(l).jqGrid("delRowData",H[x]);l.p.selrow=null;l.p.selarrrow=[]}a.isFunction(c.afterComplete)&&setTimeout(function(){c.afterComplete(I,G)},500)}c.processing=false;a("#dData","#"+s+"_2").removeClass("ui-state-active");j[0]&&a.jgrid.hideModal("#"+o.themodal,{gb:"#gbox_"+D,jqm:b.jqModal,onClose:c.onClose})}},a.jgrid.ajaxOptions,b.ajaxDelOptions);if(!L.url&&!c.useDataProxy)if(a.isFunction(l.p.dataProxy))c.useDataProxy=true;else{j[0]=false;j[1]+=" "+a.jgrid.errors.nourl}if(j[0])c.useDataProxy?l.p.dataProxy.call(l,L,"del_"+l.p.id):a.ajax(L)}if(j[0]===false){a("#DelError>td","#"+s).html(j[1]);a("#DelError","#"+s).show()}return false});a("#eData","#"+s+"_2").click(function(){a.jgrid.hideModal("#"+o.themodal,{gb:"#gbox_"+D,jqm:b.jqModal,onClose:c.onClose});return false});q&&b.beforeShowForm(a("#"+s));a.jgrid.viewModal("#"+o.themodal,{gbox:"#gbox_"+D,jqm:b.jqModal,overlay:b.overlay,modal:b.modal})}C&&b.afterShowForm(a("#"+s));b.closeOnEscape===true&&setTimeout(function(){a(".ui-jqdialog-titlebar-close","#"+o.modalhead).focus()},0)}})},navGrid:function(d,b,l,q,C,z,D){b=a.extend({edit:true,editicon:"ui-icon-pencil",add:true,addicon:"ui-icon-plus",del:true,delicon:"ui-icon-trash",search:true,searchicon:"ui-icon-search",refresh:true,refreshicon:"ui-icon-refresh",refreshstate:"firstpage",view:false,viewicon:"ui-icon-document",position:"left",closeOnEscape:true,beforeRefresh:null,afterRefresh:null,cloneToTop:false},a.jgrid.nav,b||{});return this.each(function(){if(!this.nav){var w={themodal:"alertmod",modalhead:"alerthd",modalcontent:"alertcnt"},n=this,s,t,p;if(!(!n.grid||typeof d!="string")){if(a("#"+w.themodal).html()===null){if(typeof window.innerWidth!="undefined"){s=window.innerWidth;t=window.innerHeight}else if(typeof document.documentElement!="undefined"&&typeof document.documentElement.clientWidth!="undefined"&&document.documentElement.clientWidth!==0){s=document.documentElement.clientWidth;t=document.documentElement.clientHeight}else{s=1024;t=768}a.jgrid.createModal(w,"<div>"+b.alerttext+"</div><span tabindex='0'><span tabindex='-1' id='jqg_alrt'></span></span>",{gbox:"#gbox_"+n.p.id,jqModal:true,drag:true,resize:true,caption:b.alertcap,top:t/2-25,left:s/2-100,width:200,height:"auto",closeOnEscape:b.closeOnEscape},"","",true)}s=1;if(b.cloneToTop&&n.p.toppager)s=2;for(t=0;t<s;t++){var e=a("<table cellspacing='0' cellpadding='0' border='0' class='ui-pg-table navtable' style='float:left;table-layout:auto;'><tbody><tr></tr></tbody></table>"),u,o;if(t===0){u=d;o=n.p.id;if(u==n.p.toppager){o+="_top";s=1}}else{u=n.p.toppager;o=n.p.id+"_top"}n.p.direction=="rtl"&&a(e).attr("dir","rtl").css("float","right");if(b.add){q=q||{};p=a("<td class='ui-pg-button ui-corner-all'></td>");a(p).append("<div class='ui-pg-div'><span class='ui-icon "+b.addicon+"'></span>"+b.addtext+"</div>");a("tr",e).append(p);a(p,e).attr({title:b.addtitle||"",id:q.id||"add_"+o}).click(function(){a(this).hasClass("ui-state-disabled")||(typeof b.addfunc=="function"?b.addfunc():a(n).jqGrid("editGridRow","new",q));return false}).hover(function(){a(this).hasClass("ui-state-disabled")||a(this).addClass("ui-state-hover")},function(){a(this).removeClass("ui-state-hover")});p=null}if(b.edit){p=a("<td class='ui-pg-button ui-corner-all'></td>");l=l||{};a(p).append("<div class='ui-pg-div'><span class='ui-icon "+b.editicon+"'></span>"+b.edittext+"</div>");a("tr",e).append(p);a(p,e).attr({title:b.edittitle||"",id:l.id||"edit_"+o}).click(function(){if(!a(this).hasClass("ui-state-disabled")){var f=n.p.selrow;if(f)typeof b.editfunc=="function"?b.editfunc(f):a(n).jqGrid("editGridRow",f,l);else{a.jgrid.viewModal("#"+w.themodal,{gbox:"#gbox_"+n.p.id,jqm:true});a("#jqg_alrt").focus()}}return false}).hover(function(){a(this).hasClass("ui-state-disabled")||a(this).addClass("ui-state-hover")},function(){a(this).removeClass("ui-state-hover")});p=null}if(b.view){p=a("<td class='ui-pg-button ui-corner-all'></td>");D=D||{};a(p).append("<div class='ui-pg-div'><span class='ui-icon "+b.viewicon+"'></span>"+b.viewtext+"</div>");a("tr",e).append(p);a(p,e).attr({title:b.viewtitle||"",id:D.id||"view_"+o}).click(function(){if(!a(this).hasClass("ui-state-disabled")){var f=n.p.selrow;if(f)a(n).jqGrid("viewGridRow",f,D);else{a.jgrid.viewModal("#"+w.themodal,{gbox:"#gbox_"+n.p.id,jqm:true});a("#jqg_alrt").focus()}}return false}).hover(function(){a(this).hasClass("ui-state-disabled")||a(this).addClass("ui-state-hover")},function(){a(this).removeClass("ui-state-hover")});p=null}if(b.del){p=a("<td class='ui-pg-button ui-corner-all'></td>");C=C||{};a(p).append("<div class='ui-pg-div'><span class='ui-icon "+b.delicon+"'></span>"+b.deltext+"</div>");a("tr",e).append(p);a(p,e).attr({title:b.deltitle||"",id:C.id||"del_"+o}).click(function(){if(!a(this).hasClass("ui-state-disabled")){var f;if(n.p.multiselect){f=n.p.selarrrow;if(f.length===0)f=null}else f=n.p.selrow;if(f)"function"==typeof b.delfunc?b.delfunc(f):a(n).jqGrid("delGridRow",f,C);else{a.jgrid.viewModal("#"+w.themodal,{gbox:"#gbox_"+n.p.id,jqm:true});a("#jqg_alrt").focus()}}return false}).hover(function(){a(this).hasClass("ui-state-disabled")||a(this).addClass("ui-state-hover")},function(){a(this).removeClass("ui-state-hover")});p=null}if(b.add||b.edit||b.del||b.view)a("tr",e).append("<td class='ui-pg-button ui-state-disabled' style='width:4px;'><span class='ui-separator'></span></td>");if(b.search){p=a("<td class='ui-pg-button ui-corner-all'></td>");z=z||{};a(p).append("<div class='ui-pg-div'><span class='ui-icon "+b.searchicon+"'></span>"+b.searchtext+"</div>");a("tr",e).append(p);a(p,e).attr({title:b.searchtitle||"",id:z.id||"search_"+o}).click(function(){a(this).hasClass("ui-state-disabled")||a(n).jqGrid("searchGrid",z);return false}).hover(function(){a(this).hasClass("ui-state-disabled")||a(this).addClass("ui-state-hover")},function(){a(this).removeClass("ui-state-hover")});z.showOnLoad&&z.showOnLoad===true&&a(p,e).click();p=null}if(b.refresh){p=a("<td class='ui-pg-button ui-corner-all'></td>");a(p).append("<div class='ui-pg-div'><span class='ui-icon "+b.refreshicon+"'></span>"+b.refreshtext+"</div>");a("tr",e).append(p);a(p,e).attr({title:b.refreshtitle||"",id:"refresh_"+o}).click(function(){if(!a(this).hasClass("ui-state-disabled")){a.isFunction(b.beforeRefresh)&&b.beforeRefresh();n.p.search=false;try{var f=n.p.id;n.p.postData.filters="";a("#fbox_"+f).jqFilter("resetFilter");a.isFunction(n.clearToolbar)&&n.clearToolbar(false)}catch(j){}switch(b.refreshstate){case"firstpage":a(n).trigger("reloadGrid",[{page:1}]);break;case"current":a(n).trigger("reloadGrid",[{current:true}])}a.isFunction(b.afterRefresh)&&b.afterRefresh()}return false}).hover(function(){a(this).hasClass("ui-state-disabled")||a(this).addClass("ui-state-hover")},function(){a(this).removeClass("ui-state-hover")});p=null}p=a(".ui-jqgrid").css("font-size")||"11px";a("body").append("<div id='testpg2' class='ui-jqgrid ui-widget ui-widget-content' style='font-size:"+p+";visibility:hidden;' ></div>");p=a(e).clone().appendTo("#testpg2").width();a("#testpg2").remove();a(u+"_"+b.position,u).append(e);if(n.p._nvtd){if(p>n.p._nvtd[0]){a(u+"_"+b.position,u).width(p);n.p._nvtd[0]=p}n.p._nvtd[1]=p}e=p=p=null;this.nav=true}}}})},navButtonAdd:function(d,b){b=a.extend({caption:"newButton",title:"",buttonicon:"ui-icon-newwin",onClickButton:null,position:"last",cursor:"pointer"},b||{});return this.each(function(){if(this.grid){if(d.indexOf("#")!==0)d="#"+d;var l=a(".navtable",d)[0],q=this;if(l)if(!(b.id&&a("#"+b.id,l).html()!==null)){var C=a("<td></td>");b.buttonicon.toString().toUpperCase()=="NONE"?a(C).addClass("ui-pg-button ui-corner-all").append("<div class='ui-pg-div'>"+b.caption+"</div>"):a(C).addClass("ui-pg-button ui-corner-all").append("<div class='ui-pg-div'><span class='ui-icon "+b.buttonicon+"'></span>"+b.caption+"</div>");b.id&&a(C).attr("id",b.id);if(b.position=="first")l.rows[0].cells.length===0?a("tr",l).append(C):a("tr td:eq(0)",l).before(C);else a("tr",l).append(C);a(C,l).attr("title",b.title||"").click(function(z){a(this).hasClass("ui-state-disabled")||a.isFunction(b.onClickButton)&&b.onClickButton.call(q,z);return false}).hover(function(){a(this).hasClass("ui-state-disabled")||a(this).addClass("ui-state-hover")},function(){a(this).removeClass("ui-state-hover")})}}})},navSeparatorAdd:function(d,b){b=a.extend({sepclass:"ui-separator",sepcontent:""},b||{});return this.each(function(){if(this.grid){if(d.indexOf("#")!==0)d="#"+d;var l=a(".navtable",d)[0];if(l){var q="<td class='ui-pg-button ui-state-disabled' style='width:4px;'><span class='"+b.sepclass+"'></span>"+b.sepcontent+"</td>";a("tr",l).append(q)}}})},GridToForm:function(d,b){return this.each(function(){if(this.grid){var l=a(this).jqGrid("getRowData",d);if(l)for(var q in l)a("[name="+a.jgrid.jqID(q)+"]",b).is("input:radio")||a("[name="+
a.jgrid.jqID(q)+"]",b).is("input:checkbox")?a("[name="+a.jgrid.jqID(q)+"]",b).each(function(){a(this).val()==l[q]?a(this).attr("checked","checked"):a(this).attr("checked","")}):a("[name="+a.jgrid.jqID(q)+"]",b).val(l[q])}})},FormToGrid:function(d,b,l,q){return this.each(function(){if(this.grid){l||(l="set");q||(q="first");var C=a(b).serializeArray(),z={};a.each(C,function(D,w){z[w.name]=w.value});if(l=="add")a(this).jqGrid("addRowData",d,z,q);else l=="set"&&a(this).jqGrid("setRowData",d,z)}})}})})(jQuery);(function(d){d.fn.jqFilter=function(k){if(typeof k==="string"){var t=d.fn.jqFilter[k];if(!t)throw"jqFilter - No such method: "+k;var z=d.makeArray(arguments).slice(1);return t.apply(this,z)}var o=d.extend(true,{filter:null,columns:[],onChange:null,checkValues:null,error:false,errmsg:"",errorcheck:true,showQuery:true,sopt:null,ops:[{name:"eq",description:"equal",operator:"="},{name:"ne",description:"not equal",operator:"<>"},{name:"lt",description:"less",operator:"<"},{name:"le",description:"less or equal",operator:"<="},{name:"gt",description:"greater",operator:">"},{name:"ge",description:"greater or equal",operator:">="},{name:"bw",description:"begins with",operator:"LIKE"},{name:"bn",description:"does not begin with",operator:"NOT LIKE"},{name:"in",description:"in",operator:"IN"},{name:"ni",description:"not in",operator:"NOT IN"},{name:"ew",description:"ends with",operator:"LIKE"},{name:"en",description:"does not end with",operator:"NOT LIKE"},{name:"cn",description:"contains",operator:"LIKE"},{name:"nc",description:"does not contain",operator:"NOT LIKE"},{name:"nu",description:"is null",operator:"IS NULL"},{name:"nn",description:"is not null",operator:"IS NOT NULL"}],numopts:["eq","ne","lt","le","gt","ge","nu","nn","in","ni"],stropts:["eq","ne","bw","bn","ew","en","cn","nc","nu","nn","in","ni"],_gridsopt:[],groupOps:["AND","OR"],groupButton:true},k||{});return this.each(function(){if(!this.filter){this.p=o;if(this.p.filter===null||this.p.filter===undefined)this.p.filter={groupOp:this.p.groupOps[0],rules:[],groups:[]};var p,u=this.p.columns.length,i,v=/msie/i.test(navigator.userAgent)&&!window.opera;if(this.p._gridsopt.length)for(p=0;p<this.p._gridsopt.length;p++)this.p.ops[p].description=this.p._gridsopt[p];this.p.initFilter=d.extend(true,{},this.p.filter);if(u){for(p=0;p<u;p++){i=this.p.columns[p];if(i.stype)i.inputtype=i.stype;else if(!i.inputtype)i.inputtype="text";if(i.sorttype)i.searchtype=i.sorttype;else if(!i.searchtype)i.searchtype="string";if(i.hidden===undefined)i.hidden=false;if(!i.label)i.label=i.name;if(i.index)i.name=i.index;if(!i.hasOwnProperty("searchoptions"))i.searchoptions={};if(!i.hasOwnProperty("searchrules"))i.searchrules={}}this.p.showQuery&&d(this).append("<table class='queryresult ui-widget ui-widget-content' style='display:block;max-width:440px;border:0px none;'><tbody><tr><td class='query'></td></tr></tbody></table>");var w=function(c,f){var a=[true,""];if(d.isFunction(f.searchrules))a=f.searchrules(c,f);else if(d.jgrid&&d.jgrid.checkValues)try{a=d.jgrid.checkValues(c,-1,null,f.searchrules,f.label)}catch(b){}if(a&&a.length&&a[0]===false){o.error=!a[0];o.errmsg=a[1]}};this.onchange=function(){this.p.error=false;this.p.errmsg="";return d.isFunction(this.p.onChange)?this.p.onChange.call(this,this.p):false};this.reDraw=function(){d("table.group:first",this).remove();var c=this.createTableForGroup(o.filter,null);d(this).append(c)};this.createTableForGroup=function(c,f){var a=this,b,e=d("<table class='group ui-widget ui-widget-content' style='border:0px none;'><tbody></tbody></table>");f===null&&d(e).append("<tr class='error' style='display:none;'><th colspan='5' class='ui-state-error' align='left'></th></tr>");var g=d("<tr></tr>");d(e).append(g);var j=d("<th colspan='5' align='left'></th>");g.append(j);var h=d("<select class='opsel'></select>");j.append(h);g="";var l;for(b=0;b<o.groupOps.length;b++){l=c.groupOp===a.p.groupOps[b]?" selected='selected'":"";g+="<option value='"+a.p.groupOps[b]+"'"+l+">"+a.p.groupOps[b]+"</option>"}h.append(g).bind("change",function(){c.groupOp=d(h).val();a.onchange()});g="<span></span>";if(this.p.groupButton){g=d("<input type='button' value='+ {}' title='Add subgroup' class='add-group'/>");g.bind("click",function(){if(c.groups===undefined)c.groups=[];c.groups.push({groupOp:o.groupOps[0],rules:[],groups:[]});a.reDraw();a.onchange();return false})}j.append(g);g=d("<input type='button' value='+' title='Add rule' class='add-rule ui-add'/>");var m;g.bind("click",function(){if(c.rules===undefined)c.rules=[];for(b=0;b<a.p.columns.length;b++){var n=typeof a.p.columns[b].search==="undefined"?true:a.p.columns[b].search,r=a.p.columns[b].hidden===true;if(a.p.columns[b].searchoptions.searchhidden===true&&n||n&&!r){m=a.p.columns[b];break}}c.rules.push({field:m.name,op:(m.searchoptions.sopt?m.searchoptions.sopt:a.p.sopt?a.p.sopt:m.searchtype==="string"?a.p.stropts:a.p.numopts)[0],data:""});a.reDraw();return false});j.append(g);if(f!==null){g=d("<input type='button' value='-' title='Delete group' class='delete-group'/>");j.append(g);g.bind("click",function(){for(b=0;b<f.groups.length;b++)if(f.groups[b]===c){f.groups.splice(b,1);break}a.reDraw();a.onchange();return false})}if(c.groups!==undefined)for(b=0;b<c.groups.length;b++){j=d("<tr></tr>");e.append(j);g=d("<td class='first'></td>");j.append(g);g=d("<td colspan='4'></td>");g.append(this.createTableForGroup(c.groups[b],c));j.append(g)}if(c.groupOp===undefined)c.groupOp=a.p.groupOps[0];if(c.rules!==undefined)for(b=0;b<c.rules.length;b++)e.append(this.createTableRowForRule(c.rules[b],c));return e};this.createTableRowForRule=function(c,f){var a=this,b=d("<tr></tr>"),e,g,j,h,l="",m;b.append("<td class='first'></td>");var n=d("<td class='columns'></td>");b.append(n);var r=d("<select></select>");n.append(r);r.bind("change",function(){c.field=d(r).val();j=d(this).parents("tr:first");for(e=0;e<a.p.columns.length;e++)if(a.p.columns[e].name===c.field){h=a.p.columns[e];break}if(h){h.searchoptions.id=d.jgrid.randId();if(v&&h.inputtype==="text")if(!h.searchoptions.size)h.searchoptions.size=10;var q=d.jgrid.createEl(h.inputtype,h.searchoptions,"",true,a.p.ajaxSelectOptions,true);d(q).addClass("input-elm");g=h.searchoptions.sopt?h.searchoptions.sopt:a.p.sopt?a.p.sopt:h.searchtype==="string"?a.p.stropts:a.p.numopts;var x="",y="";for(e=0;e<a.p.ops.length;e++)if(d.inArray(a.p.ops[e].name,g)!==-1){y=c.op===a.p.ops[e].name?" selected=selected":"";x+="<option value='"+a.p.ops[e].name+"'"+y+">"+a.p.ops[e].description+"</option>"}d(".selectopts",j).empty().append(x);d(".data",j).empty().append(q);d(".input-elm",j).bind("change",function(){c.data=d(this).val();if(d.isArray(c.data))c.data=c.data.join(",");a.onchange()});setTimeout(function(){c.data=d(q).val();a.onchange()},0)}});for(e=n=0;e<a.p.columns.length;e++){m=typeof a.p.columns[e].search==="undefined"?true:a.p.columns[e].search;var A=a.p.columns[e].hidden===true;if(a.p.columns[e].searchoptions.searchhidden===true&&m||m&&!A){m="";if(c.field===a.p.columns[e].name){m=" selected='selected'";n=e}l+="<option value='"+a.p.columns[e].name+"'"+m+">"+a.p.columns[e].label+"</option>"}}r.append(l);l=d("<td class='operators'></td>");b.append(l);h=o.columns[n];h.searchoptions.id=d.jgrid.randId();if(v&&h.inputtype==="text")if(!h.searchoptions.size)h.searchoptions.size=10;n=d.jgrid.createEl(h.inputtype,h.searchoptions,c.data,true,a.p.ajaxSelectOptions,true);var s=d("<select class='selectopts'></select>");l.append(s);s.bind("change",function(){c.op=d(s).val();j=d(this).parents("tr:first");var q=d(".input-elm",j)[0];if(c.op==="nu"||c.op==="nn"){c.data="";q.value="";q.setAttribute("readonly","true");q.setAttribute("disabled","true")}else{q.removeAttribute("readonly");q.removeAttribute("disabled")}a.onchange()});g=h.searchoptions.sopt?h.searchoptions.sopt:a.p.sopt?a.p.sopt:h.searchtype==="string"?o.stropts:a.p.numopts;l="";for(e=0;e<a.p.ops.length;e++)if(d.inArray(a.p.ops[e].name,g)!==-1){m=c.op===a.p.ops[e].name?" selected='selected'":"";l+="<option value='"+a.p.ops[e].name+"'"+m+">"+a.p.ops[e].description+"</option>"}s.append(l);l=d("<td class='data'></td>");b.append(l);l.append(n);d(n).addClass("input-elm").bind("change",function(){c.data=d(this).val();if(d.isArray(c.data))c.data=c.data.join(",");a.onchange()});l=d("<td></td>");b.append(l);n=d("<input type='button' value='-' title='Delete rule' class='delete-rule ui-del'/>");l.append(n);n.bind("click",function(){for(e=0;e<f.rules.length;e++)if(f.rules[e]===c){f.rules.splice(e,1);break}a.reDraw();a.onchange();return false});return b};this.getStringForGroup=function(c){var f="(",a;if(c.groups!==undefined)for(a=0;a<c.groups.length;a++){if(f.length>1)f+=" "+c.groupOp+" ";try{f+=this.getStringForGroup(c.groups[a])}catch(b){alert(b)}}if(c.rules!==undefined)try{for(a=0;a<c.rules.length;a++){if(f.length>1)f+=" "+c.groupOp+" ";f+=this.getStringForRule(c.rules[a])}}catch(e){alert(e)}f+=")";return f==="()"?"":f};this.getStringForRule=function(c){var f="",a="",b,e;for(b=0;b<this.p.ops.length;b++)if(this.p.ops[b].name===c.op){f=this.p.ops[b].operator;a=this.p.ops[b].name;break}for(b=0;b<this.p.columns.length;b++)if(this.p.columns[b].name===c.field){e=this.p.columns[b];break}b=c.data;if(a==="bw"||a==="bn")b+="%";if(a==="ew"||a==="en")b="%"+b;if(a==="cn"||a==="nc")b="%"+b+"%";if(a==="in"||a==="ni")b=" ("+b+")";o.errorcheck&&w(c.data,e);return d.inArray(e.searchtype,["int","integer","float","number","currency"])!==-1||a==="nn"||a==="nu"?c.field+" "+f+" "+b:c.field+" "+f+' "'+b+'"'};this.resetFilter=function(){this.p.filter=d.extend(true,{},this.p.initFilter);this.reDraw();this.onchange()};this.hideError=function(){d("th.ui-state-error",this).html("");d("tr.error",this).hide()};this.showError=function(){d("th.ui-state-error",this).html(this.p.errmsg);d("tr.error",this).show()};this.toUserFriendlyString=function(){return this.getStringForGroup(o.filter)};this.toString=function(){function c(a){var b="(",e;if(a.groups!==undefined)for(e=0;e<a.groups.length;e++){if(b.length>1)b+=a.groupOp==="OR"?" || ":" && ";b+=c(a.groups[e])}if(a.rules!==undefined)for(e=0;e<a.rules.length;e++){if(b.length>1)b+=a.groupOp==="OR"?" || ":" && ";var g=a.rules[e];if(f.p.errorcheck){var j=void 0,h=void 0;for(j=0;j<f.p.columns.length;j++)if(f.p.columns[j].name===g.field){h=f.p.columns[j];break}h&&w(g.data,h)}b+=g.op+"(item."+g.field+",'"+g.data+"')"}b+=")";return b==="()"?"":b}var f=this;return c(this.p.filter)};this.reDraw();if(this.p.showQuery)this.onchange();this.filter=true}}})};d.extend(d.fn.jqFilter,{toSQLString:function(){var k="";this.each(function(){k=this.toUserFriendlyString()});return k},filterData:function(){var k;this.each(function(){k=this.p.filter});return k},getParameter:function(k){if(k!==undefined)if(this.p.hasOwnProperty(k))return this.p[k];return this.p},resetFilter:function(){return this.each(function(){this.resetFilter()})},addFilter:function(k){if(typeof k==="string")k=jQuery.jgrid.parse(k);this.each(function(){this.p.filter=k;this.reDraw();this.onchange()})}})})(jQuery);(function(a){a.jgrid.extend({editRow:function(e,x,l,r,t,y,u,j,s){var f={keys:x||false,oneditfunc:l||null,successfunc:r||null,url:t||null,extraparam:y||{},aftersavefunc:u||null,errorfunc:j||null,afterrestorefunc:s||null,restoreAfterErorr:true},o=a.makeArray(arguments).slice(1),b;b=o[0]&&typeof o[0]=="object"&&!a.isFunction(o[0])?a.extend(f,o[0]):f;return this.each(function(){var d=this,c,m,v=0,q=null,p={},k,g;if(d.grid){k=a(d).jqGrid("getInd",e,true);if(k!==false)if((a(k).attr("editable")||"0")=="0"&&!a(k).hasClass("not-editable-row")){g=d.p.colModel;a("td",k).each(function(h){c=g[h].name;var A=d.p.treeGrid===true&&c==d.p.ExpandColumn;if(A)m=a("span:first",this).html();else try{m=a.unformat(this,{rowId:e,colModel:g[h]},h)}catch(n){m=a(this).html()}if(c!="cb"&&c!="subgrid"&&c!="rn"){if(d.p.autoencode)m=a.jgrid.htmlDecode(m);p[c]=m;if(g[h].editable===true){if(q===null)q=h;A?a("span:first",this).html(""):a(this).html("");var i=a.extend({},g[h].editoptions||{},{id:e+"_"+c,name:c});if(!g[h].edittype)g[h].edittype="text";i=a.jgrid.createEl(g[h].edittype,i,m,true,a.extend({},a.jgrid.ajaxOptions,d.p.ajaxSelectOptions||{}));a(i).addClass("editable");A?a("span:first",this).append(i):a(this).append(i);g[h].edittype=="select"&&g[h].editoptions.multiple===true&&a.browser.msie&&a(i).width(a(i).width());v++}}});if(v>0){p.id=e;d.p.savedRow.push(p);a(k).attr("editable","1");a("td:eq("+q+") input",k).focus();b.keys===true&&a(k).bind("keydown",function(h){h.keyCode===27&&a(d).jqGrid("restoreRow",e,s);if(h.keyCode===13){if(h.target.tagName=="TEXTAREA")return true;a(d).jqGrid("saveRow",e,b);return false}h.stopPropagation()});a.isFunction(b.oneditfunc)&&b.oneditfunc.call(d,e)}}}})},saveRow:function(e,x,l,r,t,y,u){var j={successfunc:x||null,url:l||null,extraparam:r||{},aftersavefunc:t||null,errorfunc:y||null,afterrestorefunc:u||null,restoreAfterErorr:true},s=a.makeArray(arguments).slice(1),f;f=s[0]&&typeof s[0]=="object"&&!a.isFunction(s[0])?a.extend(j,s[0]):j;var o=false,b=this[0],d,c={},m={},v={},q,p,k;if(!b.grid)return o;k=a(b).jqGrid("getInd",e,true);if(k===false)return o;j=a(k).attr("editable");f.url=f.url?f.url:b.p.editurl;if(j==="1"){var g;a("td",k).each(function(n){g=b.p.colModel[n];d=g.name;if(d!="cb"&&d!="subgrid"&&g.editable===true&&d!="rn"&&!a(this).hasClass("not-editable-cell")){switch(g.edittype){case"checkbox":var i=["Yes","No"];if(g.editoptions)i=g.editoptions.value.split(":");c[d]=a("input",this).attr("checked")?i[0]:i[1];break;case"text":case"password":case"textarea":case"button":c[d]=a("input, textarea",this).val();break;case"select":if(g.editoptions.multiple){i=a("select",this);var w=[];c[d]=a(i).val();c[d]=c[d]?c[d].join(","):"";a("select > option:selected",this).each(function(B,C){w[B]=a(C).text()});m[d]=w.join(",")}else{c[d]=a("select>option:selected",this).val();m[d]=a("select>option:selected",this).text()}if(g.formatter&&g.formatter=="select")m={};break;case"custom":try{if(g.editoptions&&a.isFunction(g.editoptions.custom_value)){c[d]=g.editoptions.custom_value.call(b,a(".customelement",this),"get");if(c[d]===undefined)throw"e2";}else throw"e1";}catch(z){z=="e1"&&a.jgrid.info_dialog(jQuery.jgrid.errors.errcap,"function 'custom_value' "+a.jgrid.edit.msg.nodefined,jQuery.jgrid.edit.bClose);z=="e2"?a.jgrid.info_dialog(jQuery.jgrid.errors.errcap,"function 'custom_value' "+a.jgrid.edit.msg.novalue,jQuery.jgrid.edit.bClose):a.jgrid.info_dialog(jQuery.jgrid.errors.errcap,z.message,jQuery.jgrid.edit.bClose)}}p=a.jgrid.checkValues(c[d],n,b);if(p[0]===false){p[1]=c[d]+" "+p[1];return false}if(b.p.autoencode)c[d]=a.jgrid.htmlEncode(c[d]);if(f.url!=="clientArray"&&g.editoptions&&g.editoptions.NullIfEmpty===true)if(c[d]=="")v[d]="null"}});if(p[0]===false){try{var h=a.jgrid.findPos(a("#"+a.jgrid.jqID(e),b.grid.bDiv)[0]);a.jgrid.info_dialog(a.jgrid.errors.errcap,p[1],a.jgrid.edit.bClose,{left:h[0],top:h[1]})}catch(A){alert(p[1])}return o}if(c){j=b.p.prmNames;s=j.oper;h=j.id;c[s]=j.editoper;c[h]=e;if(typeof b.p.inlineData=="undefined")b.p.inlineData={};c=a.extend({},c,b.p.inlineData,f.extraparam)}if(f.url=="clientArray"){c=a.extend({},c,m);b.p.autoencode&&a.each(c,function(n,i){c[n]=a.jgrid.htmlDecode(i)});h=a(b).jqGrid("setRowData",e,c);a(k).attr("editable","0");for(j=0;j<b.p.savedRow.length;j++)if(b.p.savedRow[j].id==e){q=j;break}q>=0&&b.p.savedRow.splice(q,1);a.isFunction(f.aftersavefunc)&&f.aftersavefunc.call(b,e,h);o=true}else{a("#lui_"+b.p.id).show();v=a.extend({},c,v);a.ajax(a.extend({url:f.url,data:a.isFunction(b.p.serializeRowData)?b.p.serializeRowData.call(b,v):v,type:"POST",async:false,complete:function(n,i){a("#lui_"+b.p.id).hide();if(i==="success")if((a.isFunction(f.succesfunc)?f.succesfunc.call(b,n):true)===true){b.p.autoencode&&a.each(c,function(z,B){c[z]=a.jgrid.htmlDecode(B)});c=a.extend({},c,m);a(b).jqGrid("setRowData",e,c);a(k).attr("editable","0");for(var w=0;w<b.p.savedRow.length;w++)if(b.p.savedRow[w].id==e){q=w;break}q>=0&&b.p.savedRow.splice(q,1);a.isFunction(f.aftersavefunc)&&f.aftersavefunc.call(b,e,n);o=true}else{a.isFunction(f.errorfunc)&&f.errorfunc.call(b,e,n,i);f.restoreAfterError===true&&a(b).jqGrid("restoreRow",e,f.afterrestorefunc)}},error:function(n,i){a("#lui_"+b.p.id).hide();if(a.isFunction(f.errorfunc))f.errorfunc.call(b,e,n,i);else try{jQuery.jgrid.info_dialog(jQuery.jgrid.errors.errcap,'<div class="ui-state-error">'+n.responseText+"</div>",jQuery.jgrid.edit.bClose,{buttonalign:"right"})}catch(w){alert(n.responseText)}f.restoreAfterError===true&&a(b).jqGrid("restoreRow",e,f.afterrestorefunc)}},a.jgrid.ajaxOptions,b.p.ajaxRowOptions||{}))}a(k).unbind("keydown")}return o},restoreRow:function(e,x){return this.each(function(){var l=this,r,t,y={};if(l.grid){t=a(l).jqGrid("getInd",e,true);if(t!==false){for(var u=0;u<l.p.savedRow.length;u++)if(l.p.savedRow[u].id==e){r=u;break}if(r>=0){if(a.isFunction(a.fn.datepicker))try{a("input.hasDatepicker","#"+a.jgrid.jqID(t.id)).datepicker("hide")}catch(j){}a.each(l.p.colModel,function(){if(this.editable===true&&this.name in l.p.savedRow[r]&&!a(this).hasClass("not-editable-cell"))y[this.name]=l.p.savedRow[r][this.name]});a(l).jqGrid("setRowData",e,y);a(t).attr("editable","0").unbind("keydown");l.p.savedRow.splice(r,1)}a.isFunction(x)&&x.call(l,e)}}})}})})(jQuery);(function(b){b.jgrid.extend({editCell:function(d,e,a){return this.each(function(){var c=this,h,f,g;if(!(!c.grid||c.p.cellEdit!==true)){e=parseInt(e,10);c.p.selrow=c.rows[d].id;c.p.knv||b(c).jqGrid("GridNav");if(c.p.savedRow.length>0){if(a===true)if(d==c.p.iRow&&e==c.p.iCol)return;b(c).jqGrid("saveCell",c.p.savedRow[0].id,c.p.savedRow[0].ic)}else window.setTimeout(function(){b("#"+c.p.knv).attr("tabindex","-1").focus()},0);h=c.p.colModel[e].name;if(!(h=="subgrid"||h=="cb"||h=="rn")){g=b("td:eq("+e+")",c.rows[d]);if(c.p.colModel[e].editable===true&&a===true&&!g.hasClass("not-editable-cell")){if(parseInt(c.p.iCol,10)>=0&&parseInt(c.p.iRow,10)>=0){b("td:eq("+c.p.iCol+")",c.rows[c.p.iRow]).removeClass("edit-cell ui-state-highlight");b(c.rows[c.p.iRow]).removeClass("selected-row ui-state-hover")}b(g).addClass("edit-cell ui-state-highlight");b(c.rows[d]).addClass("selected-row ui-state-hover");try{f=b.unformat(g,{rowId:c.rows[d].id,colModel:c.p.colModel[e]},e)}catch(k){f=b(g).html()}if(c.p.autoencode)f=b.jgrid.htmlDecode(f);if(!c.p.colModel[e].edittype)c.p.colModel[e].edittype="text";c.p.savedRow.push({id:d,ic:e,name:h,v:f});if(b.isFunction(c.p.formatCell)){var j=c.p.formatCell.call(c,c.rows[d].id,h,f,d,e);if(j!==undefined)f=j}j=b.extend({},c.p.colModel[e].editoptions||{},{id:d+"_"+h,name:h});var i=b.jgrid.createEl(c.p.colModel[e].edittype,j,f,true,b.extend({},b.jgrid.ajaxOptions,c.p.ajaxSelectOptions||{}));b.isFunction(c.p.beforeEditCell)&&c.p.beforeEditCell.call(c,c.rows[d].id,h,f,d,e);b(g).html("").append(i).attr("tabindex","0");window.setTimeout(function(){b(i).focus()},0);b("input, select, textarea",g).bind("keydown",function(l){if(l.keyCode===27)if(b("input.hasDatepicker",g).length>0)b(".ui-datepicker").is(":hidden")?b(c).jqGrid("restoreCell",d,e):b("input.hasDatepicker",g).datepicker("hide");else b(c).jqGrid("restoreCell",d,e);l.keyCode===13&&b(c).jqGrid("saveCell",d,e);if(l.keyCode==9)if(c.grid.hDiv.loading)return false;else l.shiftKey?b(c).jqGrid("prevCell",d,e):b(c).jqGrid("nextCell",d,e);l.stopPropagation()});b.isFunction(c.p.afterEditCell)&&c.p.afterEditCell.call(c,c.rows[d].id,h,f,d,e)}else{if(parseInt(c.p.iCol,10)>=0&&parseInt(c.p.iRow,10)>=0){b("td:eq("+c.p.iCol+")",c.rows[c.p.iRow]).removeClass("edit-cell ui-state-highlight");b(c.rows[c.p.iRow]).removeClass("selected-row ui-state-hover")}g.addClass("edit-cell ui-state-highlight");b(c.rows[d]).addClass("selected-row ui-state-hover");if(b.isFunction(c.p.onSelectCell)){f=g.html().replace(/\&#160\;/ig,"");c.p.onSelectCell.call(c,c.rows[d].id,h,f,d,e)}}c.p.iCol=e;c.p.iRow=d}}})},saveCell:function(d,e){return this.each(function(){var a=this,c;if(!(!a.grid||a.p.cellEdit!==true)){c=a.p.savedRow.length>=1?0:null;if(c!==null){var h=b("td:eq("+e+")",a.rows[d]),f,g,k=a.p.colModel[e],j=k.name,i=b.jgrid.jqID(j);switch(k.edittype){case"select":if(k.editoptions.multiple){i=b("#"+d+"_"+i,a.rows[d]);var l=[];if(f=b(i).val())f.join(",");else f="";b("option:selected",i).each(function(o,p){l[o]=b(p).text()});g=l.join(",")}else{f=b("#"+d+"_"+i+">option:selected",a.rows[d]).val();g=b("#"+d+"_"+i+">option:selected",a.rows[d]).text()}if(k.formatter)g=f;break;case"checkbox":var m=["Yes","No"];if(k.editoptions)m=k.editoptions.value.split(":");g=f=b("#"+d+"_"+i,a.rows[d]).attr("checked")?m[0]:m[1];break;case"password":case"text":case"textarea":case"button":g=f=b("#"+d+"_"+i,a.rows[d]).val();break;case"custom":try{if(k.editoptions&&b.isFunction(k.editoptions.custom_value)){f=k.editoptions.custom_value.call(a,b(".customelement",h),"get");if(f===undefined)throw"e2";else g=f}else throw"e1";}catch(q){q=="e1"&&b.jgrid.info_dialog(jQuery.jgrid.errors.errcap,"function 'custom_value' "+b.jgrid.edit.msg.nodefined,jQuery.jgrid.edit.bClose);q=="e2"?b.jgrid.info_dialog(jQuery.jgrid.errors.errcap,"function 'custom_value' "+b.jgrid.edit.msg.novalue,jQuery.jgrid.edit.bClose):b.jgrid.info_dialog(jQuery.jgrid.errors.errcap,q.message,jQuery.jgrid.edit.bClose)}}if(g!=a.p.savedRow[c].v){if(b.isFunction(a.p.beforeSaveCell))if(c=a.p.beforeSaveCell.call(a,a.rows[d].id,j,f,d,e))g=f=c;var r=b.jgrid.checkValues(f,e,a);if(r[0]===true){c={};if(b.isFunction(a.p.beforeSubmitCell))(c=a.p.beforeSubmitCell.call(a,a.rows[d].id,j,f,d,e))||(c={});b("input.hasDatepicker",h).length>0&&b("input.hasDatepicker",h).datepicker("hide");if(a.p.cellsubmit=="remote")if(a.p.cellurl){var n={};if(a.p.autoencode)f=b.jgrid.htmlEncode(f);n[j]=f;m=a.p.prmNames;k=m.id;i=m.oper;n[k]=a.rows[d].id;n[i]=m.editoper;n=b.extend(c,n);b("#lui_"+a.p.id).show();a.grid.hDiv.loading=true;b.ajax(b.extend({url:a.p.cellurl,data:b.isFunction(a.p.serializeCellData)?a.p.serializeCellData.call(a,n):n,type:"POST",complete:function(o,p){b("#lui_"+a.p.id).hide();a.grid.hDiv.loading=false;if(p=="success")if(b.isFunction(a.p.afterSubmitCell)){var s=a.p.afterSubmitCell.call(a,o,n.id,j,f,d,e);if(s[0]===true){b(h).empty();b(a).jqGrid("setCell",a.rows[d].id,e,g,false,false,true);b(h).addClass("dirty-cell");b(a.rows[d]).addClass("edited");b.isFunction(a.p.afterSaveCell)&&a.p.afterSaveCell.call(a,a.rows[d].id,j,f,d,e);a.p.savedRow.splice(0,1)}else{b.jgrid.info_dialog(b.jgrid.errors.errcap,s[1],b.jgrid.edit.bClose);b(a).jqGrid("restoreCell",d,e)}}else{b(h).empty();b(a).jqGrid("setCell",a.rows[d].id,e,g,false,false,true);b(h).addClass("dirty-cell");b(a.rows[d]).addClass("edited");b.isFunction(a.p.afterSaveCell)&&a.p.afterSaveCell.call(a,a.rows[d].id,j,f,d,e);a.p.savedRow.splice(0,1)}},error:function(o,p){b("#lui_"+a.p.id).hide();a.grid.hDiv.loading=false;b.isFunction(a.p.errorCell)?a.p.errorCell.call(a,o,p):b.jgrid.info_dialog(b.jgrid.errors.errcap,o.status+" : "+o.statusText+"<br/>"+
p,b.jgrid.edit.bClose);b(a).jqGrid("restoreCell",d,e)}},b.jgrid.ajaxOptions,a.p.ajaxCellOptions||{}))}else try{b.jgrid.info_dialog(b.jgrid.errors.errcap,b.jgrid.errors.nourl,b.jgrid.edit.bClose);b(a).jqGrid("restoreCell",d,e)}catch(t){}if(a.p.cellsubmit=="clientArray"){b(h).empty();b(a).jqGrid("setCell",a.rows[d].id,e,g,false,false,true);b(h).addClass("dirty-cell");b(a.rows[d]).addClass("edited");b.isFunction(a.p.afterSaveCell)&&a.p.afterSaveCell.call(a,a.rows[d].id,j,f,d,e);a.p.savedRow.splice(0,1)}}else try{window.setTimeout(function(){b.jgrid.info_dialog(b.jgrid.errors.errcap,f+" "+r[1],b.jgrid.edit.bClose)},100);b(a).jqGrid("restoreCell",d,e)}catch(u){}}else b(a).jqGrid("restoreCell",d,e)}b.browser.opera?b("#"+a.p.knv).attr("tabindex","-1").focus():window.setTimeout(function(){b("#"+a.p.knv).attr("tabindex","-1").focus()},0)}})},restoreCell:function(d,e){return this.each(function(){var a=this,c;if(!(!a.grid||a.p.cellEdit!==true)){c=a.p.savedRow.length>=1?0:null;if(c!==null){var h=b("td:eq("+
e+")",a.rows[d]);if(b.isFunction(b.fn.datepicker))try{b("input.hasDatepicker",h).datepicker("hide")}catch(f){}b(h).empty().attr("tabindex","-1");b(a).jqGrid("setCell",a.rows[d].id,e,a.p.savedRow[c].v,false,false,true);b.isFunction(a.p.afterRestoreCell)&&a.p.afterRestoreCell.call(a,a.rows[d].id,a.p.savedRow[c].v,d,e);a.p.savedRow.splice(0,1)}window.setTimeout(function(){b("#"+a.p.knv).attr("tabindex","-1").focus()},0)}})},nextCell:function(d,e){return this.each(function(){var a=false;if(!(!this.grid||this.p.cellEdit!==true)){for(var c=e+1;c<this.p.colModel.length;c++)if(this.p.colModel[c].editable===true){a=c;break}if(a!==false)b(this).jqGrid("editCell",d,a,true);else this.p.savedRow.length>0&&b(this).jqGrid("saveCell",d,e)}})},prevCell:function(d,e){return this.each(function(){var a=false;if(!(!this.grid||this.p.cellEdit!==true)){for(var c=e-1;c>=0;c--)if(this.p.colModel[c].editable===true){a=c;break}if(a!==false)b(this).jqGrid("editCell",d,a,true);else this.p.savedRow.length>0&&b(this).jqGrid("saveCell",d,e)}})},GridNav:function(){return this.each(function(){function d(g,k,j){if(j.substr(0,1)=="v"){var i=b(a.grid.bDiv)[0].clientHeight,l=b(a.grid.bDiv)[0].scrollTop,m=a.rows[g].offsetTop+a.rows[g].clientHeight,q=a.rows[g].offsetTop;if(j=="vd")if(m>=i)b(a.grid.bDiv)[0].scrollTop=b(a.grid.bDiv)[0].scrollTop+a.rows[g].clientHeight;if(j=="vu")if(q<l)b(a.grid.bDiv)[0].scrollTop=b(a.grid.bDiv)[0].scrollTop-a.rows[g].clientHeight}if(j=="h"){j=b(a.grid.bDiv)[0].clientWidth;i=b(a.grid.bDiv)[0].scrollLeft;l=a.rows[g].cells[k].offsetLeft;if(a.rows[g].cells[k].offsetLeft+a.rows[g].cells[k].clientWidth>=j+parseInt(i,10))b(a.grid.bDiv)[0].scrollLeft=b(a.grid.bDiv)[0].scrollLeft+a.rows[g].cells[k].clientWidth;else if(l<i)b(a.grid.bDiv)[0].scrollLeft=b(a.grid.bDiv)[0].scrollLeft-a.rows[g].cells[k].clientWidth}}function e(g,k){var j,i;if(k=="lft"){j=g+1;for(i=g;i>=0;i--)if(a.p.colModel[i].hidden!==true){j=i;break}}if(k=="rgt"){j=g-1;for(i=g;i<a.p.colModel.length;i++)if(a.p.colModel[i].hidden!==true){j=i;break}}return j}
var a=this;if(!(!a.grid||a.p.cellEdit!==true)){a.p.knv=a.p.id+"_kn";var c=b("<span style='width:0px;height:0px;background-color:black;' tabindex='0'><span tabindex='-1' style='width:0px;height:0px;background-color:grey' id='"+a.p.knv+"'></span></span>"),h,f;b(c).insertBefore(a.grid.cDiv);b("#"+a.p.knv).focus().keydown(function(g){f=g.keyCode;if(a.p.direction=="rtl")if(f==37)f=39;else if(f==39)f=37;switch(f){case 38:if(a.p.iRow-1>0){d(a.p.iRow-1,a.p.iCol,"vu");b(a).jqGrid("editCell",a.p.iRow-1,a.p.iCol,false)}break;case 40:if(a.p.iRow+1<=a.rows.length-1){d(a.p.iRow+1,a.p.iCol,"vd");b(a).jqGrid("editCell",a.p.iRow+1,a.p.iCol,false)}break;case 37:if(a.p.iCol-1>=0){h=e(a.p.iCol-1,"lft");d(a.p.iRow,h,"h");b(a).jqGrid("editCell",a.p.iRow,h,false)}break;case 39:if(a.p.iCol+1<=a.p.colModel.length-1){h=e(a.p.iCol+1,"rgt");d(a.p.iRow,h,"h");b(a).jqGrid("editCell",a.p.iRow,h,false)}break;case 13:parseInt(a.p.iCol,10)>=0&&parseInt(a.p.iRow,10)>=0&&b(a).jqGrid("editCell",a.p.iRow,a.p.iCol,true)}return false})}})},getChangedCells:function(d){var e=[];d||(d="all");this.each(function(){var a=this,c;!a.grid||a.p.cellEdit!==true||b(a.rows).each(function(h){var f={};if(b(this).hasClass("edited")){b("td",this).each(function(g){c=a.p.colModel[g].name;if(c!=="cb"&&c!=="subgrid")if(d=="dirty"){if(b(this).hasClass("dirty-cell"))try{f[c]=b.unformat(this,{rowId:a.rows[h].id,colModel:a.p.colModel[g]},g)}catch(k){f[c]=b.jgrid.htmlDecode(b(this).html())}}else try{f[c]=b.unformat(this,{rowId:a.rows[h].id,colModel:a.p.colModel[g]},g)}catch(j){f[c]=b.jgrid.htmlDecode(b(this).html())}});f.id=this.id;e.push(f)}})});return e}})})(jQuery);(function(b){b.fn.jqm=function(a){var f={overlay:50,closeoverlay:true,overlayClass:"jqmOverlay",closeClass:"jqmClose",trigger:".jqModal",ajax:e,ajaxText:"",target:e,modal:e,toTop:e,onShow:e,onHide:e,onLoad:e};return this.each(function(){if(this._jqm)return j[this._jqm].c=b.extend({},j[this._jqm].c,a);l++;this._jqm=l;j[l]={c:b.extend(f,b.jqm.params,a),a:e,w:b(this).addClass("jqmID"+l),s:l};f.trigger&&b(this).jqmAddTrigger(f.trigger)})};b.fn.jqmAddClose=function(a){return o(this,a,"jqmHide")};b.fn.jqmAddTrigger=function(a){return o(this,a,"jqmShow")};b.fn.jqmShow=function(a){return this.each(function(){b.jqm.open(this._jqm,a)})};b.fn.jqmHide=function(a){return this.each(function(){b.jqm.close(this._jqm,a)})};b.jqm={hash:{},open:function(a,f){var c=j[a],d=c.c,i="."+d.closeClass,g=parseInt(c.w.css("z-index"));g=g>0?g:3E3;var h=b("<div></div>").css({height:"100%",width:"100%",position:"fixed",left:0,top:0,"z-index":g-1,opacity:d.overlay/100});if(c.a)return e;c.t=f;c.a=true;c.w.css("z-index",g);if(d.modal){k[0]||setTimeout(function(){p("bind")},1);k.push(a)}else if(d.overlay>0)d.closeoverlay&&c.w.jqmAddClose(h);else h=e;c.o=h?h.addClass(d.overlayClass).prependTo("body"):e;if(q){b("html,body").css({height:"100%",width:"100%"});if(h){h=h.css({position:"absolute"})[0];for(var m in{Top:1,Left:1})h.style.setExpression(m.toLowerCase(),"(_=(document.documentElement.scroll"+m+" || document.body.scroll"+m+"))+'px'")}}if(d.ajax){g=d.target||c.w;h=d.ajax;g=typeof g=="string"?b(g,c.w):b(g);h=h.substr(0,1)=="@"?b(f).attr(h.substring(1)):h;g.html(d.ajaxText).load(h,function(){d.onLoad&&d.onLoad.call(this,c);i&&c.w.jqmAddClose(b(i,c.w));r(c)})}else i&&c.w.jqmAddClose(b(i,c.w));d.toTop&&c.o&&c.w.before('<span id="jqmP'+c.w[0]._jqm+'"></span>').insertAfter(c.o);d.onShow?d.onShow(c):c.w.show();r(c);return e},close:function(a){a=j[a];if(!a.a)return e;a.a=e;if(k[0]){k.pop();k[0]||p("unbind")}a.c.toTop&&a.o&&b("#jqmP"+a.w[0]._jqm).after(a.w).remove();if(a.c.onHide)a.c.onHide(a);else{a.w.hide();a.o&&a.o.remove()}return e},params:{}};var l=0,j=b.jqm.hash,k=[],q=b.browser.msie&&b.browser.version=="6.0",e=false,r=function(a){var f=b('<iframe src="javascript:false;document.write(\'\');" class="jqm"></iframe>').css({opacity:0});if(q)if(a.o)a.o.html('<p style="width:100%;height:100%"/>').prepend(f);else b("iframe.jqm",a.w)[0]||a.w.prepend(f);s(a)},s=function(a){try{b(":input:visible",a.w)[0].focus()}catch(f){}},p=function(a){b(document)[a]("keypress",n)[a]("keydown",n)[a]("mousedown",n)},n=function(a){var f=j[k[k.length-1]];(a=!b(a.target).parents(".jqmID"+
f.s)[0])&&s(f);return!a},o=function(a,f,c){return a.each(function(){var d=this._jqm;b(f).each(function(){if(!this[c]){this[c]=[];b(this).click(function(){for(var i in{jqmShow:1,jqmHide:1})for(var g in this[i])if(j[this[i][g]])j[this[i][g]].w[i](this);return e})}this[c].push(d)})})}})(jQuery);(function(b){b.fn.jqDrag=function(a){return l(this,a,"d")};b.fn.jqResize=function(a,e){return l(this,a,"r",e)};b.jqDnR={dnr:{},e:0,drag:function(a){if(c.k=="d")d.css({left:c.X+a.pageX-c.pX,top:c.Y+a.pageY-c.pY});else{d.css({width:Math.max(a.pageX-c.pX+c.W,0),height:Math.max(a.pageY-c.pY+c.H,0)});M1&&f.css({width:Math.max(a.pageX-M1.pX+M1.W,0),height:Math.max(a.pageY-M1.pY+M1.H,0)})}return false},stop:function(){b(document).unbind("mousemove",i.drag).unbind("mouseup",i.stop)}};var i=b.jqDnR,c=i.dnr,d=i.e,f,l=function(a,e,n,m){return a.each(function(){e=e?b(e,a):a;e.bind("mousedown",{e:a,k:n},function(g){var j=g.data,h={};d=j.e;f=m?b(m):false;if(d.css("position")!="relative")try{d.position(h)}catch(o){}c={X:h.left||k("left")||0,Y:h.top||k("top")||0,W:k("width")||d[0].scrollWidth||0,H:k("height")||d[0].scrollHeight||0,pX:g.pageX,pY:g.pageY,k:j.k};M1=f&&j.k!="d"?{X:h.left||f1("left")||0,Y:h.top||f1("top")||0,W:f[0].offsetWidth||f1("width")||0,H:f[0].offsetHeight||f1("height")||0,pX:g.pageX,pY:g.pageY,k:j.k}:false;if(b("input.hasDatepicker",d[0])[0])try{b("input.hasDatepicker",d[0]).datepicker("hide")}catch(p){}b(document).mousemove(b.jqDnR.drag).mouseup(b.jqDnR.stop);return false})})},k=function(a){return parseInt(d.css(a))||false};f1=function(a){return parseInt(f.css(a))||false}})(jQuery);(function(b){b.jgrid.extend({setSubGrid:function(){return this.each(function(){var f;this.p.subGridOptions=b.extend({plusicon:"ui-icon-plus",minusicon:"ui-icon-minus",openicon:"ui-icon-carat-1-sw",expandOnLoad:false,delayOnLoad:50,selectOnExpand:false,reloadOnExpand:true},this.p.subGridOptions||{});this.p.colNames.unshift("");this.p.colModel.unshift({name:"subgrid",width:b.browser.safari?this.p.subGridWidth+this.p.cellLayout:this.p.subGridWidth,sortable:false,resizable:false,hidedlg:true,search:false,fixed:true});f=this.p.subGridModel;if(f[0]){f[0].align=b.extend([],f[0].align||[]);for(var a=0;a<f[0].name.length;a++)f[0].align[a]=f[0].align[a]||"left"}})},addSubGridCell:function(f,a){var j="",q,r;this.each(function(){j=this.formatCol(f,a);r=this.p.id;q=this.p.subGridOptions.plusicon});return'<td role="grid" aria-describedby="'+r+'_subgrid" class="ui-sgcollapsed sgcollapsed" '+j+"><a href='javascript:void(0);'><span class='ui-icon "+q+"'></span></a></td>"},addSubGrid:function(f){return this.each(function(){var a=this;if(a.grid){var j=function(i,d,e){d=b("<td align='"+a.p.subGridModel[0].align[e]+"'></td>").html(d);b(i).append(d)},q=function(i,d){var e,c,g,k=b("<table cellspacing='0' cellpadding='0' border='0'><tbody></tbody></table>"),h=b("<tr></tr>");for(c=0;c<a.p.subGridModel[0].name.length;c++){e=b("<th class='ui-state-default ui-th-subgrid ui-th-column ui-th-"+a.p.direction+"'></th>");b(e).html(a.p.subGridModel[0].name[c]);b(e).width(a.p.subGridModel[0].width[c]);b(h).append(e)}b(k).append(h);if(i){g=a.p.xmlReader.subgrid;b(g.root+" "+g.row,i).each(function(){h=b("<tr class='ui-widget-content ui-subtblcell'></tr>");if(g.repeatitems===true)b(g.cell,this).each(function(m){j(h,b(this).text()||"&#160;",m)});else{var n=a.p.subGridModel[0].mapping||a.p.subGridModel[0].name;if(n)for(c=0;c<n.length;c++)j(h,b(n[c],this).text()||"&#160;",c)}b(k).append(h)})}e=b("table:first",a.grid.bDiv).attr("id")+"_";b("#"+e+d).append(k);a.grid.hDiv.loading=false;b("#load_"+a.p.id).hide();return false},r=function(i,d){var e,c,g,k,h,n=b("<table cellspacing='0' cellpadding='0' border='0'><tbody></tbody></table>"),m=b("<tr></tr>");for(c=0;c<a.p.subGridModel[0].name.length;c++){e=b("<th class='ui-state-default ui-th-subgrid ui-th-column ui-th-"+a.p.direction+"'></th>");b(e).html(a.p.subGridModel[0].name[c]);b(e).width(a.p.subGridModel[0].width[c]);b(m).append(e)}b(n).append(m);if(i){k=a.p.jsonReader.subgrid;e=i[k.root];if(typeof e!=="undefined")for(c=0;c<e.length;c++){g=e[c];m=b("<tr class='ui-widget-content ui-subtblcell'></tr>");if(k.repeatitems===true){if(k.cell)g=g[k.cell];for(h=0;h<g.length;h++)j(m,g[h]||"&#160;",h)}else{var t=a.p.subGridModel[0].mapping||a.p.subGridModel[0].name;if(t.length)for(h=0;h<t.length;h++)j(m,g[t[h]]||"&#160;",h)}b(n).append(m)}}c=b("table:first",a.grid.bDiv).attr("id")+"_";b("#"+c+d).append(n);a.grid.hDiv.loading=false;b("#load_"+a.p.id).hide();return false},w=function(i){var d,e,c,g;d=b(i).attr("id");e={nd_:(new Date).getTime()};e[a.p.prmNames.subgridid]=d;if(!a.p.subGridModel[0])return false;if(a.p.subGridModel[0].params)for(g=0;g<a.p.subGridModel[0].params.length;g++)for(c=0;c<a.p.colModel.length;c++)if(a.p.colModel[c].name==a.p.subGridModel[0].params[g])e[a.p.colModel[c].name]=b("td:eq("+c+")",i).text().replace(/\&#160\;/ig,"");if(!a.grid.hDiv.loading){a.grid.hDiv.loading=true;b("#load_"+a.p.id).show();if(!a.p.subgridtype)a.p.subgridtype=a.p.datatype;if(b.isFunction(a.p.subgridtype))a.p.subgridtype.call(a,e);else a.p.subgridtype=a.p.subgridtype.toLowerCase();switch(a.p.subgridtype){case"xml":case"json":b.ajax(b.extend({type:a.p.mtype,url:a.p.subGridUrl,dataType:a.p.subgridtype,data:b.isFunction(a.p.serializeSubGridData)?a.p.serializeSubGridData.call(a,e):e,complete:function(k){a.p.subgridtype=="xml"?q(k.responseXML,d):r(b.jgrid.parse(k.responseText),d)}},b.jgrid.ajaxOptions,a.p.ajaxSubgridOptions||{}))}}return false},l,s,u,v=0,o,p;b.each(a.p.colModel,function(){if(this.hidden===true||this.name=="rn"||this.name=="cb")v++});b(a.rows).each(function(i){var d=this;if(b(d).hasClass("jqgrow")){b(this.cells[f]).bind("click",function(){p=d.nextSibling;if(b(this).hasClass("sgcollapsed")){s=a.p.id;l=d.id;if(a.p.subGridOptions.reloadOnExpand===true||a.p.subGridOptions.reloadOnExpand===false&&!b(p).hasClass("ui-subgrid")){u=f>=1?"<td colspan='"+f+"'>&#160;</td>":"";o=true;if(b.isFunction(a.p.subGridBeforeExpand))o=a.p.subGridBeforeExpand.call(a,s+"_"+l,l);if(o===false)return false;b(d).after("<tr role='row' class='ui-subgrid'>"+u+"<td class='ui-widget-content subgrid-cell'><span class='ui-icon "+a.p.subGridOptions.openicon+"'></span></td><td colspan='"+
parseInt(a.p.colNames.length-1-v,10)+"' class='ui-widget-content subgrid-data'><div id="+s+"_"+l+" class='tablediv'></div></td></tr>");b.isFunction(a.p.subGridRowExpanded)?a.p.subGridRowExpanded.call(a,s+"_"+l,l):w(d)}else b(p).show();b(this).html("<a href='javascript:void(0);'><span class='ui-icon "+a.p.subGridOptions.minusicon+"'></span></a>").removeClass("sgcollapsed").addClass("sgexpanded");a.p.subGridOptions.selectOnExpand&&b(a).jqGrid("setSelection",l)}else if(b(this).hasClass("sgexpanded")){o=true;if(b.isFunction(a.p.subGridRowColapsed)){l=d.id;o=a.p.subGridRowColapsed.call(a,s+"_"+l,l)}if(o===false)return false;if(a.p.subGridOptions.reloadOnExpand===true)b(p).remove(".ui-subgrid");else b(p).hasClass("ui-subgrid")&&b(p).hide();b(this).html("<a href='javascript:void(0);'><span class='ui-icon "+a.p.subGridOptions.plusicon+"'></span></a>").removeClass("sgexpanded").addClass("sgcollapsed")}return false});a.p.subGridOptions.expandOnLoad===true&&setTimeout(function(){b(d.cells[f]).trigger("click")},i*a.p.subGridOptions.delayOnLoad)}});a.subGridXml=function(i,d){q(i,d)};a.subGridJson=function(i,d){r(i,d)}}})},expandSubGridRow:function(f){return this.each(function(){if(this.grid||f)if(this.p.subGrid===true){var a=b(this).jqGrid("getInd",f,true);if(a)(a=b("td.sgcollapsed",a)[0])&&b(a).trigger("click")}})},collapseSubGridRow:function(f){return this.each(function(){if(this.grid||f)if(this.p.subGrid===true){var a=b(this).jqGrid("getInd",f,true);if(a)(a=b("td.sgexpanded",a)[0])&&b(a).trigger("click")}})},toggleSubGridRow:function(f){return this.each(function(){if(this.grid||f)if(this.p.subGrid===true){var a=b(this).jqGrid("getInd",f,true);if(a){var j=b("td.sgcollapsed",a)[0];if(j)b(j).trigger("click");else(j=b("td.sgexpanded",a)[0])&&b(j).trigger("click")}}})}})})(jQuery);(function(e){e.jgrid.extend({groupingSetup:function(){return this.each(function(){var a=this.p.groupingView;if(a!==null&&(typeof a==="object"||e.isFunction(a)))if(a.groupField.length){if(typeof a.visibiltyOnNextGrouping=="undefined")a.visibiltyOnNextGrouping=[];for(var b=0;b<a.groupField.length;b++){a.groupOrder[b]||(a.groupOrder[b]="asc");a.groupText[b]||(a.groupText[b]="{0}");if(typeof a.groupColumnShow[b]!="boolean")a.groupColumnShow[b]=true;if(typeof a.groupSummary[b]!="boolean")a.groupSummary[b]=false;if(a.groupColumnShow[b]===true){a.visibiltyOnNextGrouping[b]=true;e(this).jqGrid("showCol",a.groupField[b])}else{a.visibiltyOnNextGrouping[b]=e("#"+this.p.id+"_"+a.groupField[b]).is(":visible");e(this).jqGrid("hideCol",a.groupField[b])}a.sortitems[b]=[];a.sortnames[b]=[];a.summaryval[b]=[];if(a.groupSummary[b]){a.summary[b]=[];for(var c=this.p.colModel,d=0,g=c.length;d<g;d++)c[d].summaryType&&a.summary[b].push({nm:c[d].name,st:c[d].summaryType,v:""})}}this.p.scroll=false;this.p.rownumbers=false;this.p.subGrid=false;this.p.treeGrid=false;this.p.gridview=true}else this.p.grouping=false;else this.p.grouping=false})},groupingPrepare:function(a,b,c,d){this.each(function(){b[0]+="";var g=b[0].toString().split(" ").join(""),h=this.p.groupingView,f=this;if(c.hasOwnProperty(g))c[g].push(a);else{c[g]=[];c[g].push(a);h.sortitems[0].push(g);h.sortnames[0].push(e.trim(b[0].toString()));h.summaryval[0][g]=e.extend(true,[],h.summary[0])}h.groupSummary[0]&&e.each(h.summaryval[0][g],function(){this.v=e.isFunction(this.st)?this.st.call(f,this.v,this.nm,d):e(f).jqGrid("groupingCalculations."+this.st,this.v,this.nm,d)})});return c},groupingToggle:function(a){this.each(function(){var b=this.p.groupingView,c=a.lastIndexOf("_"),d=a.substring(0,c+1);c=parseInt(a.substring(c+1),10)+1;var g=b.minusicon,h=b.plusicon,f=e("#"+a)[0].nextSibling,k=e("#"+a+" span.tree-wrap-"+this.p.direction),l=false;if(k.hasClass(g)){if(b.showSummaryOnHide&&b.groupSummary[0]){if(f)for(;f;){if(e(f).hasClass("jqfoot"))break;e(f).hide();f=f.nextSibling}}else if(f)for(;f;){if(e(f).attr("id")==d+String(c))break;e(f).hide();f=f.nextSibling}k.removeClass(g).addClass(h);l=true}else{if(f)for(;f;){if(e(f).attr("id")==d+String(c))break;e(f).show();f=f.nextSibling}k.removeClass(h).addClass(g);l=false}e.isFunction(this.p.onClickGroup)&&this.p.onClickGroup.call(this,a,l)});return false},groupingRender:function(a,b){return this.each(function(){var c=this,d=c.p.groupingView,g="",h="",f,k="",l,r,m;if(!d.groupDataSorted){d.sortitems[0].sort();d.sortnames[0].sort();if(d.groupOrder[0].toLowerCase()=="desc"){d.sortitems[0].reverse();d.sortnames[0].reverse()}}k=d.groupCollapse?d.plusicon:d.minusicon;k+=" tree-wrap-"+c.p.direction;for(m=0;m<b;){if(c.p.colModel[m].name==d.groupField[0]){r=m;break}m++}e.each(d.sortitems[0],function(o,n){f=c.p.id+"ghead_"+o;h="<span style='cursor:pointer;' class='ui-icon "+k+"' onclick=\"jQuery('#"+c.p.id+"').jqGrid('groupingToggle','"+f+"');return false;\"></span>";try{l=c.formatter(f,d.sortnames[0][o],r,d.sortitems[0])}catch(v){l=d.sortnames[0][o]}g+='<tr id="'+
f+'" role="row" class= "ui-widget-content jqgroup ui-row-'+c.p.direction+'"><td colspan="'+b+'">'+h+e.jgrid.format(d.groupText[0],l,a[n].length)+"</td></tr>";for(var i=0;i<a[n].length;i++)g+=a[n][i].join("");if(d.groupSummary[0]){i="";if(d.groupCollapse&&!d.showSummaryOnHide)i=' style="display:none;"';g+="<tr"+i+' role="row" class="ui-widget-content jqfoot ui-row-'+c.p.direction+'">';i=d.summaryval[0][n];for(var p=c.p.colModel,q,s=a[n].length,j=0;j<b;j++){var t="<td "+c.formatCol(j,1,"")+">&#160;</td>",u="{0}";e.each(i,function(){if(this.nm==p[j].name){if(p[j].summaryTpl)u=p[j].summaryTpl;if(this.st=="avg")if(this.v&&s>0)this.v/=s;try{q=c.formatter("",this.v,j,this)}catch(w){q=this.v}t="<td "+c.formatCol(j,1,"")+">"+e.jgrid.format(u,q)+"</td>";return false}});g+=t}g+="</tr>"}});e("#"+c.p.id+" tbody:first").append(g);g=null})},groupingGroupBy:function(a,b){return this.each(function(){if(typeof a=="string")a=[a];var c=this.p.groupingView;this.p.grouping=true;for(var d=0;d<c.groupField.length;d++)!c.groupColumnShow[d]&&c.visibiltyOnNextGrouping[d]&&e(this).jqGrid("showCol",c.groupField[d]);for(d=0;d<a.length;d++)c.visibiltyOnNextGrouping[d]=e("#"+this.p.id+"_"+a[d]).is(":visible");this.p.groupingView=e.extend(this.p.groupingView,b||{});c.groupField=a;e(this).trigger("reloadGrid")})},groupingRemove:function(a){return this.each(function(){if(typeof a=="undefined")a=true;this.p.grouping=false;if(a===true){for(var b=this.p.groupingView,c=0;c<b.groupField.length;c++)!b.groupColumnShow[c]&&b.visibiltyOnNextGrouping[c]&&e(this).jqGrid("showCol",b.groupField);e("tr.jqgroup, tr.jqfoot","#"+this.p.id+" tbody:first").remove();e("tr.jqgrow:hidden","#"+this.p.id+" tbody:first").show()}else e(this).trigger("reloadGrid")})},groupingCalculations:{sum:function(a,b,c){return parseFloat(a||0)+parseFloat(c[b]||0)},min:function(a,b,c){if(a==="")return parseFloat(c[b]||0);return Math.min(parseFloat(a),parseFloat(c[b]||0))},max:function(a,b,c){if(a==="")return parseFloat(c[b]||0);return Math.max(parseFloat(a),parseFloat(c[b]||0))},count:function(a,b,c){if(a==="")a=0;return c.hasOwnProperty(b)?a+1:0},avg:function(a,b,c){return parseFloat(a||0)+parseFloat(c[b]||0)}}})})(jQuery);(function(d){d.jgrid.extend({setTreeNode:function(b,c){return this.each(function(){var a=this;if(a.grid&&a.p.treeGrid)for(var e=a.p.expColInd,g=a.p.treeReader.expanded_field,h=a.p.treeReader.leaf_field,f=a.p.treeReader.level_field,k=a.p.treeReader.icon_field,i=a.p.treeReader.loaded,j,o,n,l;b<c;){l=a.p.data[a.p._index[a.rows[b].id]];if(a.p.treeGridModel=="nested")if(!l[h]){j=parseInt(l[a.p.treeReader.left_field],10);o=parseInt(l[a.p.treeReader.right_field],10);l[h]=o===j+1?"true":"false";a.rows[b].cells[a.p._treeleafpos].innerHTML=l[h]}j=parseInt(l[f],10);if(a.p.tree_root_level===0){n=j+1;o=j}else{n=j;o=j-1}n="<div class='tree-wrap tree-wrap-"+a.p.direction+"' style='width:"+n*18+"px;'>";n+="<div style='"+(a.p.direction=="rtl"?"right:":"left:")+o*18+"px;' class='ui-icon ";if(l[i]!==undefined)l[i]=l[i]=="true"||l[i]===true?true:false;if(l[h]=="true"||l[h]===true){n+=(l[k]!==undefined&&l[k]!==""?l[k]:a.p.treeIcons.leaf)+" tree-leaf treeclick'";l[h]=true;o="leaf"}else{l[h]=false;o=""}l[g]=(l[g]=="true"||l[g]===true?true:false)&&l[i];n+=l[g]===true?a.p.treeIcons.minus+" tree-minus treeclick'":a.p.treeIcons.plus+" tree-plus treeclick'";n+="</div></div>";d(a.rows[b].cells[e]).wrapInner("<span class='cell-wrapper"+o+"'></span>").prepend(n);if(j!==parseInt(a.p.tree_root_level,10))(l=(l=d(a).jqGrid("getNodeParent",l))&&l.hasOwnProperty(g)?l[g]:true)||d(a.rows[b]).css("display","none");d(a.rows[b].cells[e]).find("div.treeclick").bind("click",function(m){m=d(m.target||m.srcElement,a.rows).closest("tr.jqgrow")[0].id;m=a.p._index[m];if(!a.p.data[m][h])if(a.p.data[m][g]){d(a).jqGrid("collapseRow",a.p.data[m]);d(a).jqGrid("collapseNode",a.p.data[m])}else{d(a).jqGrid("expandRow",a.p.data[m]);d(a).jqGrid("expandNode",a.p.data[m])}return false});a.p.ExpandColClick===true&&d(a.rows[b].cells[e]).find("span.cell-wrapper").css("cursor","pointer").bind("click",function(m){m=d(m.target||m.srcElement,a.rows).closest("tr.jqgrow")[0].id;var r=a.p._index[m];if(!a.p.data[r][h])if(a.p.data[r][g]){d(a).jqGrid("collapseRow",a.p.data[r]);d(a).jqGrid("collapseNode",a.p.data[r])}else{d(a).jqGrid("expandRow",a.p.data[r]);d(a).jqGrid("expandNode",a.p.data[r])}d(a).jqGrid("setSelection",m);return false});b++}})},setTreeGrid:function(){return this.each(function(){var b=this,c=0,a=false,e,g,h=[];if(b.p.treeGrid){b.p.treedatatype||d.extend(b.p,{treedatatype:b.p.datatype});b.p.subGrid=false;b.p.altRows=false;b.p.pgbuttons=false;b.p.pginput=false;b.p.gridview=true;b.p.multiselect=false;b.p.rowList=[];b.p.expColInd=0;b.p.treeIcons=d.extend({plus:"ui-icon-triangle-1-"+
(b.p.direction=="rtl"?"w":"e"),minus:"ui-icon-triangle-1-s",leaf:"ui-icon-radio-off"},b.p.treeIcons||{});if(b.p.treeGridModel=="nested")b.p.treeReader=d.extend({level_field:"level",left_field:"lft",right_field:"rgt",leaf_field:"isLeaf",expanded_field:"expanded",loaded:"loaded",icon_field:"icon"},b.p.treeReader);else if(b.p.treeGridModel=="adjacency")b.p.treeReader=d.extend({level_field:"level",parent_id_field:"parent",leaf_field:"isLeaf",expanded_field:"expanded",loaded:"loaded",icon_field:"icon"},b.p.treeReader);for(g in b.p.colModel)if(b.p.colModel.hasOwnProperty(g)){e=b.p.colModel[g].name;if(e==b.p.ExpandColumn&&!a){a=true;b.p.expColInd=c}c++;for(var f in b.p.treeReader)b.p.treeReader[f]==e&&h.push(e)}d.each(b.p.treeReader,function(k,i){if(i&&d.inArray(i,h)===-1){if(k==="leaf_field")b.p._treeleafpos=c;c++;b.p.colNames.push(i);b.p.colModel.push({name:i,width:1,hidden:true,sortable:false,resizable:false,hidedlg:true,editable:true,search:false})}})}})},expandRow:function(b){this.each(function(){var c=this;if(c.grid&&c.p.treeGrid){var a=d(c).jqGrid("getNodeChildren",b),e=c.p.treeReader.expanded_field;d(a).each(function(){var g=d.jgrid.getAccessor(this,c.p.localReader.id);d("#"+g,c.grid.bDiv).css("display","");this[e]&&d(c).jqGrid("expandRow",this)})}})},collapseRow:function(b){this.each(function(){var c=this;if(c.grid&&c.p.treeGrid){var a=d(c).jqGrid("getNodeChildren",b),e=c.p.treeReader.expanded_field;d(a).each(function(){var g=d.jgrid.getAccessor(this,c.p.localReader.id);d("#"+g,c.grid.bDiv).css("display","none");this[e]&&d(c).jqGrid("collapseRow",this)})}})},getRootNodes:function(){var b=[];this.each(function(){var c=this;if(c.grid&&c.p.treeGrid)switch(c.p.treeGridModel){case"nested":var a=c.p.treeReader.level_field;d(c.p.data).each(function(){parseInt(this[a],10)===parseInt(c.p.tree_root_level,10)&&b.push(this)});break;case"adjacency":var e=c.p.treeReader.parent_id_field;d(c.p.data).each(function(){if(this[e]===null||String(this[e]).toLowerCase()=="null")b.push(this)})}});return b},getNodeDepth:function(b){var c=null;this.each(function(){if(this.grid&&this.p.treeGrid)switch(this.p.treeGridModel){case"nested":c=parseInt(b[this.p.treeReader.level_field],10)-parseInt(this.p.tree_root_level,10);break;case"adjacency":c=d(this).jqGrid("getNodeAncestors",b).length}});return c},getNodeParent:function(b){var c=null;this.each(function(){if(this.grid&&this.p.treeGrid)switch(this.p.treeGridModel){case"nested":var a=this.p.treeReader.left_field,e=this.p.treeReader.right_field,g=this.p.treeReader.level_field,h=parseInt(b[a],10),f=parseInt(b[e],10),k=parseInt(b[g],10);d(this.p.data).each(function(){if(parseInt(this[g],10)===k-1&&parseInt(this[a],10)<h&&parseInt(this[e],10)>f){c=this;return false}});break;case"adjacency":var i=this.p.treeReader.parent_id_field,j=this.p.localReader.id;d(this.p.data).each(function(){if(this[j]==b[i]){c=this;return false}})}});return c},getNodeChildren:function(b){var c=[];this.each(function(){if(this.grid&&this.p.treeGrid)switch(this.p.treeGridModel){case"nested":var a=this.p.treeReader.left_field,e=this.p.treeReader.right_field,g=this.p.treeReader.level_field,h=parseInt(b[a],10),f=parseInt(b[e],10),k=parseInt(b[g],10);d(this.p.data).each(function(){parseInt(this[g],10)===k+1&&parseInt(this[a],10)>h&&parseInt(this[e],10)<f&&c.push(this)});break;case"adjacency":var i=this.p.treeReader.parent_id_field,j=this.p.localReader.id;d(this.p.data).each(function(){this[i]==b[j]&&c.push(this)})}});return c},getFullTreeNode:function(b){var c=[];this.each(function(){var a;if(this.grid&&this.p.treeGrid)switch(this.p.treeGridModel){case"nested":var e=this.p.treeReader.left_field,g=this.p.treeReader.right_field,h=this.p.treeReader.level_field,f=parseInt(b[e],10),k=parseInt(b[g],10),i=parseInt(b[h],10);d(this.p.data).each(function(){parseInt(this[h],10)>=i&&parseInt(this[e],10)>=f&&parseInt(this[e],10)<=k&&c.push(this)});break;case"adjacency":if(b){c.push(b);var j=this.p.treeReader.parent_id_field,o=this.p.localReader.id;d(this.p.data).each(function(n){a=c.length;for(n=0;n<a;n++)if(c[n][o]==this[j]){c.push(this);break}})}}});return c},getNodeAncestors:function(b){var c=[];this.each(function(){if(this.grid&&this.p.treeGrid)for(var a=d(this).jqGrid("getNodeParent",b);a;){c.push(a);a=d(this).jqGrid("getNodeParent",a)}});return c},isVisibleNode:function(b){var c=true;this.each(function(){if(this.grid&&this.p.treeGrid){var a=d(this).jqGrid("getNodeAncestors",b),e=this.p.treeReader.expanded_field;d(a).each(function(){c=c&&this[e];if(!c)return false})}});return c},isNodeLoaded:function(b){var c;this.each(function(){if(this.grid&&this.p.treeGrid){var a=this.p.treeReader.leaf_field;c=b!==undefined?b.loaded!==undefined?b.loaded:b[a]||d(this).jqGrid("getNodeChildren",b).length>0?true:false:false}});return c},expandNode:function(b){return this.each(function(){if(this.grid&&this.p.treeGrid){var c=this.p.treeReader.expanded_field,a=this.p.treeReader.parent_id_field,e=this.p.treeReader.loaded,g=this.p.treeReader.level_field,h=this.p.treeReader.left_field,f=this.p.treeReader.right_field;if(!b[c]){var k=d.jgrid.getAccessor(b,this.p.localReader.id),i=d("#"+k,this.grid.bDiv)[0],j=this.p._index[k];if(d(this).jqGrid("isNodeLoaded",this.p.data[j])){b[c]=true;d("div.treeclick",i).removeClass(this.p.treeIcons.plus+" tree-plus").addClass(this.p.treeIcons.minus+" tree-minus")}else{b[c]=true;d("div.treeclick",i).removeClass(this.p.treeIcons.plus+" tree-plus").addClass(this.p.treeIcons.minus+" tree-minus");this.p.treeANode=i.rowIndex;this.p.datatype=this.p.treedatatype;this.p.treeGridModel=="nested"?d(this).jqGrid("setGridParam",{postData:{nodeid:k,n_left:b[h],n_right:b[f],n_level:b[g]}}):d(this).jqGrid("setGridParam",{postData:{nodeid:k,parentid:b[a],n_level:b[g]}});d(this).trigger("reloadGrid");b[e]=true;this.p.treeGridModel=="nested"?d(this).jqGrid("setGridParam",{postData:{nodeid:"",n_left:"",n_right:"",n_level:""}}):d(this).jqGrid("setGridParam",{postData:{nodeid:"",parentid:"",n_level:""}})}}}})},collapseNode:function(b){return this.each(function(){if(this.grid&&this.p.treeGrid)if(b.expanded){b.expanded=false;var c=d.jgrid.getAccessor(b,this.p.localReader.id);c=d("#"+c,this.grid.bDiv)[0];d("div.treeclick",c).removeClass(this.p.treeIcons.minus+" tree-minus").addClass(this.p.treeIcons.plus+" tree-plus")}})},SortTree:function(b,c,a,e){return this.each(function(){if(this.grid&&this.p.treeGrid){var g,h,f,k=[],i=this,j;g=d(this).jqGrid("getRootNodes");g=d.jgrid.from(g);g.orderBy(b,c,a,e);j=g.select();g=0;for(h=j.length;g<h;g++){f=j[g];k.push(f);d(this).jqGrid("collectChildrenSortTree",k,f,b,c,a,e)}d.each(k,function(o){var n=d.jgrid.getAccessor(this,i.p.localReader.id);d("#"+i.p.id+" tbody tr:eq("+o+")").after(d("tr#"+
n,i.grid.bDiv))});k=j=g=null}})},collectChildrenSortTree:function(b,c,a,e,g,h){return this.each(function(){if(this.grid&&this.p.treeGrid){var f,k,i,j;f=d(this).jqGrid("getNodeChildren",c);f=d.jgrid.from(f);f.orderBy(a,e,g,h);j=f.select();f=0;for(k=j.length;f<k;f++){i=j[f];b.push(i);d(this).jqGrid("collectChildrenSortTree",b,i,a,e,g,h)}}})},setTreeRow:function(b,c){var a=false;this.each(function(){if(this.grid&&this.p.treeGrid)a=d(this).jqGrid("setRowData",b,c)});return a},delTreeNode:function(b){return this.each(function(){var c=this.p.localReader.id,a=this.p.treeReader.left_field,e=this.p.treeReader.right_field,g,h,f;if(this.grid&&this.p.treeGrid){var k=this.p._index[b];if(k!==undefined){g=parseInt(this.p.data[k][e],10);h=g-parseInt(this.p.data[k][a],10)+1;k=d(this).jqGrid("getFullTreeNode",this.p.data[k]);if(k.length>0)for(var i=0;i<k.length;i++)d(this).jqGrid("delRowData",k[i][c]);if(this.p.treeGridModel==="nested"){c=d.jgrid.from(this.p.data).greater(a,g,{stype:"integer"}).select();if(c.length)for(f in c)c[f][a]=parseInt(c[f][a],10)-h;c=d.jgrid.from(this.p.data).greater(e,g,{stype:"integer"}).select();if(c.length)for(f in c)c[f][e]=parseInt(c[f][e],10)-h}}}})},addChildNode:function(b,c,a){var e=this[0];if(a){var g=e.p.treeReader.expanded_field,h=e.p.treeReader.leaf_field,f=e.p.treeReader.level_field,k=e.p.treeReader.parent_id_field,i=e.p.treeReader.left_field,j=e.p.treeReader.right_field,o=e.p.treeReader.loaded,n,l,m,r,p;n=0;var s=c,t;if(!b){p=e.p.data.length-1;if(p>=0)for(;p>=0;){n=Math.max(n,parseInt(e.p.data[p][e.p.localReader.id],10));p--}b=n+1}var u=d(e).jqGrid("getInd",c);t=false;if(c===undefined||c===null||c===""){s=c=null;n="last";r=e.p.tree_root_level;p=e.p.data.length+1}else{n="after";l=e.p._index[c];m=e.p.data[l];c=m[e.p.localReader.id];r=parseInt(m[f],10)+1;p=d(e).jqGrid("getFullTreeNode",m);if(p.length){s=p=p[p.length-1][e.p.localReader.id];p=d(e).jqGrid("getInd",s)+1}else p=d(e).jqGrid("getInd",c)+1;if(m[h]){t=true;m[g]=true;d(e.rows[u]).find("span.cell-wrapperleaf").removeClass("cell-wrapperleaf").addClass("cell-wrapper").end().find("div.tree-leaf").removeClass(e.p.treeIcons.leaf+" tree-leaf").addClass(e.p.treeIcons.minus+" tree-minus");e.p.data[l][h]=false;m[o]=true}}l=p+1;a[g]=false;a[o]=true;a[f]=r;a[h]=true;if(e.p.treeGridModel==="adjacency")a[k]=c;if(e.p.treeGridModel==="nested"){var q;if(c!==null){h=parseInt(m[j],10);f=d.jgrid.from(e.p.data);f=f.greaterOrEquals(j,h,{stype:"integer"});f=f.select();if(f.length)for(q in f){f[q][i]=f[q][i]>h?parseInt(f[q][i],10)+2:f[q][i];f[q][j]=f[q][j]>=h?parseInt(f[q][j],10)+2:f[q][j]}a[i]=h;a[j]=h+1}else{h=parseInt(d(e).jqGrid("getCol",j,false,"max"),10);f=d.jgrid.from(e.p.data).greater(i,h,{stype:"integer"}).select();if(f.length)for(q in f)f[q][i]=parseInt(f[q][i],10)+2;f=d.jgrid.from(e.p.data).greater(j,h,{stype:"integer"}).select();if(f.length)for(q in f)f[q][j]=parseInt(f[q][j],10)+2;a[i]=h+1;a[j]=h+2}}if(c===null||d(e).jqGrid("isNodeLoaded",m)||t){d(e).jqGrid("addRowData",b,a,n,s);d(e).jqGrid("setTreeNode",p,l)}m&&!m[g]&&d(e.rows[u]).find("div.treeclick").click()}}})})(jQuery);(function(b){b.jgrid.extend({jqGridImport:function(a){a=b.extend({imptype:"xml",impstring:"",impurl:"",mtype:"GET",impData:{},xmlGrid:{config:"roots>grid",data:"roots>rows"},jsonGrid:{config:"grid",data:"data"},ajaxOptions:{}},a||{});return this.each(function(){var d=this,c=function(f,g){var e=b(g.xmlGrid.config,f)[0],h=b(g.xmlGrid.data,f)[0],i;if(xmlJsonClass.xml2json&&b.jgrid.parse){e=xmlJsonClass.xml2json(e," ");e=b.jgrid.parse(e);for(var l in e)if(e.hasOwnProperty(l))i=e[l];if(h){h=e.grid.datatype;e.grid.datatype="xmlstring";e.grid.datastr=f;b(d).jqGrid(i).jqGrid("setGridParam",{datatype:h})}else b(d).jqGrid(i)}else alert("xml2json or parse are not present")},j=function(f,g){if(f&&typeof f=="string"){var e=b.jgrid.parse(f),h=e[g.jsonGrid.config];if(e=e[g.jsonGrid.data]){var i=h.datatype;h.datatype="jsonstring";h.datastr=e;b(d).jqGrid(h).jqGrid("setGridParam",{datatype:i})}else b(d).jqGrid(h)}};switch(a.imptype){case"xml":b.ajax(b.extend({url:a.impurl,type:a.mtype,data:a.impData,dataType:"xml",complete:function(f,g){if(g=="success"){c(f.responseXML,a);b.isFunction(a.importComplete)&&a.importComplete(f)}}},a.ajaxOptions));break;case"xmlstring":if(a.impstring&&typeof a.impstring=="string"){var k=b.jgrid.stringToDoc(a.impstring);if(k){c(k,a);b.isFunction(a.importComplete)&&a.importComplete(k);a.impstring=null}k=null}break;case"json":b.ajax(b.extend({url:a.impurl,type:a.mtype,data:a.impData,dataType:"json",complete:function(f,g){if(g=="success"){j(f.responseText,a);b.isFunction(a.importComplete)&&a.importComplete(f)}}},a.ajaxOptions));break;case"jsonstring":if(a.impstring&&typeof a.impstring=="string"){j(a.impstring,a);b.isFunction(a.importComplete)&&a.importComplete(a.impstring);a.impstring=null}}})},jqGridExport:function(a){a=b.extend({exptype:"xmlstring",root:"grid",ident:"\t"},a||{});var d=null;this.each(function(){if(this.grid){var c=b.extend({},b(this).jqGrid("getGridParam"));if(c.rownumbers){c.colNames.splice(0,1);c.colModel.splice(0,1)}if(c.multiselect){c.colNames.splice(0,1);c.colModel.splice(0,1)}if(c.subGrid){c.colNames.splice(0,1);c.colModel.splice(0,1)}c.knv=null;if(c.treeGrid)for(var j in c.treeReader)if(c.treeReader.hasOwnProperty(j)){c.colNames.splice(c.colNames.length-1);c.colModel.splice(c.colModel.length-1)}switch(a.exptype){case"xmlstring":d="<"+a.root+">"+xmlJsonClass.json2xml(c,a.ident)+"</"+a.root+">";break;case"jsonstring":d="{"+xmlJsonClass.toJson(c,a.root,a.ident)+"}";if(c.postData.filters!==undefined){d=d.replace(/filters":"/,'filters":');d=d.replace(/}]}"/,"}]}")}}}});return d},excelExport:function(a){a=b.extend({exptype:"remote",url:null,oper:"oper",tag:"excel",exportOptions:{}},a||{});return this.each(function(){if(this.grid){var d;if(a.exptype=="remote"){d=b.extend({},this.p.postData);d[a.oper]=a.tag;d=jQuery.param(d);d=a.url.indexOf("?")!=-1?a.url+"&"+d:a.url+"?"+d;window.location=d}}})}})})(jQuery);var xmlJsonClass={xml2json:function(a,b){if(a.nodeType===9)a=a.documentElement;var g=this.toJson(this.toObj(this.removeWhite(a)),a.nodeName,"\t");return"{\n"+b+(b?g.replace(/\t/g,b):g.replace(/\t|\n/g,""))+"\n}"},json2xml:function(a,b){var g=function(d,c,i){var h="",k,j;if(d instanceof Array)if(d.length===0)h+=i+"<"+c+">__EMPTY_ARRAY_</"+c+">\n";else{k=0;for(j=d.length;k<j;k+=1){var l=i+g(d[k],c,i+"\t")+"\n";h+=l}}else if(typeof d==="object"){k=false;h+=i+"<"+c;for(j in d)if(d.hasOwnProperty(j))if(j.charAt(0)==="@")h+=" "+j.substr(1)+'="'+d[j].toString()+'"';else k=true;h+=k?">":"/>";if(k){for(j in d)if(d.hasOwnProperty(j))if(j==="#text")h+=d[j];else if(j==="#cdata")h+="<![CDATA["+d[j]+"]]\>";else if(j.charAt(0)!=="@")h+=g(d[j],j,i+"\t");h+=(h.charAt(h.length-1)==="\n"?i:"")+"</"+c+">"}}else h+=typeof d==="function"?i+"<"+c+"><![CDATA["+d+"]]\></"+c+">":d.toString()==='""'||d.toString().length===0?i+"<"+c+">__EMPTY_STRING_</"+c+">":i+"<"+c+">"+d.toString()+"</"+c+">";return h},e="",f;for(f in a)if(a.hasOwnProperty(f))e+=g(a[f],f,"");return b?e.replace(/\t/g,b):e.replace(/\t|\n/g,"")},toObj:function(a){var b={},g=/function/i;if(a.nodeType===1){if(a.attributes.length){var e;for(e=0;e<a.attributes.length;e+=1)b["@"+a.attributes[e].nodeName]=(a.attributes[e].nodeValue||"").toString()}if(a.firstChild){var f=e=0,d=false,c;for(c=a.firstChild;c;c=c.nextSibling)if(c.nodeType===1)d=true;else if(c.nodeType===3&&c.nodeValue.match(/[^ \f\n\r\t\v]/))e+=1;else if(c.nodeType===4)f+=1;if(d)if(e<2&&f<2){this.removeWhite(a);for(c=a.firstChild;c;c=c.nextSibling)if(c.nodeType===3)b["#text"]=this.escape(c.nodeValue);else if(c.nodeType===4)if(g.test(c.nodeValue))b[c.nodeName]=[b[c.nodeName],c.nodeValue];else b["#cdata"]=this.escape(c.nodeValue);else if(b[c.nodeName])if(b[c.nodeName]instanceof Array)b[c.nodeName][b[c.nodeName].length]=this.toObj(c);else b[c.nodeName]=[b[c.nodeName],this.toObj(c)];else b[c.nodeName]=this.toObj(c)}else if(a.attributes.length)b["#text"]=this.escape(this.innerXml(a));else b=this.escape(this.innerXml(a));else if(e)if(a.attributes.length)b["#text"]=this.escape(this.innerXml(a));else{b=this.escape(this.innerXml(a));if(b==="__EMPTY_ARRAY_")b="[]";else if(b==="__EMPTY_STRING_")b=""}else if(f)if(f>1)b=this.escape(this.innerXml(a));else for(c=a.firstChild;c;c=c.nextSibling)if(g.test(a.firstChild.nodeValue)){b=a.firstChild.nodeValue;break}else b["#cdata"]=this.escape(c.nodeValue)}if(!a.attributes.length&&!a.firstChild)b=null}else if(a.nodeType===9)b=this.toObj(a.documentElement);else alert("unhandled node type: "+
a.nodeType);return b},toJson:function(a,b,g,e){if(e===undefined)e=true;var f=b?'"'+b+'"':"",d="\t",c="\n";if(!e)c=d="";if(a==="[]")f+=b?":[]":"[]";else if(a instanceof Array){var i,h,k=[];h=0;for(i=a.length;h<i;h+=1)k[h]=this.toJson(a[h],"",g+d,e);f+=(b?":[":"[")+(k.length>1?c+g+d+k.join(","+c+g+d)+c+g:k.join(""))+"]"}else if(a===null)f+=(b&&":")+"null";else if(typeof a==="object"){i=[];for(h in a)if(a.hasOwnProperty(h))i[i.length]=this.toJson(a[h],h,g+d,e);f+=(b?":{":"{")+(i.length>1?c+g+d+i.join(","+
c+g+d)+c+g:i.join(""))+"}"}else f+=typeof a==="string"?(b&&":")+'"'+a.replace(/\\/g,"\\\\").replace(/\"/g,'\\"')+'"':(b&&":")+'"'+a.toString()+'"';return f},innerXml:function(a){var b="";if("innerHTML"in a)b=a.innerHTML;else{var g=function(e){var f="",d;if(e.nodeType===1){f+="<"+e.nodeName;for(d=0;d<e.attributes.length;d+=1)f+=" "+e.attributes[d].nodeName+'="'+(e.attributes[d].nodeValue||"").toString()+'"';if(e.firstChild){f+=">";for(d=e.firstChild;d;d=d.nextSibling)f+=g(d);f+="</"+e.nodeName+">"}else f+="/>"}else if(e.nodeType===3)f+=e.nodeValue;else if(e.nodeType===4)f+="<![CDATA["+e.nodeValue+"]]\>";return f};for(a=a.firstChild;a;a=a.nextSibling)b+=g(a)}return b},escape:function(a){return a.replace(/[\\]/g,"\\\\").replace(/[\"]/g,'\\"').replace(/[\n]/g,"\\n").replace(/[\r]/g,"\\r")},removeWhite:function(a){a.normalize();var b;for(b=a.firstChild;b;)if(b.nodeType===3)if(b.nodeValue.match(/[^ \f\n\r\t\v]/))b=b.nextSibling;else{var g=b.nextSibling;a.removeChild(b);b=g}else{b.nodeType===1&&this.removeWhite(b);b=b.nextSibling}return a}};function tableToGrid(n,o){jQuery(n).each(function(){if(!this.grid){jQuery(this).width("99%");var a=jQuery(this).width(),d=jQuery("input[type=checkbox]:first",jQuery(this)),b=jQuery("input[type=radio]:first",jQuery(this));d=d.length>0;b=!d&&b.length>0;var l=d||b,c=[],g=[];jQuery("th",jQuery(this)).each(function(){if(c.length===0&&l){c.push({name:"__selection__",index:"__selection__",width:0,hidden:true});g.push("__selection__")}else{c.push({name:jQuery(this).attr("id")||jQuery.trim(jQuery.jgrid.stripHtml(jQuery(this).html())).split(" ").join("_"),index:jQuery(this).attr("id")||jQuery.trim(jQuery.jgrid.stripHtml(jQuery(this).html())).split(" ").join("_"),width:jQuery(this).width()||150});g.push(jQuery(this).html())}});var f=[],h=[],i=[];jQuery("tbody > tr",jQuery(this)).each(function(){var j={},e=0;jQuery("td",jQuery(this)).each(function(){if(e===0&&l){var k=jQuery("input",jQuery(this)),m=k.attr("value");h.push(m||f.length);k.attr("checked")&&i.push(m);j[c[e].name]=k.attr("value")}else j[c[e].name]=jQuery(this).html();e++});e>0&&f.push(j)});jQuery(this).empty();jQuery(this).addClass("scroll");jQuery(this).jqGrid(jQuery.extend({datatype:"local",width:a,colNames:g,colModel:c,multiselect:d},o||{}));for(a=0;a<f.length;a++){b=null;if(h.length>0)if((b=h[a])&&b.replace)b=encodeURIComponent(b).replace(/[.\-%]/g,"_");if(b===null)b=a+1;jQuery(this).jqGrid("addRowData",b,f[a])}for(a=0;a<i.length;a++)jQuery(this).jqGrid("setSelection",i[a])}})};(function(a){if(a.browser.msie&&a.browser.version==8)a.expr[":"].hidden=function(b){return b.offsetWidth===0||b.offsetHeight===0||b.style.display=="none"};a.jgrid._multiselect=false;if(a.ui)if(a.ui.multiselect){if(a.ui.multiselect.prototype._setSelected){var q=a.ui.multiselect.prototype._setSelected;a.ui.multiselect.prototype._setSelected=function(b,g){var c=q.call(this,b,g);if(g&&this.selectedList){var f=this.element;this.selectedList.find("li").each(function(){a(this).data("optionLink")&&a(this).data("optionLink").remove().appendTo(f)})}return c}}if(a.ui.multiselect.prototype.destroy)a.ui.multiselect.prototype.destroy=function(){this.element.show();this.container.remove();a.Widget===undefined?a.widget.prototype.destroy.apply(this,arguments):a.Widget.prototype.destroy.apply(this,arguments)};a.jgrid._multiselect=true}a.jgrid.extend({sortableColumns:function(b){return this.each(function(){function g(){c.p.disableClick=true}var c=this,f={tolerance:"pointer",axis:"x",scrollSensitivity:"1",items:">th:not(:has(#jqgh_cb,#jqgh_rn,#jqgh_subgrid),:hidden)",placeholder:{element:function(h){return a(document.createElement(h[0].nodeName)).addClass(h[0].className+" ui-sortable-placeholder ui-state-highlight").removeClass("ui-sortable-helper")[0]},update:function(h,j){j.height(h.currentItem.innerHeight()-parseInt(h.currentItem.css("paddingTop")||0,10)-parseInt(h.currentItem.css("paddingBottom")||0,10));j.width(h.currentItem.innerWidth()-parseInt(h.currentItem.css("paddingLeft")||0,10)-parseInt(h.currentItem.css("paddingRight")||0,10))}},update:function(h,j){var i=a(j.item).parent();i=a(">th",i);var m={};a.each(c.p.colModel,function(d){m[this.name]=d});var k=[];i.each(function(){var d=a(">div",this).get(0).id.replace(/^jqgh_/,"");d in m&&k.push(m[d])});a(c).jqGrid("remapColumns",k,true,true);a.isFunction(c.p.sortable.update)&&c.p.sortable.update(k);setTimeout(function(){c.p.disableClick=false},50)}};if(c.p.sortable.options)a.extend(f,c.p.sortable.options);else if(a.isFunction(c.p.sortable))c.p.sortable={update:c.p.sortable};if(f.start){var e=f.start;f.start=function(h,j){g();e.call(this,h,j)}}else f.start=g;if(c.p.sortable.exclude)f.items+=":not("+c.p.sortable.exclude+")";b.sortable(f).data("sortable").floating=true})},columnChooser:function(b){function g(d,l){if(d)if(typeof d=="string")a.fn[d]&&a.fn[d].apply(l,a.makeArray(arguments).slice(2));else a.isFunction(d)&&d.apply(l,a.makeArray(arguments).slice(2))}var c=this;if(!a("#colchooser_"+c[0].p.id).length){var f=a('<div id="colchooser_'+c[0].p.id+'" style="position:relative;overflow:hidden"><div><select multiple="multiple"></select></div></div>'),e=a("select",f);b=a.extend({width:420,height:240,classname:null,done:function(d){d&&c.jqGrid("remapColumns",d,true)},msel:"multiselect",dlog:"dialog",dlog_opts:function(d){var l={};l[d.bSubmit]=function(){d.apply_perm();d.cleanup(false)};l[d.bCancel]=function(){d.cleanup(true)};return{buttons:l,close:function(){d.cleanup(true)},modal:d.modal?d.modal:false,resizable:d.resizable?d.resizable:true,width:d.width+20}},apply_perm:function(){a("option",e).each(function(){this.selected?c.jqGrid("showCol",h[this.value].name):c.jqGrid("hideCol",h[this.value].name)});var d=[];a("option[selected]",e).each(function(){d.push(parseInt(this.value,10))});a.each(d,function(){delete i[h[parseInt(this,10)].name]});a.each(i,function(){var l=parseInt(this,10);var p=d,o=l;if(o>=0){var n=p.slice(),r=n.splice(o,Math.max(p.length-o,o));if(o>p.length)o=p.length;n[o]=l;d=n.concat(r)}else d=void 0});b.done&&b.done.call(c,d)},cleanup:function(d){g(b.dlog,f,"destroy");g(b.msel,e,"destroy");f.remove();d&&b.done&&b.done.call(c)},msel_opts:{}},a.jgrid.col,b||{});if(a.ui)if(a.ui.multiselect)if(b.msel=="multiselect"){if(!a.jgrid._multiselect){alert("Multiselect plugin loaded after jqGrid. Please load the plugin before the jqGrid!");return}b.msel_opts=a.extend(a.ui.multiselect.defaults,b.msel_opts)}b.caption&&f.attr("title",b.caption);if(b.classname){f.addClass(b.classname);e.addClass(b.classname)}if(b.width){a(">div",f).css({width:b.width,margin:"0 auto"});e.css("width",b.width)}if(b.height){a(">div",f).css("height",b.height);e.css("height",b.height-10)}var h=c.jqGrid("getGridParam","colModel"),j=c.jqGrid("getGridParam","colNames"),i={},m=[];e.empty();a.each(h,function(d){i[this.name]=d;if(this.hidedlg)this.hidden||m.push(d);else e.append("<option value='"+d+"' "+(this.hidden?"":"selected='selected'")+">"+j[d]+"</option>")});var k=a.isFunction(b.dlog_opts)?b.dlog_opts.call(c,b):b.dlog_opts;g(b.dlog,f,k);k=a.isFunction(b.msel_opts)?b.msel_opts.call(c,b):b.msel_opts;g(b.msel,e,k)}},sortableRows:function(b){return this.each(function(){var g=this;if(g.grid)if(!g.p.treeGrid)if(a.fn.sortable){b=a.extend({cursor:"move",axis:"y",items:".jqgrow"},b||{});if(b.start&&a.isFunction(b.start)){b._start_=b.start;delete b.start}else b._start_=false;if(b.update&&a.isFunction(b.update)){b._update_=b.update;delete b.update}else b._update_=false;b.start=function(c,f){a(f.item).css("border-width","0px");a("td",f.item).each(function(j){this.style.width=g.grid.cols[j].style.width});if(g.p.subGrid){var e=a(f.item).attr("id");try{a(g).jqGrid("collapseSubGridRow",e)}catch(h){}}b._start_&&b._start_.apply(this,[c,f])};b.update=function(c,f){a(f.item).css("border-width","");g.p.rownumbers===true&&a("td.jqgrid-rownum",g.rows).each(function(e){a(this).html(e+1)});b._update_&&b._update_.apply(this,[c,f])};a("tbody:first",g).sortable(b);a("tbody:first",g).disableSelection()}})},gridDnD:function(b){return this.each(function(){function g(){var e=a.data(c,"dnd");a("tr.jqgrow:not(.ui-draggable)",c).draggable(a.isFunction(e.drag)?e.drag.call(a(c),e):e.drag)}var c=this;if(c.grid)if(!c.p.treeGrid)if(a.fn.draggable&&a.fn.droppable){a("#jqgrid_dnd").html()===null&&a("body").append("<table id='jqgrid_dnd' class='ui-jqgrid-dnd'></table>");if(typeof b=="string"&&b=="updateDnD"&&c.p.jqgdnd===true)g();else{b=a.extend({drag:function(e){return a.extend({start:function(h,j){if(c.p.subGrid){var i=a(j.helper).attr("id");try{a(c).jqGrid("collapseSubGridRow",i)}catch(m){}}for(i=0;i<a.data(c,"dnd").connectWith.length;i++)a(a.data(c,"dnd").connectWith[i]).jqGrid("getGridParam","reccount")=="0"&&a(a.data(c,"dnd").connectWith[i]).jqGrid("addRowData","jqg_empty_row",{});j.helper.addClass("ui-state-highlight");a("td",j.helper).each(function(k){this.style.width=c.grid.headers[k].width+"px"});e.onstart&&a.isFunction(e.onstart)&&e.onstart.call(a(c),h,j)},stop:function(h,j){if(j.helper.dropped){var i=a(j.helper).attr("id");a(c).jqGrid("delRowData",i)}for(i=0;i<a.data(c,"dnd").connectWith.length;i++)a(a.data(c,"dnd").connectWith[i]).jqGrid("delRowData","jqg_empty_row");e.onstop&&a.isFunction(e.onstop)&&e.onstop.call(a(c),h,j)}},e.drag_opts||{})},drop:function(e){return a.extend({accept:function(h){if(!a(h).hasClass("jqgrow"))return h;var j=a(h).closest("table.ui-jqgrid-btable");if(j.length>0&&a.data(j[0],"dnd")!==undefined){h=a.data(j[0],"dnd").connectWith;return a.inArray("#"+this.id,h)!=-1?true:false}return h},drop:function(h,j){if(a(j.draggable).hasClass("jqgrow")){var i=a(j.draggable).attr("id");i=j.draggable.parent().parent().jqGrid("getRowData",i);if(!e.dropbyname){var m=0,k={},d,l=a("#"+this.id).jqGrid("getGridParam","colModel");try{for(var p in i){if(i.hasOwnProperty(p)&&l[m]){d=l[m].name;k[d]=i[p]}m++}i=k}catch(o){}}j.helper.dropped=true;if(e.beforedrop&&a.isFunction(e.beforedrop)){d=e.beforedrop.call(this,h,j,i,a("#"+c.id),a(this));if(typeof d!="undefined"&&d!==null&&typeof d=="object")i=d}if(j.helper.dropped){var n;if(e.autoid)if(a.isFunction(e.autoid))n=e.autoid.call(this,i);else{n=Math.ceil(Math.random()*1E3);n=e.autoidprefix+n}a("#"+this.id).jqGrid("addRowData",n,i,e.droppos)}e.ondrop&&a.isFunction(e.ondrop)&&e.ondrop.call(this,h,j,i)}}},e.drop_opts||{})},onstart:null,onstop:null,beforedrop:null,ondrop:null,drop_opts:{activeClass:"ui-state-active",hoverClass:"ui-state-hover"},drag_opts:{revert:"invalid",helper:"clone",cursor:"move",appendTo:"#jqgrid_dnd",zIndex:5E3},dropbyname:false,droppos:"first",autoid:true,autoidprefix:"dnd_"},b||{});if(b.connectWith){b.connectWith=b.connectWith.split(",");b.connectWith=a.map(b.connectWith,function(e){return a.trim(e)});a.data(c,"dnd",b);c.p.reccount!="0"&&!c.p.jqgdnd&&g();c.p.jqgdnd=true;for(var f=0;f<b.connectWith.length;f++)a(b.connectWith[f]).droppable(a.isFunction(b.drop)?b.drop.call(a(c),b):b.drop)}}}})},gridResize:function(b){return this.each(function(){var g=this;if(g.grid&&a.fn.resizable){b=a.extend({},b||{});if(b.alsoResize){b._alsoResize_=b.alsoResize;delete b.alsoResize}else b._alsoResize_=false;if(b.stop&&a.isFunction(b.stop)){b._stop_=b.stop;delete b.stop}else b._stop_=false;b.stop=function(c,f){a(g).jqGrid("setGridParam",{height:a("#gview_"+g.p.id+" .ui-jqgrid-bdiv").height()});a(g).jqGrid("setGridWidth",f.size.width,b.shrinkToFit);b._stop_&&b._stop_.call(g,c,f)};b.alsoResize=b._alsoResize_?eval("("+("{'#gview_"+g.p.id+" .ui-jqgrid-bdiv':true,'"+b._alsoResize_+"':true}")+")"):a(".ui-jqgrid-bdiv","#gview_"+g.p.id);delete b._alsoResize_;a("#gbox_"+g.p.id).resizable(b)}})}})})(jQuery);});;define('jquery-layout',['jquery'],function(jQuery){var $=jQuery;;(function($){var min=Math.min,max=Math.max,round=Math.floor;function isStr(v){return $.type(v)==="string";}
function runPluginCallbacks(Instance,a_fn){if($.isArray(a_fn))
for(var i=0,c=a_fn.length;i<c;i++){var fn=a_fn[i];try{if(isStr(fn))
fn=eval(fn);if($.isFunction(fn))
fn(Instance);}catch(ex){}}};$.layout={version:"1.3.rc30.51",revision:0.033005,language:{Open:"Open",Close:"Close",Resize:"Resize",Slide:"Slide Open",Pin:"Pin",Unpin:"Un-Pin",noRoomToOpenTip:"Not enough room to show this pane.",minSizeWarning:"Panel has reached its minimum size",maxSizeWarning:"Panel has reached its maximum size",pane:"pane",selector:"selector",errButton:"Error Adding Button \n\nInvalid ",errContainerMissing:"UI Layout Initialization Error\n\nThe specified layout-container does not exist.",errCenterPaneMissing:"UI Layout Initialization Error\n\nThe center-pane element does not exist.\n\nThe center-pane is a required element.",errContainerHeight:"UI Layout Initialization Warning\n\nThe layout-container \"CONTAINER\" has no height.\n\nTherefore the layout is 0-height and hence 'invisible'!"},browser:{mozilla:!!$.browser.mozilla,webkit:!!$.browser.webkit||!!$.browser.safari,msie:!!$.browser.msie,isIE6:!!$.browser.msie&&$.browser.version==6,version:$.browser.version},effects:{slide:{all:{duration:"fast"},north:{direction:"up"},south:{direction:"down"},east:{direction:"right"},west:{direction:"left"}},drop:{all:{duration:"slow"},north:{direction:"up"},south:{direction:"down"},east:{direction:"right"},west:{direction:"left"}},scale:{all:{duration:"fast"}},blind:{},clip:{},explode:{},fade:{},fold:{},puff:{},size:{all:{easing:"swing"}}},config:{optionRootKeys:"effects,panes,north,south,west,east,center".split(","),allPanes:"north,south,west,east,center".split(","),borderPanes:"north,south,west,east".split(","),oppositeEdge:{north:"south",south:"north",east:"west",west:"east"},offscreenCSS:{left:"-99999px",right:"auto"},offscreenReset:"offscreenReset",hidden:{visibility:"hidden"},visible:{visibility:"visible"},resizers:{cssReq:{position:"absolute",padding:0,margin:0,fontSize:"1px",textAlign:"left",overflow:"hidden"},cssDemo:{background:"#DDD",border:"none"}},togglers:{cssReq:{position:"absolute",display:"block",padding:0,margin:0,overflow:"hidden",textAlign:"center",fontSize:"1px",cursor:"pointer",zIndex:1},cssDemo:{background:"#AAA"}},content:{cssReq:{position:"relative"},cssDemo:{overflow:"auto",padding:"10px"},cssDemoPane:{overflow:"hidden",padding:0}},panes:{cssReq:{position:"absolute",margin:0},cssDemo:{padding:"10px",background:"#FFF",border:"1px solid #BBB",overflow:"auto"}},north:{side:"Top",sizeType:"Height",dir:"horz",cssReq:{top:0,bottom:"auto",left:0,right:0,width:"auto"}},south:{side:"Bottom",sizeType:"Height",dir:"horz",cssReq:{top:"auto",bottom:0,left:0,right:0,width:"auto"}},east:{side:"Right",sizeType:"Width",dir:"vert",cssReq:{left:"auto",right:0,top:"auto",bottom:"auto",height:"auto"}},west:{side:"Left",sizeType:"Width",dir:"vert",cssReq:{left:0,right:"auto",top:"auto",bottom:"auto",height:"auto"}},center:{dir:"center",cssReq:{left:"auto",right:"auto",top:"auto",bottom:"auto",height:"auto",width:"auto"}}},callbacks:{},getParentPaneElem:function(el){var $el=$(el),layout=$el.data("layout")||$el.data("parentLayout");if(layout){var $cont=layout.container;if($cont.data("layoutPane"))return $cont;var $pane=$cont.closest("."+$.layout.defaults.panes.paneClass);if($pane.data("layoutPane"))return $pane;}
return null;},getParentPaneInstance:function(el){var $pane=$.layout.getParentPaneElem(el);return $pane?$pane.data("layoutPane"):null;},getParentLayoutInstance:function(el){var $pane=$.layout.getParentPaneElem(el);return $pane?$pane.data("parentLayout"):null;},getEventObject:function(evt){return typeof evt==="object"&&evt.stopPropagation?evt:null;},parsePaneName:function(evt_or_pane){var evt=$.layout.getEventObject(evt_or_pane);if(evt){evt.stopPropagation();return $(this).data("layoutEdge");}
else
return evt_or_pane;},plugins:{draggable:!!$.fn.draggable,effects:{core:!!$.effects,slide:$.effects&&$.effects.slide}},onCreate:[],onLoad:[],onReady:[],onDestroy:[],onUnload:[],afterOpen:[],afterClose:[],scrollbarWidth:function(){return window.scrollbarWidth||$.layout.getScrollbarSize('width');},scrollbarHeight:function(){return window.scrollbarHeight||$.layout.getScrollbarSize('height');},getScrollbarSize:function(dim){var $c=$('<div style="position: absolute; top: -10000px; left: -10000px; width: 100px; height: 100px; overflow: scroll;"></div>').appendTo("body");var d={width:$c.width()-$c[0].clientWidth,height:$c.height()-$c[0].clientHeight};$c.remove();window.scrollbarWidth=d.width;window.scrollbarHeight=d.height;return dim.match(/^(width|height)$/)?d[dim]:d;},showInvisibly:function($E,force){if(!$E)return{};if(!$E.jquery)$E=$($E);var CSS={display:$E.css('display'),visibility:$E.css('visibility')};if(force||CSS.display==="none"){$E.css({display:"block",visibility:"hidden"});return CSS;}
else return{};},getElementDimensions:function($E){var
d={},x=d.css={},i={},b,p,N=$.layout.cssNum,off=$E.offset();d.offsetLeft=off.left;d.offsetTop=off.top;$.each("Left,Right,Top,Bottom".split(","),function(idx,e){b=x["border"+e]=$.layout.borderWidth($E,e);p=x["padding"+e]=$.layout.cssNum($E,"padding"+e);i[e]=b+p;d["inset"+e]=p;});d.offsetWidth=$E.innerWidth();d.offsetHeight=$E.innerHeight();d.outerWidth=$E.outerWidth();d.outerHeight=$E.outerHeight();d.innerWidth=max(0,d.outerWidth-i.Left-i.Right);d.innerHeight=max(0,d.outerHeight-i.Top-i.Bottom);x.width=$E.width();x.height=$E.height();x.top=N($E,"top",true);x.bottom=N($E,"bottom",true);x.left=N($E,"left",true);x.right=N($E,"right",true);return d;},getElementCSS:function($E,list){var
CSS={},style=$E[0].style,props=list.split(","),sides="Top,Bottom,Left,Right".split(","),attrs="Color,Style,Width".split(","),p,s,a,i,j,k;for(i=0;i<props.length;i++){p=props[i];if(p.match(/(border|padding|margin)$/))
for(j=0;j<4;j++){s=sides[j];if(p==="border")
for(k=0;k<3;k++){a=attrs[k];CSS[p+s+a]=style[p+s+a];}
else
CSS[p+s]=style[p+s];}
else
CSS[p]=style[p];};return CSS},cssWidth:function($E,outerWidth){var
b=$.layout.borderWidth,n=$.layout.cssNum;if(outerWidth<=0)return 0;if(!$.support.boxModel)return outerWidth;var W=outerWidth
-b($E,"Left")
-b($E,"Right")
-n($E,"paddingLeft")
-n($E,"paddingRight");return max(0,W);},cssHeight:function($E,outerHeight){var
b=$.layout.borderWidth,n=$.layout.cssNum;if(outerHeight<=0)return 0;if(!$.support.boxModel)return outerHeight;var H=outerHeight
-b($E,"Top")
-b($E,"Bottom")
-n($E,"paddingTop")
-n($E,"paddingBottom");return max(0,H);},cssNum:function($E,prop,allowAuto){if(!$E.jquery)$E=$($E);var CSS=$.layout.showInvisibly($E),p=$.curCSS($E[0],prop,true),v=allowAuto&&p=="auto"?p:(parseInt(p,10)||0);$E.css(CSS);return v;},borderWidth:function(el,side){if(el.jquery)el=el[0];var b="border"+side.substr(0,1).toUpperCase()+side.substr(1);return $.curCSS(el,b+"Style",true)==="none"?0:(parseInt($.curCSS(el,b+"Width",true),10)||0);},isMouseOverElem:function(evt,el){var
$E=$(el||this),d=$E.offset(),T=d.top,L=d.left,R=L+$E.outerWidth(),B=T+$E.outerHeight(),x=evt.pageX,y=evt.pageY;return($.layout.browser.msie&&x<0&&y<0)||((x>=L&&x<=R)&&(y>=T&&y<=B));},msg:function(info,popup,debugTitle,debugOpts){if($.isPlainObject(info)&&window.debugData){if(typeof popup==="string"){debugOpts=debugTitle;debugTitle=popup;}
else if(typeof debugTitle==="object"){debugOpts=debugTitle;debugTitle=null;}
var t=debugTitle||"log( <object> )",o=$.extend({sort:false,returnHTML:false,display:false},debugOpts);if(popup===true||o.display)
debugData(info,t,o);else if(window.console)
console.log(debugData(info,t,o));}
else if(popup)
alert(info);else if(window.console)
console.log(info);else{var id="#layoutLogger",$l=$(id);if(!$l.length)
$l=createLog();$l.children("ul").append('<li style="padding: 4px 10px; margin: 0; border-top: 1px solid #CCC;">'+info.replace(/\</g,"&lt;").replace(/\>/g,"&gt;")+'</li>');}
function createLog(){var pos=$.support.fixedPosition?'fixed':'absolute',$e=$('<div id="layoutLogger" style="position: '+pos+'; top: 5px; z-index: 999999; max-width: 25%; overflow: hidden; border: 1px solid #000; border-radius: 5px; background: #FBFBFB; box-shadow: 0 2px 10px rgba(0,0,0,0.3);">'
+'<div style="font-size: 13px; font-weight: bold; padding: 5px 10px; background: #F6F6F6; border-radius: 5px 5px 0 0; cursor: move;">'
+'<span style="float: right; padding-left: 7px; cursor: pointer;" title="Remove Console" onclick="$(this).closest(\'#layoutLogger\').remove()">X</span>Layout console.log</div>'
+'<ul style="font-size: 13px; font-weight: none; list-style: none; margin: 0; padding: 0 0 2px;"></ul>'
+'</div>').appendTo("body");$e.css('left',$(window).width()-$e.outerWidth()-5)
if($.ui.draggable)$e.draggable({handle:':first-child'});return $e;};}};var lang=$.layout.language;$.layout.defaults={name:"",containerSelector:"",containerClass:"ui-layout-container",scrollToBookmarkOnLoad:true,resizeWithWindow:true,resizeWithWindowDelay:200,resizeWithWindowMaxDelay:0,onresizeall_start:null,onresizeall_end:null,onload_start:null,onload_end:null,onunload_start:null,onunload_end:null,autoBindCustomButtons:false,initPanes:true,showErrorMessages:true,showDebugMessages:false,zIndex:null,zIndexes:{pane_normal:0,content_mask:1,resizer_normal:2,pane_sliding:100,pane_animate:1000,resizer_drag:10000},panes:{applyDemoStyles:false,closable:true,resizable:true,slidable:true,initClosed:false,initHidden:false,contentSelector:".ui-layout-content",contentIgnoreSelector:".ui-layout-ignore",findNestedContent:false,paneClass:"ui-layout-pane",resizerClass:"ui-layout-resizer",togglerClass:"ui-layout-toggler",buttonClass:"ui-layout-button",minSize:0,maxSize:0,spacing_open:6,spacing_closed:6,togglerLength_open:50,togglerLength_closed:50,togglerAlign_open:"center",togglerAlign_closed:"center",togglerTip_open:lang.Close,togglerTip_closed:lang.Open,togglerContent_open:"",togglerContent_closed:"",resizerDblClickToggle:true,autoResize:true,autoReopen:true,resizerDragOpacity:1,maskContents:false,maskObjects:false,maskZindex:null,resizingGrid:false,livePaneResizing:false,liveContentResizing:false,liveResizingTolerance:1,noRoomToOpenTip:lang.noRoomToOpenTip,resizerTip:lang.Resize,sliderTip:lang.Slide,sliderCursor:"pointer",slideTrigger_open:"click",slideTrigger_close:"mouseleave",slideDelay_open:300,slideDelay_close:300,hideTogglerOnSlide:false,preventQuickSlideClose:$.layout.browser.webkit,preventPrematureSlideClose:false,showOverflowOnHover:false,enableCursorHotkey:true,customHotkeyModifier:"SHIFT",fxName:"slide",fxSpeed:null,fxSettings:{},fxOpacityFix:true,animatePaneSizing:false,childOptions:null,initChildLayout:true,destroyChildLayout:true,resizeChildLayout:true,triggerEventsOnLoad:false,triggerEventsDuringLiveResize:true,onshow_start:null,onshow_end:null,onhide_start:null,onhide_end:null,onopen_start:null,onopen_end:null,onclose_start:null,onclose_end:null,onresize_start:null,onresize_end:null,onsizecontent_start:null,onsizecontent_end:null,onswap_start:null,onswap_end:null,ondrag_start:null,ondrag_end:null},north:{paneSelector:".ui-layout-north",size:"auto",resizerCursor:"n-resize",customHotkey:""},south:{paneSelector:".ui-layout-south",size:"auto",resizerCursor:"s-resize",customHotkey:""},east:{paneSelector:".ui-layout-east",size:200,resizerCursor:"e-resize",customHotkey:""},west:{paneSelector:".ui-layout-west",size:200,resizerCursor:"w-resize",customHotkey:""},center:{paneSelector:".ui-layout-center",minWidth:0,minHeight:0}};$.layout.optionsMap={layout:("stateManagement,effects,zIndexes,"
+"name,zIndex,scrollToBookmarkOnLoad,showErrorMessages,"
+"resizeWithWindow,resizeWithWindowDelay,resizeWithWindowMaxDelay,"
+"onresizeall,onresizeall_start,onresizeall_end,onload,onunload,autoBindCustomButtons").split(","),center:("paneClass,contentSelector,contentIgnoreSelector,findNestedContent,applyDemoStyles,triggerEventsOnLoad,"
+"showOverflowOnHover,maskContents,maskObjects,liveContentResizing,"
+"childOptions,initChildLayout,resizeChildLayout,destroyChildLayout,"
+"onresize,onresize_start,onresize_end,onsizecontent,onsizecontent_start,onsizecontent_end").split(","),noDefault:("paneSelector,resizerCursor,customHotkey").split(",")};$.layout.transformData=function(hash){var json={panes:{},center:{}},data,branch,optKey,keys,key,val,i,c;if(typeof hash!=="object")return json;for(optKey in hash){branch=json;data=$.layout.optionsMap.layout;val=hash[optKey];keys=optKey.split("__");c=keys.length-1;for(i=0;i<=c;i++){key=keys[i];if(i===c)
branch[key]=val;else if(!branch[key])
branch[key]={};branch=branch[key];}}
return json;}
$.layout.backwardCompatibility={map:{applyDefaultStyles:"applyDemoStyles",resizeNestedLayout:"resizeChildLayout",resizeWhileDragging:"livePaneResizing",resizeContentWhileDragging:"liveContentResizing",triggerEventsWhileDragging:"triggerEventsDuringLiveResize",maskIframesOnResize:"maskContents",useStateCookie:"stateManagement.enabled","cookie.autoLoad":"stateManagement.autoLoad","cookie.autoSave":"stateManagement.autoSave","cookie.keys":"stateManagement.stateKeys","cookie.name":"stateManagement.cookie.name","cookie.domain":"stateManagement.cookie.domain","cookie.path":"stateManagement.cookie.path","cookie.expires":"stateManagement.cookie.expires","cookie.secure":"stateManagement.cookie.secure"},renameOptions:function(opts){var map=$.layout.backwardCompatibility.map,oldData,newData,value;for(var itemPath in map){oldData=getBranch(itemPath);value=oldData.branch[oldData.key]
if(value!==undefined){newData=getBranch(map[itemPath],true)
newData.branch[newData.key]=value;delete oldData.branch[oldData.key];}}
function getBranch(path,create){var a=path.split("."),c=a.length-1,D={branch:opts,key:a[c]},i=0,k,undef;for(;i<c;i++){k=a[i];if(D.branch[k]==undefined){if(create){D.branch=D.branch[k]={};}
else
D.branch={};}
else
D.branch=D.branch[k];}
return D;};},renameAllOptions:function(opts){var ren=$.layout.backwardCompatibility.renameOptions;ren(opts);if(opts.defaults){if(typeof opts.panes!=="object")
opts.panes={};$.extend(true,opts.panes,opts.defaults);delete opts.defaults;}
if(opts.panes)ren(opts.panes);$.each($.layout.config.allPanes,function(i,pane){if(opts[pane])ren(opts[pane]);});return opts;}};$.fn.layout=function(opts){var
browser=$.layout.browser,lang=$.layout.language,_c=$.layout.config,cssW=$.layout.cssWidth,cssH=$.layout.cssHeight,elDims=$.layout.getElementDimensions,elCSS=$.layout.getElementCSS,evtObj=$.layout.getEventObject,evtPane=$.layout.parsePaneName,options=$.extend(true,{},$.layout.defaults),effects=options.effects=$.extend(true,{},$.layout.effects),state={id:"layout"+$.now(),initialized:false,container:{},north:{},south:{},east:{},west:{},center:{}},children={north:null,south:null,east:null,west:null,center:null},timer={data:{},set:function(s,fn,ms){timer.clear(s);timer.data[s]=setTimeout(fn,ms);},clear:function(s){var t=timer.data;if(t[s]){clearTimeout(t[s]);delete t[s];}}},_log=function(msg,popup){$.layout.msg(options.name+' / '+msg,(popup&&options.showErrorMessages));},_runCallbacks=function(evtName,pane,skipBoundEvents){var o=pane?options[pane]:options,lng=evtName+(evtName.match(/_/)?"":"_end"),shrt=lng.match(/_end$/)?lng.substr(0,lng.length-4):"",fn=o[lng],retVal="NC",args=[];if(!fn&&shrt)
fn=o[shrt];if(fn){if(isStr(fn)){if(fn.match(/,/)){args=fn.split(","),fn=eval(args[0]);}
else
fn=eval(fn);}
if($.isFunction(fn)){if(args.length)
retVal=fn(args[1]);else if(pane&&$Ps[pane])
retVal=fn(pane,$Ps[pane],state[pane],options[pane],options.name);else
retVal=fn(Instance,state,options,options.name);}}
if(!skipBoundEvents&&retVal!==false){if(pane){$Ps[pane].triggerHandler('layoutpane'+lng,[pane,$Ps[pane],state[pane],options[pane],options.name]);if(shrt)
$Ps[pane].triggerHandler('layoutpane'+shrt,[pane,$Ps[pane],state[pane],options[pane],options.name]);}
else
$N.triggerHandler('layout'+lng,[pane,$Ps[pane],state[pane],options[pane],options.name]);}
if(evtName==="onresize_end"||evtName==="onsizecontent_end")
resizeChildLayout(pane);return retVal;},_fixIframe=function(pane){if(browser.mozilla)return;var $P=$Ps[pane];if(state[pane].tagName==="IFRAME")
$P.css(_c.hidden).css(_c.visible);else
$P.find('IFRAME').css(_c.hidden).css(_c.visible);},cssSize=function(pane,outerSize){var fn=_c[pane].dir=="horz"?cssH:cssW;return fn($Ps[pane],outerSize);},cssMinDims=function(pane){var $P=$Ps[pane],dir=_c[pane].dir,d={minWidth:1001-cssW($P,1000),minHeight:1001-cssH($P,1000)};if(dir==="horz")d.minSize=d.minHeight;if(dir==="vert")d.minSize=d.minWidth;return d;},setOuterWidth=function(el,outerWidth,autoHide){var $E=el,w;if(isStr(el))$E=$Ps[el];else if(!el.jquery)$E=$(el);w=cssW($E,outerWidth);$E.css({width:w});if(w>0){if(autoHide&&$E.data('autoHidden')&&$E.innerHeight()>0){$E.show().data('autoHidden',false);if(!browser.mozilla)
$E.css(_c.hidden).css(_c.visible);}}
else if(autoHide&&!$E.data('autoHidden'))
$E.hide().data('autoHidden',true);},setOuterHeight=function(el,outerHeight,autoHide){var $E=el,h;if(isStr(el))$E=$Ps[el];else if(!el.jquery)$E=$(el);h=cssH($E,outerHeight);$E.css({height:h,visibility:"visible"});if(h>0&&$E.innerWidth()>0){if(autoHide&&$E.data('autoHidden')){$E.show().data('autoHidden',false);if(!browser.mozilla)
$E.css(_c.hidden).css(_c.visible);}}
else if(autoHide&&!$E.data('autoHidden'))
$E.hide().data('autoHidden',true);},setOuterSize=function(el,outerSize,autoHide){if(_c[pane].dir=="horz")
setOuterHeight(el,outerSize,autoHide);else
setOuterWidth(el,outerSize,autoHide);},_parseSize=function(pane,size,dir){if(!dir)dir=_c[pane].dir;if(isStr(size)&&size.match(/%/))
size=(size==='100%')?-1:parseInt(size,10)/100;if(size===0)
return 0;else if(size>=1)
return parseInt(size,10);var o=options,avail=0;if(dir=="horz")
avail=sC.innerHeight-($Ps.north?o.north.spacing_open:0)-($Ps.south?o.south.spacing_open:0);else if(dir=="vert")
avail=sC.innerWidth-($Ps.west?o.west.spacing_open:0)-($Ps.east?o.east.spacing_open:0);if(size===-1)
return avail;else if(size>0)
return round(avail*size);else if(pane=="center")
return 0;else{var dim=(dir==="horz"?"height":"width"),$P=$Ps[pane],$C=dim==='height'?$Cs[pane]:false,vis=$.layout.showInvisibly($P),szP=$P.css(dim),szC=$C?$C.css(dim):0;$P.css(dim,"auto");if($C)$C.css(dim,"auto");size=(dim==="height")?$P.outerHeight():$P.outerWidth();$P.css(dim,szP).css(vis);if($C)$C.css(dim,szC);return size;}},getPaneSize=function(pane,inclSpace){var
$P=$Ps[pane],o=options[pane],s=state[pane],oSp=(inclSpace?o.spacing_open:0),cSp=(inclSpace?o.spacing_closed:0);if(!$P||s.isHidden)
return 0;else if(s.isClosed||(s.isSliding&&inclSpace))
return cSp;else if(_c[pane].dir==="horz")
return $P.outerHeight()+oSp;else
return $P.outerWidth()+oSp;},setSizeLimits=function(pane,slide){if(!isInitialized())return;var
o=options[pane],s=state[pane],c=_c[pane],dir=c.dir,side=c.side.toLowerCase(),type=c.sizeType.toLowerCase(),isSliding=(slide!=undefined?slide:s.isSliding),$P=$Ps[pane],paneSpacing=o.spacing_open,altPane=_c.oppositeEdge[pane],altS=state[altPane],$altP=$Ps[altPane],altPaneSize=(!$altP||altS.isVisible===false||altS.isSliding?0:(dir=="horz"?$altP.outerHeight():$altP.outerWidth())),altPaneSpacing=((!$altP||altS.isHidden?0:options[altPane][altS.isClosed!==false?"spacing_closed":"spacing_open"])||0),containerSize=(dir=="horz"?sC.innerHeight:sC.innerWidth),minCenterDims=cssMinDims("center"),minCenterSize=dir=="horz"?max(options.center.minHeight,minCenterDims.minHeight):max(options.center.minWidth,minCenterDims.minWidth),limitSize=(containerSize-paneSpacing-(isSliding?0:(_parseSize("center",minCenterSize,dir)+altPaneSize+altPaneSpacing))),minSize=s.minSize=max(_parseSize(pane,o.minSize),cssMinDims(pane).minSize),maxSize=s.maxSize=min((o.maxSize?_parseSize(pane,o.maxSize):100000),limitSize),r=s.resizerPosition={},top=sC.insetTop,left=sC.insetLeft,W=sC.innerWidth,H=sC.innerHeight,rW=o.spacing_open;switch(pane){case"north":r.min=top+minSize;r.max=top+maxSize;break;case"west":r.min=left+minSize;r.max=left+maxSize;break;case"south":r.min=top+H-maxSize-rW;r.max=top+H-minSize-rW;break;case"east":r.min=left+W-maxSize-rW;r.max=left+W-minSize-rW;break;};},calcNewCenterPaneDims=function(){var d={top:getPaneSize("north",true),bottom:getPaneSize("south",true),left:getPaneSize("west",true),right:getPaneSize("east",true),width:0,height:0};d.width=sC.innerWidth-d.left-d.right;d.height=sC.innerHeight-d.bottom-d.top;d.top+=sC.insetTop;d.bottom+=sC.insetBottom;d.left+=sC.insetLeft;d.right+=sC.insetRight;return d;},getHoverClasses=function(el,allStates){var
$El=$(el),type=$El.data("layoutRole"),pane=$El.data("layoutEdge"),o=options[pane],root=o[type+"Class"],_pane="-"+pane,_open="-open",_closed="-closed",_slide="-sliding",_hover="-hover ",_state=$El.hasClass(root+_closed)?_closed:_open,_alt=_state===_closed?_open:_closed,classes=(root+_hover)+(root+_pane+_hover)+(root+_state+_hover)+(root+_pane+_state+_hover);if(allStates)
classes+=(root+_alt+_hover)+(root+_pane+_alt+_hover);if(type=="resizer"&&$El.hasClass(root+_slide))
classes+=(root+_slide+_hover)+(root+_pane+_slide+_hover);return $.trim(classes);},addHover=function(evt,el){var $E=$(el||this);if(evt&&$E.data("layoutRole")==="toggler")
evt.stopPropagation();$E.addClass(getHoverClasses($E));},removeHover=function(evt,el){var $E=$(el||this);$E.removeClass(getHoverClasses($E,true));},onResizerEnter=function(evt){if($.fn.disableSelection)
$("body").disableSelection();},onResizerLeave=function(evt,el){var
e=el||this,pane=$(e).data("layoutEdge"),name=pane+"ResizerLeave";timer.clear(pane+"_openSlider");timer.clear(name);if(!el)
timer.set(name,function(){onResizerLeave(evt,e);},200);else if(!state[pane].isResizing&&$.fn.enableSelection)
$("body").enableSelection();},_create=function(){initOptions();var o=options;state.creatingLayout=true;runPluginCallbacks(Instance,$.layout.onCreate);if(false===_runCallbacks("onload_start"))
return'cancel';_initContainer();initHotkeys();$(window).bind("unload."+sID,unload);runPluginCallbacks(Instance,$.layout.onLoad);if(o.initPanes)_initLayoutElements();delete state.creatingLayout;return state.initialized;},isInitialized=function(){if(state.initialized||state.creatingLayout)return true;else return _initLayoutElements();},_initLayoutElements=function(retry){var o=options;if(!$N.is(":visible")){if(!retry&&browser.webkit&&$N[0].tagName==="BODY")
setTimeout(function(){_initLayoutElements(true);},50);return false;}
if(!getPane("center").length){if(options.showErrorMessages)
_log(lang.errCenterPaneMissing,true);return false;}
state.creatingLayout=true;$.extend(sC,elDims($N));initPanes();if(o.scrollToBookmarkOnLoad){var l=self.location;if(l.hash)l.replace(l.hash);}
if(Instance.hasParentLayout)
o.resizeWithWindow=false;else if(o.resizeWithWindow)
$(window).bind("resize."+sID,windowResize);delete state.creatingLayout;state.initialized=true;runPluginCallbacks(Instance,$.layout.onReady);_runCallbacks("onload_end");return true;},_initChildLayouts=function(){$.each(_c.allPanes,function(idx,pane){if(options[pane].initChildLayout)
createChildLayout(pane);});},createChildLayout=function(evt_or_pane,opts){var pane=evtPane.call(this,evt_or_pane),$P=$Ps[pane],C=children;if($P){var $C=$Cs[pane],o=opts||options[pane].childOptions,d="layout",$Cont=o.containerSelector?$P.find(o.containerSelector):($C||$P),containerFound=$Cont.length,child=containerFound?(C[pane]=$Cont.data(d)||null):null;if(!child&&containerFound&&o)
child=C[pane]=$Cont.eq(0).layout(o)||null;if(child)
child.hasParentLayout=true;}
Instance[pane].child=C[pane];},windowResize=function(){var delay=Number(options.resizeWithWindowDelay);if(delay<10)delay=100;timer.clear("winResize");timer.set("winResize",function(){timer.clear("winResize");timer.clear("winResizeRepeater");var dims=elDims($N);if(dims.innerWidth!==sC.innerWidth||dims.innerHeight!==sC.innerHeight)
resizeAll();},delay);if(!timer.data["winResizeRepeater"])setWindowResizeRepeater();},setWindowResizeRepeater=function(){var delay=Number(options.resizeWithWindowMaxDelay);if(delay>0)
timer.set("winResizeRepeater",function(){setWindowResizeRepeater();resizeAll();},delay);},unload=function(){var o=options;_runCallbacks("onunload_start");runPluginCallbacks(Instance,$.layout.onUnload);_runCallbacks("onunload_end");},_initContainer=function(){var
N=$N[0],tag=sC.tagName=N.tagName,id=sC.id=N.id,cls=sC.className=N.className,o=options,name=o.name,fullPage=(tag==="BODY"),props="overflow,position,margin,padding,border",css="layoutCSS",CSS={},hid="hidden",parent=$N.data("parentLayout"),pane=$N.data("layoutEdge"),isChild=parent&&pane;sC.selector=$N.selector.split(".slice")[0];sC.ref=(o.name?o.name+' layout / ':'')+tag+(id?"#"+id:cls?'.['+cls+']':'');$N.data({layout:Instance,layoutContainer:sID}).addClass(o.containerClass);var layoutMethods={destroy:'',initPanes:'',resizeAll:'resizeAll',resize:'resizeAll'},name;for(name in layoutMethods){$N.bind("layout"+name.toLowerCase()+"."+sID,Instance[layoutMethods[name]||name]);}
if(isChild){Instance.hasParentLayout=true;parent[pane].child=parent.children[pane]=$N.data("layout");}
if(!$N.data(css)){if(fullPage){CSS=$.extend(elCSS($N,props),{height:$N.css("height"),overflow:$N.css("overflow"),overflowX:$N.css("overflowX"),overflowY:$N.css("overflowY")});var $H=$("html");$H.data(css,{height:"auto",overflow:$H.css("overflow"),overflowX:$H.css("overflowX"),overflowY:$H.css("overflowY")});}
else
CSS=elCSS($N,props+",top,bottom,left,right,width,height,overflow,overflowX,overflowY");$N.data(css,CSS);}
try{if(fullPage){$("html").css({height:"100%",overflow:hid,overflowX:hid,overflowY:hid});$("body").css({position:"relative",height:"100%",overflow:hid,overflowX:hid,overflowY:hid,margin:0,padding:0,border:"none"});$.extend(sC,elDims($N));}
else{CSS={overflow:hid,overflowX:hid,overflowY:hid}
var
p=$N.css("position"),h=$N.css("height");if(!isChild){if(!p||!p.match(/fixed|absolute|relative/))
CSS.position="relative";}
$N.css(CSS);if($N.is(":visible")){$.extend(sC,elDims($N));if(o.showErrorMessages&&sC.innerHeight<1)
_log(lang.errContainerHeight.replace(/CONTAINER/,sC.ref),true);}}}catch(ex){}},initHotkeys=function(panes){panes=panes?panes.split(","):_c.borderPanes;$.each(panes,function(i,pane){var o=options[pane];if(o.enableCursorHotkey||o.customHotkey){$(document).bind("keydown."+sID,keyDown);return false;}});},initOptions=function(){var data,d,pane,key,val,i,c,o;opts=$.layout.transformData(opts);opts=$.layout.backwardCompatibility.renameAllOptions(opts);if(!$.isEmptyObject(opts.panes)){data=$.layout.optionsMap.noDefault;for(i=0,c=data.length;i<c;i++){key=data[i];delete opts.panes[key];}
data=$.layout.optionsMap.layout;for(i=0,c=data.length;i<c;i++){key=data[i];delete opts.panes[key];}}
data=$.layout.optionsMap.layout;var rootKeys=$.layout.config.optionRootKeys;for(key in opts){val=opts[key];if($.inArray(key,rootKeys)<0&&$.inArray(key,data)<0){if(!opts.panes[key])
opts.panes[key]=$.isPlainObject(val)?$.extend(true,{},val):val;delete opts[key]}}
$.extend(true,options,opts);$.each(_c.allPanes,function(i,pane){_c[pane]=$.extend(true,{},_c.panes,_c[pane]);d=options.panes;o=options[pane];if(pane==='center'){data=$.layout.optionsMap.center;for(i=0,c=data.length;i<c;i++){key=data[i];if(!opts.center[key]&&(opts.panes[key]||!o[key]))
o[key]=d[key];}}
else{o=options[pane]=$.extend({},d,o);createFxOptions(pane);if(!o.resizerClass)o.resizerClass="ui-layout-resizer";if(!o.togglerClass)o.togglerClass="ui-layout-toggler";}
if(!o.paneClass)o.paneClass="ui-layout-pane";});var zo=opts.zIndex,z=options.zIndexes;if(zo>0){z.pane_normal=zo;z.content_mask=max(zo+1,z.content_mask);z.resizer_normal=max(zo+2,z.resizer_normal);}
function createFxOptions(pane){var o=options[pane],d=options.panes;if(!o.fxSettings)o.fxSettings={};if(!d.fxSettings)d.fxSettings={};$.each(["_open","_close","_size"],function(i,n){var
sName="fxName"+n,sSpeed="fxSpeed"+n,sSettings="fxSettings"+n,fxName=o[sName]=o[sName]||d[sName]||o.fxName||d.fxName||"none";if(fxName==="none"||!$.effects||!$.effects[fxName]||!options.effects[fxName])
fxName=o[sName]="none";var fx=options.effects[fxName]||{},fx_all=fx.all||null,fx_pane=fx[pane]||null;o[sSpeed]=o[sSpeed]||d[sSpeed]||o.fxSpeed||d.fxSpeed||null;o[sSettings]=$.extend({},fx_all,fx_pane,d.fxSettings,o.fxSettings,d[sSettings],o[sSettings]);});delete o.fxName;delete o.fxSpeed;delete o.fxSettings;}
delete options.panes;},getPane=function(pane){var sel=options[pane].paneSelector
if(sel.substr(0,1)==="#")
return $N.find(sel).eq(0);else{var $P=$N.children(sel).eq(0);return $P.length?$P:$N.children("form:first").children(sel).eq(0);}},initPanes=function(){$.each(_c.allPanes,function(idx,pane){addPane(pane,true);});initHandles();$.each(_c.borderPanes,function(i,pane){if($Ps[pane]&&state[pane].isVisible){setSizeLimits(pane);makePaneFit(pane);}});sizeMidPanes("center");$.each(_c.allPanes,function(i,pane){var o=options[pane];if($Ps[pane]){if(state[pane].isVisible){sizeContent(pane);if(o.triggerEventsOnLoad)
_runCallbacks("onresize_end",pane);else
resizeChildLayout(pane);}
if(o.initChildLayout&&o.childOptions)
createChildLayout(pane);}});},addPane=function(pane,force){if(!force&&!isInitialized())return;var
o=options[pane],s=state[pane],c=_c[pane],fx=s.fx,dir=c.dir,spacing=o.spacing_open||0,isCenter=(pane==="center"),CSS={},$P=$Ps[pane],size,minSize,maxSize;if($P)
removePane(pane,false,true,false);else
$Cs[pane]=false;$P=$Ps[pane]=getPane(pane);if(!$P.length){$Ps[pane]=false;return;}
if(!$P.data("layoutCSS")){var props="position,top,left,bottom,right,width,height,overflow,zIndex,display,backgroundColor,padding,margin,border";$P.data("layoutCSS",elCSS($P,props));}
Instance[pane]={name:pane,pane:$Ps[pane],content:$Cs[pane],options:options[pane],state:state[pane],child:children[pane]};$P.data({parentLayout:Instance,layoutPane:Instance[pane],layoutEdge:pane,layoutRole:"pane"}).css(c.cssReq).css("zIndex",options.zIndexes.pane_normal).css(o.applyDemoStyles?c.cssDemo:{}).addClass(o.paneClass+" "+o.paneClass+"-"+pane).bind("mouseenter."+sID,addHover).bind("mouseleave."+sID,removeHover);var paneMethods={hide:'',show:'',toggle:'',close:'',open:'',slideOpen:'',slideClose:'',slideToggle:'',size:'manualSizePane',sizePane:'manualSizePane',sizeContent:'',sizeHandles:'',enableClosable:'',disableClosable:'',enableSlideable:'',disableSlideable:'',enableResizable:'',disableResizable:'',swapPanes:'swapPanes',swap:'swapPanes',move:'swapPanes',removePane:'removePane',remove:'removePane',createChildLayout:'',resizeChildLayout:'',resizeAll:'resizeAll',resizeLayout:'resizeAll'},name;for(name in paneMethods){$P.bind("layoutpane"+name.toLowerCase()+"."+sID,Instance[paneMethods[name]||name]);}
initContent(pane,false);if(!isCenter){size=s.size=_parseSize(pane,o.size);minSize=_parseSize(pane,o.minSize)||1;maxSize=_parseSize(pane,o.maxSize)||100000;if(size>0)size=max(min(size,maxSize),minSize);s.isClosed=false;s.isSliding=false;s.isResizing=false;s.isHidden=false;if(!s.pins)s.pins=[];}
s.tagName=$P[0].tagName;s.edge=pane;s.noRoom=false;s.isVisible=true;switch(pane){case"north":CSS.top=sC.insetTop;CSS.left=sC.insetLeft;CSS.right=sC.insetRight;break;case"south":CSS.bottom=sC.insetBottom;CSS.left=sC.insetLeft;CSS.right=sC.insetRight;break;case"west":CSS.left=sC.insetLeft;break;case"east":CSS.right=sC.insetRight;break;case"center":}
if(dir==="horz")
CSS.height=cssH($P,size);else if(dir==="vert")
CSS.width=cssW($P,size);$P.css(CSS);if(dir!="horz")sizeMidPanes(pane,true);if(o.initClosed&&o.closable&&!o.initHidden)
close(pane,true,true);else if(o.initHidden||o.initClosed)
hide(pane);else if(!s.noRoom)
$P.css("display","block");$P.css("visibility","visible");if(o.showOverflowOnHover)
$P.hover(allowOverflow,resetOverflow);if(state.initialized){initHandles(pane);initHotkeys(pane);resizeAll();if(s.isVisible){if(o.triggerEventsOnLoad)
_runCallbacks("onresize_end",pane);else
resizeChildLayout(pane);}
if(o.initChildLayout&&o.childOptions)
createChildLayout(pane);}},initHandles=function(panes){panes=panes?panes.split(","):_c.borderPanes;$.each(panes,function(i,pane){var $P=$Ps[pane];$Rs[pane]=false;$Ts[pane]=false;if(!$P)return;var
o=options[pane],s=state[pane],c=_c[pane],rClass=o.resizerClass,tClass=o.togglerClass,side=c.side.toLowerCase(),spacing=(s.isVisible?o.spacing_open:o.spacing_closed),_pane="-"+pane,_state=(s.isVisible?"-open":"-closed"),I=Instance[pane],$R=I.resizer=$Rs[pane]=$("<div></div>"),$T=I.toggler=(o.closable?$Ts[pane]=$("<div></div>"):false);if(!s.isVisible&&o.slidable)
$R.attr("title",o.sliderTip).css("cursor",o.sliderCursor);$R.attr("id",(o.paneSelector.substr(0,1)=="#"?o.paneSelector.substr(1)+"-resizer":"")).data({parentLayout:Instance,layoutPane:Instance[pane],layoutEdge:pane,layoutRole:"resizer"}).css(_c.resizers.cssReq).css("zIndex",options.zIndexes.resizer_normal).css(o.applyDemoStyles?_c.resizers.cssDemo:{}).addClass(rClass+" "+rClass+_pane).hover(addHover,removeHover).hover(onResizerEnter,onResizerLeave).appendTo($N);if($T){$T.attr("id",(o.paneSelector.substr(0,1)=="#"?o.paneSelector.substr(1)+"-toggler":"")).data({parentLayout:Instance,layoutPane:Instance[pane],layoutEdge:pane,layoutRole:"toggler"}).css(_c.togglers.cssReq).css(o.applyDemoStyles?_c.togglers.cssDemo:{}).addClass(tClass+" "+tClass+_pane).hover(addHover,removeHover).bind("mouseenter",onResizerEnter).appendTo($R);if(o.togglerContent_open)
$("<span>"+o.togglerContent_open+"</span>").data({layoutEdge:pane,layoutRole:"togglerContent"}).data("layoutRole","togglerContent").data("layoutEdge",pane).addClass("content content-open").css("display","none").appendTo($T);if(o.togglerContent_closed)
$("<span>"+o.togglerContent_closed+"</span>").data({layoutEdge:pane,layoutRole:"togglerContent"}).addClass("content content-closed").css("display","none").appendTo($T);enableClosable(pane);}
initResizable(pane);if(s.isVisible)
setAsOpen(pane);else{setAsClosed(pane);bindStartSlidingEvent(pane,true);}});sizeHandles();},initContent=function(pane,resize){if(!isInitialized())return;var
o=options[pane],sel=o.contentSelector,I=Instance[pane],$P=$Ps[pane],$C;if(sel)$C=I.content=$Cs[pane]=(o.findNestedContent)?$P.find(sel).eq(0):$P.children(sel).eq(0);if($C&&$C.length){$C.data("layoutRole","content");if(!$C.data("layoutCSS"))
$C.data("layoutCSS",elCSS($C,"height"));$C.css(_c.content.cssReq);if(o.applyDemoStyles){$C.css(_c.content.cssDemo);$P.css(_c.content.cssDemoPane);}
state[pane].content={};if(resize!==false)sizeContent(pane);}
else
I.content=$Cs[pane]=false;},initResizable=function(panes){var draggingAvailable=$.layout.plugins.draggable,side;panes=panes?panes.split(","):_c.borderPanes;$.each(panes,function(idx,pane){var o=options[pane];if(!draggingAvailable||!$Ps[pane]||!o.resizable){o.resizable=false;return true;}
var s=state[pane],z=options.zIndexes,c=_c[pane],side=c.dir=="horz"?"top":"left",opEdge=_c.oppositeEdge[pane],masks=pane+",center,"+opEdge+(c.dir=="horz"?",west,east":""),$P=$Ps[pane],$R=$Rs[pane],base=o.resizerClass,lastPos=0,r,live,resizerClass=base+"-drag",resizerPaneClass=base+"-"+pane+"-drag",helperClass=base+"-dragging",helperPaneClass=base+"-"+pane+"-dragging",helperLimitClass=base+"-dragging-limit",helperPaneLimitClass=base+"-"+pane+"-dragging-limit",helperClassesSet=false;if(!s.isClosed)
$R.attr("title",o.resizerTip).css("cursor",o.resizerCursor);$R.draggable({containment:$N[0],axis:(c.dir=="horz"?"y":"x"),delay:0,distance:1,grid:o.resizingGrid,helper:"clone",opacity:o.resizerDragOpacity,addClasses:false,zIndex:z.resizer_drag,start:function(e,ui){o=options[pane];s=state[pane];live=o.livePaneResizing;if(false===_runCallbacks("ondrag_start",pane))return false;s.isResizing=true;timer.clear(pane+"_closeSlider");setSizeLimits(pane);r=s.resizerPosition;lastPos=ui.position[side]
$R.addClass(resizerClass+" "+resizerPaneClass);helperClassesSet=false;$('body').disableSelection();showMasks(masks);},drag:function(e,ui){if(!helperClassesSet){ui.helper.addClass(helperClass+" "+helperPaneClass).css({right:"auto",bottom:"auto"}).children().css("visibility","hidden");helperClassesSet=true;if(s.isSliding)$Ps[pane].css("zIndex",z.pane_sliding);}
var limit=0;if(ui.position[side]<r.min){ui.position[side]=r.min;limit=-1;}
else if(ui.position[side]>r.max){ui.position[side]=r.max;limit=1;}
if(limit){ui.helper.addClass(helperLimitClass+" "+helperPaneLimitClass);window.defaultStatus=(limit>0&&pane.match(/north|west/))||(limit<0&&pane.match(/south|east/))?lang.maxSizeWarning:lang.minSizeWarning;}
else{ui.helper.removeClass(helperLimitClass+" "+helperPaneLimitClass);window.defaultStatus="";}
if(live&&Math.abs(ui.position[side]-lastPos)>=o.liveResizingTolerance){lastPos=ui.position[side];resizePanes(e,ui,pane)}},stop:function(e,ui){$('body').enableSelection();window.defaultStatus="";$R.removeClass(resizerClass+" "+resizerPaneClass);s.isResizing=false;resizePanes(e,ui,pane,true,masks);}});});var resizePanes=function(evt,ui,pane,resizingDone,masks){var dragPos=ui.position,c=_c[pane],o=options[pane],s=state[pane],resizerPos;switch(pane){case"north":resizerPos=dragPos.top;break;case"west":resizerPos=dragPos.left;break;case"south":resizerPos=sC.offsetHeight-dragPos.top-o.spacing_open;break;case"east":resizerPos=sC.offsetWidth-dragPos.left-o.spacing_open;break;};var newSize=resizerPos-sC["inset"+c.side];if(!resizingDone){if(Math.abs(newSize-s.size)<o.liveResizingTolerance)
return;manualSizePane(pane,newSize,false,true);sizeMasks();}
else{if(false!==_runCallbacks("ondrag_end",pane))
manualSizePane(pane,newSize,false,true);hideMasks();if(s.isSliding&&masks)
showMasks(masks,true);}};},sizeMask=function(){var $M=$(this),pane=$M.data("layoutMask"),s=state[pane];if(s.tagName=="IFRAME"&&s.isVisible)
$M.css({top:s.offsetTop,left:s.offsetLeft,width:s.outerWidth,height:s.outerHeight});},sizeMasks=function(){$Ms.each(sizeMask);},showMasks=function(panes,onlyForObjects){var a=panes?panes.split(","):$.layout.config.allPanes,z=options.zIndexes,o,s;$.each(a,function(i,p){s=state[p];o=options[p];if(s.isVisible&&((!onlyForObjects&&o.maskContents)||o.maskObjects)){getMasks(p).each(function(){sizeMask.call(this);this.style.zIndex=s.isSliding?z.pane_sliding+1:z.pane_normal+1
this.style.display="block";});}});},hideMasks=function(){var skip;$.each($.layout.config.borderPanes,function(i,p){if(state[p].isResizing){skip=true;return false;}});if(!skip)
$Ms.hide();},getMasks=function(pane){var $Masks=$([]),$M,i=0,c=$Ms.length;for(;i<c;i++){$M=$Ms.eq(i);if($M.data("layoutMask")===pane)
$Masks=$Masks.add($M);}
if($Masks.length)
return $Masks;else
return createMasks(pane);},createMasks=function(pane){var
$P=$Ps[pane],s=state[pane],o=options[pane],z=options.zIndexes,$Masks=$([]),isIframe,el,$M,css,i;if(!o.maskContents&&!o.maskObjects)return $Masks;for(i=0;i<(o.maskObjects?2:1);i++){isIframe=o.maskObjects&&i==0;el=document.createElement(isIframe?"iframe":"div");$M=$(el).data("layoutMask",pane);el.className="ui-layout-mask ui-layout-mask-"+pane;css=el.style;css.display="block";css.position="absolute";if(isIframe){el.frameborder=0;el.src="about:blank";css.opacity=0;css.filter="Alpha(Opacity='0')";css.border=0;}
if(s.tagName=="IFRAME"){css.zIndex=z.pane_normal+1;$N.append(el);}
else{$M.addClass("ui-layout-mask-inside-pane");css.zIndex=o.maskZindex||z.content_mask;css.top=0;css.left=0;css.width="100%";css.height="100%";$P.append(el);}
$Masks=$Masks.add(el);$Ms=$Ms.add(el);}
return $Masks;},destroy=function(destroyChildren){$(window).unbind("."+sID);$(document).unbind("."+sID);$N.clearQueue().removeData("layout").removeData("layoutContainer").removeClass(options.containerClass).unbind("."+sID);$Ms.remove();$.each(_c.allPanes,function(i,pane){removePane(pane,false,true,destroyChildren);});var css="layoutCSS";if($N.data(css)&&!$N.data("layoutRole"))
$N.css($N.data(css)).removeData(css);if(sC.tagName==="BODY"&&($N=$("html")).data(css))
$N.css($N.data(css)).removeData(css);runPluginCallbacks(Instance,$.layout.onDestroy);unload();for(n in Instance)
if(!n.match(/^(container|options)$/))delete Instance[n];Instance.destroyed=true;return Instance;},removePane=function(evt_or_pane,remove,skipResize,destroyChild){if(!isInitialized())return;var pane=evtPane.call(this,evt_or_pane),$P=$Ps[pane],$C=$Cs[pane],$R=$Rs[pane],$T=$Ts[pane];if($P&&$.isEmptyObject($P.data()))$P=false;if($C&&$.isEmptyObject($C.data()))$C=false;if($R&&$.isEmptyObject($R.data()))$R=false;if($T&&$.isEmptyObject($T.data()))$T=false;if($P)$P.stop(true,true);var o=options[pane],s=state[pane],d="layout",css="layoutCSS",child=children[pane]||($P?$P.data(d):0)||($C?$C.data(d):0)||null,destroy=destroyChild!==undefined?destroyChild:o.destroyChildLayout;if(destroy&&child&&!child.destroyed){child.destroy(true);if(child.destroyed)
child=null;}
if($P&&remove&&!child)
$P.remove();else if($P&&$P[0]){var root=o.paneClass,pRoot=root+"-"+pane,_open="-open",_sliding="-sliding",_closed="-closed",classes=[root,root+_open,root+_closed,root+_sliding,pRoot,pRoot+_open,pRoot+_closed,pRoot+_sliding];$.merge(classes,getHoverClasses($P,true));$P.removeClass(classes.join(" ")).removeData("parentLayout").removeData("layoutPane").removeData("layoutRole").removeData("layoutEdge").removeData("autoHidden").unbind("."+sID);if($C&&$C.data(d)){$C.width($C.width());child.resizeAll();}
else if($C)
$C.css($C.data(css)).removeData(css).removeData("layoutRole");if(!$P.data(d))
$P.css($P.data(css)).removeData(css);}
if($T)$T.remove();if($R)$R.remove();Instance[pane]=$Ps[pane]=$Cs[pane]=$Rs[pane]=$Ts[pane]=children[pane]=false;s={removed:true};if(!skipResize)
resizeAll();},_hidePane=function(pane){var $P=$Ps[pane],o=options[pane],s=$P[0].style;if(o.useOffscreenClose){if(!$P.data(_c.offscreenReset))
$P.data(_c.offscreenReset,{left:s.left,right:s.right});$P.css(_c.offscreenCSS);}
else
$P.hide().removeData(_c.offscreenReset);},_showPane=function(pane){var $P=$Ps[pane],o=options[pane],off=_c.offscreenCSS,old=$P.data(_c.offscreenReset),s=$P[0].style;$P.show().removeData(_c.offscreenReset);if(o.useOffscreenClose&&old){if(s.left==off.left)
s.left=old.left;if(s.right==off.right)
s.right=old.right;}},hide=function(evt_or_pane,noAnimation){if(!isInitialized())return;var pane=evtPane.call(this,evt_or_pane),o=options[pane],s=state[pane],$P=$Ps[pane],$R=$Rs[pane];if(!$P||s.isHidden)return;if(state.initialized&&false===_runCallbacks("onhide_start",pane))return;s.isSliding=false;if($R)$R.hide();if(!state.initialized||s.isClosed){s.isClosed=true;s.isHidden=true;s.isVisible=false;if(!state.initialized)
_hidePane(pane);sizeMidPanes(_c[pane].dir==="horz"?"":"center");if(state.initialized||o.triggerEventsOnLoad)
_runCallbacks("onhide_end",pane);}
else{s.isHiding=true;close(pane,false,noAnimation);}},show=function(evt_or_pane,openPane,noAnimation,noAlert){if(!isInitialized())return;var pane=evtPane.call(this,evt_or_pane),o=options[pane],s=state[pane],$P=$Ps[pane],$R=$Rs[pane];if(!$P||!s.isHidden)return;if(false===_runCallbacks("onshow_start",pane))return;s.isSliding=false;s.isShowing=true;if(openPane===false)
close(pane,true);else
open(pane,false,noAnimation,noAlert);},toggle=function(evt_or_pane,slide){if(!isInitialized())return;var evt=evtObj(evt_or_pane),pane=evtPane.call(this,evt_or_pane),s=state[pane];if(evt)
evt.stopImmediatePropagation();if(s.isHidden)
show(pane);else if(s.isClosed)
open(pane,!!slide);else
close(pane);},_closePane=function(pane,setHandles){var
$P=$Ps[pane],s=state[pane];_hidePane(pane);s.isClosed=true;s.isVisible=false;},close=function(evt_or_pane,force,noAnimation,skipCallback){var pane=evtPane.call(this,evt_or_pane);if(!state.initialized&&$Ps[pane]){_closePane(pane);return;}
if(!isInitialized())return;var
$P=$Ps[pane],$R=$Rs[pane],$T=$Ts[pane],o=options[pane],s=state[pane],c=_c[pane],doFX,isShowing,isHiding,wasSliding;$N.queue(function(queueNext){if(!$P||(!o.closable&&!s.isShowing&&!s.isHiding)||(!force&&s.isClosed&&!s.isShowing))return queueNext();var abort=!s.isShowing&&false===_runCallbacks("onclose_start",pane);isShowing=s.isShowing;isHiding=s.isHiding;wasSliding=s.isSliding;delete s.isShowing;delete s.isHiding;if(abort)return queueNext();doFX=!noAnimation&&!s.isClosed&&(o.fxName_close!="none");s.isMoving=true;s.isClosed=true;s.isVisible=false;if(isHiding)s.isHidden=true;else if(isShowing)s.isHidden=false;if(s.isSliding)
bindStopSlidingEvents(pane,false);else
sizeMidPanes(_c[pane].dir==="horz"?"":"center",false);setAsClosed(pane);if(doFX){var masks="center"+(c.dir=="horz"?",west,east":"");showMasks(masks,true);lockPaneForFX(pane,true);$P.hide(o.fxName_close,o.fxSettings_close,o.fxSpeed_close,function(){lockPaneForFX(pane,false);if(s.isClosed)close_2();queueNext();});}
else{_hidePane(pane);close_2();queueNext();};});function close_2(){s.isMoving=false;bindStartSlidingEvent(pane,true);var altPane=_c.oppositeEdge[pane];if(state[altPane].noRoom){setSizeLimits(altPane);makePaneFit(altPane);}
hideMasks();if(!skipCallback&&(state.initialized||o.triggerEventsOnLoad)){if(!isShowing)_runCallbacks("onclose_end",pane);if(isShowing)_runCallbacks("onshow_end",pane);if(isHiding)_runCallbacks("onhide_end",pane);}}},setAsClosed=function(pane){var
$P=$Ps[pane],$R=$Rs[pane],$T=$Ts[pane],o=options[pane],s=state[pane],side=_c[pane].side.toLowerCase(),inset="inset"+_c[pane].side,rClass=o.resizerClass,tClass=o.togglerClass,_pane="-"+pane,_open="-open",_sliding="-sliding",_closed="-closed";$R.css(side,sC[inset]).removeClass(rClass+_open+" "+rClass+_pane+_open).removeClass(rClass+_sliding+" "+rClass+_pane+_sliding).addClass(rClass+_closed+" "+rClass+_pane+_closed).unbind("dblclick."+sID);if(o.resizable&&$.layout.plugins.draggable)
$R.draggable("disable").removeClass("ui-state-disabled").css("cursor","default").attr("title","");if($T){$T.removeClass(tClass+_open+" "+tClass+_pane+_open).addClass(tClass+_closed+" "+tClass+_pane+_closed).attr("title",o.togglerTip_closed);$T.children(".content-open").hide();$T.children(".content-closed").css("display","block");}
syncPinBtns(pane,false);if(state.initialized){sizeHandles();}},open=function(evt_or_pane,slide,noAnimation,noAlert){if(!isInitialized())return;var pane=evtPane.call(this,evt_or_pane),$P=$Ps[pane],$R=$Rs[pane],$T=$Ts[pane],o=options[pane],s=state[pane],c=_c[pane],doFX,isShowing;$N.queue(function(queueNext){if(!$P||(!o.resizable&&!o.closable&&!s.isShowing)||(s.isVisible&&!s.isSliding))return queueNext();if(s.isHidden&&!s.isShowing){queueNext();show(pane,true);return;}
if(o.autoResize&&s.size!=o.size)
sizePane(pane,o.size,true,true,true);else
setSizeLimits(pane,slide);var cbReturn=_runCallbacks("onopen_start",pane);if(cbReturn==="abort")
return queueNext();if(cbReturn!=="NC")
setSizeLimits(pane,slide);if(s.minSize>s.maxSize){syncPinBtns(pane,false);if(!noAlert&&o.noRoomToOpenTip)
alert(o.noRoomToOpenTip);return queueNext();}
if(slide)
bindStopSlidingEvents(pane,true);else if(s.isSliding)
bindStopSlidingEvents(pane,false);else if(o.slidable)
bindStartSlidingEvent(pane,false);s.noRoom=false;makePaneFit(pane);isShowing=s.isShowing;delete s.isShowing;doFX=!noAnimation&&s.isClosed&&(o.fxName_open!="none");s.isMoving=true;s.isVisible=true;s.isClosed=false;if(isShowing)s.isHidden=false;if(doFX){var masks="center"+(c.dir=="horz"?",west,east":"");if(s.isSliding)masks+=","+_c.oppositeEdge[pane];showMasks(masks,true);lockPaneForFX(pane,true);$P.show(o.fxName_open,o.fxSettings_open,o.fxSpeed_open,function(){lockPaneForFX(pane,false);if(s.isVisible)open_2();queueNext();});}
else{_showPane(pane);open_2();queueNext();};});function open_2(){s.isMoving=false;_fixIframe(pane);if(!s.isSliding){hideMasks();sizeMidPanes(_c[pane].dir=="vert"?"center":"",false);}
setAsOpen(pane);};},setAsOpen=function(pane,skipCallback){var
$P=$Ps[pane],$R=$Rs[pane],$T=$Ts[pane],o=options[pane],s=state[pane],side=_c[pane].side.toLowerCase(),inset="inset"+_c[pane].side,rClass=o.resizerClass,tClass=o.togglerClass,_pane="-"+pane,_open="-open",_closed="-closed",_sliding="-sliding";$R.css(side,sC[inset]+getPaneSize(pane)).removeClass(rClass+_closed+" "+rClass+_pane+_closed).addClass(rClass+_open+" "+rClass+_pane+_open);if(s.isSliding)
$R.addClass(rClass+_sliding+" "+rClass+_pane+_sliding)
else
$R.removeClass(rClass+_sliding+" "+rClass+_pane+_sliding)
if(o.resizerDblClickToggle)
$R.bind("dblclick",toggle);removeHover(0,$R);if(o.resizable&&$.layout.plugins.draggable)
$R.draggable("enable").css("cursor",o.resizerCursor).attr("title",o.resizerTip);else if(!s.isSliding)
$R.css("cursor","default");if($T){$T.removeClass(tClass+_closed+" "+tClass+_pane+_closed).addClass(tClass+_open+" "+tClass+_pane+_open).attr("title",o.togglerTip_open);removeHover(0,$T);$T.children(".content-closed").hide();$T.children(".content-open").css("display","block");}
syncPinBtns(pane,!s.isSliding);$.extend(s,elDims($P));if(state.initialized){sizeHandles();sizeContent(pane,true);}
if(!skipCallback&&(state.initialized||o.triggerEventsOnLoad)&&$P.is(":visible")){_runCallbacks("onopen_end",pane);if(s.isShowing)_runCallbacks("onshow_end",pane);if(state.initialized)
_runCallbacks("onresize_end",pane);}},slideOpen=function(evt_or_pane){if(!isInitialized())return;var evt=evtObj(evt_or_pane),pane=evtPane.call(this,evt_or_pane),s=state[pane],delay=options[pane].slideDelay_open;if(evt)evt.stopImmediatePropagation();if(s.isClosed&&evt&&evt.type==="mouseenter"&&delay>0)
timer.set(pane+"_openSlider",open_NOW,delay);else
open_NOW();function open_NOW(){if(!s.isClosed)
bindStopSlidingEvents(pane,true);else if(!s.isMoving)
open(pane,true);};},slideClose=function(evt_or_pane){if(!isInitialized())return;var evt=evtObj(evt_or_pane),pane=evtPane.call(this,evt_or_pane),o=options[pane],s=state[pane],delay=s.isMoving?1000:300;if(s.isClosed||s.isResizing)
return;else if(o.slideTrigger_close==="click")
close_NOW();else if(o.preventQuickSlideClose&&s.isMoving)
return;else if(o.preventPrematureSlideClose&&evt&&$.layout.isMouseOverElem(evt,$Ps[pane]))
return;else if(evt)
timer.set(pane+"_closeSlider",close_NOW,max(o.slideDelay_close,delay));else
close_NOW();function close_NOW(){if(s.isClosed)
bindStopSlidingEvents(pane,false);else if(!s.isMoving)
close(pane);};},slideToggle=function(evt_or_pane){var pane=evtPane.call(this,evt_or_pane);toggle(pane,true);},lockPaneForFX=function(pane,doLock){var $P=$Ps[pane],s=state[pane],o=options[pane],z=options.zIndexes;if(doLock){$P.css({zIndex:z.pane_animate});if(pane=="south")
$P.css({top:sC.insetTop+sC.innerHeight-$P.outerHeight()});else if(pane=="east")
$P.css({left:sC.insetLeft+sC.innerWidth-$P.outerWidth()});}
else{$P.css({zIndex:(s.isSliding?z.pane_sliding:z.pane_normal)});if(pane=="south")
$P.css({top:"auto"});else if(pane=="east"&&!$P.css("left").match(/\-99999/))
$P.css({left:"auto"});if(browser.msie&&o.fxOpacityFix&&o.fxName_open!="slide"&&$P.css("filter")&&$P.css("opacity")==1)
$P[0].style.removeAttribute('filter');}},bindStartSlidingEvent=function(pane,enable){var o=options[pane],$P=$Ps[pane],$R=$Rs[pane],evtName=o.slideTrigger_open.toLowerCase();if(!$R||(enable&&!o.slidable))return;if(evtName.match(/mouseover/))
evtName=o.slideTrigger_open="mouseenter";else if(!evtName.match(/click|dblclick|mouseenter/))
evtName=o.slideTrigger_open="click";$R
[enable?"bind":"unbind"](evtName+'.'+sID,slideOpen).css("cursor",enable?o.sliderCursor:"default").attr("title",enable?o.sliderTip:"");},bindStopSlidingEvents=function(pane,enable){var o=options[pane],s=state[pane],c=_c[pane],z=options.zIndexes,evtName=o.slideTrigger_close.toLowerCase(),action=(enable?"bind":"unbind"),$P=$Ps[pane],$R=$Rs[pane];s.isSliding=enable;timer.clear(pane+"_closeSlider");if(enable)bindStartSlidingEvent(pane,false);$P.css("zIndex",enable?z.pane_sliding:z.pane_normal);$R.css("zIndex",enable?z.pane_sliding+2:z.resizer_normal);if(!evtName.match(/click|mouseleave/))
evtName=o.slideTrigger_close="mouseleave";$R[action](evtName,slideClose);if(evtName==="mouseleave"){$P[action]("mouseleave."+sID,slideClose);$R[action]("mouseenter."+sID,cancelMouseOut);$P[action]("mouseenter."+sID,cancelMouseOut);}
if(!enable)
timer.clear(pane+"_closeSlider");else if(evtName==="click"&&!o.resizable){$R.css("cursor",enable?o.sliderCursor:"default");$R.attr("title",enable?o.togglerTip_open:"");}
function cancelMouseOut(evt){timer.clear(pane+"_closeSlider");evt.stopPropagation();}},makePaneFit=function(pane,isOpening,skipCallback,force){var
o=options[pane],s=state[pane],c=_c[pane],$P=$Ps[pane],$R=$Rs[pane],isSidePane=c.dir==="vert",hasRoom=false;if(pane==="center"||(isSidePane&&s.noVerticalRoom)){hasRoom=(s.maxHeight>=0);if(hasRoom&&s.noRoom){_showPane(pane);if($R)$R.show();s.isVisible=true;s.noRoom=false;if(isSidePane)s.noVerticalRoom=false;_fixIframe(pane);}
else if(!hasRoom&&!s.noRoom){_hidePane(pane);if($R)$R.hide();s.isVisible=false;s.noRoom=true;}}
if(pane==="center"){}
else if(s.minSize<=s.maxSize){hasRoom=true;if(s.size>s.maxSize)
sizePane(pane,s.maxSize,skipCallback,force,true);else if(s.size<s.minSize)
sizePane(pane,s.minSize,skipCallback,force,true);else if($R&&s.isVisible&&$P.is(":visible")){var side=c.side.toLowerCase(),pos=s.size+sC["inset"+c.side];if($.layout.cssNum($R,side)!=pos)$R.css(side,pos);}
if(s.noRoom){if(s.wasOpen&&o.closable){if(o.autoReopen)
open(pane,false,true,true);else
s.noRoom=false;}
else
show(pane,s.wasOpen,true,true);}}
else{if(!s.noRoom){s.noRoom=true;s.wasOpen=!s.isClosed&&!s.isSliding;if(s.isClosed){}
else if(o.closable)
close(pane,true,true);else
hide(pane,true);}}},manualSizePane=function(evt_or_pane,size,skipCallback,noAnimation){if(!isInitialized())return;var pane=evtPane.call(this,evt_or_pane),o=options[pane],s=state[pane],forceResize=o.livePaneResizing&&!s.isResizing;o.autoResize=false;sizePane(pane,size,skipCallback,forceResize,noAnimation);},sizePane=function(evt_or_pane,size,skipCallback,force,noAnimation){if(!isInitialized())return;var pane=evtPane.call(this,evt_or_pane),o=options[pane],s=state[pane],$P=$Ps[pane],$R=$Rs[pane],side=_c[pane].side.toLowerCase(),dimName=_c[pane].sizeType.toLowerCase(),inset="inset"+_c[pane].side,skipResizeWhileDragging=s.isResizing&&!o.triggerEventsDuringLiveResize,doFX=noAnimation!==true&&o.animatePaneSizing,oldSize,newSize;$N.queue(function(queueNext){setSizeLimits(pane);oldSize=s.size;size=_parseSize(pane,size);size=max(size,_parseSize(pane,o.minSize));size=min(size,s.maxSize);if(size<s.minSize){queueNext();makePaneFit(pane,false,skipCallback);return;}
if(!force&&size===oldSize)
return queueNext();if(!skipCallback&&state.initialized&&s.isVisible)
_runCallbacks("onresize_start",pane);newSize=cssSize(pane,size);if(doFX&&$P.is(":visible")){var fx=$.layout.effects.size[pane]||$.layout.effects.size.all,easing=o.fxSettings_size.easing||fx.easing,z=options.zIndexes,props={};props[dimName]=newSize+'px';s.isMoving=true;$P.css({zIndex:z.pane_animate}).show().animate(props,o.fxSpeed_size,easing,function(){$P.css({zIndex:(s.isSliding?z.pane_sliding:z.pane_normal)});s.isMoving=false;sizePane_2();queueNext();});}
else{$P.css(dimName,newSize);if($P.is(":visible"))
sizePane_2();else{s.size=size;$.extend(s,elDims($P));}
queueNext();};});function sizePane_2(){var actual=dimName==='width'?$P.outerWidth():$P.outerHeight(),tries=[{pane:pane,count:1,target:size,actual:actual,correct:(size===actual),attempt:size,cssSize:newSize}],lastTry=tries[0],msg='Inaccurate size after resizing the '+pane+'-pane.';while(!lastTry.correct){thisTry={pane:pane,count:lastTry.count+1,target:size};if(lastTry.actual>size)
thisTry.attempt=max(0,lastTry.attempt-(lastTry.actual-size));else
thisTry.attempt=max(0,lastTry.attempt+(size-lastTry.actual));thisTry.cssSize=cssSize(pane,thisTry.attempt);$P.css(dimName,thisTry.cssSize);thisTry.actual=dimName=='width'?$P.outerWidth():$P.outerHeight();thisTry.correct=(size===thisTry.actual);if(options.showDebugMessages){if(tries.length===1){_log(msg,false);_log(lastTry,false);}
_log(thisTry,false);}
if(tries.length>3)break;tries.push(thisTry);lastTry=tries[tries.length-1];}
s.size=size;$.extend(s,elDims($P));if(s.isVisible&&$P.is(":visible")){if($R)$R.css(side,size+sC[inset]);sizeContent(pane);}
if(!skipCallback&&!skipResizeWhileDragging&&state.initialized&&s.isVisible)
_runCallbacks("onresize_end",pane);if(!skipCallback){if(!s.isSliding)sizeMidPanes(_c[pane].dir=="horz"?"":"center",skipResizeWhileDragging,force);sizeHandles();}
var altPane=_c.oppositeEdge[pane];if(size<oldSize&&state[altPane].noRoom){setSizeLimits(altPane);makePaneFit(altPane,false,skipCallback);}
if(options.showDebugMessages&&tries.length>1)
_log(msg+'\nSee the Error Console for details.',true);}},sizeMidPanes=function(panes,skipCallback,force){panes=(panes?panes:"east,west,center").split(",");$.each(panes,function(i,pane){if(!$Ps[pane])return;var
o=options[pane],s=state[pane],$P=$Ps[pane],$R=$Rs[pane],isCenter=(pane=="center"),hasRoom=true,CSS={},newCenter=calcNewCenterPaneDims();$.extend(s,elDims($P));if(pane==="center"){if(!force&&s.isVisible&&newCenter.width===s.outerWidth&&newCenter.height===s.outerHeight)
return true;$.extend(s,cssMinDims(pane),{maxWidth:newCenter.width,maxHeight:newCenter.height});CSS=newCenter;CSS.width=cssW($P,CSS.width);CSS.height=cssH($P,CSS.height);hasRoom=CSS.width>=0&&CSS.height>=0;if(!state.initialized&&o.minWidth>s.outerWidth){var
reqPx=o.minWidth-s.outerWidth,minE=options.east.minSize||0,minW=options.west.minSize||0,sizeE=state.east.size,sizeW=state.west.size,newE=sizeE,newW=sizeW;if(reqPx>0&&state.east.isVisible&&sizeE>minE){newE=max(sizeE-minE,sizeE-reqPx);reqPx-=sizeE-newE;}
if(reqPx>0&&state.west.isVisible&&sizeW>minW){newW=max(sizeW-minW,sizeW-reqPx);reqPx-=sizeW-newW;}
if(reqPx===0){if(sizeE!=minE)
sizePane('east',newE,true,force,true);if(sizeW!=minW)
sizePane('west',newW,true,force,true);sizeMidPanes('center',skipCallback,force);return;}}}
else{if(s.isVisible&&!s.noVerticalRoom)
$.extend(s,elDims($P),cssMinDims(pane))
if(!force&&!s.noVerticalRoom&&newCenter.height===s.outerHeight)
return true;CSS.top=newCenter.top;CSS.bottom=newCenter.bottom;CSS.height=cssH($P,newCenter.height);s.maxHeight=CSS.height;hasRoom=(s.maxHeight>=0);if(!hasRoom)s.noVerticalRoom=true;}
if(hasRoom){if(!skipCallback&&state.initialized)
_runCallbacks("onresize_start",pane);$P.css(CSS);sizeHandles(pane);if(s.noRoom&&!s.isClosed&&!s.isHidden)
makePaneFit(pane);if(s.isVisible){$.extend(s,elDims($P));if(state.initialized)sizeContent(pane);}}
else if(!s.noRoom&&s.isVisible)
makePaneFit(pane);if(!s.isVisible)
return true;if(pane==="center"){var b=$.layout.browser;var fix=b.isIE6||(b.msie&&!$.support.boxModel);if($Ps.north&&(fix||state.north.tagName=="IFRAME"))
$Ps.north.css("width",cssW($Ps.north,sC.innerWidth));if($Ps.south&&(fix||state.south.tagName=="IFRAME"))
$Ps.south.css("width",cssW($Ps.south,sC.innerWidth));}
if(!skipCallback&&state.initialized)
_runCallbacks("onresize_end",pane);});},resizeAll=function(){if(!state.initialized){_initLayoutElements();return;}
var oldW=sC.innerWidth,oldH=sC.innerHeight;if(!$N.is(":visible:"))return;$.extend(state.container,elDims($N));if(!sC.outerHeight)return;if(false===_runCallbacks("onresizeall_start"))return false;var
shrunkH=(sC.innerHeight<oldH),shrunkW=(sC.innerWidth<oldW),$P,o,s,dir;$.each(["south","north","east","west"],function(i,pane){if(!$Ps[pane])return;s=state[pane];o=options[pane];dir=_c[pane].dir;if(o.autoResize&&s.size!=o.size)
sizePane(pane,o.size,true,true,true);else{setSizeLimits(pane);makePaneFit(pane,false,true,true);}});sizeMidPanes("",true,true);sizeHandles();o=options;$.each(_c.allPanes,function(i,pane){$P=$Ps[pane];if(!$P)return;if(state[pane].isVisible)
_runCallbacks("onresize_end",pane);});_runCallbacks("onresizeall_end");},resizeChildLayout=function(evt_or_pane){var pane=evtPane.call(this,evt_or_pane);if(!options[pane].resizeChildLayout)return;var $P=$Ps[pane],$C=$Cs[pane],d="layout",P=Instance[pane],L=children[pane];if(P.child&&!L){var el=P.child.container;L=children[pane]=(el?el.data(d):0)||null;}
if(L&&L.destroyed)
L=children[pane]=null;if(!L)L=children[pane]=$P.data(d)||($C?$C.data(d):0)||null;P.child=children[pane];if(L)L.resizeAll();},sizeContent=function(evt_or_panes,remeasure){if(!isInitialized())return;var panes=evtPane.call(this,evt_or_panes);panes=panes?panes.split(","):_c.allPanes;$.each(panes,function(idx,pane){var
$P=$Ps[pane],$C=$Cs[pane],o=options[pane],s=state[pane],m=s.content;if(!$P||!$C||!$P.is(":visible"))return true;if(!$C.length){initContent(pane,false);if(!$C)return;}
if(false===_runCallbacks("onsizecontent_start",pane))return;if((!s.isMoving&&!s.isResizing)||o.liveContentResizing||remeasure||m.top==undefined){_measure();if(m.hiddenFooters>0&&$P.css("overflow")==="hidden"){$P.css("overflow","visible");_measure();$P.css("overflow","hidden");}}
var newH=s.innerHeight-(m.spaceAbove-s.css.paddingTop)-(m.spaceBelow-s.css.paddingBottom);if(!$C.is(":visible")||m.height!=newH){setOuterHeight($C,newH,true);m.height=newH;};if(state.initialized)
_runCallbacks("onsizecontent_end",pane);function _below($E){return max(s.css.paddingBottom,(parseInt($E.css("marginBottom"),10)||0));};function _measure(){var
ignore=options[pane].contentIgnoreSelector,$Fs=$C.nextAll().not(ignore||':lt(0)'),$Fs_vis=$Fs.filter(':visible'),$F=$Fs_vis.filter(':last');m={top:$C[0].offsetTop,height:$C.outerHeight(),numFooters:$Fs.length,hiddenFooters:$Fs.length-$Fs_vis.length,spaceBelow:0}
m.spaceAbove=m.top;m.bottom=m.top+m.height;if($F.length)
m.spaceBelow=($F[0].offsetTop+$F.outerHeight())-m.bottom+_below($F);else
m.spaceBelow=_below($C);};});},sizeHandles=function(evt_or_panes){var panes=evtPane.call(this,evt_or_panes)
panes=panes?panes.split(","):_c.borderPanes;$.each(panes,function(i,pane){var
o=options[pane],s=state[pane],$P=$Ps[pane],$R=$Rs[pane],$T=$Ts[pane],$TC;if(!$P||!$R)return;var
dir=_c[pane].dir,_state=(s.isClosed?"_closed":"_open"),spacing=o["spacing"+_state],togAlign=o["togglerAlign"+_state],togLen=o["togglerLength"+_state],paneLen,left,offset,CSS={};if(spacing===0){$R.hide();return;}
else if(!s.noRoom&&!s.isHidden)
$R.show();if(dir==="horz"){paneLen=sC.innerWidth;s.resizerLength=paneLen;left=$.layout.cssNum($P,"left")
$R.css({width:cssW($R,paneLen),height:cssH($R,spacing),left:left>-9999?left:sC.insetLeft});}
else{paneLen=$P.outerHeight();s.resizerLength=paneLen;$R.css({height:cssH($R,paneLen),width:cssW($R,spacing),top:sC.insetTop+getPaneSize("north",true)});}
removeHover(o,$R);if($T){if(togLen===0||(s.isSliding&&o.hideTogglerOnSlide)){$T.hide();return;}
else
$T.show();if(!(togLen>0)||togLen==="100%"||togLen>paneLen){togLen=paneLen;offset=0;}
else{if(isStr(togAlign)){switch(togAlign){case"top":case"left":offset=0;break;case"bottom":case"right":offset=paneLen-togLen;break;case"middle":case"center":default:offset=round((paneLen-togLen)/2);}}
else{var x=parseInt(togAlign,10);if(togAlign>=0)offset=x;else offset=paneLen-togLen+x;}}
if(dir==="horz"){var width=cssW($T,togLen);$T.css({width:width,height:cssH($T,spacing),left:offset,top:0});$T.children(".content").each(function(){$TC=$(this);$TC.css("marginLeft",round((width-$TC.outerWidth())/2));});}
else{var height=cssH($T,togLen);$T.css({height:height,width:cssW($T,spacing),top:offset,left:0});$T.children(".content").each(function(){$TC=$(this);$TC.css("marginTop",round((height-$TC.outerHeight())/2));});}
removeHover(0,$T);}
if(!state.initialized&&(o.initHidden||s.noRoom)){$R.hide();if($T)$T.hide();}});},enableClosable=function(evt_or_pane){if(!isInitialized())return;var pane=evtPane.call(this,evt_or_pane),$T=$Ts[pane],o=options[pane];if(!$T)return;o.closable=true;$T.bind("click."+sID,function(evt){evt.stopPropagation();toggle(pane);}).css("visibility","visible").css("cursor","pointer").attr("title",state[pane].isClosed?o.togglerTip_closed:o.togglerTip_open).show();},disableClosable=function(evt_or_pane,hide){if(!isInitialized())return;var pane=evtPane.call(this,evt_or_pane),$T=$Ts[pane];if(!$T)return;options[pane].closable=false;if(state[pane].isClosed)open(pane,false,true);$T.unbind("."+sID).css("visibility",hide?"hidden":"visible").css("cursor","default").attr("title","");},enableSlidable=function(evt_or_pane){if(!isInitialized())return;var pane=evtPane.call(this,evt_or_pane),$R=$Rs[pane];if(!$R||!$R.data('draggable'))return;options[pane].slidable=true;if(s.isClosed)
bindStartSlidingEvent(pane,true);},disableSlidable=function(evt_or_pane){if(!isInitialized())return;var pane=evtPane.call(this,evt_or_pane),$R=$Rs[pane];if(!$R)return;options[pane].slidable=false;if(state[pane].isSliding)
close(pane,false,true);else{bindStartSlidingEvent(pane,false);$R.css("cursor","default").attr("title","");removeHover(null,$R[0]);}},enableResizable=function(evt_or_pane){if(!isInitialized())return;var pane=evtPane.call(this,evt_or_pane),$R=$Rs[pane],o=options[pane];if(!$R||!$R.data('draggable'))return;o.resizable=true;$R.draggable("enable");if(!state[pane].isClosed)
$R.css("cursor",o.resizerCursor).attr("title",o.resizerTip);},disableResizable=function(evt_or_pane){if(!isInitialized())return;var pane=evtPane.call(this,evt_or_pane),$R=$Rs[pane];if(!$R||!$R.data('draggable'))return;options[pane].resizable=false;$R.draggable("disable").css("cursor","default").attr("title","");removeHover(null,$R[0]);},swapPanes=function(evt_or_pane1,pane2){if(!isInitialized())return;var pane1=evtPane.call(this,evt_or_pane1);state[pane1].edge=pane2;state[pane2].edge=pane1;if(false===_runCallbacks("onswap_start",pane1)||false===_runCallbacks("onswap_start",pane2)){state[pane1].edge=pane1;state[pane2].edge=pane2;return;}
var
oPane1=copy(pane1),oPane2=copy(pane2),sizes={};sizes[pane1]=oPane1?oPane1.state.size:0;sizes[pane2]=oPane2?oPane2.state.size:0;$Ps[pane1]=false;$Ps[pane2]=false;state[pane1]={};state[pane2]={};if($Ts[pane1])$Ts[pane1].remove();if($Ts[pane2])$Ts[pane2].remove();if($Rs[pane1])$Rs[pane1].remove();if($Rs[pane2])$Rs[pane2].remove();$Rs[pane1]=$Rs[pane2]=$Ts[pane1]=$Ts[pane2]=false;move(oPane1,pane2);move(oPane2,pane1);oPane1=oPane2=sizes=null;if($Ps[pane1])$Ps[pane1].css(_c.visible);if($Ps[pane2])$Ps[pane2].css(_c.visible);resizeAll();_runCallbacks("onswap_end",pane1);_runCallbacks("onswap_end",pane2);return;function copy(n){var
$P=$Ps[n],$C=$Cs[n];return!$P?false:{pane:n,P:$P?$P[0]:false,C:$C?$C[0]:false,state:$.extend(true,{},state[n]),options:$.extend(true,{},options[n])}};function move(oPane,pane){if(!oPane)return;var
P=oPane.P,C=oPane.C,oldPane=oPane.pane,c=_c[pane],side=c.side.toLowerCase(),inset="inset"+c.side,s=$.extend({},state[pane]),o=options[pane],fx={resizerCursor:o.resizerCursor},re,size,pos;$.each("fxName,fxSpeed,fxSettings".split(","),function(i,k){fx[k+"_open"]=o[k+"_open"];fx[k+"_close"]=o[k+"_close"];fx[k+"_size"]=o[k+"_size"];});$Ps[pane]=$(P).data({layoutPane:Instance[pane],layoutEdge:pane}).css(_c.hidden).css(c.cssReq);$Cs[pane]=C?$(C):false;options[pane]=$.extend({},oPane.options,fx);state[pane]=$.extend({},oPane.state);re=new RegExp(o.paneClass+"-"+oldPane,"g");P.className=P.className.replace(re,o.paneClass+"-"+pane);initHandles(pane);if(c.dir!=_c[oldPane].dir){size=sizes[pane]||0;setSizeLimits(pane);size=max(size,state[pane].minSize);manualSizePane(pane,size,true,true);}
else
$Rs[pane].css(side,sC[inset]+(state[pane].isVisible?getPaneSize(pane):0));if(oPane.state.isVisible&&!s.isVisible)
setAsOpen(pane,true);else{setAsClosed(pane);bindStartSlidingEvent(pane,true);}
oPane=null;};},syncPinBtns=function(pane,doPin){if($.layout.plugins.buttons)
$.each(state[pane].pins,function(i,selector){$.layout.buttons.setPinState(Instance,$(selector),pane,doPin);});};function keyDown(evt){if(!evt)return true;var code=evt.keyCode;if(code<33)return true;var
PANE={38:"north",40:"south",37:"west",39:"east"},ALT=evt.altKey,SHIFT=evt.shiftKey,CTRL=evt.ctrlKey,CURSOR=(CTRL&&code>=37&&code<=40),o,k,m,pane;if(CURSOR&&options[PANE[code]].enableCursorHotkey)
pane=PANE[code];else if(CTRL||SHIFT)
$.each(_c.borderPanes,function(i,p){o=options[p];k=o.customHotkey;m=o.customHotkeyModifier;if((SHIFT&&m=="SHIFT")||(CTRL&&m=="CTRL")||(CTRL&&SHIFT)){if(k&&code===(isNaN(k)||k<=9?k.toUpperCase().charCodeAt(0):k)){pane=p;return false;}}});if(!pane||!$Ps[pane]||!options[pane].closable||state[pane].isHidden)
return true;toggle(pane);evt.stopPropagation();evt.returnValue=false;return false;};function allowOverflow(el){if(!isInitialized())return;if(this&&this.tagName)el=this;var $P;if(isStr(el))
$P=$Ps[el];else if($(el).data("layoutRole"))
$P=$(el);else
$(el).parents().each(function(){if($(this).data("layoutRole")){$P=$(this);return false;}});if(!$P||!$P.length)return;var
pane=$P.data("layoutEdge"),s=state[pane];if(s.cssSaved)
resetOverflow(pane);if(s.isSliding||s.isResizing||s.isClosed){s.cssSaved=false;return;}
var
newCSS={zIndex:(options.zIndexes.resizer_normal+1)},curCSS={},of=$P.css("overflow"),ofX=$P.css("overflowX"),ofY=$P.css("overflowY");if(of!="visible"){curCSS.overflow=of;newCSS.overflow="visible";}
if(ofX&&!ofX.match(/visible|auto/)){curCSS.overflowX=ofX;newCSS.overflowX="visible";}
if(ofY&&!ofY.match(/visible|auto/)){curCSS.overflowY=ofX;newCSS.overflowY="visible";}
s.cssSaved=curCSS;$P.css(newCSS);$.each(_c.allPanes,function(i,p){if(p!=pane)resetOverflow(p);});};function resetOverflow(el){if(!isInitialized())return;if(this&&this.tagName)el=this;var $P;if(isStr(el))
$P=$Ps[el];else if($(el).data("layoutRole"))
$P=$(el);else
$(el).parents().each(function(){if($(this).data("layoutRole")){$P=$(this);return false;}});if(!$P||!$P.length)return;var
pane=$P.data("layoutEdge"),s=state[pane],CSS=s.cssSaved||{};if(!s.isSliding&&!s.isResizing)
$P.css("zIndex",options.zIndexes.pane_normal);$P.css(CSS);s.cssSaved=false;};var $N=$(this).eq(0);if(!$N.length){if(options.showErrorMessages)
_log(lang.errContainerMissing,true);return null;};if($N.data("layoutContainer")&&$N.data("layout"))
return $N.data("layout");var
$Ps={},$Cs={},$Rs={},$Ts={},$Ms=$([]),sC=state.container,sID=state.id;var Instance={options:options,state:state,container:$N,panes:$Ps,contents:$Cs,resizers:$Rs,togglers:$Ts,hide:hide,show:show,toggle:toggle,open:open,close:close,slideOpen:slideOpen,slideClose:slideClose,slideToggle:slideToggle,setSizeLimits:setSizeLimits,_sizePane:sizePane,sizePane:manualSizePane,sizeContent:sizeContent,swapPanes:swapPanes,initContent:initContent,addPane:addPane,removePane:removePane,createChildLayout:createChildLayout,enableClosable:enableClosable,disableClosable:disableClosable,enableSlidable:enableSlidable,disableSlidable:disableSlidable,enableResizable:enableResizable,disableResizable:disableResizable,allowOverflow:allowOverflow,resetOverflow:resetOverflow,destroy:destroy,initPanes:isInitialized,resizeAll:resizeAll,runCallbacks:_runCallbacks,hasParentLayout:false,children:children,north:false,south:false,west:false,east:false,center:false};if(_create()==='cancel')
return null;else
return Instance;}
if(!$.ui)$.ui={};$.ui.cookie={acceptsCookies:!!navigator.cookieEnabled,read:function(name){var
c=document.cookie,cs=c?c.split(';'):[],pair;for(var i=0,n=cs.length;i<n;i++){pair=$.trim(cs[i]).split('=');if(pair[0]==name)
return decodeURIComponent(pair[1]);}
return null;},write:function(name,val,cookieOpts){var
params='',date='',clear=false,o=cookieOpts||{},x=o.expires;if(x&&x.toUTCString)
date=x;else if(x===null||typeof x==='number'){date=new Date();if(x>0)
date.setDate(date.getDate()+x);else{date.setFullYear(1970);clear=true;}}
if(date)params+=';expires='+date.toUTCString();if(o.path)params+=';path='+o.path;if(o.domain)params+=';domain='+o.domain;if(o.secure)params+=';secure';document.cookie=name+'='+(clear?"":encodeURIComponent(val))+params;},clear:function(name){$.ui.cookie.write(name,'',{expires:-1});}};if(!$.cookie)$.cookie=function(k,v,o){var C=$.ui.cookie;if(v===null)
C.clear(k);else if(v===undefined)
return C.read(k);else
C.write(k,v,o);};$.layout.plugins.stateManagement=true;$.layout.config.optionRootKeys.push("stateManagement");$.layout.defaults.stateManagement={enabled:false,autoSave:true,autoLoad:true,stateKeys:"north.size,south.size,east.size,west.size,"+"north.isClosed,south.isClosed,east.isClosed,west.isClosed,"+"north.isHidden,south.isHidden,east.isHidden,west.isHidden",cookie:{name:"",domain:"",path:"",expires:"",secure:false}};$.layout.optionsMap.layout.push("stateManagement");$.layout.state={saveCookie:function(inst,keys,cookieOpts){var o=inst.options,oS=o.stateManagement,oC=$.extend(true,{},oS.cookie,cookieOpts||null),data=inst.state.stateData=inst.readState(keys||oS.stateKeys);$.ui.cookie.write(oC.name||o.name||"Layout",$.layout.state.encodeJSON(data),oC);return $.extend(true,{},data);},deleteCookie:function(inst){var o=inst.options;$.ui.cookie.clear(o.stateManagement.cookie.name||o.name||"Layout");},readCookie:function(inst){var o=inst.options;var c=$.ui.cookie.read(o.stateManagement.cookie.name||o.name||"Layout");return c?$.layout.state.decodeJSON(c):{};},loadCookie:function(inst){var c=$.layout.state.readCookie(inst);if(c){inst.state.stateData=$.extend(true,{},c);inst.loadState(c);}
return c;},loadState:function(inst,stateData,animate){stateData=$.layout.transformData(stateData);if($.isEmptyObject(stateData))return;$.extend(true,inst.options,stateData);if(inst.state.initialized){var pane,vis,o,s,h,c,noAnimate=(animate===false);$.each($.layout.config.borderPanes,function(idx,pane){state=inst.state[pane];o=stateData[pane];if(typeof o!='object')return;s=o.size;c=o.initClosed;h=o.initHidden;vis=state.isVisible;if(!vis)
inst.sizePane(pane,s,false,false);if(h===true)inst.hide(pane,noAnimate);else if(c===false)inst.open(pane,false,noAnimate);else if(c===true)inst.close(pane,false,noAnimate);else if(h===false)inst.show(pane,false,noAnimate);if(vis)
inst.sizePane(pane,s,false,noAnimate);});};},readState:function(inst,keys){var
data={},alt={isClosed:'initClosed',isHidden:'initHidden'},state=inst.state,panes=$.layout.config.allPanes,pair,pane,key,val;if(!keys)keys=inst.options.stateManagement.stateKeys;if($.isArray(keys))keys=keys.join(",");keys=keys.replace(/__/g,".").split(',');for(var i=0,n=keys.length;i<n;i++){pair=keys[i].split(".");pane=pair[0];key=pair[1];if($.inArray(pane,panes)<0)continue;val=state[pane][key];if(val==undefined)continue;if(key=="isClosed"&&state[pane]["isSliding"])
val=true;(data[pane]||(data[pane]={}))[alt[key]?alt[key]:key]=val;}
return data;},encodeJSON:function(JSON){return parse(JSON);function parse(h){var D=[],i=0,k,v,t;for(k in h){v=h[k];t=typeof v;if(t=='string')
v='"'+v+'"';else if(t=='object')
v=parse(v);D[i++]='"'+k+'":'+v;}
return'{'+D.join(',')+'}';};},decodeJSON:function(str){try{return $.parseJSON?$.parseJSON(str):window["eval"]("("+str+")")||{};}
catch(e){return{};}},_create:function(inst){var _=$.layout.state;$.extend(inst,{readCookie:function(){return _.readCookie(inst);},deleteCookie:function(){_.deleteCookie(inst);},saveCookie:function(keys,cookieOpts){return _.saveCookie(inst,keys,cookieOpts);},loadCookie:function(){return _.loadCookie(inst);},loadState:function(stateData,animate){_.loadState(inst,stateData,animate);},readState:function(keys){return _.readState(inst,keys);},encodeJSON:_.encodeJSON,decodeJSON:_.decodeJSON});inst.state.stateData={};var oS=inst.options.stateManagement;if(oS.enabled){if(oS.autoLoad)
inst.loadCookie();else
inst.state.stateData=inst.readCookie();}},_unload:function(inst){var oS=inst.options.stateManagement;if(oS.enabled){if(oS.autoSave)
inst.saveCookie();else
inst.state.stateData=inst.readState();}}};$.layout.onCreate.push($.layout.state._create);$.layout.onUnload.push($.layout.state._unload);$.layout.plugins.buttons=true;$.layout.defaults.autoBindCustomButtons=false;$.layout.optionsMap.layout.push("autoBindCustomButtons");var lang=$.layout.language;$.layout.buttons={init:function(inst){var pre="ui-layout-button-",layout=inst.options.name||"",name;$.each("toggle,open,close,pin,toggle-slide,open-slide".split(","),function(i,action){$.each($.layout.config.borderPanes,function(ii,pane){$("."+pre+action+"-"+pane).each(function(){name=$(this).data("layoutName")||$(this).attr("layoutName");if(name==undefined||name===layout)
inst.bindButton(this,action,pane);});});});},get:function(inst,selector,pane,action){var $E=$(selector),o=inst.options,err=o.showErrorMessages;if(!$E.length){if(err)$.layout.msg(lang.errButton+lang.selector+": "+selector,true);}
else if($.inArray(pane,$.layout.config.borderPanes)<0){if(err)$.layout.msg(lang.errButton+lang.pane+": "+pane,true);$E=$("");}
else{var btn=o[pane].buttonClass+"-"+action;$E.addClass(btn+" "+btn+"-"+pane).data("layoutName",o.name);}
return $E;},bind:function(inst,selector,action,pane){var _=$.layout.buttons;switch(action.toLowerCase()){case"toggle":_.addToggle(inst,selector,pane);break;case"open":_.addOpen(inst,selector,pane);break;case"close":_.addClose(inst,selector,pane);break;case"pin":_.addPin(inst,selector,pane);break;case"toggle-slide":_.addToggle(inst,selector,pane,true);break;case"open-slide":_.addOpen(inst,selector,pane,true);break;}
return inst;},addToggle:function(inst,selector,pane,slide){$.layout.buttons.get(inst,selector,pane,"toggle").click(function(evt){inst.toggle(pane,!!slide);evt.stopPropagation();});return inst;},addOpen:function(inst,selector,pane,slide){$.layout.buttons.get(inst,selector,pane,"open").attr("title",lang.Open).click(function(evt){inst.open(pane,!!slide);evt.stopPropagation();});return inst;},addClose:function(inst,selector,pane){$.layout.buttons.get(inst,selector,pane,"close").attr("title",lang.Close).click(function(evt){inst.close(pane);evt.stopPropagation();});return inst;},addPin:function(inst,selector,pane){var _=$.layout.buttons,$E=_.get(inst,selector,pane,"pin");if($E.length){var s=inst.state[pane];$E.click(function(evt){_.setPinState(inst,$(this),pane,(s.isSliding||s.isClosed));if(s.isSliding||s.isClosed)inst.open(pane);else inst.close(pane);evt.stopPropagation();});_.setPinState(inst,$E,pane,(!s.isClosed&&!s.isSliding));s.pins.push(selector);}
return inst;},setPinState:function(inst,$Pin,pane,doPin){var updown=$Pin.attr("pin");if(updown&&doPin===(updown=="down"))return;var
pin=inst.options[pane].buttonClass+"-pin",side=pin+"-"+pane,UP=pin+"-up "+side+"-up",DN=pin+"-down "+side+"-down";$Pin.attr("pin",doPin?"down":"up").attr("title",doPin?lang.Unpin:lang.Pin).removeClass(doPin?UP:DN).addClass(doPin?DN:UP);},syncPinBtns:function(inst,pane,doPin){$.each(state[pane].pins,function(i,selector){$.layout.buttons.setPinState(inst,$(selector),pane,doPin);});},_load:function(inst){var _=$.layout.buttons;$.extend(inst,{bindButton:function(sel,action,pane){return _.bind(inst,sel,action,pane);},addToggleBtn:function(sel,pane,slide){return _.addToggle(inst,sel,pane,slide);},addOpenBtn:function(sel,pane,slide){return _.addOpen(inst,sel,pane,slide);},addCloseBtn:function(sel,pane){return _.addClose(inst,sel,pane);},addPinBtn:function(sel,pane){return _.addPin(inst,sel,pane);}});for(var i=0;i<4;i++){var pane=$.layout.config.borderPanes[i];inst.state[pane].pins=[];}
if(inst.options.autoBindCustomButtons)
_.init(inst);},_unload:function(inst){}};$.layout.onLoad.push($.layout.buttons._load);$.layout.plugins.browserZoom=true;$.layout.defaults.browserZoomCheckInterval=1000;$.layout.optionsMap.layout.push("browserZoomCheckInterval");$.layout.browserZoom={_init:function(inst){if($.layout.browserZoom.ratio()!==false)
$.layout.browserZoom._setTimer(inst);},_setTimer:function(inst){if(inst.destroyed)return;var o=inst.options,s=inst.state,ms=inst.hasParentLayout?5000:Math.max(o.browserZoomCheckInterval,100);setTimeout(function(){if(inst.destroyed||!o.resizeWithWindow)return;var d=$.layout.browserZoom.ratio();if(d!==s.browserZoom){s.browserZoom=d;inst.resizeAll();}
$.layout.browserZoom._setTimer(inst);},ms);},ratio:function(){var w=window,s=screen,d=document,dE=d.documentElement||d.body,b=$.layout.browser,v=b.version,r,sW,cW;if((b.msie&&v>8)||!b.msie)return false;if(s.deviceXDPI)
return calc(s.deviceXDPI,s.systemXDPI);if(b.webkit&&(r=d.body.getBoundingClientRect))
return calc((r.left-r.right),d.body.offsetWidth);if(b.webkit&&(sW=w.outerWidth))
return calc(sW,w.innerWidth);if((sW=s.width)&&(cW=dE.clientWidth))
return calc(sW,cW);return false;function calc(x,y){return(parseInt(x,10)/parseInt(y,10)*100).toFixed();}}};$.layout.onReady.push($.layout.browserZoom._init);})(jQuery);});;define('RepositoryBrowser',['Class','jquery','PubSub','repository-browser-i18n-'+((window&&window.__DEPS__&&window.__DEPS__.lang)||'en'),'jstree','jqgrid','jquery-layout'],function(Class,jQuery,PubSub,i18n){var browserInstances=[];var numOpenedBrowsers=0;var uid=(new Date()).getTime();var DEFAULTS={repositoryManager:null,repositoryFilter:[],objectTypeFilter:[],renditionFilter:['cmis:none'],filter:['url'],element:null,isFloating:false,verticalPadding:100,horizontalPadding:50,maxHeight:1000,minHeight:400,minWidth:400,maxWidth:1200,treeWidth:300,listWidth:'auto',pageSize:8,adaptPageSize:false,rowHeight:32,rootPath:'',rootFolderId:'aloha',columns:{icon:{title:'',width:30,sortable:false,resizable:false},name:{title:'Name',width:200,sorttype:'text'},url:{title:'URL',width:220,sorttype:'text'},preview:{title:'Preview',width:150,sorttype:'text'}},i18n:{'Browsing':'Browsing','Close':'Close','in':'in','Input search text...':'Input search text...','numerous':'numerous','of':'of','Repository Browser':'Repository Browser','Search':'Search','Searching for':'Searching for','Viewing':'Viewing'}};function disableSelection($element){$element.each(function(){jQuery(this).attr('unselectable','on').css({'-moz-user-select':'none','-webkit-user-select':'none','user-select':'none'}).each(function(){this.onselectstart=function(){return false;};});});}
var RepositoryBrowser=Class.extend({_cachedRepositoryObjects:{},_searchQuery:null,_orderBy:null,_prefilledValue:null,$_grid:null,$_tree:null,$_list:null,_isOpened:true,_constructor:function(){this.init.apply(this,arguments);},init:function(options){options=jQuery.extend({},DEFAULTS,options,{i18n:i18n});if(!options.element||0===options.element.length){options.isFloating=true;options.element=this._createOverlay();}
if(options.maxWidth<options.minWidth){options.maxWidth=options.minWidth;}
jQuery.extend(this,options);this._prefilledValue=this._i18n('Input search text...');this._cachedRepositoryObjects={};this._searchQuery=null;this._orderBy=null;this._pagingCount=null;this._pagingOffset=0;this._pagingBtns={first:null,end:null,next:null,prev:null};this._initializeUI();browserInstances.push(this);PubSub.pub('repository-browser.initialized',{data:this});},_i18n:function(key){return this.i18n[key]||key;},_initializeUI:function(){this.element.attr('data-repository-browser',++uid);this.element.width(this.maxWidth);this.$_grid=this._createGrid(this.element).resize();this._setInitialHeight();this.$_tree=this._createTree(this.$_grid.find('.ui-layout-west'));this.$_list=this._createList(this.$_grid.find('.ui-layout-center'));var that=this;var give=this.treeWidth/5;this.$_grid.layout({enableCursorHotkey:false,west__size:this.treeWidth-1,west__minSize:this.treeWidth-give,west__maxSize:this.treeWidth+give,center__size:'auto',paneClass:'ui-layout-pane',resizerClass:'ui-layout-resizer',togglerClass:'ui-layout-toggler',onresize:function(name,$element){if('center'===name){that.$_list.setGridWidth($element.width());}}}).sizePane('west',this.treeWidth);disableSelection(this.$_grid);this._preloadImages();jQuery(function(){jQuery(window).resize(function(){that._onWindowResized();});});this.element.mousedown(function(){jQuery.each(browserInstances,function(index){this.element.css('z-index',99999+index);});jQuery(this).css('z-index',99999+browserInstances.length+1);});jQuery('.repository-browser-grid').css('width',this.maxWidth);this.close();this._adaptPageSize();},_setInitialHeight:function(){var overflow=this.maxHeight-jQuery(window).height()+this.verticalPadding;var targetHeight=overflow>0?Math.max(this.minHeight,this.maxHeight-overflow):this.maxHeight;this.$_grid.height(targetHeight);},_onWindowResized:function(){var overflow=this.maxWidth-jQuery(window).width()+this.horizontalPadding,$header,$container;var target=overflow>0?Math.max(this.minWidth,this.maxWidth-overflow):this.maxWidth;this.element.width(target);this.$_grid.width(target);this._setInitialHeight();$header=this.$_grid.find('.repository-browser-tree-header');this.$_tree.height(this.$_grid.height()-$header.outerHeight(true));$container=this.$_grid.find('.ui-layout-center');$container.find('.ui-jqgrid-bdiv').height(this.$_grid.height()-($container.find('.ui-jqgrid-titlebar').height()+
$container.find('.ui-jqgrid-hdiv').height()+
$container.find('.ui-jqgrid-pager').height()));if(this._adaptPageSize()){if(this._currentFolder){this._fetchItems(this._currentFolder);}}},_preloadImages:function(){var path=this.rootPath+'img/';var imgs=['arrow-000-medium.png','arrow-180.png','arrow-315-medium.png','arrow-stop-180.png','arrow-stop.png','arrow.png','control-stop-square-small.png','folder-horizontal-open.png','folder-open.png','magnifier-left.png','page.png','picture.png','sort-alphabet-descending.png','sort-alphabet.png'];var j=imgs.length;while(j){var img=document.createElement('img');img.src=path+imgs[--j];}},_processRepoResponse:function(items,metainfo,callback){var data=[];var i;if(typeof metainfo==='function'){callback=metainfo;metainfo=undefined;}
for(i=0;i<items.length;i++){data.push(this._harvestRepoObject(items[i]));}
callback(data,metainfo);},_harvestRepoObject:function(repositoryObject){++uid;this._cachedRepositoryObjects[uid]=jQuery.extend(repositoryObject,{uid:uid,loaded:false});return this._processRepoObject(this._cachedRepositoryObjects[uid]);},_processRepoObject:function(obj){var icon,state,children,that=this,liAttr;switch(obj.baseType){case'folder':icon='folder';break;case'document':icon='document';break;}
state=(obj.hasMoreItems||obj.baseType==='folder')?'closed':null;if(obj.hasMoreItems===false){state=null;}
if(obj.children){children=[];jQuery.each(obj.children,function(){children.push(that._harvestRepoObject(this));state='open';});}
if(this._currentFolder&&this._currentFolder.id===obj.id){window.setTimeout(function(){that.$_tree.jstree("select_node","li[data-repo-obj='"+obj.uid+"']");},0);}
liAttr={rel:obj.type,'data-repo-obj':obj.uid};return{data:{title:obj.name,attr:{'data-repo-obj':obj.uid},icon:icon||''},attr:liAttr,state:state,resource:obj,children:children};},_fetchRepoRoot:function(callback){if(!this._currentFolder){this._currentFolder=this.getSelectedFolder();}
if(this.repositoryManager){this.getRepoChildren({inFolderId:this.rootFolderId,repositoryFilter:this.repositoryFilter},callback);}},_getObjectFromCache:function($node){if($node&&$node.length){var id=$node.find('a:first').attr('data-repo-obj');return this._cachedRepositoryObjects[id];}
return null;},_onTreeNodeSelected:function($event,data){if(data.args[0].context){return;}
var folder=this._getObjectFromCache(data.rslt.obj);if(folder){this._pagingOffset=0;this._clearSearch();this._currentFolder=folder;this._fetchItems(folder);}
this.folderSelected(folder);},_createTree:function($container){var $tree=jQuery('<div class="repository-browser-tree">');var $header=jQuery('<div class="repository-browser-tree-header'+' repository-browser-grab-handle">'+
this._i18n('Repository Browser')+'</div>');$container.append($header,$tree);$tree.height(this.$_grid.height()-$header.outerHeight(true));$tree.bind('loaded.jstree',function($event,data){jQuery(this).find('>ul>li:first').css('padding-top',5);$tree.jstree('open_node','li[rel="repository"]');});var that=this;$tree.bind('select_node.jstree',function($event,data){that._onTreeNodeSelected($event,data);});$tree.bind('open_node.jstree',function($event,data){that.folderOpened(data.rslt.obj);});$tree.bind('close_node.jstree',function($event,data){that.folderClosed(data.rslt.obj);});$tree.jstree({types:this.types,rootFolderId:this.rootFolderId,plugins:['themes','json_data','ui','types'],core:{animation:250},themes:{url:this.rootPath+'css/jstree.css',dots:true,icons:true,theme:'browser'},json_data:{data:function(nodes,callback){if(that.repositoryManager){that.jstree_callback=callback;that._fetchSubnodes(nodes,callback);}else{callback();}},correct_state:true},ui:{select_limit:1}});return $tree;},_createGrid:function($container){var $grid=jQuery('<div class="repository-browser-grid\
                 repository-browser-shadow\
        repository-browser-rounded-top">\
     <div class="ui-layout-west"></div>\
     <div class="ui-layout-center"></div>\
    </div>');$container.append($grid);return $grid;},_createList:function($container){var $list=jQuery('<table id="repository-browser-list-'+(++uid)
+'" class="repository-browser-list"></table>');var model=[{name:'id',sorttype:'int',firstsortorder:'asc',hidden:true}];var names=[''];jQuery.each(this.columns,function(key,value){names.push(value.title||'&nbsp;');model.push({name:key,width:value.width,sortable:value.sortable,sorttype:value.sorttype,resizable:value.resizable,fixed:value.fixed});});var pagerUID='repository-browser-list-page-'+(++uid);$container.append($list,jQuery('<div id="'+pagerUID+'">'));$list.jqGrid({datatype:'local',width:$container.width(),shrinkToFit:true,colNames:names,colModel:model,caption:'&nbsp;',altRows:true,altclass:'repository-browser-list-altrow',resizeclass:'repository-browser-list-resizable',pager:'#'+pagerUID,viewrecords:true,onPaging:function(button){},loadError:function(xhr,status,error){},ondblClickRow:function(rowid,iRow,iCol,e){},gridComplete:function(){},loadComplete:function(data){}});$container.find('.ui-jqgrid-bdiv').height(this.$_grid.height()-($container.find('.ui-jqgrid-titlebar').height()+
$container.find('.ui-jqgrid-hdiv').height()+
$container.find('.ui-jqgrid-pager').height()));var that=this;$list.click(function(){that.rowClicked.apply(that,arguments);});$container.find('.ui-pg-button').unbind().find('>span.ui-icon').each(function(){var dir=this.className.match(/ui\-icon\-seek\-([a-z]+)/)[1];that._pagingBtns[dir]=jQuery(this).parent().addClass('ui-state-disabled').click(function(){if(!jQuery(this).hasClass('ui-state-disabled')){that._doPaging(dir);}});});$container.find('.ui-pg-input').parent().hide();$container.find('.ui-separator').parent().css('opacity',0).first().hide();this._createTitlebar($container);var listProps=$list[0].p;$container.find('.ui-jqgrid-view tr:first th div').each(function(i){if(false!==listProps.colModel[i].sortable){jQuery(this).css('cursor','pointer');jQuery(this).unbind().click(function(event){event.stopPropagation();that._sortList(listProps.colModel[i],this);});}});return $list;},_clearSearch:function(){var $searchField=this.$_grid.find('.repository-browser-search-field');$searchField.val(this._prefilledValue).addClass('repository-browser-search-field-empty');this._searchQuery=null;},_createTitlebar:function($container){var $bar=$container.find('.ui-jqgrid-titlebar');var $btns=jQuery('<div class="repository-browser-btns">\
     <input type="text" class="repository-browser-search-field" />\
     <span class="repository-browser-btn repository-browser-search-btn">\
      <span class="repository-browser-search-icon"></span>\
     </span>\
     <span class="repository-browser-btn repository-browser-close-btn">'+
this._i18n('Close')+'</span>\
     <div class="repository-browser-clear"></div>\
    </div>');var that=this;$bar.addClass('repository-browser-grab-handle').append($btns);$bar.find('.repository-browser-search-btn').html(this._i18n('Search')).click(function(){that._triggerSearch();});var $searchField=$bar.find('.repository-browser-search-field');this._clearSearch();$searchField.keypress(function(event){if(13===event.keyCode){that._triggerSearch();}});$searchField.focus(function(){if(jQuery(this).val()===that._prefilledValue){jQuery(this).val('').removeClass('repository-browser-search-field-empty');}});$searchField.blur(function(){if(jQuery(this).val()===''){that._clearSearch();}});$bar.find('.repository-browser-close-btn').click(function(){that.close();});$bar.find('.repository-browser-btn').mousedown(function(){jQuery(this).addClass('repository-browser-pressed');}).mouseup(function(){jQuery(this).removeClass('repository-browser-pressed');});},_triggerSearch:function(){var $searchField=this.$_grid.find('input.repository-browser-search-field');var searchValue=$searchField.val();if(jQuery($searchField).hasClass('aloha-browser-search-field-empty')||''===searchValue){searchValue=null;}
this._pagingOffset=0;this._searchQuery=searchValue;this._fetchItems(this._currentFolder);},_sortList:function(columnModel,element){this.$_grid.find('span.ui-grid-ico-sort').addClass('ui-state-disabled');columnModel.sortorder=('asc'===columnModel.sortorder)?'desc':'asc';jQuery(element).find('span.s-ico').show().find('.ui-icon-'+columnModel.sortorder).removeClass('ui-state-disabled');this._setSortOrder(columnModel.name,columnModel.sortorder);this._fetchItems(this._currentFolder);},_doPaging:function(dir){switch(dir){case'first':this._pagingOffset=0;break;case'end':if((this._pagingCount%this.pageSize)===0){this._pagingOffset=this._pagingCount-this.pageSize;}else{this._pagingOffset=this._pagingCount-(this._pagingCount%this.pageSize);}
break;case'next':this._pagingOffset+=this.pageSize;break;case'prev':this._pagingOffset-=this.pageSize;if(this._pagingOffset<0){this._pagingOffset=0;}
break;}
this._fetchItems(this._currentFolder);},_setSortOrder:function(by,order){var sortItem={};var isFound=false;var orderBy=this._orderBy||[];var orderItem;var field;var i;sortItem[by]=order||'asc';for(i=0;i<orderBy.length;++i){orderItem=orderBy[i];for(field in orderItem){if(orderItem.hasOwnProperty(field)){if(field===by){orderBy.splice(i,1);orderBy.unshift(sortItem);isFound=true;break;}}}
if(isFound){break;}}
if(isFound){orderBy.unshift(sortItem);}
this._orderBy=orderBy;},_listItems:function(items){var $list=this.$_list.clearGridData();var i;var obj;for(i=0;i<items.length;i++){obj=items[i].resource;$list.addRowData(obj.uid,jQuery.extend({id:obj.id},this.renderRowCols(obj)));}},handleTimeout:function(){},_processItems:function(data,metainfo){this._pagingCount=(metainfo&&jQuery.isNumeric(metainfo.numItems))?metainfo.numItems:null;this.$_grid.find('.loading').hide();this.$_list.show();this._listItems(data);var CSS_DISABLED='ui-state-disabled';var $btns=this._pagingBtns;if(this._pagingOffset<=0){$btns.first.add($btns.prev).addClass(CSS_DISABLED);}else{$btns.first.add($btns.prev).removeClass(CSS_DISABLED);}
if(!jQuery.isNumeric(this._pagingCount)){$btns.end.addClass(CSS_DISABLED);if(data.length<=this.pageSize){$btns.next.addClass(CSS_DISABLED);}else{$btns.next.removeClass(CSS_DISABLED);}}else if(this._pagingOffset+this.pageSize>=this._pagingCount){$btns.end.add($btns.next).addClass(CSS_DISABLED);}else{$btns.end.add($btns.next).removeClass(CSS_DISABLED);}
var from;var to;if(0===data.length&&0===this._pagingOffset){from=0;to=0;}else{from=this._pagingOffset+1;to=from+data.length-1;}
this.$_grid.find('.ui-paging-info').html(this._i18n('Viewing')+' '+
(from)+' - '+
(to)+' '+this._i18n('of')+' '+
(jQuery.isNumeric(this._pagingCount)?this._pagingCount:this._i18n('numerous')));if(metainfo&&metainfo.timeout){this.handleTimeout();}},_createOverlay:function(){if(0===jQuery('.repository-browser-modal-overlay').length){jQuery('body').append('<div class="repository-browser-modal-overlay" '+'style="top: -99999px; z-index: 99999;"></div>');}
var that=this;jQuery('.repository-browser-modal-overlay').click(function(){that.close();});var $container=jQuery('<div class="repository-browser-modal-window"'+' style="top: -99999px; z-index: 99999;">');jQuery('body').append($container);return $container;},_fetchSubnodes:function(nodes,callback){if(-1===nodes){this._fetchRepoRoot(callback);}else{var i;for(i=0;i<nodes.length;i++){var obj=this._getObjectFromCache(nodes.eq(i));if(obj){this.fetchChildren(obj,callback);}}}},getRepoChildren:function(params,callback){if(this.repositoryManager){var that=this;this.repositoryManager.getChildren(params,function(items){that._processRepoResponse(items,callback);});}},queryRepository:function(params,callback){if(this.repositoryManager){var that=this;this.repositoryManager.query(params,function(response){that._processRepoResponse((response.results>0)?response.items:[],{numItems:response.numItems,hasMoreItems:response.hasMoreItems,timeout:response.timeout},callback);});}},renderRowCols:function(item){var row={};jQuery.each(this.columns,function(name,value){switch(name){case'icon':row.icon='<div class="repository-browser-icon '
+'repository-browser-icon-'+item.type
+'"></div>';break;default:row[name]=item[name]||'--';}});return row;},onSelect:function(item){},fetchChildren:function(obj,callback){if(true===obj.hasMoreItems||'folder'===obj.baseType){if(false===obj.loaded){var that=this;this.getRepoChildren({inFolderId:obj.id,repositoryId:obj.repositoryId},function(data){that._cachedRepositoryObjects[obj.uid].loaded=true;if(typeof callback==='function'){callback(data);}});}}},rowClicked:function($event){var row=jQuery($event.target).parent('tr');if(row.length){var uid=row.attr('id');var item=this._cachedRepositoryObjects[uid];this.onSelect(item);return item;}
return null;},getFieldOfHeader:function($th){return $th.find('div.ui-jqgrid-sortable').attr('id').replace('jqgh_','');},_fetchItems:function(folder){if(!folder){return;}
var recursive=(typeof this._searchQuery==='string');this.$_list.setCaption((typeof this._searchQuery==='string')?this._i18n('Searching for')+' "'+this._searchQuery+'" '+
this._i18n('in')+' '+folder.name:this._i18n('Browsing')+': '+folder.name);this.$_list.hide();this.$_grid.find('.loading').show();var that=this;this.queryRepository({repositoryId:folder.repositoryId,inFolderId:folder.id,queryString:this._searchQuery,orderBy:this._orderBy,skipCount:this._pagingOffset,maxItems:this.pageSize,objectTypeFilter:this.objectTypeFilter,renditionFilter:this.renditionFilter,filter:this.filter,recursive:recursive},function(data,metainfo){that._processItems(data,metainfo);});},setObjectTypeFilter:function(otf){this.objectTypeFilter=(typeof otf==='string')?[otf]:otf;},getObjectTypeFilter:function(){return this.objectTypeFilter;},show:function(){this.open();},open:function(){if(this._isOpened){return;}
this._isOpened=true;var $element=this.element;if(this.isFloating){jQuery('.repository-browser-modal-overlay').stop().css({top:0,left:0}).show();$element.stop().show();this._onWindowResized();this.$_grid.resize();var win=jQuery(window);$element.css({left:this.horizontalPadding/2,top:this.verticalPadding/2}).draggable({handle:$element.find('.repository-browser-grab-handle')});this.$_grid.css({marginTop:0,opacity:0}).animate({marginTop:0,opacity:1},1500,'easeOutExpo',function(){if(jQuery.browser.msie){jQuery(this).add($element).css('filter','progid:DXImageTransform.Microsoft.gradient(enabled=false)');}});}else{$element.stop().show().css({opacity:1,filter:'progid:DXImageTransform.Microsoft.gradient(enabled=false)'});this._onWindowResized();this.$_grid.resize();}
++numOpenedBrowsers;},close:function(){if(!this._isOpened){return;}
this._isOpened=false;this.element.fadeOut(250,function(){jQuery(this).css('top',0).hide();if(0===numOpenedBrowsers||0===--numOpenedBrowsers){jQuery('.repository-browser-modal-overlay').hide();}});},refresh:function(){if(this._currentFolder){this._fetchItems(this._currentFolder);}},folderOpened:function(obj){var folder=this._getObjectFromCache(obj);if(folder){if(this.repositoryManager){this.repositoryManager.folderOpened(folder);}}},folderClosed:function(obj){var folder=this._getObjectFromCache(obj);if(folder){if(this.repositoryManager){this.repositoryManager.folderClosed(folder);}}},folderSelected:function(obj){if(this.repositoryManager){this.repositoryManager.folderSelected(obj);}},getSelectedFolder:function(){if(this.repositoryManager){if(typeof this.repositoryManager.getSelectedFolder==='function'){return this.repositoryManager.getSelectedFolder();}}},_adaptPageSize:function(){var listHeight,newPageSize,container;if(!this.adaptPageSize||!this.$_list||!this.rowHeight){return false;}
container=this.$_grid.find('.ui-jqgrid-bdiv');listHeight=container.innerHeight()-20;if(listHeight){newPageSize=Math.floor(listHeight/this.rowHeight);if(newPageSize<=0){newPageSize=1;}
if(newPageSize!==this.pageSize){this.pageSize=newPageSize;return true;}else{return false;}}else{return false;}}});return RepositoryBrowser;});define('repository-browser-i18n-de',[],function(){return{'Browsing':'Durchsuchen','Close':'Schlie  en','in':'in','Input search text...':'Suchtext einf  gen...','numerous':'zahlreiche','of':'von','Repository Browser':'Repository Browser','Search':'Suchen','Searching for':'Suche nach','Viewing':'Anzeige','button.switch-metaview.tooltip':'Zwischen Metaansicht und normaler Ansicht umschalten'};});define('repository-browser-i18n-en',[],function(){return{'Browsing':'Browsing','Close':'Close','in':'in','Input search text...':'Input search text...','numerous':'numerous','of':'of','Repository Browser':'Repository Browser','Search':'Search','Searching for':'Searching for','Viewing':'Viewing','button.switch-metaview.tooltip':'Switch between meta and normal view'};});define('linkbrowser/nls/i18n',{"root":{"button.addlink.tooltip":"Insert Link","button.removelink.tooltip":"Remove Link","newlink.defaulttext":"New Link","floatingmenu.tab.link":"Link"},"ca":true,"de":true,"mk":true,"pt-br":true,"ru":true,"uk":true,"zh-hans":true});define('linkbrowser/linkbrowser-plugin',['aloha','jquery','aloha/plugin','aloha/pluginmanager','ui/ui','ui/button','link/link-plugin','RepositoryBrowser','i18n!linkbrowser/nls/i18n','i18n!aloha/nls/i18n'],function(Aloha,jQuery,Plugin,PluginManager,Ui,Button,Links,RepositoryBrowser,i18n,i18nCore){var LinkBrowser=RepositoryBrowser.extend({init:function(config){this._super(config);var that=this;this._linkBrowserButton=Ui.adopt('linkBrowser',Button,{tooltip:i18n.t('button.addlink.tooltip'),icon:'aloha-icon-tree',scope:'Aloha.continuoustext',click:function(){that.show();}});this._linkBrowserButton.hide();this.url=Aloha.getAlohaUrl()+'/../plugins/extra/linkbrowser/';Aloha.bind('aloha-link-selected',function(event,rangeObject){that._linkBrowserButton.show();});Aloha.bind('aloha-link-unselected',function(event,rangeObject){that._linkBrowserButton.hide();});},onSelect:function(item){Links.hrefField.setItem(item)
var range=Aloha.Selection.getRangeObject();var currentStartContainer=range.startContainer=range.endContainer;var currentStartOffset=range.startOffset=range.endOffset;range.select();range.startContainer=range.endContainer=currentStartContainer;range.startOffset=range.endOffset=currentStartOffset;range.select();Aloha.trigger('aloha-link-selected-in-linkbrowser',item);this.close();},renderRowCols:function(item){var row={},pluginUrl=this.url,icon='__page__',idMatch=item.id.match(/(\d+)\./);jQuery.each(this.columns,function(colName,v){switch(colName){case'icon':row.icon='<div class="aloha-browser-icon\
      aloha-browser-icon-'+icon+'"></div>';break;case'translations':if(!item.renditions){break;}
var rends=item.renditions,i=rends.length,strBldr=[],r;for(;i>0;--i){r=rends[i];if(r.kind=='translation'){strBldr.push('<img src="'+pluginUrl+'img/flags/'+r.language+'.png"\
           alt="'+r.language+'"\
           title="'+r.filename+'" />');}}
row.translations=strBldr.join('');break;case'language':row.language=item.language;break;default:row[colName]=item[colName]||'--';}});return row;}});var LinkBrowserPlugin=Plugin.create('linkbrowser',{dependencies:['link'],browser:null,init:function(){var config={repositoryManager:Aloha.RepositoryManager,repositoryFilter:[],objectTypeFilter:['website','file','image','language'],renditionFilter:['*'],filter:['language'],columns:{icon:{title:'',width:30,sortable:false,resizable:false},name:{title:'Name',width:320,sorttype:'text'},language:{title:'',width:30,sorttype:'text'},translations:{title:'',width:350,sorttype:'text'}},rootPath:Aloha.settings.baseUrl+'/vendor/repository-browser/'};this.browser=new LinkBrowser(config);}});return LinkBrowserPlugin;});define('imagebrowser/nls/i18n',{"root":{"button.addimage.tooltip":"Insert Image","button.removeimage.tooltip":"Remove Image","newimage.defaulttext":"New Image","floatingmenu.tab.img":"Image"},"ca":true,"de":true,"mk":true,"pt-br":true,"ru":true,"uk":true,"zh-hans":true});define('imagebrowser/imagebrowser-plugin',['aloha','jquery','aloha/plugin','aloha/pluginmanager','ui/ui','ui/button','image/image-plugin','RepositoryBrowser','i18n!imagebrowser/nls/i18n','i18n!aloha/nls/i18n'],function(Aloha,jQuery,Plugin,PluginManager,Ui,Button,Images,RepositoryBrowser,i18n,i18nCore){var ImageBrowser=RepositoryBrowser.extend({init:function(config){this._super(config);var browser=this;this._imageBrowserButton=Ui.adopt('imageBrowser',Button,{tooltip:i18n.t('button.addimage.tooltip'),icon:'aloha-icon-tree',scope:'Aloha.continuoustext','class':'aloha-imagebrowser-button',click:function(){browser.open();}});this._imageBrowserButton.show(false);this.url=Aloha.getAlohaUrl()+'/../plugins/extra/imagebrowser/';Aloha.bind('aloha-image-selected',function(event,rangeObject){browser._imageBrowserButton.show(true);});Aloha.bind('aloha-image-unselected',function(event,rangeObject){browser._imageBrowserButton.show(false);});},onSelect:function(item){if(item.type.match('image')!==null){Images.ui.imgSrcField.setItem(item);Images.resetSize();this.close();}},listItems:function(items){var browser=this;var list=this.list.clearGridData();jQuery.each(items,function(){var obj=this.resource;if(obj.type.match('image')!==null){list.addRowData(obj.uid,jQuery.extend({id:obj.id},browser.renderRowCols(obj)));}});},renderRowCols:function(item){var row={},pluginUrl=this.url,icon='__page__',idMatch=item.id.match(/(\d+)\./);jQuery.each(this.columns,function(colName,v){switch(colName){case'icon':if(!item.renditions){break;}
if(item.renditions.length===1){if(item.renditions[0].kind==='thumbnail'){row.icon='<img width="'+item.renditions[0].width
+'" height="'+item.renditions[0].height
+' " src="'+item.renditions[0].url+'"/>';}}
break;default:row[colName]=item[colName]||'--';}});return row;}});var ImageBrowserPlugin=Plugin.create('imagebrowser',{dependencies:['image'],browser:null,init:function(){var config={repositoryManager:Aloha.RepositoryManager,repositoryFilter:[],objectTypeFilter:['image'],renditionFilter:['*'],filter:['language'],columns:{icon:{title:'',width:75,sortable:false,resizable:false},name:{title:'Name',width:320,sorttype:'text'}},rootPath:Aloha.settings.baseUrl+'/vendor/repository-browser/'};this.browser=new ImageBrowser(config);}});return ImageBrowserPlugin;});define('ui/menuButton',['jquery','ui/component','ui/utils','jqueryui'],function($,Component,Utils){var MenuButton=Component.extend({init:function(){this.element=MenuButton.makeMenuButton(this);}});MenuButton.makeMenuButton=function(props){var wrapper=$('<div>',{'class':'aloha-ui-menubutton-container'});var expand=Utils.makeButtonElement({'class':'aloha-ui-menubutton-expand'});var menu=$('<ul>',{'class':'aloha-ui-menubutton-menu'});var action=null;var buttonset=null;if($.browser.msie){wrapper.addClass('aloha-ui-menubutton-iehack');}
if(props.click){action=Utils.makeButton(Utils.makeButtonElement({'class':'aloha-ui-menubutton-action'}),props).click(props.click);Utils.makeButton(expand,{},true);buttonset=$('<div>').buttonset().append(action).append(expand);}else{Utils.makeButton(expand,props,true).addClass('aloha-ui-menubutton-single');}
if(!props.menu){return wrapper.append(action);}
function hideMenu(menu){menu.hide().parent().removeClass('aloha-ui-menubutton-pressed');}
expand.click(function(){wrapper.addClass('aloha-ui-menubutton-pressed');if(props.siblingContainer){props.siblingContainer.find('.aloha-ui-menubutton-menu').each(function(){if(this!==menu[0]){hideMenu($(this));}});}
if(menu.is(':visible')){hideMenu(menu);return;}
menu.show().position({my:'left top',at:'left bottom',of:action||expand});$(document).bind('click',function(event){$(this).unbind(event);menu.hide();wrapper.removeClass('aloha-ui-menubutton-pressed');});return false;});wrapper.append(buttonset||expand).append(menu);menu.append(makeNestedMenus(makeCloseHandler(menu),props.menu));menu.hide().menu({'select':onSelect});return wrapper;};function makeNestedMenus(parentCloseHandler,menu){var elems=[];$.each(menu,function(_,item){var elem=$('<li>');elem.append($('<a>',{'href':'javascript:void 0','html':Utils.makeButtonLabelWithIcon(item)}));if(item.click){elem.data('aloha-ui-menubutton-select',function(){parentCloseHandler();item.click();});}
if(item.menu){var nestedMenu=$('<ul>').appendTo(elem);nestedMenu.append(makeNestedMenus(makeCloseHandler(nestedMenu,parentCloseHandler),item.menu));}
elems.push(elem[0]);});return elems;}
function makeCloseHandler(menu,parentCloseHandler){parentCloseHandler=parentCloseHandler||$.noop;return function(){menu.blur().hide();menu.parent().removeClass('aloha-ui-menubutton-pressed');parentCloseHandler();};}
function onSelect(event,ui){var clickHandler=ui.item.data('aloha-ui-menubutton-select');clickHandler&&clickHandler(event,ui);event.preventDefault();}
return MenuButton;});define('ribbon/ribbon-plugin',['jquery','aloha/plugin','ui/menuButton','ui/utils','jqueryui'],function($,Plugin,MenuButton,Utils){var ribbon=Plugin.create('ribbon',{init:function(){if(!this.settings.enable&&typeof this.settings.enable!=='undefined'){return;}
var that=this;this._visible=false;this._toolbar=$('<div>',{'class':'aloha-ribbon-toolbar ui-menubar ui-widget-header ui-helper-clearfix'});var fadeIn=Utils.makeButtonElement({'class':'aloha-ribbon-in'}).button().hide().click(function(){that._toolbar.animate({'left':0});$('body').animate({paddingTop:30});fadeIn.hide();}).appendTo(this._toolbar);var fadeOut=Utils.makeButtonElement({'class':'aloha-ribbon-out'}).button().click(function(){that._toolbar.animate({'left':-that._toolbar.outerWidth()
+fadeIn.outerWidth()
+10});$('body').animate({paddingTop:0});fadeIn.show();}).appendTo(this._toolbar);var wrapper=$('<div>',{'class':'aloha aloha-ribbon'}).appendTo('body');this._icon=$('<div>').prependTo(this._toolbar);this.setIcon('');this._toolbar.appendTo(wrapper);$('body').css({position:'relative',paddingTop:30});},setIcon:function(iconClass){if(!this._icon){return;}
this._icon.attr('class','aloha-ribbon-icon '+iconClass);},addButton:function(props){if(!this._toolbar){return;}
props=$.extend({},props,{'siblingContainer':this._toolbar});this._toolbar.append(MenuButton.makeMenuButton(props));},hide:function(){if(!this._toolbar){return;}
this._toolbar.hide();this._visible=false;},show:function(){if(!this._toolbar){return;}
this._toolbar.show();this._visible=true;},isVisible:function(){return this._visible;}});return ribbon;});define('wai-lang/nls/i18n',{"root":{"floatingmenu.tab.wai-lang":"Language annotation","button.add-wai-lang-remove.tooltip":"Remove language annotation","button.add-wai-lang.tooltip":"Add language annotation"},"ca":true,"de":true,"mk":true,"pt-br":true,"ru":true,"uk":true,"zh-hans":true});define('wai-lang/languages',['aloha','jquery','flag-icons/flag-icons-plugin','aloha/console','wai-lang/wai-lang-plugin'],function(Aloha,jQuery,FlagIcons,console){var deferred=jQuery.Deferred();return new(Aloha.AbstractRepository.extend({languageCodes:[],locale:'de',iso:'iso639-1',flags:false,_constructor:function(){this._super('wai-languages');},init:function(){var that=this;var waiLang=Aloha.require('wai-lang/wai-lang-plugin');var locale=Aloha.settings.locale;var iso=waiLang.iso639;if(locale!=='de'){this.locale='en';}
if(iso!=='iso639-1'){this.iso='iso639-2';}
this.flags=waiLang.flags;this.repositoryName='WaiLanguages';Aloha.require(['wai-lang/'+this.iso+'-'+this.locale],function(data){that.storeLanguageCodes(data);deferred.resolve();});},markObject:function(obj,item){},errorHandler:function(text,error){console.log("error",this,"Error while loading languages. "+text);},storeLanguageCodes:function(data){var that=this;var waiLangPath=Aloha.getPluginUrl('wai-lang');jQuery.each(data,function(key,value){var el=value;el.id=key;el.repositoryId=that.repositoryId;el.type='language';if(that.flags){if(el.flag){el.url=FlagIcons.path+'/img/flags/'+el.flag+'.png';}else{el.url=waiLangPath+'/img/button.png';}}
that.languageCodes.push(new Aloha.RepositoryDocument(el));});},_searchInLanguageCodes:function(p,callback){var query=new RegExp('^'+p.queryString,'i'),i,d=[],matchesName,matchesType,currentElement;for(i=0;i<this.languageCodes.length;++i){currentElement=this.languageCodes[i];matchesName=(!p.queryString||currentElement.name.match(query));matchesType=(!p.objectTypeFilter||(!p.objectTypeFilter.length)||jQuery.inArray(currentElement.type,p.objectTypeFilter)>-1);if(matchesName&&matchesType){d.push(currentElement);}}
callback.call(this,d);},query:function(p,callback){var that=this;deferred.done(function(){that._searchInLanguageCodes(p,callback);});},getObjectById:function(itemId,callback){var i,currentElement;for(i=0;i<this.languageCodes.length;++i){currentElement=this.languageCodes[i];if(currentElement.id===itemId){callback.call(this,[currentElement]);break;}}}}))();});define('wai-lang/wai-lang-plugin',['aloha','jquery','aloha/plugin','ui/ui','ui/scopes','ui/button','ui/toggleButton','ui/port-helper-attribute-field','i18n!wai-lang/nls/i18n','i18n!aloha/nls/i18n','wai-lang/languages'],function(Aloha,jQuery,Plugin,Ui,Scopes,Button,ToggleButton,AttributeField,i18n,i18nCore){var WAI_LANG_CLASS='aloha-wai-lang',GENTICS=window.GENTICS,langField;return Plugin.create('wai-lang',{config:['span'],iso639:'iso639-1',flags:false,objectTypeFilter:['language'],hotKey:{insertAnnotation:i18n.t('insertAnnotation','ctrl+shift+l')},init:function(){if(this.settings.objectTypeFilter){this.objectTypeFilter=this.settings.objectTypeFilter;}
if(this.settings.hotKey){jQuery.extend(true,this.hotKey,this.settings.hotKey);}
if(this.settings.flags==='true'||this.settings.flags===true||this.settings.flags==='1'||this.settings.flags===1){this.flags=true;}else{this.flags=false;}
if(this.settings.iso639){this.iso639=this.settings.iso639;}
this.createButtons();this.subscribeEvents();this.bindInteractions();},subscribeEvents:function(){var that=this;Aloha.bind('aloha-editable-activated',function(event,rangeObject){var config;config=that.getEditableConfig(Aloha.activeEditable.obj);if(jQuery.inArray('span',config)!==-1){that._wailangButton.show();}else{that._wailangButton.hide();return;}});Aloha.bind('aloha-selection-changed',function(event,rangeObject){var foundMarkup=that._foundLangMarkupAtSelection=that.findLangMarkup(rangeObject);if(foundMarkup){that._wailangButton.setState(true);Scopes.setScope('wai-lang');langField.setTargetObject(foundMarkup,'lang');}else{that._wailangButton.setState(false);that._foundLangMarkupAtSelection=false;langField.setTargetObject(null);}});},createButtons:function(){var that=this;this._wailangButton=Ui.adopt("wailang",ToggleButton,{tooltip:i18n.t('button.add-wai-lang.tooltip'),icon:'aloha-icon aloha-icon-wai-lang',scope:'Aloha.continuoustext',click:function(){that.addRemoveMarkupToSelection();}});Scopes.createScope('wai-lang','Aloha.continuoustext');langField=AttributeField({name:'wailangfield',width:320,valueField:'id',minChars:1,scope:'wai-lang'});if(this.flags){langField.setTemplate('<div class="aloha-wai-lang-img-item">'+'<img class="aloha-wai-lang-img" src="{url}" />'+'<div class="aloha-wai-lang-label-item">{name} ({id})</div>'+'</div>');}else{langField.setTemplate('<div class="aloha-wai-lang-img-item">'+'<div class="aloha-wai-lang-label-item">{name} ({id})</div>'+'</div>');}
langField.setObjectTypeFilter(this.objectTypeFilter);this._removewailangButton=Ui.adopt('removewailang',Button,{tooltip:i18n.t('button.add-wai-lang-remove.tooltip'),icon:'aloha-icon aloha-icon-wai-lang-remove',scope:'wai-lang',click:function(){that.removeLangMarkup();}});},findLangMarkup:function(range){range=range||Aloha.Selection.getRangeObject();if(Aloha.activeEditable){return range.findMarkup(function(){return jQuery(this).hasClass(WAI_LANG_CLASS)||jQuery(this).is('[lang]');},Aloha.activeEditable.obj);}
return null;},findLanguageMarkup:function(range){range=range||Aloha.Selection.getRangeObject();if(Aloha.activeEditable){return range.findMarkup(function(){return this.nodeName==='SPAN';},Aloha.activeEditable.obj);}
return null;},removeLangMarkup:function(){var range=Aloha.Selection.getRangeObject(),foundMarkup=this.findLangMarkup(range);if(foundMarkup){GENTICS.Utils.Dom.removeFromDOM(foundMarkup,range,true);range.select();Scopes.setScope('Aloha.continuoustext');langField.setTargetObject(null);}},bindInteractions:function(){var that=this;langField.addListener('blur',function(obj,event){if(!this.getValue()){that.removeMarkup();}});Aloha.bind('aloha-editable-created',function(event,editable){enhanceEditable(editable);});function enhanceEditable(editable){editable.obj.bind('keydown',that.hotKey.insertAnnotation,function(){that.insertLanguageAnnotation();});editable.obj.find('span[lang]').each(function(i){that.makeVisible(this);});}},insertLanguageAnnotation:function(){if(typeof this.findLangMarkup==='function'){if(this.findLangMarkup()){langField.foreground();langField.focus();}else{this.addMarkupToSelection();}
return false;}},makeVisible:function(element){var $element=jQuery(element);$element.addClass(WAI_LANG_CLASS);$element.attr('data-gentics-aloha-repository','wai-languages');$element.attr('data-gentics-aloha-object-id',$element.attr('lang'));},formatLanguageSpan:function(){if(Aloha.activeEditable){var range=Aloha.Selection.getRangeObject();if(this.findLanguageMarkup(range)){this.removeMarkup();}else{this.insertMarkup();}}},addRemoveMarkupToSelection:function(){if(this._foundLangMarkupAtSelection){this.removeLangMarkup();}else{this.addMarkupToSelection(false);}},addMarkupToSelection:function(){var range=Aloha.Selection.getRangeObject();if(this.findLangMarkup(range)){return;}
langField.foreground();Scopes.setScope('wai-lang');if(range.isCollapsed()){GENTICS.Utils.Dom.extendToWord(range);}
if(!range.isCollapsed()){GENTICS.Utils.Dom.addMarkup(range,jQuery('<span class="'+WAI_LANG_CLASS+'"></span>'),false);}
range.select();langField.focus();},removeMarkup:function(){var foundMarkup=this.findLangMarkup(),range;if(foundMarkup){range=Aloha.Selection.getRangeObject();GENTICS.Utils.Dom.removeFromDOM(foundMarkup,range,true);range.select();}},makeClean:function(obj){obj.find('span[lang]').each(function(){jQuery(this).removeClass(WAI_LANG_CLASS);jQuery(this).removeAttr("data-gentics-aloha-repository");jQuery(this).removeAttr("data-gentics-aloha-object-id");jQuery(this).attr("xml:lang",jQuery(this).attr("lang"));});}});});define('headerids/nls/i18n',{"root":{"headerids.label.target":"Target","headerids.button.reset":"Reset","headerids.button.set":"Set","internal_hyperlink":"Internal Hyperlink"},"ca":true,"de":true,"mk":true,"pt-br":true,"ru":true,"uk":true,"zh-hans":true});define('headerids/headerids-plugin',['jquery','aloha/plugin','i18n!headerids/nls/i18n','i18n!aloha/nls/i18n'],function(jQuery,Plugin,i18n,i18nCore){var
$=jQuery,GENTICS=window.GENTICS,Aloha=window.Aloha;var ns='aloha-headerids';function nsSel(){var strBldr=[],prx=ns;$.each(arguments,function(){strBldr.push('.'+(this==''?prx:prx+'-'+this));});return jQuery.trim(strBldr.join(' '));};function nsClass(){var strBldr=[],prx=ns;$.each(arguments,function(){strBldr.push(this==''?prx:prx+'-'+this);});return jQuery.trim(strBldr.join(' '));};return Plugin.create('headerids',{_constructor:function(){this._super('headerids');},config:['true'],init:function(){var that=this;Aloha.bind("aloha-editable-activated",function(jEvent,params){that.check(params.editable.obj);});Aloha.bind("aloha-editable-deactivated",function(jEvent,params){that.check(params.editable.obj);});Aloha.bind('aloha-ready',function(ev){that.initSidebar(Aloha.Sidebar.right);});},check:function(editable){var that=this;var config=that.getEditableConfig(editable);if(jQuery.inArray('true',config)===-1){return false;}
jQuery(editable).find('h1, h2, h3, h4, h5, h6').not('.aloha-customized').each(function(){that.processH(this);});},processH:function(h){var that=this;jQuery(h).attr('id',that.sanitize(jQuery(h).text()));},sanitize:function(str){return(str.replace(/[^a-z0-9]+/gi,'_'));},initSidebar:function(sidebar){var pl=this;pl.sidebar=sidebar;sidebar.addPanel({id:nsClass('sidebar-panel'),title:i18n.t('internal_hyperlink'),content:'',expanded:true,activeOn:'h1, h2, h3, h4, h5, h6',onInit:function(){var that=this,content=this.setContent('<label class="'+nsClass('label')+'" for="'+nsClass('input')+'">'+i18n.t('headerids.label.target')+'</label><input id="'+nsClass('input')+'" class="'+nsClass('input')+'" type="text" name="value"/> <button class="'+nsClass('reset-button')+'">'+i18n.t('headerids.button.reset')+'</button><button class="'+nsClass('set-button')+'">'+i18n.t('headerids.button.set')+'</button>').content;content.find(nsSel('set-button')).click(function(){var content=that.content;jQuery(that.effective).attr('id',jQuery(nsSel('input')).val());jQuery(that.effective).addClass('aloha-customized');});content.find(nsSel('reset-button')).click(function(){var content=that.content;pl.processH(that.effective);jQuery(that.effective).removeClass('aloha-customized');that.content.find(nsSel('input')).val(that.effective.attr('id'));});},onActivate:function(effective){var that=this;that.effective=effective;that.content.find(nsSel('input')).val(effective.attr('id'));}});sidebar.show();},makeClean:function(obj){this.check(obj);}});});define('metaview/nls/i18n',{"root":{"button.switch-metaview.tooltip":"Switch between meta and normal view"},"ca":true,"de":true,"mk":true,"pt-br":true,"ru":true,"uk":true,"zh-hans":true});define('metaview/metaview-plugin',['aloha/plugin','ui/ui','ui/toggleButton','i18n!metaview/nls/i18n','i18n!aloha/nls/i18n','jquery'],function(Plugin,Ui,ToggleButton,i18n,i18nCore,jQuery){var GENTICS=window.GENTICS,Aloha=window.Aloha;return Plugin.create('metaview',{_constructor:function(){this._super('metaview');},config:['metaview'],init:function(){var that=this;this.createButtons();Aloha.bind("aloha-editable-activated",function(jEvent,aEvent){var config;config=that.getEditableConfig(Aloha.activeEditable.obj);if(jQuery.type(config)==='array'&&jQuery.inArray('metaview',config)!==-1){that._toggleMetaViewButton.show(true);}else{that._toggleMetaViewButton.show(false);return;}
if(jQuery(Aloha.activeEditable.obj).hasClass('aloha-metaview')){that._toggleMetaViewButton.setState(true);}else{that._toggleMetaViewButton.setState(false);}});},buttonClick:function(){if(jQuery(Aloha.activeEditable.obj).hasClass('aloha-metaview')){jQuery(Aloha.activeEditable.obj).removeClass('aloha-metaview');this._toggleMetaViewButton.setState(false);}else{jQuery(Aloha.activeEditable.obj).addClass('aloha-metaview');this._toggleMetaViewButton.setState(true);}},createButtons:function(){var that=this;this._toggleMetaViewButton=Ui.adopt("toggleMetaView",ToggleButton,{tooltip:i18n.t('button.switch-metaview.tooltip'),icon:'aloha-icon aloha-icon-metaview',scope:'Aloha.continuoustext',click:function(){that.buttonClick();}});}});});define('listenforcer/listenforcer-plugin',['aloha','jquery','aloha/plugin','aloha/console'],function(Aloha,jQuery,Plugin,console){var listEnforcedEditables=[];function enforce($editable,placeHolderListString){if(jQuery.inArray($editable[0],listEnforcedEditables)===-1){return;}
$editable.find('.aloha-end-br').remove();var hasList=false;$editable.find('li').each(function(){if(jQuery.trim(jQuery(this).text())!==''){hasList=true;return false;}});if(!hasList){$editable.html(placeHolderListString);}
var $lists=$editable.find('>ul,>ol'),j=$lists.length,i;if(j>1){var $firstList=jQuery($lists[0]);for(i=1;i<j;++i){$firstList.append(jQuery($lists[i]).find('>li'));jQuery($lists[i]).remove();}}
$editable.find('>*:not(ul,ol)').remove();};return Plugin.create('listenforcer',{_constructor:function(){this._super('listenforcer');},init:function(){var that=this,elemsToEnforce=this.settings.editables||[],elemToEnforce,i,j=elemsToEnforce.length;for(i=0;i<j;i++){elemToEnforce=elemsToEnforce[i];if(typeof elemToEnforce==='string'||elemToEnforce.nodeName||elemToEnforce instanceof jQuery){jQuery(elemToEnforce).each(function(){that.addEditableToEnforcementList(this);});}else{console.warn('Aloha List Enforcer Plugin','Object "'+elemToEnforce.toString()+'" can not '+'be used as a jQuery selector with which to register'+' an editable to be list enforced.');}}
Aloha.bind('aloha-editable-activated',function($event,params){enforce(params.editable.obj,'<ul><li><br /></li></ul>');});Aloha.bind('aloha-editable-deactivated',function($event,params){enforce(params.editable.obj,'');});Aloha.bind('aloha-smart-content-changed',function($event,params){if(Aloha.activeEditable&&Aloha.activeEditable.isActive===true){enforce(params.editable.obj,'<ul><li><br /></li></ul>');}});},addEditableToEnforcementList:function(editable){if(editable){listEnforcedEditables.push(editable);}}});});if(Aloha._load){Aloha._load();}}());;